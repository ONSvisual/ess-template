//js
import{S as di,i as fi,s as pi,k as qe,a as vt,l as Ge,m as me,c as xt,h as W,n as S,p as Bt,b as Ze,C as se,D as zi,q as Mt,r as Pt,u as $i,W as Tr,g as We,v as vr,f as xr,d as it,V as Gi,U as mi,y as Vt,z as Ut,A as Nt,B as qt,F as ct,G as ut,w as gi,Q as bi,H as Ls,R as wi,P as _u,T as Uo,e as ur,_ as Lm,X as wf,$ as Rm,J as Bm,O as Ql,o as ac,a0 as yu,a1 as Fm,I as vu,K as xu,L as bu,M as wu,N as Om,Y as ku,a2 as Jh,a3 as Vm,Z as kf}from"../chunks/index.e4100830.js";import{b as du}from"../chunks/paths.97bd0762.js";import{T as Um,H as Nm,S as qm}from"../chunks/Subhead.6b5328a0.js";import{R as qo,l as $l,H as Gm,a as jm,S as Zm,P as Xm}from"../chunks/HorizontalBeeswarmSVG.0e1ead50.js";import{e as Ta,f as Wm,h as ec,b as Yl,c as Hm,r as Km,m as Yh}from"../chunks/config.4120aca4.js";import{a as tc,r as ic,b as Jm,t as rc,c as Qh}from"../chunks/utils.7b40fe5c.js";import{S as Ym}from"../chunks/Select.71aad8c8.js";import{c as Qm,g as $m}from"../chunks/index.34b8e95a.js";import{w as eg}from"../chunks/index.42b545a9.js";function tg(h){return h}function ig(h){if(h==null)return tg;var l,c,p=h.scale[0],y=h.scale[1],v=h.translate[0],w=h.translate[1];return function(a,k){k||(l=c=0);var T=2,D=a.length,M=new Array(D);for(M[0]=(l+=a[0])*p+v,M[1]=(c+=a[1])*y+w;T<D;)M[T]=a[T],++T;return M}}function rg(h,l){for(var c,p=h.length,y=p-l;y<--p;)c=h[y],h[y++]=h[p],h[p]=c}function ng(h,l){return typeof l=="string"&&(l=h.objects[l]),l.type==="GeometryCollection"?{type:"FeatureCollection",features:l.geometries.map(function(c){return $h(h,c)})}:$h(h,l)}function $h(h,l){var c=l.id,p=l.bbox,y=l.properties==null?{}:l.properties,v=ag(h,l);return c==null&&p==null?{type:"Feature",properties:y,geometry:v}:p==null?{type:"Feature",id:c,properties:y,geometry:v}:{type:"Feature",id:c,bbox:p,properties:y,geometry:v}}function ag(h,l){var c=ig(h.transform),p=h.arcs;function y(D,M){M.length&&M.pop();for(var A=p[D<0?~D:D],N=0,O=A.length;N<O;++N)M.push(c(A[N],N));D<0&&rg(M,O)}function v(D){return c(D)}function w(D){for(var M=[],A=0,N=D.length;A<N;++A)y(D[A],M);return M.length<2&&M.push(M[0]),M}function a(D){for(var M=w(D);M.length<4;)M.push(M[0]);return M}function k(D){return D.map(a)}function T(D){var M=D.type,A;switch(M){case"GeometryCollection":return{type:M,geometries:D.geometries.map(T)};case"Point":A=v(D.coordinates);break;case"MultiPoint":A=D.coordinates.map(v);break;case"LineString":A=w(D.arcs);break;case"MultiLineString":A=D.arcs.map(w);break;case"Polygon":A=k(D.arcs);break;case"MultiPolygon":A=D.arcs.map(k);break;default:return null}return{type:M,coordinates:A}}return T(l)}function Rs(h){return function(){return h}}const fu=Math.PI,pu=2*fu,rs=1e-6,sg=pu-rs;function If(h){this._+=h[0];for(let l=1,c=h.length;l<c;++l)this._+=arguments[l]+h[l]}function og(h){let l=Math.floor(h);if(!(l>=0))throw new Error(`invalid digits: ${h}`);if(l>15)return If;const c=10**l;return function(p){this._+=p[0];for(let y=1,v=p.length;y<v;++y)this._+=Math.round(arguments[y]*c)/c+p[y]}}class lg{constructor(l){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=l==null?If:og(l)}moveTo(l,c){this._append`M${this._x0=this._x1=+l},${this._y0=this._y1=+c}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(l,c){this._append`L${this._x1=+l},${this._y1=+c}`}quadraticCurveTo(l,c,p,y){this._append`Q${+l},${+c},${this._x1=+p},${this._y1=+y}`}bezierCurveTo(l,c,p,y,v,w){this._append`C${+l},${+c},${+p},${+y},${this._x1=+v},${this._y1=+w}`}arcTo(l,c,p,y,v){if(l=+l,c=+c,p=+p,y=+y,v=+v,v<0)throw new Error(`negative radius: ${v}`);let w=this._x1,a=this._y1,k=p-l,T=y-c,D=w-l,M=a-c,A=D*D+M*M;if(this._x1===null)this._append`M${this._x1=l},${this._y1=c}`;else if(A>rs)if(!(Math.abs(M*k-T*D)>rs)||!v)this._append`L${this._x1=l},${this._y1=c}`;else{let N=p-w,O=y-a,G=k*k+T*T,Q=N*N+O*O,te=Math.sqrt(G),le=Math.sqrt(A),he=v*Math.tan((fu-Math.acos((G+A-Q)/(2*te*le)))/2),Y=he/le,_e=he/te;Math.abs(Y-1)>rs&&this._append`L${l+Y*D},${c+Y*M}`,this._append`A${v},${v},0,0,${+(M*N>D*O)},${this._x1=l+_e*k},${this._y1=c+_e*T}`}}arc(l,c,p,y,v,w){if(l=+l,c=+c,p=+p,w=!!w,p<0)throw new Error(`negative radius: ${p}`);let a=p*Math.cos(y),k=p*Math.sin(y),T=l+a,D=c+k,M=1^w,A=w?y-v:v-y;this._x1===null?this._append`M${T},${D}`:(Math.abs(this._x1-T)>rs||Math.abs(this._y1-D)>rs)&&this._append`L${T},${D}`,p&&(A<0&&(A=A%pu+pu),A>sg?this._append`A${p},${p},0,1,${M},${l-a},${c-k}A${p},${p},0,1,${M},${this._x1=T},${this._y1=D}`:A>rs&&this._append`A${p},${p},0,${+(A>=fu)},${M},${this._x1=l+p*Math.cos(v)},${this._y1=c+p*Math.sin(v)}`)}rect(l,c,p,y){this._append`M${this._x0=this._x1=+l},${this._y0=this._y1=+c}h${p=+p}v${+y}h${-p}Z`}toString(){return this._}}function cg(h){let l=3;return h.digits=function(c){if(!arguments.length)return l;if(c==null)l=null;else{const p=Math.floor(c);if(!(p>=0))throw new RangeError(`invalid digits: ${c}`);l=p}return h},()=>new lg(l)}function ug(h){return typeof h=="object"&&"length"in h?h:Array.from(h)}function Ef(h){this._context=h}Ef.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,l){switch(h=+h,l=+l,this._point){case 0:this._point=1,this._line?this._context.lineTo(h,l):this._context.moveTo(h,l);break;case 1:this._point=2;default:this._context.lineTo(h,l);break}}};function hg(h){return new Ef(h)}function dg(h){return h[0]}function fg(h){return h[1]}function pg(h,l){var c=Rs(!0),p=null,y=hg,v=null,w=cg(a);h=typeof h=="function"?h:h===void 0?dg:Rs(h),l=typeof l=="function"?l:l===void 0?fg:Rs(l);function a(k){var T,D=(k=ug(k)).length,M,A=!1,N;for(p==null&&(v=y(N=w())),T=0;T<=D;++T)!(T<D&&c(M=k[T],T,k))===A&&((A=!A)?v.lineStart():v.lineEnd()),A&&v.point(+h(M,T,k),+l(M,T,k));if(N)return v=null,N+""||null}return a.x=function(k){return arguments.length?(h=typeof k=="function"?k:Rs(+k),a):h},a.y=function(k){return arguments.length?(l=typeof k=="function"?k:Rs(+k),a):l},a.defined=function(k){return arguments.length?(c=typeof k=="function"?k:Rs(!!k),a):c},a.curve=function(k){return arguments.length?(y=k,p!=null&&(v=y(p)),a):y},a.context=function(k){return arguments.length?(k==null?p=v=null:v=y(p=k),a):p},a}function ed(h){let l,c;return{c(){l=qe("p"),c=Mt(h[8]),this.h()},l(p){l=Ge(p,"P",{class:!0,style:!0});var y=me(l);c=Pt(y,h[8]),y.forEach(W),this.h()},h(){S(l,"class","mainText svelte-uxdwpk"),Bt(l,"font-size",h[8].length<=5?"18px":h[8].length<=6?"16px":h[8].length<=7?"14px":"12px")},m(p,y){Ze(p,l,y),se(l,c)},p(p,y){y&256&&$i(c,p[8]),y&256&&Bt(l,"font-size",p[8].length<=5?"18px":p[8].length<=6?"16px":p[8].length<=7?"14px":"12px")},d(p){p&&W(l)}}}function td(h){let l,c;return{c(){l=qe("p"),c=Mt(h[7]),this.h()},l(p){l=Ge(p,"P",{class:!0,style:!0});var y=me(l);c=Pt(y,h[7]),y.forEach(W),this.h()},h(){S(l,"class","secondaryText svelte-uxdwpk"),Bt(l,"font-size",h[2].length<=5?"12px":"10px"),Bt(l,"line-height",h[2].length<=5?"13px":"11px")},m(p,y){Ze(p,l,y),se(l,c)},p(p,y){y&128&&$i(c,p[7]),y&4&&Bt(l,"font-size",p[2].length<=5?"12px":"10px"),y&4&&Bt(l,"line-height",p[2].length<=5?"13px":"11px")},d(p){p&&W(l)}}}function mg(h){let l,c=h[0].includes(0),p,y=h[3]!=null&h[4]!=null&h[0].includes(1)&h[0].includes(0),v,w=c&&ed(h),a=y&&td(h);return{c(){l=qe("div"),w&&w.c(),p=vt(),a&&a.c(),this.h()},l(k){l=Ge(k,"DIV",{class:!0,style:!0});var T=me(l);w&&w.l(T),p=xt(T),a&&a.l(T),T.forEach(W),this.h()},h(){S(l,"class",v="cell-container "+(h[4]==null?"no-data":"")+" svelte-uxdwpk"),Bt(l,"background-color",h[9]),Bt(l,"color",h[1]===2&h[6]==="improving"&h[5]==="worse than average"?"black":"white")},m(k,T){Ze(k,l,T),w&&w.m(l,null),se(l,p),a&&a.m(l,null)},p(k,[T]){T&1&&(c=k[0].includes(0)),c?w?w.p(k,T):(w=ed(k),w.c(),w.m(l,p)):w&&(w.d(1),w=null),T&25&&(y=k[3]!=null&k[4]!=null&k[0].includes(1)&k[0].includes(0)),y?a?a.p(k,T):(a=td(k),a.c(),a.m(l,null)):a&&(a.d(1),a=null),T&16&&v!==(v="cell-container "+(k[4]==null?"no-data":"")+" svelte-uxdwpk")&&S(l,"class",v),T&512&&Bt(l,"background-color",k[9]),T&98&&Bt(l,"color",k[1]===2&k[6]==="improving"&k[5]==="worse than average"?"black":"white")},i:zi,o:zi,d(k){k&&W(l),w&&w.d(),a&&a.d()}}}function gg(h,l,c){let p,y,v,w,a,k,T,D,M,A,{calculations:N,indicatorMetadata:O,latestData:G,initialData:Q,labelsArray:te,comparisonsId:le,rowNumb:he}=l,Y=O.prefix===null?"":O.prefix,_e=O.suffix===null?"":O.suffix;return h.$$set=re=>{"calculations"in re&&c(10,N=re.calculations),"indicatorMetadata"in re&&c(11,O=re.indicatorMetadata),"latestData"in re&&c(12,G=re.latestData),"initialData"in re&&c(13,Q=re.initialData),"labelsArray"in re&&c(0,te=re.labelsArray),"comparisonsId"in re&&c(1,le=re.comparisonsId),"rowNumb"in re&&c(14,he=re.rowNumb)},h.$$.update=()=>{h.$$.dirty&4096&&c(4,p=G.length>0?G[0].value:null),h.$$.dirty&8192&&c(3,y=Q.length>0?Q[0].value:null),h.$$.dirty&24&&c(16,v=p!=null&y!=null?100*(p-y)/y:null),h.$$.dirty&1040&&c(15,w=p!=null?100*(p-N.medianValue)/N.medianValue:null),h.$$.dirty&67584&&c(6,a=v!=null?Math.abs(v)<O.similarThreshold?"similar":v>0?O.polarity==1?"improving":"worsening":O.polarity==1?"worsening":"improving":null),h.$$.dirty&34816&&c(5,k=w!=null?Math.abs(w)<O.similarThreshold?"similar":w>0?O.polarity==1?"better than average":"worse than average":O.polarity==1?"worse than average":"better than average":null),h.$$.dirty&98&&c(9,T=a==null&k==null?"grey":Ta[a!=null&[1,2].includes(le)?a:"similar"][k!=null&[0,2].includes(le)?k:"similar"]),h.$$.dirty&2064&&c(8,D=p!=null?Y+tc(ic(p,O.decimalPlaces))+_e:"No data"),h.$$.dirty&2056&&c(2,M=y!=null?Y+tc(ic(y,O.decimalPlaces))+_e:"No data"),h.$$.dirty&17420&&c(7,A=y!=null?he===0?"("+M+" in "+N.minXDomain+")":"("+M+")":"No data")},[te,le,M,y,p,k,a,A,D,T,N,O,G,Q,he,w,v]}let _g=class extends di{constructor(l){super(),fi(this,l,gg,mg,pi,{calculations:10,indicatorMetadata:11,latestData:12,initialData:13,labelsArray:0,comparisonsId:1,rowNumb:14})}};function id(h,l,c){const p=h.slice();return p[14]=l[c],p[16]=c,p}function rd(h){let l,c,p,y;function v(...a){return h[11](h[14],...a)}function w(...a){return h[12](h[14],...a)}return c=new _g({props:{calculations:h[14],rowNumb:h[5],comparisonsId:h[0],labelsArray:h[1],indicatorMetadata:h[2].find(v),latestData:h[4].filter(w),initialData:"indicator-"+h[14].id in h[3]?h[3]["indicator-"+h[14].id].filter(h[13]):[]}}),{c(){l=qe("div"),Vt(c.$$.fragment),p=vt(),this.h()},l(a){l=Ge(a,"DIV",{class:!0});var k=me(l);Ut(c.$$.fragment,k),p=xt(k),k.forEach(W),this.h()},h(){S(l,"class",Tr("cell column"+h[16])+" svelte-17hudsm")},m(a,k){Ze(a,l,k),Nt(c,l,null),se(l,p),y=!0},p(a,k){h=a;const T={};k&128&&(T.calculations=h[14]),k&32&&(T.rowNumb=h[5]),k&1&&(T.comparisonsId=h[0]),k&2&&(T.labelsArray=h[1]),k&132&&(T.indicatorMetadata=h[2].find(v)),k&208&&(T.latestData=h[4].filter(w)),k&200&&(T.initialData="indicator-"+h[14].id in h[3]?h[3]["indicator-"+h[14].id].filter(h[13]):[]),c.$set(T)},i(a){y||(We(c.$$.fragment,a),y=!0)},o(a){it(c.$$.fragment,a),y=!1},d(a){a&&W(l),qt(c)}}}function yg(h){let l,c,p,y=h[8].find(h[10]).areanm+"",v,w,a,k,T=h[7],D=[];for(let A=0;A<T.length;A+=1)D[A]=rd(id(h,T,A));const M=A=>it(D[A],1,1,()=>{D[A]=null});return{c(){l=qe("div"),c=qe("div"),p=qe("p"),v=Mt(y),w=vt();for(let A=0;A<D.length;A+=1)D[A].c();this.h()},l(A){l=Ge(A,"DIV",{class:!0,style:!0});var N=me(l);c=Ge(N,"DIV",{class:!0,style:!0});var O=me(c);p=Ge(O,"P",{class:!0});var G=me(p);v=Pt(G,y),G.forEach(W),O.forEach(W),w=xt(N);for(let Q=0;Q<D.length;Q+=1)D[Q].l(N);N.forEach(W),this.h()},h(){S(p,"class","svelte-17hudsm"),S(c,"class","areasColumn svelte-17hudsm"),S(c,"style","width: 200px"),S(l,"class",a=Tr("row cellRow"+h[5])+" svelte-17hudsm"),Bt(l,"background-color",h[5]%2===0?"#fafafa":"#ffffff")},m(A,N){Ze(A,l,N),se(l,c),se(c,p),se(p,v),se(l,w);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(l,null);k=!0},p(A,[N]){if((!k||N&64)&&y!==(y=A[8].find(A[10]).areanm+"")&&$i(v,y),N&255){T=A[7];let O;for(O=0;O<T.length;O+=1){const G=id(A,T,O);D[O]?(D[O].p(G,N),We(D[O],1)):(D[O]=rd(G),D[O].c(),We(D[O],1),D[O].m(l,null))}for(vr(),O=T.length;O<D.length;O+=1)M(O);xr()}(!k||N&32&&a!==(a=Tr("row cellRow"+A[5])+" svelte-17hudsm"))&&S(l,"class",a),(!k||N&32)&&Bt(l,"background-color",A[5]%2===0?"#fafafa":"#ffffff")},i(A){if(!k){for(let N=0;N<T.length;N+=1)We(D[N]);k=!0}},o(A){D=D.filter(Boolean);for(let N=0;N<D.length;N+=1)it(D[N]);k=!1},d(A){A&&W(l),Gi(D,A)}}}function vg(h,l,c){let{chosenId1:p,chosenId2:y,chosenId3:v,indicatorsMetadata:w,initialData:a,latestData:k,j:T,row:D,indicatorsCalculations:M}=l,A=mi("areas");const N=te=>te.areacd===D.areacd,O=(te,le)=>le.code==te.code,G=(te,le)=>te.id==le.id&D.areacd==le.areacd,Q=te=>te.areacd==D.areacd;return h.$$set=te=>{"chosenId1"in te&&c(9,p=te.chosenId1),"chosenId2"in te&&c(0,y=te.chosenId2),"chosenId3"in te&&c(1,v=te.chosenId3),"indicatorsMetadata"in te&&c(2,w=te.indicatorsMetadata),"initialData"in te&&c(3,a=te.initialData),"latestData"in te&&c(4,k=te.latestData),"j"in te&&c(5,T=te.j),"row"in te&&c(6,D=te.row),"indicatorsCalculations"in te&&c(7,M=te.indicatorsCalculations)},h.$$.update=()=>{h.$$.dirty&64&&console.log(D)},[y,v,w,a,k,T,D,M,A,p,N,O,G,Q]}let xg=class extends di{constructor(l){super(),fi(this,l,vg,yg,pi,{chosenId1:9,chosenId2:0,chosenId3:1,indicatorsMetadata:2,initialData:3,latestData:4,j:5,row:6,indicatorsCalculations:7})}};function bg(h){let l,c,p;return{c(){l=qe("div"),c=ct("svg"),p=ct("path"),this.h()},l(y){l=Ge(y,"DIV",{class:!0});var v=me(l);c=ut(v,"svg",{width:!0,height:!0,class:!0,viewBox:!0,style:!0});var w=me(c);p=ut(w,"path",{d:!0}),me(p).forEach(W),w.forEach(W),v.forEach(W),this.h()},h(){S(p,"d","M24.15 34q.65 0 1.075-.425.425-.425.425-1.075v-9.05q0-.6-.45-1.025Q24.75 22 24.15 22q-.65 0-1.075.425-.425.425-.425 1.075v9.05q0 .6.45 1.025.45.425 1.05.425ZM24 18.3q.7 0 1.175-.45.475-.45.475-1.15t-.475-1.2Q24.7 15 24 15q-.7 0-1.175.5-.475.5-.475 1.2t.475 1.15q.475.45 1.175.45ZM24 44q-4.25 0-7.9-1.525-3.65-1.525-6.35-4.225-2.7-2.7-4.225-6.35Q4 28.25 4 24q0-4.2 1.525-7.85Q7.05 12.5 9.75 9.8q2.7-2.7 6.35-4.25Q19.75 4 24 4q4.2 0 7.85 1.55Q35.5 7.1 38.2 9.8q2.7 2.7 4.25 6.35Q44 19.8 44 24q0 4.25-1.55 7.9-1.55 3.65-4.25 6.35-2.7 2.7-6.35 4.225Q28.2 44 24 44Zm0-20Zm0 17q7 0 12-5t5-12q0-7-5-12T24 7q-7 0-12 5T7 24q0 7 5 12t12 5Z"),S(c,"width","20"),S(c,"height","20"),S(c,"class","c h-16 w-16 inline svelte-nloqxl"),S(c,"viewBox","0 0 48 48"),Bt(c,"transform","rotate(0deg)"),S(l,"class","infoCell svelte-185pa6q")},m(y,v){Ze(y,l,v),se(l,c),se(c,p)},p:zi,i:zi,o:zi,d(y){y&&W(l)}}}class Iu extends di{constructor(l){super(),fi(this,l,null,bg,pi,{})}}function nd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function ad(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function sd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function od(h){let l,c,p=h[6].label+"",y,v;return{c(){l=qe("div"),c=qe("p"),y=Mt(p),v=vt(),this.h()},l(w){l=Ge(w,"DIV",{class:!0});var a=me(l);c=Ge(a,"P",{class:!0});var k=me(c);y=Pt(k,p),v=xt(k),k.forEach(W),a.forEach(W),this.h()},h(){S(c,"class","svelte-15wb3yy"),S(l,"class",Tr("headerCell column"+h[8])+" svelte-15wb3yy")},m(w,a){Ze(w,l,a),se(l,c),se(c,y),se(c,v)},p(w,a){a&4&&p!==(p=w[6].label+"")&&$i(y,p)},d(w){w&&W(l)}}}function ld(h){let l,c;return l=new Iu({}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function cd(h){let l,c="(compared to "+h[3].find(y).label+")",p;function y(...v){return h[5](h[6],...v)}return{c(){l=qe("p"),p=Mt(c),this.h()},l(v){l=Ge(v,"P",{class:!0});var w=me(l);p=Pt(w,c),w.forEach(W),this.h()},h(){S(l,"class","initial-year-label svelte-15wb3yy")},m(v,w){Ze(v,l,w),se(l,p)},p(v,w){h=v,w&4&&c!==(c="(compared to "+h[3].find(y).label+")")&&$i(p,c)},d(v){v&&W(l)}}}function ud(h){let l,c,p=h[3].find(k).label+"",y,v,w=h[6].minXDomain!=h[6].maxXDomain&(h[1].includes(1)||h[0]!=0),a;function k(...D){return h[4](h[6],...D)}let T=w&&cd(h);return{c(){l=qe("div"),c=qe("p"),y=Mt(p),v=vt(),T&&T.c(),a=vt(),this.h()},l(D){l=Ge(D,"DIV",{class:!0});var M=me(l);c=Ge(M,"P",{class:!0});var A=me(c);y=Pt(A,p),A.forEach(W),v=xt(M),T&&T.l(M),a=xt(M),M.forEach(W),this.h()},h(){S(c,"class","latest-year-label svelte-15wb3yy"),S(l,"class",Tr("yearCell column"+h[8])+" svelte-15wb3yy")},m(D,M){Ze(D,l,M),se(l,c),se(c,y),se(l,v),T&&T.m(l,null),se(l,a)},p(D,M){h=D,M&4&&p!==(p=h[3].find(k).label+"")&&$i(y,p),M&7&&(w=h[6].minXDomain!=h[6].maxXDomain&(h[1].includes(1)||h[0]!=0)),w?T?T.p(h,M):(T=cd(h),T.c(),T.m(l,a)):T&&(T.d(1),T=null)},d(D){D&&W(l),T&&T.d()}}}function wg(h){let l,c,p,y,v,w,a,k,T,D,M,A,N=h[2],O=[];for(let Y=0;Y<N.length;Y+=1)O[Y]=od(sd(h,N,Y));let G=h[2],Q=[];for(let Y=0;Y<G.length;Y+=1)Q[Y]=ld(ad(h,G,Y));const te=Y=>it(Q[Y],1,1,()=>{Q[Y]=null});let le=h[2],he=[];for(let Y=0;Y<le.length;Y+=1)he[Y]=ud(nd(h,le,Y));return{c(){l=qe("div"),c=qe("div"),p=vt();for(let Y=0;Y<O.length;Y+=1)O[Y].c();y=vt(),v=qe("div"),w=qe("div"),a=vt();for(let Y=0;Y<Q.length;Y+=1)Q[Y].c();k=vt(),T=qe("div"),D=qe("div"),M=vt();for(let Y=0;Y<he.length;Y+=1)he[Y].c();this.h()},l(Y){l=Ge(Y,"DIV",{class:!0});var _e=me(l);c=Ge(_e,"DIV",{class:!0,style:!0});var re=me(c);re.forEach(W),p=xt(_e);for(let Te=0;Te<O.length;Te+=1)O[Te].l(_e);_e.forEach(W),y=xt(Y),v=Ge(Y,"DIV",{class:!0});var we=me(v);w=Ge(we,"DIV",{class:!0,style:!0});var Le=me(w);Le.forEach(W),a=xt(we);for(let Te=0;Te<Q.length;Te+=1)Q[Te].l(we);we.forEach(W),k=xt(Y),T=Ge(Y,"DIV",{class:!0});var de=me(T);D=Ge(de,"DIV",{class:!0,style:!0});var be=me(D);be.forEach(W),M=xt(de);for(let Te=0;Te<he.length;Te+=1)he[Te].l(de);de.forEach(W),this.h()},h(){S(c,"class","areasColumn svelte-15wb3yy"),S(c,"style","width: 200px"),S(l,"class","row headerRow svelte-15wb3yy"),S(w,"class","areasColumn svelte-15wb3yy"),S(w,"style","width: 200px"),S(v,"class","row headerRow svelte-15wb3yy"),S(D,"class","areasColumn svelte-15wb3yy"),S(D,"style","width: 200px"),S(T,"class","row headerRow svelte-15wb3yy")},m(Y,_e){Ze(Y,l,_e),se(l,c),se(l,p);for(let re=0;re<O.length;re+=1)O[re]&&O[re].m(l,null);Ze(Y,y,_e),Ze(Y,v,_e),se(v,w),se(v,a);for(let re=0;re<Q.length;re+=1)Q[re]&&Q[re].m(v,null);Ze(Y,k,_e),Ze(Y,T,_e),se(T,D),se(T,M);for(let re=0;re<he.length;re+=1)he[re]&&he[re].m(T,null);A=!0},p(Y,[_e]){if(_e&4){N=Y[2];let re;for(re=0;re<N.length;re+=1){const we=sd(Y,N,re);O[re]?O[re].p(we,_e):(O[re]=od(we),O[re].c(),O[re].m(l,null))}for(;re<O.length;re+=1)O[re].d(1);O.length=N.length}if(_e&4){const re=G.length;G=Y[2];let we;for(we=re;we<G.length;we+=1)ad(Y,G,we),Q[we]?We(Q[we],1):(Q[we]=ld(),Q[we].c(),We(Q[we],1),Q[we].m(v,null));for(vr(),we=G.length;we<Q.length;we+=1)te(we);xr()}if(_e&15){le=Y[2];let re;for(re=0;re<le.length;re+=1){const we=nd(Y,le,re);he[re]?he[re].p(we,_e):(he[re]=ud(we),he[re].c(),he[re].m(T,null))}for(;re<he.length;re+=1)he[re].d(1);he.length=le.length}},i(Y){if(!A){for(let _e=0;_e<G.length;_e+=1)We(Q[_e]);A=!0}},o(Y){Q=Q.filter(Boolean);for(let _e=0;_e<Q.length;_e+=1)it(Q[_e]);A=!1},d(Y){Y&&W(l),Gi(O,Y),Y&&W(y),Y&&W(v),Gi(Q,Y),Y&&W(k),Y&&W(T),Gi(he,Y)}}}function kg(h,l,c){let{chosenId2:p,chosenId3:y,indicatorsCalculations:v}=l,w=mi("periodsLookup");const a=(T,D)=>D.xDomainNumb==T.maxXDomain,k=(T,D)=>D.xDomainNumb==T.minXDomain;return h.$$set=T=>{"chosenId2"in T&&c(0,p=T.chosenId2),"chosenId3"in T&&c(1,y=T.chosenId3),"indicatorsCalculations"in T&&c(2,v=T.indicatorsCalculations)},[p,y,v,w,a,k]}let Ig=class extends di{constructor(l){super(),fi(this,l,kg,wg,pi,{chosenId2:0,chosenId3:1,indicatorsCalculations:2})}};function hd(h,l,c){const p=h.slice();return p[9]=l[c],p[11]=c,p}function dd(h){let l,c;return l=new xg({props:{row:h[9],j:h[11],chosenId1:h[3],chosenId2:h[4],chosenId3:h[5],indicatorsCalculations:h[7],indicatorsMetadata:h[6],initialData:h[1],latestData:h[0]}}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p(p,y){const v={};y&4&&(v.row=p[9]),y&8&&(v.chosenId1=p[3]),y&16&&(v.chosenId2=p[4]),y&32&&(v.chosenId3=p[5]),y&2&&(v.initialData=p[1]),y&1&&(v.latestData=p[0]),l.$set(v)},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function Eg(h){let l,c,p,y;c=new Ig({props:{indicatorsCalculations:h[7],chosenId2:h[4],chosenId3:h[5]}});let v=h[2],w=[];for(let k=0;k<v.length;k+=1)w[k]=dd(hd(h,v,k));const a=k=>it(w[k],1,1,()=>{w[k]=null});return{c(){l=qe("div"),Vt(c.$$.fragment),p=vt();for(let k=0;k<w.length;k+=1)w[k].c();this.h()},l(k){l=Ge(k,"DIV",{class:!0});var T=me(l);Ut(c.$$.fragment,T),p=xt(T);for(let D=0;D<w.length;D+=1)w[D].l(T);T.forEach(W),this.h()},h(){S(l,"class","grid-container svelte-k2j273")},m(k,T){Ze(k,l,T),Nt(c,l,null),se(l,p);for(let D=0;D<w.length;D+=1)w[D]&&w[D].m(l,null);y=!0},p(k,[T]){const D={};if(T&16&&(D.chosenId2=k[4]),T&32&&(D.chosenId3=k[5]),c.$set(D),T&255){v=k[2];let M;for(M=0;M<v.length;M+=1){const A=hd(k,v,M);w[M]?(w[M].p(A,T),We(w[M],1)):(w[M]=dd(A),w[M].c(),We(w[M],1),w[M].m(l,null))}for(vr(),M=v.length;M<w.length;M+=1)a(M);xr()}},i(k){if(!y){We(c.$$.fragment,k);for(let T=0;T<v.length;T+=1)We(w[T]);y=!0}},o(k){it(c.$$.fragment,k),w=w.filter(Boolean);for(let T=0;T<w.length;T+=1)it(w[T]);y=!1},d(k){k&&W(l),qt(c),Gi(w,k)}}}function Tg(h,l,c){let{indicatorsList:p,latestData:y,initialData:v,selectedAreas:w,chosenId1:a,chosenId2:k,chosenId3:T}=l,D=mi("indicatorsMetadata"),M=mi("indicatorsCalculations").filter(A=>p.includes(A.id));return M.forEach((A,N)=>{A.medianValue=A.ltCount>200?A.ltMedian:A.utCount>140?A.utMedian:A.ukValue!="NA"?A.ukValue:A.gbValue!="NA"?A.gbValue:A.ewValue!="NA"?A.ewValue:A.engValue!="NA"?A.engValue:null,A.label=D.find(O=>O.code==A.code).label}),h.$$set=A=>{"indicatorsList"in A&&c(8,p=A.indicatorsList),"latestData"in A&&c(0,y=A.latestData),"initialData"in A&&c(1,v=A.initialData),"selectedAreas"in A&&c(2,w=A.selectedAreas),"chosenId1"in A&&c(3,a=A.chosenId1),"chosenId2"in A&&c(4,k=A.chosenId2),"chosenId3"in A&&c(5,T=A.chosenId3)},h.$$.update=()=>{h.$$.dirty&4&&console.log(w)},[y,v,w,a,k,T,D,M,p]}let Sg=class extends di{constructor(l){super(),fi(this,l,Tg,Eg,pi,{indicatorsList:8,latestData:0,initialData:1,selectedAreas:2,chosenId1:3,chosenId2:4,chosenId3:5})}};function Ag(h){let l,c,p,y,v,w,a,k,T;function D(te){h[39](te)}function M(te){h[40](te)}function A(te){h[41](te)}function N(te){h[42](te)}function O(te){h[43](te)}function G(te){h[44](te)}let Q={id:h[2],container:h[3],items:h[4],placeholder:h[5],isMulti:h[10],isSearchable:h[6],groupBy:h[22],loadOptions:h[9],getSelectionLabel:h[12],getOptionLabel:h[21],itemFilter:h[19],ariaValues:h[25],ariaListOpen:h[26],ariaFocused:h[27],noOptionsMessage:h[20],indicatorSvg:h[23],containerStyles:h[24],optionIdentifier:h[8],showIndicator:!0,isClearable:h[7]?!h[10]:!1};return h[15]!==void 0&&(Q.isFocused=h[15]),h[0]!==void 0&&(Q.value=h[0]),h[16]!==void 0&&(Q.listOpen=h[16]),h[1]!==void 0&&(Q.filterText=h[1]),h[13]!==void 0&&(Q.isWaiting=h[13]),h[17]!==void 0&&(Q.handleClear=h[17]),c=new Ym({props:Q}),gi.push(()=>bi(c,"isFocused",D)),gi.push(()=>bi(c,"value",M)),gi.push(()=>bi(c,"listOpen",A)),gi.push(()=>bi(c,"filterText",N)),gi.push(()=>bi(c,"isWaiting",O)),gi.push(()=>bi(c,"handleClear",G)),c.$on("select",h[28]),c.$on("clear",h[45]),c.$on("loaded",h[46]),c.$on("error",h[47]),{c(){l=qe("div"),Vt(c.$$.fragment),this.h()},l(te){l=Ge(te,"DIV",{class:!0});var le=me(l);Ut(c.$$.fragment,le),le.forEach(W),this.h()},h(){S(l,"class","selectbox svelte-gskmgd"),Ls(l,"multi-selected",h[0]&&h[10]),Ls(l,"focused",h[15]),Ls(l,"selected",h[0]&&!h[16]&&!h[10]),Bt(l,"--borderColor",h[11]),Bt(l,"--firstItem",h[18](0)),Bt(l,"--secondItem",h[18](1)),Bt(l,"--thirdItem",h[18](2)),Bt(l,"--fourthItem",h[18](3)),Bt(l,"--fifthItem",h[18](4)),Bt(l,"--sixthItem",h[18](5)),Bt(l,"--seventhItem",h[18](6)),Bt(l,"--eighthItem",h[18](7)),Bt(l,"--ninethItem",h[18](8)),Bt(l,"--tenthItem",h[18](9))},m(te,le){Ze(te,l,le),Nt(c,l,null),h[48](l),T=!0},p(te,le){const he={};le[0]&4&&(he.id=te[2]),le[0]&8&&(he.container=te[3]),le[0]&16&&(he.items=te[4]),le[0]&32&&(he.placeholder=te[5]),le[0]&1024&&(he.isMulti=te[10]),le[0]&64&&(he.isSearchable=te[6]),le[0]&512&&(he.loadOptions=te[9]),le[0]&4096&&(he.getSelectionLabel=te[12]),le[0]&524288&&(he.itemFilter=te[19]),le[0]&1048576&&(he.noOptionsMessage=te[20]),le[0]&256&&(he.optionIdentifier=te[8]),le[0]&1152&&(he.isClearable=te[7]?!te[10]:!1),!p&&le[0]&32768&&(p=!0,he.isFocused=te[15],wi(()=>p=!1)),!y&&le[0]&1&&(y=!0,he.value=te[0],wi(()=>y=!1)),!v&&le[0]&65536&&(v=!0,he.listOpen=te[16],wi(()=>v=!1)),!w&&le[0]&2&&(w=!0,he.filterText=te[1],wi(()=>w=!1)),!a&&le[0]&8192&&(a=!0,he.isWaiting=te[13],wi(()=>a=!1)),!k&&le[0]&131072&&(k=!0,he.handleClear=te[17],wi(()=>k=!1)),c.$set(he),(!T||le[0]&1025)&&Ls(l,"multi-selected",te[0]&&te[10]),(!T||le[0]&32768)&&Ls(l,"focused",te[15]),(!T||le[0]&66561)&&Ls(l,"selected",te[0]&&!te[16]&&!te[10]),le[0]&2048&&Bt(l,"--borderColor",te[11]),le[0]&262144&&Bt(l,"--firstItem",te[18](0)),le[0]&262144&&Bt(l,"--secondItem",te[18](1)),le[0]&262144&&Bt(l,"--thirdItem",te[18](2)),le[0]&262144&&Bt(l,"--fourthItem",te[18](3)),le[0]&262144&&Bt(l,"--fifthItem",te[18](4)),le[0]&262144&&Bt(l,"--sixthItem",te[18](5)),le[0]&262144&&Bt(l,"--seventhItem",te[18](6)),le[0]&262144&&Bt(l,"--eighthItem",te[18](7)),le[0]&262144&&Bt(l,"--ninethItem",te[18](8)),le[0]&262144&&Bt(l,"--tenthItem",te[18](9))},i(te){T||(We(c.$$.fragment,te),T=!0)},o(te){it(c.$$.fragment,te),T=!1},d(te){te&&W(l),qt(c),h[48](null)}}}function Dg(h,l,c){let p,y,v;const w='<svg viewBox="0 0 20 20" fill-rule="evenodd"><path d="M0,8a8,8,0,1,0,16,0a8,8,0,1,0,-16,0ZM3,8a5,5,0,1,0,10,0a5,5,0,1,0,-10,0Z"/><path d="M18,20L20,18L14,12L12,14Z"/></svg>',a='<svg viewBox="0 0 20 20"><path d="M1,6L19,6L10,15Z"/></svg>',k=_u();let{id:T=""}=l,{container:D=void 0}=l,{mode:M="default"}=l,{items:A}=l,{placeholder:N="Select one..."}=l,{value:O=null}=l,{filterText:G=""}=l,{isSearchable:Q=!0}=l,{isClearable:te=!0}=l,{autoClear:le=!1}=l,{idKey:he="value"}=l,{labelKey:Y="label"}=l,{groupKey:_e=null}=l,{groupItems:re=!1}=l,{loadOptions:we=void 0}=l,{fontSize:Le="1em"}=l,{height:de=42}=l,{isMulti:be=!1}=l,{maxSelected:Te=4}=l,{colors:Ce=["#206095","#a8bd3a","#871a5b","#27a0cc"]}=l,{darkMode:rt=!1}=l,{borderColor:nt=rt?"white":"#206095"}=l;const Ve=_e&&!re?$e=>`${$e[Y]} <span class="group">${$e[_e]}</span>`:$e=>$e[Y];let{getSelectionLabel:Ue=$e=>$e?Ve($e):null}=l;const Oe=re&&_e?$e=>$e[_e]:void 0,et=M=="search"?w:a,tt=`--inputFontSize: ${Le}; --groupTitleFontSize: ${Le}; --height: ${de}px; font-size: ${Le};`,ft=$e=>`${$e}, selected.`,Gt=($e,Xi)=>`You are currently focused on ${$e}. There are ${Xi} results available.`,zt=()=>"Select is focused, type to refine list, press down to open the menu.";let Ke,Tt,Ct,ti,hi;const _i=$e=>new Promise(Xi=>setTimeout(Xi,$e));async function Ye($e){if(k("select",$e.detail),le)hi();else if(te){await _i(10);let Xi=Ke.getElementsByClassName("clearSelect")[0];Xi&&(Xi.tabIndex=0,Xi.onkeypress=Mr=>{Mr.key=="Enter"&&hi()},Xi.removeAttribute("aria-hidden"),Xi.setAttribute("aria-label","Clear selection"))}}function Zt($e){Tt=$e,c(15,Tt)}function He($e){O=$e,c(0,O)}function ii($e){Ct=$e,c(16,Ct)}function Ri($e){G=$e,c(1,G)}function br($e){ti=$e,c(13,ti)}function Hi($e){hi=$e,c(17,hi)}function Kr($e){Uo.call(this,h,$e)}function Jr($e){Uo.call(this,h,$e)}function Yr($e){Uo.call(this,h,$e)}function ai($e){gi[$e?"unshift":"push"](()=>{Ke=$e,c(14,Ke)})}return h.$$set=$e=>{"id"in $e&&c(2,T=$e.id),"container"in $e&&c(3,D=$e.container),"mode"in $e&&c(29,M=$e.mode),"items"in $e&&c(4,A=$e.items),"placeholder"in $e&&c(5,N=$e.placeholder),"value"in $e&&c(0,O=$e.value),"filterText"in $e&&c(1,G=$e.filterText),"isSearchable"in $e&&c(6,Q=$e.isSearchable),"isClearable"in $e&&c(7,te=$e.isClearable),"autoClear"in $e&&c(30,le=$e.autoClear),"idKey"in $e&&c(8,he=$e.idKey),"labelKey"in $e&&c(31,Y=$e.labelKey),"groupKey"in $e&&c(32,_e=$e.groupKey),"groupItems"in $e&&c(33,re=$e.groupItems),"loadOptions"in $e&&c(9,we=$e.loadOptions),"fontSize"in $e&&c(34,Le=$e.fontSize),"height"in $e&&c(35,de=$e.height),"isMulti"in $e&&c(10,be=$e.isMulti),"maxSelected"in $e&&c(36,Te=$e.maxSelected),"colors"in $e&&c(37,Ce=$e.colors),"darkMode"in $e&&c(38,rt=$e.darkMode),"borderColor"in $e&&c(11,nt=$e.borderColor),"getSelectionLabel"in $e&&c(12,Ue=$e.getSelectionLabel)},h.$$.update=()=>{h.$$.dirty[0]&536879106&&c(20,p=ti?"Loading...":M=="search"&&G.length<3?"Enter 3 or more characters for suggestions":`No results match ${G}`),h.$$.dirty[0]&536870915|h.$$.dirty[1]&33&&c(19,y=Array.isArray(O)&&O.length>=Te||M=="search"&&G.length<3?($e,Xi,Mr)=>!1:($e,Xi,Mr)=>`${Mr[Y]}`.match(new RegExp(`\\b${Xi}`,"i"))),h.$$.dirty[1]&64&&c(18,v=$e=>Ce[$e%Ce.length])},[O,G,T,D,A,N,Q,te,he,we,be,nt,Ue,ti,Ke,Tt,Ct,hi,v,y,p,Ve,Oe,et,tt,ft,Gt,zt,Ye,M,le,Y,_e,re,Le,de,Te,Ce,rt,Zt,He,ii,Ri,br,Hi,Kr,Jr,Yr,ai]}class Cg extends di{constructor(l){super(),fi(this,l,Dg,Ag,pi,{id:2,container:3,mode:29,items:4,placeholder:5,value:0,filterText:1,isSearchable:6,isClearable:7,autoClear:30,idKey:8,labelKey:31,groupKey:32,groupItems:33,loadOptions:9,fontSize:34,height:35,isMulti:10,maxSelected:36,colors:37,darkMode:38,borderColor:11,getSelectionLabel:12},null,[-1,-1])}}function zg(h){let l,c,p,y;function v(a){h[5](a)}let w={id:"multi",idKey:"areacd",labelKey:"areanm",groupKey:"parentnm",items:h[2],isMulti:!0,maxSelected:h[1].length,placeholder:"Select areas",colors:h[1]};return h[0].custom!==void 0&&(w.value=h[0].custom),c=new Cg({props:w}),gi.push(()=>bi(c,"value",v)),c.$on("select",h[3]),{c(){l=qe("form"),Vt(c.$$.fragment),this.h()},l(a){l=Ge(a,"FORM",{class:!0});var k=me(l);Ut(c.$$.fragment,k),k.forEach(W),this.h()},h(){S(l,"class","svelte-gcqbil")},m(a,k){Ze(a,l,k),Nt(c,l,null),y=!0},p(a,[k]){const T={};k&2&&(T.maxSelected=a[1].length),k&2&&(T.colors=a[1]),!p&&k&1&&(p=!0,T.value=a[0].custom,wi(()=>p=!1)),c.$set(T)},i(a){y||(We(c.$$.fragment,a),y=!0)},o(a){it(c.$$.fragment,a),y=!1},d(a){a&&W(l),qt(c)}}}function Mg(h,l,c){let{areasWithData:p,checkboxedRoles:y,colors:v=4}=l,w=mi("areasParentsLookup"),a=mi("areas"),k=w.filter(M=>p.includes(M.areacd));k.forEach(M=>{M.areanm=a.find(A=>A.areacd===M.areacd).areanm,M.parentnm=a.find(A=>M.parentcd===A.areacd)===void 0?"":a.find(A=>M.parentcd===A.areacd).areanm});function T(M){M.detail&&M.detail}function D(M){h.$$.not_equal(y.custom,M)&&(y.custom=M,c(0,y))}return h.$$set=M=>{"areasWithData"in M&&c(4,p=M.areasWithData),"checkboxedRoles"in M&&c(0,y=M.checkboxedRoles),"colors"in M&&c(1,v=M.colors)},[y,v,k,T,p,D]}class Tf extends di{constructor(l){super(),fi(this,l,Mg,zg,pi,{areasWithData:4,checkboxedRoles:0,colors:1})}}function fd(h){let l,c,p,y;function v(a){h[7](a)}let w={areasWithData:h[4],colors:Array.from({length:8},Lg)};return h[0]!==void 0&&(w.checkboxedRoles=h[0]),c=new Tf({props:w}),gi.push(()=>bi(c,"checkboxedRoles",v)),{c(){l=qe("div"),Vt(c.$$.fragment),this.h()},l(a){l=Ge(a,"DIV",{class:!0});var k=me(l);Ut(c.$$.fragment,k),k.forEach(W),this.h()},h(){S(l,"class","select-areas-container")},m(a,k){Ze(a,l,k),Nt(c,l,null),y=!0},p(a,k){const T={};!p&&k&1&&(p=!0,T.checkboxedRoles=a[0],wi(()=>p=!1)),c.$set(T)},i(a){y||(We(c.$$.fragment,a),y=!0)},o(a){it(c.$$.fragment,a),y=!1},d(a){a&&W(l),qt(c)}}}function Pg(h){let l,c,p,y,v;function w(T){h[6](T)}let a={optionsArray:h[3],name:h[2]};h[1]!==void 0&&(a.chosenId=h[1]),c=new qo({props:a}),gi.push(()=>bi(c,"chosenId",w));let k=h[1]===1&&fd(h);return{c(){l=qe("div"),Vt(c.$$.fragment),y=vt(),k&&k.c(),this.h()},l(T){l=Ge(T,"DIV",{class:!0});var D=me(l);Ut(c.$$.fragment,D),y=xt(D),k&&k.l(D),D.forEach(W),this.h()},h(){S(l,"class","selection-box-container svelte-ycbie2")},m(T,D){Ze(T,l,D),Nt(c,l,null),se(l,y),k&&k.m(l,null),v=!0},p(T,[D]){const M={};D&4&&(M.name=T[2]),!p&&D&2&&(p=!0,M.chosenId=T[1],wi(()=>p=!1)),c.$set(M),T[1]===1?k?(k.p(T,D),D&2&&We(k,1)):(k=fd(T),k.c(),We(k,1),k.m(l,null)):k&&(vr(),it(k,1,1,()=>{k=null}),xr())},i(T){v||(We(c.$$.fragment,T),We(k),v=!0)},o(T){it(c.$$.fragment,T),it(k),v=!1},d(T){T&&W(l),qt(c),k&&k.d()}}}const Lg=()=>"#003C57";function Rg(h,l,c){let{latestData:p,checkboxedRoles:y,chosenId:v,radioName:w}=l,a=["Compare countries and regions of the UK","Select local areas of interest"],k=[...new Set(p.map(M=>M.areacd))];function T(M){v=M,c(1,v)}function D(M){y=M,c(0,y)}return h.$$set=M=>{"latestData"in M&&c(5,p=M.latestData),"checkboxedRoles"in M&&c(0,y=M.checkboxedRoles),"chosenId"in M&&c(1,v=M.chosenId),"radioName"in M&&c(2,w=M.radioName)},[y,v,w,a,k,p,T,D]}class Eu extends di{constructor(l){super(),fi(this,l,Rg,Pg,pi,{latestData:5,checkboxedRoles:0,chosenId:1,radioName:2})}}function pd(h,l,c){const p=h.slice();return p[1]=l[c],p[3]=c,p}function md(h,l,c){const p=h.slice();return p[4]=l[c],p[6]=c,p}function gd(h){let l,c;return{c(){l=ct("rect"),this.h()},l(p){l=ut(p,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,stroke:!0,fill:!0,opacity:!0}),me(l).forEach(W),this.h()},h(){S(l,"transform","translate("+(h[3]==0?-1:h[3]==2?1:0)+","+(h[6]==0?-1:h[6]==2?1:0)+")"),S(l,"x",h[3]*40),S(l,"y",h[6]*40),S(l,"width","40"),S(l,"height","40"),S(l,"stroke","none"),S(l,"fill",c=Ta[h[1]][h[4]]),S(l,"opacity","1")},m(p,y){Ze(p,l,y)},p(p,y){y&1&&c!==(c=Ta[p[1]][p[4]])&&S(l,"fill",c)},d(p){p&&W(l)}}}function _d(h){let l,c=h[0]==1?["similar"]:["better than average","similar","worse than average"],p=[];for(let y=0;y<c.length;y+=1)p[y]=gd(md(h,c,y));return{c(){for(let y=0;y<p.length;y+=1)p[y].c();l=ur()},l(y){for(let v=0;v<p.length;v+=1)p[v].l(y);l=ur()},m(y,v){for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(y,v);Ze(y,l,v)},p(y,v){if(v&1){c=y[0]==1?["similar"]:["better than average","similar","worse than average"];let w;for(w=0;w<c.length;w+=1){const a=md(y,c,w);p[w]?p[w].p(a,v):(p[w]=gd(a),p[w].c(),p[w].m(l.parentNode,l))}for(;w<p.length;w+=1)p[w].d(1);p.length=c.length}},d(y){Gi(p,y),y&&W(l)}}}function yd(h){let l,c,p,y,v,w,a,k,T,D,M;return{c(){l=ct("line"),c=ct("path"),p=ct("path"),y=ct("text"),v=Mt("better than"),w=ct("text"),a=Mt("average"),k=ct("text"),T=Mt("worse than"),D=ct("text"),M=Mt("average"),this.h()},l(A){l=ut(A,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),me(l).forEach(W),c=ut(A,"path",{d:!0,stroke:!0,fill:!0}),me(c).forEach(W),p=ut(A,"path",{d:!0,stroke:!0,fill:!0}),me(p).forEach(W),y=ut(A,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var N=me(y);v=Pt(N,"better than"),N.forEach(W),w=ut(A,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var O=me(w);a=Pt(O,"average"),O.forEach(W),k=ut(A,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var G=me(k);T=Pt(G,"worse than"),G.forEach(W),D=ut(A,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Q=me(D);M=Pt(Q,"average"),Q.forEach(W),this.h()},h(){S(l,"x1","-20"),S(l,"x2","-20"),S(l,"y1","10"),S(l,"y2","110"),S(l,"stroke","black"),S(l,"stroke-width","2px"),S(c,"d","M-20 5 l5 5 l-10 0 z"),S(c,"stroke","none"),S(c,"fill","black"),S(p,"d","M-20 115 l5 -5 l-10 0 z"),S(p,"stroke","none"),S(p,"fill","black"),S(y,"x","-30"),S(y,"y","10"),S(y,"text-anchor","end"),S(y,"font-size","14px"),S(y,"stroke-width","0.25px"),S(y,"stroke","black"),S(y,"fill","black"),S(w,"x","-30"),S(w,"y","24"),S(w,"text-anchor","end"),S(w,"font-size","14px"),S(w,"stroke-width","0.25px"),S(w,"stroke","black"),S(w,"fill","black"),S(k,"x","-30"),S(k,"y","110"),S(k,"text-anchor","end"),S(k,"font-size","14px"),S(k,"stroke-width","0.25px"),S(k,"stroke","black"),S(k,"fill","black"),S(D,"x","-30"),S(D,"y","124"),S(D,"text-anchor","end"),S(D,"font-size","14px"),S(D,"stroke-width","0.25px"),S(D,"stroke","black"),S(D,"fill","black")},m(A,N){Ze(A,l,N),Ze(A,c,N),Ze(A,p,N),Ze(A,y,N),se(y,v),Ze(A,w,N),se(w,a),Ze(A,k,N),se(k,T),Ze(A,D,N),se(D,M)},d(A){A&&W(l),A&&W(c),A&&W(p),A&&W(y),A&&W(w),A&&W(k),A&&W(D)}}}function vd(h){let l,c,p,y,v,w,a,k,T;return{c(){l=ct("g"),c=ct("line"),p=ct("path"),y=ct("path"),v=ct("text"),w=Mt("worsening"),a=ct("text"),k=Mt("improving"),this.h()},l(D){l=ut(D,"g",{transform:!0});var M=me(l);c=ut(M,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0}),me(c).forEach(W),p=ut(M,"path",{d:!0,stroke:!0,fill:!0}),me(p).forEach(W),y=ut(M,"path",{d:!0,stroke:!0,fill:!0}),me(y).forEach(W),v=ut(M,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var A=me(v);w=Pt(A,"worsening"),A.forEach(W),a=ut(M,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var N=me(a);k=Pt(N,"improving"),N.forEach(W),M.forEach(W),this.h()},h(){S(c,"y1","140"),S(c,"y2","140"),S(c,"x1","10"),S(c,"x2","110"),S(c,"stroke","black"),S(c,"stroke-width","2px"),S(p,"d","M5 140 l5 -5 l0 10 z"),S(p,"stroke","none"),S(p,"fill","black"),S(y,"d","M115 140 l-5 -5 l0 10 z"),S(y,"stroke","none"),S(y,"fill","black"),S(v,"x","-5"),S(v,"y","160"),S(v,"text-anchor","middle"),S(v,"font-size","14px"),S(v,"stroke-width","0.25px"),S(v,"stroke","black"),S(v,"fill","black"),S(a,"x","110"),S(a,"y","160"),S(a,"text-anchor","middle"),S(a,"font-size","14px"),S(a,"stroke-width","0.25px"),S(a,"stroke","black"),S(a,"fill","black"),S(l,"transform",T=h[0]==2?null:"translate(0, -80)")},m(D,M){Ze(D,l,M),se(l,c),se(l,p),se(l,y),se(l,v),se(v,w),se(l,a),se(a,k)},p(D,M){M&1&&T!==(T=D[0]==2?null:"translate(0, -80)")&&S(l,"transform",T)},d(D){D&&W(l)}}}function Bg(h){let l,c,p,y,v,w,a,k=h[0]==0?["similar"]:["worsening","similar","improving"],T=[];for(let A=0;A<k.length;A+=1)T[A]=_d(pd(h,k,A));let D=h[0]!=1&&yd(),M=h[0]!=0&&vd(h);return{c(){l=ct("svg"),c=ct("g");for(let A=0;A<T.length;A+=1)T[A].c();p=ur(),D&&D.c(),y=ur(),M&&M.c(),this.h()},l(A){l=ut(A,"svg",{width:!0,height:!0,class:!0});var N=me(l);c=ut(N,"g",{transform:!0});var O=me(c);for(let G=0;G<T.length;G+=1)T[G].l(O);p=ur(),D&&D.l(O),y=ur(),M&&M.l(O),O.forEach(W),N.forEach(W),this.h()},h(){S(c,"transform",v="translate("+(h[0]==1?60:120)+",20)"),S(l,"width",w=h[0]==2?280:h[0]==1?220:190),S(l,"height",a=h[0]==2?200:h[0]==1?120:165),S(l,"class","svelte-5r2hj0")},m(A,N){Ze(A,l,N),se(l,c);for(let O=0;O<T.length;O+=1)T[O]&&T[O].m(c,null);se(c,p),D&&D.m(c,null),se(c,y),M&&M.m(c,null)},p(A,[N]){if(N&1){k=A[0]==0?["similar"]:["worsening","similar","improving"];let O;for(O=0;O<k.length;O+=1){const G=pd(A,k,O);T[O]?T[O].p(G,N):(T[O]=_d(G),T[O].c(),T[O].m(c,p))}for(;O<T.length;O+=1)T[O].d(1);T.length=k.length}A[0]!=1?D||(D=yd(),D.c(),D.m(c,y)):D&&(D.d(1),D=null),A[0]!=0?M?M.p(A,N):(M=vd(A),M.c(),M.m(c,null)):M&&(M.d(1),M=null),N&1&&v!==(v="translate("+(A[0]==1?60:120)+",20)")&&S(c,"transform",v),N&1&&w!==(w=A[0]==2?280:A[0]==1?220:190)&&S(l,"width",w),N&1&&a!==(a=A[0]==2?200:A[0]==1?120:165)&&S(l,"height",a)},i:zi,o:zi,d(A){A&&W(l),Gi(T,A),D&&D.d(),M&&M.d()}}}function Fg(h,l,c){let{chosenId:p}=l;return h.$$set=y=>{"chosenId"in y&&c(0,p=y.chosenId)},[p]}let Og=class extends di{constructor(l){super(),fi(this,l,Fg,Bg,pi,{chosenId:0})}};function xd(h,l,c){const p=h.slice();return p[7]=l[c],p[9]=c,p}function bd(h){let l,c,p,y,v=h[7]+"",w,a,k,T,D;return k=Lm(h[6][0]),{c(){l=qe("label"),c=qe("input"),p=vt(),y=qe("p"),w=Mt(v),a=vt(),this.h()},l(M){l=Ge(M,"LABEL",{style:!0,class:!0});var A=me(l);c=Ge(A,"INPUT",{type:!0,name:!0}),p=xt(A),y=Ge(A,"P",{style:!0,class:!0});var N=me(y);w=Pt(N,v),N.forEach(W),a=xt(A),A.forEach(W),this.h()},h(){S(c,"type","checkbox"),c.__value=h[9],c.value=c.__value,S(c,"name",h[2]),Bt(y,"font-size",h[4]),S(y,"class","svelte-5ds7v7"),Bt(l,"margin-bottom",h[3]),S(l,"class","svelte-5ds7v7"),k.p(c)},m(M,A){Ze(M,l,A),se(l,c),c.checked=~(h[0]||[]).indexOf(c.__value),se(l,p),se(l,y),se(y,w),se(l,a),T||(D=wf(c,"change",h[5]),T=!0)},p(M,A){A&4&&S(c,"name",M[2]),A&3&&(c.checked=~(M[0]||[]).indexOf(c.__value)),A&2&&v!==(v=M[7]+"")&&$i(w,v),A&16&&Bt(y,"font-size",M[4]),A&8&&Bt(l,"margin-bottom",M[3])},d(M){M&&W(l),k.r(),T=!1,D()}}}function Vg(h){let l,c=h[1],p=[];for(let y=0;y<c.length;y+=1)p[y]=bd(xd(h,c,y));return{c(){l=qe("div");for(let y=0;y<p.length;y+=1)p[y].c();this.h()},l(y){l=Ge(y,"DIV",{class:!0});var v=me(l);for(let w=0;w<p.length;w+=1)p[w].l(v);v.forEach(W),this.h()},h(){S(l,"class","radio-container svelte-5ds7v7")},m(y,v){Ze(y,l,v);for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(l,null)},p(y,[v]){if(v&31){c=y[1];let w;for(w=0;w<c.length;w+=1){const a=xd(y,c,w);p[w]?p[w].p(a,v):(p[w]=bd(a),p[w].c(),p[w].m(l,null))}for(;w<p.length;w+=1)p[w].d(1);p.length=c.length}},i:zi,o:zi,d(y){y&&W(l),Gi(p,y)}}}function Ug(h,l,c){let{optionsArray:p,chosenId:y,name:v,marginBottom:w=null,fontSize:a=null}=l;const k=[[]];function T(){y=Rm(k[0],this.__value,this.checked),c(0,y)}return h.$$set=D=>{"optionsArray"in D&&c(1,p=D.optionsArray),"chosenId"in D&&c(0,y=D.chosenId),"name"in D&&c(2,v=D.name),"marginBottom"in D&&c(3,w=D.marginBottom),"fontSize"in D&&c(4,a=D.fontSize)},[y,p,v,w,a,T,k]}class Ng extends di{constructor(l){super(),fi(this,l,Ug,Vg,pi,{optionsArray:1,chosenId:0,name:2,marginBottom:3,fontSize:4})}}function qg(h){let l,c,p,y,v,w,a,k,T,D,M,A,N,O,G,Q,te,le,he,Y,_e,re,we;function Le(Ve){h[8](Ve)}function de(Ve){h[9](Ve)}let be={radioName:"colouredBoxesRadio",latestData:h[2]};h[0]!==void 0&&(be.checkboxedRoles=h[0]),h[4]!==void 0&&(be.chosenId=h[4]),c=new Eu({props:be}),gi.push(()=>bi(c,"checkboxedRoles",Le)),gi.push(()=>bi(c,"chosenId",de));function Te(Ve){h[10](Ve)}let Ce={optionsArray:["Rank","Change over time","Both"],name:"dotPlotComparisonType",marginBottom:"0px",fontSize:"16px"};h[5]!==void 0&&(Ce.chosenId=h[5]),M=new qo({props:Ce}),gi.push(()=>bi(M,"chosenId",Te));function rt(Ve){h[11](Ve)}let nt={optionsArray:h[6].includes(0)?["For most recent year","For comparison year"]:["For most recent year"],name:"chosenComparison",marginBottom:"0px",fontSize:"16px"};return h[6]!==void 0&&(nt.chosenId=h[6]),te=new Ng({props:nt}),gi.push(()=>bi(te,"chosenId",rt)),Y=new Og({props:{chosenId:h[5]}}),re=new Sg({props:{indicatorsList:h[1],latestData:h[2],initialData:h[3],selectedAreas:h[7],chosenId1:h[4],chosenId2:h[5],chosenId3:h[6]}}),{c(){l=qe("div"),Vt(c.$$.fragment),v=vt(),w=qe("div"),a=qe("div"),k=qe("p"),T=Mt("Colour by:"),D=vt(),Vt(M.$$.fragment),N=vt(),O=qe("p"),G=Mt("Show labels:"),Q=vt(),Vt(te.$$.fragment),he=vt(),Vt(Y.$$.fragment),_e=vt(),Vt(re.$$.fragment),this.h()},l(Ve){l=Ge(Ve,"DIV",{class:!0});var Ue=me(l);Ut(c.$$.fragment,Ue),v=xt(Ue),w=Ge(Ue,"DIV",{class:!0});var Oe=me(w);a=Ge(Oe,"DIV",{class:!0});var et=me(a);k=Ge(et,"P",{class:!0});var tt=me(k);T=Pt(tt,"Colour by:"),tt.forEach(W),D=xt(et),Ut(M.$$.fragment,et),N=xt(et),O=Ge(et,"P",{style:!0,class:!0});var ft=me(O);G=Pt(ft,"Show labels:"),ft.forEach(W),Q=xt(et),Ut(te.$$.fragment,et),et.forEach(W),he=xt(Oe),Ut(Y.$$.fragment,Oe),Oe.forEach(W),_e=xt(Ue),Ut(re.$$.fragment,Ue),Ue.forEach(W),this.h()},h(){S(k,"class","svelte-rp9vsp"),Bt(O,"margin-top","12px"),S(O,"class","svelte-rp9vsp"),S(a,"class","selections-container svelte-rp9vsp"),S(w,"class","key-and-selections-container svelte-rp9vsp"),S(l,"class","key-indicators-coloured-boxes-option-1-container")},m(Ve,Ue){Ze(Ve,l,Ue),Nt(c,l,null),se(l,v),se(l,w),se(w,a),se(a,k),se(k,T),se(a,D),Nt(M,a,null),se(a,N),se(a,O),se(O,G),se(a,Q),Nt(te,a,null),se(w,he),Nt(Y,w,null),se(l,_e),Nt(re,l,null),we=!0},p(Ve,[Ue]){const Oe={};Ue&4&&(Oe.latestData=Ve[2]),!p&&Ue&1&&(p=!0,Oe.checkboxedRoles=Ve[0],wi(()=>p=!1)),!y&&Ue&16&&(y=!0,Oe.chosenId=Ve[4],wi(()=>y=!1)),c.$set(Oe);const et={};!A&&Ue&32&&(A=!0,et.chosenId=Ve[5],wi(()=>A=!1)),M.$set(et);const tt={};Ue&64&&(tt.optionsArray=Ve[6].includes(0)?["For most recent year","For comparison year"]:["For most recent year"]),!le&&Ue&64&&(le=!0,tt.chosenId=Ve[6],wi(()=>le=!1)),te.$set(tt);const ft={};Ue&32&&(ft.chosenId=Ve[5]),Y.$set(ft);const Gt={};Ue&2&&(Gt.indicatorsList=Ve[1]),Ue&4&&(Gt.latestData=Ve[2]),Ue&8&&(Gt.initialData=Ve[3]),Ue&128&&(Gt.selectedAreas=Ve[7]),Ue&16&&(Gt.chosenId1=Ve[4]),Ue&32&&(Gt.chosenId2=Ve[5]),Ue&64&&(Gt.chosenId3=Ve[6]),re.$set(Gt)},i(Ve){we||(We(c.$$.fragment,Ve),We(M.$$.fragment,Ve),We(te.$$.fragment,Ve),We(Y.$$.fragment,Ve),We(re.$$.fragment,Ve),we=!0)},o(Ve){it(c.$$.fragment,Ve),it(M.$$.fragment,Ve),it(te.$$.fragment,Ve),it(Y.$$.fragment,Ve),it(re.$$.fragment,Ve),we=!1},d(Ve){Ve&&W(l),qt(c),qt(M),qt(te),qt(Y),qt(re)}}}function Gg(h,l,c){let p,{indicatorsList:y,latestData:v,initialData:w,checkboxedRoles:a}=l,k=0,T=0,D=[0],A=mi("areasParentsLookup").filter(te=>["K02000001","E92000001"].includes(te.parentcd)&te.areacd!="E92000001");function N(te){a=te,c(0,a)}function O(te){k=te,c(4,k)}function G(te){T=te,c(5,T)}function Q(te){D=te,c(6,D)}return h.$$set=te=>{"indicatorsList"in te&&c(1,y=te.indicatorsList),"latestData"in te&&c(2,v=te.latestData),"initialData"in te&&c(3,w=te.initialData),"checkboxedRoles"in te&&c(0,a=te.checkboxedRoles)},h.$$.update=()=>{h.$$.dirty&17&&c(7,p=k===0?A:a.custom==null||a.custom==null?[]:a.custom)},[a,y,v,w,k,T,D,p,N,O,G,Q]}class jg extends di{constructor(l){super(),fi(this,l,Gg,qg,pi,{indicatorsList:1,latestData:2,initialData:3,checkboxedRoles:0})}}function wd(h,l,c){const p=h.slice();return p[0]=l[c],p[2]=c,p}function kd(h,l,c){const p=h.slice();return p[3]=l[c],p[5]=c,p}function Id(h){let l;return{c(){l=ct("rect"),this.h()},l(c){l=ut(c,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,stroke:!0,fill:!0,opacity:!0}),me(l).forEach(W),this.h()},h(){S(l,"transform","translate("+(h[2]==0?-1:h[2]==2?1:0)+","+(h[5]==0?-1:h[5]==2?1:0)+")"),S(l,"x",h[2]*60),S(l,"y",h[5]*60),S(l,"width","60"),S(l,"height","60"),S(l,"stroke","none"),S(l,"fill",Ta[h[0]][h[3]]),S(l,"opacity","0.5")},m(c,p){Ze(c,l,p)},p:zi,d(c){c&&W(l)}}}function Ed(h){let l,c=["better than average","worse than average"],p=[];for(let y=0;y<2;y+=1)p[y]=Id(kd(h,c,y));return{c(){for(let y=0;y<2;y+=1)p[y].c();l=ur()},l(y){for(let v=0;v<2;v+=1)p[v].l(y);l=ur()},m(y,v){for(let w=0;w<2;w+=1)p[w]&&p[w].m(y,v);Ze(y,l,v)},p(y,v){if(v&0){c=["better than average","worse than average"];let w;for(w=0;w<2;w+=1){const a=kd(y,c,w);p[w]?p[w].p(a,v):(p[w]=Id(a),p[w].c(),p[w].m(l.parentNode,l))}for(;w<2;w+=1)p[w].d(1)}},d(y){Gi(p,y),y&&W(l)}}}function Zg(h){let l,c,p,y,v,w,a,k,T,D,M,A,N,O,G,Q,te,le,he,Y,_e,re,we,Le,de,be,Te,Ce,rt,nt,Ve,Ue=["worsening","improving"],Oe=[];for(let et=0;et<2;et+=1)Oe[et]=Ed(wd(h,Ue,et));return{c(){l=ct("svg"),c=ct("g");for(let et=0;et<2;et+=1)Oe[et].c();p=ct("circle"),y=ct("circle"),v=ct("path"),w=ct("path"),a=ct("text"),k=Mt("A dot in this quadrant"),T=ct("text"),D=Mt("means the area is above"),M=ct("text"),A=Mt("average and improving."),N=ct("line"),O=ct("path"),G=ct("path"),Q=ct("text"),te=Mt("better than"),le=ct("text"),he=Mt("average"),Y=ct("text"),_e=Mt("worse than"),re=ct("text"),we=Mt("average"),Le=ct("g"),de=ct("line"),be=ct("path"),Te=ct("path"),Ce=ct("text"),rt=Mt("worsening"),nt=ct("text"),Ve=Mt("improving"),this.h()},l(et){l=ut(et,"svg",{width:!0,height:!0,class:!0});var tt=me(l);c=ut(tt,"g",{transform:!0});var ft=me(c);for(let He=0;He<2;He+=1)Oe[He].l(ft);p=ut(ft,"circle",{cy:!0,cx:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(p).forEach(W),y=ut(ft,"circle",{cy:!0,cx:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(y).forEach(W),v=ut(ft,"path",{transform:!0,d:!0,stroke:!0,fill:!0}),me(v).forEach(W),w=ut(ft,"path",{transform:!0,d:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(w).forEach(W),a=ut(ft,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Gt=me(a);k=Pt(Gt,"A dot in this quadrant"),Gt.forEach(W),T=ut(ft,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var zt=me(T);D=Pt(zt,"means the area is above"),zt.forEach(W),M=ut(ft,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Ke=me(M);A=Pt(Ke,"average and improving."),Ke.forEach(W),N=ut(ft,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),me(N).forEach(W),O=ut(ft,"path",{d:!0,stroke:!0,fill:!0}),me(O).forEach(W),G=ut(ft,"path",{d:!0,stroke:!0,fill:!0}),me(G).forEach(W),Q=ut(ft,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Tt=me(Q);te=Pt(Tt,"better than"),Tt.forEach(W),le=ut(ft,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Ct=me(le);he=Pt(Ct,"average"),Ct.forEach(W),Y=ut(ft,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var ti=me(Y);_e=Pt(ti,"worse than"),ti.forEach(W),re=ut(ft,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var hi=me(re);we=Pt(hi,"average"),hi.forEach(W),Le=ut(ft,"g",{});var _i=me(Le);de=ut(_i,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0}),me(de).forEach(W),be=ut(_i,"path",{d:!0,stroke:!0,fill:!0}),me(be).forEach(W),Te=ut(_i,"path",{d:!0,stroke:!0,fill:!0}),me(Te).forEach(W),Ce=ut(_i,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Ye=me(Ce);rt=Pt(Ye,"worsening"),Ye.forEach(W),nt=ut(_i,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Zt=me(nt);Ve=Pt(Zt,"improving"),Zt.forEach(W),_i.forEach(W),ft.forEach(W),tt.forEach(W),this.h()},h(){S(p,"cy","30"),S(p,"cx","90"),S(p,"r","8"),S(p,"stroke","white"),S(p,"stroke-width","2px"),S(p,"fill","white"),S(y,"cy","30"),S(y,"cx","90"),S(y,"r","6"),S(y,"stroke","black"),S(y,"stroke-width","1.5px"),S(y,"fill",Ta.improving["better than average"]),S(v,"transform","translate(90,30)"),S(v,"d","M19 -6 l-6.5 +6.5 l6 6 z"),S(v,"stroke","none"),S(v,"fill","black"),S(w,"transform","translate(90,30)"),S(w,"d","M20 0 l25 0 l0 10"),S(w,"stroke","black"),S(w,"stroke-width","1.5px"),S(w,"fill","none"),S(a,"transform","translate(90,30)"),S(a,"x","40"),S(a,"y","23"),S(a,"text-anchor","start"),S(a,"font-size","14px"),S(a,"stroke-width","0.25px"),S(a,"stroke","black"),S(a,"fill","black"),S(T,"transform","translate(90,30)"),S(T,"x","40"),S(T,"y","38"),S(T,"text-anchor","start"),S(T,"font-size","14px"),S(T,"stroke-width","0.25px"),S(T,"stroke","black"),S(T,"fill","black"),S(M,"transform","translate(90,30)"),S(M,"x","40"),S(M,"y","53"),S(M,"text-anchor","start"),S(M,"font-size","14px"),S(M,"stroke-width","0.25px"),S(M,"stroke","black"),S(M,"fill","black"),S(N,"x1","-20"),S(N,"x2","-20"),S(N,"y1","10"),S(N,"y2","110"),S(N,"stroke","black"),S(N,"stroke-width","2px"),S(O,"d","M-20 5 l5 5 l-10 0 z"),S(O,"stroke","none"),S(O,"fill","black"),S(G,"d","M-20 115 l5 -5 l-10 0 z"),S(G,"stroke","none"),S(G,"fill","black"),S(Q,"x","-30"),S(Q,"y","10"),S(Q,"text-anchor","end"),S(Q,"font-size","14px"),S(Q,"stroke-width","0.25px"),S(Q,"stroke","black"),S(Q,"fill","black"),S(le,"x","-30"),S(le,"y","24"),S(le,"text-anchor","end"),S(le,"font-size","14px"),S(le,"stroke-width","0.25px"),S(le,"stroke","black"),S(le,"fill","black"),S(Y,"x","-30"),S(Y,"y","110"),S(Y,"text-anchor","end"),S(Y,"font-size","14px"),S(Y,"stroke-width","0.25px"),S(Y,"stroke","black"),S(Y,"fill","black"),S(re,"x","-30"),S(re,"y","124"),S(re,"text-anchor","end"),S(re,"font-size","14px"),S(re,"stroke-width","0.25px"),S(re,"stroke","black"),S(re,"fill","black"),S(de,"y1","140"),S(de,"y2","140"),S(de,"x1","10"),S(de,"x2","110"),S(de,"stroke","black"),S(de,"stroke-width","2px"),S(be,"d","M5 140 l5 -5 l0 10 z"),S(be,"stroke","none"),S(be,"fill","black"),S(Te,"d","M115 140 l-5 -5 l0 10 z"),S(Te,"stroke","none"),S(Te,"fill","black"),S(Ce,"x","-5"),S(Ce,"y","160"),S(Ce,"text-anchor","middle"),S(Ce,"font-size","14px"),S(Ce,"stroke-width","0.25px"),S(Ce,"stroke","black"),S(Ce,"fill","black"),S(nt,"x","110"),S(nt,"y","160"),S(nt,"text-anchor","middle"),S(nt,"font-size","14px"),S(nt,"stroke-width","0.25px"),S(nt,"stroke","black"),S(nt,"fill","black"),S(c,"transform","translate(120,20)"),S(l,"width","420"),S(l,"height","200"),S(l,"class","svelte-5r2hj0")},m(et,tt){Ze(et,l,tt),se(l,c);for(let ft=0;ft<2;ft+=1)Oe[ft]&&Oe[ft].m(c,null);se(c,p),se(c,y),se(c,v),se(c,w),se(c,a),se(a,k),se(c,T),se(T,D),se(c,M),se(M,A),se(c,N),se(c,O),se(c,G),se(c,Q),se(Q,te),se(c,le),se(le,he),se(c,Y),se(Y,_e),se(c,re),se(re,we),se(c,Le),se(Le,de),se(Le,be),se(Le,Te),se(Le,Ce),se(Ce,rt),se(Le,nt),se(nt,Ve)},p(et,[tt]){if(tt&0){Ue=["worsening","improving"];let ft;for(ft=0;ft<2;ft+=1){const Gt=wd(et,Ue,ft);Oe[ft]?Oe[ft].p(Gt,tt):(Oe[ft]=Ed(Gt),Oe[ft].c(),Oe[ft].m(c,p))}for(;ft<2;ft+=1)Oe[ft].d(1)}},i:zi,o:zi,d(et){et&&W(l),Gi(Oe,et)}}}let Xg=class extends di{constructor(l){super(),fi(this,l,null,Zg,pi,{})}};function Wg(h){let l,c,p;return{c(){l=qe("div"),c=qe("p"),p=Mt("No data"),this.h()},l(y){l=Ge(y,"DIV",{class:!0,style:!0});var v=me(l);c=Ge(v,"P",{class:!0,style:!0});var w=me(c);p=Pt(w,"No data"),w.forEach(W),v.forEach(W),this.h()},h(){S(c,"class","mainText svelte-io2vqv"),Bt(c,"font-size","14px"),S(l,"class","cell-container no-data svelte-io2vqv"),Bt(l,"background-color","grey"),Bt(l,"color","white")},m(y,v){Ze(y,l,v),se(l,c),se(c,p)},p:zi,d(y){y&&W(l)}}}function Hg(h){let l,c,p,y,v,w,a,k,T,D,M=h[6]!=null&&Td();function A(G,Q){return G[6]!=null?Jg:Kg}let N=A(h),O=N(h);return{c(){l=ct("svg"),c=ct("rect"),p=ct("line"),M&&M.c(),y=ur(),O.c(),v=ct("circle"),k=ct("circle"),this.h()},l(G){l=ut(G,"svg",{class:!0});var Q=me(l);c=ut(Q,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(c).forEach(W),p=ut(Q,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(p).forEach(W),M&&M.l(Q),y=ur(),O.l(Q),v=ut(Q,"circle",{cy:!0,cx:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(v).forEach(W),k=ut(Q,"circle",{cy:!0,cx:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(k).forEach(W),Q.forEach(W),this.h()},h(){S(c,"x","0"),S(c,"y","0"),S(c,"width","60"),S(c,"height","60"),S(c,"fill","none"),S(c,"stroke","black"),S(c,"stroke-width","1px"),S(c,"opacity","0.25"),S(p,"x1","0"),S(p,"x2","60"),S(p,"y1","30"),S(p,"y2","30"),S(p,"stroke","black"),S(p,"stroke-width","1px"),S(p,"opacity","0.25"),S(v,"cy",w=h[5]===null?30:30+(h[0].polarity==1?-1:1)*28*h[5]/h[2]),S(v,"cx",a=h[6]===null||h[7]==null?30:30+(h[0].polarity==1?1:-1)*28*h[6]/h[1]),S(v,"r","8"),S(v,"stroke","white"),S(v,"stroke-width","2px"),S(v,"fill","white"),S(k,"cy",T=h[5]===null?30:30+(h[0].polarity==1?-1:1)*28*h[5]/h[2]),S(k,"cx",D=h[6]===null||h[7]==null?30:30+(h[0].polarity==1?1:-1)*28*h[6]/h[1]),S(k,"r","6"),S(k,"stroke","black"),S(k,"stroke-width","1.5px"),S(k,"fill",h[8]),S(l,"class","svelte-io2vqv")},m(G,Q){Ze(G,l,Q),se(l,c),se(l,p),M&&M.m(l,null),se(l,y),O.m(l,null),se(l,v),se(l,k)},p(G,Q){G[6]!=null?M||(M=Td(),M.c(),M.m(l,y)):M&&(M.d(1),M=null),N===(N=A(G))&&O?O.p(G,Q):(O.d(1),O=N(G),O&&(O.c(),O.m(l,v))),Q&37&&w!==(w=G[5]===null?30:30+(G[0].polarity==1?-1:1)*28*G[5]/G[2])&&S(v,"cy",w),Q&195&&a!==(a=G[6]===null||G[7]==null?30:30+(G[0].polarity==1?1:-1)*28*G[6]/G[1])&&S(v,"cx",a),Q&37&&T!==(T=G[5]===null?30:30+(G[0].polarity==1?-1:1)*28*G[5]/G[2])&&S(k,"cy",T),Q&195&&D!==(D=G[6]===null||G[7]==null?30:30+(G[0].polarity==1?1:-1)*28*G[6]/G[1])&&S(k,"cx",D),Q&256&&S(k,"fill",G[8])},d(G){G&&W(l),M&&M.d(),O.d()}}}function Td(h){let l;return{c(){l=ct("line"),this.h()},l(c){l=ut(c,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(l).forEach(W),this.h()},h(){S(l,"x1","30"),S(l,"x2","30"),S(l,"y1","0"),S(l,"y2","60"),S(l,"stroke","black"),S(l,"stroke-width","1px"),S(l,"opacity","0.25")},m(c,p){Ze(c,l,p)},d(c){c&&W(l)}}}function Kg(h){let l,c,p;return{c(){l=ct("line"),this.h()},l(y){l=ut(y,"line",{x1:!0,x2:!0,y1:!0,y2:!0,width:!0,height:!0,stroke:!0,"stroke-width":!0}),me(l).forEach(W),this.h()},h(){S(l,"x1","30"),S(l,"x2","30"),S(l,"y1",c=h[3]==="worse than average"?30:0),S(l,"y2",p=h[3]==="worse than average"?60:30),S(l,"width",30),S(l,"height","30"),S(l,"stroke","#b0b0b0"),S(l,"stroke-width","5px")},m(y,v){Ze(y,l,v)},p(y,v){v&8&&c!==(c=y[3]==="worse than average"?30:0)&&S(l,"y1",c),v&8&&p!==(p=y[3]==="worse than average"?60:30)&&S(l,"y2",p)},d(y){y&&W(l)}}}function Jg(h){let l,c,p;return{c(){l=ct("rect"),this.h()},l(y){l=ut(y,"rect",{y:!0,x:!0,width:!0,height:!0,stroke:!0,fill:!0,"fill-opacity":!0,"stroke-width":!0}),me(l).forEach(W),this.h()},h(){S(l,"y",c=h[3]==="worse than average"?30:0),S(l,"x",p=h[4]==="improving"?30:0),S(l,"width",30),S(l,"height","30"),S(l,"stroke","#b0b0b0"),S(l,"fill",h[8]),S(l,"fill-opacity","0.1"),S(l,"stroke-width","1.5px")},m(y,v){Ze(y,l,v)},p(y,v){v&8&&c!==(c=y[3]==="worse than average"?30:0)&&S(l,"y",c),v&16&&p!==(p=y[4]==="improving"?30:0)&&S(l,"x",p),v&256&&S(l,"fill",y[8])},d(y){y&&W(l)}}}function Yg(h){let l;function c(v,w){return v[5]!=null||v[6]!=null?Hg:Wg}let p=c(h),y=p(h);return{c(){l=qe("div"),y.c(),this.h()},l(v){l=Ge(v,"DIV",{class:!0});var w=me(l);y.l(w),w.forEach(W),this.h()},h(){S(l,"class","cell-container svelte-io2vqv")},m(v,w){Ze(v,l,w),y.m(l,null)},p(v,[w]){p===(p=c(v))&&y?y.p(v,w):(y.d(1),y=p(v),y&&(y.c(),y.m(l,null)))},i:zi,o:zi,d(v){v&&W(l),y.d()}}}function Qg(h,l,c){let p,y,v,w,a,k,T,{calculations:D,indicatorMetadata:M,latestData:A,initialData:N,maxChange:O,maxValueFromMedian:G}=l;return h.$$set=Q=>{"calculations"in Q&&c(9,D=Q.calculations),"indicatorMetadata"in Q&&c(0,M=Q.indicatorMetadata),"latestData"in Q&&c(10,A=Q.latestData),"initialData"in Q&&c(11,N=Q.initialData),"maxChange"in Q&&c(1,O=Q.maxChange),"maxValueFromMedian"in Q&&c(2,G=Q.maxValueFromMedian)},h.$$.update=()=>{h.$$.dirty&1024&&c(7,p=A.length>0?A[0].value:null),h.$$.dirty&2048&&c(12,y=N.length>0?N[0].value:null),h.$$.dirty&4225&&c(6,v=p!=null&y!=null?(p-y)/(M.absoluteOrPercent=="A"?1:y/100):null),h.$$.dirty&641&&c(5,w=p!=null?(p-D.medianValue)/(M.absoluteOrPercent=="A"?1:D.medianValue/100):null),h.$$.dirty&65&&c(4,a=v!=null?v>0?M.polarity==1?"improving":"worsening":M.polarity==1?"worsening":"improving":null),h.$$.dirty&33&&c(3,k=w!=null?w>0?M.polarity==1?"better than average":"worse than average":M.polarity==1?"worse than average":"better than average":null),h.$$.dirty&24&&c(8,T=a==null&k==null?"grey":Ta[a??"similar"][k??"similar"])},[M,O,G,k,a,w,v,p,T,D,A,N,y]}let $g=class extends di{constructor(l){super(),fi(this,l,Qg,Yg,pi,{calculations:9,indicatorMetadata:0,latestData:10,initialData:11,maxChange:1,maxValueFromMedian:2})}};function Sd(h,l,c){const p=h.slice();return p[14]=l[c],p[16]=c,p}function Ad(h){let l,c,p,y;function v(...a){return h[11](h[14],...a)}function w(...a){return h[12](h[14],...a)}return c=new $g({props:{calculations:h[14],indicatorMetadata:h[0].find(v),latestData:h[2].filter(w),initialData:"indicator-"+h[14].id in h[1]?h[1]["indicator-"+h[14].id].filter(h[13]):[],maxChange:h[6][h[16]],maxValueFromMedian:h[7][h[16]]}}),{c(){l=qe("div"),Vt(c.$$.fragment),p=vt(),this.h()},l(a){l=Ge(a,"DIV",{class:!0});var k=me(l);Ut(c.$$.fragment,k),p=xt(k),k.forEach(W),this.h()},h(){S(l,"class",Tr("cell column"+h[16])+" svelte-17hudsm")},m(a,k){Ze(a,l,k),Nt(c,l,null),se(l,p),y=!0},p(a,k){h=a;const T={};k&32&&(T.calculations=h[14]),k&33&&(T.indicatorMetadata=h[0].find(v)),k&52&&(T.latestData=h[2].filter(w)),k&50&&(T.initialData="indicator-"+h[14].id in h[1]?h[1]["indicator-"+h[14].id].filter(h[13]):[]),k&64&&(T.maxChange=h[6][h[16]]),k&128&&(T.maxValueFromMedian=h[7][h[16]]),c.$set(T)},i(a){y||(We(c.$$.fragment,a),y=!0)},o(a){it(c.$$.fragment,a),y=!1},d(a){a&&W(l),qt(c)}}}function e_(h){let l,c,p,y=h[8].find(h[10]).areanm+"",v,w,a,k,T=h[5],D=[];for(let A=0;A<T.length;A+=1)D[A]=Ad(Sd(h,T,A));const M=A=>it(D[A],1,1,()=>{D[A]=null});return{c(){l=qe("div"),c=qe("div"),p=qe("p"),v=Mt(y),w=vt();for(let A=0;A<D.length;A+=1)D[A].c();this.h()},l(A){l=Ge(A,"DIV",{class:!0,style:!0});var N=me(l);c=Ge(N,"DIV",{class:!0,style:!0});var O=me(c);p=Ge(O,"P",{class:!0});var G=me(p);v=Pt(G,y),G.forEach(W),O.forEach(W),w=xt(N);for(let Q=0;Q<D.length;Q+=1)D[Q].l(N);N.forEach(W),this.h()},h(){S(p,"class","svelte-17hudsm"),S(c,"class","areasColumn svelte-17hudsm"),S(c,"style","width: 200px"),S(l,"class",a=Tr("row cellRow"+h[3])+" svelte-17hudsm"),Bt(l,"background-color",h[3]%2===0?"#fafafa":"#ffffff")},m(A,N){Ze(A,l,N),se(l,c),se(c,p),se(p,v),se(l,w);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(l,null);k=!0},p(A,[N]){if((!k||N&16)&&y!==(y=A[8].find(A[10]).areanm+"")&&$i(v,y),N&247){T=A[5];let O;for(O=0;O<T.length;O+=1){const G=Sd(A,T,O);D[O]?(D[O].p(G,N),We(D[O],1)):(D[O]=Ad(G),D[O].c(),We(D[O],1),D[O].m(l,null))}for(vr(),O=T.length;O<D.length;O+=1)M(O);xr()}(!k||N&8&&a!==(a=Tr("row cellRow"+A[3])+" svelte-17hudsm"))&&S(l,"class",a),(!k||N&8)&&Bt(l,"background-color",A[3]%2===0?"#fafafa":"#ffffff")},i(A){if(!k){for(let N=0;N<T.length;N+=1)We(D[N]);k=!0}},o(A){D=D.filter(Boolean);for(let N=0;N<D.length;N+=1)it(D[N]);k=!1},d(A){A&&W(l),Gi(D,A)}}}function t_(h,l,c){let{chosenId1:p,indicatorsMetadata:y,initialData:v,latestData:w,j:a,row:k,indicatorsCalculations:T,maxChangeArray:D,maxValueFromMedianArray:M}=l,A=mi("areas");console.log(D);const N=te=>te.areacd===k.areacd,O=(te,le)=>le.code==te.code,G=(te,le)=>te.id==le.id&k.areacd==le.areacd,Q=te=>te.areacd==k.areacd;return h.$$set=te=>{"chosenId1"in te&&c(9,p=te.chosenId1),"indicatorsMetadata"in te&&c(0,y=te.indicatorsMetadata),"initialData"in te&&c(1,v=te.initialData),"latestData"in te&&c(2,w=te.latestData),"j"in te&&c(3,a=te.j),"row"in te&&c(4,k=te.row),"indicatorsCalculations"in te&&c(5,T=te.indicatorsCalculations),"maxChangeArray"in te&&c(6,D=te.maxChangeArray),"maxValueFromMedianArray"in te&&c(7,M=te.maxValueFromMedianArray)},[y,v,w,a,k,T,D,M,A,p,N,O,G,Q]}let i_=class extends di{constructor(l){super(),fi(this,l,t_,e_,pi,{chosenId1:9,indicatorsMetadata:0,initialData:1,latestData:2,j:3,row:4,indicatorsCalculations:5,maxChangeArray:6,maxValueFromMedianArray:7})}};function Dd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function Cd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function zd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function Md(h){let l,c,p=h[6].label+"",y,v;return{c(){l=qe("div"),c=qe("p"),y=Mt(p),v=vt(),this.h()},l(w){l=Ge(w,"DIV",{class:!0});var a=me(l);c=Ge(a,"P",{class:!0});var k=me(c);y=Pt(k,p),v=xt(k),k.forEach(W),a.forEach(W),this.h()},h(){S(c,"class","svelte-4m9oqo"),S(l,"class",Tr("headerCell column"+h[8])+" svelte-4m9oqo")},m(w,a){Ze(w,l,a),se(l,c),se(c,y),se(c,v)},p(w,a){a&4&&p!==(p=w[6].label+"")&&$i(y,p)},d(w){w&&W(l)}}}function Pd(h){let l,c;return l=new Iu({}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function Ld(h){let l,c="(compared to "+h[3].find(y).label+")",p;function y(...v){return h[5](h[6],...v)}return{c(){l=qe("p"),p=Mt(c),this.h()},l(v){l=Ge(v,"P",{class:!0});var w=me(l);p=Pt(w,c),w.forEach(W),this.h()},h(){S(l,"class","initial-year-label svelte-4m9oqo")},m(v,w){Ze(v,l,w),se(l,p)},p(v,w){h=v,w&4&&c!==(c="(compared to "+h[3].find(y).label+")")&&$i(p,c)},d(v){v&&W(l)}}}function Rd(h){let l,c,p=h[3].find(k).label+"",y,v,w=h[6].minXDomain!=h[6].maxXDomain&(h[1].includes(1)||h[0]!=0),a;function k(...D){return h[4](h[6],...D)}let T=w&&Ld(h);return{c(){l=qe("div"),c=qe("p"),y=Mt(p),v=vt(),T&&T.c(),a=vt(),this.h()},l(D){l=Ge(D,"DIV",{class:!0});var M=me(l);c=Ge(M,"P",{class:!0});var A=me(c);y=Pt(A,p),A.forEach(W),v=xt(M),T&&T.l(M),a=xt(M),M.forEach(W),this.h()},h(){S(c,"class","latest-year-label svelte-4m9oqo"),S(l,"class",Tr("yearCell column"+h[8])+" svelte-4m9oqo")},m(D,M){Ze(D,l,M),se(l,c),se(c,y),se(l,v),T&&T.m(l,null),se(l,a)},p(D,M){h=D,M&4&&p!==(p=h[3].find(k).label+"")&&$i(y,p),M&7&&(w=h[6].minXDomain!=h[6].maxXDomain&(h[1].includes(1)||h[0]!=0)),w?T?T.p(h,M):(T=Ld(h),T.c(),T.m(l,a)):T&&(T.d(1),T=null)},d(D){D&&W(l),T&&T.d()}}}function r_(h){let l,c,p,y,v,w,a,k,T,D,M,A,N=h[2],O=[];for(let Y=0;Y<N.length;Y+=1)O[Y]=Md(zd(h,N,Y));let G=h[2],Q=[];for(let Y=0;Y<G.length;Y+=1)Q[Y]=Pd(Cd(h,G,Y));const te=Y=>it(Q[Y],1,1,()=>{Q[Y]=null});let le=h[2],he=[];for(let Y=0;Y<le.length;Y+=1)he[Y]=Rd(Dd(h,le,Y));return{c(){l=qe("div"),c=qe("div"),p=vt();for(let Y=0;Y<O.length;Y+=1)O[Y].c();y=vt(),v=qe("div"),w=qe("div"),a=vt();for(let Y=0;Y<Q.length;Y+=1)Q[Y].c();k=vt(),T=qe("div"),D=qe("div"),M=vt();for(let Y=0;Y<he.length;Y+=1)he[Y].c();this.h()},l(Y){l=Ge(Y,"DIV",{class:!0});var _e=me(l);c=Ge(_e,"DIV",{class:!0,style:!0});var re=me(c);re.forEach(W),p=xt(_e);for(let Te=0;Te<O.length;Te+=1)O[Te].l(_e);_e.forEach(W),y=xt(Y),v=Ge(Y,"DIV",{class:!0});var we=me(v);w=Ge(we,"DIV",{class:!0,style:!0});var Le=me(w);Le.forEach(W),a=xt(we);for(let Te=0;Te<Q.length;Te+=1)Q[Te].l(we);we.forEach(W),k=xt(Y),T=Ge(Y,"DIV",{class:!0});var de=me(T);D=Ge(de,"DIV",{class:!0,style:!0});var be=me(D);be.forEach(W),M=xt(de);for(let Te=0;Te<he.length;Te+=1)he[Te].l(de);de.forEach(W),this.h()},h(){S(c,"class","areasColumn svelte-4m9oqo"),S(c,"style","width: 200px"),S(l,"class","row headerRow svelte-4m9oqo"),S(w,"class","areasColumn svelte-4m9oqo"),S(w,"style","width: 200px"),S(v,"class","row headerRow svelte-4m9oqo"),S(D,"class","areasColumn svelte-4m9oqo"),S(D,"style","width: 200px"),S(T,"class","row headerRow svelte-4m9oqo")},m(Y,_e){Ze(Y,l,_e),se(l,c),se(l,p);for(let re=0;re<O.length;re+=1)O[re]&&O[re].m(l,null);Ze(Y,y,_e),Ze(Y,v,_e),se(v,w),se(v,a);for(let re=0;re<Q.length;re+=1)Q[re]&&Q[re].m(v,null);Ze(Y,k,_e),Ze(Y,T,_e),se(T,D),se(T,M);for(let re=0;re<he.length;re+=1)he[re]&&he[re].m(T,null);A=!0},p(Y,[_e]){if(_e&4){N=Y[2];let re;for(re=0;re<N.length;re+=1){const we=zd(Y,N,re);O[re]?O[re].p(we,_e):(O[re]=Md(we),O[re].c(),O[re].m(l,null))}for(;re<O.length;re+=1)O[re].d(1);O.length=N.length}if(_e&4){const re=G.length;G=Y[2];let we;for(we=re;we<G.length;we+=1)Cd(Y,G,we),Q[we]?We(Q[we],1):(Q[we]=Pd(),Q[we].c(),We(Q[we],1),Q[we].m(v,null));for(vr(),we=G.length;we<Q.length;we+=1)te(we);xr()}if(_e&15){le=Y[2];let re;for(re=0;re<le.length;re+=1){const we=Dd(Y,le,re);he[re]?he[re].p(we,_e):(he[re]=Rd(we),he[re].c(),he[re].m(T,null))}for(;re<he.length;re+=1)he[re].d(1);he.length=le.length}},i(Y){if(!A){for(let _e=0;_e<G.length;_e+=1)We(Q[_e]);A=!0}},o(Y){Q=Q.filter(Boolean);for(let _e=0;_e<Q.length;_e+=1)it(Q[_e]);A=!1},d(Y){Y&&W(l),Gi(O,Y),Y&&W(y),Y&&W(v),Gi(Q,Y),Y&&W(k),Y&&W(T),Gi(he,Y)}}}function n_(h,l,c){let{chosenId2:p,chosenId3:y,indicatorsCalculations:v}=l,w=mi("periodsLookup");const a=(T,D)=>D.xDomainNumb==T.maxXDomain,k=(T,D)=>D.xDomainNumb==T.minXDomain;return h.$$set=T=>{"chosenId2"in T&&c(0,p=T.chosenId2),"chosenId3"in T&&c(1,y=T.chosenId3),"indicatorsCalculations"in T&&c(2,v=T.indicatorsCalculations)},[p,y,v,w,a,k]}let a_=class extends di{constructor(l){super(),fi(this,l,n_,r_,pi,{chosenId2:0,chosenId3:1,indicatorsCalculations:2})}};function Bd(h,l,c){const p=h.slice();return p[12]=l[c],p[14]=c,p}function Fd(h){let l,c;return l=new i_({props:{row:h[12],j:h[14],chosenId1:h[3],chosenId2:h[4],chosenId3:h[5],indicatorsCalculations:h[9],indicatorsMetadata:h[8],initialData:h[1],latestData:h[0],maxChangeArray:h[6],maxValueFromMedianArray:h[7]}}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p(p,y){const v={};y&4&&(v.row=p[12]),y&8&&(v.chosenId1=p[3]),y&16&&(v.chosenId2=p[4]),y&32&&(v.chosenId3=p[5]),y&2&&(v.initialData=p[1]),y&1&&(v.latestData=p[0]),y&64&&(v.maxChangeArray=p[6]),y&128&&(v.maxValueFromMedianArray=p[7]),l.$set(v)},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function s_(h){let l,c,p,y;c=new a_({props:{indicatorsCalculations:h[9],chosenId2:h[4],chosenId3:h[5]}});let v=h[2],w=[];for(let k=0;k<v.length;k+=1)w[k]=Fd(Bd(h,v,k));const a=k=>it(w[k],1,1,()=>{w[k]=null});return{c(){l=qe("div"),Vt(c.$$.fragment),p=vt();for(let k=0;k<w.length;k+=1)w[k].c();this.h()},l(k){l=Ge(k,"DIV",{class:!0});var T=me(l);Ut(c.$$.fragment,T),p=xt(T);for(let D=0;D<w.length;D+=1)w[D].l(T);T.forEach(W),this.h()},h(){S(l,"class","grid-container svelte-k2j273")},m(k,T){Ze(k,l,T),Nt(c,l,null),se(l,p);for(let D=0;D<w.length;D+=1)w[D]&&w[D].m(l,null);y=!0},p(k,[T]){const D={};if(T&16&&(D.chosenId2=k[4]),T&32&&(D.chosenId3=k[5]),c.$set(D),T&1023){v=k[2];let M;for(M=0;M<v.length;M+=1){const A=Bd(k,v,M);w[M]?(w[M].p(A,T),We(w[M],1)):(w[M]=Fd(A),w[M].c(),We(w[M],1),w[M].m(l,null))}for(vr(),M=v.length;M<w.length;M+=1)a(M);xr()}},i(k){if(!y){We(c.$$.fragment,k);for(let T=0;T<v.length;T+=1)We(w[T]);y=!0}},o(k){it(c.$$.fragment,k),w=w.filter(Boolean);for(let T=0;T<w.length;T+=1)it(w[T]);y=!1},d(k){k&&W(l),qt(c),Gi(w,k)}}}function o_(h,l,c){let p,y,{indicatorsList:v,latestData:w,initialData:a,selectedAreas:k,chosenId1:T,chosenId2:D,chosenId3:M,chosenId0:A}=l,N=mi("indicatorsMetadata"),O=mi("indicatorsCalculations").filter(G=>v.includes(G.id));return h.$$set=G=>{"indicatorsList"in G&&c(10,v=G.indicatorsList),"latestData"in G&&c(0,w=G.latestData),"initialData"in G&&c(1,a=G.initialData),"selectedAreas"in G&&c(2,k=G.selectedAreas),"chosenId1"in G&&c(3,T=G.chosenId1),"chosenId2"in G&&c(4,D=G.chosenId2),"chosenId3"in G&&c(5,M=G.chosenId3),"chosenId0"in G&&c(11,A=G.chosenId0)},h.$$.update=()=>{h.$$.dirty&2055&&O.forEach((G,Q)=>{G.medianValue=G.ltCount>200?G.ltMedian:G.utCount>140?G.utMedian:G.ukValue!="NA"?G.ukValue:G.gbValue!="NA"?G.gbValue:G.ewValue!="NA"?G.ewValue:G.engValue!="NA"?G.engValue:null;let te=N.find(le=>le.code==G.code).absoluteOrPercent;c(7,y[Q]=A==0?Math.max(G.medianValue-G.minValue,G.maxValue-G.medianValue)/(te=="A"?1:G.medianValue):Math.max(...k.map(le=>le.areacd).map(le=>w.find(he=>he.areacd==le&he.id==G.id)).filter(le=>le!=null).map(le=>Math.abs(le.value-G.medianValue))),y),c(6,p[Q]=A==0?te=="A"?G.maxAbsoluteChange:G.maxPercentageChange:"indicator-"+G.id in a?Math.max(...k.map(le=>le.areacd).map(le=>[w.find(he=>he.areacd==le&he.id==G.id),a["indicator-"+G.id].find(he=>he.areacd==le)]).filter(le=>le[0]!=null&le[1]!=null).map(le=>Math.abs(le[0].value-le[1].value))):null,p),G.label=N.find(le=>le.code==G.code).label})},c(6,p=new Array(O.length)),c(7,y=new Array(O.length)),[w,a,k,T,D,M,p,y,N,O,v,A]}let l_=class extends di{constructor(l){super(),fi(this,l,o_,s_,pi,{indicatorsList:10,latestData:0,initialData:1,selectedAreas:2,chosenId1:3,chosenId2:4,chosenId3:5,chosenId0:11})}};function c_(h){let l,c,p,y,v,w,a,k,T,D;function M(O){h[8](O)}function A(O){h[9](O)}let N={radioName:"dotPlotRadio",latestData:h[2]};return h[0]!==void 0&&(N.checkboxedRoles=h[0]),h[5]!==void 0&&(N.chosenId=h[5]),c=new Eu({props:N}),gi.push(()=>bi(c,"checkboxedRoles",M)),gi.push(()=>bi(c,"chosenId",A)),a=new Xg({}),T=new l_({props:{indicatorsList:h[1],latestData:h[2],initialData:h[3],selectedAreas:h[6],chosenId1:h[5],chosenId2:u_,chosenId3:h[7],chosenId0:h[4]}}),{c(){l=qe("div"),Vt(c.$$.fragment),v=vt(),w=qe("div"),Vt(a.$$.fragment),k=vt(),Vt(T.$$.fragment),this.h()},l(O){l=Ge(O,"DIV",{class:!0});var G=me(l);Ut(c.$$.fragment,G),v=xt(G),w=Ge(G,"DIV",{class:!0});var Q=me(w);Ut(a.$$.fragment,Q),Q.forEach(W),k=xt(G),Ut(T.$$.fragment,G),G.forEach(W),this.h()},h(){S(w,"class","key-and-selections-container svelte-1xm9yo2"),S(l,"class","key-indicators-dot-plot-boxes-option-2-container")},m(O,G){Ze(O,l,G),Nt(c,l,null),se(l,v),se(l,w),Nt(a,w,null),se(l,k),Nt(T,l,null),D=!0},p(O,[G]){const Q={};G&4&&(Q.latestData=O[2]),!p&&G&1&&(p=!0,Q.checkboxedRoles=O[0],wi(()=>p=!1)),!y&&G&32&&(y=!0,Q.chosenId=O[5],wi(()=>y=!1)),c.$set(Q);const te={};G&2&&(te.indicatorsList=O[1]),G&4&&(te.latestData=O[2]),G&8&&(te.initialData=O[3]),G&64&&(te.selectedAreas=O[6]),G&32&&(te.chosenId1=O[5]),G&16&&(te.chosenId0=O[4]),T.$set(te)},i(O){D||(We(c.$$.fragment,O),We(a.$$.fragment,O),We(T.$$.fragment,O),D=!0)},o(O){it(c.$$.fragment,O),it(a.$$.fragment,O),it(T.$$.fragment,O),D=!1},d(O){O&&W(l),qt(c),qt(a),qt(T)}}}let u_=2;function h_(h,l,c){let p,{indicatorsList:y,latestData:v,initialData:w,checkboxedRoles:a,chosenId0:k}=l,T=0,D=[],A=mi("areasParentsLookup").filter(G=>["K02000001","E92000001"].includes(G.parentcd)&G.areacd!="E92000001");function N(G){a=G,c(0,a)}function O(G){T=G,c(5,T)}return h.$$set=G=>{"indicatorsList"in G&&c(1,y=G.indicatorsList),"latestData"in G&&c(2,v=G.latestData),"initialData"in G&&c(3,w=G.initialData),"checkboxedRoles"in G&&c(0,a=G.checkboxedRoles),"chosenId0"in G&&c(4,k=G.chosenId0)},h.$$.update=()=>{h.$$.dirty&33&&c(6,p=T===0?A:a.custom==null||a.custom==null?[]:a.custom)},[a,y,v,w,k,T,p,D,N,O]}class d_ extends di{constructor(l){super(),fi(this,l,h_,c_,pi,{indicatorsList:1,latestData:2,initialData:3,checkboxedRoles:0,chosenId0:4})}}function Od(h,l,c){const p=h.slice();return p[0]=l[c],p[2]=c,p}function Vd(h,l,c){const p=h.slice();return p[3]=l[c],p[5]=c,p}function Ud(h){let l;return{c(){l=ct("rect"),this.h()},l(c){l=ut(c,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,stroke:!0,fill:!0,opacity:!0}),me(l).forEach(W),this.h()},h(){S(l,"transform","translate("+(h[2]==0?-1:h[2]==2?1:0)+","+(h[5]==0?-1:h[5]==2?1:0)+")"),S(l,"x",h[2]*60),S(l,"y",h[5]*60),S(l,"width","60"),S(l,"height","60"),S(l,"stroke","none"),S(l,"fill",Ta[h[0]][h[3]]),S(l,"opacity","0.5")},m(c,p){Ze(c,l,p)},p:zi,d(c){c&&W(l)}}}function Nd(h){let l,c=["better than average","worse than average"],p=[];for(let y=0;y<2;y+=1)p[y]=Ud(Vd(h,c,y));return{c(){for(let y=0;y<2;y+=1)p[y].c();l=ur()},l(y){for(let v=0;v<2;v+=1)p[v].l(y);l=ur()},m(y,v){for(let w=0;w<2;w+=1)p[w]&&p[w].m(y,v);Ze(y,l,v)},p(y,v){if(v&0){c=["better than average","worse than average"];let w;for(w=0;w<2;w+=1){const a=Vd(y,c,w);p[w]?p[w].p(a,v):(p[w]=Ud(a),p[w].c(),p[w].m(l.parentNode,l))}for(;w<2;w+=1)p[w].d(1)}},d(y){Gi(p,y),y&&W(l)}}}function f_(h){let l,c,p,y,v,w,a,k,T,D,M,A,N,O,G,Q,te,le,he,Y,_e,re,we,Le,de,be,Te,Ce,rt,nt,Ve,Ue,Oe,et,tt,ft,Gt=["worsening","improving"],zt=[];for(let Ke=0;Ke<2;Ke+=1)zt[Ke]=Nd(Od(h,Gt,Ke));return{c(){l=ct("svg"),c=ct("g"),p=ct("rect"),y=ct("line"),v=ct("path"),w=ct("text"),a=Mt("This line represents the median value"),k=ct("text"),T=Mt("during the most recent time period."),D=ct("path"),M=ct("circle"),A=ct("path"),N=ct("text"),O=Mt("A dot below the median line means"),G=ct("text"),Q=Mt("the area is worse than average."),te=ct("g");for(let Ke=0;Ke<2;Ke+=1)zt[Ke].c();le=ct("line"),he=ct("path"),Y=ct("path"),_e=ct("text"),re=Mt("better than"),we=ct("text"),Le=Mt("average"),de=ct("text"),be=Mt("worse than"),Te=ct("text"),Ce=Mt("average"),rt=ct("g"),nt=ct("line"),Ve=ct("path"),Ue=ct("path"),Oe=ct("text"),et=Mt("worsening"),tt=ct("text"),ft=Mt("improving"),this.h()},l(Ke){l=ut(Ke,"svg",{width:!0,height:!0,class:!0});var Tt=me(l);c=ut(Tt,"g",{transform:!0});var Ct=me(c);p=ut(Ct,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(p).forEach(W),y=ut(Ct,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(y).forEach(W),v=ut(Ct,"path",{transform:!0,d:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(v).forEach(W),w=ut(Ct,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var ti=me(w);a=Pt(ti,"This line represents the median value"),ti.forEach(W),k=ut(Ct,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var hi=me(k);T=Pt(hi,"during the most recent time period."),hi.forEach(W),D=ut(Ct,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),me(D).forEach(W),M=ut(Ct,"circle",{cy:!0,cx:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(M).forEach(W),A=ut(Ct,"path",{transform:!0,d:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(A).forEach(W),N=ut(Ct,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var _i=me(N);O=Pt(_i,"A dot below the median line means"),_i.forEach(W),G=ut(Ct,"text",{transform:!0,x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Ye=me(G);Q=Pt(Ye,"the area is worse than average."),Ye.forEach(W),Ct.forEach(W),te=ut(Tt,"g",{transform:!0});var Zt=me(te);for(let Yr=0;Yr<2;Yr+=1)zt[Yr].l(Zt);le=ut(Zt,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),me(le).forEach(W),he=ut(Zt,"path",{d:!0,stroke:!0,fill:!0}),me(he).forEach(W),Y=ut(Zt,"path",{d:!0,stroke:!0,fill:!0}),me(Y).forEach(W),_e=ut(Zt,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var He=me(_e);re=Pt(He,"better than"),He.forEach(W),we=ut(Zt,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var ii=me(we);Le=Pt(ii,"average"),ii.forEach(W),de=ut(Zt,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Ri=me(de);be=Pt(Ri,"worse than"),Ri.forEach(W),Te=ut(Zt,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var br=me(Te);Ce=Pt(br,"average"),br.forEach(W),rt=ut(Zt,"g",{});var Hi=me(rt);nt=ut(Hi,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0}),me(nt).forEach(W),Ve=ut(Hi,"path",{d:!0,stroke:!0,fill:!0}),me(Ve).forEach(W),Ue=ut(Hi,"path",{d:!0,stroke:!0,fill:!0}),me(Ue).forEach(W),Oe=ut(Hi,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Kr=me(Oe);et=Pt(Kr,"worsening"),Kr.forEach(W),tt=ut(Hi,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,"stroke-width":!0,stroke:!0,fill:!0});var Jr=me(tt);ft=Pt(Jr,"improving"),Jr.forEach(W),Hi.forEach(W),Zt.forEach(W),Tt.forEach(W),this.h()},h(){S(p,"x","0"),S(p,"y","0"),S(p,"width","60"),S(p,"height","60"),S(p,"fill","none"),S(p,"stroke","black"),S(p,"stroke-width","1px"),S(p,"opacity","0.25"),S(y,"y1","30"),S(y,"y2","30"),S(y,"x1","0"),S(y,"x2","60"),S(y,"stroke","black"),S(y,"stroke-width","1px"),S(y,"opacity","0.25"),S(v,"transform","translate(60,30)"),S(v,"d","M6.5 0.5 l6.5 -6.5 M7 0 l6 6 M12 0 l28 0 l0 -5"),S(v,"stroke","black"),S(v,"stroke-width","1.5px"),S(v,"fill","none"),S(w,"transform","translate(60,30)"),S(w,"x","30"),S(w,"y","-25"),S(w,"text-anchor","start"),S(w,"font-size","14px"),S(w,"stroke-width","0.25px"),S(w,"stroke","black"),S(w,"fill","black"),S(k,"transform","translate(60,30)"),S(k,"x","30"),S(k,"y","-10"),S(k,"text-anchor","start"),S(k,"font-size","14px"),S(k,"stroke-width","0.25px"),S(k,"stroke","black"),S(k,"fill","black"),S(D,"d","M0 30 L5 32 L10 27 L15 33 L20 33 L25 30 L30 30 L35 35 L40 40 L45 42 L50 48 L55 48 L60 50"),S(D,"stroke","black"),S(D,"fill","none"),S(D,"stroke-width","2px"),S(M,"cy","50"),S(M,"cx","60"),S(M,"r","4.5"),S(M,"stroke","white"),S(M,"stroke-width","1.5px"),S(M,"fill","black"),S(A,"transform","translate(60,50)"),S(A,"d","M6.5 0.5 l6.5 -6.5 M7 0 l6 6 M12 0 l28 0 l0 15"),S(A,"stroke","black"),S(A,"stroke-width","1.5px"),S(A,"fill","none"),S(N,"transform","translate(60,30)"),S(N,"x","30"),S(N,"y","45"),S(N,"text-anchor","start"),S(N,"font-size","14px"),S(N,"stroke-width","0.25px"),S(N,"stroke","black"),S(N,"fill","black"),S(G,"transform","translate(60,30)"),S(G,"x","30"),S(G,"y","60"),S(G,"text-anchor","start"),S(G,"font-size","14px"),S(G,"stroke-width","0.25px"),S(G,"stroke","black"),S(G,"fill","black"),S(c,"transform","translate(10,25)"),S(le,"x1","-20"),S(le,"x2","-20"),S(le,"y1","10"),S(le,"y2","110"),S(le,"stroke","black"),S(le,"stroke-width","2px"),S(he,"d","M-20 5 l5 5 l-10 0 z"),S(he,"stroke","none"),S(he,"fill","black"),S(Y,"d","M-20 115 l5 -5 l-10 0 z"),S(Y,"stroke","none"),S(Y,"fill","black"),S(_e,"x","-30"),S(_e,"y","10"),S(_e,"text-anchor","end"),S(_e,"font-size","14px"),S(_e,"stroke-width","0.25px"),S(_e,"stroke","black"),S(_e,"fill","black"),S(we,"x","-30"),S(we,"y","24"),S(we,"text-anchor","end"),S(we,"font-size","14px"),S(we,"stroke-width","0.25px"),S(we,"stroke","black"),S(we,"fill","black"),S(de,"x","-30"),S(de,"y","110"),S(de,"text-anchor","end"),S(de,"font-size","14px"),S(de,"stroke-width","0.25px"),S(de,"stroke","black"),S(de,"fill","black"),S(Te,"x","-30"),S(Te,"y","124"),S(Te,"text-anchor","end"),S(Te,"font-size","14px"),S(Te,"stroke-width","0.25px"),S(Te,"stroke","black"),S(Te,"fill","black"),S(nt,"y1","140"),S(nt,"y2","140"),S(nt,"x1","10"),S(nt,"x2","110"),S(nt,"stroke","black"),S(nt,"stroke-width","2px"),S(Ve,"d","M5 140 l5 -5 l0 10 z"),S(Ve,"stroke","none"),S(Ve,"fill","black"),S(Ue,"d","M115 140 l-5 -5 l0 10 z"),S(Ue,"stroke","none"),S(Ue,"fill","black"),S(Oe,"x","-5"),S(Oe,"y","160"),S(Oe,"text-anchor","middle"),S(Oe,"font-size","14px"),S(Oe,"stroke-width","0.25px"),S(Oe,"stroke","black"),S(Oe,"fill","black"),S(tt,"x","110"),S(tt,"y","160"),S(tt,"text-anchor","middle"),S(tt,"font-size","14px"),S(tt,"stroke-width","0.25px"),S(tt,"stroke","black"),S(tt,"fill","black"),S(te,"transform","translate(485,15)"),S(l,"width","650"),S(l,"height","190"),S(l,"class","svelte-5r2hj0")},m(Ke,Tt){Ze(Ke,l,Tt),se(l,c),se(c,p),se(c,y),se(c,v),se(c,w),se(w,a),se(c,k),se(k,T),se(c,D),se(c,M),se(c,A),se(c,N),se(N,O),se(c,G),se(G,Q),se(l,te);for(let Ct=0;Ct<2;Ct+=1)zt[Ct]&&zt[Ct].m(te,null);se(te,le),se(te,he),se(te,Y),se(te,_e),se(_e,re),se(te,we),se(we,Le),se(te,de),se(de,be),se(te,Te),se(Te,Ce),se(te,rt),se(rt,nt),se(rt,Ve),se(rt,Ue),se(rt,Oe),se(Oe,et),se(rt,tt),se(tt,ft)},p(Ke,[Tt]){if(Tt&0){Gt=["worsening","improving"];let Ct;for(Ct=0;Ct<2;Ct+=1){const ti=Od(Ke,Gt,Ct);zt[Ct]?zt[Ct].p(ti,Tt):(zt[Ct]=Nd(ti),zt[Ct].c(),zt[Ct].m(te,le))}for(;Ct<2;Ct+=1)zt[Ct].d(1)}},i:zi,o:zi,d(Ke){Ke&&W(l),Gi(zt,Ke)}}}class p_ extends di{constructor(l){super(),fi(this,l,null,f_,pi,{})}}function m_(h){let l,c,p;return{c(){l=qe("div"),c=qe("p"),p=Mt("No data"),this.h()},l(y){l=Ge(y,"DIV",{class:!0,style:!0});var v=me(l);c=Ge(v,"P",{class:!0,style:!0});var w=me(c);p=Pt(w,"No data"),w.forEach(W),v.forEach(W),this.h()},h(){S(c,"class","mainText svelte-tdbzgz"),Bt(c,"font-size","14px"),S(l,"class","cell-container no-data svelte-tdbzgz"),Bt(l,"background-color","grey"),Bt(l,"color","white")},m(y,v){Ze(y,l,v),se(l,c),se(c,p)},p:zi,d(y){y&&W(l)}}}function g_(h){let l,c,p,y,v,w,a,k=h[1].length>1&&qd(h);return{c(){l=ct("svg"),c=ct("rect"),p=ct("rect"),y=ct("line"),k&&k.c(),v=ct("circle"),this.h()},l(T){l=ut(T,"svg",{class:!0});var D=me(l);c=ut(D,"rect",{width:!0,height:!0,stroke:!0,fill:!0,opacity:!0}),me(c).forEach(W),p=ut(D,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(p).forEach(W),y=ut(D,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0,opacity:!0}),me(y).forEach(W),k&&k.l(D),v=ut(D,"circle",{cy:!0,cx:!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0}),me(v).forEach(W),D.forEach(W),this.h()},h(){S(c,"width","60"),S(c,"height","60"),S(c,"stroke","none"),S(c,"fill",h[4]),S(c,"opacity","0"),S(p,"x","0"),S(p,"y","0"),S(p,"width","60"),S(p,"height","60"),S(p,"fill","none"),S(p,"stroke","black"),S(p,"stroke-width","1px"),S(p,"opacity","0.25"),S(y,"y1","30"),S(y,"y2","30"),S(y,"x1","0"),S(y,"x2","60"),S(y,"stroke","black"),S(y,"stroke-width","1px"),S(y,"opacity","0.25"),S(v,"cy",w=h[2](h[1][h[1].length-1].value)),S(v,"cx",a=h[1].length>1?h[3](h[1][h[1].length-1].xDomainNumb):30),S(v,"r","4.5"),S(v,"stroke","white"),S(v,"stroke-width","1.5px"),S(v,"fill",h[4]),S(l,"class","svelte-tdbzgz")},m(T,D){Ze(T,l,D),se(l,c),se(l,p),se(l,y),k&&k.m(l,null),se(l,v)},p(T,D){D&16&&S(c,"fill",T[4]),T[1].length>1?k?k.p(T,D):(k=qd(T),k.c(),k.m(l,v)):k&&(k.d(1),k=null),D&6&&w!==(w=T[2](T[1][T[1].length-1].value))&&S(v,"cy",w),D&10&&a!==(a=T[1].length>1?T[3](T[1][T[1].length-1].xDomainNumb):30)&&S(v,"cx",a),D&16&&S(v,"fill",T[4])},d(T){T&&W(l),k&&k.d()}}}function qd(h){let l,c;return{c(){l=ct("path"),this.h()},l(p){l=ut(p,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),me(l).forEach(W),this.h()},h(){S(l,"d",c=h[0](h[1])),S(l,"stroke",h[4]),S(l,"fill","none"),S(l,"stroke-width","2px")},m(p,y){Ze(p,l,y)},p(p,y){y&3&&c!==(c=p[0](p[1]))&&S(l,"d",c),y&16&&S(l,"stroke",p[4])},d(p){p&&W(l)}}}function __(h){let l;function c(v,w){return v[1].length>0?g_:m_}let p=c(h),y=p(h);return{c(){l=qe("div"),y.c(),this.h()},l(v){l=Ge(v,"DIV",{class:!0});var w=me(l);y.l(w),w.forEach(W),this.h()},h(){S(l,"class","cell-container svelte-tdbzgz")},m(v,w){Ze(v,l,w),y.m(l,null)},p(v,[w]){p===(p=c(v))&&y?y.p(v,w):(y.d(1),y=p(v),y&&(y.c(),y.m(l,null)))},i:zi,o:zi,d(v){v&&W(l),y.d()}}}function y_(h,l,c){let p,y,v,w,a,k,T,{calculations:D,indicatorMetadata:M,pathFunction:A,combinedData:N,yScale:O,xScale:G}=l;return h.$$set=Q=>{"calculations"in Q&&c(5,D=Q.calculations),"indicatorMetadata"in Q&&c(6,M=Q.indicatorMetadata),"pathFunction"in Q&&c(0,A=Q.pathFunction),"combinedData"in Q&&c(1,N=Q.combinedData),"yScale"in Q&&c(2,O=Q.yScale),"xScale"in Q&&c(3,G=Q.xScale)},h.$$.update=()=>{h.$$.dirty&2&&c(11,p=N.length>0?N[N.length-1].value:null),h.$$.dirty&2&&c(12,y=N.length>1?N[0].value:null),h.$$.dirty&6208&&c(10,v=p!=null&y!=null?(p-y)/(M.absoluteOrPercent=="A"?1:y/100):null),h.$$.dirty&2144&&c(9,w=p!=null?(p-D.medianValue)/(M.absoluteOrPercent=="A"?1:D.medianValue/100):null),h.$$.dirty&1088&&c(8,a=v!=null?v>0?M.polarity==1?"improving":"worsening":M.polarity==1?"worsening":"improving":null),h.$$.dirty&576&&c(7,k=w!=null?w>0?M.polarity==1?"better than average":"worse than average":M.polarity==1?"worse than average":"better than average":null),h.$$.dirty&384&&c(4,T=a==null&k==null?"grey":Ta[a??"similar"][k??"similar"])},[A,N,O,G,T,D,M,k,a,w,v,p,y]}class v_ extends di{constructor(l){super(),fi(this,l,y_,__,pi,{calculations:5,indicatorMetadata:6,pathFunction:0,combinedData:1,yScale:2,xScale:3})}}function Gd(h,l,c){const p=h.slice();return p[12]=l[c],p[14]=c,p}function jd(h){let l,c,p,y;function v(...w){return h[10](h[12],...w)}return c=new v_({props:{calculations:h[12],indicatorMetadata:h[0].find(v),combinedData:h[5][h[14]].filter(h[11]),pathFunction:h[4][h[14]],yScale:h[6][h[14]],xScale:h[7][h[14]]}}),{c(){l=qe("div"),Vt(c.$$.fragment),p=vt(),this.h()},l(w){l=Ge(w,"DIV",{class:!0});var a=me(l);Ut(c.$$.fragment,a),p=xt(a),a.forEach(W),this.h()},h(){S(l,"class",Tr("cell column"+h[14])+" svelte-17hudsm")},m(w,a){Ze(w,l,a),Nt(c,l,null),se(l,p),y=!0},p(w,a){h=w;const k={};a&8&&(k.calculations=h[12]),a&9&&(k.indicatorMetadata=h[0].find(v)),a&36&&(k.combinedData=h[5][h[14]].filter(h[11])),a&16&&(k.pathFunction=h[4][h[14]]),a&64&&(k.yScale=h[6][h[14]]),a&128&&(k.xScale=h[7][h[14]]),c.$set(k)},i(w){y||(We(c.$$.fragment,w),y=!0)},o(w){it(c.$$.fragment,w),y=!1},d(w){w&&W(l),qt(c)}}}function x_(h){let l,c,p,y=h[8].find(h[9]).areanm+"",v,w,a,k,T=h[3],D=[];for(let A=0;A<T.length;A+=1)D[A]=jd(Gd(h,T,A));const M=A=>it(D[A],1,1,()=>{D[A]=null});return{c(){l=qe("div"),c=qe("div"),p=qe("p"),v=Mt(y),w=vt();for(let A=0;A<D.length;A+=1)D[A].c();this.h()},l(A){l=Ge(A,"DIV",{class:!0,style:!0});var N=me(l);c=Ge(N,"DIV",{class:!0,style:!0});var O=me(c);p=Ge(O,"P",{class:!0});var G=me(p);v=Pt(G,y),G.forEach(W),O.forEach(W),w=xt(N);for(let Q=0;Q<D.length;Q+=1)D[Q].l(N);N.forEach(W),this.h()},h(){S(p,"class","svelte-17hudsm"),S(c,"class","areasColumn svelte-17hudsm"),S(c,"style","width: 200px"),S(l,"class",a=Tr("row cellRow"+h[1])+" svelte-17hudsm"),Bt(l,"background-color",h[1]%2===0?"#fafafa":"#ffffff")},m(A,N){Ze(A,l,N),se(l,c),se(c,p),se(p,v),se(l,w);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(l,null);k=!0},p(A,[N]){if((!k||N&4)&&y!==(y=A[8].find(A[9]).areanm+"")&&$i(v,y),N&253){T=A[3];let O;for(O=0;O<T.length;O+=1){const G=Gd(A,T,O);D[O]?(D[O].p(G,N),We(D[O],1)):(D[O]=jd(G),D[O].c(),We(D[O],1),D[O].m(l,null))}for(vr(),O=T.length;O<D.length;O+=1)M(O);xr()}(!k||N&2&&a!==(a=Tr("row cellRow"+A[1])+" svelte-17hudsm"))&&S(l,"class",a),(!k||N&2)&&Bt(l,"background-color",A[1]%2===0?"#fafafa":"#ffffff")},i(A){if(!k){for(let N=0;N<T.length;N+=1)We(D[N]);k=!0}},o(A){D=D.filter(Boolean);for(let N=0;N<D.length;N+=1)it(D[N]);k=!1},d(A){A&&W(l),Gi(D,A)}}}function b_(h,l,c){let{indicatorsMetadata:p,j:y,row:v,indicatorsCalculations:w,pathFunctionArray:a,combinedDataArray:k,yScaleArray:T,xScaleArray:D}=l,M=mi("areas");const A=G=>G.areacd===v.areacd,N=(G,Q)=>Q.code==G.code,O=G=>G.areacd==v.areacd;return h.$$set=G=>{"indicatorsMetadata"in G&&c(0,p=G.indicatorsMetadata),"j"in G&&c(1,y=G.j),"row"in G&&c(2,v=G.row),"indicatorsCalculations"in G&&c(3,w=G.indicatorsCalculations),"pathFunctionArray"in G&&c(4,a=G.pathFunctionArray),"combinedDataArray"in G&&c(5,k=G.combinedDataArray),"yScaleArray"in G&&c(6,T=G.yScaleArray),"xScaleArray"in G&&c(7,D=G.xScaleArray)},[p,y,v,w,a,k,T,D,M,A,N,O]}class w_ extends di{constructor(l){super(),fi(this,l,b_,x_,pi,{indicatorsMetadata:0,j:1,row:2,indicatorsCalculations:3,pathFunctionArray:4,combinedDataArray:5,yScaleArray:6,xScaleArray:7})}}function Zd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function Xd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function Wd(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function Hd(h){let l,c,p=h[6].label+"",y,v;return{c(){l=qe("div"),c=qe("p"),y=Mt(p),v=vt(),this.h()},l(w){l=Ge(w,"DIV",{class:!0});var a=me(l);c=Ge(a,"P",{class:!0});var k=me(c);y=Pt(k,p),v=xt(k),k.forEach(W),a.forEach(W),this.h()},h(){S(c,"class","svelte-4m9oqo"),S(l,"class",Tr("headerCell column"+h[8])+" svelte-4m9oqo")},m(w,a){Ze(w,l,a),se(l,c),se(c,y),se(c,v)},p(w,a){a&4&&p!==(p=w[6].label+"")&&$i(y,p)},d(w){w&&W(l)}}}function Kd(h){let l,c;return l=new Iu({}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function Jd(h){let l,c="(compared to "+h[3].find(y).label+")",p;function y(...v){return h[5](h[6],...v)}return{c(){l=qe("p"),p=Mt(c),this.h()},l(v){l=Ge(v,"P",{class:!0});var w=me(l);p=Pt(w,c),w.forEach(W),this.h()},h(){S(l,"class","initial-year-label svelte-4m9oqo")},m(v,w){Ze(v,l,w),se(l,p)},p(v,w){h=v,w&4&&c!==(c="(compared to "+h[3].find(y).label+")")&&$i(p,c)},d(v){v&&W(l)}}}function Yd(h){let l,c,p=h[3].find(k).label+"",y,v,w=h[6].minXDomain!=h[6].maxXDomain&(h[1].includes(1)||h[0]!=0),a;function k(...D){return h[4](h[6],...D)}let T=w&&Jd(h);return{c(){l=qe("div"),c=qe("p"),y=Mt(p),v=vt(),T&&T.c(),a=vt(),this.h()},l(D){l=Ge(D,"DIV",{class:!0});var M=me(l);c=Ge(M,"P",{class:!0});var A=me(c);y=Pt(A,p),A.forEach(W),v=xt(M),T&&T.l(M),a=xt(M),M.forEach(W),this.h()},h(){S(c,"class","latest-year-label svelte-4m9oqo"),S(l,"class",Tr("yearCell column"+h[8])+" svelte-4m9oqo")},m(D,M){Ze(D,l,M),se(l,c),se(c,y),se(l,v),T&&T.m(l,null),se(l,a)},p(D,M){h=D,M&4&&p!==(p=h[3].find(k).label+"")&&$i(y,p),M&7&&(w=h[6].minXDomain!=h[6].maxXDomain&(h[1].includes(1)||h[0]!=0)),w?T?T.p(h,M):(T=Jd(h),T.c(),T.m(l,a)):T&&(T.d(1),T=null)},d(D){D&&W(l),T&&T.d()}}}function k_(h){let l,c,p,y,v,w,a,k,T,D,M,A,N=h[2],O=[];for(let Y=0;Y<N.length;Y+=1)O[Y]=Hd(Wd(h,N,Y));let G=h[2],Q=[];for(let Y=0;Y<G.length;Y+=1)Q[Y]=Kd(Xd(h,G,Y));const te=Y=>it(Q[Y],1,1,()=>{Q[Y]=null});let le=h[2],he=[];for(let Y=0;Y<le.length;Y+=1)he[Y]=Yd(Zd(h,le,Y));return{c(){l=qe("div"),c=qe("div"),p=vt();for(let Y=0;Y<O.length;Y+=1)O[Y].c();y=vt(),v=qe("div"),w=qe("div"),a=vt();for(let Y=0;Y<Q.length;Y+=1)Q[Y].c();k=vt(),T=qe("div"),D=qe("div"),M=vt();for(let Y=0;Y<he.length;Y+=1)he[Y].c();this.h()},l(Y){l=Ge(Y,"DIV",{class:!0});var _e=me(l);c=Ge(_e,"DIV",{class:!0,style:!0});var re=me(c);re.forEach(W),p=xt(_e);for(let Te=0;Te<O.length;Te+=1)O[Te].l(_e);_e.forEach(W),y=xt(Y),v=Ge(Y,"DIV",{class:!0});var we=me(v);w=Ge(we,"DIV",{class:!0,style:!0});var Le=me(w);Le.forEach(W),a=xt(we);for(let Te=0;Te<Q.length;Te+=1)Q[Te].l(we);we.forEach(W),k=xt(Y),T=Ge(Y,"DIV",{class:!0});var de=me(T);D=Ge(de,"DIV",{class:!0,style:!0});var be=me(D);be.forEach(W),M=xt(de);for(let Te=0;Te<he.length;Te+=1)he[Te].l(de);de.forEach(W),this.h()},h(){S(c,"class","areasColumn svelte-4m9oqo"),S(c,"style","width: 200px"),S(l,"class","row headerRow svelte-4m9oqo"),S(w,"class","areasColumn svelte-4m9oqo"),S(w,"style","width: 200px"),S(v,"class","row headerRow svelte-4m9oqo"),S(D,"class","areasColumn svelte-4m9oqo"),S(D,"style","width: 200px"),S(T,"class","row headerRow svelte-4m9oqo")},m(Y,_e){Ze(Y,l,_e),se(l,c),se(l,p);for(let re=0;re<O.length;re+=1)O[re]&&O[re].m(l,null);Ze(Y,y,_e),Ze(Y,v,_e),se(v,w),se(v,a);for(let re=0;re<Q.length;re+=1)Q[re]&&Q[re].m(v,null);Ze(Y,k,_e),Ze(Y,T,_e),se(T,D),se(T,M);for(let re=0;re<he.length;re+=1)he[re]&&he[re].m(T,null);A=!0},p(Y,[_e]){if(_e&4){N=Y[2];let re;for(re=0;re<N.length;re+=1){const we=Wd(Y,N,re);O[re]?O[re].p(we,_e):(O[re]=Hd(we),O[re].c(),O[re].m(l,null))}for(;re<O.length;re+=1)O[re].d(1);O.length=N.length}if(_e&4){const re=G.length;G=Y[2];let we;for(we=re;we<G.length;we+=1)Xd(Y,G,we),Q[we]?We(Q[we],1):(Q[we]=Kd(),Q[we].c(),We(Q[we],1),Q[we].m(v,null));for(vr(),we=G.length;we<Q.length;we+=1)te(we);xr()}if(_e&15){le=Y[2];let re;for(re=0;re<le.length;re+=1){const we=Zd(Y,le,re);he[re]?he[re].p(we,_e):(he[re]=Yd(we),he[re].c(),he[re].m(T,null))}for(;re<he.length;re+=1)he[re].d(1);he.length=le.length}},i(Y){if(!A){for(let _e=0;_e<G.length;_e+=1)We(Q[_e]);A=!0}},o(Y){Q=Q.filter(Boolean);for(let _e=0;_e<Q.length;_e+=1)it(Q[_e]);A=!1},d(Y){Y&&W(l),Gi(O,Y),Y&&W(y),Y&&W(v),Gi(Q,Y),Y&&W(k),Y&&W(T),Gi(he,Y)}}}function I_(h,l,c){let{chosenId2:p,chosenId3:y,indicatorsCalculations:v}=l,w=mi("periodsLookup");const a=(T,D)=>D.xDomainNumb==T.maxXDomain,k=(T,D)=>D.xDomainNumb==T.minXDomain;return h.$$set=T=>{"chosenId2"in T&&c(0,p=T.chosenId2),"chosenId3"in T&&c(1,y=T.chosenId3),"indicatorsCalculations"in T&&c(2,v=T.indicatorsCalculations)},[p,y,v,w,a,k]}class E_ extends di{constructor(l){super(),fi(this,l,I_,k_,pi,{chosenId2:0,chosenId3:1,indicatorsCalculations:2})}}function Qd(h,l,c){const p=h.slice();return p[16]=l[c],p[18]=c,p}function $d(h){let l,c;return l=new w_({props:{row:h[16],j:h[18],indicatorsCalculations:h[8],indicatorsMetadata:h[7],pathFunctionArray:h[3],combinedDataArray:h[6],yScaleArray:h[5],xScaleArray:h[4]}}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p(p,y){const v={};y&1&&(v.row=p[16]),y&8&&(v.pathFunctionArray=p[3]),y&64&&(v.combinedDataArray=p[6]),y&32&&(v.yScaleArray=p[5]),y&16&&(v.xScaleArray=p[4]),l.$set(v)},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function T_(h){let l,c,p,y;c=new E_({props:{indicatorsCalculations:h[8],chosenId2:h[1],chosenId3:h[2]}});let v=h[0],w=[];for(let k=0;k<v.length;k+=1)w[k]=$d(Qd(h,v,k));const a=k=>it(w[k],1,1,()=>{w[k]=null});return{c(){l=qe("div"),Vt(c.$$.fragment),p=vt();for(let k=0;k<w.length;k+=1)w[k].c();this.h()},l(k){l=Ge(k,"DIV",{class:!0});var T=me(l);Ut(c.$$.fragment,T),p=xt(T);for(let D=0;D<w.length;D+=1)w[D].l(T);T.forEach(W),this.h()},h(){S(l,"class","grid-container svelte-k2j273")},m(k,T){Ze(k,l,T),Nt(c,l,null),se(l,p);for(let D=0;D<w.length;D+=1)w[D]&&w[D].m(l,null);y=!0},p(k,[T]){const D={};if(T&2&&(D.chosenId2=k[1]),T&4&&(D.chosenId3=k[2]),c.$set(D),T&505){v=k[0];let M;for(M=0;M<v.length;M+=1){const A=Qd(k,v,M);w[M]?(w[M].p(A,T),We(w[M],1)):(w[M]=$d(A),w[M].c(),We(w[M],1),w[M].m(l,null))}for(vr(),M=v.length;M<w.length;M+=1)a(M);xr()}},i(k){if(!y){We(c.$$.fragment,k);for(let T=0;T<v.length;T+=1)We(w[T]);y=!0}},o(k){it(c.$$.fragment,k),w=w.filter(Boolean);for(let T=0;T<w.length;T+=1)it(w[T]);y=!1},d(k){k&&W(l),qt(c),Gi(w,k)}}}function S_(h,l,c){let p,y,v,w,a,{indicatorsList:k,latestData:T,initialData:D,otherData:M,selectedAreas:A,chosenId1:N,chosenId2:O,chosenId3:G,chosenId0:Q}=l,te=mi("indicatorsMetadata"),le=mi("indicatorsCalculations").filter(he=>k.includes(he.id));return h.$$set=he=>{"indicatorsList"in he&&c(9,k=he.indicatorsList),"latestData"in he&&c(10,T=he.latestData),"initialData"in he&&c(11,D=he.initialData),"otherData"in he&&c(12,M=he.otherData),"selectedAreas"in he&&c(0,A=he.selectedAreas),"chosenId1"in he&&c(13,N=he.chosenId1),"chosenId2"in he&&c(1,O=he.chosenId2),"chosenId3"in he&&c(2,G=he.chosenId3),"chosenId0"in he&&c(14,Q=he.chosenId0)},h.$$.update=()=>{h.$$.dirty&1&&c(15,a=A.map(he=>he.areacd)),h.$$.dirty&56320&&le.forEach((he,Y)=>{he.medianValue=he.ltCount>200?he.ltMedian:he.utCount>140?he.utMedian:he.ukValue!="NA"?he.ukValue:he.gbValue!="NA"?he.gbValue:he.ewValue!="NA"?he.ewValue:he.engValue!="NA"?he.engValue:null;let _e=T.filter(Ce=>Ce.id==he.id),re="indicator-"+he.id in D?D["indicator-"+he.id]:[],we="indicator-"+he.id in M?M["indicator-"+he.id]:[],Le=[...re,...we,..._e];c(6,p[Y]=Le,p);let de=Q==0?Math.max(...Le.map(Ce=>Math.abs(Ce.value-he.medianValue))):Math.max(...Le.filter(Ce=>a.includes(Ce.areacd)).map(Ce=>Math.abs(Ce.value-he.medianValue)));he.label=te.find(Ce=>Ce.code==he.code).label;let be=$l().domain([he.minXDomain,he.maxXDomain]).range([0,60]),Te=$l().domain([he.medianValue-de,parseFloat(he.medianValue)+parseFloat(de)]).range(te.find(Ce=>Ce.code==he.code).polarity==1?[60,0]:[0,60]);c(5,v[Y]=Te,v),c(4,w[Y]=be,w),c(3,y[Y]=pg().x(Ce=>be(Ce.xDomainNumb)).y(Ce=>Te(Ce.value)),y)})},c(6,p=new Array(le.length)),c(3,y=new Array(le.length)),c(5,v=new Array(le.length)),c(4,w=new Array(le.length)),[A,O,G,y,w,v,p,te,le,k,T,D,M,N,Q,a]}class A_ extends di{constructor(l){super(),fi(this,l,S_,T_,pi,{indicatorsList:9,latestData:10,initialData:11,otherData:12,selectedAreas:0,chosenId1:13,chosenId2:1,chosenId3:2,chosenId0:14})}}function D_(h){let l,c,p,y,v,w,a,k,T,D;function M(O){h[9](O)}function A(O){h[10](O)}let N={radioName:"timeSeriesRadio",latestData:h[2]};return h[0]!==void 0&&(N.checkboxedRoles=h[0]),h[6]!==void 0&&(N.chosenId=h[6]),c=new Eu({props:N}),gi.push(()=>bi(c,"checkboxedRoles",M)),gi.push(()=>bi(c,"chosenId",A)),a=new p_({}),T=new A_({props:{indicatorsList:h[1],latestData:h[2],initialData:h[3],otherData:h[4],selectedAreas:h[7],chosenId1:h[6],chosenId2:C_,chosenId3:h[8],chosenId0:h[5]}}),{c(){l=qe("div"),Vt(c.$$.fragment),v=vt(),w=qe("div"),Vt(a.$$.fragment),k=vt(),Vt(T.$$.fragment),this.h()},l(O){l=Ge(O,"DIV",{class:!0});var G=me(l);Ut(c.$$.fragment,G),v=xt(G),w=Ge(G,"DIV",{class:!0});var Q=me(w);Ut(a.$$.fragment,Q),Q.forEach(W),k=xt(G),Ut(T.$$.fragment,G),G.forEach(W),this.h()},h(){S(w,"class","key-and-selections-container svelte-1xm9yo2"),S(l,"class","key-indicators-dot-plot-boxes-option-2-container")},m(O,G){Ze(O,l,G),Nt(c,l,null),se(l,v),se(l,w),Nt(a,w,null),se(l,k),Nt(T,l,null),D=!0},p(O,[G]){const Q={};G&4&&(Q.latestData=O[2]),!p&&G&1&&(p=!0,Q.checkboxedRoles=O[0],wi(()=>p=!1)),!y&&G&64&&(y=!0,Q.chosenId=O[6],wi(()=>y=!1)),c.$set(Q);const te={};G&2&&(te.indicatorsList=O[1]),G&4&&(te.latestData=O[2]),G&8&&(te.initialData=O[3]),G&16&&(te.otherData=O[4]),G&128&&(te.selectedAreas=O[7]),G&64&&(te.chosenId1=O[6]),G&32&&(te.chosenId0=O[5]),T.$set(te)},i(O){D||(We(c.$$.fragment,O),We(a.$$.fragment,O),We(T.$$.fragment,O),D=!0)},o(O){it(c.$$.fragment,O),it(a.$$.fragment,O),it(T.$$.fragment,O),D=!1},d(O){O&&W(l),qt(c),qt(a),qt(T)}}}let C_=2;function z_(h,l,c){let p,{indicatorsList:y,latestData:v,initialData:w,otherData:a,checkboxedRoles:k,chosenId0:T}=l,D=0,M=[],N=mi("areasParentsLookup").filter(Q=>["K02000001","E92000001"].includes(Q.parentcd)&Q.areacd!="E92000001");function O(Q){k=Q,c(0,k)}function G(Q){D=Q,c(6,D)}return h.$$set=Q=>{"indicatorsList"in Q&&c(1,y=Q.indicatorsList),"latestData"in Q&&c(2,v=Q.latestData),"initialData"in Q&&c(3,w=Q.initialData),"otherData"in Q&&c(4,a=Q.otherData),"checkboxedRoles"in Q&&c(0,k=Q.checkboxedRoles),"chosenId0"in Q&&c(5,T=Q.chosenId0)},h.$$.update=()=>{h.$$.dirty&65&&c(7,p=D===0?N:k.custom==null||k.custom==null?[]:k.custom)},[k,y,v,w,a,T,D,p,M,O,G]}class M_ extends di{constructor(l){super(),fi(this,l,z_,D_,pi,{indicatorsList:1,latestData:2,initialData:3,otherData:4,checkboxedRoles:0,chosenId0:5})}}function P_(h){let l,c,p,y,v,w,a,k,T,D,M,A,N,O,G,Q;function te(de){h[6](de)}let le={indicatorsList:h[1],latestData:h[2],initialData:h[3]};h[0]!==void 0&&(le.checkboxedRoles=h[0]),c=new jg({props:le}),gi.push(()=>bi(c,"checkboxedRoles",te));function he(de){h[7](de)}let Y={optionsArray:["Scaling compared to all areas","Scaling compared to selected areas"],name:"chosenComparison",marginBottom:"0px",fontSize:"16px"};h[5]!==void 0&&(Y.chosenId=h[5]),w=new qo({props:Y}),gi.push(()=>bi(w,"chosenId",he));function _e(de){h[8](de)}let re={indicatorsList:h[1],latestData:h[2],initialData:h[3],chosenId0:h[5]};h[0]!==void 0&&(re.checkboxedRoles=h[0]),D=new d_({props:re}),gi.push(()=>bi(D,"checkboxedRoles",_e));function we(de){h[9](de)}let Le={chosenId0:h[5],indicatorsList:h[1],latestData:h[2],initialData:h[3],otherData:h[4]};return h[0]!==void 0&&(Le.checkboxedRoles=h[0]),O=new M_({props:Le}),gi.push(()=>bi(O,"checkboxedRoles",we)),{c(){l=qe("div"),Vt(c.$$.fragment),y=vt(),v=qe("div"),Vt(w.$$.fragment),k=vt(),T=qe("div"),Vt(D.$$.fragment),A=vt(),N=qe("div"),Vt(O.$$.fragment),this.h()},l(de){l=Ge(de,"DIV",{class:!0});var be=me(l);Ut(c.$$.fragment,be),be.forEach(W),y=xt(de),v=Ge(de,"DIV",{class:!0});var Te=me(v);Ut(w.$$.fragment,Te),Te.forEach(W),k=xt(de),T=Ge(de,"DIV",{class:!0});var Ce=me(T);Ut(D.$$.fragment,Ce),Ce.forEach(W),A=xt(de),N=Ge(de,"DIV",{class:!0});var rt=me(N);Ut(O.$$.fragment,rt),rt.forEach(W),this.h()},h(){S(l,"class","key-indicators-container svelte-19nv6qm"),S(v,"class","temporary-difference-options-container svelte-19nv6qm"),S(T,"class","key-indicators-container svelte-19nv6qm"),S(N,"class","key-indicators-container svelte-19nv6qm")},m(de,be){Ze(de,l,be),Nt(c,l,null),Ze(de,y,be),Ze(de,v,be),Nt(w,v,null),Ze(de,k,be),Ze(de,T,be),Nt(D,T,null),Ze(de,A,be),Ze(de,N,be),Nt(O,N,null),Q=!0},p(de,[be]){const Te={};be&2&&(Te.indicatorsList=de[1]),be&4&&(Te.latestData=de[2]),be&8&&(Te.initialData=de[3]),!p&&be&1&&(p=!0,Te.checkboxedRoles=de[0],wi(()=>p=!1)),c.$set(Te);const Ce={};!a&&be&32&&(a=!0,Ce.chosenId=de[5],wi(()=>a=!1)),w.$set(Ce);const rt={};be&2&&(rt.indicatorsList=de[1]),be&4&&(rt.latestData=de[2]),be&8&&(rt.initialData=de[3]),be&32&&(rt.chosenId0=de[5]),!M&&be&1&&(M=!0,rt.checkboxedRoles=de[0],wi(()=>M=!1)),D.$set(rt);const nt={};be&32&&(nt.chosenId0=de[5]),be&2&&(nt.indicatorsList=de[1]),be&4&&(nt.latestData=de[2]),be&8&&(nt.initialData=de[3]),be&16&&(nt.otherData=de[4]),!G&&be&1&&(G=!0,nt.checkboxedRoles=de[0],wi(()=>G=!1)),O.$set(nt)},i(de){Q||(We(c.$$.fragment,de),We(w.$$.fragment,de),We(D.$$.fragment,de),We(O.$$.fragment,de),Q=!0)},o(de){it(c.$$.fragment,de),it(w.$$.fragment,de),it(D.$$.fragment,de),it(O.$$.fragment,de),Q=!1},d(de){de&&W(l),qt(c),de&&W(y),de&&W(v),qt(w),de&&W(k),de&&W(T),qt(D),de&&W(A),de&&W(N),qt(O)}}}function L_(h,l,c){let{indicatorsList:p,latestData:y,initialData:v,checkboxedRoles:w,otherData:a}=l,k=0;function T(N){w=N,c(0,w)}function D(N){k=N,c(5,k)}function M(N){w=N,c(0,w)}function A(N){w=N,c(0,w)}return h.$$set=N=>{"indicatorsList"in N&&c(1,p=N.indicatorsList),"latestData"in N&&c(2,y=N.latestData),"initialData"in N&&c(3,v=N.initialData),"checkboxedRoles"in N&&c(0,w=N.checkboxedRoles),"otherData"in N&&c(4,a=N.otherData)},[w,p,y,v,a,k,T,D,M,A]}class R_ extends di{constructor(l){super(),fi(this,l,L_,P_,pi,{indicatorsList:1,latestData:2,initialData:3,checkboxedRoles:0,otherData:4})}}var Sf={exports:{}};(function(h,l){(function(c,p){h.exports=p()})(Qm,function(){var c,p,y;function v(a,k){if(!c)c=k;else if(!p)p=k;else{var T="var sharedChunk = {}; ("+c+")(sharedChunk); ("+p+")(sharedChunk);",D={};c(D),y=k(D),typeof window<"u"&&(y.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}v(["exports"],function(a){var k=T;function T(i,e,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=s}function D(i,e,r,s){const d=new k(i,e,r,s);return function(m){return d.solve(m)}}T.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var d=this.sampleCurveX(r)-i;if(Math.abs(d)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=d/m}var _=0,b=1;for(r=i,s=0;s<20&&(d=this.sampleCurveX(r),!(Math.abs(d-i)<e));s++)i>d?_=r:b=r,r=.5*(b-_)+_;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const M=D(.25,.1,.25,1);function A(i,e,r){return Math.min(r,Math.max(e,i))}function N(i,e,r){const s=r-e,d=((i-e)%s+s)%s+e;return d===e?r:d}function O(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}let G=1;function Q(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function te(i,e,r){const s={};for(const d in i)s[d]=e.call(r||this,i[d],d,i);return s}function le(i,e,r){const s={};for(const d in i)e.call(r||this,i[d],d,i)&&(s[d]=i[d]);return s}function he(i){return Array.isArray(i)?i.map(he):typeof i=="object"&&i?te(i,he):i}const Y={};function _e(i){Y[i]||(typeof console<"u"&&console.warn(i),Y[i]=!0)}function re(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function we(i){let e=0;for(let r,s,d=0,m=i.length,_=m-1;d<m;_=d++)r=i[d],s=i[_],e+=(s.x-r.x)*(r.y+s.y);return e}function Le(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function de(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,d,m)=>{const _=d||m;return e[s]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let be,Te,Ce=null;function rt(i){if(Ce==null){const e=i.navigator?i.navigator.userAgent:null;Ce=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ce}function nt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ve={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,s.drawImage(i,0,0,i.width,i.height),s.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(be||(be=document.createElement("a")),be.href=i,be.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Te==null&&(Te=matchMedia("(prefers-reduced-motion: reduce)")),Te.matches)}};var Ue=Oe;function Oe(i,e){this.x=i,this.y=e}Oe.prototype={clone:function(){return new Oe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,e){var r=Math.cos(i),s=Math.sin(i),d=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Oe.convert=function(i){return i instanceof Oe?i:Array.isArray(i)?new Oe(i[0],i[1]):i};const et={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},tt="mapbox-tiles";let ft,Gt,zt=500,Ke=50;function Tt(){typeof caches>"u"||ft||(ft=caches.open(tt))}let Ct=1/0;const ti={supported:!1,testSupport:function(i){!Ye&&_i&&(Zt?He(i):hi=i)}};let hi,_i,Ye=!1,Zt=!1;function He(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,_i),i.isContextLost())return;ti.supported=!0}catch{}i.deleteTexture(e),Ye=!0}typeof document<"u"&&(_i=document.createElement("img"),_i.onload=function(){hi&&He(hi),hi=null,Zt=!0},_i.onerror=function(){Ye=!0,hi=null},_i.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ii={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ii);class Ri extends Error{constructor(e,r,s,d){super(`AJAXError: ${r} (${e}): ${s}`),this.status=e,this.statusText=r,this.url=s,this.body=d}}const br=Le()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Hi(i,e){const r=new AbortController,s=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:br(),signal:r.signal});let d=!1,m=!1;return i.type==="json"&&s.headers.set("Accept","application/json"),((_,b,I)=>{if(m)return;const z=Date.now();fetch(s).then(R=>R.ok?((F,q,Z)=>{(i.type==="arrayBuffer"?F.arrayBuffer():i.type==="json"?F.json():F.text()).then(X=>{m||(q&&Z&&function(oe,ae,ke){if(Tt(),!ft)return;const De={status:ae.status,statusText:ae.statusText,headers:new Headers};ae.headers.forEach((Se,je)=>De.headers.set(je,Se));const xe=de(ae.headers.get("Cache-Control")||"");xe["no-store"]||(xe["max-age"]&&De.headers.set("Expires",new Date(ke+1e3*xe["max-age"]).toUTCString()),new Date(De.headers.get("Expires")).getTime()-ke<42e4||function(Se,je){if(Gt===void 0)try{new Response(new ReadableStream),Gt=!0}catch{Gt=!1}Gt?je(Se.body):Se.blob().then(je)}(ae,Se=>{const je=new Response(Se,De);Tt(),ft&&ft.then(Ne=>Ne.put(function(wt){const Et=wt.indexOf("?");return Et<0?wt:wt.slice(0,Et)}(oe.url),je)).catch(Ne=>_e(Ne.message))}))}(s,q,Z),d=!0,e(null,X,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(X=>{m||e(new Error(X.message))})})(R,null,z):R.blob().then(F=>e(new Ri(R.status,R.statusText,i.url,F)))).catch(R=>{R.code!==20&&e(new Error(R.message))})})(),{cancel:()=>{m=!0,d||r.abort()}}}const Kr=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Le()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!Le()){const s=i.url.substring(0,i.url.indexOf("://"));return(et.REGISTERED_PROTOCOLS[s]||Hi)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(br())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Hi(i,e);if(Le()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(s,d){const m=new XMLHttpRequest;m.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in s.headers)m.setRequestHeader(_,s.headers[_]);return s.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=s.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(s.type==="json")try{_=JSON.parse(m.response)}catch(b){return d(b)}d(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const _=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});d(new Ri(m.status,m.statusText,s.url,_))}},m.send(s.body),{cancel:()=>m.abort()}}(i,e)},Jr=function(i,e){return Kr(O(i,{type:"arrayBuffer"}),e)};function Yr(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const ai="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let $e,Xi;$e=[],Xi=0;const Mr=function(i,e){if(ti.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Xi>=et.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return $e.push(m),m}Xi++;let r=!1;const s=()=>{if(!r)for(r=!0,Xi--;$e.length&&Xi<et.MAX_PARALLEL_IMAGE_REQUESTS;){const m=$e.shift(),{requestParameters:_,callback:b,cancelled:I}=m;I||(m.cancel=Mr(_,b).cancel)}},d=Jr(i,(m,_,b,I)=>{s(),m?e(m):_&&function(z,R){typeof createImageBitmap=="function"?function(F,q){const Z=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(Z).then(X=>{q(null,X)}).catch(X=>{q(new Error(`Could not load image because of ${X.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(z,R):function(F,q){const Z=new Image;Z.onload=()=>{q(null,Z),URL.revokeObjectURL(Z.src),Z.onload=null,window.requestAnimationFrame(()=>{Z.src=ai})},Z.onerror=()=>q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new Blob([new Uint8Array(F)],{type:"image/png"});Z.src=F.byteLength?URL.createObjectURL(X):ai}(z,R)}(_,(z,R)=>{z!=null?e(z):R!=null&&e(null,R,{cacheControl:b,expires:I})})});return{cancel:()=>{d.cancel(),s()}}};function Sa(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function mn(i,e,r){if(r&&r[i]){const s=r[i].indexOf(e);s!==-1&&r[i].splice(s,1)}}class gn{constructor(e,r={}){O(this,r),this.type=e}}class na extends gn{constructor(e,r={}){super("error",O({error:e},r))}}class _n{on(e,r){return this._listeners=this._listeners||{},Sa(e,r,this._listeners),this}off(e,r){return mn(e,r,this._listeners),mn(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Sa(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new gn(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const d=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const b of d)b.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const b of m)mn(s,b,this._oneTimeListeners),b.call(this,e);const _=this._eventedParent;_&&(O(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof na&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class ht{constructor(e,r,s,d){this.message=(e?`${e}: `:"")+s,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function Vn(i){const e=i.value;return e?[new ht(i.key,e,"constants have been deprecated as of v8")]:[]}function Qr(i,...e){for(const r of e)for(const s in r)i[s]=r[s];return i}function oi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function jr(i){if(Array.isArray(i))return i.map(jr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=jr(i[r]);return e}return oi(i)}class Pr extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Lr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,d]of r)this.bindings[s]=d}concat(e){return new Lr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const An={kind:"null"},st={kind:"number"},Jt={kind:"string"},Ht={kind:"boolean"},hr={kind:"color"},Dn={kind:"object"},Wt={kind:"value"},yn={kind:"collator"},rr={kind:"formatted"},aa={kind:"padding"},Ki={kind:"resolvedImage"};function wr(i,e){return{kind:"array",itemType:i,N:e}}function Ei(i){if(i.kind==="array"){const e=Ei(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const sa=[An,st,Jt,Ht,hr,rr,Dn,wr(Wt),aa,Ki];function ln(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ln(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of sa)if(!ln(r,e))return null}}return`Expected ${Ei(i)} but found ${Ei(e)} instead.`}function Un(i,e){return e.some(r=>r.kind===i.kind)}function Nn(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var oa,qn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function J(i){return(i=Math.round(i))<0?0:i>255?255:i}function L(i){return J(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function V(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function H(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{oa={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in qn)return qn[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),d=r.indexOf(")");if(s!==-1&&d+1===r.length){var m=r.substr(0,s),_=r.substr(s+1,d-(s+1)).split(","),b=1;switch(m){case"rgba":if(_.length!==4)return null;b=V(_.pop());case"rgb":return _.length!==3?null:[L(_[0]),L(_[1]),L(_[2]),b];case"hsla":if(_.length!==4)return null;b=V(_.pop());case"hsl":if(_.length!==3)return null;var I=(parseFloat(_[0])%360+360)%360/360,z=V(_[1]),R=V(_[2]),F=R<=.5?R*(z+1):R+z-R*z,q=2*R-F;return[J(255*H(q,F,I+1/3)),J(255*H(q,F,I)),J(255*H(q,F,I-1/3)),b];default:return null}}return null}}catch{}class K{constructor(e,r,s,d=1){this.r=e,this.g=r,this.b=s,this.a=d}static parse(e){if(!e)return;if(e instanceof K)return e;if(typeof e!="string")return;const r=oa(e);return r?new K(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${d})`}toArray(){const{r:e,g:r,b:s,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*r/d,255*s/d,d]}}K.black=new K(0,0,0,1),K.white=new K(1,1,1,1),K.transparent=new K(0,0,0,0),K.red=new K(1,0,0,1);class ce{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ge{constructor(e,r,s,d,m){this.text=e,this.image=r,this.scale=s,this.fontStack=d,this.textColor=m}}class fe{constructor(e){this.sections=e}static fromString(e){return new fe([new ge(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof fe?e:fe.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ue{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ue)return e;if(typeof e=="number")return new ue([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ue(e)}}toString(){return JSON.stringify(this.values)}}class ye{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ye({name:e,available:!1}):null}}function Me(i,e,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,e,r,s]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xe(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof K||i instanceof ce||i instanceof fe||i instanceof ue||i instanceof ye)return!0;if(Array.isArray(i)){for(const e of i)if(!Xe(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Xe(i[e]))return!1;return!0}return!1}function ze(i){if(i===null)return An;if(typeof i=="string")return Jt;if(typeof i=="boolean")return Ht;if(typeof i=="number")return st;if(i instanceof K)return hr;if(i instanceof ce)return yn;if(i instanceof fe)return rr;if(i instanceof ue)return aa;if(i instanceof ye)return Ki;if(Array.isArray(i)){const e=i.length;let r;for(const s of i){const d=ze(s);if(r){if(r===d)continue;r=Wt;break}r=d}return wr(r||Wt,e)}return Dn}function It(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof K||i instanceof fe||i instanceof ue||i instanceof ye?i.toString():JSON.stringify(i)}class St{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Xe(e[1]))return r.error("invalid value");const s=e[1];let d=ze(s);const m=r.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new St(d,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _t{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ft={string:Jt,number:st,boolean:Ht,object:Dn};class jt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,d=1;const m=e[0];if(m==="array"){let b,I;if(e.length>2){const z=e[1];if(typeof z!="string"||!(z in Ft)||z==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ft[z],d++}else b=Wt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);I=e[2],d++}s=wr(b,I)}else{if(!Ft[m])throw new Error(`Types doesn't contain name = ${m}`);s=Ft[m]}const _=[];for(;d<e.length;d++){const b=r.parse(e[d],d,Wt);if(!b)return null;_.push(b)}return new jt(s,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!ln(this.type,ze(s)))return s;if(r===this.args.length-1)throw new _t(`Expected value to be of type ${Ei(this.type)}, but found ${Ei(ze(s))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const li={"to-boolean":Ht,"to-color":hr,"to-number":st,"to-string":Jt};class Xt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(!li[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const d=li[s],m=[];for(let _=1;_<e.length;_++){const b=r.parse(e[_],_,Wt);if(!b)return null;m.push(b)}return new Xt(d,m)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,s;for(const d of this.args){if(r=d.evaluate(e),s=null,r instanceof K)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Me(r[0],r[1],r[2],r[3]),!s))return new K(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new _t(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const s of this.args){r=s.evaluate(e);const d=ue.parse(r);if(d)return d}throw new _t(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new _t(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?fe.fromString(It(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ye.fromString(It(this.args[0].evaluate(e))):It(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Yt=["Unknown","Point","LineString","Polygon"];class ci{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=K.parse(e)),r}}class Si{constructor(e,r,s,d){this.name=e,this.type=r,this._evaluate=s,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const s=e[0],d=Si.definitions[s];if(!d)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=_.filter(([z])=>!Array.isArray(z)||z.length===e.length-1);let I=null;for(const[z,R]of b){I=new ua(r.registry,r.path,null,r.scope);const F=[];let q=!1;for(let Z=1;Z<e.length;Z++){const X=e[Z],oe=Array.isArray(z)?z[Z-1]:z.type,ae=I.parse(X,1+F.length,oe);if(!ae){q=!0;break}F.push(ae)}if(!q)if(Array.isArray(z)&&z.length!==F.length)I.error(`Expected ${z.length} arguments, but found ${F.length} instead.`);else{for(let Z=0;Z<F.length;Z++){const X=Array.isArray(z)?z[Z]:z.type,oe=F[Z];I.concat(Z+1).checkSubtype(X,oe.type)}if(I.errors.length===0)return new Si(s,m,R,F)}}if(b.length===1)r.errors.push(...I.errors);else{const z=(b.length?b:_).map(([F])=>{return q=F,Array.isArray(q)?`(${q.map(Ei).join(", ")})`:`(${Ei(q.type)}...)`;var q}).join(" | "),R=[];for(let F=1;F<e.length;F++){const q=r.parse(e[F],1+R.length);if(!q)return null;R.push(Ei(q.type))}r.error(`Expected arguments of type ${z}, but found (${R.join(", ")}) instead.`)}return null}static register(e,r){Si.definitions=r;for(const s in r)e[s]=Si}}class nr{constructor(e,r,s){this.type=yn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const d=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ht);if(!d)return null;const m=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ht);if(!m)return null;let _=null;return s.locale&&(_=r.parse(s.locale,1,Jt),!_)?null:new nr(d,m,_)}evaluate(e){return new ce(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Bi=8192;function pr(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function la(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Aa(i,e){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(r*d*Bi),Math.round(s*d*Bi)]}function Ai(i,e,r){const s=i[0]-e[0],d=i[1]-e[1],m=i[0]-r[0],_=i[1]-r[1];return s*_-m*d==0&&s*m<=0&&d*_<=0}function Vs(i,e){let r=!1;for(let _=0,b=e.length;_<b;_++){const I=e[_];for(let z=0,R=I.length;z<R-1;z++){if(Ai(i,I[z],I[z+1]))return!1;(d=I[z])[1]>(s=i)[1]!=(m=I[z+1])[1]>s[1]&&s[0]<(m[0]-d[0])*(s[1]-d[1])/(m[1]-d[1])+d[0]&&(r=!r)}}var s,d,m;return r}function Us(i,e){for(let r=0;r<e.length;r++)if(Vs(i,e[r]))return!0;return!1}function jo(i,e,r,s){const d=s[0]-r[0],m=s[1]-r[1],_=(i[0]-r[0])*m-d*(i[1]-r[1]),b=(e[0]-r[0])*m-d*(e[1]-r[1]);return _>0&&b<0||_<0&&b>0}function Zo(i,e,r){for(const z of r)for(let R=0;R<z.length-1;++R)if((b=[(_=z[R+1])[0]-(m=z[R])[0],_[1]-m[1]])[0]*(I=[(d=e)[0]-(s=i)[0],d[1]-s[1]])[1]-b[1]*I[0]!=0&&jo(s,d,m,_)&&jo(m,_,s,d))return!0;var s,d,m,_,b,I;return!1}function Ns(i,e){for(let r=0;r<i.length;++r)if(!Vs(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Zo(i[r],i[r+1],e))return!1;return!0}function sc(i,e){for(let r=0;r<e.length;r++)if(Ns(i,e[r]))return!0;return!1}function ns(i,e,r){const s=[];for(let d=0;d<i.length;d++){const m=[];for(let _=0;_<i[d].length;_++){const b=Aa(i[d][_],r);pr(e,b),m.push(b)}s.push(m)}return s}function qs(i,e,r){const s=[];for(let d=0;d<i.length;d++){const m=ns(i[d],e,r);s.push(m)}return s}function Xo(i,e,r,s){if(i[0]<r[0]||i[0]>r[2]){const d=.5*s;let m=i[0]-r[0]>d?-s:r[0]-i[0]>d?s:0;m===0&&(m=i[0]-r[2]>d?-s:r[2]-i[0]>d?s:0),i[0]+=m}pr(e,i)}function Wo(i,e,r,s){const d=Math.pow(2,s.z)*Bi,m=[s.x*Bi,s.y*Bi],_=[];for(const b of i)for(const I of b){const z=[I.x+m[0],I.y+m[1]];Xo(z,e,r,d),_.push(z)}return _}function Ho(i,e,r,s){const d=Math.pow(2,s.z)*Bi,m=[s.x*Bi,s.y*Bi],_=[];for(const I of i){const z=[];for(const R of I){const F=[R.x+m[0],R.y+m[1]];pr(e,F),z.push(F)}_.push(z)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const I of _)for(const z of I)Xo(z,e,r,d)}var b;return _}class Gn{constructor(e,r){this.type=Ht,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Xe(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let d=0;d<s.features.length;++d){const m=s.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Gn(s,s.features[d].geometry)}else if(s.type==="Feature"){const d=s.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Gn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Gn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(s.type==="Polygon"){const b=ns(s.coordinates,m,_),I=Wo(r.geometry(),d,m,_);if(!la(d,m))return!1;for(const z of I)if(!Vs(z,b))return!1}if(s.type==="MultiPolygon"){const b=qs(s.coordinates,m,_),I=Wo(r.geometry(),d,m,_);if(!la(d,m))return!1;for(const z of I)if(!Us(z,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(s.type==="Polygon"){const b=ns(s.coordinates,m,_),I=Ho(r.geometry(),d,m,_);if(!la(d,m))return!1;for(const z of I)if(!Ns(z,b))return!1}if(s.type==="MultiPolygon"){const b=qs(s.coordinates,m,_),I=Ho(r.geometry(),d,m,_);if(!la(d,m))return!1;for(const z of I)if(!sc(z,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Da(i){if(i instanceof Si&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Gn)return!1;let e=!0;return i.eachChild(r=>{e&&!Da(r)&&(e=!1)}),e}function ca(i){if(i instanceof Si&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!ca(r)&&(e=!1)}),e}function as(i,e){if(i instanceof Si&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!as(s,e)&&(r=!1)}),r}class ss{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new ss(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ua{constructor(e,r=[],s,d=new Lr,m=[]){this.registry=e,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=m,this.expectedType=s}parse(e,r,s,d,m={}){return r?this.concat(r,s,d)._parse(e,m):this._parse(e,m)}_parse(e,r){function s(d,m,_){return _==="assert"?new jt(m,[d]):_==="coerce"?new Xt(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let _=m.parse(e,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,I=_.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||I.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(b.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array"){if(this.checkSubtype(b,I))return null}else _=s(_,b,r.typeAnnotation||"coerce");else _=s(_,b,r.typeAnnotation||"coerce");else _=s(_,b,r.typeAnnotation||"assert")}if(!(_ instanceof St)&&_.type.kind!=="resolvedImage"&&Gs(_)){const b=new ci;try{_=new St(_.type,_.evaluate(b))}catch(I){return this.error(I.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const d=typeof e=="number"?this.path.concat(e):this.path,m=s?this.scope.concat(s):this.scope;return new ua(this.registry,d,r||null,m,this.errors)}error(e,...r){const s=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new Pr(s,e))}checkSubtype(e,r){const s=ln(e,r);return s&&this.error(s),s}}function Gs(i){if(i instanceof ss)return Gs(i.boundExpression);if(i instanceof Si&&i.name==="error"||i instanceof nr||i instanceof Gn)return!1;const e=i instanceof Xt||i instanceof jt;let r=!0;return i.eachChild(s=>{r=e?r&&Gs(s):r&&s instanceof St}),!!r&&Da(i)&&as(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function os(i,e){const r=i.length-1;let s,d,m=0,_=r,b=0;for(;m<=_;)if(b=Math.floor((m+_)/2),s=i[b],d=i[b+1],s<=e){if(b===r||e<d)return b;m=b+1}else{if(!(s>e))throw new _t("Input is not a number.");_=b-1}return 0}class Ca{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[d,m]of s)this.labels.push(d),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,st);if(!s)return null;const d=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let _=1;_<e.length;_+=2){const b=_===1?-1/0:e[_],I=e[_+1],z=_,R=_+1;if(typeof b!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(d.length&&d[d.length-1][0]>=b)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const F=r.parse(I,R,m);if(!F)return null;m=m||F.type,d.push([b,F])}return new Ca(m,s,d)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return s[0].evaluate(e);const m=r.length;return d>=r[m-1]?s[m-1].evaluate(e):s[os(r,d)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Fi(i,e,r){return i*(1-r)+e*r}var za=Object.freeze({__proto__:null,number:Fi,color:function(i,e,r){return new K(Fi(i.r,e.r,r),Fi(i.g,e.g,r),Fi(i.b,e.b,r),Fi(i.a,e.a,r))},array:function(i,e,r){return i.map((s,d)=>Fi(s,e[d],r))},padding:function(i,e,r){const s=i.values,d=e.values;return new ue([Fi(s[0],d[0],r),Fi(s[1],d[1],r),Fi(s[2],d[2],r),Fi(s[3],d[3],r)])}});const Ko=.95047,Jo=1.08883,js=4/29,ls=6/29,Yo=3*ls*ls,oc=Math.PI/180,lc=180/Math.PI;function Zs(i){return i>.008856451679035631?Math.pow(i,1/3):i/Yo+js}function Xs(i){return i>ls?i*i*i:Yo*(i-js)}function Ws(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Hs(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function yi(i){const e=Hs(i.r),r=Hs(i.g),s=Hs(i.b),d=Zs((.4124564*e+.3575761*r+.1804375*s)/Ko),m=Zs((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Zs((.0193339*e+.119192*r+.9503041*s)/Jo)),alpha:i.a}}function Qo(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,s=isNaN(i.b)?e:e-i.b/200;return e=1*Xs(e),r=Ko*Xs(r),s=Jo*Xs(s),new K(Ws(3.2404542*r-1.5371385*e-.4985314*s),Ws(-.969266*r+1.8760108*e+.041556*s),Ws(.0556434*r-.2040259*e+1.0572252*s),i.alpha)}function cc(i,e,r){const s=e-i;return i+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ma={forward:yi,reverse:Qo,interpolate:function(i,e,r){return{l:Fi(i.l,e.l,r),a:Fi(i.a,e.a,r),b:Fi(i.b,e.b,r),alpha:Fi(i.alpha,e.alpha,r)}}},Pa={forward:function(i){const{l:e,a:r,b:s}=yi(i),d=Math.atan2(s,r)*lc;return{h:d<0?d+360:d,c:Math.sqrt(r*r+s*s),l:e,alpha:i.a}},reverse:function(i){const e=i.h*oc,r=i.c;return Qo({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:cc(i.h,e.h,r),c:Fi(i.c,e.c,r),l:Fi(i.l,e.l,r),alpha:Fi(i.alpha,e.alpha,r)}}};var $o=Object.freeze({__proto__:null,lab:Ma,hcl:Pa});class Rr{constructor(e,r,s,d,m){this.type=e,this.operator=r,this.interpolation=s,this.input=d,this.labels=[],this.outputs=[];for(const[_,b]of m)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(e,r,s,d){let m=0;if(e.name==="exponential")m=Ks(r,e.base,s,d);else if(e.name==="linear")m=Ks(r,1,s,d);else if(e.name==="cubic-bezier"){const _=e.controlPoints;m=new k(_[0],_[1],_[2],_[3]).solve(Ks(r,1,s,d))}return m}static parse(e,r){let[s,d,m,..._]=e;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const z=d[1];if(typeof z!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:z}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const z=d.slice(1);if(z.length!==4||z.some(R=>typeof R!="number"||R<0||R>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:z}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,st),!m)return null;const b=[];let I=null;s==="interpolate-hcl"||s==="interpolate-lab"?I=hr:r.expectedType&&r.expectedType.kind!=="value"&&(I=r.expectedType);for(let z=0;z<_.length;z+=2){const R=_[z],F=_[z+1],q=z+3,Z=z+4;if(typeof R!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(b.length&&b[b.length-1][0]>=R)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const X=r.parse(F,Z,I);if(!X)return null;I=I||X.type,b.push([R,X])}return I.kind==="number"||I.kind==="color"||I.kind==="padding"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new Rr(I,s,d,m,b):r.error(`Type ${Ei(I)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return s[0].evaluate(e);const m=r.length;if(d>=r[m-1])return s[m-1].evaluate(e);const _=os(r,d),b=Rr.interpolationFactor(this.interpolation,d,r[_],r[_+1]),I=s[_].evaluate(e),z=s[_+1].evaluate(e);return this.operator==="interpolate"?za[this.type.kind.toLowerCase()](I,z,b):this.operator==="interpolate-hcl"?Pa.reverse(Pa.interpolate(Pa.forward(I),Pa.forward(z),b)):Ma.reverse(Ma.interpolate(Ma.forward(I),Ma.forward(z),b))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ks(i,e,r,s){const d=s-r,m=i-r;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class cs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const d=r.expectedType;d&&d.kind!=="value"&&(s=d);const m=[];for(const b of e.slice(1)){const I=r.parse(b,1+m.length,s,void 0,{typeAnnotation:"omit"});if(!I)return null;s=s||I.type,m.push(I)}if(!s)throw new Error("No output type");const _=d&&m.some(b=>ln(d,b.type));return new cs(_?Wt:s,m)}evaluate(e){let r,s=null,d=0;for(const m of this.args)if(d++,s=m.evaluate(e),s&&s instanceof ye&&!s.available&&(r||(r=s.name),s=null,d===this.args.length&&(s=r)),s!==null)break;return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class us{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=r.parse(e[m+1],m+1);if(!b)return null;s.push([_,b])}const d=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return d?new us(s,d):null}outputDefined(){return this.result.outputDefined()}}class Js{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,st),d=r.parse(e[2],2,wr(r.expectedType||Wt));return s&&d?new Js(d.type.itemType,s,d):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new _t(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new _t(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new _t(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Ys{constructor(e,r){this.type=Ht,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Wt),d=r.parse(e[2],2,Wt);return s&&d?Un(s.type,[Ht,Jt,st,An,Wt])?new Ys(s,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!Nn(r,["boolean","string","number","null"]))throw new _t(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(ze(r))} instead.`);if(!Nn(s,["string","array"]))throw new _t(`Expected second argument to be of type array or string, but found ${Ei(ze(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class hs{constructor(e,r,s){this.type=st,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Wt),d=r.parse(e[2],2,Wt);if(!s||!d)return null;if(!Un(s.type,[Ht,Jt,st,An,Wt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(s.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,st);return m?new hs(s,d,m):null}return new hs(s,d)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Nn(r,["boolean","string","number","null"]))throw new _t(`Expected first argument to be of type boolean, string, number or null, but found ${Ei(ze(r))} instead.`);if(!Nn(s,["string","array"]))throw new _t(`Expected second argument to be of type array or string, but found ${Ei(ze(s))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return s.indexOf(r,d)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Qs{constructor(e,r,s,d,m,_){this.inputType=e,this.type=r,this.input=s,this.cases=d,this.outputs=m,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const m={},_=[];for(let z=2;z<e.length-1;z+=2){let R=e[z];const F=e[z+1];Array.isArray(R)||(R=[R]);const q=r.concat(z);if(R.length===0)return q.error("Expected at least one branch label.");for(const X of R){if(typeof X!="number"&&typeof X!="string")return q.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return q.error("Numeric branch labels must be integer values.");if(s){if(q.checkSubtype(s,ze(X)))return null}else s=ze(X);if(m[String(X)]!==void 0)return q.error("Branch labels must be unique.");m[String(X)]=_.length}const Z=r.parse(F,z,d);if(!Z)return null;d=d||Z.type,_.push(Z)}const b=r.parse(e[1],1,Wt);if(!b)return null;const I=r.parse(e[e.length-1],e.length-1,d);return I?b.type.kind!=="value"&&r.concat(1).checkSubtype(s,b.type)?null:new Qs(s,d,b,m,_,I):null}evaluate(e){const r=this.input.evaluate(e);return(ze(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class $s{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const b=r.parse(e[_],_,Ht);if(!b)return null;const I=r.parse(e[_+1],_+1,s);if(!I)return null;d.push([b,I]),s=s||I.type}const m=r.parse(e[e.length-1],e.length-1,s);if(!m)return null;if(!s)throw new Error("Can't infer output type");return new $s(s,d,m)}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ds{constructor(e,r,s,d){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=d}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Wt),d=r.parse(e[2],2,st);if(!s||!d)return null;if(!Un(s.type,[wr(Wt),Jt,Wt]))return r.error(`Expected first argument to be of type array or string, but found ${Ei(s.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,st);return m?new ds(s.type,s,d,m):null}return new ds(s.type,s,d)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Nn(r,["string","array"]))throw new _t(`Expected first argument to be of type array or string, but found ${Ei(ze(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return r.slice(s,d)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function el(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function tl(i,e,r,s){return s.compare(e,r)===0}function ha(i,e,r){const s=i!=="=="&&i!=="!=";return class Af{constructor(m,_,b){this.type=Ht,this.lhs=m,this.rhs=_,this.collator=b,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const b=m[0];let I=_.parse(m[1],1,Wt);if(!I)return null;if(!el(b,I.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${Ei(I.type)}'.`);let z=_.parse(m[2],2,Wt);if(!z)return null;if(!el(b,z.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${Ei(z.type)}'.`);if(I.type.kind!==z.type.kind&&I.type.kind!=="value"&&z.type.kind!=="value")return _.error(`Cannot compare types '${Ei(I.type)}' and '${Ei(z.type)}'.`);s&&(I.type.kind==="value"&&z.type.kind!=="value"?I=new jt(z.type,[I]):I.type.kind!=="value"&&z.type.kind==="value"&&(z=new jt(I.type,[z])));let R=null;if(m.length===4){if(I.type.kind!=="string"&&z.type.kind!=="string"&&I.type.kind!=="value"&&z.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(m[3],3,yn),!R)return null}return new Af(I,z,R)}evaluate(m){const _=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(s&&this.hasUntypedArgument){const I=ze(_),z=ze(b);if(I.kind!==z.kind||I.kind!=="string"&&I.kind!=="number")throw new _t(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${I.kind}, ${z.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const I=ze(_),z=ze(b);if(I.kind!=="string"||z.kind!=="string")return e(m,_,b)}return this.collator?r(m,_,b,this.collator.evaluate(m)):e(m,_,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const uc=ha("==",function(i,e,r){return e===r},tl),hc=ha("!=",function(i,e,r){return e!==r},function(i,e,r,s){return!tl(0,e,r,s)}),dc=ha("<",function(i,e,r){return e<r},function(i,e,r,s){return s.compare(e,r)<0}),fc=ha(">",function(i,e,r){return e>r},function(i,e,r,s){return s.compare(e,r)>0}),pc=ha("<=",function(i,e,r){return e<=r},function(i,e,r,s){return s.compare(e,r)<=0}),mc=ha(">=",function(i,e,r){return e>=r},function(i,e,r,s){return s.compare(e,r)>=0});class eo{constructor(e,r,s,d,m){this.type=Jt,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,st);if(!s)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=r.parse(d.locale,1,Jt),!m))return null;let _=null;if(d.currency&&(_=r.parse(d.currency,1,Jt),!_))return null;let b=null;if(d["min-fraction-digits"]&&(b=r.parse(d["min-fraction-digits"],1,st),!b))return null;let I=null;return d["max-fraction-digits"]&&(I=r.parse(d["max-fraction-digits"],1,st),!I)?null:new eo(s,m,_,b,I)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class fs{constructor(e){this.type=rr,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=e.length-1;++_){const b=e[_];if(m&&typeof b=="object"&&!Array.isArray(b)){m=!1;let I=null;if(b["font-scale"]&&(I=r.parse(b["font-scale"],1,st),!I))return null;let z=null;if(b["text-font"]&&(z=r.parse(b["text-font"],1,wr(Jt)),!z))return null;let R=null;if(b["text-color"]&&(R=r.parse(b["text-color"],1,hr),!R))return null;const F=d[d.length-1];F.scale=I,F.font=z,F.textColor=R}else{const I=r.parse(e[_],1,Wt);if(!I)return null;const z=I.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:I,scale:null,font:null,textColor:null})}}return new fs(d)}evaluate(e){return new fe(this.sections.map(r=>{const s=r.content.evaluate(e);return ze(s)===Ki?new ge("",s,null,null,null):new ge(It(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class to{constructor(e){this.type=Ki,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Jt);return s?new to(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=ye.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}}class io{constructor(e){this.type=st,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ei(s.type)} instead.`):new io(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new _t(`Expected value to be of type string or array, but found ${Ei(ze(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const da={"==":uc,"!=":hc,">":fc,"<":dc,">=":mc,"<=":pc,array:jt,at:Js,boolean:jt,case:$s,coalesce:cs,collator:nr,format:fs,image:to,in:Ys,"index-of":hs,interpolate:Rr,"interpolate-hcl":Rr,"interpolate-lab":Rr,length:io,let:us,literal:St,match:Qs,number:jt,"number-format":eo,object:jt,slice:ds,step:Ca,string:jt,"to-boolean":Xt,"to-color":Xt,"to-number":Xt,"to-string":Xt,var:ss,within:Gn};function il(i,[e,r,s,d]){e=e.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const m=d?d.evaluate(i):1,_=Me(e,r,s,m);if(_)throw new _t(_);return new K(e/255*m,r/255*m,s/255*m,m)}function rl(i,e){return i in e}function ps(i,e){const r=e[i];return r===void 0?null:r}function jn(i){return{type:i}}function nl(i){return{result:"success",value:i}}function fa(i){return{result:"error",value:i}}function Pi(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function al(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ni(i){return!!i.expression&&i.expression.interpolated}function vi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Mi(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Oi(i){return i}function La(i,e){const r=e.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",d=s||!(s||i.property!==void 0),m=i.type||(ni(e)?"exponential":"interval");if(r||e.type==="padding"){const z=r?K.parse:ue.parse;(i=Qr({},i)).stops&&(i.stops=i.stops.map(R=>[R[0],z(R[1])])),i.default=z(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!$o[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,b,I;if(m==="exponential")_=sl;else if(m==="interval")_=_c;else if(m==="categorical"){_=gc,b=Object.create(null);for(const z of i.stops)b[z[0]]=z[1];I=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=yc}if(s){const z={},R=[];for(let Z=0;Z<i.stops.length;Z++){const X=i.stops[Z],oe=X[0].zoom;z[oe]===void 0&&(z[oe]={zoom:oe,type:i.type,property:i.property,default:i.default,stops:[]},R.push(oe)),z[oe].stops.push([X[0].value,X[1]])}const F=[];for(const Z of R)F.push([z[Z].zoom,La(z[Z],e)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Rr.interpolationFactor.bind(void 0,q),zoomStops:F.map(Z=>Z[0]),evaluate:({zoom:Z},X)=>sl({stops:F,base:i.base},e,Z).evaluate(Z,X)}}if(d){const z=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Rr.interpolationFactor.bind(void 0,z),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(i,e,R,b,I)}}return{kind:"source",evaluate(z,R){const F=R&&R.properties?R.properties[i.property]:void 0;return F===void 0?pa(i.default,e.default):_(i,e,F,b,I)}}}function pa(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function gc(i,e,r,s,d){return pa(typeof r===d?s[r]:void 0,i.default,e.default)}function _c(i,e,r){if(vi(r)!=="number")return pa(i.default,e.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const d=os(i.stops.map(m=>m[0]),r);return i.stops[d][1]}function sl(i,e,r){const s=i.base!==void 0?i.base:1;if(vi(r)!=="number")return pa(i.default,e.default);const d=i.stops.length;if(d===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[d-1][0])return i.stops[d-1][1];const m=os(i.stops.map(R=>R[0]),r),_=function(R,F,q,Z){const X=Z-q,oe=R-q;return X===0?0:F===1?oe/X:(Math.pow(F,oe)-1)/(Math.pow(F,X)-1)}(r,s,i.stops[m][0],i.stops[m+1][0]),b=i.stops[m][1],I=i.stops[m+1][1];let z=za[e.type]||Oi;if(i.colorSpace&&i.colorSpace!=="rgb"){const R=$o[i.colorSpace];z=(F,q)=>R.reverse(R.interpolate(R.forward(F),R.forward(q),_))}return typeof b.evaluate=="function"?{evaluate(...R){const F=b.evaluate.apply(void 0,R),q=I.evaluate.apply(void 0,R);if(F!==void 0&&q!==void 0)return z(F,q,_)}}:z(b,I,_)}function yc(i,e,r){switch(e.type){case"color":r=K.parse(r);break;case"formatted":r=fe.fromString(r.toString());break;case"resolvedImage":r=ye.fromString(r.toString());break;case"padding":r=ue.parse(r);break;default:vi(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return pa(r,i.default,e.default)}Si.register(da,{error:[{kind:"error"},[Jt],(i,[e])=>{throw new _t(e.evaluate(i))}],typeof:[Jt,[Wt],(i,[e])=>Ei(ze(e.evaluate(i)))],"to-rgba":[wr(st,4),[hr],(i,[e])=>e.evaluate(i).toArray()],rgb:[hr,[st,st,st],il],rgba:[hr,[st,st,st,st],il],has:{type:Ht,overloads:[[[Jt],(i,[e])=>rl(e.evaluate(i),i.properties())],[[Jt,Dn],(i,[e,r])=>rl(e.evaluate(i),r.evaluate(i))]]},get:{type:Wt,overloads:[[[Jt],(i,[e])=>ps(e.evaluate(i),i.properties())],[[Jt,Dn],(i,[e,r])=>ps(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Wt,[Jt],(i,[e])=>ps(e.evaluate(i),i.featureState||{})],properties:[Dn,[],i=>i.properties()],"geometry-type":[Jt,[],i=>i.geometryType()],id:[Wt,[],i=>i.id()],zoom:[st,[],i=>i.globals.zoom],"heatmap-density":[st,[],i=>i.globals.heatmapDensity||0],"line-progress":[st,[],i=>i.globals.lineProgress||0],accumulated:[Wt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[st,jn(st),(i,e)=>{let r=0;for(const s of e)r+=s.evaluate(i);return r}],"*":[st,jn(st),(i,e)=>{let r=1;for(const s of e)r*=s.evaluate(i);return r}],"-":{type:st,overloads:[[[st,st],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[st],(i,[e])=>-e.evaluate(i)]]},"/":[st,[st,st],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[st,[st,st],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[st,[],()=>Math.LN2],pi:[st,[],()=>Math.PI],e:[st,[],()=>Math.E],"^":[st,[st,st],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[st,[st],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[st,[st],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[st,[st],(i,[e])=>Math.log(e.evaluate(i))],log2:[st,[st],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[st,[st],(i,[e])=>Math.sin(e.evaluate(i))],cos:[st,[st],(i,[e])=>Math.cos(e.evaluate(i))],tan:[st,[st],(i,[e])=>Math.tan(e.evaluate(i))],asin:[st,[st],(i,[e])=>Math.asin(e.evaluate(i))],acos:[st,[st],(i,[e])=>Math.acos(e.evaluate(i))],atan:[st,[st],(i,[e])=>Math.atan(e.evaluate(i))],min:[st,jn(st),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[st,jn(st),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[st,[st],(i,[e])=>Math.abs(e.evaluate(i))],round:[st,[st],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[st,[st],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[st,[st],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Ht,[Jt,Wt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Ht,[Wt],(i,[e])=>i.id()===e.value],"filter-type-==":[Ht,[Jt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Ht,[Jt,Wt],(i,[e,r])=>{const s=i.properties()[e.value],d=r.value;return typeof s==typeof d&&s<d}],"filter-id-<":[Ht,[Wt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Ht,[Jt,Wt],(i,[e,r])=>{const s=i.properties()[e.value],d=r.value;return typeof s==typeof d&&s>d}],"filter-id->":[Ht,[Wt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ht,[Jt,Wt],(i,[e,r])=>{const s=i.properties()[e.value],d=r.value;return typeof s==typeof d&&s<=d}],"filter-id-<=":[Ht,[Wt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ht,[Jt,Wt],(i,[e,r])=>{const s=i.properties()[e.value],d=r.value;return typeof s==typeof d&&s>=d}],"filter-id->=":[Ht,[Wt],(i,[e])=>{const r=i.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ht,[Wt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Ht,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ht,[wr(Jt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ht,[wr(Wt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Ht,[Jt,wr(Wt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Ht,[Jt,wr(Wt)],(i,[e,r])=>function(s,d,m,_){for(;m<=_;){const b=m+_>>1;if(d[b]===s)return!0;d[b]>s?_=b-1:m=b+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ht,overloads:[[[Ht,Ht],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[jn(Ht),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[jn(Ht),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Ht,[Ht],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Ht,[Jt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Jt,[Jt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Jt,[Jt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Jt,jn(Wt),(i,e)=>e.map(r=>It(r.evaluate(i))).join("")],"resolved-locale":[Jt,[yn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ms{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new ci,this._defaultValue=r?function(s){return s.type==="color"&&Mi(s.default)?new K(0,0,0,0):s.type==="color"?K.parse(s.default)||null:s.type==="padding"?ue.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,d,m,_){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,d,m,_){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new _t(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Ra(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in da}function Ba(i,e){const r=new ua(da,[],e?function(d){const m={color:hr,string:Jt,number:st,enum:Jt,boolean:Ht,formatted:rr,padding:aa,resolvedImage:Ki};return d.type==="array"?wr(m[d.value]||Wt,d.length):m[d.type]}(e):void 0),s=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?nl(new ms(s,e)):fa(r.errors)}class Fa{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ca(r.expression)}evaluateWithoutErrorHandling(e,r,s,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,d,m,_)}evaluate(e,r,s,d,m,_){return this._styleExpression.evaluate(e,r,s,d,m,_)}}class ro{constructor(e,r,s,d){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ca(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,r,s,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,d,m,_)}evaluate(e,r,s,d,m,_){return this._styleExpression.evaluate(e,r,s,d,m,_)}interpolationFactor(e,r,s){return this.interpolationType?Rr.interpolationFactor(this.interpolationType,e,r,s):0}}function ol(i,e){const r=Ba(i,e);if(r.result==="error")return r;const s=r.value.expression,d=Da(s);if(!d&&!Pi(e))return fa([new Pr("","data expressions not supported")]);const m=as(s,["zoom"]);if(!m&&!al(e))return fa([new Pr("","zoom expressions not supported")]);const _=_s(s);return _||m?_ instanceof Pr?fa([_]):_ instanceof Rr&&!ni(e)?fa([new Pr("",'"interpolate" expressions cannot be used with this property')]):nl(_?new ro(d?"camera":"composite",r.value,_.labels,_ instanceof Rr?_.interpolation:void 0):new Fa(d?"constant":"source",r.value)):fa([new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class gs{constructor(e,r){this._parameters=e,this._specification=r,Qr(this,La(this._parameters,this._specification))}static deserialize(e){return new gs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function _s(i){let e=null;if(i instanceof us)e=_s(i.result);else if(i instanceof cs){for(const r of i.args)if(e=_s(r),e)break}else(i instanceof Ca||i instanceof Rr)&&i.input instanceof Si&&i.input.name==="zoom"&&(e=i);return e instanceof Pr||i.eachChild(r=>{const s=_s(r);s instanceof Pr?e=s:!e&&s?e=new Pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function $r(i){const e=i.key,r=i.value,s=i.valueSpec||{},d=i.objectElementValidators||{},m=i.style,_=i.styleSpec;let b=[];const I=vi(r);if(I!=="object")return[new ht(e,r,`object expected, ${I} found`)];for(const z in r){const R=z.split(".")[0],F=s[R]||s["*"];let q;if(d[R])q=d[R];else if(s[R])q=Fr;else if(d["*"])q=d["*"];else{if(!s["*"]){b.push(new ht(e,r[z],`unknown property "${z}"`));continue}q=Fr}b=b.concat(q({key:(e&&`${e}.`)+z,value:r[z],valueSpec:F,style:m,styleSpec:_,object:r,objectKey:z},r))}for(const z in s)d[z]||s[z].required&&s[z].default===void 0&&r[z]===void 0&&b.push(new ht(e,r,`missing required property "${z}"`));return b}function ll(i){const e=i.value,r=i.valueSpec,s=i.style,d=i.styleSpec,m=i.key,_=i.arrayElementValidator||Fr;if(vi(e)!=="array")return[new ht(m,e,`array expected, ${vi(e)} found`)];if(r.length&&e.length!==r.length)return[new ht(m,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new ht(m,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let b={type:r.value,values:r.values};d.$version<7&&(b.function=r.function),vi(r.value)==="object"&&(b=r.value);let I=[];for(let z=0;z<e.length;z++)I=I.concat(_({array:e,arrayIndex:z,value:e[z],valueSpec:b,style:s,styleSpec:d,key:`${m}[${z}]`}));return I}function no(i){const e=i.key,r=i.value,s=i.valueSpec;let d=vi(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new ht(e,r,`number expected, ${d} found`)]:"minimum"in s&&r<s.minimum?[new ht(e,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new ht(e,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function cl(i){const e=i.valueSpec,r=oi(i.value.type);let s,d,m,_={};const b=r!=="categorical"&&i.value.property===void 0,I=!b,z=vi(i.value.stops)==="array"&&vi(i.value.stops[0])==="array"&&vi(i.value.stops[0][0])==="object",R=$r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(r==="identity")return[new ht(Z.key,Z.value,'identity function may not have a "stops" property')];let X=[];const oe=Z.value;return X=X.concat(ll({key:Z.key,value:oe,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:F})),vi(oe)==="array"&&oe.length===0&&X.push(new ht(Z.key,oe,"array must have at least one stop")),X},default:function(Z){return Fr({key:Z.key,value:Z.value,valueSpec:e,style:Z.style,styleSpec:Z.styleSpec})}}});return r==="identity"&&b&&R.push(new ht(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||R.push(new ht(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!ni(i.valueSpec)&&R.push(new ht(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(I&&!Pi(i.valueSpec)?R.push(new ht(i.key,i.value,"property functions not supported")):b&&!al(i.valueSpec)&&R.push(new ht(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!z||i.value.property!==void 0||R.push(new ht(i.key,i.value,'"property" property is required')),R;function F(Z){let X=[];const oe=Z.value,ae=Z.key;if(vi(oe)!=="array")return[new ht(ae,oe,`array expected, ${vi(oe)} found`)];if(oe.length!==2)return[new ht(ae,oe,`array length 2 expected, length ${oe.length} found`)];if(z){if(vi(oe[0])!=="object")return[new ht(ae,oe,`object expected, ${vi(oe[0])} found`)];if(oe[0].zoom===void 0)return[new ht(ae,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new ht(ae,oe,"object stop key must have value")];if(m&&m>oi(oe[0].zoom))return[new ht(ae,oe[0].zoom,"stop zoom values must appear in ascending order")];oi(oe[0].zoom)!==m&&(m=oi(oe[0].zoom),d=void 0,_={}),X=X.concat($r({key:`${ae}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:no,value:q}}))}else X=X.concat(q({key:`${ae}[0]`,value:oe[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},oe));return Ra(jr(oe[1]))?X.concat([new ht(`${ae}[1]`,oe[1],"expressions are not allowed in function stops.")]):X.concat(Fr({key:`${ae}[1]`,value:oe[1],valueSpec:e,style:Z.style,styleSpec:Z.styleSpec}))}function q(Z,X){const oe=vi(Z.value),ae=oi(Z.value),ke=Z.value!==null?Z.value:X;if(s){if(oe!==s)return[new ht(Z.key,ke,`${oe} stop domain type must match previous stop domain type ${s}`)]}else s=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new ht(Z.key,ke,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&r!=="categorical"){let De=`number expected, ${oe} found`;return Pi(e)&&r===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(Z.key,ke,De)]}return r!=="categorical"||oe!=="number"||isFinite(ae)&&Math.floor(ae)===ae?r!=="categorical"&&oe==="number"&&d!==void 0&&ae<d?[new ht(Z.key,ke,"stop domain values must appear in ascending order")]:(d=ae,r==="categorical"&&ae in _?[new ht(Z.key,ke,"stop domain values must be unique")]:(_[ae]=!0,[])):[new ht(Z.key,ke,`integer expected, found ${ae}`)]}}function Zn(i){const e=(i.expressionContext==="property"?ol:Ba)(jr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(s=>new ht(`${i.key}${s.key}`,i.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new ht(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ca(r))return[new ht(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ca(r))return[new ht(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!as(r,["zoom","feature-state"]))return[new ht(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Da(r))return[new ht(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Oa(i){const e=i.key,r=i.value,s=i.valueSpec,d=[];return Array.isArray(s.values)?s.values.indexOf(oi(r))===-1&&d.push(new ht(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(oi(r))===-1&&d.push(new ht(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function ma(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ma(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const vc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ys(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ma(i)||(i=Va(i));const e=Ba(i,vc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,d)=>e.value.evaluate(r,s,{},d),needGeometry:hl(i)}}function ul(i,e){return i<e?-1:i>e?1:0}function hl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(hl(i[e]))return!0;return!1}function Va(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ao(i[1],i[2],"=="):e==="!="?ga(ao(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ao(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Va))):e==="all"?["all"].concat(i.slice(1).map(Va)):e==="none"?["all"].concat(i.slice(1).map(Va).map(ga)):e==="in"?vs(i[1],i.slice(2)):e==="!in"?ga(vs(i[1],i.slice(2))):e==="has"?Ua(i[1]):e==="!has"?ga(Ua(i[1])):e!=="within"||i;var r}function ao(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function vs(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(ul)]]:["filter-in-small",i,["literal",e]]}}function Ua(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ga(i){return["!",i]}function Na(i){return ma(jr(i.value))?Zn(Qr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):dl(i)}function dl(i){const e=i.value,r=i.key;if(vi(e)!=="array")return[new ht(r,e,`array expected, ${vi(e)} found`)];const s=i.styleSpec;let d,m=[];if(e.length<1)return[new ht(r,e,"filter array must have at least 1 element")];switch(m=m.concat(Oa({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),oi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&oi(e[1])==="$type"&&m.push(new ht(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new ht(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=vi(e[1]),d!=="string"&&m.push(new ht(`${r}[1]`,e[1],`string expected, ${d} found`)));for(let _=2;_<e.length;_++)d=vi(e[_]),oi(e[1])==="$type"?m=m.concat(Oa({key:`${r}[${_}]`,value:e[_],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new ht(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)m=m.concat(dl({key:`${r}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=vi(e[1]),e.length!==2?m.push(new ht(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new ht(`${r}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=vi(e[1]),e.length!==2?m.push(new ht(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new ht(`${r}[1]`,e[1],`object expected, ${d} found`))}return m}function qa(i,e){const r=i.key,s=i.style,d=i.styleSpec,m=i.value,_=i.objectKey,b=d[`${e}_${i.layerType}`];if(!b)return[];const I=_.match(/^(.*)-transition$/);if(e==="paint"&&I&&b[I[1]]&&b[I[1]].transition)return Fr({key:r,value:m,valueSpec:d.transition,style:s,styleSpec:d});const z=i.valueSpec||b[_];if(!z)return[new ht(r,m,`unknown property "${_}"`)];let R;if(vi(m)==="string"&&Pi(z)&&!z.tokens&&(R=/^{([^}]+)}$/.exec(m)))return[new ht(r,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(_==="text-field"&&s&&!s.glyphs&&F.push(new ht(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Mi(jr(m))&&oi(m.type)==="identity"&&F.push(new ht(r,m,'"text-font" does not support identity functions'))),F.concat(Fr({key:i.key,value:m,valueSpec:z,style:s,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:_}))}function fl(i){return qa(i,"paint")}function pl(i){return qa(i,"layout")}function ml(i){let e=[];const r=i.value,s=i.key,d=i.style,m=i.styleSpec;r.type||r.ref||e.push(new ht(s,r,'either "type" or "ref" is required'));let _=oi(r.type);const b=oi(r.ref);if(r.id){const I=oi(r.id);for(let z=0;z<i.arrayIndex;z++){const R=d.layers[z];oi(R.id)===I&&e.push(new ht(s,r.id,`duplicate layer id "${r.id}", previously used at line ${R.id.__line__}`))}}if("ref"in r){let I;["type","source","source-layer","filter","layout"].forEach(z=>{z in r&&e.push(new ht(s,r[z],`"${z}" is prohibited for ref layers`))}),d.layers.forEach(z=>{oi(z.id)===b&&(I=z)}),I?I.ref?e.push(new ht(s,r.ref,"ref cannot reference another ref layer")):_=oi(I.type):e.push(new ht(s,r.ref,`ref layer "${b}" not found`))}else if(_!=="background")if(r.source){const I=d.sources&&d.sources[r.source],z=I&&oi(I.type);I?z==="vector"&&_==="raster"?e.push(new ht(s,r.source,`layer "${r.id}" requires a raster source`)):z==="raster"&&_!=="raster"?e.push(new ht(s,r.source,`layer "${r.id}" requires a vector source`)):z!=="vector"||r["source-layer"]?z==="raster-dem"&&_!=="hillshade"?e.push(new ht(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||z==="geojson"&&I.lineMetrics||e.push(new ht(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ht(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new ht(s,r.source,`source "${r.source}" not found`))}else e.push(new ht(s,r,'missing required property "source"'));return e=e.concat($r({key:s,value:r,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fr({key:`${s}.type`,value:r.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:Na,layout:I=>$r({layer:r,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":z=>pl(Qr({layerType:_},z))}}),paint:I=>$r({layer:r,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":z=>fl(Qr({layerType:_},z))}})}})),e}function _a(i){const e=i.value,r=i.key,s=vi(e);return s!=="string"?[new ht(r,e,`string expected, ${s} found`)]:[]}const gl={promoteId:function({key:i,value:e}){if(vi(e)==="string")return _a({key:i,value:e});{const r=[];for(const s in e)r.push(..._a({key:`${i}.${s}`,value:e[s]}));return r}}};function Ga(i){const e=i.value,r=i.key,s=i.styleSpec,d=i.style;if(!e.type)return[new ht(r,e,'"type" is required')];const m=oi(e.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=$r({key:r,value:e,valueSpec:s[`source_${m.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:gl}),_;case"geojson":if(_=$r({key:r,value:e,valueSpec:s.source_geojson,style:d,styleSpec:s,objectElementValidators:gl}),e.cluster)for(const b in e.clusterProperties){const[I,z]=e.clusterProperties[b],R=typeof I=="string"?[I,["accumulated"],["get",b]]:I;_.push(...Zn({key:`${r}.${b}.map`,value:z,expressionContext:"cluster-map"})),_.push(...Zn({key:`${r}.${b}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return $r({key:r,value:e,valueSpec:s.source_video,style:d,styleSpec:s});case"image":return $r({key:r,value:e,valueSpec:s.source_image,style:d,styleSpec:s});case"canvas":return[new ht(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oa({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:s})}}function ja(i){const e=i.value,r=i.styleSpec,s=r.light,d=i.style;let m=[];const _=vi(e);if(e===void 0)return m;if(_!=="object")return m=m.concat([new ht("light",e,`object expected, ${_} found`)]),m;for(const b in e){const I=b.match(/^(.*)-transition$/);m=m.concat(I&&s[I[1]]&&s[I[1]].transition?Fr({key:b,value:e[b],valueSpec:r.transition,style:d,styleSpec:r}):s[b]?Fr({key:b,value:e[b],valueSpec:s[b],style:d,styleSpec:r}):[new ht(b,e[b],`unknown property "${b}"`)])}return m}function Br(i){const e=i.value,r=i.styleSpec,s=r.terrain,d=i.style;let m=[];const _=vi(e);if(e===void 0)return m;if(_!=="object")return m=m.concat([new ht("terrain",e,`object expected, ${_} found`)]),m;for(const b in e)m=m.concat(s[b]?Fr({key:b,value:e[b],valueSpec:s[b],style:d,styleSpec:r}):[new ht(b,e[b],`unknown property "${b}"`)]);return m}const Za={"*":()=>[],array:ll,boolean:function(i){const e=i.value,r=i.key,s=vi(e);return s!=="boolean"?[new ht(r,e,`boolean expected, ${s} found`)]:[]},number:no,color:function(i){const e=i.key,r=i.value,s=vi(r);return s!=="string"?[new ht(e,r,`color expected, ${s} found`)]:oa(r)===null?[new ht(e,r,`color expected, "${r}" found`)]:[]},constants:Vn,enum:Oa,filter:Na,function:cl,layer:ml,object:$r,source:Ga,light:ja,terrain:Br,string:_a,formatted:function(i){return _a(i).length===0?[]:Zn(i)},resolvedImage:function(i){return _a(i).length===0?[]:Zn(i)},padding:function(i){const e=i.key,r=i.value;if(vi(r)==="array"){if(r.length<1||r.length>4)return[new ht(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let d=[];for(let m=0;m<r.length;m++)d=d.concat(Fr({key:`${e}[${m}]`,value:r[m],valueSpec:s}));return d}return no({key:e,value:r,valueSpec:{}})}};function Fr(i){const e=i.value,r=i.valueSpec,s=i.styleSpec;return r.expression&&Mi(oi(e))?cl(i):r.expression&&Ra(jr(e))?Zn(i):r.type&&Za[r.type]?Za[r.type](i):$r(Qr({},i,{valueSpec:r.type?s[r.type]:r}))}function xc(i){const e=i.value,r=i.key,s=_a(i);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new ht(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new ht(r,e,'"glyphs" url must include a "{range}" token'))),s}function Cn(i,e=Fe){let r=[];return r=r.concat(Fr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:xc,"*":()=>[]}})),i.constants&&(r=r.concat(Vn({key:"constants",value:i.constants,style:i,styleSpec:e}))),_l(r)}function _l(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function vn(i){return function(...e){return _l(i.apply(this,e))}}Cn.source=vn(Ga),Cn.light=vn(ja),Cn.terrain=vn(Br),Cn.layer=vn(ml),Cn.filter=vn(Na),Cn.paintProperty=vn(fl),Cn.layoutProperty=vn(pl);const Xa=Cn,so=Xa.light,bc=Xa.paintProperty,wc=Xa.layoutProperty;function xs(i,e){let r=!1;if(e&&e.length)for(const s of e)i.fire(new na(new Error(s.message))),r=!0;return r}class Wa{constructor(e,r,s){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const _=new Int32Array(this.arrayBuffer);e=_[0],this.d=(r=_[1])+2*(s=_[2]);for(let I=0;I<this.d*this.d;I++){const z=_[3+I],R=_[3+I+1];d.push(z===R?null:_.subarray(z,R))}const b=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],b),this.bboxes=_.subarray(b),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let _=0;_<this.d*this.d;_++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=s,this.scale=r/e,this.uid=0;const m=s/r*e;this.min=-m,this.max=e+m}insert(e,r,s,d,m){this._forEachCell(r,s,d,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,s,d,m,_){this.cells[m].push(_)}query(e,r,s,d,m){const _=this.min,b=this.max;if(e<=_&&r<=_&&b<=s&&b<=d&&!m)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(e,r,s,d,this._queryCell,I,{},m),I}}_queryCell(e,r,s,d,m,_,b,I){const z=this.cells[m];if(z!==null){const R=this.keys,F=this.bboxes;for(let q=0;q<z.length;q++){const Z=z[q];if(b[Z]===void 0){const X=4*Z;(I?I(F[X+0],F[X+1],F[X+2],F[X+3]):e<=F[X+2]&&r<=F[X+3]&&s>=F[X+0]&&d>=F[X+1])?(b[Z]=!0,_.push(R[Z])):b[Z]=!1}}}}_forEachCell(e,r,s,d,m,_,b,I){const z=this._convertToCellCoord(e),R=this._convertToCellCoord(r),F=this._convertToCellCoord(s),q=this._convertToCellCoord(d);for(let Z=z;Z<=F;Z++)for(let X=R;X<=q;X++){const oe=this.d*X+Z;if((!I||I(this._convertFromCellCoord(Z),this._convertFromCellCoord(X),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(X+1)))&&m.call(this,e,r,s,d,oe,_,b,I))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let s=0;for(let _=0;_<this.cells.length;_++)s+=this.cells[_].length;const d=new Int32Array(r+s+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let m=r;for(let _=0;_<e.length;_++){const b=e[_];d[3+_]=m,d.set(b,m),m+=b.length}return d[3+e.length]=m,d.set(this.keys,m),m+=this.keys.length,d[3+e.length+1]=m,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer}static serialize(e,r){const s=e.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(e){return new Wa(e.buffer)}}const xn={};function kt(i,e,r={}){if(xn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),xn[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}kt("Object",Object),kt("TransferableGridIndex",Wa),kt("Color",K),kt("Error",Error),kt("AJAXError",Ri),kt("ResolvedImage",ye),kt("StylePropertyFunction",gs),kt("StyleExpression",ms,{omit:["_evaluator"]}),kt("ZoomDependentExpression",ro),kt("ZoomConstantExpression",Fa),kt("CompoundExpression",Si,{omit:["_evaluate"]});for(const i in da)da[i]._classRegistryKey||kt(`Expression_${i}`,da[i]);function yl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Xn(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(yl(i)||nt(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const s of i)r.push(Xn(s,e));return r}if(typeof i=="object"){const r=i.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");if(!xn[s])throw new Error(`${s} is not registered.`);const d=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||xn[s].omit.indexOf(m)>=0)continue;const _=i[m];d[m]=xn[s].shallow.indexOf(m)>=0?_:Xn(_,e)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(d.$name=s),d}throw new Error("can't serialize object of type "+typeof i)}function zn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||yl(i)||nt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(zn);if(typeof i=="object"){const e=i.$name||"Object";if(!xn[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=xn[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const m=i[d];s[d]=xn[e].shallow.indexOf(d)>=0?m:zn(m)}return s}throw new Error("can't deserialize object of type "+typeof i)}class oo{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const pt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function bs(i){for(const e of i)if(co(e.charCodeAt(0)))return!0;return!1}function kc(i){for(const e of i)if(!lo(e.charCodeAt(0)))return!1;return!0}function lo(i){return!(pt.Arabic(i)||pt["Arabic Supplement"](i)||pt["Arabic Extended-A"](i)||pt["Arabic Presentation Forms-A"](i)||pt["Arabic Presentation Forms-B"](i))}function co(i){return!(i!==746&&i!==747&&(i<4352||!(pt["Bopomofo Extended"](i)||pt.Bopomofo(i)||pt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||pt["CJK Compatibility Ideographs"](i)||pt["CJK Compatibility"](i)||pt["CJK Radicals Supplement"](i)||pt["CJK Strokes"](i)||!(!pt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||pt["CJK Unified Ideographs Extension A"](i)||pt["CJK Unified Ideographs"](i)||pt["Enclosed CJK Letters and Months"](i)||pt["Hangul Compatibility Jamo"](i)||pt["Hangul Jamo Extended-A"](i)||pt["Hangul Jamo Extended-B"](i)||pt["Hangul Jamo"](i)||pt["Hangul Syllables"](i)||pt.Hiragana(i)||pt["Ideographic Description Characters"](i)||pt.Kanbun(i)||pt["Kangxi Radicals"](i)||pt["Katakana Phonetic Extensions"](i)||pt.Katakana(i)&&i!==12540||!(!pt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!pt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||pt["Unified Canadian Aboriginal Syllabics"](i)||pt["Unified Canadian Aboriginal Syllabics Extended"](i)||pt["Vertical Forms"](i)||pt["Yijing Hexagram Symbols"](i)||pt["Yi Syllables"](i)||pt["Yi Radicals"](i))))}function vl(i){return!(co(i)||function(e){return!!(pt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||pt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||pt["Letterlike Symbols"](e)||pt["Number Forms"](e)||pt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||pt["Control Pictures"](e)&&e!==9251||pt["Optical Character Recognition"](e)||pt["Enclosed Alphanumerics"](e)||pt["Geometric Shapes"](e)||pt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||pt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||pt["CJK Symbols and Punctuation"](e)||pt.Katakana(e)||pt["Private Use Area"](e)||pt["CJK Compatibility Forms"](e)||pt["Small Form Variants"](e)||pt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function xl(i){return i>=1424&&i<=2303||pt["Arabic Presentation Forms-A"](i)||pt["Arabic Presentation Forms-B"](i)}function Ic(i,e){return!(!e&&xl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||pt.Khmer(i))}function bl(i){for(const e of i)if(xl(e.charCodeAt(0)))return!0;return!1}const uo="deferred",ho="loading",fo="loaded";let po=null,Sr="unavailable",Mn=null;const wl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Sr="error"),po&&po(i)};function ya(){mo.fire(new gn("pluginStateChange",{pluginStatus:Sr,pluginURL:Mn}))}const mo=new _n,Ha=function(){return Sr},kl=function(){if(Sr!==uo||!Mn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Sr=ho,ya(),Mn&&Jr({url:Mn},i=>{i?wl(i):(Sr=fo,ya())})},Zr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Sr===fo||Zr.applyArabicShaping!=null,isLoading:()=>Sr===ho,setState(i){if(!Le())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Sr=i.pluginStatus,Mn=i.pluginURL},isParsed(){if(!Le())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Zr.applyArabicShaping!=null&&Zr.processBidirectionalText!=null&&Zr.processStyledBidirectionalText!=null},getPluginURL(){if(!Le())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Mn}};class Vi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oo,this.transition={})}isSupportedScript(e){return function(r,s){for(const d of r)if(!Ic(d.charCodeAt(0),s))return!1;return!0}(e,Zr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Ka{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,d){if(Mi(s))return new gs(s,d);if(Ra(s)){const m=ol(s,d);if(m.result==="error")throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=s;return d.type==="color"&&typeof s=="string"?m=K.parse(s):d.type!=="padding"||typeof s!="number"&&!Array.isArray(s)||(m=ue.parse(s)),{kind:"constant",evaluate:()=>m}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class ws{constructor(e){this.property=e,this.value=new Ka(e,void 0)}transitioned(e,r){return new El(this.property,this.value,r,O({},e.transition,this.transition),e.now)}untransitioned(){return new El(this.property,this.value,null,{},0)}}class Il{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return he(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ws(this._values[e].property)),this._values[e].value=new Ka(this._values[e].property,r===null?void 0:he(r))}getTransition(e){return he(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ws(this._values[e].property)),this._values[e].transition=he(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const d=this.getTransition(r);d!==void 0&&(e[`${r}-transition`]=d)}return e}transitioned(e,r){const s=new Tl(this._properties);for(const d of Object.keys(this._values))s._values[d]=this._values[d].transitioned(e,r._values[d]);return s}untransitioned(){const e=new Tl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class El{constructor(e,r,s,d,m){this.property=e,this.value=r,this.begin=m+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const d=e.now||0,m=this.value.possiblyEvaluate(e,r,s),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(e,r,s);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,s),m,function(I){if(I<=0)return 0;if(I>=1)return 1;const z=I*I,R=z*I;return 4*(I<.5?R:3*(I-z)+R-.75)}(b))}}return m}}class Tl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const d=new Ja(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,r,s);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return he(this._values[e].value)}setValue(e,r){this._values[e]=new Ka(this._values[e].property,r===null?void 0:he(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const d=new Ja(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,r,s);return d}}class cn{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,d){return this.property.evaluate(this.value,this.parameters,e,r,s,d)}}class Ja{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class At{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,s){const d=za[this.specification.type];return d?d(e,r,s):e}}class Ot{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,d){return new cn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,d)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new cn(this,{kind:"constant",value:void 0},e.parameters);const d=za[this.specification.type];return d?new cn(this,{kind:"constant",value:d(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,d,m,_){return e.kind==="constant"?e.value:e.evaluate(r,s,d,m,_)}}class va extends Ot{possiblyEvaluate(e,r,s,d){if(e.value===void 0)return new cn(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},s,d),_=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,b=this._calculate(_,_,_,r);return new cn(this,{kind:"constant",value:b},r)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new cn(this,{kind:"constant",value:m},r)}return new cn(this,e.expression,r)}evaluate(e,r,s,d,m,_){if(e.kind==="source"){const b=e.evaluate(r,s,d,m,_);return this._calculate(b,b,b,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,d),e.evaluate({zoom:Math.floor(r.zoom)},s,d),e.evaluate({zoom:Math.floor(r.zoom)+1},s,d),r):e.value}_calculate(e,r,s,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class go{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},s,d);return this._calculate(m,m,m,r)}return this._calculate(e.expression.evaluate(new Vi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Vi(Math.floor(r.zoom),r)),e.expression.evaluate(new Vi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class Pn{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,d){return!!e.expression.evaluate(r,null,{},s,d)}interpolate(){return!1}}class dr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new Ka(s,void 0),m=this.defaultTransitionablePropertyValues[r]=new ws(s);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}kt("DataDrivenProperty",Ot),kt("DataConstantProperty",At),kt("CrossFadedDataDrivenProperty",va),kt("CrossFadedProperty",go),kt("ColorRampProperty",Pn);const Ln="-transition";class un extends _n{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ec(r.layout)),r.paint)){this._transitionablePaint=new Il(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ja(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(wc,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(Ln)?this._transitionablePaint.getTransition(e.slice(0,-Ln.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(bc,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(e.endsWith(Ln))return this._transitionablePaint.setTransition(e.slice(0,-Ln.length),r||void 0),!1;{const d=this._transitionablePaint._values[e],m=d.property.specification["property-type"]==="cross-faded-data-driven",_=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const I=this._transitionablePaint._values[e].value;return I.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(e,b,I)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),le(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,d,m={}){return(!m||m.validate!==!1)&&xs(this,e.call(Xa,{key:r,layerType:this.type,objectKey:s,value:d,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof cn&&Pi(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Sl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Rn{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ji{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ji(i,e=1){let r=0,s=0;return{members:i.map(d=>{const m=Sl[d.type].BYTES_PER_ELEMENT,_=r=_o(r,Math.max(e,m)),b=d.components||1;return s=Math.max(s,m),r+=m*b,{name:d.name,type:d.type,components:b,offset:_}}),size:_o(r,Math.max(s,e)),alignment:e}}function _o(i,e){return Math.ceil(i/e)*e}class Wn extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const d=2*e;return this.int16[d+0]=r,this.int16[d+1]=s,e}}Wn.prototype.bytesPerElement=4,kt("StructArrayLayout2i4",Wn);class u extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,d)}emplace(e,r,s,d,m){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=s,this.int16[_+2]=d,this.int16[_+3]=m,e}}u.prototype.bytesPerElement=8,kt("StructArrayLayout4i8",u);class t extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,d,m,_)}emplace(e,r,s,d,m,_,b){const I=6*e;return this.int16[I+0]=r,this.int16[I+1]=s,this.int16[I+2]=d,this.int16[I+3]=m,this.int16[I+4]=_,this.int16[I+5]=b,e}}t.prototype.bytesPerElement=12,kt("StructArrayLayout2i4i12",t);class n extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,d,m,_)}emplace(e,r,s,d,m,_,b){const I=4*e,z=8*e;return this.int16[I+0]=r,this.int16[I+1]=s,this.uint8[z+4]=d,this.uint8[z+5]=m,this.uint8[z+6]=_,this.uint8[z+7]=b,e}}n.prototype.bytesPerElement=8,kt("StructArrayLayout2i4ub8",n);class o extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const d=2*e;return this.float32[d+0]=r,this.float32[d+1]=s,e}}o.prototype.bytesPerElement=8,kt("StructArrayLayout2f8",o);class f extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_,b,I,z,R){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,s,d,m,_,b,I,z,R)}emplace(e,r,s,d,m,_,b,I,z,R,F){const q=10*e;return this.uint16[q+0]=r,this.uint16[q+1]=s,this.uint16[q+2]=d,this.uint16[q+3]=m,this.uint16[q+4]=_,this.uint16[q+5]=b,this.uint16[q+6]=I,this.uint16[q+7]=z,this.uint16[q+8]=R,this.uint16[q+9]=F,e}}f.prototype.bytesPerElement=20,kt("StructArrayLayout10ui20",f);class g extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_,b,I,z,R,F,q){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,s,d,m,_,b,I,z,R,F,q)}emplace(e,r,s,d,m,_,b,I,z,R,F,q,Z){const X=12*e;return this.int16[X+0]=r,this.int16[X+1]=s,this.int16[X+2]=d,this.int16[X+3]=m,this.uint16[X+4]=_,this.uint16[X+5]=b,this.uint16[X+6]=I,this.uint16[X+7]=z,this.int16[X+8]=R,this.int16[X+9]=F,this.int16[X+10]=q,this.int16[X+11]=Z,e}}g.prototype.bytesPerElement=24,kt("StructArrayLayout4i4ui4i24",g);class x extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s)}emplace(e,r,s,d){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=d,e}}x.prototype.bytesPerElement=12,kt("StructArrayLayout3f12",x);class E extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}E.prototype.bytesPerElement=4,kt("StructArrayLayout1ul4",E);class C extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_,b,I,z){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,s,d,m,_,b,I,z)}emplace(e,r,s,d,m,_,b,I,z,R){const F=10*e,q=5*e;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=d,this.int16[F+3]=m,this.int16[F+4]=_,this.int16[F+5]=b,this.uint32[q+3]=I,this.uint16[F+8]=z,this.uint16[F+9]=R,e}}C.prototype.bytesPerElement=20,kt("StructArrayLayout6i1ul2ui20",C);class P extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,d,m,_)}emplace(e,r,s,d,m,_,b){const I=6*e;return this.int16[I+0]=r,this.int16[I+1]=s,this.int16[I+2]=d,this.int16[I+3]=m,this.int16[I+4]=_,this.int16[I+5]=b,e}}P.prototype.bytesPerElement=12,kt("StructArrayLayout2i2i2i12",P);class B extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,d,m)}emplace(e,r,s,d,m,_){const b=4*e,I=8*e;return this.float32[b+0]=r,this.float32[b+1]=s,this.float32[b+2]=d,this.int16[I+6]=m,this.int16[I+7]=_,e}}B.prototype.bytesPerElement=16,kt("StructArrayLayout2f1f2i16",B);class U extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,d)}emplace(e,r,s,d,m){const _=12*e,b=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=s,this.float32[b+1]=d,this.float32[b+2]=m,e}}U.prototype.bytesPerElement=12,kt("StructArrayLayout2ub2f12",U);class j extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s)}emplace(e,r,s,d){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=s,this.uint16[m+2]=d,e}}j.prototype.bytesPerElement=6,kt("StructArrayLayout3ui6",j);class ie extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe,ae,ke){const De=this.length;return this.resize(De+1),this.emplace(De,e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe,ae,ke)}emplace(e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe,ae,ke,De){const xe=24*e,Se=12*e,je=48*e;return this.int16[xe+0]=r,this.int16[xe+1]=s,this.uint16[xe+2]=d,this.uint16[xe+3]=m,this.uint32[Se+2]=_,this.uint32[Se+3]=b,this.uint32[Se+4]=I,this.uint16[xe+10]=z,this.uint16[xe+11]=R,this.uint16[xe+12]=F,this.float32[Se+7]=q,this.float32[Se+8]=Z,this.uint8[je+36]=X,this.uint8[je+37]=oe,this.uint8[je+38]=ae,this.uint32[Se+10]=ke,this.int16[xe+22]=De,e}}ie.prototype.bytesPerElement=48,kt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class $ extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe,ae,ke,De,xe,Se,je,Ne,wt,Et,mt,lt,at,gt){const dt=this.length;return this.resize(dt+1),this.emplace(dt,e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe,ae,ke,De,xe,Se,je,Ne,wt,Et,mt,lt,at,gt)}emplace(e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe,ae,ke,De,xe,Se,je,Ne,wt,Et,mt,lt,at,gt,dt){const Qe=34*e,Rt=17*e;return this.int16[Qe+0]=r,this.int16[Qe+1]=s,this.int16[Qe+2]=d,this.int16[Qe+3]=m,this.int16[Qe+4]=_,this.int16[Qe+5]=b,this.int16[Qe+6]=I,this.int16[Qe+7]=z,this.uint16[Qe+8]=R,this.uint16[Qe+9]=F,this.uint16[Qe+10]=q,this.uint16[Qe+11]=Z,this.uint16[Qe+12]=X,this.uint16[Qe+13]=oe,this.uint16[Qe+14]=ae,this.uint16[Qe+15]=ke,this.uint16[Qe+16]=De,this.uint16[Qe+17]=xe,this.uint16[Qe+18]=Se,this.uint16[Qe+19]=je,this.uint16[Qe+20]=Ne,this.uint16[Qe+21]=wt,this.uint16[Qe+22]=Et,this.uint32[Rt+12]=mt,this.float32[Rt+13]=lt,this.float32[Rt+14]=at,this.float32[Rt+15]=gt,this.float32[Rt+16]=dt,e}}$.prototype.bytesPerElement=68,kt("StructArrayLayout8i15ui1ul4f68",$);class ee extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ee.prototype.bytesPerElement=4,kt("StructArrayLayout1f4",ee);class pe extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s)}emplace(e,r,s,d){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=d,e}}pe.prototype.bytesPerElement=6,kt("StructArrayLayout3i6",pe);class ve extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s)}emplace(e,r,s,d){const m=4*e;return this.uint32[2*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=d,e}}ve.prototype.bytesPerElement=8,kt("StructArrayLayout1ul2ui8",ve);class Ie extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const d=2*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,e}}Ie.prototype.bytesPerElement=4,kt("StructArrayLayout2ui4",Ie);class ne extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ne.prototype.bytesPerElement=2,kt("StructArrayLayout1ui2",ne);class Ae extends ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,d)}emplace(e,r,s,d,m){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=d,this.float32[_+3]=m,e}}Ae.prototype.bytesPerElement=16,kt("StructArrayLayout4f16",Ae);class Ee extends Rn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ue(this.anchorPointX,this.anchorPointY)}}Ee.prototype.size=20;class Re extends C{get(e){return new Ee(this,e)}}kt("CollisionBoxArray",Re);class Be extends Rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Be.prototype.size=48;class Je extends ie{get(e){return new Be(this,e)}}kt("PlacedSymbolArray",Je);class Pe extends Rn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Pe.prototype.size=68;class yt extends ${get(e){return new Pe(this,e)}}kt("SymbolInstanceArray",yt);class ot extends ee{getoffsetX(e){return this.float32[1*e+0]}}kt("GlyphOffsetArray",ot);class bt extends pe{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}kt("SymbolLineVertexArray",bt);class Kt extends Rn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Kt.prototype.size=8;class Qt extends ve{get(e){return new Kt(this,e)}}kt("FeatureIndexArray",Qt);class Lt extends Wn{}class ki extends Wn{}class Ii extends Wn{}class si extends t{}class ui extends n{}class Ti extends o{}class ar extends f{}class hn extends g{}class en extends x{}class dn extends E{}class Bn extends P{}class Xr extends U{}class Ar extends j{}class bn extends Ie{}const ks=Ji([{name:"a_pos",components:2,type:"Int16"}],4),{members:er}=ks;class ei{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,d){let m=this.segments[this.segments.length-1];return e>ei.MAX_VERTEX_ARRAY_LENGTH&&_e(`Max vertices per segment is ${ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>ei.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,d){return new ei([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:d,vaos:{},sortKey:0}])}}function xi(i,e){return 256*(i=A(Math.floor(i),0,255))+A(Math.floor(e),0,255)}ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kt("SegmentVector",ei);const sr=Ji([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var or={exports:{}},Ui={exports:{}};Ui.exports=function(i,e){var r,s,d,m,_,b,I,z;for(s=i.length-(r=3&i.length),d=e,_=3432918353,b=461845907,z=0;z<s;)I=255&i.charCodeAt(z)|(255&i.charCodeAt(++z))<<8|(255&i.charCodeAt(++z))<<16|(255&i.charCodeAt(++z))<<24,++z,d=27492+(65535&(m=5*(65535&(d=(d^=I=(65535&(I=(I=(65535&I)*_+(((I>>>16)*_&65535)<<16)&4294967295)<<15|I>>>17))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(I=0,r){case 3:I^=(255&i.charCodeAt(z+2))<<16;case 2:I^=(255&i.charCodeAt(z+1))<<8;case 1:d^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(z)))*_+(((I>>>16)*_&65535)<<16)&4294967295)<<15|I>>>17))*b+(((I>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Wr={exports:{}};Wr.exports=function(i,e){for(var r,s=i.length,d=e^s,m=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(r>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++m;switch(s){case 3:d^=(255&i.charCodeAt(m+2))<<16;case 2:d^=(255&i.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Hn=Ui.exports,yo=Wr.exports;or.exports=Hn,or.exports.murmur3=Hn,or.exports.murmur2=yo;class xa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,d){this.ids.push(Al(e)),this.positions.push(r,s,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Al(e);let s=0,d=this.ids.length-1;for(;s<d;){const _=s+d>>1;this.ids[_]>=r?d=_:s=_+1}const m=[];for(;this.ids[s]===r;)m.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return m}static serialize(e,r){const s=new Float64Array(e.ids),d=new Uint32Array(e.positions);return vo(s,d,0,s.length-1),r&&r.push(s.buffer,d.buffer),{ids:s,positions:d}}static deserialize(e){const r=new xa;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Al(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:or.exports(String(i))}function vo(i,e,r,s){for(;r<s;){const d=i[r+s>>1];let m=r-1,_=s+1;for(;;){do m++;while(i[m]<d);do _--;while(i[_]>d);if(m>=_)break;Fn(i,m,_),Fn(e,3*m,3*_),Fn(e,3*m+1,3*_+1),Fn(e,3*m+2,3*_+2)}_-r<s-_?(vo(i,e,r,_),r=_+1):(vo(i,e,_+1,s),s=_)}}function Fn(i,e,r){const s=i[e];i[e]=i[r],i[r]=s}kt("FeaturePositionMap",xa);class Kn{constructor(e,r){this.gl=e.gl,this.location=r}}class Jn extends Kn{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Is extends Kn{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Au extends Kn{constructor(e,r){super(e,r),this.current=K.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Xf=new Float32Array(16);function Tc(i){return[xi(255*i.r,255*i.g),xi(255*i.b,255*i.a)]}class xo{constructor(e,r,s){this.value=e,this.uniformNames=r.map(d=>`u_${d}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return this.type==="color"?new Au(e,r):new Jn(e,r)}}class Es{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,s,d){const m=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,r,s){return s.substr(0,9)==="u_pattern"?new Is(e,r):new Jn(e,r)}}class Yn{constructor(e,r,s,d){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,s,d,m){const _=this.paintVertexArray.length,b=this.expression.evaluate(new Vi(0),r,{},d,[],m);this.paintVertexArray.resize(e),this._setPaintValue(_,e,b)}updatePaintArray(e,r,s,d){const m=this.expression.evaluate({zoom:0},s,d);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if(this.type==="color"){const d=Tc(s);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wn{constructor(e,r,s,d,m,_){this.expression=e,this.uniformNames=r.map(b=>`u_${b}_t`),this.type=s,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(b=>({name:`a_${b}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,s,d,m){const _=this.expression.evaluate(new Vi(this.zoom),r,{},d,[],m),b=this.expression.evaluate(new Vi(this.zoom+1),r,{},d,[],m),I=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(I,e,_,b)}updatePaintArray(e,r,s,d){const m=this.expression.evaluate({zoom:this.zoom},s,d),_=this.expression.evaluate({zoom:this.zoom+1},s,d);this._setPaintValue(e,r,m,_)}_setPaintValue(e,r,s,d){if(this.type==="color"){const m=Tc(s),_=Tc(d);for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,m[0],m[1],_[0],_[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,s,d);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=A(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,r,s){return new Jn(e,r)}}class ba{constructor(e,r,s,d,m,_){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=d,this.layerId=_,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,s){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,d,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,d){if(!d||!s)return;const{min:m,mid:_,max:b}=s,I=d[m],z=d[_],R=d[b];if(I&&z&&R)for(let F=e;F<r;F++)this.zoomInPaintVertexArray.emplace(F,z.tl[0],z.tl[1],z.br[0],z.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],z.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,z.tl[0],z.tl[1],z.br[0],z.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],z.pixelRatio,R.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,sr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,sr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Du{constructor(e,r,s){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!s(m))continue;const _=e.paint.get(m);if(!(_ instanceof cn&&Pi(_.property.specification)))continue;const b=Wf(m,e.type),I=_.value,z=_.property.specification.type,R=_.property.useIntegerZoom,F=_.property.specification["property-type"],q=F==="cross-faded"||F==="cross-faded-data-driven";if(I.kind==="constant")this.binders[m]=q?new Es(I.value,b):new xo(I.value,b,z),d.push(`/u_${m}`);else if(I.kind==="source"||q){const Z=Cu(m,z,"source");this.binders[m]=q?new ba(I,z,R,r,Z,e.id):new Yn(I,b,z,Z),d.push(`/a_${m}`)}else{const Z=Cu(m,z,"composite");this.binders[m]=new wn(I,b,z,R,r,Z),d.push(`/z_${m}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Yn||r instanceof wn?r.maxValue:0}populatePaintArrays(e,r,s,d,m){for(const _ in this.binders){const b=this.binders[_];(b instanceof Yn||b instanceof wn||b instanceof ba)&&b.populatePaintArray(e,r,s,d,m)}}setConstantPatternPositions(e,r){for(const s in this.binders){const d=this.binders[s];d instanceof Es&&d.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,d,m){let _=!1;for(const b in e){const I=r.getPositions(b);for(const z of I){const R=s.feature(z.index);for(const F in this.binders){const q=this.binders[F];if((q instanceof Yn||q instanceof wn||q instanceof ba)&&q.expression.isStateDependent===!0){const Z=d.paint.get(F);q.expression=Z.value,q.updatePaintArray(z.start,z.end,R,e[b],m),_=!0}}}}return _}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof xo||s instanceof Es)&&e.push(...s.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Yn||s instanceof wn)for(let d=0;d<s.paintVertexAttributes.length;d++)e.push(s.paintVertexAttributes[d].name);else if(s instanceof ba)for(let d=0;d<sr.members.length;d++)e.push(sr.members[d].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof xo||s instanceof Es||s instanceof wn)for(const d of s.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof xo||m instanceof Es||m instanceof wn){for(const _ of m.uniformNames)if(r[_]){const b=m.getBinding(e,r[_],_);s.push({name:_,property:d,binding:b})}}}return s}setUniforms(e,r,s,d){for(const{name:m,property:_,binding:b}of r)this.binders[_].setUniform(b,d,s.get(_),m)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof ba){const d=e.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(s instanceof Yn||s instanceof wn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof Yn||s instanceof wn||s instanceof ba)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Yn||r instanceof wn||r instanceof ba)&&r.destroy()}}}class Ya{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Du(d,r,s);this.needsUpload=!1,this._featureMap=new xa,this._bufferOffset=0}populatePaintArrays(e,r,s,d,m,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,d,m,_);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,d){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Wf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Cu(i,e,r){const s={color:{source:o,composite:Ae},number:{source:ee,composite:o}},d=function(m){return{"line-pattern":{source:ar,composite:ar},"fill-pattern":{source:ar,composite:ar},"fill-extrusion-pattern":{source:ar,composite:ar}}[m]}(i);return d&&d[r]||s[e][r]}kt("ConstantBinder",xo),kt("CrossFadedConstantBinder",Es),kt("SourceExpressionBinder",Yn),kt("CrossFadedCompositeBinder",ba),kt("CompositeExpressionBinder",wn),kt("ProgramConfiguration",Du,{omit:["_buffers"]}),kt("ProgramConfigurationSet",Ya);var tr=8192;const Sc=Math.pow(2,14)-1,zu=-Sc-1;function Qa(i){const e=tr/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const d=r[s];for(let m=0;m<d.length;m++){const _=d[m],b=Math.round(_.x*e),I=Math.round(_.y*e);_.x=A(b,zu,Sc),_.y=A(I,zu,Sc),(b<_.x||b>_.x+1||I<_.y||I>_.y+1)&&_e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function $a(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Qa(i):[]}}function Dl(i,e,r,s,d){i.emplaceBack(2*e+(s+1)/2,2*r+(d+1)/2)}class Ac{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ki,this.indexArray=new Ar,this.segments=new ei,this.programConfigurations=new Ya(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){const d=this.layers[0],m=[];let _=null,b=!1;d.type==="circle"&&(_=d.layout.get("circle-sort-key"),b=!_.isConstant());for(const{feature:I,id:z,index:R,sourceLayerIndex:F}of e){const q=this.layers[0]._featureFilter.needGeometry,Z=$a(I,q);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),Z,s))continue;const X=b?_.evaluate(Z,{},s):void 0,oe={id:z,properties:I.properties,type:I.type,sourceLayerIndex:F,index:R,geometry:q?Z.geometry:Qa(I),patterns:{},sortKey:X};m.push(oe)}b&&m.sort((I,z)=>I.sortKey-z.sortKey);for(const I of m){const{geometry:z,index:R,sourceLayerIndex:F}=I,q=e[R].feature;this.addFeature(I,z,R,s),r.featureIndex.insert(q,z,R,F,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,er),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,d){for(const m of r)for(const _ of m){const b=_.x,I=_.y;if(b<0||b>=tr||I<0||I>=tr)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=z.vertexLength;Dl(this.layoutVertexArray,b,I,-1,-1),Dl(this.layoutVertexArray,b,I,1,-1),Dl(this.layoutVertexArray,b,I,1,1),Dl(this.layoutVertexArray,b,I,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},d)}}function Mu(i,e){for(let r=0;r<i.length;r++)if(Ts(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ts(i,e[r]))return!0;return!!Dc(i,e)}function Hf(i,e,r){return!!Ts(i,e)||!!Cc(e,i,r)}function Pu(i,e){if(i.length===1)return Ru(e,i[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let d=0;d<s.length;d++)if(Ts(i,s[d]))return!0}for(let r=0;r<i.length;r++)if(Ru(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Dc(i,e[r]))return!0;return!1}function Kf(i,e,r){if(i.length>1){if(Dc(i,e))return!0;for(let s=0;s<e.length;s++)if(Cc(e[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Cc(i[s],e,r))return!0;return!1}function Dc(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],d=i[r+1];for(let m=0;m<e.length-1;m++)if(Jf(s,d,e[m],e[m+1]))return!0}return!1}function Jf(i,e,r,s){return re(i,r,s)!==re(e,r,s)&&re(i,e,r)!==re(i,e,s)}function Cc(i,e,r){const s=r*r;if(e.length===1)return i.distSqr(e[0])<s;for(let d=1;d<e.length;d++)if(Lu(i,e[d-1],e[d])<s)return!0;return!1}function Lu(i,e,r){const s=e.distSqr(r);if(s===0)return i.distSqr(e);const d=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/s;return i.distSqr(d<0?e:d>1?r:r.sub(e)._mult(d)._add(e))}function Ru(i,e){let r,s,d,m=!1;for(let _=0;_<i.length;_++){r=i[_];for(let b=0,I=r.length-1;b<r.length;I=b++)s=r[b],d=r[I],s.y>e.y!=d.y>e.y&&e.x<(d.x-s.x)*(e.y-s.y)/(d.y-s.y)+s.x&&(m=!m)}return m}function Ts(i,e){let r=!1;for(let s=0,d=i.length-1;s<i.length;d=s++){const m=i[s],_=i[d];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function Yf(i,e,r){const s=r[0],d=r[2];if(i.x<s.x&&e.x<s.x||i.x>d.x&&e.x>d.x||i.y<s.y&&e.y<s.y||i.y>d.y&&e.y>d.y)return!1;const m=re(i,e,r[0]);return m!==re(i,e,r[1])||m!==re(i,e,r[2])||m!==re(i,e,r[3])}function bo(i,e,r){const s=e.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Cl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function zl(i,e,r,s,d){if(!e[0]&&!e[1])return i;const m=Ue.convert(e)._mult(d);r==="viewport"&&m._rotate(-s);const _=[];for(let b=0;b<i.length;b++)_.push(i[b].sub(m));return _}kt("CircleBucket",Ac,{omit:["layers"]});const Qf=new dr({"circle-sort-key":new Ot(Fe.layout_circle["circle-sort-key"])});var $f={paint:new dr({"circle-radius":new Ot(Fe.paint_circle["circle-radius"]),"circle-color":new Ot(Fe.paint_circle["circle-color"]),"circle-blur":new Ot(Fe.paint_circle["circle-blur"]),"circle-opacity":new Ot(Fe.paint_circle["circle-opacity"]),"circle-translate":new At(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new At(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(Fe.paint_circle["circle-stroke-opacity"])}),layout:Qf},Dr=1e-6,Cr=typeof Float32Array<"u"?Float32Array:Array;function Bu(){var i=new Cr(9);return Cr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function zc(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Fu(i,e,r){var s=e[0],d=e[1],m=e[2],_=e[3],b=e[4],I=e[5],z=e[6],R=e[7],F=e[8],q=e[9],Z=e[10],X=e[11],oe=e[12],ae=e[13],ke=e[14],De=e[15],xe=r[0],Se=r[1],je=r[2],Ne=r[3];return i[0]=xe*s+Se*b+je*F+Ne*oe,i[1]=xe*d+Se*I+je*q+Ne*ae,i[2]=xe*m+Se*z+je*Z+Ne*ke,i[3]=xe*_+Se*R+je*X+Ne*De,i[4]=(xe=r[4])*s+(Se=r[5])*b+(je=r[6])*F+(Ne=r[7])*oe,i[5]=xe*d+Se*I+je*q+Ne*ae,i[6]=xe*m+Se*z+je*Z+Ne*ke,i[7]=xe*_+Se*R+je*X+Ne*De,i[8]=(xe=r[8])*s+(Se=r[9])*b+(je=r[10])*F+(Ne=r[11])*oe,i[9]=xe*d+Se*I+je*q+Ne*ae,i[10]=xe*m+Se*z+je*Z+Ne*ke,i[11]=xe*_+Se*R+je*X+Ne*De,i[12]=(xe=r[12])*s+(Se=r[13])*b+(je=r[14])*F+(Ne=r[15])*oe,i[13]=xe*d+Se*I+je*q+Ne*ae,i[14]=xe*m+Se*z+je*Z+Ne*ke,i[15]=xe*_+Se*R+je*X+Ne*De,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var wo,ep=Fu;function Ou(){var i=new Cr(3);return Cr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Vu(i,e,r){var s=new Cr(3);return s[0]=i,s[1]=e,s[2]=r,s}function Ml(i,e,r){var s=e[0],d=e[1],m=e[2],_=e[3];return i[0]=r[0]*s+r[4]*d+r[8]*m+r[12]*_,i[1]=r[1]*s+r[5]*d+r[9]*m+r[13]*_,i[2]=r[2]*s+r[6]*d+r[10]*m+r[14]*_,i[3]=r[3]*s+r[7]*d+r[11]*m+r[15]*_,i}function Uu(){var i=new Cr(4);return Cr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Nu(i,e){const r=Ml([],[i.x,i.y,0,1],e);return new Ue(r[0]/r[3],r[1]/r[3])}Ou(),wo=new Cr(4),Cr!=Float32Array&&(wo[0]=0,wo[1]=0,wo[2]=0,wo[3]=0),Ou(),Vu(1,0,0),Vu(0,1,0),Uu(),Uu(),Bu(),function(){var i;i=new Cr(2),Cr!=Float32Array&&(i[0]=0,i[1]=0)}();class qu extends Ac{}kt("HeatmapBucket",qu,{omit:["layers"]});var tp={paint:new dr({"heatmap-radius":new Ot(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pn(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(Fe.paint_heatmap["heatmap-opacity"])})};function Mc(i,{width:e,height:r},s,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*r*s)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*r*s}`)}else d=new Uint8Array(e*r*s);return i.width=e,i.height=r,i.data=d,i}function Gu(i,{width:e,height:r},s){if(e===i.width&&r===i.height)return;const d=Mc({},{width:e,height:r},s);Pc(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},s),i.width=e,i.height=r,i.data=d.data}function Pc(i,e,r,s,d,m){if(d.width===0||d.height===0)return e;if(d.width>i.width||d.height>i.height||r.x>i.width-d.width||r.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||s.x>e.width-d.width||s.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,b=e.data;if(_===b)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<d.height;I++){const z=((r.y+I)*i.width+r.x)*m,R=((s.y+I)*e.width+s.x)*m;for(let F=0;F<d.width*m;F++)b[R+F]=_[z+F]}return e}class ko{constructor(e,r){Mc(this,e,1,r)}resize(e){Gu(this,e,1)}clone(){return new ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,d,m){Pc(e,r,s,d,m,1)}}class tn{constructor(e,r){Mc(this,e,4,r)}resize(e){Gu(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new tn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,d,m){Pc(e,r,s,d,m,4)}}function ju(i){const e={},r=i.resolution||256,s=i.clips?i.clips.length:1,d=i.image||new tn({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const m=(_,b,I)=>{e[i.evaluationKey]=I;const z=i.expression.evaluate(e);d.data[_+b+0]=Math.floor(255*z.r/z.a),d.data[_+b+1]=Math.floor(255*z.g/z.a),d.data[_+b+2]=Math.floor(255*z.b/z.a),d.data[_+b+3]=Math.floor(255*z.a)};if(i.clips)for(let _=0,b=0;_<s;++_,b+=4*r)for(let I=0,z=0;I<r;I++,z+=4){const R=I/(r-1),{start:F,end:q}=i.clips[_];m(b,z,F*(1-R)+q*R)}else for(let _=0,b=0;_<r;_++,b+=4)m(0,b,_/(r-1));return d}kt("AlphaImage",ko),kt("RGBAImage",tn);var ip={paint:new dr({"hillshade-illumination-direction":new At(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new At(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(Fe.paint_hillshade["hillshade-accent-color"])})};const rp=Ji([{name:"a_pos",components:2,type:"Int16"}],4),{members:np}=rp;var Pl={exports:{}};function Ll(i,e,r){r=r||2;var s,d,m,_,b,I,z,R=e&&e.length,F=R?e[0]*r:i.length,q=Zu(i,0,F,r,!0),Z=[];if(!q||q.next===q.prev)return Z;if(R&&(q=function(oe,ae,ke,De){var xe,Se,je,Ne=[];for(xe=0,Se=ae.length;xe<Se;xe++)(je=Zu(oe,ae[xe]*De,xe<Se-1?ae[xe+1]*De:oe.length,De,!1))===je.next&&(je.steiner=!0),Ne.push(dp(je));for(Ne.sort(cp),xe=0;xe<Ne.length;xe++)ke=up(Ne[xe],ke);return ke}(i,e,q,r)),i.length>80*r){s=m=i[0],d=_=i[1];for(var X=r;X<F;X+=r)(b=i[X])<s&&(s=b),(I=i[X+1])<d&&(d=I),b>m&&(m=b),I>_&&(_=I);z=(z=Math.max(m-s,_-d))!==0?32767/z:0}return Io(q,Z,r,s,d,z,0),Z}function Zu(i,e,r,s,d){var m,_;if(d===Bc(i,e,r,s)>0)for(m=e;m<r;m+=s)_=Hu(m,i[m],i[m+1],_);else for(m=r-s;m>=e;m-=s)_=Hu(m,i[m],i[m+1],_);return _&&Rl(_,_.next)&&(To(_),_=_.next),_}function es(i,e){if(!i)return i;e||(e=i);var r,s=i;do if(r=!1,s.steiner||!Rl(s,s.next)&&Wi(s.prev,s,s.next)!==0)s=s.next;else{if(To(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function Io(i,e,r,s,d,m,_){if(i){!_&&m&&function(R,F,q,Z){var X=R;do X.z===0&&(X.z=Lc(X.x,X.y,F,q,Z)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==R);X.prevZ.nextZ=null,X.prevZ=null,function(oe){var ae,ke,De,xe,Se,je,Ne,wt,Et=1;do{for(ke=oe,oe=null,Se=null,je=0;ke;){for(je++,De=ke,Ne=0,ae=0;ae<Et&&(Ne++,De=De.nextZ);ae++);for(wt=Et;Ne>0||wt>0&&De;)Ne!==0&&(wt===0||!De||ke.z<=De.z)?(xe=ke,ke=ke.nextZ,Ne--):(xe=De,De=De.nextZ,wt--),Se?Se.nextZ=xe:oe=xe,xe.prevZ=Se,Se=xe;ke=De}Se.nextZ=null,Et*=2}while(je>1)}(X)}(i,s,d,m);for(var b,I,z=i;i.prev!==i.next;)if(b=i.prev,I=i.next,m?sp(i,s,d,m):ap(i))e.push(b.i/r|0),e.push(i.i/r|0),e.push(I.i/r|0),To(i),i=I.next,z=I.next;else if((i=I)===z){_?_===1?Io(i=op(es(i),e,r),e,r,s,d,m,2):_===2&&lp(i,e,r,s,d,m):Io(es(i),e,r,s,d,m,1);break}}}function ap(i){var e=i.prev,r=i,s=i.next;if(Wi(e,r,s)>=0)return!1;for(var d=e.x,m=r.x,_=s.x,b=e.y,I=r.y,z=s.y,R=d<m?d<_?d:_:m<_?m:_,F=b<I?b<z?b:z:I<z?I:z,q=d>m?d>_?d:_:m>_?m:_,Z=b>I?b>z?b:z:I>z?I:z,X=s.next;X!==e;){if(X.x>=R&&X.x<=q&&X.y>=F&&X.y<=Z&&Ss(d,b,m,I,_,z,X.x,X.y)&&Wi(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function sp(i,e,r,s){var d=i.prev,m=i,_=i.next;if(Wi(d,m,_)>=0)return!1;for(var b=d.x,I=m.x,z=_.x,R=d.y,F=m.y,q=_.y,Z=b<I?b<z?b:z:I<z?I:z,X=R<F?R<q?R:q:F<q?F:q,oe=b>I?b>z?b:z:I>z?I:z,ae=R>F?R>q?R:q:F>q?F:q,ke=Lc(Z,X,e,r,s),De=Lc(oe,ae,e,r,s),xe=i.prevZ,Se=i.nextZ;xe&&xe.z>=ke&&Se&&Se.z<=De;){if(xe.x>=Z&&xe.x<=oe&&xe.y>=X&&xe.y<=ae&&xe!==d&&xe!==_&&Ss(b,R,I,F,z,q,xe.x,xe.y)&&Wi(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Se.x>=Z&&Se.x<=oe&&Se.y>=X&&Se.y<=ae&&Se!==d&&Se!==_&&Ss(b,R,I,F,z,q,Se.x,Se.y)&&Wi(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;xe&&xe.z>=ke;){if(xe.x>=Z&&xe.x<=oe&&xe.y>=X&&xe.y<=ae&&xe!==d&&xe!==_&&Ss(b,R,I,F,z,q,xe.x,xe.y)&&Wi(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Se&&Se.z<=De;){if(Se.x>=Z&&Se.x<=oe&&Se.y>=X&&Se.y<=ae&&Se!==d&&Se!==_&&Ss(b,R,I,F,z,q,Se.x,Se.y)&&Wi(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function op(i,e,r){var s=i;do{var d=s.prev,m=s.next.next;!Rl(d,m)&&Xu(d,s,s.next,m)&&Eo(d,m)&&Eo(m,d)&&(e.push(d.i/r|0),e.push(s.i/r|0),e.push(m.i/r|0),To(s),To(s.next),s=i=m),s=s.next}while(s!==i);return es(s)}function lp(i,e,r,s,d,m){var _=i;do{for(var b=_.next.next;b!==_.prev;){if(_.i!==b.i&&fp(_,b)){var I=Wu(_,b);return _=es(_,_.next),I=es(I,I.next),Io(_,e,r,s,d,m,0),void Io(I,e,r,s,d,m,0)}b=b.next}_=_.next}while(_!==i)}function cp(i,e){return i.x-e.x}function up(i,e){var r=function(d,m){var _,b=m,I=d.x,z=d.y,R=-1/0;do{if(z<=b.y&&z>=b.next.y&&b.next.y!==b.y){var F=b.x+(z-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(F<=I&&F>R&&(R=F,_=b.x<b.next.x?b:b.next,F===I))return _}b=b.next}while(b!==m);if(!_)return null;var q,Z=_,X=_.x,oe=_.y,ae=1/0;b=_;do I>=b.x&&b.x>=X&&I!==b.x&&Ss(z<oe?I:R,z,X,oe,z<oe?R:I,z,b.x,b.y)&&(q=Math.abs(z-b.y)/(I-b.x),Eo(b,d)&&(q<ae||q===ae&&(b.x>_.x||b.x===_.x&&hp(_,b)))&&(_=b,ae=q)),b=b.next;while(b!==Z);return _}(i,e);if(!r)return e;var s=Wu(r,i);return es(s,s.next),es(r,r.next)}function hp(i,e){return Wi(i.prev,i,e.prev)<0&&Wi(e.next,i,i.next)<0}function Lc(i,e,r,s,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dp(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Ss(i,e,r,s,d,m,_,b){return(d-_)*(e-b)>=(i-_)*(m-b)&&(i-_)*(s-b)>=(r-_)*(e-b)&&(r-_)*(m-b)>=(d-_)*(s-b)}function fp(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,s){var d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==s.i&&d.next.i!==s.i&&Xu(d,d.next,r,s))return!0;d=d.next}while(d!==r);return!1}(i,e)&&(Eo(i,e)&&Eo(e,i)&&function(r,s){var d=r,m=!1,_=(r.x+s.x)/2,b=(r.y+s.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&_<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==r);return m}(i,e)&&(Wi(i.prev,i,e.prev)||Wi(i,e.prev,e))||Rl(i,e)&&Wi(i.prev,i,i.next)>0&&Wi(e.prev,e,e.next)>0)}function Wi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Rl(i,e){return i.x===e.x&&i.y===e.y}function Xu(i,e,r,s){var d=Fl(Wi(i,e,r)),m=Fl(Wi(i,e,s)),_=Fl(Wi(r,s,i)),b=Fl(Wi(r,s,e));return d!==m&&_!==b||!(d!==0||!Bl(i,r,e))||!(m!==0||!Bl(i,s,e))||!(_!==0||!Bl(r,i,s))||!(b!==0||!Bl(r,e,s))}function Bl(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Fl(i){return i>0?1:i<0?-1:0}function Eo(i,e){return Wi(i.prev,i,i.next)<0?Wi(i,e,i.next)>=0&&Wi(i,i.prev,e)>=0:Wi(i,e,i.prev)<0||Wi(i,i.next,e)<0}function Wu(i,e){var r=new Rc(i.i,i.x,i.y),s=new Rc(e.i,e.x,e.y),d=i.next,m=e.prev;return i.next=e,e.prev=i,r.next=d,d.prev=r,s.next=r,r.prev=s,m.next=s,s.prev=m,s}function Hu(i,e,r,s){var d=new Rc(i,e,r);return s?(d.next=s.next,d.prev=s,s.next.prev=d,s.next=d):(d.prev=d,d.next=d),d}function To(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Rc(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bc(i,e,r,s){for(var d=0,m=e,_=r-s;m<r;m+=s)d+=(i[_]-i[m])*(i[m+1]+i[_+1]),_=m;return d}function pp(i,e,r,s,d){Ku(i,e,r||0,s||i.length-1,d||mp)}function Ku(i,e,r,s,d){for(;s>r;){if(s-r>600){var m=s-r+1,_=e-r+1,b=Math.log(m),I=.5*Math.exp(2*b/3),z=.5*Math.sqrt(b*I*(m-I)/m)*(_-m/2<0?-1:1);Ku(i,e,Math.max(r,Math.floor(e-_*I/m+z)),Math.min(s,Math.floor(e+(m-_)*I/m+z)),d)}var R=i[e],F=r,q=s;for(So(i,r,e),d(i[s],R)>0&&So(i,r,s);F<q;){for(So(i,F,q),F++,q--;d(i[F],R)<0;)F++;for(;d(i[q],R)>0;)q--}d(i[r],R)===0?So(i,r,q):So(i,++q,s),q<=e&&(r=q+1),e<=q&&(s=q-1)}}function So(i,e,r){var s=i[e];i[e]=i[r],i[r]=s}function mp(i,e){return i<e?-1:i>e?1:0}function Fc(i,e){const r=i.length;if(r<=1)return[i];const s=[];let d,m;for(let _=0;_<r;_++){const b=we(i[_]);b!==0&&(i[_].area=Math.abs(b),m===void 0&&(m=b<0),m===b<0?(d&&s.push(d),d=[i[_]]):d.push(i[_]))}if(d&&s.push(d),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(pp(s[_],e,1,s[_].length-1,gp),s[_]=s[_].slice(0,e));return s}function gp(i,e){return e.area-i.area}function Oc(i,e,r){const s=r.patternDependencies;let d=!1;for(const m of e){const _=m.paint.get(`${i}-pattern`);_.isConstant()||(d=!0);const b=_.constantOr(null);b&&(d=!0,s[b.to]=!0,s[b.from]=!0)}return d}function Vc(i,e,r,s,d){const m=d.patternDependencies;for(const _ of e){const b=_.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let I=b.evaluate({zoom:s-1},r,{},d.availableImages),z=b.evaluate({zoom:s},r,{},d.availableImages),R=b.evaluate({zoom:s+1},r,{},d.availableImages);I=I&&I.name?I.name:I,z=z&&z.name?z.name:z,R=R&&R.name?R.name:R,m[I]=!0,m[z]=!0,m[R]=!0,r.patterns[_.id]={min:I,mid:z,max:R}}}return r}Pl.exports=Ll,Pl.exports.default=Ll,Ll.deviation=function(i,e,r,s){var d=e&&e.length,m=Math.abs(Bc(i,0,d?e[0]*r:i.length,r));if(d)for(var _=0,b=e.length;_<b;_++)m-=Math.abs(Bc(i,e[_]*r,_<b-1?e[_+1]*r:i.length,r));var I=0;for(_=0;_<s.length;_+=3){var z=s[_]*r,R=s[_+1]*r,F=s[_+2]*r;I+=Math.abs((i[z]-i[F])*(i[R+1]-i[z+1])-(i[z]-i[R])*(i[F+1]-i[z+1]))}return m===0&&I===0?0:Math.abs((I-m)/m)},Ll.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,d=0;d<i.length;d++){for(var m=0;m<i[d].length;m++)for(var _=0;_<e;_++)r.vertices.push(i[d][m][_]);d>0&&r.holes.push(s+=i[d-1].length)}return r};class Uc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ii,this.indexArray=new Ar,this.indexArray2=new bn,this.programConfigurations=new Ya(e.layers,e.zoom),this.segments=new ei,this.segments2=new ei,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Oc("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),m=!d.isConstant(),_=[];for(const{feature:b,id:I,index:z,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,q=$a(b,F);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),q,s))continue;const Z=m?d.evaluate(q,{},s,r.availableImages):void 0,X={id:I,properties:b.properties,type:b.type,sourceLayerIndex:R,index:z,geometry:F?q.geometry:Qa(b),patterns:{},sortKey:Z};_.push(X)}m&&_.sort((b,I)=>b.sortKey-I.sortKey);for(const b of _){const{geometry:I,index:z,sourceLayerIndex:R}=b;if(this.hasPattern){const F=Vc("fill",this.layers,b,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(b,I,z,s,{});r.featureIndex.insert(e[z].feature,I,z,R,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,np),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,d,m){for(const _ of Fc(r,500)){let b=0;for(const Z of _)b+=Z.length;const I=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),z=I.vertexLength,R=[],F=[];for(const Z of _){if(Z.length===0)continue;Z!==_[0]&&F.push(R.length/2);const X=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),oe=X.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(oe+Z.length-1,oe),R.push(Z[0].x),R.push(Z[0].y);for(let ae=1;ae<Z.length;ae++)this.layoutVertexArray.emplaceBack(Z[ae].x,Z[ae].y),this.indexArray2.emplaceBack(oe+ae-1,oe+ae),R.push(Z[ae].x),R.push(Z[ae].y);X.vertexLength+=Z.length,X.primitiveLength+=Z.length}const q=Pl.exports(R,F);for(let Z=0;Z<q.length;Z+=3)this.indexArray.emplaceBack(z+q[Z],z+q[Z+1],z+q[Z+2]);I.vertexLength+=b,I.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,d)}}kt("FillBucket",Uc,{omit:["layers","patternFeatures"]});const _p=new dr({"fill-sort-key":new Ot(Fe.layout_fill["fill-sort-key"])});var yp={paint:new dr({"fill-antialias":new At(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Ot(Fe.paint_fill["fill-opacity"]),"fill-color":new Ot(Fe.paint_fill["fill-color"]),"fill-outline-color":new Ot(Fe.paint_fill["fill-outline-color"]),"fill-translate":new At(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new At(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new va(Fe.paint_fill["fill-pattern"])}),layout:_p};const vp=Ji([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xp=Ji([{name:"a_centroid",components:2,type:"Int16"}],4),{members:bp}=vp;var wa={},wp=Ue,Ju=As;function As(i,e,r,s,d){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=d,i.readFields(kp,this,e)}function kp(i,e,r){i==1?e.id=r.readVarint():i==2?function(s,d){for(var m=s.readVarint()+s.pos;s.pos<m;){var _=d._keys[s.readVarint()],b=d._values[s.readVarint()];d.properties[_]=b}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function Ip(i){for(var e,r,s=0,d=0,m=i.length,_=m-1;d<m;_=d++)s+=((r=i[_]).x-(e=i[d]).x)*(e.y+r.y);return s}As.types=["Unknown","Point","LineString","Polygon"],As.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,s=1,d=0,m=0,_=0,b=[];i.pos<r;){if(d<=0){var I=i.readVarint();s=7&I,d=I>>3}if(d--,s===1||s===2)m+=i.readSVarint(),_+=i.readSVarint(),s===1&&(e&&b.push(e),e=[]),e.push(new wp(m,_));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&b.push(e),b},As.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,s=0,d=0,m=0,_=1/0,b=-1/0,I=1/0,z=-1/0;i.pos<e;){if(s<=0){var R=i.readVarint();r=7&R,s=R>>3}if(s--,r===1||r===2)(d+=i.readSVarint())<_&&(_=d),d>b&&(b=d),(m+=i.readSVarint())<I&&(I=m),m>z&&(z=m);else if(r!==7)throw new Error("unknown command "+r)}return[_,I,b,z]},As.prototype.toGeoJSON=function(i,e,r){var s,d,m=this.extent*Math.pow(2,r),_=this.extent*i,b=this.extent*e,I=this.loadGeometry(),z=As.types[this.type];function R(Z){for(var X=0;X<Z.length;X++){var oe=Z[X];Z[X]=[360*(oe.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(s=0;s<I.length;s++)F[s]=I[s][0];R(I=F);break;case 2:for(s=0;s<I.length;s++)R(I[s]);break;case 3:for(I=function(Z){var X=Z.length;if(X<=1)return[Z];for(var oe,ae,ke=[],De=0;De<X;De++){var xe=Ip(Z[De]);xe!==0&&(ae===void 0&&(ae=xe<0),ae===xe<0?(oe&&ke.push(oe),oe=[Z[De]]):oe.push(Z[De]))}return oe&&ke.push(oe),ke}(I),s=0;s<I.length;s++)for(d=0;d<I[s].length;d++)R(I[s][d])}I.length===1?I=I[0]:z="Multi"+z;var q={type:"Feature",geometry:{type:z,coordinates:I},properties:this.properties};return"id"in this&&(q.id=this.id),q};var Ep=Ju,Yu=Qu;function Qu(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Tp,this,e),this.length=this._features.length}function Tp(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(s){for(var d=null,m=s.readVarint()+s.pos;s.pos<m;){var _=s.readVarint()>>3;d=_===1?s.readString():_===2?s.readFloat():_===3?s.readDouble():_===4?s.readVarint64():_===5?s.readVarint():_===6?s.readSVarint():_===7?s.readBoolean():null}return d}(r))}Qu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Ep(this._pbf,e,this.extent,this._keys,this._values)};var Sp=Yu;function Ap(i,e,r){if(i===3){var s=new Sp(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}wa.VectorTile=function(i,e){this.layers=i.readFields(Ap,{},e)},wa.VectorTileFeature=Ju,wa.VectorTileLayer=Yu;const Dp=wa.VectorTileFeature.types,Nc=Math.pow(2,13);function Ao(i,e,r,s,d,m,_,b){i.emplaceBack(e,r,2*Math.floor(s*Nc)+_,d*Nc*2,m*Nc*2,Math.round(b))}class qc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new si,this.centroidVertexArray=new Lt,this.indexArray=new Ar,this.programConfigurations=new Ya(e.layers,e.zoom),this.segments=new ei,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.features=[],this.hasPattern=Oc("fill-extrusion",this.layers,r);for(const{feature:d,id:m,index:_,sourceLayerIndex:b}of e){const I=this.layers[0]._featureFilter.needGeometry,z=$a(d,I);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),z,s))continue;const R={id:m,sourceLayerIndex:b,index:_,geometry:I?z.geometry:Qa(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(Vc("fill-extrusion",this.layers,R,this.zoom,r)):this.addFeature(R,R.geometry,_,s,{}),r.featureIndex.insert(d,R.geometry,_,b,this.index,!0)}}addFeatures(e,r,s){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,r,s)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,xp.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,s,d,m){const _={x:0,y:0,vertexCount:0};for(const b of Fc(r,500)){let I=0;for(const X of b)I+=X.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of b){if(X.length===0||zp(X))continue;let oe=0;for(let ae=0;ae<X.length;ae++){const ke=X[ae];if(ae>=1){const De=X[ae-1];if(!Cp(ke,De)){z.vertexLength+4>ei.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const xe=ke.sub(De)._perp()._unit(),Se=De.dist(ke);oe+Se>32768&&(oe=0),Ao(this.layoutVertexArray,ke.x,ke.y,xe.x,xe.y,0,0,oe),Ao(this.layoutVertexArray,ke.x,ke.y,xe.x,xe.y,0,1,oe),_.x+=2*ke.x,_.y+=2*ke.y,_.vertexCount+=2,oe+=Se,Ao(this.layoutVertexArray,De.x,De.y,xe.x,xe.y,0,0,oe),Ao(this.layoutVertexArray,De.x,De.y,xe.x,xe.y,0,1,oe),_.x+=2*De.x,_.y+=2*De.y,_.vertexCount+=2;const je=z.vertexLength;this.indexArray.emplaceBack(je,je+2,je+1),this.indexArray.emplaceBack(je+1,je+2,je+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+I>ei.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),Dp[e.type]!=="Polygon")continue;const R=[],F=[],q=z.vertexLength;for(const X of b)if(X.length!==0){X!==b[0]&&F.push(R.length/2);for(let oe=0;oe<X.length;oe++){const ae=X[oe];Ao(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),_.x+=ae.x,_.y+=ae.y,_.vertexCount+=1,R.push(ae.x),R.push(ae.y)}}const Z=Pl.exports(R,F);for(let X=0;X<Z.length;X+=3)this.indexArray.emplaceBack(q+Z[X],q+Z[X+2],q+Z[X+1]);z.primitiveLength+=Z.length/3,z.vertexLength+=I}for(let b=0;b<_.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(_.x/_.vertexCount),Math.floor(_.y/_.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,d)}}function Cp(i,e){return i.x===e.x&&(i.x<0||i.x>tr)||i.y===e.y&&(i.y<0||i.y>tr)}function zp(i){return i.every(e=>e.x<0)||i.every(e=>e.x>tr)||i.every(e=>e.y<0)||i.every(e=>e.y>tr)}kt("FillExtrusionBucket",qc,{omit:["layers","features"]});var Mp={paint:new dr({"fill-extrusion-opacity":new At(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new va(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new At(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Do(i,e){return i.x*e.x+i.y*e.y}function $u(i,e){if(i.length===1){let r=0;const s=e[r++];let d;for(;!d||s.equals(d);)if(d=e[r++],!d)return 1/0;for(;r<e.length;r++){const m=e[r],_=i[0],b=d.sub(s),I=m.sub(s),z=_.sub(s),R=Do(b,b),F=Do(b,I),q=Do(I,I),Z=Do(z,b),X=Do(z,I),oe=R*q-F*F,ae=(q*Z-F*X)/oe,ke=(R*X-F*Z)/oe,De=s.z*(1-ae-ke)+d.z*ae+m.z*ke;if(isFinite(De))return De}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}const Pp=Ji([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Lp}=Pp,Rp=Ji([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Bp}=Rp,Fp=wa.VectorTileFeature.types,Op=Math.cos(Math.PI/180*37.5),eh=Math.pow(2,14)/.5;class Gc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ui,this.layoutVertexArray2=new Ti,this.indexArray=new Ar,this.programConfigurations=new Ya(e.layers,e.zoom),this.segments=new ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s){this.hasPattern=Oc("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),m=!d.isConstant(),_=[];for(const{feature:b,id:I,index:z,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,q=$a(b,F);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),q,s))continue;const Z=m?d.evaluate(q,{},s):void 0,X={id:I,properties:b.properties,type:b.type,sourceLayerIndex:R,index:z,geometry:F?q.geometry:Qa(b),patterns:{},sortKey:Z};_.push(X)}m&&_.sort((b,I)=>b.sortKey-I.sortKey);for(const b of _){const{geometry:I,index:z,sourceLayerIndex:R}=b;if(this.hasPattern){const F=Vc("line",this.layers,b,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(b,I,z,s,{});r.featureIndex.insert(e[z].feature,I,z,R,this.index)}}update(e,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s)}addFeatures(e,r,s){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Bp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,d,m){const _=this.layers[0].layout,b=_.get("line-join").evaluate(e,{}),I=_.get("line-cap"),z=_.get("line-miter-limit"),R=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of r)this.addLine(F,e,b,I,z,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,m,d)}addLine(e,r,s,d,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<e.length-1;ke++)this.totalDistance+=e[ke].dist(e[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=Fp[r.type]==="Polygon";let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let z=0;for(;z<I-1&&e[z].equals(e[z+1]);)z++;if(I<(b?3:2))return;s==="bevel"&&(m=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let q,Z,X,oe,ae;this.e1=this.e2=-1,b&&(q=e[I-2],ae=e[z].sub(q)._unit()._perp());for(let ke=z;ke<I;ke++){if(X=ke===I-1?b?e[z+1]:void 0:e[ke+1],X&&e[ke].equals(X))continue;ae&&(oe=ae),q&&(Z=q),q=e[ke],ae=X?X.sub(q)._unit()._perp():oe,oe=oe||ae;let De=oe.add(ae);De.x===0&&De.y===0||De._unit();const xe=oe.x*ae.x+oe.y*ae.y,Se=De.x*ae.x+De.y*ae.y,je=Se!==0?1/Se:1/0,Ne=2*Math.sqrt(2-2*Se),wt=Se<Op&&Z&&X,Et=oe.x*ae.y-oe.y*ae.x>0;if(wt&&ke>z){const at=q.dist(Z);if(at>2*R){const gt=q.sub(q.sub(Z)._mult(R/at)._round());this.updateDistance(Z,gt),this.addCurrentVertex(gt,oe,0,0,F),Z=gt}}const mt=Z&&X;let lt=mt?s:b?"butt":d;if(mt&&lt==="round"&&(je<_?lt="miter":je<=2&&(lt="fakeround")),lt==="miter"&&je>m&&(lt="bevel"),lt==="bevel"&&(je>2&&(lt="flipbevel"),je<m&&(lt="miter")),Z&&this.updateDistance(Z,q),lt==="miter")De._mult(je),this.addCurrentVertex(q,De,0,0,F);else if(lt==="flipbevel"){if(je>100)De=ae.mult(-1);else{const at=je*oe.add(ae).mag()/oe.sub(ae).mag();De._perp()._mult(at*(Et?-1:1))}this.addCurrentVertex(q,De,0,0,F),this.addCurrentVertex(q,De.mult(-1),0,0,F)}else if(lt==="bevel"||lt==="fakeround"){const at=-Math.sqrt(je*je-1),gt=Et?at:0,dt=Et?0:at;if(Z&&this.addCurrentVertex(q,oe,gt,dt,F),lt==="fakeround"){const Qe=Math.round(180*Ne/Math.PI/20);for(let Rt=1;Rt<Qe;Rt++){let Dt=Rt/Qe;if(Dt!==.5){const Li=Dt-.5;Dt+=Dt*Li*(Dt-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*Li*Li+(.848013+xe*(.215638*xe-1.06021)))}const $t=ae.sub(oe)._mult(Dt)._add(oe)._unit()._mult(Et?-1:1);this.addHalfVertex(q,$t.x,$t.y,!1,Et,0,F)}}X&&this.addCurrentVertex(q,ae,-gt,-dt,F)}else if(lt==="butt")this.addCurrentVertex(q,De,0,0,F);else if(lt==="square"){const at=Z?1:-1;this.addCurrentVertex(q,De,at,at,F)}else lt==="round"&&(Z&&(this.addCurrentVertex(q,oe,0,0,F),this.addCurrentVertex(q,oe,1,1,F,!0)),X&&(this.addCurrentVertex(q,ae,-1,-1,F,!0),this.addCurrentVertex(q,ae,0,0,F)));if(wt&&ke<I-1){const at=q.dist(X);if(at>2*R){const gt=q.add(X.sub(q)._mult(R/at)._round());this.updateDistance(q,gt),this.addCurrentVertex(gt,ae,0,0,F),q=gt}}}}addCurrentVertex(e,r,s,d,m,_=!1){const b=r.y*d-r.x,I=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,_,!1,s,m),this.addHalfVertex(e,b,I,_,!0,-d,m),this.distance>eh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,s,d,m,_))}addHalfVertex({x:e,y:r},s,d,m,_,b,I){const z=.5*(this.lineClips?this.scaledDistance*(eh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),I.primitiveLength++),_?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}kt("LineBucket",Gc,{omit:["layers","patternFeatures"]});const Vp=new dr({"line-cap":new At(Fe.layout_line["line-cap"]),"line-join":new Ot(Fe.layout_line["line-join"]),"line-miter-limit":new At(Fe.layout_line["line-miter-limit"]),"line-round-limit":new At(Fe.layout_line["line-round-limit"]),"line-sort-key":new Ot(Fe.layout_line["line-sort-key"])});var th={paint:new dr({"line-opacity":new Ot(Fe.paint_line["line-opacity"]),"line-color":new Ot(Fe.paint_line["line-color"]),"line-translate":new At(Fe.paint_line["line-translate"]),"line-translate-anchor":new At(Fe.paint_line["line-translate-anchor"]),"line-width":new Ot(Fe.paint_line["line-width"]),"line-gap-width":new Ot(Fe.paint_line["line-gap-width"]),"line-offset":new Ot(Fe.paint_line["line-offset"]),"line-blur":new Ot(Fe.paint_line["line-blur"]),"line-dasharray":new go(Fe.paint_line["line-dasharray"]),"line-pattern":new va(Fe.paint_line["line-pattern"]),"line-gradient":new Pn(Fe.paint_line["line-gradient"])}),layout:Vp};const ih=new class extends Ot{possiblyEvaluate(i,e){return e=new Vi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,s){return e=O({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,s)}}(th.paint.properties["line-width"].specification);function rh(i,e){return e>0?e+2*i:i}ih.useIntegerZoom=!0;const Up=Ji([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Np=Ji([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ji([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qp=Ji([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ji([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nh=Ji([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gp=Ji([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function jp(i,e,r){return i.sections.forEach(s=>{s.text=function(d,m,_){const b=m.layout.get("text-transform").evaluate(_,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),Zr.applyArabicShaping&&(d=Zr.applyArabicShaping(d)),d}(s.text,e,r)}),i}Ji([{name:"triangle",components:3,type:"Uint16"}]),Ji([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ji([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ji([{type:"Float32",name:"offsetX"}]),Ji([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Co={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var fr=24,jc=Di,ah=function(i,e,r,s,d){var m,_,b=8*d-s-1,I=(1<<b)-1,z=I>>1,R=-7,F=r?d-1:0,q=r?-1:1,Z=i[e+F];for(F+=q,m=Z&(1<<-R)-1,Z>>=-R,R+=b;R>0;m=256*m+i[e+F],F+=q,R-=8);for(_=m&(1<<-R)-1,m>>=-R,R+=s;R>0;_=256*_+i[e+F],F+=q,R-=8);if(m===0)m=1-z;else{if(m===I)return _?NaN:1/0*(Z?-1:1);_+=Math.pow(2,s),m-=z}return(Z?-1:1)*_*Math.pow(2,m-s)},sh=function(i,e,r,s,d,m){var _,b,I,z=8*m-d-1,R=(1<<z)-1,F=R>>1,q=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=s?0:m-1,X=s?1:-1,oe=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,_=R):(_=Math.floor(Math.log(e)/Math.LN2),e*(I=Math.pow(2,-_))<1&&(_--,I*=2),(e+=_+F>=1?q/I:q*Math.pow(2,1-F))*I>=2&&(_++,I/=2),_+F>=R?(b=0,_=R):_+F>=1?(b=(e*I-1)*Math.pow(2,d),_+=F):(b=e*Math.pow(2,F-1)*Math.pow(2,d),_=0));d>=8;i[r+Z]=255&b,Z+=X,b/=256,d-=8);for(_=_<<d|b,z+=d;z>0;i[r+Z]=255&_,Z+=X,_/=256,z-=8);i[r+Z-X]|=128*oe};function Di(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Di.Varint=0,Di.Fixed64=1,Di.Bytes=2,Di.Fixed32=5;var ka,Zc=4294967296,oh=1/Zc,lh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qn(i){return i.type===Di.Bytes?i.readVarint()+i.pos:i.pos+1}function Ds(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function ch(i,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var d=r.pos-1;d>=i;d--)r.buf[d+s]=r.buf[d]}function Zp(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Xp(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Wp(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Hp(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Kp(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Jp(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Yp(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Qp(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function $p(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function Ol(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Cs(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function uh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function em(i,e,r){i===1&&r.readMessage(tm,e)}function tm(i,e,r){if(i===3){const{id:s,bitmap:d,width:m,height:_,left:b,top:I,advance:z}=r.readMessage(im,{});e.push({id:s,bitmap:new ko({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:b,top:I,advance:z}})}}function im(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function hh(i){let e=0,r=0;for(const _ of i)e+=_.w*_.h,r=Math.max(r,_.w);i.sort((_,b)=>b.h-_.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let d=0,m=0;for(const _ of i)for(let b=s.length-1;b>=0;b--){const I=s[b];if(!(_.w>I.w||_.h>I.h)){if(_.x=I.x,_.y=I.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===I.w&&_.h===I.h){const z=s.pop();b<s.length&&(s[b]=z)}else _.h===I.h?(I.x+=_.w,I.w-=_.w):_.w===I.w?(I.y+=_.h,I.h-=_.h):(s.push({x:I.x+_.w,y:I.y,w:I.w-_.w,h:_.h}),I.y+=_.h,I.h-=_.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}Di.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),d=s>>3,m=this.pos;this.type=7&s,i(d,e,this),this.pos===m&&this.skip(s)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Ol(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=uh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ol(this.buf,this.pos)+Ol(this.buf,this.pos+4)*Zc;return this.pos+=8,i},readSFixed64:function(){var i=Ol(this.buf,this.pos)+uh(this.buf,this.pos+4)*Zc;return this.pos+=8,i},readFloat:function(){var i=ah(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ah(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(d,m,_){var b,I,z=_.buf;if(b=(112&(I=z[_.pos++]))>>4,I<128||(b|=(127&(I=z[_.pos++]))<<3,I<128)||(b|=(127&(I=z[_.pos++]))<<10,I<128)||(b|=(127&(I=z[_.pos++]))<<17,I<128)||(b|=(127&(I=z[_.pos++]))<<24,I<128)||(b|=(1&(I=z[_.pos++]))<<31,I<128))return Ds(d,b,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&lh?function(r,s,d){return lh.decode(r.subarray(s,d))}(this.buf,e,i):function(r,s,d){for(var m="",_=s;_<d;){var b,I,z,R=r[_],F=null,q=R>239?4:R>223?3:R>191?2:1;if(_+q>d)break;q===1?R<128&&(F=R):q===2?(192&(b=r[_+1]))==128&&(F=(31&R)<<6|63&b)<=127&&(F=null):q===3?(I=r[_+2],(192&(b=r[_+1]))==128&&(192&I)==128&&((F=(15&R)<<12|(63&b)<<6|63&I)<=2047||F>=55296&&F<=57343)&&(F=null)):q===4&&(I=r[_+2],z=r[_+3],(192&(b=r[_+1]))==128&&(192&I)==128&&(192&z)==128&&((F=(15&R)<<18|(63&b)<<12|(63&I)<<6|63&z)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,q=1):F>65535&&(F-=65536,m+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),m+=String.fromCharCode(F),_+=q}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Di.Bytes)return i.push(this.readVarint(e));var r=Qn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Di.Bytes)return i.push(this.readSVarint());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Di.Bytes)return i.push(this.readBoolean());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Di.Bytes)return i.push(this.readFloat());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Di.Bytes)return i.push(this.readDouble());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Di.Bytes)return i.push(this.readFixed32());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Di.Bytes)return i.push(this.readSFixed32());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Di.Bytes)return i.push(this.readFixed64());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Di.Bytes)return i.push(this.readSFixed64());var e=Qn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Di.Varint)for(;this.buf[this.pos++]>127;);else if(e===Di.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Di.Fixed32)this.pos+=4;else{if(e!==Di.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Cs(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Cs(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Cs(this.buf,-1&i,this.pos),Cs(this.buf,Math.floor(i*oh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Cs(this.buf,-1&i,this.pos),Cs(this.buf,Math.floor(i*oh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var s,d;if(e>=0?(s=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,_,b){b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7)}(s,0,r),function(m,_){var b=(7&m)<<4;_.buf[_.pos++]|=b|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(d,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(s,d,m){for(var _,b,I=0;I<d.length;I++){if((_=d.charCodeAt(I))>55295&&_<57344){if(!b){_>56319||I+1===d.length?(s[m++]=239,s[m++]=191,s[m++]=189):b=_;continue}if(_<56320){s[m++]=239,s[m++]=191,s[m++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(s[m++]=239,s[m++]=191,s[m++]=189,b=null);_<128?s[m++]=_:(_<2048?s[m++]=_>>6|192:(_<65536?s[m++]=_>>12|224:(s[m++]=_>>18|240,s[m++]=_>>12&63|128),s[m++]=_>>6&63|128),s[m++]=63&_|128)}return m}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&ch(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),sh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),sh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var s=this.pos-r;s>=128&&ch(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,e,r){this.writeTag(i,Di.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Zp,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Xp,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Kp,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Wp,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Hp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Jp,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Yp,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Qp,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,$p,e)},writeBytesField:function(i,e){this.writeTag(i,Di.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Di.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Di.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Di.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Di.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Di.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Di.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Di.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Di.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Di.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};class Xc{constructor(e,{pixelRatio:r,version:s,stretchX:d,stretchY:m,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=d,this.stretchY=m,this.content=_,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class dh{constructor(e,r){const s={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,s,m),this.addImages(r,d,m);const{w:_,h:b}=hh(m),I=new tn({width:_||1,height:b||1});for(const z in e){const R=e[z],F=s[z].paddedRect;tn.copy(R.data,I,{x:0,y:0},{x:F.x+1,y:F.y+1},R.data)}for(const z in r){const R=r[z],F=d[z].paddedRect,q=F.x+1,Z=F.y+1,X=R.data.width,oe=R.data.height;tn.copy(R.data,I,{x:0,y:0},{x:q,y:Z},R.data),tn.copy(R.data,I,{x:0,y:oe-1},{x:q,y:Z-1},{width:X,height:1}),tn.copy(R.data,I,{x:0,y:0},{x:q,y:Z+oe},{width:X,height:1}),tn.copy(R.data,I,{x:X-1,y:0},{x:q-1,y:Z},{width:1,height:oe}),tn.copy(R.data,I,{x:0,y:0},{x:q+X,y:Z},{width:1,height:oe})}this.image=I,this.iconPositions=s,this.patternPositions=d}addImages(e,r,s){for(const d in e){const m=e[d],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};s.push(_),r[d]=new Xc(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[d,m]=e.tl;s.update(r.data,void 0,{x:d,y:m})}}kt("ImagePosition",Xc),kt("ImageAtlas",dh),a.WritingMode=void 0,(ka=a.WritingMode||(a.WritingMode={}))[ka.none=0]="none",ka[ka.horizontal=1]="horizontal",ka[ka.vertical=2]="vertical",ka[ka.horizontalOnly=3]="horizontalOnly";const Vl=-17;class zo{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new zo;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new zo;return r.imageName=e,r}}class zs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new zs;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?s.addImageSection(m):s.addTextSection(m,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let s=0;s<e.length;s++){const d=e.charCodeAt(s+1)||null,m=e.charCodeAt(s-1)||null;r+=d&&vl(d)&&!Co[e[s+1]]||m&&vl(m)&&!Co[e[s-1]]||!Co[e[s]]?e[s]:Co[e[s]]}return r}(this.text)}trim(){let e=0;for(let s=0;s<this.text.length&&Nl[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Nl[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new zs;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(zo.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void _e("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(zo.forImage(r)),this.sectionIndex.push(this.sections.length-1)):_e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ul(i,e,r,s,d,m,_,b,I,z,R,F,q,Z,X,oe){const ae=zs.fromFeature(i,d);let ke;F===a.WritingMode.vertical&&ae.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:xe}=Zr;if(De&&ae.sections.length===1){ke=[];const Ne=De(ae.toString(),Wc(ae,z,m,e,s,Z,X));for(const wt of Ne){const Et=new zs;Et.text=wt,Et.sections=ae.sections;for(let mt=0;mt<wt.length;mt++)Et.sectionIndex.push(0);ke.push(Et)}}else if(xe){ke=[];const Ne=xe(ae.text,ae.sectionIndex,Wc(ae,z,m,e,s,Z,X));for(const wt of Ne){const Et=new zs;Et.text=wt[0],Et.sectionIndex=wt[1],Et.sections=ae.sections,ke.push(Et)}}else ke=function(Ne,wt){const Et=[],mt=Ne.text;let lt=0;for(const at of wt)Et.push(Ne.substring(lt,at)),lt=at;return lt<mt.length&&Et.push(Ne.substring(lt,mt.length)),Et}(ae,Wc(ae,z,m,e,s,Z,X));const Se=[],je={positionedLines:Se,text:ae.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Ne,wt,Et,mt,lt,at,gt,dt,Qe,Rt,Dt,$t){let Li=0,Ni=Vl,ir=0,nn=0;const mr=dt==="right"?1:dt==="left"?0:.5;let Yi=0;for(const Qi of lt){Qi.trim();const _r=Qi.getMaxScale(),Ir=(_r-1)*fr,zr={positionedGlyphs:[],lineOffset:0};Ne.positionedLines[Yi]=zr;const Vr=zr.positionedGlyphs;let Ur=0;if(!Qi.length()){Ni+=at,++Yi;continue}for(let cr=0;cr<Qi.length();cr++){const ri=Qi.getSection(cr),Hr=Qi.getSectionIndex(cr),yr=Qi.getCharCode(cr);let Er=0,fn=null,kn=null,In=null,ea=fr;const pn=!(Qe===a.WritingMode.horizontal||!Dt&&!co(yr)||Dt&&(Nl[yr]||(lr=yr,pt.Arabic(lr)||pt["Arabic Supplement"](lr)||pt["Arabic Extended-A"](lr)||pt["Arabic Presentation Forms-A"](lr)||pt["Arabic Presentation Forms-B"](lr))));if(ri.imageName){const an=mt[ri.imageName];if(!an)continue;In=ri.imageName,Ne.iconsInText=Ne.iconsInText||!0,kn=an.paddedRect;const Nr=an.displaySize;ri.scale=ri.scale*fr/$t,fn={width:Nr[0],height:Nr[1],left:1,top:-3,advance:pn?Nr[1]:Nr[0]},Er=Ir+(fr-Nr[1]*ri.scale),ea=fn.advance;const ta=pn?Nr[0]*ri.scale-fr*_r:Nr[1]*ri.scale-fr*_r;ta>0&&ta>Ur&&(Ur=ta)}else{const an=Et[ri.fontStack],Nr=an&&an[yr];if(Nr&&Nr.rect)kn=Nr.rect,fn=Nr.metrics;else{const ta=wt[ri.fontStack],Lo=ta&&ta[yr];if(!Lo)continue;fn=Lo.metrics}Er=(_r-ri.scale)*fr}pn?(Ne.verticalizable=!0,Vr.push({glyph:yr,imageName:In,x:Li,y:Ni+Er,vertical:pn,scale:ri.scale,fontStack:ri.fontStack,sectionIndex:Hr,metrics:fn,rect:kn}),Li+=ea*ri.scale+Rt):(Vr.push({glyph:yr,imageName:In,x:Li,y:Ni+Er,vertical:pn,scale:ri.scale,fontStack:ri.fontStack,sectionIndex:Hr,metrics:fn,rect:kn}),Li+=fn.advance*ri.scale+Rt)}Vr.length!==0&&(ir=Math.max(Li-Rt,ir),am(Vr,0,Vr.length-1,mr,Ur)),Li=0;const qi=at*_r+Ur;zr.lineOffset=Math.max(Ur,Ir),Ni+=qi,nn=Math.max(qi,nn),++Yi}var lr;const gr=Ni-Vl,{horizontalAlign:kr,verticalAlign:Or}=Hc(gt);(function(Qi,_r,Ir,zr,Vr,Ur,qi,cr,ri){const Hr=(_r-Ir)*Vr;let yr=0;yr=Ur!==qi?-cr*zr-Vl:(-zr*ri+.5)*qi;for(const Er of Qi)for(const fn of Er.positionedGlyphs)fn.x+=Hr,fn.y+=yr})(Ne.positionedLines,mr,kr,Or,ir,nn,at,gr,lt.length),Ne.top+=-Or*gr,Ne.bottom=Ne.top+gr,Ne.left+=-kr*ir,Ne.right=Ne.left+ir}(je,e,r,s,ke,_,b,I,F,z,q,oe),!function(Ne){for(const wt of Ne)if(wt.positionedGlyphs.length!==0)return!1;return!0}(Se)&&je}const Nl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fh(i,e,r,s,d,m){if(e.imageName){const _=s[e.imageName];return _?_.displaySize[0]*e.scale*fr/m+d:0}{const _=r[e.fontStack],b=_&&_[i];return b?b.metrics.advance*e.scale+d:0}}function ph(i,e,r,s){const d=Math.pow(i-e,2);return s?i<e?d/2:2*d:d+Math.abs(r)*r}function nm(i,e,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function mh(i,e,r,s,d,m){let _=null,b=ph(e,r,d,m);for(const I of s){const z=ph(e-I.x,r,d,m)+I.badness;z<=b&&(_=I,b=z)}return{index:i,x:e,priorBreak:_,badness:b}}function gh(i){return i?gh(i.priorBreak).concat(i.index):[]}function Wc(i,e,r,s,d,m,_){if(m!=="point")return[];if(!i)return[];const b=[],I=function(q,Z,X,oe,ae,ke){let De=0;for(let xe=0;xe<q.length();xe++){const Se=q.getSection(xe);De+=fh(q.getCharCode(xe),Se,oe,ae,Z,ke)}return De/Math.max(1,Math.ceil(De/X))}(i,e,r,s,d,_),z=i.text.indexOf("")>=0;let R=0;for(let q=0;q<i.length();q++){const Z=i.getSection(q),X=i.getCharCode(q);if(Nl[X]||(R+=fh(X,Z,s,d,e,_)),q<i.length()-1){const oe=!((F=X)<11904||!(pt["Bopomofo Extended"](F)||pt.Bopomofo(F)||pt["CJK Compatibility Forms"](F)||pt["CJK Compatibility Ideographs"](F)||pt["CJK Compatibility"](F)||pt["CJK Radicals Supplement"](F)||pt["CJK Strokes"](F)||pt["CJK Symbols and Punctuation"](F)||pt["CJK Unified Ideographs Extension A"](F)||pt["CJK Unified Ideographs"](F)||pt["Enclosed CJK Letters and Months"](F)||pt["Halfwidth and Fullwidth Forms"](F)||pt.Hiragana(F)||pt["Ideographic Description Characters"](F)||pt["Kangxi Radicals"](F)||pt["Katakana Phonetic Extensions"](F)||pt.Katakana(F)||pt["Vertical Forms"](F)||pt["Yi Radicals"](F)||pt["Yi Syllables"](F)));(rm[X]||oe||Z.imageName)&&b.push(mh(q+1,R,I,b,nm(X,i.getCharCode(q+1),oe&&z),!1))}}var F;return gh(mh(i.length(),R,I,b,0,!0))}function Hc(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function am(i,e,r,s,d){if(!s&&!d)return;const m=i[r],_=(i[r].x+m.metrics.advance*m.scale)*s;for(let b=e;b<=r;b++)i[b].x-=_,i[b].y+=d}function sm(i,e,r){const{horizontalAlign:s,verticalAlign:d}=Hc(r),m=e[0]-i.displaySize[0]*s,_=e[1]-i.displaySize[1]*d;return{image:i,top:_,bottom:_+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function _h(i,e,r,s,d,m){const _=i.image;let b;if(_.content){const ae=_.content,ke=_.pixelRatio||1;b=[ae[0]/ke,ae[1]/ke,_.displaySize[0]-ae[2]/ke,_.displaySize[1]-ae[3]/ke]}const I=e.left*m,z=e.right*m;let R,F,q,Z;r==="width"||r==="both"?(Z=d[0]+I-s[3],F=d[0]+z+s[1]):(Z=d[0]+(I+z-_.displaySize[0])/2,F=Z+_.displaySize[0]);const X=e.top*m,oe=e.bottom*m;return r==="height"||r==="both"?(R=d[1]+X-s[0],q=d[1]+oe+s[2]):(R=d[1]+(X+oe-_.displaySize[1])/2,q=R+_.displaySize[1]),{image:_,top:R,right:F,bottom:q,left:Z,collisionPadding:b}}const $n=128;function yh(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Vi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:d}=r;let m=0;for(;m<s.length&&s[m]<=i;)m++;m=Math.max(0,m-1);let _=m;for(;_<s.length&&s[_]<i+1;)_++;_=Math.min(s.length-1,_);const b=s[m],I=s[_];return r.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:I,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:I,minSize:r.evaluate(new Vi(b)),maxSize:r.evaluate(new Vi(I)),interpolationType:d}}}class Ia extends Ue{constructor(e,r,s,d){super(e,r),this.angle=s,d!==void 0&&(this.segment=d)}clone(){return new Ia(this.x,this.y,this.angle,this.segment)}}function vh(i,e,r,s,d){if(e.segment===void 0)return!0;let m=e,_=e.segment+1,b=0;for(;b>-r/2;){if(_--,_<0)return!1;b-=i[_].dist(m),m=i[_]}b+=i[_].dist(i[_+1]),_++;const I=[];let z=0;for(;b<r/2;){const R=i[_],F=i[_+1];if(!F)return!1;let q=i[_-1].angleTo(R)-R.angleTo(F);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:b,angleDelta:q}),z+=q;b-I[0].distance>s;)z-=I.shift().angleDelta;if(z>d)return!1;_++,b+=R.dist(F)}return!0}function xh(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function bh(i,e,r){return i?.6*e*r:0}function wh(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function om(i,e,r,s,d,m){const _=bh(r,d,m),b=wh(r,s)*m;let I=0;const z=xh(i)/2;for(let R=0;R<i.length-1;R++){const F=i[R],q=i[R+1],Z=F.dist(q);if(I+Z>z){const X=(z-I)/Z,oe=Fi(F.x,q.x,X),ae=Fi(F.y,q.y,X),ke=new Ia(oe,ae,q.angleTo(F),R);return ke._round(),!_||vh(i,ke,b,_,e)?ke:void 0}I+=Z}}function lm(i,e,r,s,d,m,_,b,I){const z=bh(s,m,_),R=wh(s,d),F=R*_,q=i[0].x===0||i[0].x===I||i[0].y===0||i[0].y===I;return e-F<e/4&&(e=F+e/4),kh(i,q?e/2*b%e:(R/2+2*m)*_*b%e,e,z,r,F,q,!1,I)}function kh(i,e,r,s,d,m,_,b,I){const z=m/2,R=xh(i);let F=0,q=e-r,Z=[];for(let X=0;X<i.length-1;X++){const oe=i[X],ae=i[X+1],ke=oe.dist(ae),De=ae.angleTo(oe);for(;q+r<F+ke;){q+=r;const xe=(q-F)/ke,Se=Fi(oe.x,ae.x,xe),je=Fi(oe.y,ae.y,xe);if(Se>=0&&Se<I&&je>=0&&je<I&&q-z>=0&&q+z<=R){const Ne=new Ia(Se,je,De,X);Ne._round(),s&&!vh(i,Ne,m,s,d)||Z.push(Ne)}}F+=ke}return b||Z.length||_||(Z=kh(i,F/2,r,s,d,m,_,!0,I)),Z}function Ih(i,e,r,s,d){const m=[];for(let _=0;_<i.length;_++){const b=i[_];let I;for(let z=0;z<b.length-1;z++){let R=b[z],F=b[z+1];R.x<e&&F.x<e||(R.x<e?R=new Ue(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x<e&&(F=new Ue(e,R.y+(e-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y<r&&F.y<r||(R.y<r?R=new Ue(R.x+(r-R.y)/(F.y-R.y)*(F.x-R.x),r)._round():F.y<r&&(F=new Ue(R.x+(r-R.y)/(F.y-R.y)*(F.x-R.x),r)._round()),R.x>=s&&F.x>=s||(R.x>=s?R=new Ue(s,R.y+(s-R.x)/(F.x-R.x)*(F.y-R.y))._round():F.x>=s&&(F=new Ue(s,R.y+(s-R.x)/(F.x-R.x)*(F.y-R.y))._round()),R.y>=d&&F.y>=d||(R.y>=d?R=new Ue(R.x+(d-R.y)/(F.y-R.y)*(F.x-R.x),d)._round():F.y>=d&&(F=new Ue(R.x+(d-R.y)/(F.y-R.y)*(F.x-R.x),d)._round()),I&&R.equals(I[I.length-1])||(I=[R],m.push(I)),I.push(F)))))}}return m}function Eh(i,e,r,s){const d=[],m=i.image,_=m.pixelRatio,b=m.paddedRect.w-2,I=m.paddedRect.h-2,z=i.right-i.left,R=i.bottom-i.top,F=m.stretchX||[[0,b]],q=m.stretchY||[[0,I]],Z=(at,gt)=>at+gt[1]-gt[0],X=F.reduce(Z,0),oe=q.reduce(Z,0),ae=b-X,ke=I-oe;let De=0,xe=X,Se=0,je=oe,Ne=0,wt=ae,Et=0,mt=ke;if(m.content&&s){const at=m.content;De=ql(F,0,at[0]),Se=ql(q,0,at[1]),xe=ql(F,at[0],at[2]),je=ql(q,at[1],at[3]),Ne=at[0]-De,Et=at[1]-Se,wt=at[2]-at[0]-xe,mt=at[3]-at[1]-je}const lt=(at,gt,dt,Qe)=>{const Rt=Gl(at.stretch-De,xe,z,i.left),Dt=jl(at.fixed-Ne,wt,at.stretch,X),$t=Gl(gt.stretch-Se,je,R,i.top),Li=jl(gt.fixed-Et,mt,gt.stretch,oe),Ni=Gl(dt.stretch-De,xe,z,i.left),ir=jl(dt.fixed-Ne,wt,dt.stretch,X),nn=Gl(Qe.stretch-Se,je,R,i.top),mr=jl(Qe.fixed-Et,mt,Qe.stretch,oe),Yi=new Ue(Rt,$t),lr=new Ue(Ni,$t),gr=new Ue(Ni,nn),kr=new Ue(Rt,nn),Or=new Ue(Dt/_,Li/_),Qi=new Ue(ir/_,mr/_),_r=e*Math.PI/180;if(_r){const Vr=Math.sin(_r),Ur=Math.cos(_r),qi=[Ur,-Vr,Vr,Ur];Yi._matMult(qi),lr._matMult(qi),kr._matMult(qi),gr._matMult(qi)}const Ir=at.stretch+at.fixed,zr=gt.stretch+gt.fixed;return{tl:Yi,tr:lr,bl:kr,br:gr,tex:{x:m.paddedRect.x+1+Ir,y:m.paddedRect.y+1+zr,w:dt.stretch+dt.fixed-Ir,h:Qe.stretch+Qe.fixed-zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Or,pixelOffsetBR:Qi,minFontScaleX:wt/_/z,minFontScaleY:mt/_/R,isSDF:r}};if(s&&(m.stretchX||m.stretchY)){const at=Th(F,ae,X),gt=Th(q,ke,oe);for(let dt=0;dt<at.length-1;dt++){const Qe=at[dt],Rt=at[dt+1];for(let Dt=0;Dt<gt.length-1;Dt++)d.push(lt(Qe,gt[Dt],Rt,gt[Dt+1]))}}else d.push(lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:I+1}));return d}function ql(i,e,r){let s=0;for(const d of i)s+=Math.max(e,Math.min(r,d[1]))-Math.max(e,Math.min(r,d[0]));return s}function Th(i,e,r){const s=[{fixed:-1,stretch:0}];for(const[d,m]of i){const _=s[s.length-1];s.push({fixed:d-_.stretch,stretch:_.stretch}),s.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return s.push({fixed:e+1,stretch:r}),s}function Gl(i,e,r,s){return i/e*r+s}function jl(i,e,r,s){return i-e*r/s}kt("Anchor",Ia);class Zl{constructor(e,r,s,d,m,_,b,I,z,R){if(this.boxStartIndex=e.length,z){let F=_.top,q=_.bottom;const Z=_.collisionPadding;Z&&(F-=Z[1],q+=Z[3]);let X=q-F;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let F=_.top*b-I[0],q=_.bottom*b+I[2],Z=_.left*b-I[3],X=_.right*b+I[1];const oe=_.collisionPadding;if(oe&&(Z-=oe[0]*b,F-=oe[1]*b,X+=oe[2]*b,q+=oe[3]*b),R){const ae=new Ue(Z,F),ke=new Ue(X,F),De=new Ue(Z,q),xe=new Ue(X,q),Se=R*Math.PI/180;ae._rotate(Se),ke._rotate(Se),De._rotate(Se),xe._rotate(Se),Z=Math.min(ae.x,ke.x,De.x,xe.x),X=Math.max(ae.x,ke.x,De.x,xe.x),F=Math.min(ae.y,ke.y,De.y,xe.y),q=Math.max(ae.y,ke.y,De.y,xe.y)}e.emplaceBack(r.x,r.y,Z,F,X,q,s,d,m)}this.boxEndIndex=e.length}}class cm{constructor(e=[],r=um){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,d=r[e];for(;e>0;){const m=e-1>>1,_=r[m];if(s(d,_)>=0)break;r[e]=_,e=m}r[e]=d}_down(e){const{data:r,compare:s}=this,d=this.length>>1,m=r[e];for(;e<d;){let _=1+(e<<1),b=r[_];const I=_+1;if(I<this.length&&s(r[I],b)<0&&(_=I,b=r[I]),s(b,m)>=0)break;r[e]=b,e=_}r[e]=m}}function um(i,e){return i<e?-1:i>e?1:0}function hm(i,e=1,r=!1){let s=1/0,d=1/0,m=-1/0,_=-1/0;const b=i[0];for(let Z=0;Z<b.length;Z++){const X=b[Z];(!Z||X.x<s)&&(s=X.x),(!Z||X.y<d)&&(d=X.y),(!Z||X.x>m)&&(m=X.x),(!Z||X.y>_)&&(_=X.y)}const I=Math.min(m-s,_-d);let z=I/2;const R=new cm([],dm);if(I===0)return new Ue(s,d);for(let Z=s;Z<m;Z+=I)for(let X=d;X<_;X+=I)R.push(new Ms(Z+z,X+z,z,i));let F=function(Z){let X=0,oe=0,ae=0;const ke=Z[0];for(let De=0,xe=ke.length,Se=xe-1;De<xe;Se=De++){const je=ke[De],Ne=ke[Se],wt=je.x*Ne.y-Ne.x*je.y;oe+=(je.x+Ne.x)*wt,ae+=(je.y+Ne.y)*wt,X+=3*wt}return new Ms(oe/X,ae/X,0,Z)}(i),q=R.length;for(;R.length;){const Z=R.pop();(Z.d>F.d||!F.d)&&(F=Z,r&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,q)),Z.max-F.d<=e||(z=Z.h/2,R.push(new Ms(Z.p.x-z,Z.p.y-z,z,i)),R.push(new Ms(Z.p.x+z,Z.p.y-z,z,i)),R.push(new Ms(Z.p.x-z,Z.p.y+z,z,i)),R.push(new Ms(Z.p.x+z,Z.p.y+z,z,i)),q+=4)}return r&&(console.log(`num probes: ${q}`),console.log(`best distance: ${F.d}`)),F.p}function dm(i,e){return e.max-i.max}function Ms(i,e,r,s){this.p=new Ue(i,e),this.h=r,this.d=function(d,m){let _=!1,b=1/0;for(let I=0;I<m.length;I++){const z=m[I];for(let R=0,F=z.length,q=F-1;R<F;q=R++){const Z=z[R],X=z[q];Z.y>d.y!=X.y>d.y&&d.x<(X.x-Z.x)*(d.y-Z.y)/(X.y-Z.y)+Z.x&&(_=!_),b=Math.min(b,Lu(d,Z,X))}}return(_?1:-1)*Math.sqrt(b)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Kc=Number.POSITIVE_INFINITY;function Sh(i,e){return e[1]!==Kc?function(r,s,d){let m=0,_=0;switch(s=Math.abs(s),d=Math.abs(d),r){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(r){case"top-right":case"bottom-right":case"right":m=-s;break;case"top-left":case"bottom-left":case"left":m=s}return[m,_]}(i,e[0],e[1]):function(r,s){let d=0,m=0;s<0&&(s=0);const _=s/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-s;break;case"top":m=s-7}switch(r){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=s;break;case"right":d=-s}return[d,m]}(i,e[0])}function Jc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fm(i,e,r,s,d,m,_,b,I,z,R){let F=m.textMaxSize.evaluate(e,{});F===void 0&&(F=_);const q=i.layers[0].layout,Z=q.get("icon-offset").evaluate(e,{},R),X=Dh(r.horizontal),oe=_/24,ae=i.tilePixelRatio*oe,ke=i.tilePixelRatio*F/24,De=i.tilePixelRatio*b,xe=i.tilePixelRatio*q.get("symbol-spacing"),Se=q.get("text-padding")*i.tilePixelRatio,je=function(Qe,Rt,Dt,$t=1){const Li=Qe.get("icon-padding").evaluate(Rt,{},Dt),Ni=Li&&Li.values;return[Ni[0]*$t,Ni[1]*$t,Ni[2]*$t,Ni[3]*$t]}(q,e,R,i.tilePixelRatio),Ne=q.get("text-max-angle")/180*Math.PI,wt=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",Et=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",mt=q.get("symbol-placement"),lt=xe/2,at=q.get("icon-text-fit");let gt;s&&at!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(gt=_h(s,r.vertical,at,q.get("icon-text-fit-padding"),Z,oe)),X&&(s=_h(s,X,at,q.get("icon-text-fit-padding"),Z,oe)));const dt=(Qe,Rt)=>{Rt.x<0||Rt.x>=tr||Rt.y<0||Rt.y>=tr||function(Dt,$t,Li,Ni,ir,nn,mr,Yi,lr,gr,kr,Or,Qi,_r,Ir,zr,Vr,Ur,qi,cr,ri,Hr,yr,Er,fn){const kn=Dt.addToLineVertexArray($t,Li);let In,ea,pn,an,Nr=0,ta=0,Lo=0,Zh=0,su=-1,ou=-1;const ia={};let Xh=or.exports(""),lu=0,cu=0;if(Yi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[lu,cu]=Yi.layout.get("text-offset").evaluate(ri,{},Er).map(qr=>qr*fr):(lu=Yi.layout.get("text-radial-offset").evaluate(ri,{},Er)*fr,cu=Kc),Dt.allowVerticalPlacement&&Ni.vertical){const qr=Yi.layout.get("text-rotate").evaluate(ri,{},Er)+90;pn=new Zl(lr,$t,gr,kr,Or,Ni.vertical,Qi,_r,Ir,qr),mr&&(an=new Zl(lr,$t,gr,kr,Or,mr,Vr,Ur,Ir,qr))}if(ir){const qr=Yi.layout.get("icon-rotate").evaluate(ri,{}),On=Yi.layout.get("icon-text-fit")!=="none",Ro=Eh(ir,qr,yr,On),Bo=mr?Eh(mr,qr,yr,On):void 0;ea=new Zl(lr,$t,gr,kr,Or,ir,Vr,Ur,!1,qr),Nr=4*Ro.length;const Kh=Dt.iconSizeData;let is=null;Kh.kind==="source"?(is=[$n*Yi.layout.get("icon-size").evaluate(ri,{})],is[0]>Ea&&_e(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Kh.kind==="composite"&&(is=[$n*Hr.compositeIconSizes[0].evaluate(ri,{},Er),$n*Hr.compositeIconSizes[1].evaluate(ri,{},Er)],(is[0]>Ea||is[1]>Ea)&&_e(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,Ro,is,cr,qi,ri,a.WritingMode.none,$t,kn.lineStartIndex,kn.lineLength,-1,Er),su=Dt.icon.placedSymbolArray.length-1,Bo&&(ta=4*Bo.length,Dt.addSymbols(Dt.icon,Bo,is,cr,qi,ri,a.WritingMode.vertical,$t,kn.lineStartIndex,kn.lineLength,-1,Er),ou=Dt.icon.placedSymbolArray.length-1)}const Wh=Object.keys(Ni.horizontal);for(const qr of Wh){const On=Ni.horizontal[qr];if(!In){Xh=or.exports(On.text);const Bo=Yi.layout.get("text-rotate").evaluate(ri,{},Er);In=new Zl(lr,$t,gr,kr,Or,On,Qi,_r,Ir,Bo)}const Ro=On.positionedLines.length===1;if(Lo+=Ah(Dt,$t,On,nn,Yi,Ir,ri,zr,kn,Ni.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,Ro?Wh:[qr],ia,su,Hr,Er),Ro)break}Ni.vertical&&(Zh+=Ah(Dt,$t,Ni.vertical,nn,Yi,Ir,ri,zr,kn,a.WritingMode.vertical,["vertical"],ia,ou,Hr,Er));const Tm=In?In.boxStartIndex:Dt.collisionBoxArray.length,Sm=In?In.boxEndIndex:Dt.collisionBoxArray.length,Am=pn?pn.boxStartIndex:Dt.collisionBoxArray.length,Dm=pn?pn.boxEndIndex:Dt.collisionBoxArray.length,Cm=ea?ea.boxStartIndex:Dt.collisionBoxArray.length,zm=ea?ea.boxEndIndex:Dt.collisionBoxArray.length,Mm=an?an.boxStartIndex:Dt.collisionBoxArray.length,Pm=an?an.boxEndIndex:Dt.collisionBoxArray.length;let En=-1;const Jl=(qr,On)=>qr&&qr.circleDiameter?Math.max(qr.circleDiameter,On):On;En=Jl(In,En),En=Jl(pn,En),En=Jl(ea,En),En=Jl(an,En);const Hh=En>-1?1:0;Hh&&(En*=fn/fr),Dt.glyphOffsetArray.length>=Ps.MAX_GLYPHS&&_e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ri.sortKey!==void 0&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,ri.sortKey),Dt.symbolInstances.emplaceBack($t.x,$t.y,ia.right>=0?ia.right:-1,ia.center>=0?ia.center:-1,ia.left>=0?ia.left:-1,ia.vertical||-1,su,ou,Xh,Tm,Sm,Am,Dm,Cm,zm,Mm,Pm,gr,Lo,Zh,Nr,ta,Hh,0,Qi,lu,cu,En)}(i,Rt,Qe,r,s,d,gt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ae,[Se,Se,Se,Se],wt,I,De,je,Et,Z,e,m,z,R,_)};if(mt==="line")for(const Qe of Ih(e.geometry,0,0,tr,tr)){const Rt=lm(Qe,xe,Ne,r.vertical||X,s,24,ke,i.overscaling,tr);for(const Dt of Rt){const $t=X;$t&&pm(i,$t.text,lt,Dt)||dt(Qe,Dt)}}else if(mt==="line-center"){for(const Qe of e.geometry)if(Qe.length>1){const Rt=om(Qe,Ne,r.vertical||X,s,24,ke);Rt&&dt(Qe,Rt)}}else if(e.type==="Polygon")for(const Qe of Fc(e.geometry,0)){const Rt=hm(Qe,16);dt(Qe[0],new Ia(Rt.x,Rt.y,0))}else if(e.type==="LineString")for(const Qe of e.geometry)dt(Qe,new Ia(Qe[0].x,Qe[0].y,0));else if(e.type==="Point")for(const Qe of e.geometry)for(const Rt of Qe)dt([Rt],new Ia(Rt.x,Rt.y,0))}const Ea=32640;function Ah(i,e,r,s,d,m,_,b,I,z,R,F,q,Z,X){const oe=function(De,xe,Se,je,Ne,wt,Et,mt){const lt=je.layout.get("text-rotate").evaluate(wt,{})*Math.PI/180,at=[];for(const gt of xe.positionedLines)for(const dt of gt.positionedGlyphs){if(!dt.rect)continue;const Qe=dt.rect||{};let Rt=4,Dt=!0,$t=1,Li=0;const Ni=(Ne||mt)&&dt.vertical,ir=dt.metrics.advance*dt.scale/2;if(mt&&xe.verticalizable){const qi=(dt.scale-1)*fr,cr=(fr-dt.metrics.width*dt.scale)/2;Li=gt.lineOffset/2-(dt.imageName?-cr:qi)}if(dt.imageName){const qi=Et[dt.imageName];Dt=qi.sdf,$t=qi.pixelRatio,Rt=1/$t}const nn=Ne?[dt.x+ir,dt.y]:[0,0];let mr=Ne?[0,0]:[dt.x+ir+Se[0],dt.y+Se[1]-Li],Yi=[0,0];Ni&&(Yi=mr,mr=[0,0]);const lr=(dt.metrics.left-Rt)*dt.scale-ir+mr[0],gr=(-dt.metrics.top-Rt)*dt.scale+mr[1],kr=lr+Qe.w*dt.scale/$t,Or=gr+Qe.h*dt.scale/$t,Qi=new Ue(lr,gr),_r=new Ue(kr,gr),Ir=new Ue(lr,Or),zr=new Ue(kr,Or);if(Ni){const qi=new Ue(-ir,ir-Vl),cr=-Math.PI/2,ri=12-ir,Hr=new Ue(22-ri,-(dt.imageName?ri:0)),yr=new Ue(...Yi);Qi._rotateAround(cr,qi)._add(Hr)._add(yr),_r._rotateAround(cr,qi)._add(Hr)._add(yr),Ir._rotateAround(cr,qi)._add(Hr)._add(yr),zr._rotateAround(cr,qi)._add(Hr)._add(yr)}if(lt){const qi=Math.sin(lt),cr=Math.cos(lt),ri=[cr,-qi,qi,cr];Qi._matMult(ri),_r._matMult(ri),Ir._matMult(ri),zr._matMult(ri)}const Vr=new Ue(0,0),Ur=new Ue(0,0);at.push({tl:Qi,tr:_r,bl:Ir,br:zr,tex:Qe,writingMode:xe.writingMode,glyphOffset:nn,sectionIndex:dt.sectionIndex,isSDF:Dt,pixelOffsetTL:Vr,pixelOffsetBR:Ur,minFontScaleX:0,minFontScaleY:0})}return at}(0,r,b,d,m,_,s,i.allowVerticalPlacement),ae=i.textSizeData;let ke=null;ae.kind==="source"?(ke=[$n*d.layout.get("text-size").evaluate(_,{})],ke[0]>Ea&&_e(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(ke=[$n*Z.compositeTextSizes[0].evaluate(_,{},X),$n*Z.compositeTextSizes[1].evaluate(_,{},X)],(ke[0]>Ea||ke[1]>Ea)&&_e(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,oe,ke,b,m,_,z,e,I.lineStartIndex,I.lineLength,q,X);for(const De of R)F[De]=i.text.placedSymbolArray.length-1;return 4*oe.length}function Dh(i){for(const e in i)return i[e];return null}function pm(i,e,r,s){const d=i.compareText;if(e in d){const m=d[e];for(let _=m.length-1;_>=0;_--)if(s.dist(m[_])<r)return!0}else d[e]=[];return d[e].push(s),!1}const mm=wa.VectorTileFeature.types,gm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xl(i,e,r,s,d,m,_,b,I,z,R,F,q){const Z=b?Math.min(Ea,Math.round(b[0])):0,X=b?Math.min(Ea,Math.round(b[1])):0;i.emplaceBack(e,r,Math.round(32*s),Math.round(32*d),m,_,(Z<<1)+(I?1:0),X,16*z,16*R,256*F,256*q)}function Yc(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function _m(i){for(const e of i.sections)if(bl(e.text))return!0;return!1}class Qc{constructor(e){this.layoutVertexArray=new hn,this.indexArray=new Ar,this.programConfigurations=e,this.segments=new ei,this.dynamicLayoutVertexArray=new en,this.opacityVertexArray=new dn,this.placedSymbolArray=new Je}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,d){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Up.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Np.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,gm,!0),this.opacityVertexBuffer.itemSize=1),(s||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}kt("SymbolBuffers",Qc);class $c{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new ei,this.collisionVertexArray=new Xr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}kt("CollisionBuffers",$c);class Ps{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zc([]),this.placementViewportMatrix=zc([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yh(this.zoom,r["text-size"]),this.iconSizeData=yh(this.zoom,r["icon-size"]);const s=this.layers[0].layout,d=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=tu(s,"text-overlap","text-allow-overlap")!=="never"||tu(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(_=>a.WritingMode[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new Qc(new Ya(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Qc(new Ya(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ot,this.lineVertexArray=new bt,this.symbolInstances=new yt}calculateGlyphDependencies(e,r,s,d,m){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,(s||d)&&m){const b=Co[e.charAt(_)];b&&(r[b.charCodeAt(0)]=!0)}}populate(e,r,s){const d=this.layers[0],m=d.layout,_=m.get("text-font"),b=m.get("text-field"),I=m.get("icon-image"),z=(b.value.kind!=="constant"||b.value.value instanceof fe&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),R=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,F=m.get("symbol-sort-key");if(this.features=[],!z&&!R)return;const q=r.iconDependencies,Z=r.glyphDependencies,X=r.availableImages,oe=new Vi(this.zoom);for(const{feature:ae,id:ke,index:De,sourceLayerIndex:xe}of e){const Se=d._featureFilter.needGeometry,je=$a(ae,Se);if(!d._featureFilter.filter(oe,je,s))continue;let Ne,wt;if(Se||(je.geometry=Qa(ae)),z){const mt=d.getValueAndResolveTokens("text-field",je,s,X),lt=fe.factory(mt);_m(lt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ha()==="unavailable"||this.hasRTLText&&Zr.isParsed())&&(Ne=jp(lt,d,je))}if(R){const mt=d.getValueAndResolveTokens("icon-image",je,s,X);wt=mt instanceof ye?mt:ye.fromString(mt)}if(!Ne&&!wt)continue;const Et=this.sortFeaturesByKey?F.evaluate(je,{},s):void 0;if(this.features.push({id:ke,text:Ne,icon:wt,index:De,sourceLayerIndex:xe,geometry:je.geometry,properties:ae.properties,type:mm[ae.type],sortKey:Et}),wt&&(q[wt.name]=!0),Ne){const mt=_.evaluate(je,{},s).join(","),lt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const at of Ne.sections)if(at.image)q[at.image.name]=!0;else{const gt=bs(Ne.toString()),dt=at.fontStack||mt,Qe=Z[dt]=Z[dt]||{};this.calculateGlyphDependencies(at.text,Qe,lt,this.allowVerticalPlacement,gt)}}}m.get("symbol-placement")==="line"&&(this.features=function(ae){const ke={},De={},xe=[];let Se=0;function je(mt){xe.push(ae[mt]),Se++}function Ne(mt,lt,at){const gt=De[mt];return delete De[mt],De[lt]=gt,xe[gt].geometry[0].pop(),xe[gt].geometry[0]=xe[gt].geometry[0].concat(at[0]),gt}function wt(mt,lt,at){const gt=ke[lt];return delete ke[lt],ke[mt]=gt,xe[gt].geometry[0].shift(),xe[gt].geometry[0]=at[0].concat(xe[gt].geometry[0]),gt}function Et(mt,lt,at){const gt=at?lt[0][lt[0].length-1]:lt[0][0];return`${mt}:${gt.x}:${gt.y}`}for(let mt=0;mt<ae.length;mt++){const lt=ae[mt],at=lt.geometry,gt=lt.text?lt.text.toString():null;if(!gt){je(mt);continue}const dt=Et(gt,at),Qe=Et(gt,at,!0);if(dt in De&&Qe in ke&&De[dt]!==ke[Qe]){const Rt=wt(dt,Qe,at),Dt=Ne(dt,Qe,xe[Rt].geometry);delete ke[dt],delete De[Qe],De[Et(gt,xe[Dt].geometry,!0)]=Dt,xe[Rt].geometry=null}else dt in De?Ne(dt,Qe,at):Qe in ke?wt(dt,Qe,at):(je(mt),ke[dt]=Se-1,De[Qe]=Se-1)}return xe.filter(mt=>mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,ke)=>ae.sortKey-ke.sortKey)}update(e,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(r[e.segment+1]),m=e.dist(r[e.segment]);const _={};for(let b=e.segment+1;b<r.length;b++)_[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:d},b<r.length-1&&(d+=r[b+1].dist(r[b]));for(let b=e.segment||0;b>=0;b--)_[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){const I=_[b];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,d,m,_,b,I,z,R,F,q){const Z=e.indexArray,X=e.layoutVertexArray,oe=e.segments.prepareSegment(4*r.length,X,Z,this.canOverlap?_.sortKey:void 0),ae=this.glyphOffsetArray.length,ke=oe.vertexLength,De=this.allowVerticalPlacement&&b===a.WritingMode.vertical?Math.PI/2:0,xe=_.text&&_.text.sections;for(let Se=0;Se<r.length;Se++){const{tl:je,tr:Ne,bl:wt,br:Et,tex:mt,pixelOffsetTL:lt,pixelOffsetBR:at,minFontScaleX:gt,minFontScaleY:dt,glyphOffset:Qe,isSDF:Rt,sectionIndex:Dt}=r[Se],$t=oe.vertexLength,Li=Qe[1];Xl(X,I.x,I.y,je.x,Li+je.y,mt.x,mt.y,s,Rt,lt.x,lt.y,gt,dt),Xl(X,I.x,I.y,Ne.x,Li+Ne.y,mt.x+mt.w,mt.y,s,Rt,at.x,lt.y,gt,dt),Xl(X,I.x,I.y,wt.x,Li+wt.y,mt.x,mt.y+mt.h,s,Rt,lt.x,at.y,gt,dt),Xl(X,I.x,I.y,Et.x,Li+Et.y,mt.x+mt.w,mt.y+mt.h,s,Rt,at.x,at.y,gt,dt),Yc(e.dynamicLayoutVertexArray,I,De),Z.emplaceBack($t,$t+1,$t+2),Z.emplaceBack($t+1,$t+2,$t+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),Se!==r.length-1&&Dt===r[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,_,_.index,{},q,xe&&xe[Dt])}e.placedSymbolArray.emplaceBack(I.x,I.y,ae,this.glyphOffsetArray.length-ae,ke,z,R,I.segment,s?s[0]:0,s?s[1]:0,d[0],d[1],b,0,!1,0,F)}_addCollisionDebugVertex(e,r,s,d,m,_){return r.emplaceBack(0,0),e.emplaceBack(s.x,s.y,d,m,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(e,r,s,d,m,_,b){const I=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),z=I.vertexLength,R=m.layoutVertexArray,F=m.collisionVertexArray,q=b.anchorX,Z=b.anchorY;this._addCollisionDebugVertex(R,F,_,q,Z,new Ue(e,r)),this._addCollisionDebugVertex(R,F,_,q,Z,new Ue(s,r)),this._addCollisionDebugVertex(R,F,_,q,Z,new Ue(s,d)),this._addCollisionDebugVertex(R,F,_,q,Z,new Ue(e,d)),I.vertexLength+=4;const X=m.indexArray;X.emplaceBack(z,z+1),X.emplaceBack(z+1,z+2),X.emplaceBack(z+2,z+3),X.emplaceBack(z+3,z),I.primitiveLength+=4}addDebugCollisionBoxes(e,r,s,d){for(let m=e;m<r;m++){const _=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,d?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $c(Bn,nh.members,bn),this.iconCollisionBox=new $c(Bn,nh.members,bn);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,s,d,m,_,b,I,z){const R={};for(let F=r;F<s;F++){const q=e.get(F);R.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},R.textFeatureIndex=q.featureIndex;break}for(let F=d;F<m;F++){const q=e.get(F);R.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},R.verticalTextFeatureIndex=q.featureIndex;break}for(let F=_;F<b;F++){const q=e.get(F);R.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},R.iconFeatureIndex=q.featureIndex;break}for(let F=I;F<z;F++){const q=e.get(F);R.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},R.verticalIconFeatureIndex=q.featureIndex;break}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),d=s.vertexStartIndex+4*s.numGlyphs;for(let m=s.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),d=[],m=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const I=this.symbolInstances.get(b);d.push(0|Math.round(r*I.anchorX+s*I.anchorY)),m.push(I.featureIndex)}return _.sort((b,I)=>d[b]-d[I]||m[I]-m[b]),_}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((d,m,_)=>{d>=0&&_.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}kt("SymbolBucket",Ps,{omit:["layers","collisionBoxArray","features","compareText"]}),Ps.MAX_GLYPHS=65535,Ps.addDynamicAttributes=Yc;const ym=new dr({"symbol-placement":new At(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new At(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new At(Fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new At(Fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new At(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(Fe.layout_symbol["icon-size"]),"icon-text-fit":new At(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(Fe.layout_symbol["icon-image"]),"icon-rotate":new Ot(Fe.layout_symbol["icon-rotate"]),"icon-padding":new Ot(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new At(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Ot(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(Fe.layout_symbol["text-field"]),"text-font":new Ot(Fe.layout_symbol["text-font"]),"text-size":new Ot(Fe.layout_symbol["text-size"]),"text-max-width":new Ot(Fe.layout_symbol["text-max-width"]),"text-line-height":new At(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Ot(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Ot(Fe.layout_symbol["text-anchor"]),"text-max-angle":new At(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new At(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(Fe.layout_symbol["text-rotate"]),"text-padding":new At(Fe.layout_symbol["text-padding"]),"text-keep-upright":new At(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Ot(Fe.layout_symbol["text-transform"]),"text-offset":new Ot(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new At(Fe.layout_symbol["text-allow-overlap"]),"text-overlap":new At(Fe.layout_symbol["text-overlap"]),"text-ignore-placement":new At(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new At(Fe.layout_symbol["text-optional"])});var eu={paint:new dr({"icon-opacity":new Ot(Fe.paint_symbol["icon-opacity"]),"icon-color":new Ot(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Ot(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new At(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ot(Fe.paint_symbol["text-opacity"]),"text-color":new Ot(Fe.paint_symbol["text-color"],{runtimeType:hr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ot(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(Fe.paint_symbol["text-halo-blur"]),"text-translate":new At(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new At(Fe.paint_symbol["text-translate-anchor"])}),layout:ym};class Ch{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:An,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kt("FormatSectionOverride",Ch,{omit:["defaultValue"]});class Wl extends un{constructor(e){super(e,eu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const d=[];for(const m of s)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,d){const m=this.layout.get(e).evaluate(r,{},s,d),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Ra(_.value)||!m?m:function(b,I){return I.replace(/{([^{}]+)}/g,(z,R)=>R in b?String(b[R]):"")}(r.properties,m)}createBucket(e){return new Ps(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of eu.paint.overridableProperties){if(!Wl.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Ch(r),d=new ms(s,r.property.specification);let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new Fa("source",d):new ro("composite",d,r.value.zoomStops),this.paint._values[e]=new cn(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Wl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),d=eu.paint.properties[r];let m=!1;const _=b=>{for(const I of b)if(d.overrides&&d.overrides.hasOverride(I))return void(m=!0)};if(s.value.kind==="constant"&&s.value.value instanceof fe)_(s.value.value.sections);else if(s.value.kind==="source"){const b=z=>{m||(z instanceof St&&ze(z.value)===rr?_(z.value.sections):z instanceof fs?_(z.sections):z.eachChild(b))},I=s.value;I._styleExpression&&b(I._styleExpression.expression)}return m}}function tu(i,e,r){let s="never";const d=i.get(e);return d?s=d:i.get(r)&&(s="always"),s}var vm={paint:new dr({"background-color":new At(Fe.paint_background["background-color"]),"background-pattern":new go(Fe.paint_background["background-pattern"]),"background-opacity":new At(Fe.paint_background["background-opacity"])})},xm={paint:new dr({"raster-opacity":new At(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new At(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new At(Fe.paint_raster["raster-saturation"]),"raster-contrast":new At(Fe.paint_raster["raster-contrast"]),"raster-resampling":new At(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new At(Fe.paint_raster["raster-fade-duration"])})};class bm extends un{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const wm={circle:class extends un{constructor(i){super(i,$f)}createBucket(i){return new Ac(i)}queryRadius(i){const e=i;return bo("circle-radius",this,e)+bo("circle-stroke-width",this,e)+Cl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,s,d,m,_,b){const I=zl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,_),z=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),R=this.paint.get("circle-pitch-alignment")==="map",F=R?I:function(Z,X){return Z.map(oe=>Nu(oe,X))}(I,b),q=R?z*_:z;for(const Z of s)for(const X of Z){const oe=R?X:Nu(X,b);let ae=q;const ke=Ml([],[X.x,X.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ae*=ke[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ae*=m.cameraToCenterDistance/ke[3]),Hf(F,oe,ae))return!0}return!1}},heatmap:class extends un{constructor(i){super(i,tp),this._updateColorRamp()}createBucket(i){return new qu(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ju({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends un{constructor(i){super(i,ip)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends un{constructor(i){super(i,yp)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Uc(i)}queryRadius(){return Cl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,s,d,m,_){return Pu(zl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,_),s)}isTileClipped(){return!0}},"fill-extrusion":class extends un{constructor(i){super(i,Mp)}createBucket(i){return new qc(i)}queryRadius(){return Cl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,s,d,m,_,b){const I=zl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,_),z=this.paint.get("fill-extrusion-height").evaluate(e,r),R=this.paint.get("fill-extrusion-base").evaluate(e,r),F=function(Z,X,oe,ae){const ke=[];for(const De of Z){const xe=[De.x,De.y,0,1];Ml(xe,xe,X),ke.push(new Ue(xe[0]/xe[3],xe[1]/xe[3]))}return ke}(I,b),q=function(Z,X,oe,ae){const ke=[],De=[],xe=ae[8]*X,Se=ae[9]*X,je=ae[10]*X,Ne=ae[11]*X,wt=ae[8]*oe,Et=ae[9]*oe,mt=ae[10]*oe,lt=ae[11]*oe;for(const at of Z){const gt=[],dt=[];for(const Qe of at){const Rt=Qe.x,Dt=Qe.y,$t=ae[0]*Rt+ae[4]*Dt+ae[12],Li=ae[1]*Rt+ae[5]*Dt+ae[13],Ni=ae[2]*Rt+ae[6]*Dt+ae[14],ir=ae[3]*Rt+ae[7]*Dt+ae[15],nn=Ni+je,mr=ir+Ne,Yi=$t+wt,lr=Li+Et,gr=Ni+mt,kr=ir+lt,Or=new Ue(($t+xe)/mr,(Li+Se)/mr);Or.z=nn/mr,gt.push(Or);const Qi=new Ue(Yi/kr,lr/kr);Qi.z=gr/kr,dt.push(Qi)}ke.push(gt),De.push(dt)}return[ke,De]}(s,R,z,b);return function(Z,X,oe){let ae=1/0;Pu(oe,X)&&(ae=$u(oe,X[0]));for(let ke=0;ke<X.length;ke++){const De=X[ke],xe=Z[ke];for(let Se=0;Se<De.length-1;Se++){const je=De[Se],Ne=[je,De[Se+1],xe[Se+1],xe[Se],je];Mu(oe,Ne)&&(ae=Math.min(ae,$u(oe,Ne)))}}return ae!==1/0&&ae}(q[0],q[1],F)}},line:class extends un{constructor(i){super(i,th),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ca,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=ih.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Gc(i)}queryRadius(i){const e=i,r=rh(bo("line-width",this,e),bo("line-gap-width",this,e)),s=bo("line-offset",this,e);return r/2+Math.abs(s)+Cl(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,s,d,m,_){const b=zl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,_),I=_/2*rh(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),z=this.paint.get("line-offset").evaluate(e,r);return z&&(s=function(R,F){const q=[];for(let Z=0;Z<R.length;Z++){const X=R[Z],oe=[];for(let ae=0;ae<X.length;ae++){const ke=X[ae-1],De=X[ae],xe=X[ae+1],Se=ae===0?new Ue(0,0):De.sub(ke)._unit()._perp(),je=ae===X.length-1?new Ue(0,0):xe.sub(De)._unit()._perp(),Ne=Se._add(je)._unit(),wt=Ne.x*je.x+Ne.y*je.y;wt!==0&&Ne._mult(1/wt),oe.push(Ne._mult(F)._add(De))}q.push(oe)}return q}(s,z*_)),function(R,F,q){for(let Z=0;Z<F.length;Z++){const X=F[Z];if(R.length>=3){for(let oe=0;oe<X.length;oe++)if(Ts(R,X[oe]))return!0}if(Kf(R,X,q))return!0}return!1}(b,s,I)}isTileClipped(){return!0}},symbol:Wl,background:class extends un{constructor(i){super(i,vm)}},raster:class extends un{constructor(i){super(i,xm)}}};class km{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const zh=63710088e-1;class Zi{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zi(N(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,d=e.lat*r,m=Math.sin(s)*Math.sin(d)+Math.cos(s)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return zh*Math.acos(Math.min(m,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new ts(new Zi(this.lng-s,this.lat-r),new Zi(this.lng+s,this.lat+r))}static convert(e){if(e instanceof Zi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Zi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Zi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ts{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Zi?new Zi(e.lng,e.lat):Zi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Zi?new Zi(e.lng,e.lat):Zi.convert(e),this}extend(e){const r=this._sw,s=this._ne;let d,m;if(e instanceof Zi)d=e,m=e;else{if(!(e instanceof ts))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ts.convert(e)):this.extend(Zi.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return r||s?(r.lng=Math.min(d.lng,r.lng),r.lat=Math.min(d.lat,r.lat),s.lng=Math.max(m.lng,s.lng),s.lat=Math.max(m.lat,s.lat)):(this._sw=new Zi(d.lng,d.lat),this._ne=new Zi(m.lng,m.lat)),this}getCenter(){return new Zi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Zi(this.getWest(),this.getNorth())}getSouthEast(){return new Zi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Zi.convert(e);let d=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&d}static convert(e){return e instanceof ts?e:e&&new ts(e)}}const Mh=2*Math.PI*zh;function Ph(i){return Mh*Math.cos(i*Math.PI/180)}function Lh(i){return(180+i)/360}function Rh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Bh(i,e){return i/Ph(e)}function iu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Hl{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Zi.convert(e);return new Hl(Lh(s.lng),Rh(s.lat),Bh(r,s.lat))}toLngLat(){return new Zi(360*this.x-180,iu(this.y))}toAltitude(){return this.z*Ph(iu(this.y))}meterInMercatorCoordinateUnits(){return 1/Mh*(e=iu(this.y),1/Math.cos(e*Math.PI/180));var e}}function Fh(i,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class ru{constructor(e,r,s){if(e<0||e>25||s<0||s>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${s}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=s,this.key=Mo(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,s){const d=(_=this.y,b=this.z,I=Fh(256*(m=this.x),256*(_=Math.pow(2,b)-_-1),b),z=Fh(256*(m+1),256*(_+1),b),I[0]+","+I[1]+","+z[0]+","+z[1]);var m,_,b,I,z;const R=function(F,q,Z){let X,oe="";for(let ae=F;ae>0;ae--)X=1<<ae-1,oe+=(q&X?1:0)+(Z&X?2:0);return oe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Ue((e.x*r-this.x)*tr,(e.y*r-this.y)*tr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Mo(e,r.z,r.z,r.x,r.y)}}class rn{constructor(e,r,s,d,m){if(e<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${s}`);this.overscaledZ=e,this.wrap=r,this.canonical=new ru(s,+d,+m),this.key=Mo(r,e,s,d,m)}clone(){return new rn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new rn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-e;return e>this.canonical.z?Mo(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Mo(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,d=2*this.canonical.y;return[new rn(r,this.wrap,r,s,d),new rn(r,this.wrap,r,s+1,d),new rn(r,this.wrap,r,s,d+1),new rn(r,this.wrap,r,s+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Hl(e.x-this.wrap,e.y))}}function Mo(i,e,r,s,d){(i*=2)<0&&(i=-1*i-1);const m=1<<r;return(m*m*i+m*d+s).toString(36)+r.toString(36)+e.toString(36)}kt("CanonicalTileID",ru),kt("OverscaledTileID",rn,{omit:["posMatrix"]});class Vh{constructor(e,r,s){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void _e(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const d=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox";for(let m=0;m<d;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(d,m)]=this.data[this._idx(d-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,d)]=this.data[this._idx(m,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let m=0;m<d;m++)for(let _=0;_<d;_++){const b=this.get(m,_);b>this.max&&(this.max=b),b<this.min&&(this.min=b)}}get(e,r){const s=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[d],s[d+1],s[d+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}getPixels(){return new tn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,m=r*this.dim+this.dim,_=s*this.dim,b=s*this.dim+this.dim;switch(r){case-1:d=m-1;break;case 1:m=d+1}switch(s){case-1:_=b-1;break;case 1:b=_+1}const I=-r*this.dim,z=-s*this.dim;for(let R=_;R<b;R++)for(let F=d;F<m;F++)this.data[this._idx(F,R)]=e.data[this._idx(F+I,R+z)]}}kt("DEMData",Vh);class Uh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Nh{constructor(e,r,s,d,m){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=d,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class qh{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Wa(tr,16,0),this.grid3D=new Wa(tr,16,0),this.featureIndexArray=new Qt,this.promoteId=r}insert(e,r,s,d,m,_){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,d,m);const I=_?this.grid3D:this.grid;for(let z=0;z<r.length;z++){const R=r[z],F=[1/0,1/0,-1/0,-1/0];for(let q=0;q<R.length;q++){const Z=R[q];F[0]=Math.min(F[0],Z.x),F[1]=Math.min(F[1],Z.y),F[2]=Math.max(F[2],Z.x),F[3]=Math.max(F[3],Z.y)}F[0]<tr&&F[1]<tr&&F[2]>=0&&F[3]>=0&&I.insert(b,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wa.VectorTile(new jc(this.rawTileData)).layers,this.sourceLayerCoder=new Uh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,s,d){this.loadVTLayers();const m=e.params||{},_=tr/e.tileSize/e.scale,b=ys(m.filter),I=e.queryGeometry,z=e.queryPadding*_,R=jh(I),F=this.grid.query(R.minX-z,R.minY-z,R.maxX+z,R.maxY+z),q=jh(e.cameraQueryGeometry),Z=this.grid3D.query(q.minX-z,q.minY-z,q.maxX+z,q.maxY+z,(ae,ke,De,xe)=>function(Se,je,Ne,wt,Et){for(const lt of Se)if(je<=lt.x&&Ne<=lt.y&&wt>=lt.x&&Et>=lt.y)return!0;const mt=[new Ue(je,Ne),new Ue(je,Et),new Ue(wt,Et),new Ue(wt,Ne)];if(Se.length>2){for(const lt of mt)if(Ts(Se,lt))return!0}for(let lt=0;lt<Se.length-1;lt++)if(Yf(Se[lt],Se[lt+1],mt))return!0;return!1}(e.cameraQueryGeometry,ae-z,ke-z,De+z,xe+z));for(const ae of Z)F.push(ae);F.sort(Im);const X={};let oe;for(let ae=0;ae<F.length;ae++){const ke=F[ae];if(ke===oe)continue;oe=ke;const De=this.featureIndexArray.get(ke);let xe=null;this.loadMatchingFeature(X,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,b,m.layers,m.availableImages,r,s,d,(Se,je,Ne)=>(xe||(xe=Qa(Se)),je.queryIntersectsFeature(I,Se,Ne,xe,this.z,e.transform,_,e.pixelPosMatrix)))}return X}loadMatchingFeature(e,r,s,d,m,_,b,I,z,R,F){const q=this.bucketLayerIDs[r];if(_&&!function(ae,ke){for(let De=0;De<ae.length;De++)if(ke.indexOf(ae[De])>=0)return!0;return!1}(_,q))return;const Z=this.sourceLayerCoder.decode(s),X=this.vtLayers[Z].feature(d);if(m.needGeometry){const ae=$a(X,!0);if(!m.filter(new Vi(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!m.filter(new Vi(this.tileID.overscaledZ),X))return;const oe=this.getId(X,Z);for(let ae=0;ae<q.length;ae++){const ke=q[ae];if(_&&_.indexOf(ke)<0)continue;const De=I[ke];if(!De)continue;let xe={};oe&&R&&(xe=R.getState(De.sourceLayer||"_geojsonTileLayer",oe));const Se=O({},z[ke]);Se.paint=Gh(Se.paint,De.paint,X,xe,b),Se.layout=Gh(Se.layout,De.layout,X,xe,b);const je=!F||F(X,De,xe);if(!je)continue;const Ne=new Nh(X,this.z,this.x,this.y,oe);Ne.layer=Se;let wt=e[ke];wt===void 0&&(wt=e[ke]=[]),wt.push({featureIndex:d,feature:Ne,intersectionZ:je})}}lookupSymbolFeatures(e,r,s,d,m,_,b,I){const z={};this.loadVTLayers();const R=ys(m);for(const F of e)this.loadMatchingFeature(z,s,d,F,R,_,b,I,r);return z}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function Gh(i,e,r,s,d){return te(i,(m,_)=>{const b=e instanceof Ja?e.get(_):null;return b&&b.evaluate?b.evaluate(r,s,d):b})}function jh(i){let e=1/0,r=1/0,s=-1/0,d=-1/0;for(const m of i)e=Math.min(e,m.x),r=Math.min(r,m.y),s=Math.max(s,m.x),d=Math.max(d,m.y);return{minX:e,minY:r,maxX:s,maxY:d}}function Im(i,e){return e-i}var nu;kt("FeatureIndex",qh,{omit:["rawTileData","sourceLayerCoder"]}),a.PerformanceMarkers=void 0,(nu=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",nu.load="load",nu.fullLoad="fullLoad";let Kl=null,Po=[];const au=1e3/30,Em={mark(i){performance.mark(i)},frame(i){const e=i;Kl!=null&&Po.push(e-Kl),Kl=e},clearMetrics(){Kl=null,Po=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Po.length,s=1/(Po.reduce((m,_)=>m+_,0)/r/1e3),d=Po.filter(m=>m>au).reduce((m,_)=>m+(_-au)/au,0);return{loadTime:i,fullLoadTime:e,fps:s,percentDroppedFrames:d/(r+d)*100}}};a.AJAXError=Ri,a.ARRAY_TYPE=Cr,a.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Q(["receive","process"],this),this.invoker=new km(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Le()?i:window}send(i,e,r,s,d=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[m]=r);const _=rt(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:i,hasCallback:!!r,targetMapId:s,mustQueue:d,sourceMapId:this.mapId,data:Xn(e,_)},_),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s()}else Le()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(zn(e.error)):r(null,zn(e.data)))}else{let r=!1;const s=rt(this.globalScope)?void 0:[],d=e.hasCallback?(b,I)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:b?Xn(b):null,data:Xn(I,s)},s)}:b=>{r=!0};let m=null;const _=zn(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,_,d);else if(this.parent.getWorkerSource){const b=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,b[0],_.source)[b[1]](_,d)}else d(new Error(`Could not find function ${e.type}`));!r&&m&&m.cancel&&(this.cancelCallbacks[i]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=ko,a.CanonicalTileID=ru,a.CollisionBoxArray=Re,a.CollisionCircleLayoutArray=class extends B{},a.Color=K,a.DEMData=Vh,a.DataConstantProperty=At,a.DictionaryCoder=Uh,a.EXTENT=tr,a.ErrorEvent=na,a.EvaluationParameters=Vi,a.Event=gn,a.Evented=_n,a.FeatureIndex=qh,a.FillBucket=Uc,a.FillExtrusionBucket=qc,a.GeoJSONFeature=Nh,a.ImageAtlas=dh,a.ImagePosition=Xc,a.LineBucket=Gc,a.LineStripIndexArray=class extends ne{},a.LngLat=Zi,a.LngLatBounds=ts,a.MercatorCoordinate=Hl,a.ONE_EM=fr,a.OverscaledTileID=rn,a.PerformanceUtils=Em,a.PosArray=Lt,a.Properties=dr,a.QuadTriangleArray=class extends j{},a.RGBAImage=tn,a.RasterBoundsArray=class extends u{},a.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},a.ResourceType=ii,a.SegmentVector=ei,a.SymbolBucket=Ps,a.Transitionable=Il,a.TriangleIndexArray=Ar,a.Uniform1f=Jn,a.Uniform1i=class extends Kn{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends Kn{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends Kn{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=Is,a.UniformColor=Au,a.UniformMatrix4f=class extends Kn{constructor(i,e){super(i,e),this.current=Xf}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=Oh,a.ValidationError=ht,a.ZoomHistory=oo,a.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},a.addDynamicAttributes=Yc,a.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let s=i.length;const d=new Array(i.length);let m=null;i.forEach((_,b)=>{e(_,(I,z)=>{I&&(m=I),d[b]=z,--s==0&&r(m,d)})})},a.bezier=D,a.bindAll=Q,a.cacheEntryPossiblyAdded=function(i){Ct++,Ct>Ke&&(i.getActor().send("enforceCacheSizeLimit",zt),Ct=0)},a.clamp=A,a.clearTileCache=function(i){const e=caches.delete(tt);i&&e.catch(i).then(()=>i())},a.clipLine=Ih,a.clone=function(i){var e=new Cr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$1=he,a.clone$2=function(i){var e=new Cr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},a.collisionCircleLayout=Gp,a.config=et,a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.create=function(){var i=new Cr(16);return Cr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=Bu,a.createExpression=Ba,a.createFilter=ys,a.createLayout=Ji,a.createStyleLayer=function(i){return i.type==="custom"?new bm(i):new wm[i.type](i)},a.cross=function(i,e,r){var s=e[0],d=e[1],m=e[2],_=r[0],b=r[1],I=r[2];return i[0]=d*I-m*b,i[1]=m*_-s*I,i[2]=s*b-d*_,i},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},a.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=M,a.emitValidationErrors=xs,a.enforceCacheSizeLimit=function(i){Tt(),ft&&ft.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-i;s++)e.delete(r[s])})})},a.equals=function(i,e){var r=i[0],s=i[1],d=i[2],m=i[3],_=i[4],b=i[5],I=i[6],z=i[7],R=i[8],F=i[9],q=i[10],Z=i[11],X=i[12],oe=i[13],ae=i[14],ke=i[15],De=e[0],xe=e[1],Se=e[2],je=e[3],Ne=e[4],wt=e[5],Et=e[6],mt=e[7],lt=e[8],at=e[9],gt=e[10],dt=e[11],Qe=e[12],Rt=e[13],Dt=e[14],$t=e[15];return Math.abs(r-De)<=Dr*Math.max(1,Math.abs(r),Math.abs(De))&&Math.abs(s-xe)<=Dr*Math.max(1,Math.abs(s),Math.abs(xe))&&Math.abs(d-Se)<=Dr*Math.max(1,Math.abs(d),Math.abs(Se))&&Math.abs(m-je)<=Dr*Math.max(1,Math.abs(m),Math.abs(je))&&Math.abs(_-Ne)<=Dr*Math.max(1,Math.abs(_),Math.abs(Ne))&&Math.abs(b-wt)<=Dr*Math.max(1,Math.abs(b),Math.abs(wt))&&Math.abs(I-Et)<=Dr*Math.max(1,Math.abs(I),Math.abs(Et))&&Math.abs(z-mt)<=Dr*Math.max(1,Math.abs(z),Math.abs(mt))&&Math.abs(R-lt)<=Dr*Math.max(1,Math.abs(R),Math.abs(lt))&&Math.abs(F-at)<=Dr*Math.max(1,Math.abs(F),Math.abs(at))&&Math.abs(q-gt)<=Dr*Math.max(1,Math.abs(q),Math.abs(gt))&&Math.abs(Z-dt)<=Dr*Math.max(1,Math.abs(Z),Math.abs(dt))&&Math.abs(X-Qe)<=Dr*Math.max(1,Math.abs(X),Math.abs(Qe))&&Math.abs(oe-Rt)<=Dr*Math.max(1,Math.abs(oe),Math.abs(Rt))&&Math.abs(ae-Dt)<=Dr*Math.max(1,Math.abs(ae),Math.abs(Dt))&&Math.abs(ke-$t)<=Dr*Math.max(1,Math.abs(ke),Math.abs($t))},a.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:d}){return i.kind==="source"?s/$n:i.kind==="composite"?Fi(s/$n,d/$n,r):e},a.evaluateSizeForZoom=function(i,e){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:_}=i,b=d?A(Rr.interpolationFactor(d,e,m,_),0,1):0;i.kind==="camera"?s=Fi(i.minSize,i.maxSize,b):r=b}return{uSizeT:r,uSize:s}},a.evaluateVariableOffset=Sh,a.evented=mo,a.exported=Ve,a.exported$1=ti,a.extend=O,a.filterObject=le,a.fromRotation=function(i,e){var r=Math.sin(e),s=Math.cos(e);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.getAnchorAlignment=Hc,a.getAnchorJustification=Jc,a.getArrayBuffer=Jr,a.getImage=Mr,a.getJSON=function(i,e){return Kr(O(i,{type:"json"}),e)},a.getOverlapMode=tu,a.getRTLTextPluginStatus=Ha,a.getReferrer=br,a.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<i.length;s++){const d=window.document.createElement("source");Yr(i[s])||(r.crossOrigin="Anonymous"),d.src=i[s],r.appendChild(d)}return{cancel:()=>{}}},a.identity=zc,a.invert=function(i,e){var r=e[0],s=e[1],d=e[2],m=e[3],_=e[4],b=e[5],I=e[6],z=e[7],R=e[8],F=e[9],q=e[10],Z=e[11],X=e[12],oe=e[13],ae=e[14],ke=e[15],De=r*b-s*_,xe=r*I-d*_,Se=r*z-m*_,je=s*I-d*b,Ne=s*z-m*b,wt=d*z-m*I,Et=R*oe-F*X,mt=R*ae-q*X,lt=R*ke-Z*X,at=F*ae-q*oe,gt=F*ke-Z*oe,dt=q*ke-Z*ae,Qe=De*dt-xe*gt+Se*at+je*lt-Ne*mt+wt*Et;return Qe?(i[0]=(b*dt-I*gt+z*at)*(Qe=1/Qe),i[1]=(d*gt-s*dt-m*at)*Qe,i[2]=(oe*wt-ae*Ne+ke*je)*Qe,i[3]=(q*Ne-F*wt-Z*je)*Qe,i[4]=(I*lt-_*dt-z*mt)*Qe,i[5]=(r*dt-d*lt+m*mt)*Qe,i[6]=(ae*Se-X*wt-ke*xe)*Qe,i[7]=(R*wt-q*Se+Z*xe)*Qe,i[8]=(_*gt-b*lt+z*Et)*Qe,i[9]=(s*lt-r*gt-m*Et)*Qe,i[10]=(X*Ne-oe*Se+ke*De)*Qe,i[11]=(F*Se-R*Ne-Z*De)*Qe,i[12]=(b*mt-_*at-I*Et)*Qe,i[13]=(r*at-s*mt+d*Et)*Qe,i[14]=(oe*xe-X*je-ae*De)*Qe,i[15]=(R*je-F*xe+q*De)*Qe,i):null},a.isImageBitmap=nt,a.isSafari=rt,a.isWorker=Le,a.keysDifference=function(i,e){const r=[];for(const s in i)s in e||r.push(s);return r},a.lazyLoadRTLTextPlugin=function(){Zr.isLoading()||Zr.isLoaded()||Ha()!=="deferred"||kl()},a.makeRequest=Kr,a.mapObject=te,a.mercatorXfromLng=Lh,a.mercatorYfromLat=Rh,a.mercatorZfromAltitude=Bh,a.mul=ep,a.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},a.multiply=Fu,a.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},a.normalize=function(i,e){var r=e[0],s=e[1],d=e[2],m=r*r+s*s+d*d;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i},a.number=Fi,a.ortho=function(i,e,r,s,d,m,_){var b=1/(e-r),I=1/(s-d),z=1/(m-_);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*I,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*z,i[11]=0,i[12]=(e+r)*b,i[13]=(d+s)*I,i[14]=(_+m)*z,i[15]=1,i},a.parseCacheControl=de,a.parseGlyphPbf=function(i){return new jc(i).readFields(em,[])},a.pbf=jc,a.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=tr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,s={layoutIconSize:r["icon-size"].possiblyEvaluate(new Vi(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Vi(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Vi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:z}=i.bucket.textSizeData;s.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Vi(I),i.canonical),r["text-size"].possiblyEvaluate(new Vi(z),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:z}=i.bucket.iconSizeData;s.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Vi(I),i.canonical),r["icon-size"].possiblyEvaluate(new Vi(z),i.canonical)]}const d=e.get("text-line-height")*fr,m=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",_=e.get("text-keep-upright"),b=e.get("text-size");for(const I of i.bucket.features){const z=e.get("text-font").evaluate(I,{},i.canonical).join(","),R=b.evaluate(I,{},i.canonical),F=s.layoutTextSize.evaluate(I,{},i.canonical),q=s.layoutIconSize.evaluate(I,{},i.canonical),Z={horizontal:{},vertical:void 0},X=I.text;let oe,ae=[0,0];if(X){const xe=X.toString(),Se=e.get("text-letter-spacing").evaluate(I,{},i.canonical)*fr,je=kc(xe)?Se:0,Ne=e.get("text-anchor").evaluate(I,{},i.canonical),wt=e.get("text-variable-anchor");if(!wt){const gt=e.get("text-radial-offset").evaluate(I,{},i.canonical);ae=gt?Sh(Ne,[gt*fr,Kc]):e.get("text-offset").evaluate(I,{},i.canonical).map(dt=>dt*fr)}let Et=m?"center":e.get("text-justify").evaluate(I,{},i.canonical);const mt=e.get("symbol-placement"),lt=mt==="point"?e.get("text-max-width").evaluate(I,{},i.canonical)*fr:0,at=()=>{i.bucket.allowVerticalPlacement&&bs(xe)&&(Z.vertical=Ul(X,i.glyphMap,i.glyphPositions,i.imagePositions,z,lt,d,Ne,"left",je,ae,a.WritingMode.vertical,!0,mt,F,R))};if(!m&&wt){const gt=Et==="auto"?wt.map(Qe=>Jc(Qe)):[Et];let dt=!1;for(let Qe=0;Qe<gt.length;Qe++){const Rt=gt[Qe];if(!Z.horizontal[Rt])if(dt)Z.horizontal[Rt]=Z.horizontal[0];else{const Dt=Ul(X,i.glyphMap,i.glyphPositions,i.imagePositions,z,lt,d,"center",Rt,je,ae,a.WritingMode.horizontal,!1,mt,F,R);Dt&&(Z.horizontal[Rt]=Dt,dt=Dt.positionedLines.length===1)}}at()}else{Et==="auto"&&(Et=Jc(Ne));const gt=Ul(X,i.glyphMap,i.glyphPositions,i.imagePositions,z,lt,d,Ne,Et,je,ae,a.WritingMode.horizontal,!1,mt,F,R);gt&&(Z.horizontal[Et]=gt),at(),bs(xe)&&m&&_&&(Z.vertical=Ul(X,i.glyphMap,i.glyphPositions,i.imagePositions,z,lt,d,Ne,Et,je,ae,a.WritingMode.vertical,!1,mt,F,R))}}let ke=!1;if(I.icon&&I.icon.name){const xe=i.imageMap[I.icon.name];xe&&(oe=sm(i.imagePositions[I.icon.name],e.get("icon-offset").evaluate(I,{},i.canonical),e.get("icon-anchor").evaluate(I,{},i.canonical)),ke=!!xe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ke:i.bucket.sdfIcons!==ke&&_e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const De=Dh(Z.horizontal)||Z.vertical;i.bucket.iconsInText=!!De&&De.iconsInText,(De||oe)&&fm(i.bucket,I,Z,oe,i.imageMap,s,F,q,ae,ke,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},a.perspective=function(i,e,r,s,d){var m,_=1/Math.tan(e/2);return i[0]=_/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+s)*(m=1/(s-d)),i[14]=2*d*s*m):(i[10]=-1,i[14]=-2*s),i},a.pick=function(i,e){const r={};for(let s=0;s<e.length;s++){const d=e[s];d in i&&(r[d]=i[d])}return r},a.plugin=Zr,a.pointGeometry=Ue,a.polygonIntersectsPolygon=Mu,a.potpack=hh,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=kt,a.registerForPluginStateChange=function(i){return i({pluginStatus:Sr,pluginURL:Mn}),mo.on("pluginStateChange",i),i},a.renderColorRamp=ju,a.rotateX=function(i,e,r){var s=Math.sin(r),d=Math.cos(r),m=e[4],_=e[5],b=e[6],I=e[7],z=e[8],R=e[9],F=e[10],q=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*d+z*s,i[5]=_*d+R*s,i[6]=b*d+F*s,i[7]=I*d+q*s,i[8]=z*d-m*s,i[9]=R*d-_*s,i[10]=F*d-b*s,i[11]=q*d-I*s,i},a.rotateZ=function(i,e,r){var s=Math.sin(r),d=Math.cos(r),m=e[0],_=e[1],b=e[2],I=e[3],z=e[4],R=e[5],F=e[6],q=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*d+z*s,i[1]=_*d+R*s,i[2]=b*d+F*s,i[3]=I*d+q*s,i[4]=z*d-m*s,i[5]=R*d-_*s,i[6]=F*d-b*s,i[7]=q*d-I*s,i},a.scale=function(i,e,r){var s=r[0],d=r[1],m=r[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},a.setCacheLimits=function(i,e){zt=i,Ke=e},a.setRTLTextPlugin=function(i,e,r=!1){if(Sr===uo||Sr===ho||Sr===fo)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mn=Ve.resolveURL(i),Sr=uo,po=e,ya(),r||kl()},a.spec=Fe,a.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},a.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},a.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},a.toEvaluationFeature=$a,a.transformMat3=function(i,e,r){var s=e[0],d=e[1],m=e[2];return i[0]=s*r[0]+d*r[3]+m*r[6],i[1]=s*r[1]+d*r[4]+m*r[7],i[2]=s*r[2]+d*r[5]+m*r[8],i},a.transformMat4=Ml,a.transformMat4$1=function(i,e,r){var s=e[0],d=e[1];return i[0]=r[0]*s+r[4]*d+r[12],i[1]=r[1]*s+r[5]*d+r[13],i},a.translate=function(i,e,r){var s,d,m,_,b,I,z,R,F,q,Z,X,oe=r[0],ae=r[1],ke=r[2];return e===i?(i[12]=e[0]*oe+e[4]*ae+e[8]*ke+e[12],i[13]=e[1]*oe+e[5]*ae+e[9]*ke+e[13],i[14]=e[2]*oe+e[6]*ae+e[10]*ke+e[14],i[15]=e[3]*oe+e[7]*ae+e[11]*ke+e[15]):(d=e[1],m=e[2],_=e[3],b=e[4],I=e[5],z=e[6],R=e[7],F=e[8],q=e[9],Z=e[10],X=e[11],i[0]=s=e[0],i[1]=d,i[2]=m,i[3]=_,i[4]=b,i[5]=I,i[6]=z,i[7]=R,i[8]=F,i[9]=q,i[10]=Z,i[11]=X,i[12]=s*oe+b*ae+F*ke+e[12],i[13]=d*oe+I*ae+q*ke+e[13],i[14]=m*oe+z*ae+Z*ke+e[14],i[15]=_*oe+R*ae+X*ke+e[15]),i},a.triggerPluginCompletionEvent=wl,a.unicodeBlockLookup=pt,a.uniqueId=function(){return G++},a.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateLight=so,a.validateStyle=Xa,a.vectorTile=wa,a.warnOnce=_e,a.wrap=N}),v(["./shared"],function(a){function k(J){const L=typeof J;if(L==="number"||L==="boolean"||L==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let K="[";for(const ce of J)K+=`${k(ce)},`;return`${K}]`}const V=Object.keys(J).sort();let H="{";for(let K=0;K<V.length;K++)H+=`${JSON.stringify(V[K])}:${k(J[V[K]])},`;return`${H}}`}function T(J){let L="";for(const V of a.refProperties)L+=`/${k(J[V])}`;return L}class D{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,V){for(const K of L){this._layerConfigs[K.id]=K;const ce=this._layers[K.id]=a.createStyleLayer(K);ce._featureFilter=a.createFilter(ce.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of V)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const H=function(K,ce){const ge={};for(let ue=0;ue<K.length;ue++){const ye=ce&&ce[K[ue].id]||T(K[ue]);ce&&(ce[K[ue].id]=ye);let Me=ge[ye];Me||(Me=ge[ye]=[]),Me.push(K[ue])}const fe=[];for(const ue in ge)fe.push(ge[ue]);return fe}(Object.values(this._layerConfigs),this.keyCache);for(const K of H){const ce=K.map(Xe=>this._layers[Xe.id]),ge=ce[0];if(ge.visibility==="none")continue;const fe=ge.source||"";let ue=this.familiesBySource[fe];ue||(ue=this.familiesBySource[fe]={});const ye=ge.sourceLayer||"_geojsonTileLayer";let Me=ue[ye];Me||(Me=ue[ye]=[]),Me.push(ce)}}}class M{constructor(L){const V={},H=[];for(const fe in L){const ue=L[fe],ye=V[fe]={};for(const Me in ue){const Xe=ue[+Me];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const ze={x:0,y:0,w:Xe.bitmap.width+2,h:Xe.bitmap.height+2};H.push(ze),ye[Me]={rect:ze,metrics:Xe.metrics}}}const{w:K,h:ce}=a.potpack(H),ge=new a.AlphaImage({width:K||1,height:ce||1});for(const fe in L){const ue=L[fe];for(const ye in ue){const Me=ue[+ye];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Xe=V[fe][ye].rect;a.AlphaImage.copy(Me.bitmap,ge,{x:0,y:0},{x:Xe.x+1,y:Xe.y+1},Me.bitmap)}}this.image=ge,this.positions=V}}a.register("GlyphAtlas",M);class A{constructor(L){this.tileID=new a.OverscaledTileID(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId}parse(L,V,H,K,ce){this.status="parsing",this.data=L,this.collisionBoxArray=new a.CollisionBoxArray;const ge=new a.DictionaryCoder(Object.keys(L.layers).sort()),fe=new a.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];const ue={},ye={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Me=V.familiesBySource[this.source];for(const Xt in Me){const Yt=L.layers[Xt];if(!Yt)continue;Yt.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${Xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ci=ge.encode(Xt),Si=[];for(let nr=0;nr<Yt.length;nr++){const Bi=Yt.feature(nr),pr=fe.getId(Bi,Xt);Si.push({feature:Bi,id:pr,index:nr,sourceLayerIndex:ci})}for(const nr of Me[Xt]){const Bi=nr[0];Bi.source!==this.source&&a.warnOnce(`layer.source = ${Bi.source} does not equal this.source = ${this.source}`),Bi.minzoom&&this.zoom<Math.floor(Bi.minzoom)||Bi.maxzoom&&this.zoom>=Bi.maxzoom||Bi.visibility!=="none"&&(N(nr,this.zoom,H),(ue[Bi.id]=Bi.createBucket({index:fe.bucketLayerIDs.length,layers:nr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ci,sourceID:this.source})).populate(Si,ye,this.tileID.canonical),fe.bucketLayerIDs.push(nr.map(pr=>pr.id)))}}let Xe,ze,It,St;const _t=a.mapObject(ye.glyphDependencies,Xt=>Object.keys(Xt).map(Number));Object.keys(_t).length?K.send("getGlyphs",{uid:this.uid,stacks:_t},(Xt,Yt)=>{Xe||(Xe=Xt,ze=Yt,li.call(this))}):ze={};const Ft=Object.keys(ye.iconDependencies);Ft.length?K.send("getImages",{icons:Ft,source:this.source,tileID:this.tileID,type:"icons"},(Xt,Yt)=>{Xe||(Xe=Xt,It=Yt,li.call(this))}):It={};const jt=Object.keys(ye.patternDependencies);function li(){if(Xe)return ce(Xe);if(ze&&It&&St){const Xt=new M(ze),Yt=new a.ImageAtlas(It,St);for(const ci in ue){const Si=ue[ci];Si instanceof a.SymbolBucket?(N(Si.layers,this.zoom,H),a.performSymbolLayout({bucket:Si,glyphMap:ze,glyphPositions:Xt.positions,imageMap:It,imagePositions:Yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Si.hasPattern&&(Si instanceof a.LineBucket||Si instanceof a.FillBucket||Si instanceof a.FillExtrusionBucket)&&(N(Si.layers,this.zoom,H),Si.addFeatures(ye,this.tileID.canonical,Yt.patternPositions))}this.status="done",ce(null,{buckets:Object.values(ue).filter(ci=>!ci.isEmpty()),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xt.image,imageAtlas:Yt,glyphMap:this.returnDependencies?ze:null,iconMap:this.returnDependencies?It:null,glyphPositions:this.returnDependencies?Xt.positions:null})}}jt.length?K.send("getImages",{icons:jt,source:this.source,tileID:this.tileID,type:"patterns"},(Xt,Yt)=>{Xe||(Xe=Xt,St=Yt,li.call(this))}):St={},li.call(this)}}function N(J,L,V){const H=new a.EvaluationParameters(L);for(const K of J)K.recalculate(H,V)}function O(J,L){const V=a.getArrayBuffer(J.request,(H,K,ce,ge)=>{H?L(H):K&&L(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(K)),rawData:K,cacheControl:ce,expires:ge})});return()=>{V.cancel(),L()}}class G{constructor(L,V,H,K){this.actor=L,this.layerIndex=V,this.availableImages=H,this.loadVectorData=K||O,this.loading={},this.loaded={}}loadTile(L,V){const H=L.uid;this.loading||(this.loading={});const K=!!(L&&L.request&&L.request.collectResourceTiming)&&new a.RequestPerformance(L.request),ce=this.loading[H]=new A(L);ce.abort=this.loadVectorData(L,(ge,fe)=>{if(delete this.loading[H],ge||!fe)return ce.status="done",this.loaded[H]=ce,V(ge);const ue=fe.rawData,ye={};fe.expires&&(ye.expires=fe.expires),fe.cacheControl&&(ye.cacheControl=fe.cacheControl);const Me={};if(K){const Xe=K.finish();Xe&&(Me.resourceTiming=JSON.parse(JSON.stringify(Xe)))}ce.vectorTile=fe.vectorTile,ce.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Xe,ze)=>{if(Xe||!ze)return V(Xe);V(null,a.extend({rawTileData:ue.slice(0)},ze,ye,Me))}),this.loaded=this.loaded||{},this.loaded[H]=ce})}reloadTile(L,V){const H=this.loaded,K=L.uid,ce=this;if(H&&H[K]){const ge=H[K];ge.showCollisionBoxes=L.showCollisionBoxes;const fe=(ue,ye)=>{const Me=ge.reloadCallback;Me&&(delete ge.reloadCallback,ge.parse(ge.vectorTile,ce.layerIndex,this.availableImages,ce.actor,Me)),V(ue,ye)};ge.status==="parsing"?ge.reloadCallback=fe:ge.status==="done"&&(ge.vectorTile?ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,fe):fe())}}abortTile(L,V){const H=this.loading,K=L.uid;H&&H[K]&&H[K].abort&&(H[K].abort(),delete H[K]),V()}removeTile(L,V){const H=this.loaded,K=L.uid;H&&H[K]&&delete H[K],V()}}class Q{constructor(){this.loaded={}}loadTile(L,V){const{uid:H,encoding:K,rawImageData:ce}=L,ge=a.isImageBitmap(ce)?this.getImageData(ce):ce,fe=new a.DEMData(H,ge,K);this.loaded=this.loaded||{},this.loaded[H]=fe,V(null,fe)}getImageData(L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const V=this.offscreenCanvasContext.getImageData(-1,-1,L.width+2,L.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:V.width,height:V.height},V.data)}removeTile(L){const V=this.loaded,H=L.uid;V&&V[H]&&delete V[H]}}var te=function J(L,V){var H,K=L&&L.type;if(K==="FeatureCollection")for(H=0;H<L.features.length;H++)J(L.features[H],V);else if(K==="GeometryCollection")for(H=0;H<L.geometries.length;H++)J(L.geometries[H],V);else if(K==="Feature")J(L.geometry,V);else if(K==="Polygon")le(L.coordinates,V);else if(K==="MultiPolygon")for(H=0;H<L.coordinates.length;H++)le(L.coordinates[H],V);return L};function le(J,L){if(J.length!==0){he(J[0],L);for(var V=1;V<J.length;V++)he(J[V],!L)}}function he(J,L){for(var V=0,H=0,K=0,ce=J.length,ge=ce-1;K<ce;ge=K++){var fe=(J[K][0]-J[ge][0])*(J[ge][1]+J[K][1]),ue=V+fe;H+=Math.abs(V)>=Math.abs(fe)?V-ue+fe:fe-ue+V,V=ue}V+H>=0!=!!L&&J.reverse()}const Y=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class _e{constructor(L){this._feature=L,this.extent=a.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const V of this._feature.geometry)L.push([new a.pointGeometry(V[0],V[1])]);return L}{const L=[];for(const V of this._feature.geometry){const H=[];for(const K of V)H.push(new a.pointGeometry(K[0],K[1]));L.push(H)}return L}}toGeoJSON(L,V,H){return Y.call(this,L,V,H)}}class re{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=L.length,this._features=L}feature(L){return new _e(this._features[L])}}var we={exports:{}},Le=a.pointGeometry,de=a.vectorTile.VectorTileFeature,be=Te;function Te(J,L){this.options=L||{},this.features=J,this.length=J.length}function Ce(J,L){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=L||4096}Te.prototype.feature=function(J){return new Ce(this.features[J],this.options.extent)},Ce.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var L=0;L<J.length;L++){for(var V=J[L],H=[],K=0;K<V.length;K++)H.push(new Le(V[K][0],V[K][1]));this.geometry.push(H)}return this.geometry},Ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,L=1/0,V=-1/0,H=1/0,K=-1/0,ce=0;ce<J.length;ce++)for(var ge=J[ce],fe=0;fe<ge.length;fe++){var ue=ge[fe];L=Math.min(L,ue.x),V=Math.max(V,ue.x),H=Math.min(H,ue.y),K=Math.max(K,ue.y)}return[L,H,V,K]},Ce.prototype.toGeoJSON=de.prototype.toGeoJSON;var rt=a.pbf,nt=be;function Ve(J){var L=new rt;return function(V,H){for(var K in V.layers)H.writeMessage(3,Ue,V.layers[K])}(J,L),L.finish()}function Ue(J,L){var V;L.writeVarintField(15,J.version||1),L.writeStringField(1,J.name||""),L.writeVarintField(5,J.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<J.length;V++)H.feature=J.feature(V),L.writeMessage(2,Oe,H);var K=H.keys;for(V=0;V<K.length;V++)L.writeStringField(3,K[V]);var ce=H.values;for(V=0;V<ce.length;V++)L.writeMessage(4,zt,ce[V])}function Oe(J,L){var V=J.feature;V.id!==void 0&&L.writeVarintField(1,V.id),L.writeMessage(2,et,J),L.writeVarintField(3,V.type),L.writeMessage(4,Gt,V)}function et(J,L){var V=J.feature,H=J.keys,K=J.values,ce=J.keycache,ge=J.valuecache;for(var fe in V.properties){var ue=V.properties[fe],ye=ce[fe];if(ue!==null){ye===void 0&&(H.push(fe),ce[fe]=ye=H.length-1),L.writeVarint(ye);var Me=typeof ue;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(ue=JSON.stringify(ue));var Xe=Me+":"+ue,ze=ge[Xe];ze===void 0&&(K.push(ue),ge[Xe]=ze=K.length-1),L.writeVarint(ze)}}}function tt(J,L){return(L<<3)+(7&J)}function ft(J){return J<<1^J>>31}function Gt(J,L){for(var V=J.loadGeometry(),H=J.type,K=0,ce=0,ge=V.length,fe=0;fe<ge;fe++){var ue=V[fe],ye=1;H===1&&(ye=ue.length),L.writeVarint(tt(1,ye));for(var Me=H===3?ue.length-1:ue.length,Xe=0;Xe<Me;Xe++){Xe===1&&H!==1&&L.writeVarint(tt(2,Me-1));var ze=ue[Xe].x-K,It=ue[Xe].y-ce;L.writeVarint(ft(ze)),L.writeVarint(ft(It)),K+=ze,ce+=It}H===3&&L.writeVarint(tt(7,1))}}function zt(J,L){var V=typeof J;V==="string"?L.writeStringField(1,J):V==="boolean"?L.writeBooleanField(7,J):V==="number"&&(J%1!=0?L.writeDoubleField(3,J):J<0?L.writeSVarintField(6,J):L.writeVarintField(5,J))}function Ke(J,L,V,H,K,ce){if(K-H<=V)return;const ge=H+K>>1;Tt(J,L,ge,H,K,ce%2),Ke(J,L,V,H,ge-1,ce+1),Ke(J,L,V,ge+1,K,ce+1)}function Tt(J,L,V,H,K,ce){for(;K>H;){if(K-H>600){const ye=K-H+1,Me=V-H+1,Xe=Math.log(ye),ze=.5*Math.exp(2*Xe/3),It=.5*Math.sqrt(Xe*ze*(ye-ze)/ye)*(Me-ye/2<0?-1:1);Tt(J,L,V,Math.max(H,Math.floor(V-Me*ze/ye+It)),Math.min(K,Math.floor(V+(ye-Me)*ze/ye+It)),ce)}const ge=L[2*V+ce];let fe=H,ue=K;for(Ct(J,L,H,V),L[2*K+ce]>ge&&Ct(J,L,H,K);fe<ue;){for(Ct(J,L,fe,ue),fe++,ue--;L[2*fe+ce]<ge;)fe++;for(;L[2*ue+ce]>ge;)ue--}L[2*H+ce]===ge?Ct(J,L,H,ue):(ue++,Ct(J,L,ue,K)),ue<=V&&(H=ue+1),V<=ue&&(K=ue-1)}}function Ct(J,L,V,H){ti(J,V,H),ti(L,2*V,2*H),ti(L,2*V+1,2*H+1)}function ti(J,L,V){const H=J[L];J[L]=J[V],J[V]=H}function hi(J,L,V,H){const K=J-V,ce=L-H;return K*K+ce*ce}we.exports=Ve,we.exports.fromVectorTileJs=Ve,we.exports.fromGeojsonVt=function(J,L){L=L||{};var V={};for(var H in J)V[H]=new nt(J[H].features,L),V[H].name=H,V[H].version=L.version,V[H].extent=L.extent;return Ve({layers:V})},we.exports.GeoJSONWrapper=nt;const _i=J=>J[0],Ye=J=>J[1];class Zt{constructor(L,V=_i,H=Ye,K=64,ce=Float64Array){this.nodeSize=K,this.points=L;const ge=L.length<65536?Uint16Array:Uint32Array,fe=this.ids=new ge(L.length),ue=this.coords=new ce(2*L.length);for(let ye=0;ye<L.length;ye++)fe[ye]=ye,ue[2*ye]=V(L[ye]),ue[2*ye+1]=H(L[ye]);Ke(fe,ue,K,0,fe.length-1,0)}range(L,V,H,K){return function(ce,ge,fe,ue,ye,Me,Xe){const ze=[0,ce.length-1,0],It=[];let St,_t;for(;ze.length;){const Ft=ze.pop(),jt=ze.pop(),li=ze.pop();if(jt-li<=Xe){for(let ci=li;ci<=jt;ci++)St=ge[2*ci],_t=ge[2*ci+1],St>=fe&&St<=ye&&_t>=ue&&_t<=Me&&It.push(ce[ci]);continue}const Xt=Math.floor((li+jt)/2);St=ge[2*Xt],_t=ge[2*Xt+1],St>=fe&&St<=ye&&_t>=ue&&_t<=Me&&It.push(ce[Xt]);const Yt=(Ft+1)%2;(Ft===0?fe<=St:ue<=_t)&&(ze.push(li),ze.push(Xt-1),ze.push(Yt)),(Ft===0?ye>=St:Me>=_t)&&(ze.push(Xt+1),ze.push(jt),ze.push(Yt))}return It}(this.ids,this.coords,L,V,H,K,this.nodeSize)}within(L,V,H){return function(K,ce,ge,fe,ue,ye){const Me=[0,K.length-1,0],Xe=[],ze=ue*ue;for(;Me.length;){const It=Me.pop(),St=Me.pop(),_t=Me.pop();if(St-_t<=ye){for(let Yt=_t;Yt<=St;Yt++)hi(ce[2*Yt],ce[2*Yt+1],ge,fe)<=ze&&Xe.push(K[Yt]);continue}const Ft=Math.floor((_t+St)/2),jt=ce[2*Ft],li=ce[2*Ft+1];hi(jt,li,ge,fe)<=ze&&Xe.push(K[Ft]);const Xt=(It+1)%2;(It===0?ge-ue<=jt:fe-ue<=li)&&(Me.push(_t),Me.push(Ft-1),Me.push(Xt)),(It===0?ge+ue>=jt:fe+ue>=li)&&(Me.push(Ft+1),Me.push(St),Me.push(Xt))}return Xe}(this.ids,this.coords,L,V,H,this.nodeSize)}}const He={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},ii=Math.fround||(Ri=new Float32Array(1),J=>(Ri[0]=+J,Ri[0]));var Ri;class br{constructor(L){this.options=Mr(Object.create(He),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:V,minZoom:H,maxZoom:K,nodeSize:ce}=this.options;V&&console.time("total time");const ge=`prepare ${L.length} points`;V&&console.time(ge),this.points=L;let fe=[];for(let ue=0;ue<L.length;ue++)L[ue].geometry&&fe.push(Kr(L[ue],ue));this.trees[K+1]=new Zt(fe,Sa,mn,ce,Float32Array),V&&console.timeEnd(ge);for(let ue=K;ue>=H;ue--){const ye=+Date.now();fe=this._cluster(fe,ue),this.trees[ue]=new Zt(fe,Sa,mn,ce,Float32Array),V&&console.log("z%d: %d clusters in %dms",ue,fe.length,+Date.now()-ye)}return V&&console.timeEnd("total time"),this}getClusters(L,V){let H=((L[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,L[1]));let ce=L[2]===180?180:((L[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)H=-180,ce=180;else if(H>ce){const Me=this.getClusters([H,K,180,ge],V),Xe=this.getClusters([-180,K,ce,ge],V);return Me.concat(Xe)}const fe=this.trees[this._limitZoom(V)],ue=fe.range(ai(H),$e(ge),ai(ce),$e(K)),ye=[];for(const Me of ue){const Xe=fe.points[Me];ye.push(Xe.numPoints?Jr(Xe):this.points[Xe.index])}return ye}getChildren(L){const V=this._getOriginId(L),H=this._getOriginZoom(L),K="No cluster with the specified id.",ce=this.trees[H];if(!ce)throw new Error(K);const ge=ce.points[V];if(!ge)throw new Error(K);const fe=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ue=ce.within(ge.x,ge.y,fe),ye=[];for(const Me of ue){const Xe=ce.points[Me];Xe.parentId===L&&ye.push(Xe.numPoints?Jr(Xe):this.points[Xe.index])}if(ye.length===0)throw new Error(K);return ye}getLeaves(L,V,H){const K=[];return this._appendLeaves(K,L,V=V||10,H=H||0,0),K}getTile(L,V,H){const K=this.trees[this._limitZoom(L)],ce=Math.pow(2,L),{extent:ge,radius:fe}=this.options,ue=fe/ge,ye=(H-ue)/ce,Me=(H+1+ue)/ce,Xe={features:[]};return this._addTileFeatures(K.range((V-ue)/ce,ye,(V+1+ue)/ce,Me),K.points,V,H,ce,Xe),V===0&&this._addTileFeatures(K.range(1-ue/ce,ye,1,Me),K.points,ce,H,ce,Xe),V===ce-1&&this._addTileFeatures(K.range(0,ye,ue/ce,Me),K.points,-1,H,ce,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(L){let V=this._getOriginZoom(L)-1;for(;V<=this.options.maxZoom;){const H=this.getChildren(L);if(V++,H.length!==1)break;L=H[0].properties.cluster_id}return V}_appendLeaves(L,V,H,K,ce){const ge=this.getChildren(V);for(const fe of ge){const ue=fe.properties;if(ue&&ue.cluster?ce+ue.point_count<=K?ce+=ue.point_count:ce=this._appendLeaves(L,ue.cluster_id,H,K,ce):ce<K?ce++:L.push(fe),L.length===H)break}return ce}_addTileFeatures(L,V,H,K,ce,ge){for(const fe of L){const ue=V[fe],ye=ue.numPoints;let Me,Xe,ze;if(ye)Me=Yr(ue),Xe=ue.x,ze=ue.y;else{const _t=this.points[ue.index];Me=_t.properties,Xe=ai(_t.geometry.coordinates[0]),ze=$e(_t.geometry.coordinates[1])}const It={type:1,geometry:[[Math.round(this.options.extent*(Xe*ce-H)),Math.round(this.options.extent*(ze*ce-K))]],tags:Me};let St;ye?St=ue.id:this.options.generateId?St=ue.index:this.points[ue.index].id&&(St=this.points[ue.index].id),St!==void 0&&(It.id=St),ge.features.push(It)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,V){const H=[],{radius:K,extent:ce,reduce:ge,minPoints:fe}=this.options,ue=K/(ce*Math.pow(2,V));for(let ye=0;ye<L.length;ye++){const Me=L[ye];if(Me.zoom<=V)continue;Me.zoom=V;const Xe=this.trees[V+1],ze=Xe.within(Me.x,Me.y,ue),It=Me.numPoints||1;let St=It;for(const _t of ze){const Ft=Xe.points[_t];Ft.zoom>V&&(St+=Ft.numPoints||1)}if(St>It&&St>=fe){let _t=Me.x*It,Ft=Me.y*It,jt=ge&&It>1?this._map(Me,!0):null;const li=(ye<<5)+(V+1)+this.points.length;for(const Xt of ze){const Yt=Xe.points[Xt];if(Yt.zoom<=V)continue;Yt.zoom=V;const ci=Yt.numPoints||1;_t+=Yt.x*ci,Ft+=Yt.y*ci,Yt.parentId=li,ge&&(jt||(jt=this._map(Me,!0)),ge(jt,this._map(Yt)))}Me.parentId=li,H.push(Hi(_t/St,Ft/St,li,St,jt))}else if(H.push(Me),St>1)for(const _t of ze){const Ft=Xe.points[_t];Ft.zoom<=V||(Ft.zoom=V,H.push(Ft))}}return H}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,V){if(L.numPoints)return V?Mr({},L.properties):L.properties;const H=this.points[L.index].properties,K=this.options.map(H);return V&&K===H?Mr({},K):K}}function Hi(J,L,V,H,K){return{x:ii(J),y:ii(L),zoom:1/0,id:V,parentId:-1,numPoints:H,properties:K}}function Kr(J,L){const[V,H]=J.geometry.coordinates;return{x:ii(ai(V)),y:ii($e(H)),zoom:1/0,index:L,parentId:-1}}function Jr(J){return{type:"Feature",id:J.id,properties:Yr(J),geometry:{type:"Point",coordinates:[(L=J.x,360*(L-.5)),Xi(J.y)]}};var L}function Yr(J){const L=J.numPoints,V=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Mr(Mr({},J.properties),{cluster:!0,cluster_id:J.id,point_count:L,point_count_abbreviated:V})}function ai(J){return J/360+.5}function $e(J){const L=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function Xi(J){const L=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Mr(J,L){for(const V in L)J[V]=L[V];return J}function Sa(J){return J.x}function mn(J){return J.y}function gn(J,L,V,H){for(var K,ce=H,ge=V-L>>1,fe=V-L,ue=J[L],ye=J[L+1],Me=J[V],Xe=J[V+1],ze=L+3;ze<V;ze+=3){var It=na(J[ze],J[ze+1],ue,ye,Me,Xe);if(It>ce)K=ze,ce=It;else if(It===ce){var St=Math.abs(ze-ge);St<fe&&(K=ze,fe=St)}}ce>H&&(K-L>3&&gn(J,L,K,H),J[K+2]=ce,V-K>3&&gn(J,K,V,H))}function na(J,L,V,H,K,ce){var ge=K-V,fe=ce-H;if(ge!==0||fe!==0){var ue=((J-V)*ge+(L-H)*fe)/(ge*ge+fe*fe);ue>1?(V=K,H=ce):ue>0&&(V+=ge*ue,H+=fe*ue)}return(ge=J-V)*ge+(fe=L-H)*fe}function _n(J,L,V,H){var K={id:J===void 0?null:J,type:L,geometry:V,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var ge=ce.geometry,fe=ce.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Fe(ce,ge);else if(fe==="Polygon"||fe==="MultiLineString")for(var ue=0;ue<ge.length;ue++)Fe(ce,ge[ue]);else if(fe==="MultiPolygon")for(ue=0;ue<ge.length;ue++)for(var ye=0;ye<ge[ue].length;ye++)Fe(ce,ge[ue][ye])}(K),K}function Fe(J,L){for(var V=0;V<L.length;V+=3)J.minX=Math.min(J.minX,L[V]),J.minY=Math.min(J.minY,L[V+1]),J.maxX=Math.max(J.maxX,L[V]),J.maxY=Math.max(J.maxY,L[V+1])}function ht(J,L,V,H){if(L.geometry){var K=L.geometry.coordinates,ce=L.geometry.type,ge=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),fe=[],ue=L.id;if(V.promoteId?ue=L.properties[V.promoteId]:V.generateId&&(ue=H||0),ce==="Point")Vn(K,fe);else if(ce==="MultiPoint")for(var ye=0;ye<K.length;ye++)Vn(K[ye],fe);else if(ce==="LineString")Qr(K,fe,ge,!1);else if(ce==="MultiLineString"){if(V.lineMetrics){for(ye=0;ye<K.length;ye++)Qr(K[ye],fe=[],ge,!1),J.push(_n(ue,"LineString",fe,L.properties));return}oi(K,fe,ge,!1)}else if(ce==="Polygon")oi(K,fe,ge,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(ye=0;ye<L.geometry.geometries.length;ye++)ht(J,{id:ue,geometry:L.geometry.geometries[ye],properties:L.properties},V,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<K.length;ye++){var Me=[];oi(K[ye],Me,ge,!0),fe.push(Me)}}J.push(_n(ue,ce,fe,L.properties))}}function Vn(J,L){L.push(jr(J[0])),L.push(Pr(J[1])),L.push(0)}function Qr(J,L,V,H){for(var K,ce,ge=0,fe=0;fe<J.length;fe++){var ue=jr(J[fe][0]),ye=Pr(J[fe][1]);L.push(ue),L.push(ye),L.push(0),fe>0&&(ge+=H?(K*ye-ue*ce)/2:Math.sqrt(Math.pow(ue-K,2)+Math.pow(ye-ce,2))),K=ue,ce=ye}var Me=L.length-3;L[2]=1,gn(L,0,Me,V),L[Me+2]=1,L.size=Math.abs(ge),L.start=0,L.end=L.size}function oi(J,L,V,H){for(var K=0;K<J.length;K++){var ce=[];Qr(J[K],ce,V,H),L.push(ce)}}function jr(J){return J/360+.5}function Pr(J){var L=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return V<0?0:V>1?1:V}function Lr(J,L,V,H,K,ce,ge,fe){if(H/=L,ce>=(V/=L)&&ge<H)return J;if(ge<V||ce>=H)return null;for(var ue=[],ye=0;ye<J.length;ye++){var Me=J[ye],Xe=Me.geometry,ze=Me.type,It=K===0?Me.minX:Me.minY,St=K===0?Me.maxX:Me.maxY;if(It>=V&&St<H)ue.push(Me);else if(!(St<V||It>=H)){var _t=[];if(ze==="Point"||ze==="MultiPoint")An(Xe,_t,V,H,K);else if(ze==="LineString")st(Xe,_t,V,H,K,!1,fe.lineMetrics);else if(ze==="MultiLineString")Ht(Xe,_t,V,H,K,!1);else if(ze==="Polygon")Ht(Xe,_t,V,H,K,!0);else if(ze==="MultiPolygon")for(var Ft=0;Ft<Xe.length;Ft++){var jt=[];Ht(Xe[Ft],jt,V,H,K,!0),jt.length&&_t.push(jt)}if(_t.length){if(fe.lineMetrics&&ze==="LineString"){for(Ft=0;Ft<_t.length;Ft++)ue.push(_n(Me.id,ze,_t[Ft],Me.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(_t.length===1?(ze="LineString",_t=_t[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=_t.length===3?"Point":"MultiPoint"),ue.push(_n(Me.id,ze,_t,Me.tags))}}}return ue.length?ue:null}function An(J,L,V,H,K){for(var ce=0;ce<J.length;ce+=3){var ge=J[ce+K];ge>=V&&ge<=H&&(L.push(J[ce]),L.push(J[ce+1]),L.push(J[ce+2]))}}function st(J,L,V,H,K,ce,ge){for(var fe,ue,ye=Jt(J),Me=K===0?Dn:Wt,Xe=J.start,ze=0;ze<J.length-3;ze+=3){var It=J[ze],St=J[ze+1],_t=J[ze+2],Ft=J[ze+3],jt=J[ze+4],li=K===0?It:St,Xt=K===0?Ft:jt,Yt=!1;ge&&(fe=Math.sqrt(Math.pow(It-Ft,2)+Math.pow(St-jt,2))),li<V?Xt>V&&(ue=Me(ye,It,St,Ft,jt,V),ge&&(ye.start=Xe+fe*ue)):li>H?Xt<H&&(ue=Me(ye,It,St,Ft,jt,H),ge&&(ye.start=Xe+fe*ue)):hr(ye,It,St,_t),Xt<V&&li>=V&&(ue=Me(ye,It,St,Ft,jt,V),Yt=!0),Xt>H&&li<=H&&(ue=Me(ye,It,St,Ft,jt,H),Yt=!0),!ce&&Yt&&(ge&&(ye.end=Xe+fe*ue),L.push(ye),ye=Jt(J)),ge&&(Xe+=fe)}var ci=J.length-3;It=J[ci],St=J[ci+1],_t=J[ci+2],(li=K===0?It:St)>=V&&li<=H&&hr(ye,It,St,_t),ci=ye.length-3,ce&&ci>=3&&(ye[ci]!==ye[0]||ye[ci+1]!==ye[1])&&hr(ye,ye[0],ye[1],ye[2]),ye.length&&L.push(ye)}function Jt(J){var L=[];return L.size=J.size,L.start=J.start,L.end=J.end,L}function Ht(J,L,V,H,K,ce){for(var ge=0;ge<J.length;ge++)st(J[ge],L,V,H,K,ce,!1)}function hr(J,L,V,H){J.push(L),J.push(V),J.push(H)}function Dn(J,L,V,H,K,ce){var ge=(ce-L)/(H-L);return J.push(ce),J.push(V+(K-V)*ge),J.push(1),ge}function Wt(J,L,V,H,K,ce){var ge=(ce-V)/(K-V);return J.push(L+(H-L)*ge),J.push(ce),J.push(1),ge}function yn(J,L){for(var V=[],H=0;H<J.length;H++){var K,ce=J[H],ge=ce.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")K=rr(ce.geometry,L);else if(ge==="MultiLineString"||ge==="Polygon"){K=[];for(var fe=0;fe<ce.geometry.length;fe++)K.push(rr(ce.geometry[fe],L))}else if(ge==="MultiPolygon")for(K=[],fe=0;fe<ce.geometry.length;fe++){for(var ue=[],ye=0;ye<ce.geometry[fe].length;ye++)ue.push(rr(ce.geometry[fe][ye],L));K.push(ue)}V.push(_n(ce.id,ge,K,ce.tags))}return V}function rr(J,L){var V=[];V.size=J.size,J.start!==void 0&&(V.start=J.start,V.end=J.end);for(var H=0;H<J.length;H+=3)V.push(J[H]+L,J[H+1],J[H+2]);return V}function aa(J,L){if(J.transformed)return J;var V,H,K,ce=1<<J.z,ge=J.x,fe=J.y;for(V=0;V<J.features.length;V++){var ue=J.features[V],ye=ue.geometry,Me=ue.type;if(ue.geometry=[],Me===1)for(H=0;H<ye.length;H+=2)ue.geometry.push(Ki(ye[H],ye[H+1],L,ce,ge,fe));else for(H=0;H<ye.length;H++){var Xe=[];for(K=0;K<ye[H].length;K+=2)Xe.push(Ki(ye[H][K],ye[H][K+1],L,ce,ge,fe));ue.geometry.push(Xe)}}return J.transformed=!0,J}function Ki(J,L,V,H,K,ce){return[Math.round(V*(J*H-K)),Math.round(V*(L*H-ce))]}function wr(J,L,V,H,K){for(var ce=L===K.maxZoom?0:K.tolerance/((1<<L)*K.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:H,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<J.length;fe++){ge.numFeatures++,Ei(ge,J[fe],ce,K);var ue=J[fe].minX,ye=J[fe].minY,Me=J[fe].maxX,Xe=J[fe].maxY;ue<ge.minX&&(ge.minX=ue),ye<ge.minY&&(ge.minY=ye),Me>ge.maxX&&(ge.maxX=Me),Xe>ge.maxY&&(ge.maxY=Xe)}return ge}function Ei(J,L,V,H){var K=L.geometry,ce=L.type,ge=[];if(ce==="Point"||ce==="MultiPoint")for(var fe=0;fe<K.length;fe+=3)ge.push(K[fe]),ge.push(K[fe+1]),J.numPoints++,J.numSimplified++;else if(ce==="LineString")sa(ge,K,J,V,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(fe=0;fe<K.length;fe++)sa(ge,K[fe],J,V,ce==="Polygon",fe===0);else if(ce==="MultiPolygon")for(var ue=0;ue<K.length;ue++){var ye=K[ue];for(fe=0;fe<ye.length;fe++)sa(ge,ye[fe],J,V,!0,fe===0)}if(ge.length){var Me=L.tags||null;if(ce==="LineString"&&H.lineMetrics){for(var Xe in Me={},L.tags)Me[Xe]=L.tags[Xe];Me.mapbox_clip_start=K.start/K.size,Me.mapbox_clip_end=K.end/K.size}var ze={geometry:ge,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Me};L.id!==null&&(ze.id=L.id),J.features.push(ze)}}function sa(J,L,V,H,K,ce){var ge=H*H;if(H>0&&L.size<(K?ge:H))V.numPoints+=L.length/3;else{for(var fe=[],ue=0;ue<L.length;ue+=3)(H===0||L[ue+2]>ge)&&(V.numSimplified++,fe.push(L[ue]),fe.push(L[ue+1])),V.numPoints++;K&&function(ye,Me){for(var Xe=0,ze=0,It=ye.length,St=It-2;ze<It;St=ze,ze+=2)Xe+=(ye[ze]-ye[St])*(ye[ze+1]+ye[St+1]);if(Xe>0===Me)for(ze=0,It=ye.length;ze<It/2;ze+=2){var _t=ye[ze],Ft=ye[ze+1];ye[ze]=ye[It-2-ze],ye[ze+1]=ye[It-1-ze],ye[It-2-ze]=_t,ye[It-1-ze]=Ft}}(fe,ce),J.push(fe)}}function ln(J,L){var V=(L=this.options=function(K,ce){for(var ge in ce)K[ge]=ce[ge];return K}(Object.create(this.options),L)).debug;if(V&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(K,ce){var ge=[];if(K.type==="FeatureCollection")for(var fe=0;fe<K.features.length;fe++)ht(ge,K.features[fe],ce,fe);else ht(ge,K.type==="Feature"?K:{geometry:K},ce);return ge}(J,L);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),H=function(K,ce){var ge=ce.buffer/ce.extent,fe=K,ue=Lr(K,1,-1-ge,ge,0,-1,2,ce),ye=Lr(K,1,1-ge,2+ge,0,-1,2,ce);return(ue||ye)&&(fe=Lr(K,1,-ge,1+ge,0,-1,2,ce)||[],ue&&(fe=yn(ue,1).concat(fe)),ye&&(fe=fe.concat(yn(ye,-1)))),fe}(H,L),H.length&&this.splitTile(H,0,0,0),V&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Un(J,L,V){return 32*((1<<J)*V+L)+J}function Nn(J,L){const V=J.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const H=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!H)return L(null,null);const K=new re(H.features);let ce=we.exports(K);ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),L(null,{vectorTile:K,rawData:ce.buffer})}ln.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ln.prototype.splitTile=function(J,L,V,H,K,ce,ge){for(var fe=[J,L,V,H],ue=this.options,ye=ue.debug;fe.length;){H=fe.pop(),V=fe.pop(),L=fe.pop(),J=fe.pop();var Me=1<<L,Xe=Un(L,V,H),ze=this.tiles[Xe];if(!ze&&(ye>1&&console.time("creation"),ze=this.tiles[Xe]=wr(J,L,V,H,ue),this.tileCoords.push({z:L,x:V,y:H}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,V,H,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var It="z"+L;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(ze.source=J,K){if(L===ue.maxZoom||L===K)continue;var St=1<<K-L;if(V!==Math.floor(ce/St)||H!==Math.floor(ge/St))continue}else if(L===ue.indexMaxZoom||ze.numPoints<=ue.indexMaxPoints)continue;if(ze.source=null,J.length!==0){ye>1&&console.time("clipping");var _t,Ft,jt,li,Xt,Yt,ci=.5*ue.buffer/ue.extent,Si=.5-ci,nr=.5+ci,Bi=1+ci;_t=Ft=jt=li=null,Xt=Lr(J,Me,V-ci,V+nr,0,ze.minX,ze.maxX,ue),Yt=Lr(J,Me,V+Si,V+Bi,0,ze.minX,ze.maxX,ue),J=null,Xt&&(_t=Lr(Xt,Me,H-ci,H+nr,1,ze.minY,ze.maxY,ue),Ft=Lr(Xt,Me,H+Si,H+Bi,1,ze.minY,ze.maxY,ue),Xt=null),Yt&&(jt=Lr(Yt,Me,H-ci,H+nr,1,ze.minY,ze.maxY,ue),li=Lr(Yt,Me,H+Si,H+Bi,1,ze.minY,ze.maxY,ue),Yt=null),ye>1&&console.timeEnd("clipping"),fe.push(_t||[],L+1,2*V,2*H),fe.push(Ft||[],L+1,2*V,2*H+1),fe.push(jt||[],L+1,2*V+1,2*H),fe.push(li||[],L+1,2*V+1,2*H+1)}}},ln.prototype.getTile=function(J,L,V){var H=this.options,K=H.extent,ce=H.debug;if(J<0||J>24)return null;var ge=1<<J,fe=Un(J,L=(L%ge+ge)%ge,V);if(this.tiles[fe])return aa(this.tiles[fe],K);ce>1&&console.log("drilling down to z%d-%d-%d",J,L,V);for(var ue,ye=J,Me=L,Xe=V;!ue&&ye>0;)ye--,Me=Math.floor(Me/2),Xe=Math.floor(Xe/2),ue=this.tiles[Un(ye,Me,Xe)];return ue&&ue.source?(ce>1&&console.log("found parent tile z%d-%d-%d",ye,Me,Xe),ce>1&&console.time("drilling down"),this.splitTile(ue.source,ye,Me,Xe,J,L,V),ce>1&&console.timeEnd("drilling down"),this.tiles[fe]?aa(this.tiles[fe],K):null):null};class oa extends G{constructor(L,V,H,K){super(L,V,H,Nn),K&&(this.loadGeoJSON=K)}loadData(L,V){var H;(H=this._pendingRequest)===null||H===void 0||H.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(L&&L.request&&L.request.collectResourceTiming)&&new a.RequestPerformance(L.request);this._pendingCallback=V,this._pendingRequest=this.loadGeoJSON(L,(ce,ge)=>{if(delete this._pendingCallback,delete this._pendingRequest,ce||!ge)return V(ce);if(typeof ge!="object")return V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{te(ge,!0);try{if(L.filter){const ue=a.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));ge={type:"FeatureCollection",features:ge.features.filter(Me=>ue.value.evaluate({zoom:0},Me))}}this._geoJSONIndex=L.cluster?new br(function({superclusterOptions:ue,clusterProperties:ye}){if(!ye||!ue)return ue;const Me={},Xe={},ze={accumulated:null,zoom:0},It={properties:null},St=Object.keys(ye);for(const _t of St){const[Ft,jt]=ye[_t],li=a.createExpression(jt),Xt=a.createExpression(typeof Ft=="string"?[Ft,["accumulated"],["get",_t]]:Ft);Me[_t]=li.value,Xe[_t]=Xt.value}return ue.map=_t=>{It.properties=_t;const Ft={};for(const jt of St)Ft[jt]=Me[jt].evaluate(ze,It);return Ft},ue.reduce=(_t,Ft)=>{It.properties=Ft;for(const jt of St)ze.accumulated=_t[jt],_t[jt]=Xe[jt].evaluate(ze,It)},ue}(L)).load(ge.features):function(ue,ye){return new ln(ue,ye)}(ge,L.geojsonVtOptions)}catch(ue){return V(ue)}this.loaded={};const fe={};if(K){const ue=K.finish();ue&&(fe.resourceTiming={},fe.resourceTiming[L.source]=JSON.parse(JSON.stringify(ue)))}V(null,fe)}})}reloadTile(L,V){const H=this.loaded;return H&&H[L.uid]?super.reloadTile(L,V):this.loadTile(L,V)}loadGeoJSON(L,V){if(L.request)return a.getJSON(L.request,V);if(typeof L.data=="string")try{V(null,JSON.parse(L.data))}catch{V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}else V(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(L,V){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),V()}getClusterExpansionZoom(L,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(H){V(H)}}getClusterChildren(L,V){try{V(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(H){V(H)}}getClusterLeaves(L,V){try{V(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(H){V(H)}}}class qn{constructor(L){this.self=L,this.actor=new a.Actor(L,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:G,geojson:oa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,H)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=H},this.self.registerRTLTextPlugin=V=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=V.applyArabicShaping,a.plugin.processBidirectionalText=V.processBidirectionalText,a.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}setReferrer(L,V){this.referrer=V}setImages(L,V,H){this.availableImages[L]=V;for(const K in this.workerSources[L]){const ce=this.workerSources[L][K];for(const ge in ce)ce[ge].availableImages=V}H()}setLayers(L,V,H){this.getLayerIndex(L).replace(V),H()}updateLayers(L,V,H){this.getLayerIndex(L).update(V.layers,V.removedIds),H()}loadTile(L,V,H){this.getWorkerSource(L,V.type,V.source).loadTile(V,H)}loadDEMTile(L,V,H){this.getDEMWorkerSource(L,V.source).loadTile(V,H)}reloadTile(L,V,H){this.getWorkerSource(L,V.type,V.source).reloadTile(V,H)}abortTile(L,V,H){this.getWorkerSource(L,V.type,V.source).abortTile(V,H)}removeTile(L,V,H){this.getWorkerSource(L,V.type,V.source).removeTile(V,H)}removeDEMTile(L,V){this.getDEMWorkerSource(L,V.source).removeTile(V)}removeSource(L,V,H){if(!this.workerSources[L]||!this.workerSources[L][V.type]||!this.workerSources[L][V.type][V.source])return;const K=this.workerSources[L][V.type][V.source];delete this.workerSources[L][V.type][V.source],K.removeSource!==void 0?K.removeSource(V,H):H()}loadWorkerSource(L,V,H){try{this.self.importScripts(V.url),H()}catch(K){H(K.toString())}}syncRTLPluginState(L,V,H){try{a.plugin.setState(V);const K=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&K!=null){this.self.importScripts(K);const ce=a.plugin.isParsed();H(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),ce)}}catch(K){H(K.toString())}}getAvailableImages(L){let V=this.availableImages[L];return V||(V=[]),V}getLayerIndex(L){let V=this.layerIndexes[L];return V||(V=this.layerIndexes[L]=new D),V}getWorkerSource(L,V,H){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][V]||(this.workerSources[L][V]={}),!this.workerSources[L][V][H]){const K={send:(ce,ge,fe)=>{this.actor.send(ce,ge,fe,L)}};this.workerSources[L][V][H]=new this.workerSourceTypes[V](K,this.getLayerIndex(L),this.getAvailableImages(L))}return this.workerSources[L][V][H]}getDEMWorkerSource(L,V){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][V]||(this.demWorkerSources[L][V]=new Q),this.demWorkerSources[L][V]}enforceCacheSizeLimit(L,V){a.enforceCacheSizeLimit(V)}}return a.isWorker()&&(self.worker=new qn(self)),qn}),v(["./shared"],function(a){var k=T;function T(u){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var o,f,g=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(g);try{f=new Worker(x),o=!0}catch{o=!1}return f&&f.terminate(),URL.revokeObjectURL(x),o}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var o=document.createElement("canvas");o.width=o.height=1;var f=o.getContext("2d");if(!f)return!1;var g=f.getImageData(0,0,1,1);return g&&g.width===o.width}()?(D[n=t&&t.failIfMajorPerformanceCaveat]===void 0&&(D[n]=function(o){var f,g=function(x){var E=document.createElement("canvas"),C=Object.create(T.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=x,E.getContext("webgl",C)||E.getContext("experimental-webgl",C)}(o);if(!g)return!1;try{f=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!f||g.isContextLost())&&(g.shaderSource(f,"void main() {}"),g.compileShader(f),g.getShaderParameter(f,g.COMPILE_STATUS)===!0)}(n)),D[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(u)}var D={};function M(u,t){if(Array.isArray(u)){if(!Array.isArray(t)||u.length!==t.length)return!1;for(let n=0;n<u.length;n++)if(!M(u[n],t[n]))return!1;return!0}if(typeof u=="object"&&u!==null&&t!==null){if(typeof t!="object"||Object.keys(u).length!==Object.keys(t).length)return!1;for(const n in u)if(!M(u[n],t[n]))return!1;return!0}return u===t}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class A{static testProp(t){if(!A.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in A.docStyle)return t[n];return t[0]}static create(t,n,o){const f=window.document.createElement(t);return n!==void 0&&(f.className=n),o&&o.appendChild(f),f}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){A.docStyle&&A.selectProp&&(A.userSelect=A.docStyle[A.selectProp],A.docStyle[A.selectProp]="none")}static enableDrag(){A.docStyle&&A.selectProp&&(A.docStyle[A.selectProp]=A.userSelect)}static setTransform(t,n){t.style[A.transformProp]=n}static addEventListener(t,n,o,f={}){t.addEventListener(n,o,"passive"in f?f:f.capture)}static removeEventListener(t,n,o,f={}){t.removeEventListener(n,o,"passive"in f?f:f.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",A.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",A.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",A.suppressClickInternal,!0)},0)}static mousePos(t,n){const o=t.getBoundingClientRect();return new a.pointGeometry(n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop)}static touchPos(t,n){const o=t.getBoundingClientRect(),f=[];for(let g=0;g<n.length;g++)f.push(new a.pointGeometry(n[g].clientX-o.left-t.clientLeft,n[g].clientY-o.top-t.clientTop));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}A.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,A.selectProp=A.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),A.transformProp=A.testProp(["transform","WebkitTransform"]);class N{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,o){const f=function(g){const x=g.match(O);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return f.path+=`${n}${o}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(f)}setTransformRequest(t){this._transformRequestFn=t}}const O=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class G{constructor(t,n,o,f){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,f)}update(t,n,o){const{width:f,height:g}=t,x=!(this.size&&this.size[0]===f&&this.size[1]===g||o),{context:E}=this,{gl:C}=E;if(this.useMipmap=!!(n&&n.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!n||n.premultiply!==!1)),x)this.size=[f,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,f,g,0,this.format,C.UNSIGNED_BYTE,t.data);else{const{x:P,y:B}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||a.isImageBitmap(t)?C.texSubImage2D(C.TEXTURE_2D,0,P,B,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,P,B,f,g,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(t,n,o){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),o!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Q(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class te extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:o}of this.requestors)this._notify(n,o);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let o=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(n.content,n)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(t,n){if(!t)return!0;let o=0;for(const f of t){if(f[0]<o||f[1]<f[0]||n<f[1])return!1;o=f[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n){const o=this.images[t];if(o.data.width!==n.data.width||o.data.height!==n.data.height)throw new Error(`size mismatch between old image (${o.data.width}x${o.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=o.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let o=!0;if(!this.isLoaded())for(const f of t)this.images[f]||(o=!1);this.isLoaded()||o?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const o={};for(const f of t){this.images[f]||this.fire(new a.Event("styleimagemissing",{id:f}));const g=this.images[f];g?o[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:a.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,o)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],o=this.getImage(t);if(!o)return null;if(n&&n.position.version===o.version)return n.position;if(n)n.position.version=o.version;else{const f={w:o.data.width+2,h:o.data.height+2,x:0,y:0},g=new a.ImagePosition(f,o);this.patterns[t]={bin:f,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new G(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:n,h:o}=a.potpack(t),f=this.atlasImage;f.resize({width:n||1,height:o||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],E=x.x+1,C=x.y+1,P=this.images[g].data,B=P.width,U=P.height;a.RGBAImage.copy(P,f,{x:0,y:0},{x:E,y:C},{width:B,height:U}),a.RGBAImage.copy(P,f,{x:0,y:U-1},{x:E,y:C-1},{width:B,height:1}),a.RGBAImage.copy(P,f,{x:0,y:0},{x:E,y:C+U},{width:B,height:1}),a.RGBAImage.copy(P,f,{x:B-1,y:0},{x:E-1,y:C},{width:1,height:U}),a.RGBAImage.copy(P,f,{x:0,y:0},{x:E+B,y:C},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const o=this.images[n];o||a.warnOnce(`Image with ID: "${n}" was not found`),Q(o)&&this.updateImage(n,o)}}}const le=1e20;function he(u,t,n,o,f,g,x,E,C){for(let P=t;P<t+o;P++)Y(u,n*g+P,g,f,x,E,C);for(let P=n;P<n+f;P++)Y(u,P*g+t,1,o,x,E,C)}function Y(u,t,n,o,f,g,x){g[0]=0,x[0]=-le,x[1]=le,f[0]=u[t];for(let E=1,C=0,P=0;E<o;E++){f[E]=u[t+E*n];const B=E*E;do{const U=g[C];P=(f[E]-f[U]+B-U*U)/(E-U)/2}while(P<=x[C]&&--C>-1);C++,g[C]=E,x[C]=P,x[C+1]=le}for(let E=0,C=0;E<o;E++){for(;x[C+1]<E;)C++;const P=g[C],B=E-P;u[t+E*n]=f[P]+B*B}}class _e{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const o=[];for(const f in t)for(const g of t[f])o.push({stack:f,id:g});a.asyncAll(o,({stack:f,id:g},x)=>{let E=this.entries[f];E||(E=this.entries[f]={glyphs:{},requests:{},ranges:{}});let C=E.glyphs[g];if(C!==void 0)return void x(null,{stack:f,id:g,glyph:C});if(C=this._tinySDF(E,f,g),C)return E.glyphs[g]=C,void x(null,{stack:f,id:g,glyph:C});const P=Math.floor(g/256);if(256*P>65535)return void x(new Error("glyphs > 65535 not supported"));if(E.ranges[P])return void x(null,{stack:f,id:g,glyph:C});let B=E.requests[P];B||(B=E.requests[P]=[],_e.loadGlyphRange(f,P,this.url,this.requestManager,(U,j)=>{if(j){for(const ie in j)this._doesCharSupportLocalGlyph(+ie)||(E.glyphs[+ie]=j[+ie]);E.ranges[P]=!0}for(const ie of B)ie(U,j);delete E.requests[P]})),B.push((U,j)=>{U?x(U):j&&x(null,{stack:f,id:g,glyph:j[g]||null})})},(f,g)=>{if(f)n(f);else if(g){const x={};for(const{stack:E,id:C,glyph:P}of g)(x[E]||(x[E]={}))[C]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};n(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](t)||a.unicodeBlockLookup["Hangul Syllables"](t)||a.unicodeBlockLookup.Hiragana(t)||a.unicodeBlockLookup.Katakana(t))}_tinySDF(t,n,o){const f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(o))return;let g=t.tinySDF;if(!g){let E="400";/bold/i.test(n)?E="900":/medium/i.test(n)?E="500":/light/i.test(n)&&(E="200"),g=t.tinySDF=new _e.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:f,fontWeight:E})}const x=g.draw(String.fromCharCode(o));return{id:o,bitmap:new a.AlphaImage({width:x.width||30,height:x.height||30},x.data),metrics:{width:x.glyphWidth||24,height:x.glyphHeight||24,left:x.glyphLeft||0,top:x.glyphTop-27||-8,advance:x.glyphAdvance||24}}}}_e.loadGlyphRange=function(u,t,n,o,f){const g=256*t,x=g+255,E=o.transformRequest(n.replace("{fontstack}",u).replace("{range}",`${g}-${x}`),a.ResourceType.Glyphs);a.getArrayBuffer(E,(C,P)=>{if(C)f(C);else if(P){const B={};for(const U of a.parseGlyphPbf(P))B[U.id]=U;f(null,B)}})},_e.TinySDF=class{constructor({fontSize:u=24,buffer:t=3,radius:n=8,cutoff:o=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=o,this.radius=n;const E=this.size=u+4*t,C=this._createCanvas(E),P=this.ctx=C.getContext("2d",{willReadFrequently:!0});P.font=`${x} ${g} ${u}px ${f}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(u){const t=document.createElement("canvas");return t.width=t.height=u,t}draw(u){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(u),x=Math.ceil(n),E=Math.min(this.size-this.buffer,Math.ceil(g-f)),C=Math.min(this.size-this.buffer,x+Math.ceil(o)),P=E+2*this.buffer,B=C+2*this.buffer,U=Math.max(P*B,0),j=new Uint8ClampedArray(U),ie={data:j,width:P,height:B,glyphWidth:E,glyphHeight:C,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(E===0||C===0)return ie;const{ctx:$,buffer:ee,gridInner:pe,gridOuter:ve}=this;$.clearRect(ee,ee,E,C),$.fillText(u,ee,ee+x);const Ie=$.getImageData(ee,ee,E,C);ve.fill(le,0,U),pe.fill(0,0,U);for(let ne=0;ne<C;ne++)for(let Ae=0;Ae<E;Ae++){const Ee=Ie.data[4*(ne*E+Ae)+3]/255;if(Ee===0)continue;const Re=(ne+ee)*P+Ae+ee;if(Ee===1)ve[Re]=0,pe[Re]=le;else{const Be=.5-Ee;ve[Re]=Be>0?Be*Be:0,pe[Re]=Be<0?Be*Be:0}}he(ve,0,0,P,B,P,this.f,this.v,this.z),he(pe,ee,ee,E,C,P,this.f,this.v,this.z);for(let ne=0;ne<U;ne++){const Ae=Math.sqrt(ve[ne])-Math.sqrt(pe[ne]);j[ne]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return ie}};const re=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(u,t){return a.sphericalToCartesian(u.expression.evaluate(t))}interpolate(u,t,n){return{x:a.number(u.x,t.x,n),y:a.number(u.y,t.y,n),z:a.number(u.z,t.z,n)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),we="-transition";class Le extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(re),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(a.validateLight,t,n))for(const o in t){const f=t[o];o.endsWith(we)?this._transitionable.setTransition(o.slice(0,-we.length),f):this._transitionable.setValue(o,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,o){return(!o||o.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class de{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const o=t.join(",")+String(n);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(t,n)),this.dashEntry[o]}getDashRanges(t,n,o){const f=[];let g=t.length%2==1?-t[t.length-1]*o:0,x=t[0]*o,E=!0;f.push({left:g,right:x,isDash:E,zeroLength:t[0]===0});let C=t[0];for(let P=1;P<t.length;P++){E=!E;const B=t[P];g=C*o,C+=B,x=C*o,f.push({left:g,right:x,isDash:E,zeroLength:B===0})}return f}addRoundDash(t,n,o){const f=n/2;for(let g=-o;g<=o;g++){const x=this.width*(this.nextRow+o+g);let E=0,C=t[E];for(let P=0;P<this.width;P++){P/C.right>1&&(C=t[++E]);const B=Math.abs(P-C.left),U=Math.abs(P-C.right),j=Math.min(B,U);let ie;const $=g/o*(f+1);if(C.isDash){const ee=f-Math.abs($);ie=Math.sqrt(j*j+ee*ee)}else ie=f-Math.sqrt(j*j+$*$);this.data[x+P]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(t){for(let E=t.length-1;E>=0;--E){const C=t[E],P=t[E+1];C.zeroLength?t.splice(E,1):P&&P.isDash===C.isDash&&(P.left=C.left,t.splice(E,1))}const n=t[0],o=t[t.length-1];n.isDash===o.isDash&&(n.left=o.left-this.width,o.right=n.right+this.width);const f=this.width*this.nextRow;let g=0,x=t[g];for(let E=0;E<this.width;E++){E/x.right>1&&(x=t[++g]);const C=Math.abs(E-x.left),P=Math.abs(E-x.right),B=Math.min(C,P);this.data[f+E]=Math.max(0,Math.min(255,(x.isDash?B:-B)+128))}}addDash(t,n){const o=n?7:0,f=2*o+1;if(this.nextRow+f>this.height)return a.warnOnce("LineAtlas out of space"),null;let g=0;for(let E=0;E<t.length;E++)g+=t[E];if(g!==0){const E=this.width/g,C=this.getDashRanges(t,this.width,E);n?this.addRoundDash(C,E,o):this.addRegularDash(C)}const x={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:g};return this.nextRow+=f,this.dirty=!0,x}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class be{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const o=this.workerPool.acquire(this.id);for(let f=0;f<o.length;f++){const g=new be.Actor(o[f],n,this.id);g.name=`Worker ${f}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,o){a.asyncAll(this.actors,(f,g)=>{f.send(t,n,g)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Te(u,t,n){const o=function(f,g){if(f)return n(f);if(g){const x=a.pick(a.extend(g,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(E=>E.id)),n(null,x)}};return u.url?a.getJSON(t.transformRequest(u.url,a.ResourceType.Source),o):a.exported.frame(()=>o(null,u))}be.Actor=a.Actor;class Ce{constructor(t,n,o){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),o=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*n),f=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*n),g=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*n),x=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=o&&t.x<g&&t.y>=f&&t.y<x}}class rt extends a.Evented{constructor(t,n,o,f){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Te(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new Ce(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(o,a.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,E){return delete t.request,t.aborted?n(null):x&&x.status!==404?n(x):(E&&E.resourceTiming&&(t.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&t.setExpiryData(E),t.loadVectorData(E,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}f.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",f,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",f,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class nt extends a.Evented{constructor(t,n,o,f){super(),this.id=t,this.dispatcher=o,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},n),a.extend(this,a.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Te(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):n&&(a.extend(this,n),n.bounds&&(this.tileBounds=new Ce(n.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),(f,g,x)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(f)t.state="errored",n(f);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(x);const E=this.map.painter.context,C=E.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new G(E,g,C.RGBA,{useMipmap:!0}),t.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&C.texParameterf(C.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),n(null)}})}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}let Ve;class Ue extends nt{constructor(t,n,o,f){super(t,n,o,f),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,n){const o=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function f(g,x){g&&(t.state="errored",n(g)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),(function(g,x){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(g)t.state="errored",n(g);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(x),delete x.cacheControl,delete x.expires;const E=a.isImageBitmap(x)&&(Ve==null&&(Ve=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ve)?x:a.exported.getImageData(x,1),C={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:E,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",C,f.bind(this)))}}).bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const n=t.canonical,o=Math.pow(2,n.z),f=(n.x-1+o)%o,g=n.x===0?t.wrap-1:t.wrap,x=(n.x+1+o)%o,E=n.x+1===o?t.wrap+1:t.wrap,C={};return C[new a.OverscaledTileID(t.overscaledZ,g,n.z,f,n.y).key]={backfilled:!1},C[new a.OverscaledTileID(t.overscaledZ,E,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(C[new a.OverscaledTileID(t.overscaledZ,g,n.z,f,n.y-1).key]={backfilled:!1},C[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},C[new a.OverscaledTileID(t.overscaledZ,E,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<o&&(C[new a.OverscaledTileID(t.overscaledZ,g,n.z,f,n.y+1).key]={backfilled:!1},C[new a.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},C[new a.OverscaledTileID(t.overscaledZ,E,n.z,x,n.y+1).key]={backfilled:!1}),C}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Oe extends a.Evented{constructor(t,n,o,f){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=o.getActor(),this.setEventedParent(f),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const g=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*g,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*g,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(n.clusterRadius||50)*g,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:o},f),this}_updateWorkerData(t){const n=a.extend({},this.workerOptions),o=this._data;typeof o=="string"?(n.request=this.map._requestManager.transformRequest(a.exported.resolveURL(o),a.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(o),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(f,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source",sourceDataType:t}));let x=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x=g.resourceTiming[this.id].slice(0)),f)return void this.fire(new a.ErrorEvent(f));const E={dataType:"source",sourceDataType:t};this._collectResourceTiming&&x&&x.length>0&&a.extend(E,{resourceTiming:x}),this.fire(new a.Event("data",E))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(o,f,(g,x)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):g?n(g):(t.loadVectorData(x,this.map.painter,o==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var et=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class tt extends a.Evented{constructor(t,n,o,f){super(),this.id=t,this.dispatcher=o,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=n}load(t,n){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(o,f)=>{this._loaded=!0,o?this.fire(new a.ErrorEvent(o)):f&&(this.image=f,t&&(this.coordinates=t),n&&n(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const n=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(f){let g=1/0,x=1/0,E=-1/0,C=-1/0;for(const j of f)g=Math.min(g,j.x),x=Math.min(x,j.y),E=Math.max(E,j.x),C=Math.max(C,j.y);const P=Math.max(E-g,C-x),B=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),U=Math.pow(2,B);return new a.CanonicalTileID(B,Math.floor((g+E)/2*U),Math.floor((x+C)/2*U))}(n),this.minzoom=this.maxzoom=this.tileID.z;const o=n.map(f=>this.tileID.getTilePoint(f)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(o[0].x,o[0].y,0,0),this._boundsArray.emplaceBack(o[1].x,o[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(o[3].x,o[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(o[2].x,o[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new G(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const f=this.tiles[o];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ft extends tt{constructor(t,n,o,f){super(t,n,o,f),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const n of t.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,n=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new G(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));for(const o in this.tiles){const f=this.tiles[o];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Gt extends tt{constructor(t,n,o,f){super(t,n,o,f),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,o=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new G(n,this.canvas,o.RGBA,{premultiply:!0});for(const f in this.tiles){const g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const zt={vector:rt,raster:nt,"raster-dem":Ue,geojson:Oe,video:ft,image:tt,canvas:Gt};function Ke(u,t){const n=a.create();return a.translate(n,n,[1,1,0]),a.scale(n,n,[.5*u.width,.5*u.height,1]),a.multiply(n,n,u.calculatePosMatrix(t.toUnwrapped()))}function Tt(u,t,n,o,f,g){const x=function(U,j,ie){if(U)for(const $ of U){const ee=j[$];if(ee&&ee.source===ie&&ee.type==="fill-extrusion")return!0}else for(const $ in j){const ee=j[$];if(ee.source===ie&&ee.type==="fill-extrusion")return!0}return!1}(f&&f.layers,t,u.id),E=g.maxPitchScaleFactor(),C=u.tilesIn(o,E,x);C.sort(Ct);const P=[];for(const U of C)P.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(t,n,u._state,U.queryGeometry,U.cameraQueryGeometry,U.scale,f,g,E,Ke(u.transform,U.tileID))});const B=function(U){const j={},ie={};for(const $ of U){const ee=$.queryResults,pe=$.wrappedTileID,ve=ie[pe]=ie[pe]||{};for(const Ie in ee){const ne=ee[Ie],Ae=ve[Ie]=ve[Ie]||{},Ee=j[Ie]=j[Ie]||[];for(const Re of ne)Ae[Re.featureIndex]||(Ae[Re.featureIndex]=!0,Ee.push(Re))}}return j}(P);for(const U in B)B[U].forEach(j=>{const ie=j.feature,$=u.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=$});return B}function Ct(u,t){const n=u.tileID,o=t.tileID;return n.overscaledZ-o.overscaledZ||n.canonical.y-o.canonical.y||n.wrap-o.wrap||n.canonical.x-o.canonical.x}class ti{constructor(t,n){this.tileID=t,this.uid=a.uniqueId(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<a.exported.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(n=>t.saveTileTexture(n)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(f,g){const x={};if(!g)return x;for(const E of f){const C=E.layerIds.map(P=>g.getLayer(P)).filter(Boolean);if(C.length!==0){E.layers=C,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(P=>C.filter(B=>B.id===P)[0]));for(const P of C)x[P.id]=E}}return x}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!o)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof a.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(f).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const o in this.buckets){const f=this.buckets[o];f.uploadPending()&&f.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new G(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new G(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,o,f,g,x,E,C,P,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:B,transform:C,params:E,queryPadding:this.queryPadding*P},t,n,o):{}}querySourceFeatures(t,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const f=o.loadVTLayers(),g=n?n.sourceLayer:"",x=f._geojsonTileLayer||f[g];if(!x)return;const E=a.createFilter(n&&n.filter),{z:C,x:P,y:B}=this.tileID.canonical,U={z:C,x:P,y:B};for(let j=0;j<x.length;j++){const ie=x.feature(j);if(E.needGeometry){const pe=a.toEvaluationFeature(ie,!0);if(!E.filter(new a.EvaluationParameters(this.tileID.overscaledZ),pe,this.tileID.canonical))continue}else if(!E.filter(new a.EvaluationParameters(this.tileID.overscaledZ),ie))continue;const $=o.getId(ie,g),ee=new a.GeoJSONFeature(ie,C,P,B,$);ee.tile=U,t.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const o=a.parseCacheControl(t.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const o=Date.now();let f=!1;if(this.expirationTime>o)f=!1;else if(n)if(this.expirationTime<n)f=!0;else{const g=this.expirationTime-n;g?this.expirationTime=o+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!n.style.hasLayer(f))continue;const g=this.buckets[f],x=g.layers[0].sourceLayer||"_geojsonTileLayer",E=o[x],C=t[x];if(!E||!C||Object.keys(C).length===0)continue;g.update(C,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=n&&n.style&&n.style.getLayer(f);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.exported.now()+t}setDependencies(t,n){const o={};for(const f of n)o[f]=!0;this.dependencies[t]=o}hasDependency(t,n){for(const o of t){const f=this.dependencies[o];if(f){for(const g of n)if(f[g])return!0}}return!1}}class hi{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,o){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const g={value:n,timeout:void 0};if(o!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},o)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const o=t.wrapped().key,f=n===void 0?0:this.data[o].indexOf(n),g=this.data[o][f];return this.data[o].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(g.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const o in this.data)for(const f of this.data[o])t(f.value)||n.push(f);for(const o of n)this.remove(o.value.tileID,o)}}class _i{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,o){const f=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},a.extend(this.stateChanges[t][f],o),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==f&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const g in this.state[t][f])o[g]||(this.deletedStates[t][f][g]=null)}else for(const g in o)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][g]===null&&delete this.deletedStates[t][f][g]}removeFeatureState(t,n,o){if(this.deletedStates[t]===null)return;const f=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},o&&n!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][o]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(o in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][o]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,n){const o=String(n),f=a.extend({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][n];if(g===null)return{};for(const x in g)delete f[x]}return f}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const o={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),a.extend(this.state[f][x],this.stateChanges[f][x]),g[x]=this.state[f][x];o[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(this.deletedStates[f]===null)for(const x in this.state[f])g[x]={},this.state[f][x]={};else for(const x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else for(const E of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][E];g[x]=this.state[f][x]}o[f]=o[f]||{},a.extend(o[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const f in t)t[f].setFeatureState(o,n)}}class Ye extends a.Evented{constructor(t,n,o){super(),this.id=t,this.dispatcher=o,this.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(f,g,x,E){const C=new zt[g.type](f,g,x,E);if(C.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${C.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],C),C}(t,n,o,this),this._tiles={},this._cache=new hi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _i}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new a.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(t),o.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Zt).map(t=>t.key)}getRenderableIds(t){const n=[];for(const o in this._tiles)this._isIdRenderable(o,t)&&n.push(this._tiles[o]);return t?n.sort((o,f)=>{const g=o.tileID,x=f.tileID,E=new a.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),C=new a.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||C.y-E.y||C.x-E.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(Zt).map(o=>o.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const o=this._tiles[t];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,t,n)))}_tileLoaded(t,n,o,f){if(f)return t.state="errored",void(f.status!==404?this._source.fire(new a.ErrorEvent(f,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=a.exported.now(),o==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let f=0;f<n.length;f++){const g=n[f];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);o(t,x),o(x,t)}}function o(f,g){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-f.tileID.canonical.x;const E=g.tileID.canonical.y-f.tileID.canonical.y,C=Math.pow(2,f.tileID.canonical.z),P=g.tileID.key;x===0&&E===0||Math.abs(E)>1||(Math.abs(x)>1&&(Math.abs(x+C)===1?x+=C:Math.abs(x-C)===1&&(x-=C)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,x,E),f.neighboringTiles&&f.neighboringTiles[P]&&(f.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,o,f){for(const g in this._tiles){let x=this._tiles[g];if(f[g]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>o)continue;let E=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const P=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[P.key],x&&x.hasData()&&(E=P)}let C=E;for(;C.overscaledZ>n;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){f[E.key]=E;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const o=this._loadedParentTiles[t.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=t.overscaledZ-1;o>=n;o--){const f=t.scaledTo(o),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,o=Math.ceil(t.height/this._source.tileSize)+1,f=Math.floor(n*o*5),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const o={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),o[g.tileID.key]=g}this._tiles=o;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let o;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new a.OverscaledTileID(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(o=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(o=o.filter(P=>this._source.hasTile(P)))):o=[];const f=t.coveringZoomLevel(this._source),g=Math.max(f-Ye.maxOverzooming,this._source.minzoom),x=Math.max(f+Ye.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const B of o)if(B.canonical.z>this._source.minzoom){const U=B.scaledTo(B.canonical.z-1);P[U.key]=U;const j=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));P[j.key]=j}o=o.concat(Object.values(P))}const E=this._updateRetainedTiles(o,f);if(He(this._source.type)){const P={},B={},U=Object.keys(E);for(const j of U){const ie=E[j],$=this._tiles[j];if(!$||$.fadeEndTime&&$.fadeEndTime<=a.exported.now())continue;const ee=this.findLoadedParent(ie,g);ee&&(this._addTile(ee.tileID),P[ee.tileID.key]=ee.tileID),B[j]=ie}this._retainLoadedChildren(B,f,x,E);for(const j in P)E[j]||(this._coveredTiles[j]=!0,E[j]=P[j]);if(n){const j={},ie={};for(const $ of o)this._tiles[$.key].hasData()?j[$.key]=$:ie[$.key]=$;for(const $ in ie){const ee=ie[$].children(this._source.maxzoom);this._tiles[ee[0].key]&&this._tiles[ee[1].key]&&this._tiles[ee[2].key]&&this._tiles[ee[3].key]&&(j[ee[0].key]=E[ee[0].key]=ee[0],j[ee[1].key]=E[ee[1].key]=ee[1],j[ee[2].key]=E[ee[2].key]=ee[2],j[ee[3].key]=E[ee[3].key]=ee[3],delete ie[$])}for(const $ in ie){const ee=this.findLoadedParent(ie[$],this._source.minzoom);if(ee){j[ee.tileID.key]=E[ee.tileID.key]=ee.tileID;for(const pe in j)j[pe].isChildOf(ee.tileID)&&delete j[pe]}}for(const $ in this._tiles)j[$]||(this._coveredTiles[$]=!0)}}for(const P in E)this._tiles[P].clearFadeHold();const C=a.keysDifference(this._tiles,E);for(const P of C){const B=this._tiles[P];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const o={},f={},g=Math.max(n-Ye.maxOverzooming,this._source.minzoom),x=Math.max(n+Ye.maxUnderzooming,this._source.minzoom),E={};for(const C of t){const P=this._addTile(C);o[C.key]=C,P.hasData()||n<this._source.maxzoom&&(E[C.key]=C)}this._retainLoadedChildren(E,n,x,o);for(const C of t){let P=this._tiles[C.key];if(P.hasData())continue;if(n+1>this._source.maxzoom){const U=C.children(this._source.maxzoom)[0],j=this.getTile(U);if(j&&j.hasData()){o[U.key]=U;continue}}else{const U=C.children(this._source.maxzoom);if(o[U[0].key]&&o[U[1].key]&&o[U[2].key]&&o[U[3].key])continue}let B=P.wasRequested();for(let U=C.overscaledZ-1;U>=g;--U){const j=C.scaledTo(U);if(f[j.key]||(f[j.key]=!0,P=this.getTile(j),!P&&B&&(P=this._addTile(j)),P&&(o[j.key]=j,B=P.wasRequested(),P.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let o,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){o=this._loadedParentTiles[f.key];break}n.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(o=this._getLoadedTile(g),o)break;f=g}for(const g of n)this._loadedParentTiles[g]=o}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const o=n;return n||(n=new ti(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,o||this._source.fire(new a.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const o=n.getExpiryTimeout();o&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},o))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,o){const f=[],g=this.transform;if(!g)return f;const x=o?g.getCameraQueryGeometry(t):t,E=t.map($=>g.pointCoordinate($,this.terrain)),C=x.map($=>g.pointCoordinate($,this.terrain)),P=this.getIds();let B=1/0,U=1/0,j=-1/0,ie=-1/0;for(const $ of C)B=Math.min(B,$.x),U=Math.min(U,$.y),j=Math.max(j,$.x),ie=Math.max(ie,$.y);for(let $=0;$<P.length;$++){const ee=this._tiles[P[$]];if(ee.holdingForFade())continue;const pe=ee.tileID,ve=Math.pow(2,g.zoom-ee.tileID.overscaledZ),Ie=n*ee.queryPadding*a.EXTENT/ee.tileSize/ve,ne=[pe.getTilePoint(new a.MercatorCoordinate(B,U)),pe.getTilePoint(new a.MercatorCoordinate(j,ie))];if(ne[0].x-Ie<a.EXTENT&&ne[0].y-Ie<a.EXTENT&&ne[1].x+Ie>=0&&ne[1].y+Ie>=0){const Ae=E.map(Re=>pe.getTilePoint(Re)),Ee=C.map(Re=>pe.getTilePoint(Re));f.push({tile:ee,tileID:pe,queryGeometry:Ae,cameraQueryGeometry:Ee,scale:ve})}}return f}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(o=>this._tiles[o].tileID);for(const o of n)o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(He(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(t,n,o){this._state.updateState(t=t||"_geojsonTileLayer",n,o)}removeFeatureState(t,n,o){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,o)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,o){const f=this._tiles[t];f&&f.setDependencies(n,o)}reloadTilesForDependencies(t,n){for(const o in this._tiles)this._tiles[o].hasDependency(t,n)&&this._reloadTile(o,"reloading");this._cache.filter(o=>!o.hasDependency(t,n))}}function Zt(u,t){const n=Math.abs(2*u.wrap)-+(u.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||o-n||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function He(u){return u==="raster"||u==="image"||u==="video"}Ye.maxOverzooming=10,Ye.maxUnderzooming=3;const ii="mapboxgl_preloaded_worker_pool";class Ri{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ri.workerCount;)this.workers.push(new Worker(Wn.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ii]}numActive(){return Object.keys(this.active).length}}const br=Math.floor(a.exported.hardwareConcurrency/2);let Hi;function Kr(){return Hi||(Hi=new Ri),Hi}function Jr(u,t){const n={};for(const o in u)o!=="ref"&&(n[o]=u[o]);return a.refProperties.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Yr(u){u=u.slice();const t=Object.create(null);for(let n=0;n<u.length;n++)t[u[n].id]=u[n];for(let n=0;n<u.length;n++)"ref"in u[n]&&(u[n]=Jr(u[n],t[u[n].ref]));return u}Ri.workerCount=Math.max(Math.min(br,6),1);const ai={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $e(u,t,n){n.push({command:ai.addSource,args:[u,t[u]]})}function Xi(u,t,n){t.push({command:ai.removeSource,args:[u]}),n[u]=!0}function Mr(u,t,n,o){Xi(u,n,o),$e(u,t,n)}function Sa(u,t,n){let o;for(o in u[n])if(Object.prototype.hasOwnProperty.call(u[n],o)&&o!=="data"&&!M(u[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!M(u[n][o],t[n][o]))return!1;return!0}function mn(u,t,n,o,f,g){let x;for(x in t=t||{},u=u||{})Object.prototype.hasOwnProperty.call(u,x)&&(M(u[x],t[x])||n.push({command:g,args:[o,x,t[x],f]}));for(x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(u,x)&&(M(u[x],t[x])||n.push({command:g,args:[o,x,t[x],f]}))}function gn(u){return u.id}function na(u,t){return u[t.id]=t,u}class _n{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let n=1,o=this._distances[n];const f=t*this.paddedLength+this.padding;for(;o<f&&n<this._distances.length;)o=this._distances[++n];const g=n-1,x=this._distances[g],E=o-x,C=E>0?(f-x)/E:0;return this.points[g].mult(1-C).add(this.points[n].mult(C))}}function Fe(u,t){let n=!0;return u==="always"||u!=="never"&&t!=="never"||(n=!1),n}class ht{constructor(t,n,o){const f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/o),this.yCellCount=Math.ceil(n/o);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,o,f,g){this._forEachCell(n,o,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(t,n,o,f){this._forEachCell(n-f,o-f,n+f,o+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(o),this.circles.push(f)}_insertBoxCell(t,n,o,f,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,n,o,f,g,x){this.circleCells[g].push(x)}_query(t,n,o,f,g,x,E){if(o<0||t>this.width||f<0||n>this.height)return[];const C=[];if(t<=0&&n<=0&&this.width<=o&&this.height<=f){if(g)return[{key:null,x1:t,y1:n,x2:o,y2:f}];for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const B=this.circles[3*P],U=this.circles[3*P+1],j=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:B-j,y1:U-j,x2:B+j,y2:U+j})}}else this._forEachCell(t,n,o,f,this._queryCell,C,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},E);return C}query(t,n,o,f){return this._query(t,n,o,f,!1,null)}hitTest(t,n,o,f,g,x){return this._query(t,n,o,f,!0,g,x).length>0}hitTestCircle(t,n,o,f,g){const x=t-o,E=t+o,C=n-o,P=n+o;if(E<0||x>this.width||P<0||C>this.height)return!1;const B=[];return this._forEachCell(x,C,E,P,this._queryCellCircle,B,{hitTest:!0,overlapMode:f,circle:{x:t,y:n,radius:o},seenUids:{box:{},circle:{}}},g),B.length>0}_queryCell(t,n,o,f,g,x,E,C){const{seenUids:P,hitTest:B,overlapMode:U}=E,j=this.boxCells[g];if(j!==null){const $=this.bboxes;for(const ee of j)if(!P.box[ee]){P.box[ee]=!0;const pe=4*ee,ve=this.boxKeys[ee];if(t<=$[pe+2]&&n<=$[pe+3]&&o>=$[pe+0]&&f>=$[pe+1]&&(!C||C(ve))&&(!B||!Fe(U,ve.overlapMode))&&(x.push({key:ve,x1:$[pe],y1:$[pe+1],x2:$[pe+2],y2:$[pe+3]}),B))return!0}}const ie=this.circleCells[g];if(ie!==null){const $=this.circles;for(const ee of ie)if(!P.circle[ee]){P.circle[ee]=!0;const pe=3*ee,ve=this.circleKeys[ee];if(this._circleAndRectCollide($[pe],$[pe+1],$[pe+2],t,n,o,f)&&(!C||C(ve))&&(!B||!Fe(U,ve.overlapMode))){const Ie=$[pe],ne=$[pe+1],Ae=$[pe+2];if(x.push({key:ve,x1:Ie-Ae,y1:ne-Ae,x2:Ie+Ae,y2:ne+Ae}),B)return!0}}}return!1}_queryCellCircle(t,n,o,f,g,x,E,C){const{circle:P,seenUids:B,overlapMode:U}=E,j=this.boxCells[g];if(j!==null){const $=this.bboxes;for(const ee of j)if(!B.box[ee]){B.box[ee]=!0;const pe=4*ee,ve=this.boxKeys[ee];if(this._circleAndRectCollide(P.x,P.y,P.radius,$[pe+0],$[pe+1],$[pe+2],$[pe+3])&&(!C||C(ve))&&!Fe(U,ve.overlapMode))return x.push(!0),!0}}const ie=this.circleCells[g];if(ie!==null){const $=this.circles;for(const ee of ie)if(!B.circle[ee]){B.circle[ee]=!0;const pe=3*ee,ve=this.circleKeys[ee];if(this._circlesCollide($[pe],$[pe+1],$[pe+2],P.x,P.y,P.radius)&&(!C||C(ve))&&!Fe(U,ve.overlapMode))return x.push(!0),!0}}}_forEachCell(t,n,o,f,g,x,E,C){const P=this._convertToXCellCoord(t),B=this._convertToYCellCoord(n),U=this._convertToXCellCoord(o),j=this._convertToYCellCoord(f);for(let ie=P;ie<=U;ie++)for(let $=B;$<=j;$++)if(g.call(this,t,n,o,f,this.xCellCount*$+ie,x,E,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,o,f,g,x){const E=f-t,C=g-n,P=o+x;return P*P>E*E+C*C}_circleAndRectCollide(t,n,o,f,g,x,E){const C=(x-f)/2,P=Math.abs(t-(f+C));if(P>C+o)return!1;const B=(E-g)/2,U=Math.abs(n-(g+B));if(U>B+o)return!1;if(P<=C||U<=B)return!0;const j=P-C,ie=U-B;return j*j+ie*ie<=o*o}}function Vn(u,t,n,o,f){const g=a.create();return t?(a.scale(g,g,[1/f,1/f,1]),n||a.rotateZ(g,g,o.angle)):a.multiply(g,o.labelPlaneMatrix,u),g}function Qr(u,t,n,o,f){if(t){const g=a.clone(u);return a.scale(g,g,[f,f,1]),n||a.rotateZ(g,g,-o.angle),g}return o.glCoordMatrix}function oi(u,t,n){let o;n?(o=[u.x,u.y,n(u.x,u.y),1],a.transformMat4(o,o,t)):(o=[u.x,u.y,0,1],yn(o,o,t));const f=o[3];return{point:new a.pointGeometry(o[0]/f,o[1]/f),signedDistanceFromCamera:f}}function jr(u,t){return .5+u/t*.5}function Pr(u,t){const n=u[0]/u[3],o=u[1]/u[3];return n>=-t[0]&&n<=t[0]&&o>=-t[1]&&o<=t[1]}function Lr(u,t,n,o,f,g,x,E,C,P){const B=o?u.textSizeData:u.iconSizeData,U=a.evaluateSizeForZoom(B,n.transform.zoom),j=[256/n.width*2+1,256/n.height*2+1],ie=o?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;ie.clear();const $=u.lineVertexArray,ee=o?u.text.placedSymbolArray:u.icon.placedSymbolArray,pe=n.transform.width/n.transform.height;let ve=!1;for(let Ie=0;Ie<ee.length;Ie++){const ne=ee.get(Ie);if(ne.hidden||ne.writingMode===a.WritingMode.vertical&&!ve){Wt(ne.numGlyphs,ie);continue}let Ae;if(ve=!1,P?(Ae=[ne.anchorX,ne.anchorY,P(ne.anchorX,ne.anchorY),1],a.transformMat4(Ae,Ae,t)):(Ae=[ne.anchorX,ne.anchorY,0,1],yn(Ae,Ae,t)),!Pr(Ae,j)){Wt(ne.numGlyphs,ie);continue}const Ee=jr(n.transform.cameraToCenterDistance,Ae[3]),Re=a.evaluateSizeForFeature(B,U,ne),Be=x?Re/Ee:Re*Ee,Je=new a.pointGeometry(ne.anchorX,ne.anchorY),Pe=oi(Je,f,P).point,yt={},ot=Jt(ne,Be,!1,E,t,f,g,u.glyphOffsetArray,$,ie,Pe,Je,yt,pe,C,P);ve=ot.useVertical,(ot.notEnoughRoom||ve||ot.needsFlipping&&Jt(ne,Be,!0,E,t,f,g,u.glyphOffsetArray,$,ie,Pe,Je,yt,pe,C,P).notEnoughRoom)&&Wt(ne.numGlyphs,ie)}o?u.text.dynamicLayoutVertexBuffer.updateData(ie):u.icon.dynamicLayoutVertexBuffer.updateData(ie)}function An(u,t,n,o,f,g,x,E,C,P,B,U,j){const ie=E.glyphStartIndex+E.numGlyphs,$=E.lineStartIndex,ee=E.lineStartIndex+E.lineLength,pe=t.getoffsetX(E.glyphStartIndex),ve=t.getoffsetX(ie-1),Ie=hr(u*pe,n,o,f,g,x,E.segment,$,ee,C,P,B,U,j);if(!Ie)return null;const ne=hr(u*ve,n,o,f,g,x,E.segment,$,ee,C,P,B,U,j);return ne?{first:Ie,last:ne}:null}function st(u,t,n,o){return u===a.WritingMode.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*o?{useVertical:!0}:(u===a.WritingMode.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Jt(u,t,n,o,f,g,x,E,C,P,B,U,j,ie,$,ee){const pe=t/24,ve=u.lineOffsetX*pe,Ie=u.lineOffsetY*pe;let ne;if(u.numGlyphs>1){const Ae=u.glyphStartIndex+u.numGlyphs,Ee=u.lineStartIndex,Re=u.lineStartIndex+u.lineLength,Be=An(pe,E,ve,Ie,n,B,U,u,C,g,j,$,ee);if(!Be)return{notEnoughRoom:!0};const Je=oi(Be.first.point,x,ee).point,Pe=oi(Be.last.point,x,ee).point;if(o&&!n){const yt=st(u.writingMode,Je,Pe,ie);if(yt)return yt}ne=[Be.first];for(let yt=u.glyphStartIndex+1;yt<Ae-1;yt++)ne.push(hr(pe*E.getoffsetX(yt),ve,Ie,n,B,U,u.segment,Ee,Re,C,g,j,$,ee));ne.push(Be.last)}else{if(o&&!n){const Ee=oi(U,f,ee).point,Re=u.lineStartIndex+u.segment+1,Be=new a.pointGeometry(C.getx(Re),C.gety(Re)),Je=oi(Be,f,ee),Pe=Je.signedDistanceFromCamera>0?Je.point:Ht(U,Be,Ee,1,f,ee),yt=st(u.writingMode,Ee,Pe,ie);if(yt)return yt}const Ae=hr(pe*E.getoffsetX(u.glyphStartIndex),ve,Ie,n,B,U,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,C,g,j,$,ee);if(!Ae)return{notEnoughRoom:!0};ne=[Ae]}for(const Ae of ne)a.addDynamicAttributes(P,Ae.point,Ae.angle);return{}}function Ht(u,t,n,o,f,g){const x=oi(u.add(u.sub(t)._unit()),f,g).point,E=n.sub(x);return n.add(E._mult(o/E.mag()))}function hr(u,t,n,o,f,g,x,E,C,P,B,U,j,ie){const $=o?u-t:u+t;let ee=$>0?1:-1,pe=0;o&&(ee*=-1,pe=Math.PI),ee<0&&(pe+=Math.PI);let ve=ee>0?E+x:E+x+1,Ie=f,ne=f,Ae=0,Ee=0;const Re=Math.abs($),Be=[];for(;Ae+Ee<=Re;){if(ve+=ee,ve<E||ve>=C)return null;if(ne=Ie,Be.push(Ie),Ie=U[ve],Ie===void 0){const bt=new a.pointGeometry(P.getx(ve),P.gety(ve)),Kt=oi(bt,B,ie);if(Kt.signedDistanceFromCamera>0)Ie=U[ve]=Kt.point;else{const Qt=ve-ee;Ie=Ht(Ae===0?g:new a.pointGeometry(P.getx(Qt),P.gety(Qt)),bt,ne,Re-Ae+1,B,ie)}}Ae+=Ee,Ee=ne.dist(Ie)}const Je=(Re-Ae)/Ee,Pe=Ie.sub(ne),yt=Pe.mult(Je)._add(ne);yt._add(Pe._unit()._perp()._mult(n*ee));const ot=pe+Math.atan2(Ie.y-ne.y,Ie.x-ne.x);return Be.push(yt),{point:yt,angle:j?ot:0,path:Be}}const Dn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wt(u,t){for(let n=0;n<u;n++){const o=t.length;t.resize(o+4),t.float32.set(Dn,3*o)}}function yn(u,t,n){const o=t[0],f=t[1];return u[0]=n[0]*o+n[4]*f+n[12],u[1]=n[1]*o+n[5]*f+n[13],u[3]=n[3]*o+n[7]*f+n[15],u}const rr=100;class aa{constructor(t,n=new ht(t.width+200,t.height+200,25),o=new ht(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=o,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+rr,this.screenBottomBoundary=t.height+rr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,o,f,g,x){const E=this.projectAndGetPerspectiveRatio(f,t.anchorPointX,t.anchorPointY,x),C=o*E.perspectiveRatio,P=t.x1*C+E.point.x,B=t.y1*C+E.point.y,U=t.x2*C+E.point.x,j=t.y2*C+E.point.y;return!this.isInsideGrid(P,B,U,j)||n!=="always"&&this.grid.hitTest(P,B,U,j,n,g)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[P,B,U,j],offscreen:this.isOffscreen(P,B,U,j)}}placeCollisionCircles(t,n,o,f,g,x,E,C,P,B,U,j,ie,$){const ee=[],pe=new a.pointGeometry(n.anchorX,n.anchorY),ve=oi(pe,x,$),Ie=jr(this.transform.cameraToCenterDistance,ve.signedDistanceFromCamera),ne=(B?g/Ie:g*Ie)/a.ONE_EM,Ae=oi(pe,E,$).point,Ee=An(ne,f,n.lineOffsetX*ne,n.lineOffsetY*ne,!1,Ae,pe,n,o,E,{},!1,$);let Re=!1,Be=!1,Je=!0;if(Ee){const Pe=.5*j*Ie+ie,yt=new a.pointGeometry(-100,-100),ot=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),bt=new _n,Kt=Ee.first,Qt=Ee.last;let Lt=[];for(let si=Kt.path.length-1;si>=1;si--)Lt.push(Kt.path[si]);for(let si=1;si<Qt.path.length;si++)Lt.push(Qt.path[si]);const ki=2.5*Pe;if(C){const si=Lt.map(ui=>oi(ui,C,$));Lt=si.some(ui=>ui.signedDistanceFromCamera<=0)?[]:si.map(ui=>ui.point)}let Ii=[];if(Lt.length>0){const si=Lt[0].clone(),ui=Lt[0].clone();for(let Ti=1;Ti<Lt.length;Ti++)si.x=Math.min(si.x,Lt[Ti].x),si.y=Math.min(si.y,Lt[Ti].y),ui.x=Math.max(ui.x,Lt[Ti].x),ui.y=Math.max(ui.y,Lt[Ti].y);Ii=si.x>=yt.x&&ui.x<=ot.x&&si.y>=yt.y&&ui.y<=ot.y?[Lt]:ui.x<yt.x||si.x>ot.x||ui.y<yt.y||si.y>ot.y?[]:a.clipLine([Lt],yt.x,yt.y,ot.x,ot.y)}for(const si of Ii){bt.reset(si,.25*Pe);let ui=0;ui=bt.length<=.5*Pe?1:Math.ceil(bt.paddedLength/ki)+1;for(let Ti=0;Ti<ui;Ti++){const ar=Ti/Math.max(ui-1,1),hn=bt.lerp(ar),en=hn.x+rr,dn=hn.y+rr;ee.push(en,dn,Pe,0);const Bn=en-Pe,Xr=dn-Pe,Ar=en+Pe,bn=dn+Pe;if(Je=Je&&this.isOffscreen(Bn,Xr,Ar,bn),Be=Be||this.isInsideGrid(Bn,Xr,Ar,bn),t!=="always"&&this.grid.hitTestCircle(en,dn,Pe,t,U)&&(Re=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Re}}}}return{circles:!P&&Re||!Be||Ie<this.perspectiveRatioCutoff?[]:ee,offscreen:Je,collisionDetected:Re}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let o=1/0,f=1/0,g=-1/0,x=-1/0;for(const B of t){const U=new a.pointGeometry(B.x+rr,B.y+rr);o=Math.min(o,U.x),f=Math.min(f,U.y),g=Math.max(g,U.x),x=Math.max(x,U.y),n.push(U)}const E=this.grid.query(o,f,g,x).concat(this.ignoredGrid.query(o,f,g,x)),C={},P={};for(const B of E){const U=B.key;if(C[U.bucketInstanceId]===void 0&&(C[U.bucketInstanceId]={}),C[U.bucketInstanceId][U.featureIndex])continue;const j=[new a.pointGeometry(B.x1,B.y1),new a.pointGeometry(B.x2,B.y1),new a.pointGeometry(B.x2,B.y2),new a.pointGeometry(B.x1,B.y2)];a.polygonIntersectsPolygon(n,j)&&(C[U.bucketInstanceId][U.featureIndex]=!0,P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]=[]),P[U.bucketInstanceId].push(U.featureIndex))}return P}insertCollisionBox(t,n,o,f,g,x){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:x,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,o,f,g,x){const E=o?this.ignoredGrid:this.grid,C={bucketInstanceId:f,featureIndex:g,collisionGroupID:x,overlapMode:n};for(let P=0;P<t.length;P+=4)E.insertCircle(C,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,n,o,f){let g;return f?(g=[n,o,f(n,o),1],a.transformMat4(g,g,t)):(g=[n,o,0,1],yn(g,g,t)),{point:new a.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+rr,(-g[1]/g[3]+1)/2*this.transform.height+rr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,n,o,f){return o<rr||t>=this.screenRightBoundary||f<rr||n>this.screenBottomBoundary}isInsideGrid(t,n,o,f){return o>=0&&t<this.gridRightBoundary&&f>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}function Ki(u,t,n){return t*(a.EXTENT/(u.tileSize*Math.pow(2,n-u.tileID.overscaledZ)))}class wr{constructor(t,n,o,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):f&&o?1:0,this.placed=o}isHidden(){return this.opacity===0&&!this.placed}}class Ei{constructor(t,n,o,f,g){this.text=new wr(t?t.text:null,n,o,g),this.icon=new wr(t?t.icon:null,n,f,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sa{constructor(t,n,o){this.text=t,this.icon=n,this.skipFade=o}}class ln{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Un{constructor(t,n,o,f,g){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=o,this.bucketIndex=f,this.tileID=g}}class Nn{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:o=>o.collisionGroupID===n}}return this.collisionGroups[t]}}function oa(u,t,n,o,f){const{horizontalAlign:g,verticalAlign:x}=a.getAnchorAlignment(u),E=-(g-.5)*t,C=-(x-.5)*n,P=a.evaluateVariableOffset(u,o);return new a.pointGeometry(E+P[0]*f,C+P[1]*f)}function qn(u,t,n,o,f,g){const{x1:x,x2:E,y1:C,y2:P,anchorPointX:B,anchorPointY:U}=u,j=new a.pointGeometry(t,n);return o&&j._rotate(f?g:-g),{x1:x+j.x,y1:C+j.y,x2:E+j.x,y2:P+j.y,anchorPointX:B,anchorPointY:U}}class J{constructor(t,n,o,f,g){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new aa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Nn(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,o,f){const g=o.getBucket(n),x=o.latestFeatureIndex;if(!g||!x||n.id!==g.layerIds[0])return;const E=o.collisionBoxArray,C=g.layers[0].layout,P=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),B=o.tileSize/a.EXTENT,U=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),j=C.get("text-pitch-alignment")==="map",ie=C.get("text-rotation-alignment")==="map",$=Ki(o,1,this.transform.zoom),ee=Vn(U,j,ie,this.transform,$);let pe=null;if(j){const Ie=Qr(U,j,ie,this.transform,$);pe=a.multiply([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[g.bucketInstanceId]=new Un(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,o.tileID);const ve={bucket:g,layout:C,posMatrix:U,textLabelPlaneMatrix:ee,labelToScreenMatrix:pe,scale:P,textPixelRatio:B,holdingForFade:o.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(f)for(const Ie of g.sortKeyRanges){const{sortKey:ne,symbolInstanceStart:Ae,symbolInstanceEnd:Ee}=Ie;t.push({sortKey:ne,symbolInstanceStart:Ae,symbolInstanceEnd:Ee,parameters:ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(t,n,o,f,g,x,E,C,P,B,U,j,ie,$,ee,pe){const ve=[j.textOffset0,j.textOffset1],Ie=oa(t,o,f,ve,g),ne=this.collisionIndex.placeCollisionBox(qn(n,Ie.x,Ie.y,x,E,this.transform.angle),U,C,P,B.predicate,pe);if((!ee||this.collisionIndex.placeCollisionBox(qn(ee,Ie.x,Ie.y,x,E,this.transform.angle),U,C,P,B.predicate,pe).box.length!==0)&&ne.box.length>0){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ve,width:o,height:f,anchor:t,textBoxScale:g,prevAnchor:Ae},this.markUsedJustification(ie,t,j,$),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,$,j),this.placedOrientations[j.crossTileID]=$),{shift:Ie,placedGlyphBoxes:ne}}}placeLayerBucketPart(t,n,o){const{bucket:f,layout:g,posMatrix:x,textLabelPlaneMatrix:E,labelToScreenMatrix:C,textPixelRatio:P,holdingForFade:B,collisionBoxArray:U,partiallyEvaluatedTextSize:j,collisionGroup:ie}=t.parameters,$=g.get("text-optional"),ee=g.get("icon-optional"),pe=a.getOverlapMode(g,"text-overlap","text-allow-overlap"),ve=pe==="always",Ie=a.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),ne=Ie==="always",Ae=g.get("text-rotation-alignment")==="map",Ee=g.get("text-pitch-alignment")==="map",Re=g.get("icon-text-fit")!=="none",Be=g.get("symbol-z-order")==="viewport-y",Je=ve&&(ne||!f.hasIconData()||ee),Pe=ne&&(ve||!f.hasTextData()||$);!f.collisionArrays&&U&&f.deserializeCollisionBoxes(U);const yt=(ot,bt)=>{if(n[ot.crossTileID])return;if(B)return void(this.placements[ot.crossTileID]=new sa(!1,!1,!1));let Kt=!1,Qt=!1,Lt=!0,ki=null,Ii={box:null,offscreen:null},si={box:null,offscreen:null},ui=null,Ti=null,ar=null,hn=0,en=0,dn=0;bt.textFeatureIndex?hn=bt.textFeatureIndex:ot.useRuntimeCollisionCircles&&(hn=ot.featureIndex),bt.verticalTextFeatureIndex&&(en=bt.verticalTextFeatureIndex);const Bn=this.retainedQueryData[f.bucketInstanceId].tileID,Xr=this.terrain?(er,ei)=>this.terrain.getElevation(Bn,er,ei):null;for(const er of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const ei=bt[er];ei&&(ei.elevation=Xr?Xr(ei.anchorPointX,ei.anchorPointY):0)}const Ar=bt.textBox;if(Ar){const er=xi=>{let sr=a.WritingMode.horizontal;if(f.allowVerticalPlacement&&!xi&&this.prevPlacement){const or=this.prevPlacement.placedOrientations[ot.crossTileID];or&&(this.placedOrientations[ot.crossTileID]=or,sr=or,this.markUsedOrientation(f,sr,ot))}return sr},ei=(xi,sr)=>{if(f.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&bt.verticalTextBox){for(const or of f.writingModes)if(or===a.WritingMode.vertical?(Ii=sr(),si=Ii):Ii=xi(),Ii&&Ii.box&&Ii.box.length)break}else Ii=xi()};if(g.get("text-variable-anchor")){let xi=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ot.crossTileID]){const Ui=this.prevPlacement.variableOffsets[ot.crossTileID];xi.indexOf(Ui.anchor)>0&&(xi=xi.filter(Wr=>Wr!==Ui.anchor),xi.unshift(Ui.anchor))}const sr=(Ui,Wr,Hn)=>{const yo=Ui.x2-Ui.x1,xa=Ui.y2-Ui.y1,Al=ot.textBoxScale,vo=Re&&Ie==="never"?Wr:null;let Fn={box:[],offscreen:!1};const Kn=pe!=="never"?2*xi.length:xi.length;for(let Jn=0;Jn<Kn;++Jn){const Is=this.attemptAnchorPlacement(xi[Jn%xi.length],Ui,yo,xa,Al,Ae,Ee,P,x,ie,Jn>=xi.length?pe:"never",ot,f,Hn,vo,Xr);if(Is&&(Fn=Is.placedGlyphBoxes,Fn&&Fn.box&&Fn.box.length)){Kt=!0,ki=Is.shift;break}}return Fn};ei(()=>sr(Ar,bt.iconBox,a.WritingMode.horizontal),()=>{const Ui=bt.verticalTextBox;return f.allowVerticalPlacement&&!(Ii&&Ii.box&&Ii.box.length)&&ot.numVerticalGlyphVertices>0&&Ui?sr(Ui,bt.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),Ii&&(Kt=Ii.box,Lt=Ii.offscreen);const or=er(Ii&&Ii.box);if(!Kt&&this.prevPlacement){const Ui=this.prevPlacement.variableOffsets[ot.crossTileID];Ui&&(this.variableOffsets[ot.crossTileID]=Ui,this.markUsedJustification(f,Ui.anchor,ot,or))}}else{const xi=(sr,or)=>{const Ui=this.collisionIndex.placeCollisionBox(sr,pe,P,x,ie.predicate,Xr);return Ui&&Ui.box&&Ui.box.length&&(this.markUsedOrientation(f,or,ot),this.placedOrientations[ot.crossTileID]=or),Ui};ei(()=>xi(Ar,a.WritingMode.horizontal),()=>{const sr=bt.verticalTextBox;return f.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&sr?xi(sr,a.WritingMode.vertical):{box:null,offscreen:null}}),er(Ii&&Ii.box&&Ii.box.length)}}if(ui=Ii,Kt=ui&&ui.box&&ui.box.length>0,Lt=ui&&ui.offscreen,ot.useRuntimeCollisionCircles){const er=f.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex),ei=a.evaluateSizeForFeature(f.textSizeData,j,er),xi=g.get("text-padding");Ti=this.collisionIndex.placeCollisionCircles(pe,er,f.lineVertexArray,f.glyphOffsetArray,ei,x,E,C,o,Ee,ie.predicate,ot.collisionCircleDiameter,xi,Xr),Ti.circles.length&&Ti.collisionDetected&&!o&&a.warnOnce("Collisions detected, but collision boxes are not shown"),Kt=ve||Ti.circles.length>0&&!Ti.collisionDetected,Lt=Lt&&Ti.offscreen}if(bt.iconFeatureIndex&&(dn=bt.iconFeatureIndex),bt.iconBox){const er=ei=>{const xi=Re&&ki?qn(ei,ki.x,ki.y,Ae,Ee,this.transform.angle):ei;return this.collisionIndex.placeCollisionBox(xi,Ie,P,x,ie.predicate,Xr)};si&&si.box&&si.box.length&&bt.verticalIconBox?(ar=er(bt.verticalIconBox),Qt=ar.box.length>0):(ar=er(bt.iconBox),Qt=ar.box.length>0),Lt=Lt&&ar.offscreen}const bn=$||ot.numHorizontalGlyphVertices===0&&ot.numVerticalGlyphVertices===0,ks=ee||ot.numIconVertices===0;if(bn||ks?ks?bn||(Qt=Qt&&Kt):Kt=Qt&&Kt:Qt=Kt=Qt&&Kt,Kt&&ui&&ui.box&&this.collisionIndex.insertCollisionBox(ui.box,pe,g.get("text-ignore-placement"),f.bucketInstanceId,si&&si.box&&en?en:hn,ie.ID),Qt&&ar&&this.collisionIndex.insertCollisionBox(ar.box,Ie,g.get("icon-ignore-placement"),f.bucketInstanceId,dn,ie.ID),Ti&&(Kt&&this.collisionIndex.insertCollisionCircles(Ti.circles,pe,g.get("text-ignore-placement"),f.bucketInstanceId,hn,ie.ID),o)){const er=f.bucketInstanceId;let ei=this.collisionCircleArrays[er];ei===void 0&&(ei=this.collisionCircleArrays[er]=new ln);for(let xi=0;xi<Ti.circles.length;xi+=4)ei.circles.push(Ti.circles[xi+0]),ei.circles.push(Ti.circles[xi+1]),ei.circles.push(Ti.circles[xi+2]),ei.circles.push(Ti.collisionDetected?1:0)}if(ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ot.crossTileID]=new sa(Kt||Je,Qt||Pe,Lt||f.justReloaded),n[ot.crossTileID]=!0};if(Be){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ot=f.getSortedSymbolIndexes(this.transform.angle);for(let bt=ot.length-1;bt>=0;--bt){const Kt=ot[bt];yt(f.symbolInstances.get(Kt),f.collisionArrays[Kt])}}else for(let ot=t.symbolInstanceStart;ot<t.symbolInstanceEnd;ot++)yt(f.symbolInstances.get(ot),f.collisionArrays[ot]);if(o&&f.bucketInstanceId in this.collisionCircleArrays){const ot=this.collisionCircleArrays[f.bucketInstanceId];a.invert(ot.invProjMatrix,x),ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(t,n,o,f){let g;g=f===a.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(n)];const x=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];for(const E of x)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=g>=0&&E!==g?0:o.crossTileID)}markUsedOrientation(t,n,o){const f=n===a.WritingMode.horizontal||n===a.WritingMode.horizontalOnly?n:0,g=n===a.WritingMode.vertical?n:0,x=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];for(const E of x)t.text.placedSymbolArray.get(E).placedOrientation=f;o.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let o=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const f=n?n.symbolFadeChange(t):1,g=n?n.opacities:{},x=n?n.variableOffsets:{},E=n?n.placedOrientations:{};for(const C in this.placements){const P=this.placements[C],B=g[C];B?(this.opacities[C]=new Ei(B,f,P.text,P.icon),o=o||P.text!==B.text.placed||P.icon!==B.icon.placed):(this.opacities[C]=new Ei(null,f,P.text,P.icon,P.skipFade),o=o||P.text||P.icon)}for(const C in g){const P=g[C];if(!this.opacities[C]){const B=new Ei(P,f,!1,!1);B.isHidden()||(this.opacities[C]=B,o=o||P.text.placed||P.icon.placed)}}for(const C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");o?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const o={};for(const f of n){const g=f.getBucket(t);g&&f.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,o,f.collisionBoxArray)}}updateBucketOpacities(t,n,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const f=t.layers[0].layout,g=new Ei(null,0,!1,!1,!0),x=f.get("text-allow-overlap"),E=f.get("icon-allow-overlap"),C=f.get("text-variable-anchor"),P=f.get("text-rotation-alignment")==="map",B=f.get("text-pitch-alignment")==="map",U=f.get("icon-text-fit")!=="none",j=new Ei(null,0,x&&(E||!t.hasIconData()||f.get("icon-optional")),E&&(x||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const ie=($,ee,pe)=>{for(let ve=0;ve<ee/4;ve++)$.opacityVertexArray.emplaceBack(pe)};for(let $=0;$<t.symbolInstances.length;$++){const ee=t.symbolInstances.get($),{numHorizontalGlyphVertices:pe,numVerticalGlyphVertices:ve,crossTileID:Ie}=ee;let ne=this.opacities[Ie];n[Ie]?ne=g:ne||(ne=j,this.opacities[Ie]=ne),n[Ie]=!0;const Ae=ee.numIconVertices>0,Ee=this.placedOrientations[ee.crossTileID],Re=Ee===a.WritingMode.vertical,Be=Ee===a.WritingMode.horizontal||Ee===a.WritingMode.horizontalOnly;if(pe>0||ve>0){const Je=ye(ne.text);ie(t.text,pe,Re?Me:Je),ie(t.text,ve,Be?Me:Je);const Pe=ne.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(bt=>{bt>=0&&(t.text.placedSymbolArray.get(bt).hidden=Pe||Re?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Pe||Be?1:0);const yt=this.variableOffsets[ee.crossTileID];yt&&this.markUsedJustification(t,yt.anchor,ee,Ee);const ot=this.placedOrientations[ee.crossTileID];ot&&(this.markUsedJustification(t,"left",ee,ot),this.markUsedOrientation(t,ot,ee))}if(Ae){const Je=ye(ne.icon),Pe=!(U&&ee.verticalPlacedIconSymbolIndex&&Re);ee.placedIconSymbolIndex>=0&&(ie(t.icon,ee.numIconVertices,Pe?Je:Me),t.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ne.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(ie(t.icon,ee.numVerticalIconVertices,Pe?Me:Je),t.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Je=t.collisionArrays[$];if(Je){let Pe=new a.pointGeometry(0,0);if(Je.textBox||Je.verticalTextBox){let ot=!0;if(C){const bt=this.variableOffsets[Ie];bt?(Pe=oa(bt.anchor,bt.width,bt.height,bt.textOffset,bt.textBoxScale),P&&Pe._rotate(B?this.transform.angle:-this.transform.angle)):ot=!1}Je.textBox&&L(t.textCollisionBox.collisionVertexArray,ne.text.placed,!ot||Re,Pe.x,Pe.y),Je.verticalTextBox&&L(t.textCollisionBox.collisionVertexArray,ne.text.placed,!ot||Be,Pe.x,Pe.y)}const yt=!!(!Be&&Je.verticalIconBox);Je.iconBox&&L(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,yt,U?Pe.x:0,U?Pe.y:0),Je.verticalIconBox&&L(t.iconCollisionBox.collisionVertexArray,ne.icon.placed,!yt,U?Pe.x:0,U?Pe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=$.invProjMatrix,t.placementViewportMatrix=$.viewportMatrix,t.collisionCircleArray=$.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const o=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*o>t}setStale(){this.stale=!0}}function L(u,t,n,o,f){u.emplaceBack(t?1:0,n?1:0,o||0,f||0),u.emplaceBack(t?1:0,n?1:0,o||0,f||0),u.emplaceBack(t?1:0,n?1:0,o||0,f||0),u.emplaceBack(t?1:0,n?1:0,o||0,f||0)}const V=Math.pow(2,25),H=Math.pow(2,24),K=Math.pow(2,17),ce=Math.pow(2,16),ge=Math.pow(2,9),fe=Math.pow(2,8),ue=Math.pow(2,1);function ye(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,n=Math.floor(127*u.opacity);return n*V+t*H+n*K+t*ce+n*ge+t*fe+n*ue+t}const Me=0;class Xe{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,o,f,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(x,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<x.length;)if(n.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,g())return!0;return!1}}class ze{constructor(t,n,o,f,g,x,E,C){this.placement=new J(t,n,x,E,C),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,n,o){const f=a.exported.now(),g=()=>{const x=a.exported.now()-f;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=n[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=E)&&(!x.maxzoom||x.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Xe(x)),this._inProgressLayer.continuePlacement(o[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const It=512/a.EXTENT/2;class St{constructor(t,n,o){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(let f=0;f<n.length;f++){const g=n.get(f),x=g.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,n){const o=It/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*a.EXTENT+t.anchorX)*o),y:Math.floor((n.canonical.y*a.EXTENT+t.anchorY)*o)}}findMatches(t,n,o){const f=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const E=this.indexedSymbolInstances[x.key];if(!E)continue;const C=this.getScaledCoordinates(x,n);for(const P of E)if(Math.abs(P.coord.x-C.x)<=f&&Math.abs(P.coord.y-C.y)<=f&&!o[P.crossTileID]){o[P.crossTileID]=!0,x.crossTileID=P.crossTileID;break}}}}class _t{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ft{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const o in this.indexes){const f=this.indexes[o],g={};for(const x in f){const E=f[x];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+n),g[E.tileID.key]=E}this.indexes[o]=g}this.lng=t}addBucket(t,n,o){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<n.symbolInstances.length;g++)n.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const f=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const E in x){const C=x[E];C.tileID.isChildOf(t)&&C.findMatches(n.symbolInstances,t,f)}else{const E=x[t.scaledTo(Number(g)).key];E&&E.findMatches(n.symbolInstances,t,f)}}for(let g=0;g<n.symbolInstances.length;g++){const x=n.symbolInstances.get(g);x.crossTileID||(x.crossTileID=o.generate(),f[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new St(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const o in n.indexedSymbolInstances)for(const f of n.indexedSymbolInstances[o])delete this.usedCrossTileIDs[t][f.crossTileID]}removeStaleBuckets(t){let n=!1;for(const o in this.indexes){const f=this.indexes[o];for(const g in f)t[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,f[g]),delete f[g],n=!0)}return n}}class jt{constructor(){this.layerIndexes={},this.crossTileIDs=new _t,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,o){let f=this.layerIndexes[t.id];f===void 0&&(f=this.layerIndexes[t.id]=new Ft);let g=!1;const x={};f.handleWrapJump(o);for(const E of n){const C=E.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,C,this.crossTileIDs)&&(g=!0),x[C.bucketInstanceId]=!0)}return f.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const n={};t.forEach(o=>{n[o]=!0});for(const o in this.layerIndexes)n[o]||delete this.layerIndexes[o]}}var li=a.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Xt extends a.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const n=this._tiles[t];n.textures.forEach(o=>o.destroy()),n.textures=[]}}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];for(const o of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))this._renderableTilesKeys.push(o.key),this._tiles[o.key]||(o.posMatrix=new Float64Array(16),a.ortho(o.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[o.key]=new ti(o,this.tileSize))}removeOutdated(t){const n={};this.renderHistory=this.renderHistory.filter((o,f)=>this.renderHistory.indexOf(o)===f).slice(0,this.renderHistorySize);for(const o of this._renderableTilesKeys)n[o]=!0;for(const o of this.renderHistory)n[o]=!0;for(const o in this._tiles)n[o]||(this._tiles[o].clearTextures(t),delete this._tiles[o])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const o of this._renderableTilesKeys){const f=this._tiles[o].tileID;if(f.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),a.ortho(g.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),n[o]=g}else if(f.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=f.canonical.z-t.canonical.z,E=f.canonical.x-(f.canonical.x>>x<<x),C=f.canonical.y-(f.canonical.y>>x<<x),P=a.EXTENT>>x;a.ortho(g.posMatrix,0,P,0,P,0,1),a.translate(g.posMatrix,g.posMatrix,[-E*P,-C*P,0]),n[o]=g}else if(t.canonical.isChildOf(f.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-f.canonical.z,E=t.canonical.x-(t.canonical.x>>x<<x),C=t.canonical.y-(t.canonical.y>>x<<x),P=a.EXTENT>>x;a.ortho(g.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(g.posMatrix,g.posMatrix,[E*P,C*P,0]),a.scale(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),n[o]=g}}return n}getSourceTile(t,n){const o=this.sourceCache._source;let f=t.overscaledZ-this.deltaZoom;if(f>o.maxzoom&&(f=o.maxzoom),f<o.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(f).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&n)for(;f>=o.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(f--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeLoaded>=t)}}class Yt{constructor(t,n,o){this.style=t,this.sourceCache=new Xt(n),this.options=o,this.exaggeration=typeof o.exaggeration=="number"?o.exaggeration:1,this.elevationOffset=typeof o.elevationOffset=="number"?o.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,n,o,f=a.EXTENT){if(!(n>=0&&n<f&&o>=0&&o<f))return this.elevationOffset;let g=0;const x=this.getTerrainData(t);if(x.tile&&x.tile.dem){const E=a.transformMat4$1([],[n/f*a.EXTENT,o/f*a.EXTENT],x.u_terrain_matrix),C=[E[0]*x.tile.dem.dim,E[1]*x.tile.dem.dim],P=[Math.floor(C[0]),Math.floor(C[1])],B=x.tile.dem.get(P[0],P[1]),U=x.tile.dem.get(P[0],P[1]+1),j=x.tile.dem.get(P[0]+1,P[1]),ie=x.tile.dem.get(P[0]+1,P[1]+1);g=a.number(a.number(B,U,C[0]-P[0]),a.number(j,ie,C[0]-P[0]),C[1]-P[1])}return g}rememberForRerender(t,n){for(const o in this.sourceCache._tiles){const f=this.sourceCache._tiles[o];(f.tileID.equals(n)||f.tileID.isChildOf(n))&&(t===this.sourceCache.sourceCache.id&&(f.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][f.tileID.key]=!0)}}needsRerender(t,n){return this._rerender[t]&&this._rerender[t][n.key]}clearRerenderCache(){this._rerender={}}getElevation(t,n,o,f=a.EXTENT){return(this.getDEMElevation(t,n,o,f)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const f=this.style.map.painter.context,g=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new G(f,g,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new G(f,new a.RGBAImage({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const f=this.style.map.painter.context;n.demTexture=this.style.map.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new G(f,n.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),n.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const o=n&&n+n.tileID.key+t.key;if(o&&!this._demMatrixCache[o]){const f=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=f?g=t.canonical.z-f:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),E=t.canonical.y-(t.canonical.y>>g<<g),C=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<g),1/(a.EXTENT<<g),0]);a.translate(C,C,[x*a.EXTENT,E*a.EXTENT,0]),this._demMatrixCache[t.key]={matrix:C,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:o?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const n=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(n,n,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,n,n))}return this._rttFramebuffer}getFramebuffer(t){const n=this.style.map.painter,o=n.width/devicePixelRatio,f=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===o&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new G(n.context,{width:o,height:f,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new G(n.context,{width:o,height:f,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(o,f,!0),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,o,f))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let E=0;E<this._coordsTextureSize;E++,x+=4)n[x+0]=255&E,n[x+1]=255&g,n[x+2]=E>>8<<4|g>>8,n[x+3]=0;const o=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),f=new G(t,o,t.gl.RGBA,{premultiply:!1});return f.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(t){const n=new Uint8Array(4),o=this.style.map.painter,f=o.context,g=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(t.x,o.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,n),f.bindFramebuffer.set(null);const x=n[0]+(n[2]>>4<<8),E=n[1]+((15&n[2])<<8),C=this.coordsIndex[255-n[3]],P=C&&this.sourceCache.getTileByID(C);if(!P)return null;const B=this._coordsTextureSize,U=(1<<P.tileID.canonical.z)*B;return new a.MercatorCoordinate((P.tileID.canonical.x*B+x)/U,(P.tileID.canonical.y*B+E)/U,this.getElevation(P.tileID,x,E,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,n=new a.PosArray,o=new a.TriangleIndexArray,f=this.meshSize,g=a.EXTENT/f,x=f*f;for(let E=0;E<=f;E++)for(let C=0;C<=f;C++)n.emplaceBack(C*g,E*g);for(let E=0;E<x;E+=f+1)for(let C=0;C<f;C++)o.emplaceBack(C+E,f+C+E+1,f+C+E+2),o.emplaceBack(C+E,f+C+E+2,C+E+1);return this._mesh={indexBuffer:t.createIndexBuffer(o),vertexBuffer:t.createVertexBuffer(n,li.members),segments:a.SegmentVector.simpleSegment(0,0,n.length,o.length)},this._mesh}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,o={minElevation:null,maxElevation:null};return n&&n.dem&&(o.minElevation=(n.dem.min+this.elevationOffset)*this.exaggeration,o.maxElevation=(n.dem.max+this.elevationOffset)*this.exaggeration),o}}const ci=(u,t)=>a.emitValidationErrors(u,t&&t.filter(n=>n.identifier!=="source.canvas")),Si=a.pick(ai,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),nr=a.pick(ai,["setCenter","setZoom","setBearing","setPitch"]),Bi=function(){const u={},t=a.spec.$version;for(const n in a.spec.$root){const o=a.spec.$root[n];if(o.required){let f=null;f=n==="version"?t:o.type==="array"?[]:{},f!=null&&(u[n]=f)}}return u}();class pr extends a.Evented{constructor(t,n={}){super(),this.map=t,this.dispatcher=new be(Kr(),this),this.imageManager=new te,this.imageManager.setEventedParent(this),this.glyphManager=new _e(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new de(256,512),this.crossTileSymbolIndex=new jt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const o=this;this._rtlTextPluginCallback=pr.registerForPluginStateChange(f=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(g,x)=>{if(a.triggerPluginCompletionEvent(g),x&&x.every(E=>E))for(const E in o.sourceCaches)o.sourceCaches[E].reload()})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===x.id&&this._validateLayer(C)}})}loadURL(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const o=typeof n.validate!="boolean"||n.validate,f=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(f,(g,x)=>{this._request=null,g?this.fire(new a.ErrorEvent(g)):x&&this._load(x,o)})}loadJSON(t,n={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Bi,!1)}_load(t,n){if(n&&ci(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const f in t.sources)this.addSource(f,t.sources[f],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const o=Yr(this.stylesheet.layers);this._order=o.map(f=>f.id),this._layers={},this._serializedLayers={};for(let f of o)f=a.createStyleLayer(f),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Le(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(n,o,f,g){let x,E,C;const P=f>1?"@2x":"";let B=a.getJSON(o.transformRequest(o.normalizeSpriteURL(n,P,".json"),a.ResourceType.SpriteJSON),(ie,$)=>{B=null,C||(C=ie,x=$,j())}),U=a.getImage(o.transformRequest(o.normalizeSpriteURL(n,P,".png"),a.ResourceType.SpriteImage),(ie,$)=>{U=null,C||(C=ie,E=$,j())});function j(){if(C)g(C);else if(x&&E){const ie=a.exported.getImageData(E),$={};for(const ee in x){const{width:pe,height:ve,x:Ie,y:ne,sdf:Ae,pixelRatio:Ee,stretchX:Re,stretchY:Be,content:Je}=x[ee],Pe=new a.RGBAImage({width:pe,height:ve});a.RGBAImage.copy(ie,Pe,{x:Ie,y:ne},{x:0,y:0},{width:pe,height:ve}),$[ee]={data:Pe,pixelRatio:Ee,sdf:Ae,stretchX:Re,stretchY:Be,content:Je}}g(null,$)}}return{cancel(){B&&(B.cancel(),B=null),U&&(U.cancel(),U=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(n,o)=>{if(this._spriteRequest=null,n)this.fire(new a.ErrorEvent(n));else if(o)for(const f in o)this.imageManager.addImage(f,o[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const o=t.sourceLayer;if(!o)return;const f=n.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(o)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${o}" does not exist on source "${f.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const n=[];for(const o of t){const f=this._layers[o];f.type!=="custom"&&n.push(f.serialize())}return n}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(f.length||g.length)&&this._updateWorkerLayers(f,g);for(const x in this._updatedSources){const E=this._updatedSources[x];if(E==="reload")this._reloadSource(x);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(x)}}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const o={};for(const f in this.sourceCaches){const g=this.sourceCaches[f];o[f]=g.used,g.used=!1}for(const f of this._order){const g=this._layers[f];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const f in o){const g=this.sourceCaches[f];o[f]!==g.used&&g.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const n=this.sourceCaches[t.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new Yt(this,n,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=o=>{o.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=o=>{o.tile&&(o.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(o.sourceId,o.tile.tileID)):o.source.type==="geojson"&&this.terrain.rememberForRerender(o.sourceId,o.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new a.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),ci(this,a.validateStyle(t)))return!1;(t=a.clone$1(t)).layers=Yr(t.layers);const n=function(f,g){if(!f)return[{command:ai.setStyle,args:[g]}];let x=[];try{if(!M(f.version,g.version))return[{command:ai.setStyle,args:[g]}];M(f.center,g.center)||x.push({command:ai.setCenter,args:[g.center]}),M(f.zoom,g.zoom)||x.push({command:ai.setZoom,args:[g.zoom]}),M(f.bearing,g.bearing)||x.push({command:ai.setBearing,args:[g.bearing]}),M(f.pitch,g.pitch)||x.push({command:ai.setPitch,args:[g.pitch]}),M(f.sprite,g.sprite)||x.push({command:ai.setSprite,args:[g.sprite]}),M(f.glyphs,g.glyphs)||x.push({command:ai.setGlyphs,args:[g.glyphs]}),M(f.transition,g.transition)||x.push({command:ai.setTransition,args:[g.transition]}),M(f.light,g.light)||x.push({command:ai.setLight,args:[g.light]});const E={},C=[];(function(B,U,j,ie){let $;for($ in U=U||{},B=B||{})Object.prototype.hasOwnProperty.call(B,$)&&(Object.prototype.hasOwnProperty.call(U,$)||Xi($,j,ie));for($ in U)Object.prototype.hasOwnProperty.call(U,$)&&(Object.prototype.hasOwnProperty.call(B,$)?M(B[$],U[$])||(B[$].type==="geojson"&&U[$].type==="geojson"&&Sa(B,U,$)?j.push({command:ai.setGeoJSONSourceData,args:[$,U[$].data]}):Mr($,U,j,ie)):$e($,U,j))})(f.sources,g.sources,C,E);const P=[];f.layers&&f.layers.forEach(B=>{E[B.source]?x.push({command:ai.removeLayer,args:[B.id]}):P.push(B)}),x=x.concat(C),function(B,U,j){U=U||[];const ie=(B=B||[]).map(gn),$=U.map(gn),ee=B.reduce(na,{}),pe=U.reduce(na,{}),ve=ie.slice(),Ie=Object.create(null);let ne,Ae,Ee,Re,Be,Je,Pe;for(ne=0,Ae=0;ne<ie.length;ne++)Ee=ie[ne],Object.prototype.hasOwnProperty.call(pe,Ee)?Ae++:(j.push({command:ai.removeLayer,args:[Ee]}),ve.splice(ve.indexOf(Ee,Ae),1));for(ne=0,Ae=0;ne<$.length;ne++)Ee=$[$.length-1-ne],ve[ve.length-1-ne]!==Ee&&(Object.prototype.hasOwnProperty.call(ee,Ee)?(j.push({command:ai.removeLayer,args:[Ee]}),ve.splice(ve.lastIndexOf(Ee,ve.length-Ae),1)):Ae++,Je=ve[ve.length-ne],j.push({command:ai.addLayer,args:[pe[Ee],Je]}),ve.splice(ve.length-ne,0,Ee),Ie[Ee]=!0);for(ne=0;ne<$.length;ne++)if(Ee=$[ne],Re=ee[Ee],Be=pe[Ee],!Ie[Ee]&&!M(Re,Be))if(M(Re.source,Be.source)&&M(Re["source-layer"],Be["source-layer"])&&M(Re.type,Be.type)){for(Pe in mn(Re.layout,Be.layout,j,Ee,null,ai.setLayoutProperty),mn(Re.paint,Be.paint,j,Ee,null,ai.setPaintProperty),M(Re.filter,Be.filter)||j.push({command:ai.setFilter,args:[Ee,Be.filter]}),M(Re.minzoom,Be.minzoom)&&M(Re.maxzoom,Be.maxzoom)||j.push({command:ai.setLayerZoomRange,args:[Ee,Be.minzoom,Be.maxzoom]}),Re)Object.prototype.hasOwnProperty.call(Re,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?mn(Re[Pe],Be[Pe],j,Ee,Pe.slice(6),ai.setPaintProperty):M(Re[Pe],Be[Pe])||j.push({command:ai.setLayerProperty,args:[Ee,Pe,Be[Pe]]}));for(Pe in Be)Object.prototype.hasOwnProperty.call(Be,Pe)&&!Object.prototype.hasOwnProperty.call(Re,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?mn(Re[Pe],Be[Pe],j,Ee,Pe.slice(6),ai.setPaintProperty):M(Re[Pe],Be[Pe])||j.push({command:ai.setLayerProperty,args:[Ee,Pe,Be[Pe]]}))}else j.push({command:ai.removeLayer,args:[Ee]}),Je=ve[ve.lastIndexOf(Ee)+1],j.push({command:ai.addLayer,args:[Be,Je]})}(P,g.layers,x)}catch(E){console.warn("Unable to compute style diff:",E),x=[{command:ai.setStyle,args:[g]}]}return x}(this.serialize(),t).filter(f=>!(f.command in nr));if(n.length===0)return!1;const o=n.filter(f=>!(f.command in Si));if(o.length>0)throw new Error(`Unimplemented: ${o.map(f=>f.command).join(", ")}.`);return n.forEach(f=>{f.command!=="setTransition"&&this[f.command].apply(this,f.args)}),this.stylesheet=t,!0}addImage(t,n){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,o={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,n,null,o))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const f=this.sourceCaches[t]=new Ye(t,n,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:f.serialize(),sourceId:t})),f.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const o in this._layers)if(this._layers[o].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${o}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const o=this.sourceCaches[t].getSource();if(o.type!=="geojson")throw new Error(`geojsonSource.type is ${o.type}, which is !== 'geojson`);o.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,o={}){this._checkLoaded();const f=t.id;if(this.getLayer(f))return void this.fire(new a.ErrorEvent(new Error(`Layer "${f}" already exists on this map.`)));let g;if(t.type==="custom"){if(ci(this,a.validateCustomStyleLayer(t)))return;g=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=a.clone$1(t),t=a.extend(t,{source:f})),this._validate(a.validateStyle.layer,`layers.${f}`,t,{arrayIndex:-1},o))return;g=a.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[g.id]=g.serialize()}const x=n?this._order.indexOf(n):this._order.length;if(n&&x===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${f}" before non-existing layer "${n}".`)));else{if(this._order.splice(x,0,f),this._layerOrderChanged=!0,this._layers[f]=g,this._removedLayers[f]&&g.source&&g.type!=="custom"){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const o=this._order.indexOf(t);this._order.splice(o,1);const f=n?this._order.indexOf(n):this._order.length;n&&f===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const o=this._order.indexOf(t);this._order.splice(o,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,o){this._checkLoaded();const f=this.getLayer(t);f?f.minzoom===n&&f.maxzoom===o||(n!=null&&(f.minzoom=n),o!=null&&(f.maxzoom=o),this._updateLayer(f)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,o={}){this._checkLoaded();const f=this.getLayer(t);if(f){if(!M(f.filter,n))return n==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(a.validateStyle.filter,`layers.${f.id}.filter`,n,null,o)||(f.filter=a.clone$1(n),this._updateLayer(f)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return a.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,n,o,f={}){this._checkLoaded();const g=this.getLayer(t);g?M(g.getLayoutProperty(n),o)||(g.setLayoutProperty(n,o,f),this._updateLayer(g)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const o=this.getLayer(t);if(o)return o.getLayoutProperty(n);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,o,f={}){this._checkLoaded();const g=this.getLayer(t);g?M(g.getPaintProperty(n),o)||(g.setPaintProperty(n,o,f)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const o=t.source,f=t.sourceLayer,g=this.sourceCaches[o];if(g===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&f?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||f?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(f,t.id,n)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const o=t.source,f=this.sourceCaches[o];if(f===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)));const g=f.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(x,t.id,n):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,o=t.sourceLayer,f=this.sourceCaches[n];if(f!==void 0)return f.getSource().type!=="vector"||o?(t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),f.getFeatureState(o,t.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=x=>this._layers[x].type==="fill-extrusion",o={},f=[];for(let x=this._order.length-1;x>=0;x--){const E=this._order[x];if(n(E)){o[E]=x;for(const C of t){const P=C[E];if(P)for(const B of P)f.push(B)}}}f.sort((x,E)=>E.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const E=this._order[x];if(n(E))for(let C=f.length-1;C>=0;C--){const P=f[C].feature;if(o[P.layer.id]<x)break;g.push(P),f.pop()}else for(const C of t){const P=C[E];if(P)for(const B of P)g.push(B.feature)}}return g}queryRenderedFeatures(t,n,o){n&&n.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);const f={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const x of n.layers){const E=this._layers[x];if(!E)return this.fire(new a.ErrorEvent(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];f[E.source]=!0}}const g=[];n.availableImages=this._availableImages;for(const x in this.sourceCaches)n.layers&&!f[x]||g.push(Tt(this.sourceCaches[x],this._layers,this._serializedLayers,t,n,o));return this.placement&&g.push(function(x,E,C,P,B,U,j){const ie={},$=U.queryRenderedSymbols(P),ee=[];for(const pe of Object.keys($).map(Number))ee.push(j[pe]);ee.sort(Ct);for(const pe of ee){const ve=pe.featureIndex.lookupSymbolFeatures($[pe.bucketInstanceId],E,pe.bucketIndex,pe.sourceLayerIndex,B.filter,B.layers,B.availableImages,x);for(const Ie in ve){const ne=ie[Ie]=ie[Ie]||[],Ae=ve[Ie];Ae.sort((Ee,Re)=>{const Be=pe.featureSortOrder;if(Be){const Je=Be.indexOf(Ee.featureIndex);return Be.indexOf(Re.featureIndex)-Je}return Re.featureIndex-Ee.featureIndex});for(const Ee of Ae)ne.push(Ee)}}for(const pe in ie)ie[pe].forEach(ve=>{const Ie=ve.feature,ne=C[x[pe].source].getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=ne});return ie}(this._layers,this._serializedLayers,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,n){n&&n.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);const o=this.sourceCaches[t];return o?function(f,g){const x=f.getRenderableIds().map(P=>f.getTileByID(P)),E=[],C={};for(let P=0;P<x.length;P++){const B=x[P],U=B.tileID.canonical.key;C[U]||(C[U]=!0,B.querySourceFeatures(E,g))}return E}(o,n):[]}addSourceType(t,n,o){return pr.getSourceType(t)?o(new Error(`A source type called "${t}" already exists.`)):(pr.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},o):o(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const o=this.light.getLight();let f=!1;for(const x in t)if(!M(t[x],o[x])){f=!0;break}if(!f)return;const g={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(g)}_validate(t,n,o,f,g={}){return(!g||g.validate!==!1)&&ci(this,t.call(a.validateStyle,a.extend({key:n,style:this.serialize(),value:o,styleSpec:a.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const n=this.sourceCaches[t];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,o,f,g=!1){let x=!1,E=!1;const C={};for(const P of this._order){const B=this._layers[P];if(B.type!=="symbol")continue;if(!C[B.source]){const j=this.sourceCaches[B.source];C[B.source]=j.getRenderableIds(!0).map(ie=>j.getTileByID(ie)).sort((ie,$)=>$.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan($.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(B,C[B.source],t.center.lng);x=x||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||o===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new ze(t,this.terrain,this._order,g,n,o,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),E=!0),x&&this.pauseablePlacement.placement.setStale()),E||x)for(const P of this._order){const B=this._layers[P];B.type==="symbol"&&this.placement.updateLayerOpacities(B,C[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,o){this.imageManager.getImages(n.icons,o),this._updateTilesForChangedImages();const f=this.sourceCaches[n.source];f&&f.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,o){this.glyphManager.getGlyphs(n.stacks,o)}getResource(t,n,o){return a.makeRequest(n,o)}}pr.getSourceType=function(u){return zt[u]},pr.setSourceType=function(u,t){zt[u]=t},pr.registerForPluginStateChange=a.registerForPluginStateChange;var la="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Aa={prelude:Ai(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ai(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ai(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ai(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ai("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ai("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ai("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ai(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ai(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ai(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ai(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ai(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ai(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ai(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ai(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ai(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ai(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ai(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ai(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ai("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",la),terrainDepth:Ai("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",la),terrainCoords:Ai("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",la)};function Ai(u,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,o=t.match(/attribute ([\w]+) ([\w]+)/g),f=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(f):f,E={};return{fragmentSource:u=u.replace(n,(C,P,B,U,j)=>(E[j]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${B} ${U} ${j};
#else
uniform ${B} ${U} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${B} ${U} ${j} = u_${j};
#endif
`)),vertexSource:t=t.replace(n,(C,P,B,U,j)=>{const ie=U==="float"?"vec2":"vec4",$=j.match(/color/)?"color":ie;return E[j]?P==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${B} ${ie} a_${j};
varying ${B} ${U} ${j};
#else
uniform ${B} ${U} u_${j};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${B} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${$}(a_${j}, u_${j}_t);
#else
    ${B} ${U} ${j} = u_${j};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${B} ${ie} a_${j};
#else
uniform ${B} ${U} u_${j};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${B} ${U} ${j} = a_${j};
#else
    ${B} ${U} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${B} ${U} ${j} = unpack_mix_${$}(a_${j}, u_${j}_t);
#else
    ${B} ${U} ${j} = u_${j};
#endif
`}),staticAttributes:o,staticUniforms:x}}class Vs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,o,f,g,x,E,C,P){this.context=t;let B=this.boundPaintVertexBuffers.length!==f.length;for(let U=0;!B&&U<f.length;U++)this.boundPaintVertexBuffers[U]!==f[U]&&(B=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===n&&this.boundLayoutVertexBuffer===o&&!B&&this.boundIndexBuffer===g&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===C&&this.boundDynamicVertexBuffer3===P?(t.bindVertexArrayOES.set(this.vao),E&&E.bind(),g&&g.dynamicDraw&&g.bind(),C&&C.bind(),P&&P.bind()):this.freshBind(n,o,f,g,x,E,C,P)}freshBind(t,n,o,f,g,x,E,C){let P;const B=t.numAttributes,U=this.context,j=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=C;else{P=U.currentNumAttributes||0;for(let ie=B;ie<P;ie++)j.disableVertexAttribArray(ie)}n.enableAttributes(j,t);for(const ie of o)ie.enableAttributes(j,t);x&&x.enableAttributes(j,t),E&&E.enableAttributes(j,t),C&&C.enableAttributes(j,t),n.bind(),n.setVertexAttribPointers(j,t,g);for(const ie of o)ie.bind(),ie.setVertexAttribPointers(j,t,g);x&&(x.bind(),x.setVertexAttribPointers(j,t,g)),f&&f.bind(),E&&(E.bind(),E.setVertexAttribPointers(j,t,g)),C&&(C.bind(),C.setVertexAttribPointers(j,t,g)),U.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Us(u){const t=[];for(let n=0;n<u.length;n++){if(u[n]===null)continue;const o=u[n].split(" ");t.push(o.pop())}return t}class jo{constructor(t,n,o,f,g,x,E){const C=t.gl;this.program=C.createProgram();const P=Us(o.staticAttributes),B=f?f.getBinderAttributes():[],U=P.concat(B),j=Aa.prelude.staticUniforms?Us(Aa.prelude.staticUniforms):[],ie=o.staticUniforms?Us(o.staticUniforms):[],$=f?f.getBinderUniforms():[],ee=j.concat(ie).concat($),pe=[];for(const Be of ee)pe.indexOf(Be)<0&&pe.push(Be);const ve=f?f.defines():[];x&&ve.push("#define OVERDRAW_INSPECTOR;"),E&&ve.push("#define TERRAIN3D;");const Ie=ve.concat(Aa.prelude.fragmentSource,o.fragmentSource).join(`
`),ne=ve.concat(Aa.prelude.vertexSource,o.vertexSource).join(`
`),Ae=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Ae,Ie),C.compileShader(Ae),C.attachShader(this.program,Ae);const Ee=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Ee,ne),C.compileShader(Ee),C.attachShader(this.program,Ee),this.attributes={};const Re={};this.numAttributes=U.length;for(let Be=0;Be<this.numAttributes;Be++)U[Be]&&(C.bindAttribLocation(this.program,Be,U[Be]),this.attributes[U[Be]]=Be);C.linkProgram(this.program),C.deleteShader(Ee),C.deleteShader(Ae);for(let Be=0;Be<pe.length;Be++){const Je=pe[Be];if(Je&&!Re[Je]){const Pe=C.getUniformLocation(this.program,Je);Pe&&(Re[Je]=Pe)}}this.fixedUniforms=g(t,Re),this.terrainUniforms=((Be,Je)=>({u_depth:new a.Uniform1i(Be,Je.u_depth),u_terrain:new a.Uniform1i(Be,Je.u_terrain),u_terrain_dim:new a.Uniform1f(Be,Je.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(Be,Je.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(Be,Je.u_terrain_unpack),u_terrain_offset:new a.Uniform1f(Be,Je.u_terrain_offset),u_terrain_exaggeration:new a.Uniform1f(Be,Je.u_terrain_exaggeration)}))(t,Re),this.binderUniforms=f?f.getUniforms(t,Re):[]}draw(t,n,o,f,g,x,E,C,P,B,U,j,ie,$,ee,pe,ve,Ie){const ne=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(o),t.setStencilMode(f),t.setColorMode(g),t.setCullFace(x),C){t.activeTexture.set(ne.TEXTURE2),ne.bindTexture(ne.TEXTURE_2D,C.depthTexture),t.activeTexture.set(ne.TEXTURE3),ne.bindTexture(ne.TEXTURE_2D,C.texture);for(const Ee in this.terrainUniforms)this.terrainUniforms[Ee].set(C[Ee])}for(const Ee in this.fixedUniforms)this.fixedUniforms[Ee].set(E[Ee]);ee&&ee.setUniforms(t,this.binderUniforms,ie,{zoom:$});let Ae=0;switch(n){case ne.LINES:Ae=2;break;case ne.TRIANGLES:Ae=3;break;case ne.LINE_STRIP:Ae=1}for(const Ee of j.get()){const Re=Ee.vaos||(Ee.vaos={});(Re[P]||(Re[P]=new Vs)).bind(t,this,B,ee?ee.getPaintVertexBuffers():[],U,Ee.vertexOffset,pe,ve,Ie),ne.drawElements(n,Ee.primitiveLength*Ae,ne.UNSIGNED_SHORT,Ee.primitiveOffset*Ae*2)}}}function Zo(u,t,n){const o=1/Ki(n,1,t.transform.tileZoom),f=Math.pow(2,n.tileID.overscaledZ),g=n.tileSize*Math.pow(2,t.transform.tileZoom)/f,x=g*(n.tileID.canonical.x+n.tileID.wrap*f),E=g*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[o,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[x>>16,E>>16],u_pixel_coord_lower:[65535&x,65535&E]}}const Ns=(u,t,n,o)=>{const f=t.style.light,g=f.properties.get("position"),x=[g.x,g.y,g.z],E=a.create$1();f.properties.get("anchor")==="viewport"&&a.fromRotation(E,-t.transform.angle),a.transformMat3(x,x,E);const C=f.properties.get("color");return{u_matrix:u,u_lightpos:x,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+n,u_opacity:o}},sc=(u,t,n,o,f,g,x)=>a.extend(Ns(u,t,n,o),Zo(g,t,x),{u_height_factor:-Math.pow(2,f.overscaledZ)/x.tileSize/8}),ns=u=>({u_matrix:u}),qs=(u,t,n,o)=>a.extend(ns(u),Zo(n,t,o)),Xo=(u,t)=>({u_matrix:u,u_world:t}),Wo=(u,t,n,o,f)=>a.extend(qs(u,t,n,o),{u_world:f}),Ho=(u,t,n,o)=>{const f=u.transform;let g,x;if(o.paint.get("circle-pitch-alignment")==="map"){const E=Ki(n,1,f.zoom);g=!0,x=[E,E]}else g=!1,x=f.pixelsToGLUnits;return{u_camera_to_center_distance:f.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(t.posMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:x}},Gn=(u,t,n)=>{const o=Ki(n,1,t.zoom),f=Math.pow(2,t.zoom-n.tileID.overscaledZ),g=n.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:o,u_extrude_scale:[t.pixelsToGLUnits[0]/(o*f),t.pixelsToGLUnits[1]/(o*f)],u_overscale_factor:g}},Da=(u,t,n=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:n}),ca=u=>({u_matrix:u}),as=(u,t,n,o)=>({u_matrix:u,u_extrude_scale:Ki(t,1,n),u_intensity:o});function ss(u,t){const n=Math.pow(2,t.canonical.z),o=t.canonical.y;return[new a.MercatorCoordinate(0,o/n).toLngLat().lat,new a.MercatorCoordinate(0,(o+1)/n).toLngLat().lat]}const ua=(u,t,n,o)=>{const f=u.transform;return{u_matrix:za(u,t,n,o),u_ratio:1/Ki(t,1,f.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Gs=(u,t,n,o,f)=>a.extend(ua(u,t,n,f),{u_image:0,u_image_height:o}),os=(u,t,n,o,f)=>{const g=u.transform,x=Fi(t,g);return{u_matrix:za(u,t,n,f),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Ki(t,1,g.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[x,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ca=(u,t,n,o,f,g)=>{const x=u.lineAtlas,E=Fi(t,u.transform),C=n.layout.get("line-cap")==="round",P=x.getDash(o.from,C),B=x.getDash(o.to,C),U=P.width*f.fromScale,j=B.width*f.toScale;return a.extend(ua(u,t,n,g),{u_patternscale_a:[E/U,-P.height/2],u_patternscale_b:[E/j,-B.height/2],u_sdfgamma:x.width/(256*Math.min(U,j)*u.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:B.y,u_mix:f.t})};function Fi(u,t){return 1/Ki(u,1,t.tileZoom)}function za(u,t,n,o){return u.translatePosMatrix(o?o.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ko=(u,t,n,o,f)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(x=f.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=f.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Jo(f.paint.get("raster-hue-rotate"))};var g,x};function Jo(u){u*=Math.PI/180;const t=Math.sin(u),n=Math.cos(u);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const js=(u,t,n,o,f,g,x,E,C,P)=>{const B=f.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:B.width/B.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+o,u_texsize:P,u_texture:0}},ls=(u,t,n,o,f,g,x,E,C,P,B)=>{const U=f.transform;return a.extend(js(u,t,n,o,f,g,x,E,C,P),{u_gamma_scale:o?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:f.pixelRatio,u_is_halo:+B})},Yo=(u,t,n,o,f,g,x,E,C,P)=>a.extend(ls(u,t,n,o,f,g,x,E,!0,C,!0),{u_texsize_icon:P,u_texture_icon:1}),oc=(u,t,n)=>({u_matrix:u,u_opacity:t,u_color:n}),lc=(u,t,n,o,f,g)=>a.extend(function(x,E,C,P){const B=C.imageManager.getPattern(x.from.toString()),U=C.imageManager.getPattern(x.to.toString()),{width:j,height:ie}=C.imageManager.getPixelSize(),$=Math.pow(2,P.tileID.overscaledZ),ee=P.tileSize*Math.pow(2,C.transform.tileZoom)/$,pe=ee*(P.tileID.canonical.x+P.tileID.wrap*$),ve=ee*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[j,ie],u_mix:E.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Ki(P,1,C.transform.tileZoom),u_pixel_coord_upper:[pe>>16,ve>>16],u_pixel_coord_lower:[65535&pe,65535&ve]}}(o,g,n,f),{u_matrix:u,u_opacity:t}),Zs={fillExtrusion:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(u,t.u_height_factor),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(u,t.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(u,t.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale),u_overscale_factor:new a.Uniform1f(u,t.u_overscale_factor)}),collisionCircle:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(u,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new a.UniformColor(u,t.u_color),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_overlay:new a.Uniform1i(u,t.u_overlay),u_overlay_scale:new a.Uniform1f(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new a.Uniform1f(u,t.u_extrude_scale),u_intensity:new a.Uniform1f(u,t.u_intensity),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world),u_image:new a.Uniform1i(u,t.u_image),u_color_ramp:new a.Uniform1i(u,t.u_color_ramp),u_opacity:new a.Uniform1f(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_latrange:new a.Uniform2f(u,t.u_latrange),u_light:new a.Uniform2f(u,t.u_light),u_shadow:new a.UniformColor(u,t.u_shadow),u_highlight:new a.UniformColor(u,t.u_highlight),u_accent:new a.UniformColor(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_dimension:new a.Uniform2f(u,t.u_dimension),u_zoom:new a.Uniform1f(u,t.u_zoom),u_unpack:new a.Uniform4f(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels)}),lineGradient:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_image:new a.Uniform1i(u,t.u_image),u_image_height:new a.Uniform1f(u,t.u_image_height)}),linePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texsize:new a.Uniform2f(u,t.u_texsize),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_image:new a.Uniform1i(u,t.u_image),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),lineSDF:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(u,t.u_patternscale_a),u_patternscale_b:new a.Uniform2f(u,t.u_patternscale_b),u_sdfgamma:new a.Uniform1f(u,t.u_sdfgamma),u_image:new a.Uniform1i(u,t.u_image),u_tex_y_a:new a.Uniform1f(u,t.u_tex_y_a),u_tex_y_b:new a.Uniform1f(u,t.u_tex_y_b),u_mix:new a.Uniform1f(u,t.u_mix)}),raster:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_tl_parent:new a.Uniform2f(u,t.u_tl_parent),u_scale_parent:new a.Uniform1f(u,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(u,t.u_buffer_scale),u_fade_t:new a.Uniform1f(u,t.u_fade_t),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image0:new a.Uniform1i(u,t.u_image0),u_image1:new a.Uniform1i(u,t.u_image1),u_brightness_low:new a.Uniform1f(u,t.u_brightness_low),u_brightness_high:new a.Uniform1f(u,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(u,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(u,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texsize_icon:new a.Uniform2f(u,t.u_texsize_icon),u_texture:new a.Uniform1i(u,t.u_texture),u_texture_icon:new a.Uniform1i(u,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_color:new a.UniformColor(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image:new a.Uniform1i(u,t.u_image),u_pattern_tl_a:new a.Uniform2f(u,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(u,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(u,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(u,t.u_pattern_br_b),u_texsize:new a.Uniform2f(u,t.u_texsize),u_mix:new a.Uniform1f(u,t.u_mix),u_pattern_size_a:new a.Uniform2f(u,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(u,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(u,t.u_scale_a),u_scale_b:new a.Uniform1f(u,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(u,t.u_tile_units_to_pixels)}),terrain:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texture:new a.Uniform1i(u,t.u_texture)}),terrainDepth:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),terrainCoords:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texture:new a.Uniform1i(u,t.u_texture),u_terrain_coords_id:new a.Uniform1f(u,t.u_terrain_coords_id)})};class Xs{constructor(t,n,o){this.context=t;const f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!o,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ws={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hs{constructor(t,n,o,f){this.length=n.length,this.attributes=o,this.itemSize=n.bytesPerElement,this.dynamicDraw=f,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let o=0;o<this.attributes.length;o++){const f=n.attributes[this.attributes[o].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,n,o){for(let f=0;f<this.attributes.length;f++){const g=this.attributes[f],x=n.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Ws[g.type]],!1,this.itemSize,g.offset+this.itemSize*(o||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qo extends yi{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cc extends yi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ma extends yi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Pa extends yi{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $o extends yi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Rr extends yi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ks extends yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class cs extends yi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class us extends yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Js extends yi{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ys extends yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class hs extends yi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Qs extends yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class $s extends yi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ds extends yi{getDefault(){return a.Color.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class el extends yi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class tl extends yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class ha extends yi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class uc extends yi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class hc extends yi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class dc extends yi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class fc extends yi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pc extends yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class mc extends yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class eo extends yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fs extends yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class to extends yi{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class io extends yi{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class da extends yi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class il extends yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class rl extends yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ps extends yi{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class jn extends ps{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class nl extends ps{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fa{constructor(t,n,o,f){this.context=t,this.width=n,this.height=o;const g=t.gl,x=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new jn(t,x),f&&(this.depthAttachment=new nl(t,x)),g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}t.deleteFramebuffer(this.framebuffer)}}class Pi{constructor(t,n,o){this.blendFunction=t,this.blendColor=n,this.mask=o}}Pi.Replace=[1,0],Pi.disabled=new Pi(Pi.Replace,a.Color.transparent,[!1,!1,!1,!1]),Pi.unblended=new Pi(Pi.Replace,a.Color.transparent,[!0,!0,!0,!0]),Pi.alphaBlended=new Pi([1,771],a.Color.transparent,[!0,!0,!0,!0]);class al{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Qo(this),this.clearDepth=new cc(this),this.clearStencil=new Ma(this),this.colorMask=new Pa(this),this.depthMask=new $o(this),this.stencilMask=new Rr(this),this.stencilFunc=new Ks(this),this.stencilOp=new cs(this),this.stencilTest=new us(this),this.depthRange=new Js(this),this.depthTest=new Ys(this),this.depthFunc=new hs(this),this.blend=new Qs(this),this.blendFunc=new $s(this),this.blendColor=new ds(this),this.blendEquation=new el(this),this.cullFace=new tl(this),this.cullFaceSide=new ha(this),this.frontFace=new uc(this),this.program=new hc(this),this.activeTexture=new dc(this),this.viewport=new fc(this),this.bindFramebuffer=new pc(this),this.bindRenderbuffer=new mc(this),this.bindTexture=new eo(this),this.bindVertexBuffer=new fs(this),this.bindElementBuffer=new to(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new io(this),this.pixelStoreUnpack=new da(this),this.pixelStoreUnpackPremultiplyAlpha=new il(this),this.pixelStoreUnpackFlipY=new rl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Xs(this,t,n)}createVertexBuffer(t,n,o){return new Hs(this,t,n,o)}createRenderbuffer(t,n,o){const f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,t,n,o),this.bindRenderbuffer.set(null),g}createFramebuffer(t,n,o){return new fa(this,t,n,o)}clear({color:t,depth:n}){const o=this.gl;let f=0;t&&(f|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(f|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),o.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){M(t.blendFunction,Pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ni{constructor(t,n,o){this.func=t,this.mask=n,this.range=o}}ni.ReadOnly=!1,ni.ReadWrite=!0,ni.disabled=new ni(519,ni.ReadOnly,[0,1]);const vi=7680;class Mi{constructor(t,n,o,f,g,x){this.test=t,this.ref=n,this.mask=o,this.fail=f,this.depthFail=g,this.pass=x}}Mi.disabled=new Mi({func:519,mask:0},0,0,vi,vi,vi);class Oi{constructor(t,n,o){this.enable=t,this.mode=n,this.frontFace=o}}let La;function pa(u,t,n,o,f,g,x){const E=u.context,C=E.gl,P=u.useProgram("collisionBox"),B=[];let U=0,j=0;for(let ne=0;ne<o.length;ne++){const Ae=o[ne],Ee=t.getTile(Ae),Re=Ee.getBucket(n);if(!Re)continue;let Be=Ae.posMatrix;f[0]===0&&f[1]===0||(Be=u.translatePosMatrix(Ae.posMatrix,Ee,f,g));const Je=x?Re.textCollisionBox:Re.iconCollisionBox,Pe=Re.collisionCircleArray;if(Pe.length>0){const yt=a.create(),ot=Be;a.mul(yt,Re.placementInvProjMatrix,u.transform.glCoordMatrix),a.mul(yt,yt,Re.placementViewportMatrix),B.push({circleArray:Pe,circleOffset:j,transform:ot,invTransform:yt,coord:Ae}),U+=Pe.length/4,j=U}Je&&P.draw(E,C.LINES,ni.disabled,Mi.disabled,u.colorModeForRenderPass(),Oi.disabled,Gn(Be,u.transform,Ee),u.style.terrain&&u.style.terrain.getTerrainData(Ae),n.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,null,u.transform.zoom,null,null,Je.collisionVertexBuffer)}if(!x||!B.length)return;const ie=u.useProgram("collisionCircle"),$=new a.CollisionCircleLayoutArray;$.resize(4*U),$._trim();let ee=0;for(const ne of B)for(let Ae=0;Ae<ne.circleArray.length/4;Ae++){const Ee=4*Ae,Re=ne.circleArray[Ee+0],Be=ne.circleArray[Ee+1],Je=ne.circleArray[Ee+2],Pe=ne.circleArray[Ee+3];$.emplace(ee++,Re,Be,Je,Pe,0),$.emplace(ee++,Re,Be,Je,Pe,1),$.emplace(ee++,Re,Be,Je,Pe,2),$.emplace(ee++,Re,Be,Je,Pe,3)}(!La||La.length<2*U)&&(La=function(ne){const Ae=2*ne,Ee=new a.QuadTriangleArray;Ee.resize(Ae),Ee._trim();for(let Re=0;Re<Ae;Re++){const Be=6*Re;Ee.uint16[Be+0]=4*Re+0,Ee.uint16[Be+1]=4*Re+1,Ee.uint16[Be+2]=4*Re+2,Ee.uint16[Be+3]=4*Re+2,Ee.uint16[Be+4]=4*Re+3,Ee.uint16[Be+5]=4*Re+0}return Ee}(U));const pe=E.createIndexBuffer(La,!0),ve=E.createVertexBuffer($,a.collisionCircleLayout.members,!0);for(const ne of B){const Ae={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(Ie=u.transform).cameraToCenterDistance,u_viewport_size:[Ie.width,Ie.height]};ie.draw(E,C.TRIANGLES,ni.disabled,Mi.disabled,u.colorModeForRenderPass(),Oi.disabled,Ae,u.style.terrain&&u.style.terrain.getTerrainData(ne.coord),n.id,ve,pe,a.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,u.transform.zoom,null,null,null)}var Ie;ve.destroy(),pe.destroy()}Oi.disabled=new Oi(!1,1029,2305),Oi.backCCW=new Oi(!0,1029,2305);const gc=a.identity(new Float32Array(16));function _c(u,t,n,o,f,g){const{horizontalAlign:x,verticalAlign:E}=a.getAnchorAlignment(u),C=-(x-.5)*t,P=-(E-.5)*n,B=a.evaluateVariableOffset(u,o);return new a.pointGeometry((C/f+B[0])*g,(P/f+B[1])*g)}function sl(u,t,n,o,f,g,x,E,C,P,B){const U=u.text.placedSymbolArray,j=u.text.dynamicLayoutVertexArray,ie=u.icon.dynamicLayoutVertexArray,$={};j.clear();for(let ee=0;ee<U.length;ee++){const pe=U.get(ee),ve=u.allowVerticalPlacement&&!pe.placedOrientation,Ie=pe.hidden||!pe.crossTileID||ve?null:o[pe.crossTileID];if(Ie){const ne=new a.pointGeometry(pe.anchorX,pe.anchorY),Ae=oi(ne,n?x:g,B),Ee=jr(f.cameraToCenterDistance,Ae.signedDistanceFromCamera);let Re=a.evaluateSizeForFeature(u.textSizeData,C,pe)*Ee/a.ONE_EM;n&&(Re*=u.tilePixelRatio/E);const{width:Be,height:Je,anchor:Pe,textOffset:yt,textBoxScale:ot}=Ie,bt=_c(Pe,Be,Je,yt,ot,Re),Kt=n?oi(ne.add(bt),g,B).point:Ae.point.add(t?bt.rotate(-f.angle):bt),Qt=u.allowVerticalPlacement&&pe.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Lt=0;Lt<pe.numGlyphs;Lt++)a.addDynamicAttributes(j,Kt,Qt);P&&pe.associatedIconIndex>=0&&($[pe.associatedIconIndex]={shiftedAnchor:Kt,angle:Qt})}else Wt(pe.numGlyphs,j)}if(P){ie.clear();const ee=u.icon.placedSymbolArray;for(let pe=0;pe<ee.length;pe++){const ve=ee.get(pe);if(ve.hidden)Wt(ve.numGlyphs,ie);else{const Ie=$[pe];if(Ie)for(let ne=0;ne<ve.numGlyphs;ne++)a.addDynamicAttributes(ie,Ie.shiftedAnchor,Ie.angle);else Wt(ve.numGlyphs,ie)}}u.icon.dynamicLayoutVertexBuffer.updateData(ie)}u.text.dynamicLayoutVertexBuffer.updateData(j)}function yc(u,t,n){return n.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function ms(u,t,n,o,f,g,x,E,C,P,B,U){const j=u.context,ie=j.gl,$=u.transform,ee=E==="map",pe=C==="map",ve=E!=="viewport"&&n.layout.get("symbol-placement")!=="point",Ie=ee&&!pe&&!ve,ne=!n.layout.get("symbol-sort-key").isConstant();let Ae=!1;const Ee=u.depthModeForSublayer(0,ni.ReadOnly),Re=n.layout.get("text-variable-anchor"),Be=[];for(const Je of o){const Pe=t.getTile(Je),yt=Pe.getBucket(n);if(!yt)continue;const ot=f?yt.text:yt.icon;if(!ot||!ot.segments.get().length)continue;const bt=ot.programConfigurations.get(n.id),Kt=f||yt.sdfIcons,Qt=f?yt.textSizeData:yt.iconSizeData,Lt=pe||$.pitch!==0,ki=u.useProgram(yc(Kt,f,yt),bt),Ii=a.evaluateSizeForZoom(Qt,$.zoom),si=u.style.terrain&&u.style.terrain.getTerrainData(Je);let ui,Ti,ar,hn,en=[0,0],dn=null;if(f){if(Ti=Pe.glyphAtlasTexture,ar=ie.LINEAR,ui=Pe.glyphAtlasTexture.size,yt.iconsInText){en=Pe.imageAtlasTexture.size,dn=Pe.imageAtlasTexture;const Wr=Qt.kind==="composite"||Qt.kind==="camera";hn=Lt||u.options.rotating||u.options.zooming||Wr?ie.LINEAR:ie.NEAREST}}else{const Wr=n.layout.get("icon-size").constantOr(0)!==1||yt.iconsNeedLinear;Ti=Pe.imageAtlasTexture,ar=Kt||u.options.rotating||u.options.zooming||Wr||Lt?ie.LINEAR:ie.NEAREST,ui=Pe.imageAtlasTexture.size}const Bn=Ki(Pe,1,u.transform.zoom),Xr=Vn(Je.posMatrix,pe,ee,u.transform,Bn),Ar=Qr(Je.posMatrix,pe,ee,u.transform,Bn),bn=Re&&yt.hasTextData(),ks=n.layout.get("icon-text-fit")!=="none"&&bn&&yt.hasIconData();if(ve){const Wr=u.style.terrain?(yo,xa)=>u.style.terrain.getElevation(Je,yo,xa):null,Hn=n.layout.get("text-rotation-alignment")==="map";Lr(yt,Je.posMatrix,u,f,Xr,Ar,pe,P,Hn,Wr)}const er=u.translatePosMatrix(Je.posMatrix,Pe,g,x),ei=ve||f&&Re||ks?gc:Xr,xi=u.translatePosMatrix(Ar,Pe,g,x,!0),sr=Kt&&n.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=Kt?yt.iconsInText?Yo(Qt.kind,Ii,Ie,pe,u,er,ei,xi,ui,en):ls(Qt.kind,Ii,Ie,pe,u,er,ei,xi,f,ui,!0):js(Qt.kind,Ii,Ie,pe,u,er,ei,xi,f,ui);const Ui={program:ki,buffers:ot,uniformValues:or,atlasTexture:Ti,atlasTextureIcon:dn,atlasInterpolation:ar,atlasInterpolationIcon:hn,isSDF:Kt,hasHalo:sr};if(ne&&yt.canOverlap){Ae=!0;const Wr=ot.segments.get();for(const Hn of Wr)Be.push({segments:new a.SegmentVector([Hn]),sortKey:Hn.sortKey,state:Ui,terrainData:si})}else Be.push({segments:ot.segments,sortKey:0,state:Ui,terrainData:si})}Ae&&Be.sort((Je,Pe)=>Je.sortKey-Pe.sortKey);for(const Je of Be){const Pe=Je.state;if(j.activeTexture.set(ie.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,ie.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(j.activeTexture.set(ie.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Pe.isSDF){const yt=Pe.uniformValues;Pe.hasHalo&&(yt.u_is_halo=1,Ra(Pe.buffers,Je.segments,n,u,Pe.program,Ee,B,U,yt,Je.terrainData)),yt.u_is_halo=0}Ra(Pe.buffers,Je.segments,n,u,Pe.program,Ee,B,U,Pe.uniformValues,Je.terrainData)}}function Ra(u,t,n,o,f,g,x,E,C,P){const B=o.context;f.draw(B,B.gl.TRIANGLES,g,x,E,Oi.disabled,C,P,n.id,u.layoutVertexBuffer,u.indexBuffer,t,n.paint,o.transform.zoom,u.programConfigurations.get(n.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Ba(u,t,n,o,f,g,x){const E=u.context.gl,C=n.paint.get("fill-pattern"),P=C&&C.constantOr(1),B=n.getCrossfadeParameters();let U,j,ie,$,ee;x?(j=P&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=E.LINES):(j=P?"fillPattern":"fill",U=E.TRIANGLES);for(const pe of o){const ve=t.getTile(pe);if(P&&!ve.patternsLoaded())continue;const Ie=ve.getBucket(n);if(!Ie)continue;const ne=Ie.programConfigurations.get(n.id),Ae=u.useProgram(j,ne),Ee=u.style.terrain&&u.style.terrain.getTerrainData(pe);P&&(u.context.activeTexture.set(E.TEXTURE0),ve.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ne.updatePaintBuffers(B));const Re=C.constantOr(null);if(Re&&ve.imageAtlas){const Pe=ve.imageAtlas,yt=Pe.patternPositions[Re.to.toString()],ot=Pe.patternPositions[Re.from.toString()];yt&&ot&&ne.setConstantPatternPositions(yt,ot)}const Be=Ee?pe:null,Je=u.translatePosMatrix(Be?Be.posMatrix:pe.posMatrix,ve,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(x){$=Ie.indexBuffer2,ee=Ie.segments2;const Pe=[E.drawingBufferWidth,E.drawingBufferHeight];ie=j==="fillOutlinePattern"&&P?Wo(Je,u,B,ve,Pe):Xo(Je,Pe)}else $=Ie.indexBuffer,ee=Ie.segments,ie=P?qs(Je,u,B,ve):ns(Je);Ae.draw(u.context,U,f,u.stencilModeForClipping(pe),g,Oi.disabled,ie,Ee,n.id,Ie.layoutVertexBuffer,$,ee,n.paint,u.transform.zoom,ne)}}function Fa(u,t,n,o,f,g,x){const E=u.context,C=E.gl,P=n.paint.get("fill-extrusion-pattern"),B=P.constantOr(1),U=n.getCrossfadeParameters(),j=n.paint.get("fill-extrusion-opacity");for(const ie of o){const $=t.getTile(ie),ee=$.getBucket(n);if(!ee)continue;const pe=u.style.terrain&&u.style.terrain.getTerrainData(ie),ve=ee.programConfigurations.get(n.id),Ie=u.useProgram(B?"fillExtrusionPattern":"fillExtrusion",ve);B&&(u.context.activeTexture.set(C.TEXTURE0),$.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ve.updatePaintBuffers(U));const ne=P.constantOr(null);if(ne&&$.imageAtlas){const Be=$.imageAtlas,Je=Be.patternPositions[ne.to.toString()],Pe=Be.patternPositions[ne.from.toString()];Je&&Pe&&ve.setConstantPatternPositions(Je,Pe)}const Ae=u.translatePosMatrix(ie.posMatrix,$,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ee=n.paint.get("fill-extrusion-vertical-gradient"),Re=B?sc(Ae,u,Ee,j,ie,U,$):Ns(Ae,u,Ee,j);Ie.draw(E,E.gl.TRIANGLES,f,g,x,Oi.backCCW,Re,pe,n.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,n.paint,u.transform.zoom,ve,u.style.terrain&&ee.centroidVertexBuffer)}}function ro(u,t,n,o,f,g,x){const E=u.context,C=E.gl,P=n.fbo;if(!P)return;const B=u.useProgram("hillshade"),U=u.style.terrain&&u.style.terrain.getTerrainData(t);E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),B.draw(E,C.TRIANGLES,f,g,x,Oi.disabled,((j,ie,$,ee)=>{const pe=$.paint.get("hillshade-shadow-color"),ve=$.paint.get("hillshade-highlight-color"),Ie=$.paint.get("hillshade-accent-color");let ne=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(ne-=j.transform.angle);const Ae=!j.options.moving;return{u_matrix:ee?ee.posMatrix:j.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:ss(0,ie.tileID),u_light:[$.paint.get("hillshade-exaggeration"),ne],u_shadow:pe,u_highlight:ve,u_accent:Ie}})(u,n,o,U?t:null),U,o.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function ol(u,t,n,o,f,g){const x=u.context,E=x.gl,C=t.dem;if(C&&C.data){const P=C.dim,B=C.stride,U=C.getPixels();if(x.activeTexture.set(E.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(B),t.demTexture){const ie=t.demTexture;ie.update(U,{premultiply:!1}),ie.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else t.demTexture=new G(x,U,E.RGBA,{premultiply:!1}),t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);x.activeTexture.set(E.TEXTURE0);let j=t.fbo;if(!j){const ie=new G(x,{width:P,height:P,data:null},E.RGBA);ie.bind(E.LINEAR,E.CLAMP_TO_EDGE),j=t.fbo=x.createFramebuffer(P,P,!0),j.colorAttachment.set(ie.texture)}x.bindFramebuffer.set(j.framebuffer),x.viewport.set([0,0,P,P]),u.useProgram("hillshadePrepare").draw(x,E.TRIANGLES,o,f,g,Oi.disabled,((ie,$)=>{const ee=$.stride,pe=a.create();return a.ortho(pe,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(pe,pe,[0,-a.EXTENT,0]),{u_matrix:pe,u_image:1,u_dimension:[ee,ee],u_zoom:ie.overscaledZ,u_unpack:$.getUnpackVector()}})(t.tileID,C),null,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function gs(u,t,n,o,f,g){const x=o.paint.get("raster-fade-duration");if(!g&&x>0){const E=a.exported.now(),C=(E-u.timeAdded)/x,P=t?(E-t.timeAdded)/x:-1,B=n.getSource(),U=f.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),j=!t||Math.abs(t.tileID.overscaledZ-U)>Math.abs(u.tileID.overscaledZ-U),ie=j&&u.refreshedUponExpiration?1:a.clamp(j?C:1-P,0,1);return u.refreshedUponExpiration&&C>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const _s=new a.Color(1,0,0,1),$r=new a.Color(0,1,0,1),ll=new a.Color(0,0,1,1),no=new a.Color(1,0,1,1),cl=new a.Color(0,1,1,1);function Zn(u,t,n,o){ma(u,0,t+n/2,u.transform.width,n,o)}function Oa(u,t,n,o){ma(u,t-n/2,0,n,u.transform.height,o)}function ma(u,t,n,o,f,g){const x=u.context,E=x.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*u.pixelRatio,n*u.pixelRatio,o*u.pixelRatio,f*u.pixelRatio),x.clear({color:g}),E.disable(E.SCISSOR_TEST)}function vc(u,t,n){const o=u.context,f=o.gl,g=n.posMatrix,x=u.useProgram("debug"),E=ni.disabled,C=Mi.disabled,P=u.colorModeForRenderPass(),B="$debug",U=u.style.terrain&&u.style.terrain.getTerrainData(n);o.activeTexture.set(f.TEXTURE0),u.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE);const j=t.getTileByID(n.key).latestRawTileData,ie=Math.floor((j&&j.byteLength||0)/1024),$=t.getTile(n).tileSize,ee=512/Math.min($,512)*(n.overscaledZ/u.transform.zoom)*.5;let pe=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(pe+=` => ${n.overscaledZ}`),function(ve,Ie){ve.initDebugOverlayCanvas();const ne=ve.debugOverlayCanvas,Ae=ve.context.gl,Ee=ve.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,ne.width,ne.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(Ie,5,5),Ee.strokeText(Ie,5,5),ve.debugOverlayTexture.update(ne),ve.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(u,`${pe} ${ie}kB`),x.draw(o,f.TRIANGLES,E,C,Pi.alphaBlended,Oi.disabled,Da(g,a.Color.transparent,ee),null,B,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),x.draw(o,f.LINE_STRIP,E,C,P,Oi.disabled,Da(g,a.Color.red),U,B,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function ys(u,t,n){const o=u.context,f=o.gl,g=u.colorModeForRenderPass(),x=new ni(f.LEQUAL,ni.ReadWrite,u.depthRangeFor3D),E=u.useProgram("terrain"),C=t.getTerrainMesh(),P=t.getTerrainData(n.tileID);o.bindFramebuffer.set(null),o.viewport.set([0,0,u.width,u.height]),o.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const B=u.transform.calculatePosMatrix(n.tileID.toUnwrapped());E.draw(o,f.TRIANGLES,x,Mi.disabled,g,Oi.backCCW,{u_matrix:B,u_texture:0},P,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}function ul(u,t,n,o){const f=u.context,g=n.tileSize*t.qualityFactor;n.textures[o]||(n.textures[o]=u.getTileTexture(g)||new G(f,{width:g,height:g,data:null},f.gl.RGBA),n.textures[o].bind(f.gl.LINEAR,f.gl.CLAMP_TO_EDGE),o===0&&t.sourceCache.renderHistory.unshift(n.tileID.key));const x=t.getRTTFramebuffer();x.colorAttachment.set(n.textures[o].texture),f.bindFramebuffer.set(x.framebuffer),f.viewport.set([0,0,g,g])}class hl{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,n=t.terrain;for(const o in t.sourceCaches){this._coordsDescendingInv[o]={};const f=t.sourceCaches[o].getVisibleCoordinates();for(const g of f){const x=n.sourceCache.getTerrainCoords(g);for(const E in x)this._coordsDescendingInv[o][E]||(this._coordsDescendingInv[o][E]=[]),this._coordsDescendingInv[o][E].push(x[E])}}for(const o of t._order){const f=t._layers[o],g=f.source;if(this._renderToTexture[f.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(E=>E.key).sort().join()}}return this._renderableTiles.forEach(o=>{for(const f in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[f][o.tileID.key];g&&g!==o.textureCoords[f]&&o.clearTextures(this.painter),n.needsRerender(f,o.tileID)&&o.clearTextures(this.painter)}this._rerender[o.tileID.key]=!o.textures.length}),n.clearRerenderCache(),n.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const n=t.type,o=this.painter,f=o.style._order,g=o.currentLayer,x=g+1===f.length;if(this._renderToTexture[n]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(f[g]),!x))return!0;if(this._renderToTexture[this._prevType]||n==="hillshade"||this._renderToTexture[n]&&x){this._prevType=n;const E=this._stacks.length-1,C=this._stacks[E]||[];for(const P of this._renderableTiles){if(ul(o,o.style.terrain,P,E),this._rerender[P.tileID.key]){o.context.clear({color:a.Color.transparent});for(let B=0;B<C.length;B++){const U=o.style._layers[C[B]],j=U.source?this._coordsDescendingInv[U.source][P.tileID.key]:[P.tileID];o._renderTileClippingMasks(U,j),o.renderLayer(o,o.style.sourceCaches[U.source],U,j),U.source&&(P.textureCoords[U.source]=this._coordsDescendingInvStr[U.source][P.tileID.key])}}ys(o,o.style.terrain,P)}if(n==="hillshade"){this._stacks.push([f[g]]);for(const P of this._renderableTiles){const B=this._coordsDescendingInv[t.source][P.tileID.key];ul(o,o.style.terrain,P,this._stacks.length-1),o.context.clear({color:a.Color.transparent}),o._renderTileClippingMasks(t,B),o.renderLayer(o,o.style.sourceCaches[t.source],t,B),ys(o,o.style.terrain,P)}return!0}return this._renderToTexture[n]}return!1}}const Va={symbol:function(u,t,n,o,f){if(u.renderPass!=="translucent")return;const g=Mi.disabled,x=u.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(E,C,P,B,U,j,ie){const $=C.transform,ee=U==="map",pe=j==="map";for(const ve of E){const Ie=B.getTile(ve),ne=Ie.getBucket(P);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const Ae=a.evaluateSizeForZoom(ne.textSizeData,$.zoom),Ee=Ki(Ie,1,C.transform.zoom),Re=Vn(ve.posMatrix,pe,ee,C.transform,Ee),Be=P.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(Ae){const Je=Math.pow(2,$.zoom-Ie.tileID.overscaledZ);sl(ne,ee,pe,ie,$,Re,ve.posMatrix,Je,Ae,Be,C.style.terrain?(Pe,yt)=>C.style.terrain.getElevation(ve,Pe,yt):null)}}}(o,u,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),f),n.paint.get("icon-opacity").constantOr(1)!==0&&ms(u,t,n,o,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),g,x),n.paint.get("text-opacity").constantOr(1)!==0&&ms(u,t,n,o,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),g,x),t.map.showCollisionBoxes&&(pa(u,t,n,o,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),pa(u,t,n,o,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,n,o){if(u.renderPass!=="translucent")return;const f=n.paint.get("circle-opacity"),g=n.paint.get("circle-stroke-width"),x=n.paint.get("circle-stroke-opacity"),E=!n.layout.get("circle-sort-key").isConstant();if(f.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const C=u.context,P=C.gl,B=u.depthModeForSublayer(0,ni.ReadOnly),U=Mi.disabled,j=u.colorModeForRenderPass(),ie=[];for(let $=0;$<o.length;$++){const ee=o[$],pe=t.getTile(ee),ve=pe.getBucket(n);if(!ve)continue;const Ie=ve.programConfigurations.get(n.id),ne=u.useProgram("circle",Ie),Ae=ve.layoutVertexBuffer,Ee=ve.indexBuffer,Re=u.style.terrain&&u.style.terrain.getTerrainData(ee),Be={programConfiguration:Ie,program:ne,layoutVertexBuffer:Ae,indexBuffer:Ee,uniformValues:Ho(u,ee,pe,n),terrainData:Re};if(E){const Je=ve.segments.get();for(const Pe of Je)ie.push({segments:new a.SegmentVector([Pe]),sortKey:Pe.sortKey,state:Be})}else ie.push({segments:ve.segments,sortKey:0,state:Be})}E&&ie.sort(($,ee)=>$.sortKey-ee.sortKey);for(const $ of ie){const{programConfiguration:ee,program:pe,layoutVertexBuffer:ve,indexBuffer:Ie,uniformValues:ne,terrainData:Ae}=$.state;pe.draw(C,P.TRIANGLES,B,U,j,Oi.disabled,ne,Ae,n.id,ve,Ie,$.segments,n.paint,u.transform.zoom,ee)}},heatmap:function(u,t,n,o){if(n.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const f=u.context,g=f.gl,x=Mi.disabled,E=new Pi([g.ONE,g.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(C,P,B){const U=C.gl;C.activeTexture.set(U.TEXTURE1),C.viewport.set([0,0,P.width/4,P.height/4]);let j=B.heatmapFbo;if(j)U.bindTexture(U.TEXTURE_2D,j.colorAttachment.get()),C.bindFramebuffer.set(j.framebuffer);else{const ie=U.createTexture();U.bindTexture(U.TEXTURE_2D,ie),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),j=B.heatmapFbo=C.createFramebuffer(P.width/4,P.height/4,!1),function($,ee,pe,ve){const Ie=$.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,Ie.RGBA,ee.width/4,ee.height/4,0,Ie.RGBA,$.extRenderToTextureHalfFloat?$.extTextureHalfFloat.HALF_FLOAT_OES:Ie.UNSIGNED_BYTE,null),ve.colorAttachment.set(pe)}(C,P,ie,j)}})(f,u,n),f.clear({color:a.Color.transparent});for(let C=0;C<o.length;C++){const P=o[C];if(t.hasRenderableParent(P))continue;const B=t.getTile(P),U=B.getBucket(n);if(!U)continue;const j=U.programConfigurations.get(n.id),ie=u.useProgram("heatmap",j),{zoom:$}=u.transform;ie.draw(f,g.TRIANGLES,ni.disabled,x,E,Oi.disabled,as(P.posMatrix,B,$,n.paint.get("heatmap-intensity")),null,n.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,n.paint,u.transform.zoom,j)}f.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(f,g){const x=f.context,E=x.gl,C=g.heatmapFbo;if(!C)return;x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),x.activeTexture.set(E.TEXTURE1);let P=g.colorRampTexture;P||(P=g.colorRampTexture=new G(x,g.colorRamp,E.RGBA)),P.bind(E.LINEAR,E.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(x,E.TRIANGLES,ni.disabled,Mi.disabled,f.colorModeForRenderPass(),Oi.disabled,((B,U,j,ie)=>{const $=a.create();a.ortho($,0,B.width,B.height,0,0,1);const ee=B.context.gl;return{u_matrix:$,u_world:[ee.drawingBufferWidth,ee.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}})(f,g),null,g.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,g.paint,f.transform.zoom)}(u,n))},line:function(u,t,n,o){if(u.renderPass!=="translucent")return;const f=n.paint.get("line-opacity"),g=n.paint.get("line-width");if(f.constantOr(1)===0||g.constantOr(1)===0)return;const x=u.depthModeForSublayer(0,ni.ReadOnly),E=u.colorModeForRenderPass(),C=n.paint.get("line-dasharray"),P=n.paint.get("line-pattern"),B=P.constantOr(1),U=n.paint.get("line-gradient"),j=n.getCrossfadeParameters(),ie=B?"linePattern":C?"lineSDF":U?"lineGradient":"line",$=u.context,ee=$.gl;let pe=!0;for(const ve of o){const Ie=t.getTile(ve);if(B&&!Ie.patternsLoaded())continue;const ne=Ie.getBucket(n);if(!ne)continue;const Ae=ne.programConfigurations.get(n.id),Ee=u.context.program.get(),Re=u.useProgram(ie,Ae),Be=pe||Re.program!==Ee,Je=u.style.terrain&&u.style.terrain.getTerrainData(ve),Pe=P.constantOr(null);if(Pe&&Ie.imageAtlas){const bt=Ie.imageAtlas,Kt=bt.patternPositions[Pe.to.toString()],Qt=bt.patternPositions[Pe.from.toString()];Kt&&Qt&&Ae.setConstantPatternPositions(Kt,Qt)}const yt=Je?ve:null,ot=B?os(u,Ie,n,j,yt):C?Ca(u,Ie,n,C,j,yt):U?Gs(u,Ie,n,ne.lineClipsArray.length,yt):ua(u,Ie,n,yt);if(B)$.activeTexture.set(ee.TEXTURE0),Ie.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Ae.updatePaintBuffers(j);else if(C&&(Be||u.lineAtlas.dirty))$.activeTexture.set(ee.TEXTURE0),u.lineAtlas.bind($);else if(U){const bt=ne.gradients[n.id];let Kt=bt.texture;if(n.gradientVersion!==bt.version){let Qt=256;if(n.stepInterpolant){const Lt=t.getSource().maxzoom,ki=ve.canonical.z===Lt?Math.ceil(1<<u.transform.maxZoom-ve.canonical.z):1;Qt=a.clamp(a.nextPowerOfTwo(ne.maxLineLength/a.EXTENT*1024*ki),256,$.maxTextureSize)}bt.gradient=a.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Qt,image:bt.gradient||void 0,clips:ne.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new G($,bt.gradient,ee.RGBA),bt.version=n.gradientVersion,Kt=bt.texture}$.activeTexture.set(ee.TEXTURE0),Kt.bind(n.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}Re.draw($,ee.TRIANGLES,x,u.stencilModeForClipping(ve),E,Oi.disabled,ot,Je,n.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,n.paint,u.transform.zoom,Ae,ne.layoutVertexBuffer2),pe=!1}},fill:function(u,t,n,o){const f=n.paint.get("fill-color"),g=n.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=u.colorModeForRenderPass(),E=n.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!E.constantOr(1)&&f.constantOr(a.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){const P=u.depthModeForSublayer(1,u.renderPass==="opaque"?ni.ReadWrite:ni.ReadOnly);Ba(u,t,n,o,P,x,!1)}if(u.renderPass==="translucent"&&n.paint.get("fill-antialias")){const P=u.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,ni.ReadOnly);Ba(u,t,n,o,P,x,!0)}},"fill-extrusion":function(u,t,n,o){const f=n.paint.get("fill-extrusion-opacity");if(f!==0&&u.renderPass==="translucent"){const g=new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D);if(f!==1||n.paint.get("fill-extrusion-pattern").constantOr(1))Fa(u,t,n,o,g,Mi.disabled,Pi.disabled),Fa(u,t,n,o,g,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const x=u.colorModeForRenderPass();Fa(u,t,n,o,g,Mi.disabled,x)}}},hillshade:function(u,t,n,o){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const f=u.context,g=u.depthModeForSublayer(0,ni.ReadOnly),x=u.colorModeForRenderPass(),[E,C]=u.renderPass==="translucent"?u.stencilConfigForOverlap(o):[{},o];for(const P of C){const B=t.getTile(P);B.needsHillshadePrepare!==void 0&&B.needsHillshadePrepare&&u.renderPass==="offscreen"?ol(u,B,n,g,Mi.disabled,x):u.renderPass==="translucent"&&ro(u,P,B,n,g,E[P.overscaledZ],x)}f.viewport.set([0,0,u.width,u.height])},raster:function(u,t,n,o){if(u.renderPass!=="translucent"||n.paint.get("raster-opacity")===0||!o.length)return;const f=u.context,g=f.gl,x=t.getSource(),E=u.useProgram("raster"),C=u.colorModeForRenderPass(),[P,B]=x instanceof tt?[{},o]:u.stencilConfigForOverlap(o),U=B[B.length-1].overscaledZ,j=!u.options.moving;for(const ie of B){const $=u.depthModeForSublayer(ie.overscaledZ-U,n.paint.get("raster-opacity")===1?ni.ReadWrite:ni.ReadOnly,g.LESS),ee=t.getTile(ie);ee.registerFadeDuration(n.paint.get("raster-fade-duration"));const pe=t.findLoadedParent(ie,0),ve=gs(ee,pe,t,n,u.transform,u.style.terrain);let Ie,ne;const Ae=n.paint.get("raster-resampling")==="nearest"?g.NEAREST:g.LINEAR;f.activeTexture.set(g.TEXTURE0),ee.texture.bind(Ae,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),f.activeTexture.set(g.TEXTURE1),pe?(pe.texture.bind(Ae,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),Ie=Math.pow(2,pe.tileID.overscaledZ-ee.tileID.overscaledZ),ne=[ee.tileID.canonical.x*Ie%1,ee.tileID.canonical.y*Ie%1]):ee.texture.bind(Ae,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const Ee=u.style.terrain&&u.style.terrain.getTerrainData(ie),Re=Ee?ie:null,Be=Re?Re.posMatrix:u.transform.calculatePosMatrix(ie.toUnwrapped(),j),Je=Ko(Be,ne||[0,0],Ie||1,ve,n);x instanceof tt?E.draw(f,g.TRIANGLES,$,Mi.disabled,C,Oi.disabled,Je,Ee,n.id,x.boundsBuffer,u.quadTriangleIndexBuffer,x.boundsSegments):E.draw(f,g.TRIANGLES,$,P[ie.overscaledZ],C,Oi.disabled,Je,Ee,n.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}},background:function(u,t,n,o){const f=n.paint.get("background-color"),g=n.paint.get("background-opacity");if(g===0)return;const x=u.context,E=x.gl,C=u.transform,P=C.tileSize,B=n.paint.get("background-pattern");if(u.isPatternMissing(B))return;const U=!B&&f.a===1&&g===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==U)return;const j=Mi.disabled,ie=u.depthModeForSublayer(0,U==="opaque"?ni.ReadWrite:ni.ReadOnly),$=u.colorModeForRenderPass(),ee=u.useProgram(B?"backgroundPattern":"background"),pe=o||C.coveringTiles({tileSize:P,terrain:u.style.terrain});B&&(x.activeTexture.set(E.TEXTURE0),u.imageManager.bind(u.context));const ve=n.getCrossfadeParameters();for(const Ie of pe){const ne=o?Ie.posMatrix:u.transform.calculatePosMatrix(Ie.toUnwrapped()),Ae=B?lc(ne,g,u,B,{tileID:Ie,tileSize:P},ve):oc(ne,g,f),Ee=u.style.terrain&&u.style.terrain.getTerrainData(Ie);ee.draw(x,E.TRIANGLES,ie,j,$,Oi.disabled,Ae,Ee,n.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}},debug:function(u,t,n){for(let o=0;o<n.length;o++)vc(u,t,n[o])},custom:function(u,t,n){const o=u.context,f=n.implementation;if(u.renderPass==="offscreen"){const g=f.prerender;g&&(u.setCustomLayerDefaults(),o.setColorMode(u.colorModeForRenderPass()),g.call(f,o.gl,u.transform.customLayerMatrix()),o.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),o.setColorMode(u.colorModeForRenderPass()),o.setStencilMode(Mi.disabled);const g=f.renderingMode==="3d"?new ni(u.context.gl.LEQUAL,ni.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,ni.ReadOnly);o.setDepthMode(g),f.render(o.gl,u.transform.customLayerMatrix()),o.setDirty(),u.setBaseState(),o.bindFramebuffer.set(null)}}};class ao{constructor(t,n){this.context=new al(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=Ye.maxUnderzooming+Ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jt,this.gpuTimers={}}resize(t,n,o){if(this.width=t*o,this.height=n*o,this.pixelRatio=o,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const t=this.context,n=new a.PosArray;n.emplaceBack(0,0),n.emplaceBack(a.EXTENT,0),n.emplaceBack(0,a.EXTENT),n.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,li.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const o=new a.PosArray;o.emplaceBack(0,0),o.emplaceBack(a.EXTENT,0),o.emplaceBack(0,a.EXTENT),o.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(o,li.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const f=new a.RasterBoundsArray;f.emplaceBack(0,0,0,0),f.emplaceBack(a.EXTENT,0,a.EXTENT,0),f.emplaceBack(0,a.EXTENT,0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(f,et.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const g=new a.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,li.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const x=new a.LineStripIndexArray;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const E=new a.TriangleIndexArray;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new G(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const C=this.context.gl;this.stencilClearMode=new Mi({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const o=a.create();a.ortho(o,0,this.width,this.height,0,0,1),a.scale(o,o,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,ni.disabled,this.stencilClearMode,Pi.disabled,Oi.disabled,ca(o),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const o=this.context,f=o.gl;this.nextStencilID+n.length>256&&this.clearStencil(),o.setColorMode(Pi.disabled),o.setDepthMode(ni.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of n){const E=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,C=this.style.terrain&&this.style.terrain.getTerrainData(x);g.draw(o,f.TRIANGLES,ni.disabled,new Mi({func:f.ALWAYS,mask:0},E,255,f.KEEP,f.KEEP,f.REPLACE),Pi.disabled,Oi.disabled,ca(x.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Mi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Mi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,o=t.sort((x,E)=>E.overscaledZ-x.overscaledZ),f=o[o.length-1].overscaledZ,g=o[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let E=0;E<g;E++)x[E+f]=new Mi({func:n.GEQUAL,mask:255},E+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=g,[x,o]}return[{[f]:Mi.disabled},o]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Pi([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Pi.unblended:Pi.alphaBlended}depthModeForSublayer(t,n,o){if(!this.opaquePassEnabledForLayer())return ni.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ni(o||this.context.gl.LEQUAL,n,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const o=this.style._order,f=this.style.sourceCaches,g=this.style.terrain&&new hl(this);for(const P in f){const B=f[P];B.used&&B.prepare(this.context)}const x={},E={},C={};for(const P in f){const B=f[P];x[P]=B.getVisibleCoordinates(),E[P]=x[P].slice().reverse(),C[P]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<o.length;P++)if(this.style._layers[o[P]].is3D()){this.opaquePassCutoff=P;break}if(g){this.opaquePassCutoff=0;const P=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,U){const j=B.context,ie=j.gl,$=Pi.unblended,ee=new ni(ie.LEQUAL,ni.ReadWrite,[0,1]),pe=U.getTerrainMesh(),ve=U.sourceCache.getRenderableTiles(),Ie=B.useProgram("terrainDepth");j.bindFramebuffer.set(U.getFramebuffer("depth").framebuffer),j.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),j.clear({color:a.Color.transparent,depth:1});for(const ne of ve){const Ae=U.getTerrainData(ne.tileID),Ee=B.transform.calculatePosMatrix(ne.tileID.toUnwrapped());Ie.draw(j,ie.TRIANGLES,ee,Mi.disabled,$,Oi.backCCW,{u_matrix:Ee},Ae,"terrain",pe.vertexBuffer,pe.indexBuffer,pe.segments)}j.bindFramebuffer.set(null),j.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain),function(B,U){const j=B.context,ie=j.gl,$=Pi.unblended,ee=new ni(ie.LEQUAL,ni.ReadWrite,[0,1]),pe=U.getTerrainMesh(),ve=U.getCoordsTexture(),Ie=U.sourceCache.getRenderableTiles(),ne=B.useProgram("terrainCoords");j.bindFramebuffer.set(U.getFramebuffer("coords").framebuffer),j.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),j.clear({color:a.Color.transparent,depth:1}),U.coordsIndex=[];for(const Ae of Ie){const Ee=U.getTerrainData(Ae.tileID);j.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,ve.texture);const Re=B.transform.calculatePosMatrix(Ae.tileID.toUnwrapped());ne.draw(j,ie.TRIANGLES,ee,Mi.disabled,$,Oi.backCCW,{u_matrix:Re,u_terrain_coords_id:(255-U.coordsIndex.length)/255,u_texture:0},Ee,"terrain",pe.vertexBuffer,pe.indexBuffer,pe.segments),U.coordsIndex.push(Ae.tileID.key)}j.bindFramebuffer.set(null),j.viewport.set([0,0,B.width,B.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const P of o){const B=this.style._layers[P];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const U=E[B.source];(B.type==="custom"||U.length)&&this.renderLayer(this,f[B.source],B,U)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!g)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[o[this.currentLayer]],B=f[P.source],U=x[P.source];this._renderTileClippingMasks(P,U),this.renderLayer(this,B,P,U)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const P=this.style._layers[o[this.currentLayer]],B=f[P.source];if(g&&g.renderLayer(P))continue;const U=(P.type==="symbol"?C:E)[P.source];this._renderTileClippingMasks(P,x[P.source]),this.renderLayer(this,B,P,U)}if(this.options.showTileBoundaries){let P,B;Object.values(this.style._layers).forEach(U=>{U.source&&!U.isHidden(this.transform.zoom)&&(U.source!==(B&&B.id)&&(B=this.style.sourceCaches[U.source]),(!P||P.getSource().maxzoom<B.getSource().maxzoom)&&(P=B))}),P&&Va.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const B=P.transform.padding;Zn(P,P.transform.height-(B.top||0),3,_s),Zn(P,B.bottom||0,3,$r),Oa(P,B.left||0,3,ll),Oa(P,P.transform.width-(B.right||0),3,no);const U=P.transform.centerPoint;(function(j,ie,$,ee){ma(j,ie-1,$-10,2,20,ee),ma(j,ie-10,$-1,20,2,ee)})(P,U.x,P.transform.height-U.y,cl)}(this),this.context.setDefault()}renderLayer(t,n,o,f){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||(f||[]).length)&&(this.id=o.id,this.gpuTimingStart(o),Va[o.type](t,n,o,f,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;let o=this.gpuTimers[t.id];o||(o=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:n.createQueryEXT()}),o.calls++,n.beginQueryEXT(n.TIME_ELAPSED_EXT,o.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const n={};for(const o in t){const f=t[o],g=this.context.extTimerQuery,x=g.getQueryObjectEXT(f.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(f.query),n[o]=x}return n}translatePosMatrix(t,n,o,f,g){if(!o[0]&&!o[1])return t;const x=g?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(x){const P=Math.sin(x),B=Math.cos(x);o=[o[0]*B-o[1]*P,o[0]*P+o[1]*B]}const E=[g?o[0]:Ki(n,o[0],this.transform.zoom),g?o[1]:Ki(n,o[1],this.transform.zoom),0],C=new Float32Array(16);return a.translate(C,t,E),C}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),o=this.imageManager.getPattern(t.to.toString());return!n||!o}useProgram(t,n){this.cache=this.cache||{};const o=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[o]||(this.cache[o]=new jo(this.context,t,Aa[t],n,Zs[t],this._showOverdrawInspector,this.style.terrain)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new G(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class vs{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,o){const f=Math.pow(2,o),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=1/(E=a.transformMat4([],E,t))[3]/n*f;return a.mul$1(E,E,[C,C,1/E[3],C])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=a.sub([],g[E[0]],g[E[1]]),P=a.sub([],g[E[2]],g[E[1]]),B=a.normalize([],a.cross([],C,P)),U=-a.dot(B,g[E[1]]);return B.concat(U)});return new vs(g,x)}}class Ua{constructor(t,n){this.min=t,this.max=n,this.center=a.scale$1([],a.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],o=a.clone$2(this.min),f=a.clone$2(this.max);for(let g=0;g<n.length;g++)o[g]=n[g]?this.min[g]:this.center[g],f[g]=n[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new Ua(o,f)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let o=!0;for(let f=0;f<t.planes.length;f++){const g=t.planes[f];let x=0;for(let E=0;E<n.length;E++)a.dot$1(g,n[E])>=0&&x++;if(x===0)return 0;x!==n.length&&(o=!1)}if(o)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let E=0;E<t.points.length;E++){const C=t.points[E][f]-this.min[f];g=Math.min(g,C),x=Math.max(x,C)}if(x<0||g>this.max[f]-this.min[f])return 0}return 1}}class ga{constructor(t=0,n=0,o=0,f=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(o)||o<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=o,this.right=f}interpolate(t,n,o){return n.top!=null&&t.top!=null&&(this.top=a.number(t.top,n.top,o)),n.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,n.bottom,o)),n.left!=null&&t.left!=null&&(this.left=a.number(t.left,n.left,o)),n.right!=null&&t.right!=null&&(this.right=a.number(t.right,n.right,o)),this}getCenter(t,n){const o=a.clamp((this.left+t-this.right)/2,0,t),f=a.clamp((this.top+n-this.bottom)/2,0,n);return new a.pointGeometry(o,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ga(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Na{constructor(t,n,o,f,g){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=o??0,this._maxPitch=f??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ga,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Na(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-a.wrap(t,-180,180)*Math.PI/180;var o;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(o=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o),function(f,g,x){var E=g[0],C=g[1],P=g[2],B=g[3],U=Math.sin(x),j=Math.cos(x);f[0]=E*j+P*U,f[1]=C*j+B*U,f[2]=E*-U+P*j,f[3]=C*-U+B*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,o){this._unmodified=!1,this._edgeInsets.interpolate(t,n,o),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const o=this.pointCoordinate(new a.pointGeometry(0,0)),f=this.pointCoordinate(new a.pointGeometry(this.width,0)),g=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new a.pointGeometry(0,this.height)),E=Math.floor(Math.min(o.x,f.x,g.x,x.x)),C=Math.floor(Math.max(o.x,f.x,g.x,x.x)),P=1;for(let B=E-P;B<=C+P;B++)B!==0&&n.push(new a.UnwrappedTileID(B,t))}return n}coveringTiles(t){var n,o;let f=this.coveringZoomLevel(t);const g=f;if(t.minzoom!==void 0&&f<t.minzoom)return[];t.maxzoom!==void 0&&f>t.maxzoom&&(f=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),E=a.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,f),P=[C*x.x,C*x.y,0],B=[C*E.x,C*E.y,0],U=vs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f);let j=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=f);const ie=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,$=ne=>({aabb:new Ua([ne*C,0,0],[(ne+1)*C,C,0]),zoom:0,x:0,y:0,wrap:ne,fullyVisible:!1}),ee=[],pe=[],ve=f,Ie=t.reparseOverscaled?g:f;if(this._renderWorldCopies)for(let ne=1;ne<=3;ne++)ee.push($(-ne)),ee.push($(ne));for(ee.push($(0));ee.length>0;){const ne=ee.pop(),Ae=ne.x,Ee=ne.y;let Re=ne.fullyVisible;if(!Re){const bt=ne.aabb.intersects(U);if(bt===0)continue;Re=bt===2}const Be=t.terrain?P:B,Je=ne.aabb.distanceX(Be),Pe=ne.aabb.distanceY(Be),yt=Math.max(Math.abs(Je),Math.abs(Pe)),ot=ie+(1<<ve-ne.zoom)-2;if(ne.zoom===ve||yt>ot&&ne.zoom>=j){const bt=ve-ne.zoom,Kt=P[0]-.5-(Ae<<bt),Qt=P[1]-.5-(Ee<<bt);pe.push({tileID:new a.OverscaledTileID(ne.zoom===ve?Ie:ne.zoom,ne.wrap,ne.zoom,Ae,Ee),distanceSq:a.sqrLen([B[0]-.5-Ae,B[1]-.5-Ee]),tileDistanceToCamera:Math.sqrt(Kt*Kt+Qt*Qt)})}else for(let bt=0;bt<4;bt++){const Kt=(Ae<<1)+bt%2,Qt=(Ee<<1)+(bt>>1),Lt=ne.zoom+1;let ki=ne.aabb.quadrant(bt);if(t.terrain){const Ii=new a.OverscaledTileID(Lt,ne.wrap,Lt,Kt,Qt),si=t.terrain.getMinMaxElevation(Ii),ui=(n=si.minElevation)!==null&&n!==void 0?n:this.elevation,Ti=(o=si.maxElevation)!==null&&o!==void 0?o:this.elevation;ki=new Ua([ki.min[0],ki.min[1],ui],[ki.max[0],ki.max[1],Ti])}ee.push({aabb:ki,zoom:Lt,x:Kt,y:Qt,wrap:ne.wrap,fullyVisible:Re})}}return pe.sort((ne,Ae)=>ne.distanceSq-Ae.distanceSq).map(ne=>ne.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(n)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,n){const o=a.MercatorCoordinate.fromLngLat(t),f=(1<<this.tileZoom)*a.EXTENT,g=o.x*f,x=o.y*f,E=Math.floor(g/a.EXTENT),C=Math.floor(x/a.EXTENT),P=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,E,C);return n.getElevation(P,g%a.EXTENT,x%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),o=this.getElevation(n,t);if(!(this.elevation-o))return;const f=this.getCameraPosition(),g=a.MercatorCoordinate.fromLngLat(f.lngLat,f.altitude),x=a.MercatorCoordinate.fromLngLat(n,o),E=g.x-x.x,C=g.y-x.y,P=g.z-x.z,B=Math.sqrt(E*E+C*C+P*P),U=this.scaleZoom(this.cameraToCenterDistance/B/this.tileSize);this._elevation=o,this._center=n,this.zoom=U}setLocationAtPoint(t,n){const o=this.pointCoordinate(n),f=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new a.MercatorCoordinate(g.x-(o.x-f.x),g.y-(o.y-f.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,n),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const j=n.pointCoordinate(t);if(j!=null)return j}const o=[t.x,t.y,0,1],f=[t.x,t.y,1,1];a.transformMat4(o,o,this.pixelMatrixInverse),a.transformMat4(f,f,this.pixelMatrixInverse);const g=o[3],x=f[3],E=o[1]/g,C=f[1]/x,P=o[2]/g,B=f[2]/x,U=P===B?0:(0-P)/(B-P);return new a.MercatorCoordinate(a.number(o[0]/g,f[0]/x,U)/this.worldSize,a.number(E,C,U)/this.worldSize)}coordinatePoint(t,n=0,o=this.pixelMatrix){const f=[t.x*this.worldSize,t.y*this.worldSize,n,1];return a.transformMat4(f,f,o),new a.pointGeometry(f[0]/f[3],f[1]/f[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,t))).extend(this.pointLocation(new a.pointGeometry(this.width,t))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const o=t.key,f=n?this._alignedPosMatrixCache:this._posMatrixCache;if(f[o])return f[o];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),E=g.x+Math.pow(2,g.z)*t.wrap,C=a.identity(new Float64Array(16));return a.translate(C,C,[E*x,g.y*x,0]),a.scale(C,C,[x/a.EXTENT,x/a.EXTENT,1]),a.multiply(C,n?this.alignedProjMatrix:this.projMatrix,C),f[o]=new Float32Array(C),f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,o,f,g=-90,x=90,E=-180,C=180;const P=this.size,B=this._unmodified;if(this.latRange){const ie=this.latRange;g=a.mercatorYfromLat(ie[1])*this.worldSize,x=a.mercatorYfromLat(ie[0])*this.worldSize,t=x-g<P.y?P.y/(x-g):0}if(this.lngRange){const ie=this.lngRange;E=a.wrap(a.mercatorXfromLng(ie[0])*this.worldSize,0,this.worldSize),C=a.wrap(a.mercatorXfromLng(ie[1])*this.worldSize,0,this.worldSize),C<E&&(C+=this.worldSize),n=C-E<P.x?P.x/(C-E):0}const U=this.point,j=Math.max(n||0,t||0);if(j)return this.center=this.unproject(new a.pointGeometry(n?(C+E)/2:U.x,t?(x+g)/2:U.y)),this.zoom+=this.scaleZoom(j),this._unmodified=B,void(this._constraining=!1);if(this.latRange){const ie=U.y,$=P.y/2;ie-$<g&&(f=g+$),ie+$>x&&(f=x-$)}if(this.lngRange){const ie=(E+C)/2,$=a.wrap(U.x,ie-this.worldSize/2,ie+this.worldSize/2),ee=P.x/2;$-ee<E&&(o=E+ee),$+ee>C&&(o=C-ee)}o===void 0&&f===void 0||(this.center=this.unproject(new a.pointGeometry(o!==void 0?o:U.x,f!==void 0?f:U.y)).wrap()),this._unmodified=B,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,o=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let f=a.identity(new Float64Array(16));a.scale(f,f,[this.width/2,-this.height/2,1]),a.translate(f,f,[1,-1,0]),this.labelPlaneMatrix=f,f=a.identity(new Float64Array(16)),a.scale(f,f,[1,-1,1]),a.translate(f,f,[-1,-1,0]),a.scale(f,f,[2/this.width,2/this.height,1]),this.glCoordMatrix=f,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const g=Math.PI/2+this._pitch,x=this._fov*(.5+t.y/this.height),E=Math.sin(x)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-g-x,.01,Math.PI-.01)),C=this.getHorizon(),P=2*Math.atan(C/this.cameraToCenterDistance)*(.5+t.y/(2*C)),B=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(a.clamp(Math.PI-g-P,.01,Math.PI-.01)),U=Math.cos(Math.PI/2-this._pitch)*E+this.cameraToSeaLevelDistance,j=Math.cos(Math.PI/2-this._pitch)*B+this.cameraToSeaLevelDistance,ie=1.01*Math.min(U,j),$=this.height/50;f=new Float64Array(16),a.perspective(f,this._fov,this.width/this.height,$,ie),f[8]=2*-t.x/this.width,f[9]=2*t.y/this.height,a.scale(f,f,[1,-1,1]),a.translate(f,f,[0,0,-this.cameraToCenterDistance]),a.rotateX(f,f,this._pitch),a.rotateZ(f,f,this.angle),a.translate(f,f,[-n,-o,0]),this.mercatorMatrix=a.scale([],f,[this.worldSize,this.worldSize,this.worldSize]),a.scale(f,f,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,f),a.translate(f,f,[0,0,-this.elevation]),this.projMatrix=f,this.invProjMatrix=a.invert([],f),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,f);const ee=this.width%2/2,pe=this.height%2/2,ve=Math.cos(this.angle),Ie=Math.sin(this.angle),ne=n-Math.round(n)+ve*ee+Ie*pe,Ae=o-Math.round(o)+ve*pe+Ie*ee,Ee=new Float64Array(f);if(a.translate(Ee,Ee,[ne>.5?ne-1:ne,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=Ee,f=a.invert(new Float64Array(16),this.pixelMatrix),!f)throw new Error("failed to invert matrix");this.pixelMatrixInverse=f,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new a.pointGeometry(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return a.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let o=n.x,f=n.y,g=n.x,x=n.y;for(const E of t)o=Math.min(o,E.x),f=Math.min(f,E.y),g=Math.max(g,E.x),x=Math.max(x,E.y);return[new a.pointGeometry(o,f),new a.pointGeometry(g,f),new a.pointGeometry(g,x),new a.pointGeometry(o,x),new a.pointGeometry(o,f)]}}}class dl{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(n,o){let f=!1,g=null;const x=()=>{g=null,f&&(n(),g=setTimeout(x,300),f=!1)};return()=>(f=!0,g||x(),g)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,f=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),x=Math.round(n.lng*g)/g,E=Math.round(n.lat*g)/g,C=this._map.getBearing(),P=this._map.getPitch();let B="";if(B+=t?`/${x}/${E}/${o}`:`${o}/${E}/${x}`,(C||P)&&(B+="/"+Math.round(10*C)/10),P&&(B+=`/${Math.round(P)}`),this._hashName){const U=this._hashName;let j=!1;const ie=window.location.hash.slice(1).split("&").map($=>{const ee=$.split("=")[0];return ee===U?(j=!0,`${ee}=${B}`):$}).filter($=>$);return j||ie.push(`${U}=${B}`),`#${ie.join("&")}`}return`#${B}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(o=>o.split("=")).forEach(o=>{o[0]===this._hashName&&(n=o)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(n=>isNaN(n))){const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:n,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const qa={linearity:.3,easing:a.bezier(0,0,.3,1)},fl=a.extend({deceleration:2500,maxSpeed:1400},qa),pl=a.extend({deceleration:20,maxSpeed:1400},qa),ml=a.extend({deceleration:1e3,maxSpeed:360},qa),_a=a.extend({deceleration:1e3,maxSpeed:90},qa);class gl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=a.exported.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)n.zoom+=g.zoomDelta||0,n.bearing+=g.bearingDelta||0,n.pitch+=g.pitchDelta||0,g.panDelta&&n.pan._add(g.panDelta),g.around&&(n.around=g.around),g.pinchAround&&(n.pinchAround=g.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(n.pan.mag()){const g=ja(n.pan.mag(),o,a.extend({},fl,t||{}));f.offset=n.pan.mult(g.amount/n.pan.mag()),f.center=this._map.transform.center,Ga(f,g)}if(n.zoom){const g=ja(n.zoom,o,pl);f.zoom=this._map.transform.zoom+g.amount,Ga(f,g)}if(n.bearing){const g=ja(n.bearing,o,ml);f.bearing=this._map.transform.bearing+a.clamp(g.amount,-179,179),Ga(f,g)}if(n.pitch){const g=ja(n.pitch,o,_a);f.pitch=this._map.transform.pitch+g.amount,Ga(f,g)}if(f.zoom||f.bearing){const g=n.pinchAround===void 0?n.around:n.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),a.extend(f,{noMoveStart:!0})}}function Ga(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function ja(u,t,n){const{maxSpeed:o,linearity:f,deceleration:g}=n,x=a.clamp(u*f/(t/1e3),-o,o),E=Math.abs(x)/(g*f);return{easing:n.easing,duration:1e3*E,amount:x*(E/2)}}class Br extends a.Event{constructor(t,n,o,f={}){const g=A.mousePos(n.getCanvasContainer(),o),x=n.unproject(g);super(t,a.extend({point:g,lngLat:x,originalEvent:o},f)),this._defaultPrevented=!1,this.target=n}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Za extends a.Event{constructor(t,n,o){const f=t==="touchend"?o.changedTouches:o.touches,g=A.touchPos(n.getCanvasContainer(),f),x=g.map(C=>n.unproject(C)),E=g.reduce((C,P,B,U)=>C.add(P.div(U.length)),new a.pointGeometry(0,0));super(t,{points:g,point:E,lngLats:x,lngLat:n.unproject(E),originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Fr extends a.Event{constructor(t,n,o){super(t,{originalEvent:o}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class xc{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Fr(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Br(t.type,this._map,t))}mouseup(t){this._map.fire(new Br(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Br(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Br(t.type,this._map,t))}mouseover(t){this._map.fire(new Br(t.type,this._map,t))}mouseout(t){this._map.fire(new Br(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Za(t.type,this._map,t))}touchmove(t){this._map.fire(new Za(t.type,this._map,t))}touchend(t){this._map.fire(new Za(t.type,this._map,t))}touchcancel(t){this._map.fire(new Za(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Br(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Br(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _l{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(A.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const o=n;if(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=o,this._box||(this._box=A.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(f.x,o.x),x=Math.max(f.x,o.x),E=Math.min(f.y,o.y),C=Math.max(f.y,o.y);A.setTransform(this._box,`translate(${g}px,${E}px)`),this._box.style.width=x-g+"px",this._box.style.height=C-E+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const o=this._startPos,f=n;if(this.reset(),A.suppressClick(),o.x!==f.x||o.y!==f.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(o,f,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(A.remove(this._box),this._box=null),A.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new a.Event(t,{originalEvent:n}))}}function vn(u,t){if(u.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${t.length}`);const n={};for(let o=0;o<u.length;o++)n[u[o].identifier]=t[o];return n}class Xa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(f){const g=new a.pointGeometry(0,0);for(const x of f)g._add(x);return g.div(f.length)}(n),this.touches=vn(o,n)))}touchmove(t,n,o){if(this.aborted||!this.centroid)return;const f=vn(o,n);for(const g in this.touches){const x=this.touches[g],E=f[g];(!E||E.dist(x)>30)&&(this.aborted=!0)}}touchend(t,n,o){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class so{constructor(t){this.singleTap=new Xa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,o){this.singleTap.touchstart(t,n,o)}touchmove(t,n,o){this.singleTap.touchmove(t,n,o)}touchend(t,n,o){const f=this.singleTap.touchend(t,n,o);if(f){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class bc{constructor(){this._zoomIn=new so({numTouches:1,numTaps:2}),this._zoomOut=new so({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,o){this._zoomIn.touchstart(t,n,o),this._zoomOut.touchstart(t,n,o)}touchmove(t,n,o){this._zoomIn.touchmove(t,n,o),this._zoomOut.touchmove(t,n,o)}touchend(t,n,o){const f=this._zoomIn.touchend(t,n,o),g=this._zoomOut.touchend(t,n,o);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(f)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wc={0:1,2:2};class xs{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const o=A.mouseButton(t);this._correctButton(t,o)&&(this._lastPoint=n,this._eventButton=o)}mousemoveWindow(t,n){const o=this._lastPoint;if(o){if(t.preventDefault(),function(f,g){const x=wc[g];return f.buttons===void 0||(f.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(o,n)}}mouseupWindow(t){this._lastPoint&&A.mouseButton(t)===this._eventButton&&(this._moved&&A.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wa extends xs{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class xn extends xs{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=.8*(n.x-t.x);if(o)return this._active=!0,{bearingDelta:o}}contextmenu(t){t.preventDefault()}}class kt extends xs{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const o=-.5*(n.y-t.y);if(o)return this._active=!0,{pitchDelta:o}}contextmenu(t){t.preventDefault()}}class yl{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,o){return this._calculateTransform(t,n,o)}touchmove(t,n,o){if(this._map._cooperativeGestures&&(this._minTouches===2&&o.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,o.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(o.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,o)}touchend(t,n,o){this._calculateTransform(t,n,o),this._active&&o.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,o){o.length>0&&(this._active=!0);const f=vn(o,n),g=new a.pointGeometry(0,0),x=new a.pointGeometry(0,0);let E=0;for(const P in f){const B=f[P],U=this._touches[P];U&&(g._add(B),x._add(B.sub(U)),E++,f[P]=B)}if(this._touches=f,E<this._minTouches||!x.mag())return;const C=x.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(E),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,n,o){return{}}touchstart(t,n,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,o){if(!this._firstTwoTouches)return;t.preventDefault();const[f,g]=this._firstTwoTouches,x=zn(o,n,f),E=zn(o,n,g);if(!x||!E)return;const C=this._aroundCenter?null:x.add(E).div(2);return this._move([x,E],C,t)}touchend(t,n,o){if(!this._firstTwoTouches)return;const[f,g]=this._firstTwoTouches,x=zn(o,n,f),E=zn(o,n,g);x&&E||(this._active&&A.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zn(u,t,n){for(let o=0;o<u.length;o++)if(u[o].identifier===n)return t[o]}function oo(u,t){return Math.log(u/t)/Math.LN2}class pt extends Xn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const o=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(oo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oo(this._distance,o),pinchAround:n}}}function bs(u,t){return 180*u.angleWith(t)/Math.PI}class kc extends Xn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const o=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bs(this._vector,o),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,o=bs(t,this._startVector);return Math.abs(o)<n}}function lo(u){return Math.abs(u.y)>Math.abs(u.x)}class co extends Xn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,o){super.touchstart(t,n,o),this._currentTouchCount=o.length}_start(t){this._lastPoints=t,lo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,o){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const f=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,g,o.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,o){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,g=n.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove===void 0&&(this._firstMove=o),o-this._firstMove<100&&void 0;const x=t.y>0==n.y>0;return lo(t)&&lo(n)&&x}}const vl={panStep:100,bearingStep:15,pitchStep:10};class xl{constructor(){const t=vl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,o=0,f=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?o=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?o=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(o=0,f=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Ic,zoom:n?Math.round(C)+n*(t.shiftKey?2:1):C,bearing:E.getBearing()+o*this._bearingStep,pitch:E.getPitch()+f*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ic(u){return u*(2-u)}const bl=4.000244140625;class uo{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=a.exported.now(),f=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,n!==0&&n%bl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=A.mousePos(this._el,t);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>bl?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&C!==0&&(C=1/C);const P=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(P*C))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,o=this._startZoom,f=this._easing;let g,x=!1;if(this._type==="wheel"&&o&&f){const E=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),C=f(E);g=a.number(o,n,C),E<1?this._frameId||(this._frameId=!0):x=!0}else g=n,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=a.ease;if(this._prevEase){const o=this._prevEase,f=(a.exported.now()-o.start)/o.duration,g=o.easing(f+.01)-o.easing(f),x=.27/Math.sqrt(g*g+1e-4)*.01,E=Math.sqrt(.0729-x*x);n=a.bezier(x,E,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:n},n}reset(){this._active=!1}}class ho{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fo{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:o=>{o.easeTo({duration:300,zoom:o.getZoom()+(t.shiftKey?-1:1),around:o.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class po{constructor(){this._tap=new so({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,n,o){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=n[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(t,n,o))}touchmove(t,n,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;const f=n[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,n,o)}touchend(t,n,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(t,n,o)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sr{constructor(t,n,o){this._el=t,this._mousePan=n,this._touchPan=o}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mn{constructor(t,n,o){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=o}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wl{constructor(t,n,o,f){this._el=t,this._touchZoom=n,this._touchRotate=o,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ya=u=>u.zoom||u.drag||u.pitch||u.rotate;class mo extends a.Event{}function Ha(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class kl{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gl(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n),a.bindAll(["handleEvent","handleWindowEvent"],this);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,g,x]of this._listeners)A.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,n,o]of this._listeners)A.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,o)}_addDefaultHandlers(t){const n=this._map,o=n.getCanvasContainer();this._add("mapEvent",new xc(n,t));const f=n.boxZoom=new _l(n,t);this._add("boxZoom",f);const g=new bc,x=new fo;n.doubleClickZoom=new ho(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const E=new po;this._add("tapDragZoom",E);const C=n.touchPitch=new co(n);this._add("touchPitch",C);const P=new xn(t),B=new kt(t);n.dragRotate=new Mn(t,P,B),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new Wa(t),j=new yl(t,n);n.dragPan=new Sr(o,U,j),this._add("mousePan",U),this._add("touchPan",j,["touchZoom","touchRotate"]);const ie=new kc,$=new pt;n.touchZoomRotate=new wl(o,$,ie,E),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]);const ee=n.scrollZoom=new uo(n,this);this._add("scrollZoom",ee,["mousePan"]);const pe=n.keyboard=new xl;this._add("keyboard",pe),this._add("blockableMapEvent",new Cn(n));for(const ve of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ve]&&n[ve].enable(t[ve])}_add(t,n,o){this._handlers.push({handlerName:t,handler:n,allowed:o}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ya(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,o){for(const f in t)if(f!==o&&(!n||n.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const o of t)this._el.contains(o.target)&&n.push(o);return n}handleEvent(t,n){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const o=t.type==="renderFrame"?void 0:t,f={needsRenderFrame:!1},g={},x={},E=t.touches,C=E?this._getMapTouches(E):void 0,P=C?A.touchPos(this._el,C):A.mousePos(this._el,t);for(const{handlerName:j,handler:ie,allowed:$}of this._handlers){if(!ie.isEnabled())continue;let ee;this._blockedByActive(x,$,j)?ie.reset():ie[n||t.type]&&(ee=ie[n||t.type](t,P,C),this.mergeHandlerResult(f,g,ee,j,o),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||ie.isActive())&&(x[j]=ie)}const B={};for(const j in this._previousActiveHandlers)x[j]||(B[j]=o);this._previousActiveHandlers=x,(Object.keys(B).length||Ha(f))&&(this._changes.push([f,g,B]),this._triggerRenderFrame()),(Object.keys(x).length||Ha(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=f;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,n,o,f,g){if(!o)return;a.extend(t,o);const x={handlerName:f,originalEvent:o.originalEvent||g};o.zoomDelta!==void 0&&(n.zoom=x),o.panDelta!==void 0&&(n.drag=x),o.pitchDelta!==void 0&&(n.pitch=x),o.bearingDelta!==void 0&&(n.rotate=x)}_applyChanges(){const t={},n={},o={};for(const[f,g,x]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),a.extend(n,g),a.extend(o,x);this._updateMapTransform(t,n,o),this._changes=[]}_updateMapTransform(t,n,o){const f=this._map,g=f.transform,x=f.style&&f.style.terrain;if(!(Ha(t)||x&&this._drag))return this._fireEvents(n,o,!0);let{panDelta:E,zoomDelta:C,bearingDelta:P,pitchDelta:B,around:U,pinchAround:j}=t;j!==void 0&&(U=j),f._stop(!0),U=U||f.transform.centerPoint;const ie=g.pointLocation(E?U.sub(E):U);P&&(g.bearing+=P),B&&(g.pitch+=B),C&&(g.zoom+=C),x?n.drag&&!this._drag?(this._drag={center:g.centerPoint,lngLat:g.pointLocation(U),point:U,handlerName:n.drag.handlerName},f.fire(new a.Event("freezeElevation",{freeze:!0}))):this._drag&&o[this._drag.handlerName]?(f.fire(new a.Event("freezeElevation",{freeze:!1})),this._drag=null):n.drag&&this._drag&&(g.center=g.pointLocation(g.centerPoint.sub(E))):g.setLocationAtPoint(ie,U),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,o,!0)}_fireEvents(t,n,o){const f=ya(this._eventsInProgress),g=ya(t),x={};for(const B in t){const{originalEvent:U}=t[B];this._eventsInProgress[B]||(x[`${B}start`]=U),this._eventsInProgress[B]=t[B]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(const B in x)this._fireEvent(B,x[B]);g&&this._fireEvent("move",g.originalEvent);for(const B in t){const{originalEvent:U}=t[B];this._fireEvent(B,U)}const E={};let C;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:j}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],C=n[U]||j,E[`${B}end`]=C)}for(const B in E)this._fireEvent(B,E[B]);const P=ya(this._eventsInProgress);if(o&&(f||g)&&!P){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:C})):(this._map.fire(new a.Event("moveend",{originalEvent:C})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new a.Event(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new mo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Zr={extend:(u,...t)=>a.extend(u,...t),run(u){u()},logToElement(u,t=!1,n="log"){const o=window.document.getElementById(n);o&&(t&&(o.innerHTML=""),o.innerHTML+=`<br>${u}`)}};class Vi extends a.Evented{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,o){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},n),o)}panTo(t,n,o){return this.easeTo(a.extend({center:t},n),o)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,o){return this.easeTo(a.extend({zoom:t},n),o)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,o){return this.easeTo(a.extend({bearing:t},n),o)}resetNorth(t,n){return this.rotateTo(0,a.extend({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=a.LngLatBounds.convert(t);const o=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),o,n)}_cameraForBoxAndBearing(t,n,o,f){const g={top:0,bottom:0,right:0,left:0};if(typeof(f=a.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const Ee=f.padding;f.padding={top:Ee,bottom:Ee,right:Ee,left:Ee}}f.padding=a.extend(g,f.padding);const x=this.transform,E=x.padding,C=x.project(a.LngLat.convert(t)),P=x.project(a.LngLat.convert(n)),B=C.rotate(-o*Math.PI/180),U=P.rotate(-o*Math.PI/180),j=new a.pointGeometry(Math.max(B.x,U.x),Math.max(B.y,U.y)),ie=new a.pointGeometry(Math.min(B.x,U.x),Math.min(B.y,U.y)),$=j.sub(ie),ee=(x.width-(E.left+E.right+f.padding.left+f.padding.right))/$.x,pe=(x.height-(E.top+E.bottom+f.padding.top+f.padding.bottom))/$.y;if(pe<0||ee<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ve=Math.min(x.scaleZoom(x.scale*Math.min(ee,pe)),f.maxZoom),Ie=a.pointGeometry.convert(f.offset),ne=new a.pointGeometry((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(o*Math.PI/180),Ae=Ie.add(ne).mult(x.scale/x.zoomScale(ve));return{center:x.unproject(C.add(P).div(2).sub(Ae)),zoom:ve,bearing:o}}fitBounds(t,n,o){return this._fitInternal(this.cameraForBounds(t,n),n,o)}fitScreenCoordinates(t,n,o,f,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(n)),o,f),f,g)}_fitInternal(t,n,o){return t?(delete(n=a.extend(t,n)).padding,n.linear?this.easeTo(n,o):this.flyTo(n,o)):this}jumpTo(t,n){this.stop();const o=this.transform;let f=!1,g=!1,x=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(f=!0,o.zoom=+t.zoom),t.center!==void 0&&(o.center=a.LngLat.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(g=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(x=!0,o.pitch=+t.pitch),t.padding==null||o.isPaddingEqual(t.padding)||(o.padding=t.padding),this.fire(new a.Event("movestart",n)).fire(new a.Event("move",n)),f&&this.fire(new a.Event("zoomstart",n)).fire(new a.Event("zoom",n)).fire(new a.Event("zoomend",n)),g&&this.fire(new a.Event("rotatestart",n)).fire(new a.Event("rotate",n)).fire(new a.Event("rotateend",n)),x&&this.fire(new a.Event("pitchstart",n)).fire(new a.Event("pitch",n)).fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}calculateCameraOptionsFromTo(t,n,o,f=0){const g=a.MercatorCoordinate.fromLngLat(t,n),x=a.MercatorCoordinate.fromLngLat(o,f),E=x.x-g.x,C=x.y-g.y,P=x.z-g.z,B=Math.hypot(E,C,P);if(B===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(E,C),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/B/this.transform.tileSize),ie=180*Math.atan2(E,-C)/Math.PI;let $=180*Math.acos(U/B)/Math.PI;return $=P<0?90-$:90+$,{center:x.toLngLat(),zoom:j,pitch:$,bearing:ie}}easeTo(t,n){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const o=this.transform,f=this.getZoom(),g=this.getBearing(),x=this.getPitch(),E=this.getPadding(),C="zoom"in t?+t.zoom:f,P="bearing"in t?this._normalizeBearing(t.bearing,g):g,B="pitch"in t?+t.pitch:x,U="padding"in t?t.padding:o.padding,j=a.pointGeometry.convert(t.offset);let ie=o.centerPoint.add(j);const $=o.pointLocation(ie),ee=a.LngLat.convert(t.center||$);this._normalizeCenter(ee);const pe=o.project($),ve=o.project(ee).sub(pe),Ie=o.zoomScale(C-f);let ne,Ae;t.around&&(ne=a.LngLat.convert(t.around),Ae=o.locationPoint(ne));const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==f,this._rotating=this._rotating||g!==P,this._pitching=this._pitching||B!==x,this._padding=!o.isPaddingEqual(U),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,Ee),this._ease(Re=>{if(this._zooming&&(o.zoom=a.number(f,C,Re)),this._rotating&&(o.bearing=a.number(g,P,Re)),this._pitching&&(o.pitch=a.number(x,B,Re)),this._padding&&(o.interpolatePadding(E,U,Re),ie=o.centerPoint.add(j)),ne)o.setLocationAtPoint(ne,Ae);else{const Be=o.zoomScale(o.zoom-f),Je=C>f?Math.min(2,Ie):Math.max(.5,Ie),Pe=Math.pow(Je,1-Re),yt=o.unproject(pe.add(ve.mult(Re*Pe)).mult(Be));o.setLocationAtPoint(o.renderWorldCopies?yt.wrap():yt,ie)}this._fireMoveEvents(n)},Re=>{this._afterEase(n,Re)},t),this}_prepareEase(t,n,o={}){this._moving=!0,this.fire(new a.Event("freezeElevation",{freeze:!0})),n||o.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!o.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId,this.fire(new a.Event("freezeElevation",{freeze:!1}));const o=this._zooming,f=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new a.Event("zoomend",t)),f&&this.fire(new a.Event("rotateend",t)),g&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,n){if(!t.essential&&a.exported.prefersReducedMotion){const Lt=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,n)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const o=this.transform,f=this.getZoom(),g=this.getBearing(),x=this.getPitch(),E=this.getPadding(),C="zoom"in t?a.clamp(+t.zoom,o.minZoom,o.maxZoom):f,P="bearing"in t?this._normalizeBearing(t.bearing,g):g,B="pitch"in t?+t.pitch:x,U="padding"in t?t.padding:o.padding,j=o.zoomScale(C-f),ie=a.pointGeometry.convert(t.offset);let $=o.centerPoint.add(ie);const ee=o.pointLocation($),pe=a.LngLat.convert(t.center||ee);this._normalizeCenter(pe);const ve=o.project(ee),Ie=o.project(pe).sub(ve);let ne=t.curve;const Ae=Math.max(o.width,o.height),Ee=Ae/j,Re=Ie.mag();if("minZoom"in t){const Lt=a.clamp(Math.min(t.minZoom,f,C),o.minZoom,o.maxZoom),ki=Ae/o.zoomScale(Lt-f);ne=Math.sqrt(ki/Re*2)}const Be=ne*ne;function Je(Lt){const ki=(Ee*Ee-Ae*Ae+(Lt?-1:1)*Be*Be*Re*Re)/(2*(Lt?Ee:Ae)*Be*Re);return Math.log(Math.sqrt(ki*ki+1)-ki)}function Pe(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function yt(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const ot=Je(0);let bt=function(Lt){return yt(ot)/yt(ot+ne*Lt)},Kt=function(Lt){return Ae*((yt(ot)*(Pe(ki=ot+ne*Lt)/yt(ki))-Pe(ot))/Be)/Re;var ki},Qt=(Je(1)-ot)/ne;if(Math.abs(Re)<1e-6||!isFinite(Qt)){if(Math.abs(Ae-Ee)<1e-6)return this.easeTo(t,n);const Lt=Ee<Ae?-1:1;Qt=Math.abs(Math.log(Ee/Ae))/ne,Kt=function(){return 0},bt=function(ki){return Math.exp(Lt*ne*ki)}}return t.duration="duration"in t?+t.duration:1e3*Qt/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==P,this._pitching=B!==x,this._padding=!o.isPaddingEqual(U),this._prepareEase(n,!1),this._ease(Lt=>{const ki=Lt*Qt,Ii=1/bt(ki);o.zoom=Lt===1?C:f+o.scaleZoom(Ii),this._rotating&&(o.bearing=a.number(g,P,Lt)),this._pitching&&(o.pitch=a.number(x,B,Lt)),this._padding&&(o.interpolatePadding(E,U,Lt),$=o.centerPoint.add(ie));const si=Lt===1?pe:o.unproject(ve.add(Ie.mult(Kt(ki))).mult(Ii));o.setLocationAtPoint(o.renderWorldCopies?si.wrap():si,$),this._fireMoveEvents(n)},()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const o=this._onEaseEnd;delete this._onEaseEnd,o.call(this,n)}if(!t){const o=this.handlers;o&&o.stop(!1)}return this}_ease(t,n,o){o.animate===!1||o.duration===0?(t(1),n()):(this._easeStart=a.exported.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=a.wrap(t,-180,180);const o=Math.abs(t-n);return Math.abs(t-360-n)<o&&(t-=360),Math.abs(t+360-n)<o&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const o=t.lng-n.center.lng;t.lng+=o>180?-360:o<-180?360:0}}class Ka{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=A.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){A.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const o=this._map._getUIString(`AttributionControl.${n}`);t.title=o,t.setAttribute("aria-label",o)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const n=this._map.style.sourceCaches;for(const f in n){const g=n[f];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(f=>String(f).trim()),t.sort((f,g)=>f.length-g.length),t=t.filter((f,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(f)>=0)return!1;return!0});const o=t.join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ws{constructor(t={}){this.options=t,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=A.create("div","maplibregl-ctrl mapboxgl-ctrl");const n=A.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){A.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact","mapboxgl-compact"):n.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Il{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,o=n?this._queue.concat(n):this._queue;for(const f of o)if(f.id===t)return void(f.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const o of n)if(!o.cancelled&&(o.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const El={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Tl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Ec={showCompass:!0,showZoom:!0,visualizePitch:!1};class cn{constructor(t,n,o=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new xn({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new kt({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),A.addEventListener(n,"mousedown",this.mousedown),A.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),A.addEventListener(n,"touchmove",this.touchmove),A.addEventListener(n,"touchend",this.touchend),A.addEventListener(n,"touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),A.disableDrag()}move(t,n){const o=this.map,f=this.mouseRotate.mousemoveWindow(t,n);if(f&&f.bearingDelta&&o.setBearing(o.getBearing()+f.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(t,n);g&&g.pitchDelta&&o.setPitch(o.getPitch()+g.pitchDelta)}}off(){const t=this.element;A.removeEventListener(t,"mousedown",this.mousedown),A.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),A.removeEventListener(t,"touchmove",this.touchmove),A.removeEventListener(t,"touchend",this.touchend),A.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){A.enableDrag(),A.removeEventListener(window,"mousemove",this.mousemove),A.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),A.mousePos(this.element,t)),A.addEventListener(window,"mousemove",this.mousemove),A.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,A.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=A.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=A.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ja(u,t,n){if(u=new a.LngLat(u.lng,u.lat),t){const o=new a.LngLat(u.lng-360,u.lat),f=new a.LngLat(u.lng+360,u.lat),g=n.locationPoint(u).distSqr(t);n.locationPoint(o).distSqr(t)<g?u=o:n.locationPoint(f).distSqr(t)<g&&(u=f)}for(;Math.abs(u.lng-n.center.lng)>180;){const o=n.locationPoint(u);if(o.x>=0&&o.y>=0&&o.x<=n.width&&o.y<=n.height)break;u.lng>n.center.lng?u.lng-=360:u.lng+=360}return u}const At={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ot(u,t,n){const o=u.classList;for(const f in At)o.remove(`maplibregl-${n}-anchor-${f}`,`mapboxgl-${n}-anchor-${f}`);o.add(`maplibregl-${n}-anchor-${t}`,`mapboxgl-${n}-anchor-${t}`)}class va extends a.Evented{constructor(t,n){if(super(),(t instanceof HTMLElement||n)&&(t=a.extend({element:t},n)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=A.create("div"),this._element.setAttribute("aria-label","Map marker");const o=A.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${f}px`),o.setAttributeNS(null,"width",`${g}px`),o.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);const x=A.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const E=A.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const C=A.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of P){const ne=A.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",Ie.rx),ne.setAttributeNS(null,"ry",Ie.ry),C.appendChild(ne)}const B=A.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=A.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const j=A.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const ie=A.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(ie);const $=A.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const ee=A.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const pe=A.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#000000"),pe.setAttributeNS(null,"opacity","0.25"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962");const ve=A.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#FFFFFF"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962"),ee.appendChild(pe),ee.appendChild(ve),E.appendChild(C),E.appendChild(B),E.appendChild(j),E.appendChild($),E.appendChild(ee),o.appendChild(E),o.setAttributeNS(null,"height",f*this._scale+"px"),o.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(o),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),Ot(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),A.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const n=t.code,o=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&o!==32&&o!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,o=this._element;this._popup&&(n===o||o.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ja(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let n="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?n=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(n=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let o="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?o="rotateX(0deg)":this._pitchAlignment==="map"&&(o=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),A.setTransform(this._element,`${At[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${o} ${n}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const f=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=f.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const go={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Pn,dr=0,Ln=!1;const un={maxWidth:100,unit:"metric"};function Sl(u,t,n){const o=n&&n.maxWidth||100,f=u._container.clientHeight/2,g=u.unproject([0,f]),x=u.unproject([o,f]),E=g.distanceTo(x);if(n&&n.unit==="imperial"){const C=3.2808*E;C>5280?Rn(t,o,C/5280,u._getUIString("ScaleControl.Miles")):Rn(t,o,C,u._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Rn(t,o,E/1852,u._getUIString("ScaleControl.NauticalMiles")):E>=1e3?Rn(t,o,E/1e3,u._getUIString("ScaleControl.Kilometers")):Rn(t,o,E,u._getUIString("ScaleControl.Meters"))}function Rn(u,t,n,o){const f=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let E=g/x;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){const P=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*P)/P}(E),x*E}(n);u.style.width=t*(f/n)+"px",u.innerHTML=`${f}&nbsp;${o}`}const ji={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ji=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _o(u){if(u){if(typeof u=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(u,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,u),"top-left":new a.pointGeometry(t,t),"top-right":new a.pointGeometry(-t,t),bottom:new a.pointGeometry(0,-u),"bottom-left":new a.pointGeometry(t,-t),"bottom-right":new a.pointGeometry(-t,-t),left:new a.pointGeometry(u,0),right:new a.pointGeometry(-u,0)}}if(u instanceof a.pointGeometry||Array.isArray(u)){const t=a.pointGeometry.convert(u);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:a.pointGeometry.convert(u.center||[0,0]),top:a.pointGeometry.convert(u.top||[0,0]),"top-left":a.pointGeometry.convert(u["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(u["top-right"]||[0,0]),bottom:a.pointGeometry.convert(u.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(u["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(u["bottom-right"]||[0,0]),left:a.pointGeometry.convert(u.left||[0,0]),right:a.pointGeometry.convert(u.right||[0,0])}}return _o(new a.pointGeometry(0,0))}const Wn={supported:k,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Vi{constructor(u){var t;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(u=a.extend({},Tl,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Na(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),{bearingSnap:u.bearingSnap}),this._interactive=u.interactive,this._cooperativeGestures=u.cooperativeGestures,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._renderTaskQueue=new Il,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},El,u.locale),this._clickTolerance=u.clickTolerance,this._pixelRatio=(t=u.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new N(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new kl(this,u),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=u.hash&&new dl(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Ka({customAttribution:u.customAttribution})),u.maplibreLogo&&this.addControl(new ws,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new a.Event("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=u.onAdd(this);this._controls.push(u);const o=this._controlPositions[t];return t.indexOf("bottom")!==-1?o.insertBefore(n,o.firstChild):o.appendChild(n),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,t,n,o){return o==null&&this.style.terrain&&(o=this.transform.getElevation(n,this.style.terrain)),super.calculateCameraOptionsFromTo(u,t,n,o)}resize(u){const t=this._containerDimensions(),n=t[0],o=t[1];this._resizeCanvas(n,o,this.getPixelRatio()),this.transform.resize(n,o),this.painter.resize(n,o,this.getPixelRatio());const f=!this._moving;return f&&(this.stop(),this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u))),this.fire(new a.Event("resize",u)),f&&this.fire(new a.Event("moveend",u)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(u){const[t,n]=this._containerDimensions();this._pixelRatio=u,this._resizeCanvas(t,n,u),this.painter.resize(t,n,u)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(a.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint(a.LngLat.convert(u),this.style&&this.style.terrain)}unproject(u){return this.transform.pointLocation(a.pointGeometry.convert(u),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(u,t,n){if(u==="mouseenter"||u==="mouseover"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?o||(o=!0,n.call(this,new Br(u,this,g.originalEvent,{features:x}))):o=!1},mouseout:()=>{o=!1}}}}if(u==="mouseleave"||u==="mouseout"){let o=!1;return{layer:t,listener:n,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?o=!0:o&&(o=!1,n.call(this,new Br(u,this,x.originalEvent)))},mouseout:x=>{o&&(o=!1,n.call(this,new Br(u,this,x.originalEvent)))}}}}{const o=f=>{const g=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];g.length&&(f.features=g,n.call(this,f),delete f.features)};return{layer:t,listener:n,delegates:{[u]:o}}}}on(u,t,n){if(n===void 0)return super.on(u,t);const o=this._createDelegatedListener(u,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(o);for(const f in o.delegates)this.on(f,o.delegates[f]);return this}once(u,t,n){if(n===void 0)return super.once(u,t);const o=this._createDelegatedListener(u,t,n);for(const f in o.delegates)this.once(f,o.delegates[f]);return this}off(u,t,n){return n===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(o=>{const f=this._delegatedListeners[u];for(let g=0;g<f.length;g++){const x=f[g];if(x.layer===t&&x.listener===n){for(const E in x.delegates)this.off(E,x.delegates[E]);return f.splice(g,1),this}}})(),this)}queryRenderedFeatures(u,t){if(!this.style)return[];let n;if(t!==void 0||u===void 0||u instanceof a.pointGeometry||Array.isArray(u)||(t=u,u=void 0),t=t||{},(u=u||[[0,0],[this.transform.width,this.transform.height]])instanceof a.pointGeometry||typeof u[0]=="number")n=[a.pointGeometry.convert(u)];else{const o=a.pointGeometry.convert(u[0]),f=a.pointGeometry.convert(u[1]);n=[o,new a.pointGeometry(f.x,o.y),f,new a.pointGeometry(o.x,f.y),o]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}setStyle(u,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(u,t))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),u?(this.style=new pr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new pr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const n=this._requestManager.transformRequest(u,a.ResourceType.Style);a.getJSON(n,(o,f)=>{o?this.fire(new a.ErrorEvent(o)):f&&this._updateDiff(f,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u)&&this._update(!0)}catch(n){a.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style.sourceCaches[u];if(t!==void 0)return t.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){return this.style.setTerrain(u),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const t in u){const n=u[t]._tiles;for(const o in n){const f=n[o];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(u,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,n)}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,{pixelRatio:n=1,sdf:o=!1,stretchX:f,stretchY:g,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||a.isImageBitmap(t)){const{width:E,height:C,data:P}=a.exported.getImageData(t);this.style.addImage(u,{data:new a.RGBAImage({width:E,height:C},P),pixelRatio:n,stretchX:f,stretchY:g,content:x,sdf:o,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:C,data:P}=t,B=t;this.style.addImage(u,{data:new a.RGBAImage({width:E,height:C},new Uint8Array(P)),pixelRatio:n,stretchX:f,stretchY:g,content:x,sdf:o,version:0,userImage:B}),B.onAdd&&B.onAdd(this,u)}}}updateImage(u,t){const n=this.style.getImage(u);if(!n)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=t instanceof HTMLImageElement||a.isImageBitmap(t)?a.exported.getImageData(t):t,{width:f,height:g,data:x}=o;if(f===void 0||g===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==n.data.width||g!==n.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(t instanceof HTMLImageElement||a.isImageBitmap(t));n.data.replace(x,E),this.style.updateImage(u,n)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){a.getImage(this._requestManager.transformRequest(u,a.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,t,n){return this.style.setLayerZoomRange(u,t,n),this._update(!0)}setFilter(u,t,n={}){return this.style.setFilter(u,t,n),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,n,o={}){return this.style.setPaintProperty(u,t,n,o),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,n,o={}){return this.style.setLayoutProperty(u,t,n,o),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.clientWidth||400,t=this._container.clientHeight||300),[u,t]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=A.create("div","maplibregl-canvas-container mapboxgl-canvas-container",u);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=A.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions();this._resizeCanvas(n[0],n[1],this.getPixelRatio());const o=this._controlContainer=A.create("div","maplibregl-control-container mapboxgl-control-container",u),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{f[g]=A.create("div",`maplibregl-ctrl-${g} mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const u=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=A.create("div","maplibregl-cooperative-gesture-screen",u);let t="Control",n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(n=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${n}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",o=>{o.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",o=>{o.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",o=>{this._onCooperativeGesture(o,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(u,t,n){this._canvas.width=n*u,this._canvas.height=n*t,this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const u=a.extend({},k.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);t?(this.painter=new ao(t,this.transform),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(u,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){let t,n=0;const o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t),n=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,E=a.exported.now();this.style.zoomHistory.update(x,E);const C=new a.EvaluationParameters(x,{now:E,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=C.crossFadingFactor();P===1&&P===this._crossFadingFactor||(f=!0,this._crossFadingFactor=P),this.style.update(C)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const x=a.exported.now()-n;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const E=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:x,gpuTime:E}))},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(x);this.fire(new a.Event("gpu-timing-layer",{layerTimes:E}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),A.remove(this._canvasContainer),A.remove(this._controlContainer),this._cooperativeGestures&&A.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(u=>{a.PerformanceUtils.frame(u),this._frame=null,this._render(u)}))}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}_setCacheLimits(u,t){a.setCacheLimits(u,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(u){this.options=a.extend({},Ec,u),this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map.getZoom(),t=u===this._map.getMaxZoom(),n=u===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=u}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){A.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const n=A.create("button",u,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(u,t){const n=this._map._getUIString(`NavigationControl.${t}`);u.title=n,u.setAttribute("aria-label",n)}},GeolocateControl:class extends a.Evented{constructor(u){super(),this.options=a.extend({},go,u),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(u){var t;return this._map=u,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Pn!==void 0?t(Pn):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(n=>{Pn=n.state!=="denied",t(Pn)}):(Pn=!!window.navigator.geolocation,t(Pn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),A.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,dr=0,Ln=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),n=u.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",u)),this._finish()}}_updateCamera(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude),n=u.coords.accuracy,o=this._map.getBearing(),f=a.extend({bearing:o},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),f,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map._container.clientHeight/2,t=this._map.unproject([0,u]),n=this._map.unproject([1,u]),o=t.distanceTo(n),f=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Ln)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=A.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new va(this._dotElement),this._circleElement=A.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new va({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":dr--,Ln=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),dr++,dr>1?(u={maximumAge:6e5,timeout:0},Ln=!0):(u=this.options.positionOptions,Ln=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ka,LogoControl:ws,ScaleControl:class{constructor(u){this.options=a.extend({},un,u),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Sl(this._map,this._container,this.options)}onAdd(u){return this._map=u,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){A.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(u){this.options.unit=u,Sl(this._map,this._container,this.options)}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){A.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=A.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(u){this.options=u,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(u){return this._map=u,this._container=A.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=A.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),A.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){A.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(u){super(),this.options=a.extend(Object.create(ji),u),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&A.remove(this._content),this._container&&(A.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),n=document.createElement("body");let o;for(n.innerHTML=u;o=n.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=A.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){this._container&&this._container.classList.add(u)}removeClassName(u){this._container&&this._container.classList.remove(u)}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}_createCloseButton(){this.options.closeButton&&(this._closeButton=A.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(u){this._update(u.point)}_onMouseMove(u){this._update(u.point)}_onDrag(u){this._update(u.point)}_update(u){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=A.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=A.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(g=>this._container.classList.add(g)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ja(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!u))return;const t=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat);let n=this.options.anchor;const o=_o(this.options.offset);if(!n){const g=this._container.offsetWidth,x=this._container.offsetHeight;let E;E=t.y+o.bottom.y<x?["top"]:t.y>this._map.transform.height-x?["bottom"]:[],t.x<g/2?E.push("left"):t.x>this._map.transform.width-g/2&&E.push("right"),n=E.length===0?"bottom":E.join("-")}const f=t.add(o[n]).round();A.setTransform(this._container,`${At[n]} translate(${f.x}px,${f.y}px)`),Ot(this._container,n,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Ji);u&&u.focus()}_onClose(){this.remove()}},Marker:va,Style:pr,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:Gt,GeoJSONSource:Oe,ImageSource:tt,RasterDEMTileSource:Ue,RasterTileSource:nt,VectorTileSource:rt,VideoSource:ft,prewarm:function(){Kr().acquire(ii)},clearPrewarmedResources:function(){const u=Hi;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(ii),Hi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Ri.workerCount},set workerCount(u){Ri.workerCount=u},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){a.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){a.clearTileCache(u)},workerUrl:"",addProtocol(u,t){a.config.REGISTERED_PROTOCOLS[u]=t},removeProtocol(u){delete a.config.REGISTERED_PROTOCOLS[u]}};return Zr.extend(Wn,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),Wn});var w=y;return w})})(Sf);var B_=Sf.exports;const Fo=$m(B_);var Gr=(h,l,c)=>new Promise((p,y)=>{var v=k=>{try{a(c.next(k))}catch(T){y(T)}},w=k=>{try{a(c.throw(k))}catch(T){y(T)}},a=k=>k.done?p(k.value):Promise.resolve(k.value).then(v,w);a((c=c.apply(h,l)).next())}),on=Uint8Array,Fs=Uint16Array,F_=Int32Array,Df=new on([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Cf=new on([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),O_=new on([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zf=function(h,l){for(var c=new Fs(31),p=0;p<31;++p)c[p]=l+=1<<h[p-1];for(var y=new F_(c[30]),p=1;p<30;++p)for(var v=c[p];v<c[p+1];++v)y[v]=v-c[p]<<5|p;return{b:c,r:y}},Mf=zf(Df,2),Pf=Mf.b,V_=Mf.r;Pf[28]=258,V_[258]=28;var U_=zf(Cf,0),N_=U_.b,mu=new Fs(32768);for(Ci=0;Ci<32768;++Ci)ra=(Ci&43690)>>1|(Ci&21845)<<1,ra=(ra&52428)>>2|(ra&13107)<<2,ra=(ra&61680)>>4|(ra&3855)<<4,mu[Ci]=((ra&65280)>>8|(ra&255)<<8)>>1;var ra,Ci,No=function(h,l,c){for(var p=h.length,y=0,v=new Fs(l);y<p;++y)h[y]&&++v[h[y]-1];var w=new Fs(l);for(y=1;y<l;++y)w[y]=w[y-1]+v[y-1]<<1;var a;if(c){a=new Fs(1<<l);var k=15-l;for(y=0;y<p;++y)if(h[y])for(var T=y<<4|h[y],D=l-h[y],M=w[h[y]-1]++<<D,A=M|(1<<D)-1;M<=A;++M)a[mu[M]>>k]=T}else for(a=new Fs(p),y=0;y<p;++y)h[y]&&(a[y]=mu[w[h[y]-1]++]>>15-h[y]);return a},Go=new on(288);for(Ci=0;Ci<144;++Ci)Go[Ci]=8;var Ci;for(Ci=144;Ci<256;++Ci)Go[Ci]=9;var Ci;for(Ci=256;Ci<280;++Ci)Go[Ci]=7;var Ci;for(Ci=280;Ci<288;++Ci)Go[Ci]=8;var Ci,Lf=new on(32);for(Ci=0;Ci<32;++Ci)Lf[Ci]=5;var Ci,q_=No(Go,9,1),G_=No(Lf,5,1),uu=function(h){for(var l=h[0],c=1;c<h.length;++c)h[c]>l&&(l=h[c]);return l},Tn=function(h,l,c){var p=l/8|0;return(h[p]|h[p+1]<<8)>>(l&7)&c},hu=function(h,l){var c=l/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(l&7)},j_=function(h){return(h+7)/8|0},Z_=function(h,l,c){(l==null||l<0)&&(l=0),(c==null||c>h.length)&&(c=h.length);var p=new on(c-l);return p.set(h.subarray(l,c)),p},X_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],sn=function(h,l,c){var p=new Error(l||X_[h]);if(p.code=h,Error.captureStackTrace&&Error.captureStackTrace(p,sn),!c)throw p;return p},Tu=function(h,l,c,p){var y=h.length,v=p?p.length:0;if(!y||l.f&&!l.l)return c||new on(0);var w=!c||l.i!=2,a=l.i;c||(c=new on(y*3));var k=function(Zt){var He=c.length;if(Zt>He){var ii=new on(Math.max(He*2,Zt));ii.set(c),c=ii}},T=l.f||0,D=l.p||0,M=l.b||0,A=l.l,N=l.d,O=l.m,G=l.n,Q=y*8;do{if(!A){T=Tn(h,D,1);var te=Tn(h,D+1,3);if(D+=3,te)if(te==1)A=q_,N=G_,O=9,G=5;else if(te==2){var _e=Tn(h,D,31)+257,re=Tn(h,D+10,15)+4,we=_e+Tn(h,D+5,31)+1;D+=14;for(var Le=new on(we),de=new on(19),be=0;be<re;++be)de[O_[be]]=Tn(h,D+be*3,7);D+=re*3;for(var Te=uu(de),Ce=(1<<Te)-1,rt=No(de,Te,1),be=0;be<we;){var nt=rt[Tn(h,D,Ce)];D+=nt&15;var le=nt>>4;if(le<16)Le[be++]=le;else{var Ve=0,Ue=0;for(le==16?(Ue=3+Tn(h,D,3),D+=2,Ve=Le[be-1]):le==17?(Ue=3+Tn(h,D,7),D+=3):le==18&&(Ue=11+Tn(h,D,127),D+=7);Ue--;)Le[be++]=Ve}}var Oe=Le.subarray(0,_e),et=Le.subarray(_e);O=uu(Oe),G=uu(et),A=No(Oe,O,1),N=No(et,G,1)}else sn(1);else{var le=j_(D)+4,he=h[le-4]|h[le-3]<<8,Y=le+he;if(Y>y){a&&sn(0);break}w&&k(M+he),c.set(h.subarray(le,Y),M),l.b=M+=he,l.p=D=Y*8,l.f=T;continue}if(D>Q){a&&sn(0);break}}w&&k(M+131072);for(var tt=(1<<O)-1,ft=(1<<G)-1,Gt=D;;Gt=D){var Ve=A[hu(h,D)&tt],zt=Ve>>4;if(D+=Ve&15,D>Q){a&&sn(0);break}if(Ve||sn(2),zt<256)c[M++]=zt;else if(zt==256){Gt=D,A=null;break}else{var Ke=zt-254;if(zt>264){var be=zt-257,Tt=Df[be];Ke=Tn(h,D,(1<<Tt)-1)+Pf[be],D+=Tt}var Ct=N[hu(h,D)&ft],ti=Ct>>4;Ct||sn(3),D+=Ct&15;var et=N_[ti];if(ti>3){var Tt=Cf[ti];et+=hu(h,D)&(1<<Tt)-1,D+=Tt}if(D>Q){a&&sn(0);break}w&&k(M+131072);var hi=M+Ke;if(M<et){var _i=v-et,Ye=Math.min(et,hi);for(_i+M<0&&sn(3);M<Ye;++M)c[M]=p[_i+M]}for(;M<hi;M+=4)c[M]=c[M-et],c[M+1]=c[M+1-et],c[M+2]=c[M+2-et],c[M+3]=c[M+3-et];M=hi}}l.l=A,l.p=Gt,l.b=M,l.f=T,A&&(T=1,l.m=O,l.d=N,l.n=G)}while(!T);return M==c.length?c:Z_(c,0,M)},W_=new on(0),H_=function(h){(h[0]!=31||h[1]!=139||h[2]!=8)&&sn(6,"invalid gzip data");var l=h[3],c=10;l&4&&(c+=(h[10]|h[11]<<8)+2);for(var p=(l>>3&1)+(l>>4&1);p>0;p-=!h[c++]);return c+(l&2)},K_=function(h){var l=h.length;return(h[l-4]|h[l-3]<<8|h[l-2]<<16|h[l-1]<<24)>>>0},J_=function(h,l){return((h[0]&15)!=8||h[0]>>4>7||(h[0]<<8|h[1])%31)&&sn(6,"invalid zlib data"),(h[1]>>5&1)==+!l&&sn(6,"invalid zlib data: "+(h[1]&32?"need":"unexpected")+" dictionary"),(h[1]>>3&4)+2};function Y_(h,l){return Tu(h,{i:2},l&&l.out,l&&l.dictionary)}function Q_(h,l){var c=H_(h);return c+8>h.length&&sn(6,"invalid gzip data"),Tu(h.subarray(c,-8),{i:2},l&&l.out||new on(K_(h)),l&&l.dictionary)}function $_(h,l){return Tu(h.subarray(J_(h,l&&l.dictionary),-4),{i:2},l&&l.out,l&&l.dictionary)}function gu(h,l){return h[0]==31&&h[1]==139&&h[2]==8?Q_(h,l):(h[0]&15)!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?Y_(h,l):$_(h,l)}var ey=typeof TextDecoder<"u"&&new TextDecoder,ty=0;try{ey.decode(W_,{stream:!0}),ty=1}catch{}var Rf=(h,l)=>h*Math.pow(2,l),Oo=(h,l)=>Math.floor(h/Math.pow(2,l)),nc=(h,l)=>Rf(h.getUint16(l+1,!0),8)+h.getUint8(l),Bf=(h,l)=>Rf(h.getUint32(l+2,!0),16)+h.getUint16(l,!0),iy=(h,l,c,p,y)=>{if(h!=p.getUint8(y))return h-p.getUint8(y);const v=nc(p,y+1);if(l!=v)return l-v;const w=nc(p,y+4);return c!=w?c-w:0},ry=(h,l,c,p)=>{const y=Ff(h,l|128,c,p);return y?{z:l,x:c,y:p,offset:y[0],length:y[1],is_dir:!0}:null},ef=(h,l,c,p)=>{const y=Ff(h,l,c,p);return y?{z:l,x:c,y:p,offset:y[0],length:y[1],is_dir:!1}:null},Ff=(h,l,c,p)=>{let y=0,v=h.byteLength/17-1;for(;y<=v;){const w=v+y>>1,a=iy(l,c,p,h,w*17);if(a>0)y=w+1;else if(a<0)v=w-1;else return[Bf(h,w*17+7),h.getUint32(w*17+13,!0)]}return null},ny=(h,l)=>h.is_dir&&!l.is_dir?1:!h.is_dir&&l.is_dir?-1:h.z!==l.z?h.z-l.z:h.x!==l.x?h.x-l.x:h.y-l.y,Of=(h,l)=>{const c=h.getUint8(l*17);return{z:c&127,x:nc(h,l*17+1),y:nc(h,l*17+4),offset:Bf(h,l*17+7),length:h.getUint32(l*17+13,!0),is_dir:c>>7===1}},tf=h=>{const l=[],c=new DataView(h);for(let p=0;p<c.byteLength/17;p++)l.push(Of(c,p));return ay(l)},ay=h=>{h.sort(ny);const l=new ArrayBuffer(17*h.length),c=new Uint8Array(l);for(let p=0;p<h.length;p++){const y=h[p];let v=y.z;y.is_dir&&(v=v|128),c[p*17]=v,c[p*17+1]=y.x&255,c[p*17+2]=y.x>>8&255,c[p*17+3]=y.x>>16&255,c[p*17+4]=y.y&255,c[p*17+5]=y.y>>8&255,c[p*17+6]=y.y>>16&255,c[p*17+7]=y.offset&255,c[p*17+8]=Oo(y.offset,8)&255,c[p*17+9]=Oo(y.offset,16)&255,c[p*17+10]=Oo(y.offset,24)&255,c[p*17+11]=Oo(y.offset,32)&255,c[p*17+12]=Oo(y.offset,48)&255,c[p*17+13]=y.length&255,c[p*17+14]=y.length>>8&255,c[p*17+15]=y.length>>16&255,c[p*17+16]=y.length>>24&255}return l},sy=(h,l)=>{if(h.byteLength<17)return null;const c=h.byteLength/17,p=Of(h,c-1);if(p.is_dir){const y=p.z,v=l.z-y,w=Math.trunc(l.x/(1<<v)),a=Math.trunc(l.y/(1<<v));return{z:y,x:w,y:a}}return null};function oy(h){return Gr(this,null,function*(){const l=yield h.getBytes(0,512e3),c=new DataView(l.data),p=c.getUint32(4,!0),y=c.getUint16(8,!0),v=new TextDecoder("utf-8"),w=JSON.parse(v.decode(new DataView(l.data,10,p)));let a=0;w.compression==="gzip"&&(a=2);let k=0;"minzoom"in w&&(k=+w.minzoom);let T=0;"maxzoom"in w&&(T=+w.maxzoom);let D=0,M=0,A=0,N=-180,O=-85,G=180,Q=85;if(w.bounds){const le=w.bounds.split(",");N=+le[0],O=+le[1],G=+le[2],Q=+le[3]}if(w.center){const le=w.center.split(",");D=+le[0],M=+le[1],A=+le[2]}return{specVersion:c.getUint16(2,!0),rootDirectoryOffset:10+p,rootDirectoryLength:y*17,jsonMetadataOffset:10,jsonMetadataLength:p,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:k,maxZoom:T,minLon:N,minLat:O,maxLon:G,maxLat:Q,centerZoom:A,centerLon:D,centerLat:M,etag:l.etag}})}function ly(h,l,c,p,y,v,w){return Gr(this,null,function*(){let a=yield c.getArrayBuffer(l,h.rootDirectoryOffset,h.rootDirectoryLength,h);h.specVersion===1&&(a=tf(a));const k=ef(new DataView(a),p,y,v);if(k){let M=(yield l.getBytes(k.offset,k.length,w)).data;const A=new DataView(M);return A.getUint8(0)==31&&A.getUint8(1)==139&&(M=gu(new Uint8Array(M))),{data:M}}const T=sy(new DataView(a),{z:p,x:y,y:v});if(T){const D=ry(new DataView(a),T.z,T.x,T.y);if(D){let M=yield c.getArrayBuffer(l,D.offset,D.length,h);h.specVersion===1&&(M=tf(M));const A=ef(new DataView(M),p,y,v);if(A){let O=(yield l.getBytes(A.offset,A.length,w)).data;const G=new DataView(O);return G.getUint8(0)==31&&G.getUint8(1)==139&&(O=gu(new Uint8Array(O))),{data:O}}}}})}var Vf={getHeader:oy,getZxy:ly},cy=class{constructor(){this.tile=(h,l)=>{if(h.type=="json"){const c=h.url.substr(10);let p=this.tiles.get(c);return p||(p=new rf(c),this.tiles.set(c,p)),p.getHeader().then(y=>{const v={tiles:[h.url+"/{z}/{x}/{y}"],minzoom:y.minZoom,maxzoom:y.maxZoom,bounds:[y.minLon,y.minLat,y.maxLon,y.maxLat]};l(null,v,null,null)}).catch(y=>{l(y,null,null,null)}),{cancel:()=>{}}}else{const c=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),p=h.url.match(c);if(!p)throw new Error("Invalid PMTiles protocol URL");const y=p[1];let v=this.tiles.get(y);v||(v=new rf(y),this.tiles.set(y,v));const w=p[2],a=p[3],k=p[4],T=new AbortController,D=T.signal;let M=()=>{T.abort()};return v.getHeader().then(A=>{v.getZxy(+w,+a,+k,D).then(N=>{N?l(null,new Uint8Array(N.data),N.cacheControl,N.expires):A.tileType==1?l(null,new Uint8Array,null,null):l(null,null,null,null)}).catch(N=>{N.name!=="AbortError"&&l(N,null,null,null)})}),{cancel:M}}},this.tiles=new Map}add(h){this.tiles.set(h.source.getKey(),h)}get(h){return this.tiles.get(h)}};function Bs(h,l){return(l>>>0)*4294967296+(h>>>0)}function uy(h,l){const c=l.buf;let p,y;if(y=c[l.pos++],p=(y&112)>>4,y<128||(y=c[l.pos++],p|=(y&127)<<3,y<128)||(y=c[l.pos++],p|=(y&127)<<10,y<128)||(y=c[l.pos++],p|=(y&127)<<17,y<128)||(y=c[l.pos++],p|=(y&127)<<24,y<128)||(y=c[l.pos++],p|=(y&1)<<31,y<128))return Bs(h,p);throw new Error("Expected varint not more than 10 bytes")}function Vo(h){const l=h.buf;let c,p;return p=l[h.pos++],c=p&127,p<128||(p=l[h.pos++],c|=(p&127)<<7,p<128)||(p=l[h.pos++],c|=(p&127)<<14,p<128)||(p=l[h.pos++],c|=(p&127)<<21,p<128)?c:(p=l[h.pos],c|=(p&15)<<28,uy(c,h))}function hy(h,l,c,p){if(p==0){c==1&&(l[0]=h-1-l[0],l[1]=h-1-l[1]);const y=l[0];l[0]=l[1],l[1]=y}}var dy=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function fy(h,l,c){if(h>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(l>Math.pow(2,h)-1||c>Math.pow(2,h)-1)throw Error("tile x/y outside zoom level bounds");const p=dy[h],y=Math.pow(2,h);let v=0,w=0,a=0;const k=[l,c];let T=y/2;for(;T>0;)v=(k[0]&T)>0?1:0,w=(k[1]&T)>0?1:0,a+=T*T*(3*v^w),hy(T,k,v,w),T=T/2;return p+a}function Uf(h,l){return Gr(this,null,function*(){if(l===1||l===0)return h;if(l===2){if(typeof globalThis.DecompressionStream>"u")return gu(new Uint8Array(h));{let p=new Response(h).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(p).arrayBuffer()}}else throw Error("Compression method not supported")})}var py=127;function my(h,l){let c=0,p=h.length-1;for(;c<=p;){const y=p+c>>1,v=l-h[y].tileId;if(v>0)c=y+1;else if(v<0)p=y-1;else return h[y]}return p>=0&&(h[p].runLength===0||l-h[p].tileId<h[p].runLength)?h[p]:null}var gy=class{constructor(h){this.url=h}getKey(){return this.url}getBytes(h,l,c){return Gr(this,null,function*(){let p;c||(p=new AbortController,c=p.signal);let y=yield fetch(this.url,{signal:c,headers:{Range:"bytes="+h+"-"+(h+l-1)}});if(y.status===416&&h===0){const a=y.headers.get("Content-Range");if(!a||!a.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const k=+a.substr(8);y=yield fetch(this.url,{signal:c,headers:{Range:"bytes=0-"+(k-1)}})}if(y.status>=300)throw Error("Bad response code: "+y.status);const v=y.headers.get("Content-Length");if(y.status===200&&(!v||+v>l))throw p&&p.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield y.arrayBuffer(),etag:y.headers.get("ETag")||void 0,cacheControl:y.headers.get("Cache-Control")||void 0,expires:y.headers.get("Expires")||void 0}})}};function Sn(h,l){const c=h.getUint32(l+4,!0),p=h.getUint32(l+0,!0);return c*Math.pow(2,32)+p}function _y(h,l){const c=new DataView(h),p=c.getUint8(7);if(p>3)throw Error(`Archive is spec version ${p} but this library supports up to spec version 3`);return{specVersion:p,rootDirectoryOffset:Sn(c,8),rootDirectoryLength:Sn(c,16),jsonMetadataOffset:Sn(c,24),jsonMetadataLength:Sn(c,32),leafDirectoryOffset:Sn(c,40),leafDirectoryLength:Sn(c,48),tileDataOffset:Sn(c,56),tileDataLength:Sn(c,64),numAddressedTiles:Sn(c,72),numTileEntries:Sn(c,80),numTileContents:Sn(c,88),clustered:c.getUint8(96)===1,internalCompression:c.getUint8(97),tileCompression:c.getUint8(98),tileType:c.getUint8(99),minZoom:c.getUint8(100),maxZoom:c.getUint8(101),minLon:c.getInt32(102,!0)/1e7,minLat:c.getInt32(106,!0)/1e7,maxLon:c.getInt32(110,!0)/1e7,maxLat:c.getInt32(114,!0)/1e7,centerZoom:c.getUint8(118),centerLon:c.getInt32(119,!0)/1e7,centerLat:c.getInt32(123,!0)/1e7,etag:l}}function Nf(h){const l={buf:new Uint8Array(h),pos:0},c=Vo(l),p=[];let y=0;for(let v=0;v<c;v++){const w=Vo(l);p.push({tileId:y+w,offset:0,length:0,runLength:1}),y+=w}for(let v=0;v<c;v++)p[v].runLength=Vo(l);for(let v=0;v<c;v++)p[v].length=Vo(l);for(let v=0;v<c;v++){const w=Vo(l);w===0&&v>0?p[v].offset=p[v-1].offset+p[v-1].length:p[v].offset=w-1}return p}function yy(h){const l=new DataView(h);return l.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):l.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Os=class extends Error{};function vy(h,l,c,p){return Gr(this,null,function*(){const y=yield h.getBytes(0,16384);if(new DataView(y.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(yy(y.data)<3)return[yield Vf.getHeader(h)];const w=y.data.slice(0,py);let a=y.etag;p&&y.etag!=p&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+h.getKey()),a=void 0);const k=_y(w,a);if(c){const T=y.data.slice(k.rootDirectoryOffset,k.rootDirectoryOffset+k.rootDirectoryLength),D=h.getKey()+"|"+(k.etag||"")+"|"+k.rootDirectoryOffset+"|"+k.rootDirectoryLength,M=Nf(yield l(T,k.internalCompression));return[k,[D,M.length,M]]}return[k,void 0]})}function xy(h,l,c,p,y){return Gr(this,null,function*(){const v=yield h.getBytes(c,p);if(y.etag&&y.etag!==v.etag)throw new Os(v.etag);const w=yield l(v.data,y.internalCompression),a=Nf(w);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var by=class{constructor(h=100,l=!0,c=Uf){this.cache=new Map,this.maxCacheEntries=h,this.counter=1,this.prefetch=l,this.decompress=c}getHeader(h,l){return Gr(this,null,function*(){const c=h.getKey();if(this.cache.has(c))return this.cache.get(c).lastUsed=this.counter++,yield this.cache.get(c).data;const p=new Promise((y,v)=>{vy(h,this.decompress,this.prefetch,l).then(w=>{w[1]&&this.cache.set(w[1][0],{lastUsed:this.counter++,data:Promise.resolve(w[1][2])}),y(w[0]),this.prune()}).catch(w=>{v(w)})});return this.cache.set(c,{lastUsed:this.counter++,data:p}),p})}getDirectory(h,l,c,p){return Gr(this,null,function*(){const y=h.getKey()+"|"+(p.etag||"")+"|"+l+"|"+c;if(this.cache.has(y))return this.cache.get(y).lastUsed=this.counter++,yield this.cache.get(y).data;const v=new Promise((w,a)=>{xy(h,this.decompress,l,c,p).then(k=>{w(k),this.prune()}).catch(k=>{a(k)})});return this.cache.set(y,{lastUsed:this.counter++,data:v}),v})}getArrayBuffer(h,l,c,p){return Gr(this,null,function*(){const y=h.getKey()+"|"+(p.etag||"")+"|"+l+"|"+c;if(this.cache.has(y))return this.cache.get(y).lastUsed=this.counter++,yield this.cache.get(y).data;const v=new Promise((w,a)=>{h.getBytes(l,c).then(k=>{if(p.etag&&p.etag!==k.etag)throw new Os(k.etag);w(k.data),this.cache.has(y),this.prune()}).catch(k=>{a(k)})});return this.cache.set(y,{lastUsed:this.counter++,data:v}),v})}prune(){if(this.cache.size>=this.maxCacheEntries){let h=1/0,l;this.cache.forEach((c,p)=>{c.lastUsed<h&&(h=c.lastUsed,l=p)}),l&&this.cache.delete(l)}}invalidate(h,l){return Gr(this,null,function*(){this.cache.delete(h.getKey()),yield this.getHeader(h,l)})}},rf=class{constructor(h,l,c){typeof h=="string"?this.source=new gy(h):this.source=h,c?this.decompress=c:this.decompress=Uf,l?this.cache=l:this.cache=new by}getHeader(){return Gr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(h,l,c,p){return Gr(this,null,function*(){const y=fy(h,l,c),v=yield this.cache.getHeader(this.source);if(v.specVersion<3)return Vf.getZxy(v,this.source,this.cache,h,l,c,p);if(h<v.minZoom||h>v.maxZoom)return;let w=v.rootDirectoryOffset,a=v.rootDirectoryLength;for(let k=0;k<=3;k++){const T=yield this.cache.getDirectory(this.source,w,a,v),D=my(T,y);if(D)if(D.runLength>0){const M=yield this.source.getBytes(v.tileDataOffset+D.offset,D.length,p);if(v.etag&&v.etag!==M.etag)throw new Os(M.etag);return{data:yield this.decompress(M.data,v.tileCompression),cacheControl:M.cacheControl,expires:M.expires}}else w=v.leafDirectoryOffset+D.offset,a=D.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(h,l,c,p){return Gr(this,null,function*(){try{return yield this.getZxyAttempt(h,l,c,p)}catch(y){if(y instanceof Os)return this.cache.invalidate(this.source,y.message),yield this.getZxyAttempt(h,l,c,p);throw y}})}getMetadataAttempt(){return Gr(this,null,function*(){const h=yield this.cache.getHeader(this.source),l=yield this.source.getBytes(h.jsonMetadataOffset,h.jsonMetadataLength);if(h.etag&&h.etag!==l.etag)throw new Os(l.etag);const c=yield this.decompress(l.data,h.internalCompression),p=new TextDecoder("utf-8");return JSON.parse(p.decode(c))})}getMetadata(){return Gr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(h){if(h instanceof Os)return this.cache.invalidate(this.source,h.message),yield this.getMetadataAttempt();throw h}})}};const{document:nf}=Fm;function af(h){let l;const c=h[20].default,p=vu(c,h,h[19],null);return{c(){p&&p.c()},l(y){p&&p.l(y)},m(y,v){p&&p.m(y,v),l=!0},p(y,v){p&&p.p&&(!l||v&524288)&&xu(p,c,y,y[19],l?wu(c,y[19],v,null):bu(y[19]),null)},i(y){l||(We(p,y),l=!0)},o(y){it(p,y),l=!1},d(y){p&&p.d(y)}}}function wy(h){let l,c,p,y,v,w=h[3]&&af(h);return{c(){l=qe("link"),p=vt(),y=qe("div"),w&&w.c(),this.h()},l(a){const k=Bm("svelte-19mu9pj",nf.head);l=Ge(k,"LINK",{rel:!0,href:!0}),k.forEach(W),p=xt(a),y=Ge(a,"DIV",{id:!0,class:!0});var T=me(y);w&&w.l(T),T.forEach(W),this.h()},h(){S(l,"rel","stylesheet"),S(l,"href",c=h[1]?h[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),S(y,"id",h[0]),S(y,"class","map svelte-1tna482")},m(a,k){se(nf.head,l),Ze(a,p,k),Ze(a,y,k),w&&w.m(y,null),h[21](y),v=!0},p(a,[k]){(!v||k&2&&c!==(c=a[1]?a[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&S(l,"href",c),a[3]?w?(w.p(a,k),k&8&&We(w,1)):(w=af(a),w.c(),We(w,1),w.m(y,null)):w&&(vr(),it(w,1,1,()=>{w=null}),xr()),(!v||k&1)&&S(y,"id",a[0])},i(a){v||(We(w),v=!0)},o(a){it(w),v=!1},d(a){W(l),a&&W(p),a&&W(y),w&&w.d(),h[21](null)}}}function ky(h=1e3){return new Promise(l=>setTimeout(l,h))}function Iy(h,l,c){let{$$slots:p={},$$scope:y}=l;const v=_u();let{map:w}=l,{id:a="map"}=l,{location:k={lng:15,lat:45,zoom:1}}=l,{style:T={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=l,{css:D=null}=l,{pmtiles:M=!1}=l,{options:A={}}=l,{minzoom:N=0}=l,{maxzoom:O=14}=l,{controls:G=!1}=l,{tabbable:Q=!1}=l,{zoom:te=null}=l,{center:le=null}=l,{pitch:he=null}=l,{bearing:Y=null}=l,{interactive:_e=!0}=l,{attribution:re=!0}=l,we,Le={},de=!1;Ql("map",{getMap:()=>w}),k.bounds?Le.bounds=k.bounds:k.lng&&k.lat&&(Le.center=[+k.lng,+k.lat],k.zoom&&(Le.zoom=+k.zoom),k.pitch&&(Le.pitch=+k.pitch),k.bearing&&(Le.bearing=+k.bearing)),re||(Le.attributionControl=!1),Le={...Le,...A},ac(()=>{if(M){let Ce=new cy;Fo.addProtocol("pmtiles",Ce.tile)}c(4,w=new Fo.Map({container:we,style:T,minZoom:N,maxZoom:O,interactive:_e,...Le})),G&&!Array.isArray(G)?w.addControl(new Fo.NavigationControl({showCompass:!1})):Array.isArray(G)&&G!=["locate"]&&w.addControl(new Fo.NavigationControl({showCompass:G.includes("compass"),visualizePitch:G.includes("pitch")})),Array.isArray(G)&&G.includes("locate")&&w.addControl(new Fo.GeolocateControl),w.on("load",Ce=>{c(5,te=w.getZoom()),c(6,le=w.getCenter()),c(7,he=w.getPitch()),c(8,Y=w.getBearing()),c(3,de=!0),!Q&&document.querySelector(`#${a} canvas`)&&(document.querySelector(`#${a} canvas`).tabIndex="-1"),v("load",{event:Ce})}),w.on("moveend",()=>{c(5,te=w.getZoom()),c(6,le=w.getCenter()),c(7,he=w.getPitch()),c(8,Y=w.getBearing())})}),yu(async()=>{await ky(250),w&&w.remove(),c(4,w=null)});function be(Ce){w&&w.setStyle(Ce),v("style",{style:Ce})}function Te(Ce){gi[Ce?"unshift":"push"](()=>{we=Ce,c(2,we)})}return h.$$set=Ce=>{"map"in Ce&&c(4,w=Ce.map),"id"in Ce&&c(0,a=Ce.id),"location"in Ce&&c(9,k=Ce.location),"style"in Ce&&c(10,T=Ce.style),"css"in Ce&&c(1,D=Ce.css),"pmtiles"in Ce&&c(11,M=Ce.pmtiles),"options"in Ce&&c(12,A=Ce.options),"minzoom"in Ce&&c(13,N=Ce.minzoom),"maxzoom"in Ce&&c(14,O=Ce.maxzoom),"controls"in Ce&&c(15,G=Ce.controls),"tabbable"in Ce&&c(16,Q=Ce.tabbable),"zoom"in Ce&&c(5,te=Ce.zoom),"center"in Ce&&c(6,le=Ce.center),"pitch"in Ce&&c(7,he=Ce.pitch),"bearing"in Ce&&c(8,Y=Ce.bearing),"interactive"in Ce&&c(17,_e=Ce.interactive),"attribution"in Ce&&c(18,re=Ce.attribution),"$$scope"in Ce&&c(19,y=Ce.$$scope)},h.$$.update=()=>{h.$$.dirty&1024&&be(T)},[a,D,we,de,w,te,le,he,Y,k,T,M,A,N,O,G,Q,_e,re,y,p,Te]}let Ey=class extends di{constructor(l){super(),fi(this,l,Iy,wy,pi,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function sf(h){let l;const c=h[12].default,p=vu(c,h,h[11],null);return{c(){p&&p.c()},l(y){p&&p.l(y)},m(y,v){p&&p.m(y,v),l=!0},p(y,v){p&&p.p&&(!l||v&2048)&&xu(p,c,y,y[11],l?wu(c,y[11],v,null):bu(y[11]),null)},i(y){l||(We(p,y),l=!0)},o(y){it(p,y),l=!1},d(y){p&&p.d(y)}}}function Ty(h){let l,c,p=h[0]&&sf(h);return{c(){p&&p.c(),l=ur()},l(y){p&&p.l(y),l=ur()},m(y,v){p&&p.m(y,v),Ze(y,l,v),c=!0},p(y,[v]){y[0]?p?(p.p(y,v),v&1&&We(p,1)):(p=sf(y),p.c(),We(p,1),p.m(l.parentNode,l)):p&&(vr(),it(p,1,1,()=>{p=null}),xr())},i(y){c||(We(p),c=!0)},o(y){it(p),c=!1},d(y){p&&p.d(y),y&&W(l)}}}function Sy(h=1e3){return new Promise(l=>setTimeout(l,h))}function Ay(h,l,c){let{$$slots:p={},$$scope:y}=l,{id:v}=l,{type:w}=l,{url:a=null}=l,{props:k={}}=l,{data:T=null}=l,{layer:D=null}=l,{promoteId:M=null}=l,{minzoom:A=null}=l,{maxzoom:N=null}=l,{tilesize:O=256}=l,G=!1,Q=a;const{getMap:te}=mi("map"),le=te();Ql("source",{source:v,layer:D,promoteId:M}),le.getSource(v)&&le.removeSource(v);async function he(){await Sy(100),le.isSourceLoaded(v)?(c(0,G=!0),console.log(v+" map source loaded!")):(console.log("..."),he())}A&&(k.minzoom=A),N&&(k.maxzoom=N),D&&M?(k.promoteId={},k.promoteId[D]=M):M&&(k.promoteId=M);function Y(){console.log(v+" map source loading...");let Le;w=="geojson"?T?Le={type:w,data:T,...k}:a&&(Le={type:w,data:a,...k}):w=="vector"?(Le={type:w,...k},a.slice(0,7)==="pmtiles"?Le.url=a:Le.tiles=[a]):w=="raster"?Le={type:w,tiles:[a],tileSize:O,...k}:w=="raster-dem"&&(Le={type:w,tiles:[a],tileSize:O,...k}),Le&&(console.log(Le),le.addSource(v,Le),he())}function _e(Le){let de=le.getSource(v);de&&de.setData(Le)}function re(Le){if(Le!==Q){let de=le.getSource(v);de&&(Le.slice(0,7)==="pmtiles"?de.setUrl(Le):de.setTiles([Le])),Q=Le}}function we(Le){Le!==Q&&(le.getSource(v).tiles=[Le],le.style.sourceCaches[v].clearTiles(),le.style.sourceCaches[v].update(le.transform),le.triggerRepaint(),Q=Le)}return ac(Y),yu(async()=>{le&&le.getSource(v)&&(le.getStyle().layers.filter(de=>de.source==v).forEach(de=>{le.removeLayer(de.id)}),le.removeSource(v))}),h.$$set=Le=>{"id"in Le&&c(2,v=Le.id),"type"in Le&&c(3,w=Le.type),"url"in Le&&c(4,a=Le.url),"props"in Le&&c(1,k=Le.props),"data"in Le&&c(5,T=Le.data),"layer"in Le&&c(6,D=Le.layer),"promoteId"in Le&&c(7,M=Le.promoteId),"minzoom"in Le&&c(8,A=Le.minzoom),"maxzoom"in Le&&c(9,N=Le.maxzoom),"tilesize"in Le&&c(10,O=Le.tilesize),"$$scope"in Le&&c(11,y=Le.$$scope)},h.$$.update=()=>{h.$$.dirty&41&&w=="geojson"&&G&&_e(T),h.$$.dirty&25&&w=="vector"&&G&&re(a),h.$$.dirty&25&&w=="raster"&&G&&we(a)},[G,k,v,w,a,T,D,M,A,N,O,y,p]}class Dy extends di{constructor(l){super(),fi(this,l,Ay,Ty,pi,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const Cy=h=>({hovered:h[0]&1}),of=h=>({hovered:h[0]});function zy(h){let l;const c=h[30].default,p=vu(c,h,h[29],of);return{c(){p&&p.c()},l(y){p&&p.l(y)},m(y,v){p&&p.m(y,v),l=!0},p(y,v){p&&p.p&&(!l||v[0]&536870913)&&xu(p,c,y,y[29],l?wu(c,y[29],v,Cy):bu(y[29]),of)},i(y){l||(We(p,y),l=!0)},o(y){it(p,y),l=!1},d(y){p&&p.d(y)}}}function My(h,l,c){let p,{$$slots:y={},$$scope:v}=l;const w=_u();let{id:a}=l,{type:k}=l,{filter:T=null}=l,{layout:D={}}=l,{paint:M={}}=l,{data:A=null}=l,{colorKey:N="color"}=l,{nameKey:O=null}=l,{valueKey:G=null}=l,{idKey:Q=null}=l,{select:te=!1}=l,{clickIgnore:le=!1}=l,{clickCenter:he=!1}=l,{selected:Y=null}=l,{hover:_e=!1}=l,{hovered:re=null}=l,{highlight:we=!1}=l,{highlightKey:Le="highlighted"}=l,{highlighted:de=[]}=l,{order:be=null}=l,{maxzoom:Te=null}=l,{minzoom:Ce=null}=l,{sourceLayer:rt=null}=l,{visible:nt=!0}=l;const{source:Ve,layer:Ue,promoteId:Oe}=mi("source"),{getMap:et}=mi("map"),tt=et();Ql("layer",{layer:a});const ft=eg({id:null,feature:null,event:null});Om(h,ft,Ye=>c(32,p=Ye)),Ql("hover",ft),Q=Q||Oe,rt=rt||Ue;let Gt=null,zt=null,Ke=[];D.visibility=nt?"visible":"none";let Tt={id:a,type:k,source:Ve,paint:M,layout:D};T&&(Tt.filter=T),rt&&(Tt["source-layer"]=rt),Te&&(Tt.maxzoom=Te),Ce&&(Tt.minzoom=Ce),ac(()=>{tt.getLayer(a)&&tt.removeLayer(a),tt.addLayer(Tt,be)});function Ct(Ye,Zt=N){if(console.log("updating colors..."),O||G)for(const He of Ye)tt.setFeatureState({source:Ve,sourceLayer:rt,id:He[Q]},{color:Zt?He[Zt]:null,name:O?He[O]:null,value:G?He[G]:null});else for(const He of Ye)tt.setFeatureState({source:Ve,sourceLayer:rt,id:He[Q]},{color:He[Zt]})}function ti(Ye){tt.getLayer(a)&&tt.setFilter(a,Ye)}function hi(Ye){if(tt.getLayer(a))for(const Zt in Ye)tt.setPaintProperty(a,Zt,Ye[Zt])}function _i(Ye){tt.getLayer(a)&&tt.setLayoutProperty(a,"visibility",Ye?"visible":"none")}return te&&tt.on("click",a,Ye=>{if(Ye.features.length>0&&!le){let Zt=Ye.features[0];if(c(2,Y=Zt.id),w("select",{id:Y,feature:Zt,event:Ye}),Gt&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:Gt},{selected:!1}),tt.setFeatureState({source:Ve,sourceLayer:rt,id:Y},{selected:!0}),he){let He=centroid(Ye.features[0].toJSON().geometry);tt.flyTo({center:He.geometry.coordinates})}c(26,Gt=Y)}}),_e&&(tt.on("mousemove",a,Ye=>{if(Ye.features.length>0){re&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:re},{hovered:!1});let Zt=Ye.features[0];c(0,re=c(27,zt=Zt.id)),ft.set({id:re,feature:Zt,event:Ye}),w("hover",p),tt.setFeatureState({source:Ve,sourceLayer:rt,id:re},{hovered:!0}),tt.getCanvas().style.cursor="pointer"}}),tt.on("mouseleave",a,Ye=>{re&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:re},{hovered:!1}),c(0,re=c(27,zt=null)),ft.set({id:null,feature:null,event:Ye}),w("hover",p),tt.getCanvas().style.cursor=""})),yu(async()=>{tt&&tt.getLayer(a)&&tt.removeLayer(a)}),h.$$set=Ye=>{"id"in Ye&&c(6,a=Ye.id),"type"in Ye&&c(7,k=Ye.type),"filter"in Ye&&c(8,T=Ye.filter),"layout"in Ye&&c(4,D=Ye.layout),"paint"in Ye&&c(9,M=Ye.paint),"data"in Ye&&c(10,A=Ye.data),"colorKey"in Ye&&c(11,N=Ye.colorKey),"nameKey"in Ye&&c(12,O=Ye.nameKey),"valueKey"in Ye&&c(13,G=Ye.valueKey),"idKey"in Ye&&c(5,Q=Ye.idKey),"select"in Ye&&c(14,te=Ye.select),"clickIgnore"in Ye&&c(15,le=Ye.clickIgnore),"clickCenter"in Ye&&c(16,he=Ye.clickCenter),"selected"in Ye&&c(2,Y=Ye.selected),"hover"in Ye&&c(17,_e=Ye.hover),"hovered"in Ye&&c(0,re=Ye.hovered),"highlight"in Ye&&c(18,we=Ye.highlight),"highlightKey"in Ye&&c(19,Le=Ye.highlightKey),"highlighted"in Ye&&c(20,de=Ye.highlighted),"order"in Ye&&c(21,be=Ye.order),"maxzoom"in Ye&&c(22,Te=Ye.maxzoom),"minzoom"in Ye&&c(23,Ce=Ye.minzoom),"sourceLayer"in Ye&&c(3,rt=Ye.sourceLayer),"visible"in Ye&&c(24,nt=Ye.visible),"$$scope"in Ye&&c(29,v=Ye.$$scope)},h.$$.update=()=>{if(h.$$.dirty[0]&3072&&A&&Ct(A,N),h.$$.dirty[0]&256&&ti(T),h.$$.dirty[0]&512&&hi(M),h.$$.dirty[0]&16777216&&_i(nt),h.$$.dirty[0]&270270472&&we&&de!=Ke){if(Ke[0])for(const Ye of Ke){let Zt={};Zt[Le]=!1,tt.setFeatureState({source:Ve,sourceLayer:rt,id:Ye},Zt)}if(c(28,Ke=de),de[0])for(const Ye of de){let Zt={};Zt[Le]=!0,tt.setFeatureState({source:Ve,sourceLayer:rt,id:Ye},Zt)}}h.$$.dirty[0]&67125260&&te&&Y!=Gt&&(Gt&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:Gt},{selected:!1}),Y&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:Y},{selected:!0}),c(26,Gt=Y)),h.$$.dirty[0]&134348809&&_e&&re!=zt&&(zt&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:zt},{hovered:!1}),re&&tt.setFeatureState({source:Ve,sourceLayer:rt,id:re},{hovered:!0}),c(27,zt=re))},[re,ft,Y,rt,D,Q,a,k,T,M,A,N,O,G,te,le,he,_e,we,Le,de,be,Te,Ce,nt,Ct,Gt,zt,Ke,v,y]}class lf extends di{constructor(l){super(),fi(this,l,My,zy,pi,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function cf(h){let l,c;return l=new Dy({props:{id:"geojson",type:"geojson",data:h[3],promoteId:"areacd",$$slots:{default:[Py]},$$scope:{ctx:h}}}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p(p,y){const v={};y&8&&(v.data=p[3]),y&16777235&&(v.$$scope={dirty:y,ctx:p}),l.$set(v)},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function uf(h){let l,c,p,y;return l=new lf({props:{id:"fill",type:"fill",data:h[4],idKey:"id",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]},hover:!0,hovered:h[1],select:!0,selected:h[0]}}),l.$on("hover",h[16]),l.$on("select",h[17]),p=new lf({props:{id:"line",type:"line",paint:{"line-color":"black"}}}),{c(){Vt(l.$$.fragment),c=vt(),Vt(p.$$.fragment)},l(v){Ut(l.$$.fragment,v),c=xt(v),Ut(p.$$.fragment,v)},m(v,w){Nt(l,v,w),Ze(v,c,w),Nt(p,v,w),y=!0},p(v,w){const a={};w&16&&(a.data=v[4]),w&2&&(a.hovered=v[1]),w&1&&(a.selected=v[0]),l.$set(a)},i(v){y||(We(l.$$.fragment,v),We(p.$$.fragment,v),y=!0)},o(v){it(l.$$.fragment,v),it(p.$$.fragment,v),y=!1},d(v){qt(l,v),v&&W(c),qt(p,v)}}}function Py(h){let l,c,p=h[4]&&uf(h);return{c(){p&&p.c(),l=ur()},l(y){p&&p.l(y),l=ur()},m(y,v){p&&p.m(y,v),Ze(y,l,v),c=!0},p(y,v){y[4]?p?(p.p(y,v),v&16&&We(p,1)):(p=uf(y),p.c(),We(p,1),p.m(l.parentNode,l)):p&&(vr(),it(p,1,1,()=>{p=null}),xr())},i(y){c||(We(p),c=!0)},o(y){it(p),c=!1},d(y){p&&p.d(y),y&&W(l)}}}function Ly(h){let l,c,p=h[3]&&cf(h);return{c(){p&&p.c(),l=ur()},l(y){p&&p.l(y),l=ur()},m(y,v){p&&p.m(y,v),Ze(y,l,v),c=!0},p(y,v){y[3]?p?(p.p(y,v),v&8&&We(p,1)):(p=cf(y),p.c(),We(p,1),p.m(l.parentNode,l)):p&&(vr(),it(p,1,1,()=>{p=null}),xr())},i(y){c||(We(p),c=!0)},o(y){it(p),c=!1},d(y){p&&p.d(y),y&&W(l)}}}function Ry(h){let l,c,p;return c=new Ey({props:{location:{bounds:h[5][h[2]]},controls:!0,style:"https://bothness.github.io/ons-basemaps/data/style-omt.json",$$slots:{default:[Ly]},$$scope:{ctx:h}}}),{c(){l=qe("div"),Vt(c.$$.fragment),this.h()},l(y){l=Ge(y,"DIV",{class:!0});var v=me(l);Ut(c.$$.fragment,v),v.forEach(W),this.h()},h(){S(l,"class","map-container svelte-14fcb2l")},m(y,v){Ze(y,l,v),Nt(c,l,null),p=!0},p(y,[v]){const w={};v&4&&(w.location={bounds:y[5][y[2]]}),v&16777243&&(w.$$scope={dirty:v,ctx:y}),c.$set(w)},i(y){p||(We(c.$$.fragment,y),p=!0)},o(y){it(c.$$.fragment,y),p=!1},d(y){y&&W(l),qt(c)}}}function By(h,l,c){let{geoType:p="ltla"}=l,{year:y=2023}=l,{data:v=[]}=l,{idKey:w="areacd"}=l,{valueKey:a="value"}=l,{colorsInit:k=["#b2182b","#d6604d","#fddbc7","#d1e5f0","#4393c3","#2166ac"]}=l,{selected:T=null}=l,{hovered:D=null}=l,{mapRange:M="uk"}=l,{colourObj:A}=l,{useBreaks:N=!0}=l,{breaks:O}=l,{polarity:G=1}=l,Q,te,le,he=G==-1?k.slice().reverse():k;const Y={uk:[[-9,49],[2,61]],ew:[[-6,50],[2,56]]};function _e(Te,Ce,rt){if(N){for(let nt=1;nt<Ce.length;nt++)if(Te<Ce[nt])return rt[nt-1];return rt[rt.length-1]}else return A[Te]}function re(Te,Ce,rt,nt){let Ve=Te.map(Oe=>({id:Oe[Ce],value:Oe[rt]})),Ue=Ve.map(Oe=>Oe.value).sort((Oe,et)=>Oe-et);return c(6,O=Jm(Ue)),Ve.forEach(Oe=>Oe.color=_e(Oe.value,O,nt)),{mapdata:Ve,breaks:O}}function we(Te,Ce,rt,nt){const Ve=re(Te,Ce,rt,nt);c(6,O=Ve.breaks),c(4,le=Ve.mapdata)}function Le(Te,Ce){if(Q){const rt=ng(Q,Te);rt.features=rt.features.filter(nt=>!0),c(3,te=rt)}}ac(async()=>{Q=await(await fetch(`${du}/data/topojson/topo.json`)).json(),Le(p)});function de(Te){Uo.call(this,h,Te)}function be(Te){Uo.call(this,h,Te)}return h.$$set=Te=>{"geoType"in Te&&c(7,p=Te.geoType),"year"in Te&&c(8,y=Te.year),"data"in Te&&c(9,v=Te.data),"idKey"in Te&&c(10,w=Te.idKey),"valueKey"in Te&&c(11,a=Te.valueKey),"colorsInit"in Te&&c(12,k=Te.colorsInit),"selected"in Te&&c(0,T=Te.selected),"hovered"in Te&&c(1,D=Te.hovered),"mapRange"in Te&&c(2,M=Te.mapRange),"colourObj"in Te&&c(13,A=Te.colourObj),"useBreaks"in Te&&c(14,N=Te.useBreaks),"breaks"in Te&&c(6,O=Te.breaks),"polarity"in Te&&c(15,G=Te.polarity)},h.$$.update=()=>{h.$$.dirty&3584&&we(v,w,a,he),h.$$.dirty&384&&Le(p)},[T,D,M,te,le,Y,O,p,y,v,w,a,k,A,N,G,de,be]}class qf extends di{constructor(l){super(),fi(this,l,By,Ry,pi,{geoType:7,year:8,data:9,idKey:10,valueKey:11,colorsInit:12,selected:0,hovered:1,mapRange:2,colourObj:13,useBreaks:14,breaks:6,polarity:15})}}function hf(h,l,c){const p=h.slice();return p[10]=l[c],p[12]=c,p}function df(h){let l,c,p,y=h[2].filter(w).length+" areas belong to the <span style='font-weight: bold; color:"+h[3][h[10]]+"'>"+h[1].find(a).alternativeDescription.toLowerCase()+"</span> cluster.",v;function w(...k){return h[4](h[10],...k)}function a(...k){return h[5](h[10],...k)}return{c(){l=qe("div"),c=qe("div"),p=qe("p"),v=vt(),this.h()},l(k){l=Ge(k,"DIV",{class:!0,style:!0});var T=me(l);c=Ge(T,"DIV",{class:!0,style:!0});var D=me(c);p=Ge(D,"P",{class:!0});var M=me(p);M.forEach(W),D.forEach(W),v=xt(T),T.forEach(W),this.h()},h(){S(p,"class","svelte-1ertk7d"),S(c,"class","cluster svelte-1ertk7d"),Bt(c,"border-left-style","solid"),Bt(c,"border-left-color",h[3][h[10]]),Bt(c,"border-left-width","5px"),S(l,"class","cluster-container svelte-1ertk7d"),Bt(l,"background-color",h[12]%2===0?"#fafafa":"#ffffff")},m(k,T){Ze(k,l,T),se(l,c),se(c,p),p.innerHTML=y,se(l,v)},p(k,T){h=k},d(k){k&&W(l)}}}function Fy(h){let l,c,p,y,v,w,a,k,T,D,M,A,N,O,G,Q,te,le,he=[...new Set(h[2].map(ff))].sort(pf),Y=[];for(let _e=0;_e<he.length;_e+=1)Y[_e]=df(hf(h,he,_e));return te=new qf({props:{data:h[2],idKey:"areacd",valueKey:"value",mapRange:"ew",useBreaks:!1,colourObj:h[3]}}),{c(){l=qe("div"),c=qe("div"),p=qe("div"),y=vt(),v=qe("div"),w=qe("p"),a=Mt("On this map, areas with similar local data on the "),k=Mt(h[0]),T=Mt(" have been grouped into clusters."),D=vt(),M=qe("p"),A=qe("a"),N=Mt("Learn more about the Office for National Statistics' clustering analysis."),O=vt(),G=qe("div");for(let _e=0;_e<Y.length;_e+=1)Y[_e].c();Q=vt(),Vt(te.$$.fragment),this.h()},l(_e){l=Ge(_e,"DIV",{class:!0});var re=me(l);c=Ge(re,"DIV",{class:!0});var we=me(c);p=Ge(we,"DIV",{class:!0});var Le=me(p);Le.forEach(W),y=xt(we),v=Ge(we,"DIV",{class:!0});var de=me(v);w=Ge(de,"P",{style:!0,class:!0});var be=me(w);a=Pt(be,"On this map, areas with similar local data on the "),k=Pt(be,h[0]),T=Pt(be," have been grouped into clusters."),be.forEach(W),D=xt(de),M=Ge(de,"P",{class:!0});var Te=me(M);A=Ge(Te,"A",{target:!0,href:!0});var Ce=me(A);N=Pt(Ce,"Learn more about the Office for National Statistics' clustering analysis."),Ce.forEach(W),Te.forEach(W),de.forEach(W),O=xt(we),G=Ge(we,"DIV",{class:!0});var rt=me(G);for(let nt=0;nt<Y.length;nt+=1)Y[nt].l(rt);rt.forEach(W),we.forEach(W),Q=xt(re),Ut(te.$$.fragment,re),re.forEach(W),this.h()},h(){S(p,"class","select-areas-container"),Bt(w,"margin-bottom","10px"),S(w,"class","svelte-1ertk7d"),S(A,"target","_blank"),S(A,"href","https://www.ons.gov.uk/peoplepopulationandcommunity/wellbeing/articles/clusteringlocalauthoritiesagainstsubnationalindicatorsengland/2023-02-24"),S(M,"class","svelte-1ertk7d"),S(v,"class","cluster-info svelte-1ertk7d"),S(G,"class","clusters-desc-container svelte-1ertk7d"),S(c,"class","legend-container svelte-1ertk7d"),S(l,"class","legend-and-map-container svelte-1ertk7d")},m(_e,re){Ze(_e,l,re),se(l,c),se(c,p),se(c,y),se(c,v),se(v,w),se(w,a),se(w,k),se(w,T),se(v,D),se(v,M),se(M,A),se(A,N),se(c,O),se(c,G);for(let we=0;we<Y.length;we+=1)Y[we]&&Y[we].m(G,null);se(l,Q),Nt(te,l,null),le=!0},p(_e,[re]){if((!le||re&1)&&$i(k,_e[0]),re&14){he=[...new Set(_e[2].map(ff))].sort(pf);let we;for(we=0;we<he.length;we+=1){const Le=hf(_e,he,we);Y[we]?Y[we].p(Le,re):(Y[we]=df(Le),Y[we].c(),Y[we].m(G,null))}for(;we<Y.length;we+=1)Y[we].d(1);Y.length=he.length}},i(_e){le||(We(te.$$.fragment,_e),le=!0)},o(_e){it(te.$$.fragment,_e),le=!1},d(_e){_e&&W(l),Gi(Y,_e),qt(te)}}}const ff=h=>h.value,pf=(h,l)=>h-l;function Oy(h,l,c){let{clusterName:p}=l,y=mi("clustersInfo"),v=mi("clustersLookup").filter(A=>A.model==p),a=mi("areasGeogLevel").filter(A=>A.areacd[0]==="E").filter(A=>["both","lower"].includes(A.level)).map(A=>A.areacd),k=y.filter(A=>a.includes(A.areacd)).map(A=>({areacd:A.areacd,value:A[p]})).filter(A=>A.value!=""&A.value!=null),T=Wm[4];const D=(A,N)=>N.value===A,M=(A,N)=>N.id==A;return h.$$set=A=>{"clusterName"in A&&c(0,p=A.clusterName)},[p,v,k,T,D,M]}class Vy extends di{constructor(l){super(),fi(this,l,Oy,Fy,pi,{clusterName:0})}}function mf(h,l,c){const p=h.slice();return p[6]=l[c],p[8]=c,p}function gf(h){let l,c=h[6]+"",p,y;return{c(){l=qe("option"),p=Mt(c),this.h()},l(v){l=Ge(v,"OPTION",{});var w=me(l);p=Pt(w,c),w.forEach(W),this.h()},h(){l.__value=y=h[6],l.value=l.__value},m(v,w){Ze(v,l,w),se(l,p)},p(v,w){w&4&&c!==(c=v[6]+"")&&$i(p,c),w&4&&y!==(y=v[6])&&(l.__value=y,l.value=l.__value)},d(v){v&&W(l)}}}function Uy(h){let l,c,p,y,v,w,a=h[2],k=[];for(let T=0;T<a.length;T+=1)k[T]=gf(mf(h,a,T));return{c(){l=qe("div"),c=qe("select");for(let T=0;T<k.length;T+=1)k[T].c();this.h()},l(T){l=Ge(T,"DIV",{class:!0,style:!0});var D=me(l);c=Ge(D,"SELECT",{style:!0,id:!0,name:!0,class:!0});var M=me(c);for(let A=0;A<k.length;A+=1)k[A].l(M);M.forEach(W),D.forEach(W),this.h()},h(){Bt(c,"text-wrap","wrap"),S(c,"id",h[1]),S(c,"name",h[1]),S(c,"class",p=Tr("ons-input ons-input--select"+(h[4]?" low-height":""))+" svelte-16qh37z"),h[0]===void 0&&ku(()=>h[5].call(c)),S(l,"class","ons-field"),S(l,"style",y="width: "+h[3])},m(T,D){Ze(T,l,D),se(l,c);for(let M=0;M<k.length;M+=1)k[M]&&k[M].m(c,null);Jh(c,h[0],!0),v||(w=wf(c,"change",h[5]),v=!0)},p(T,[D]){if(D&4){a=T[2];let M;for(M=0;M<a.length;M+=1){const A=mf(T,a,M);k[M]?k[M].p(A,D):(k[M]=gf(A),k[M].c(),k[M].m(c,null))}for(;M<k.length;M+=1)k[M].d(1);k.length=a.length}D&2&&S(c,"id",T[1]),D&2&&S(c,"name",T[1]),D&16&&p!==(p=Tr("ons-input ons-input--select"+(T[4]?" low-height":""))+" svelte-16qh37z")&&S(c,"class",p),D&5&&Jh(c,T[0]),D&8&&y!==(y="width: "+T[3])&&S(l,"style",y)},i:zi,o:zi,d(T){T&&W(l),Gi(k,T),v=!1,w()}}}function Ny(h,l,c){let{chosenId:p,name:y="",optionsArray:v,width:w=null,lowHeight:a=!1}=l;function k(){p=Vm(this),c(0,p),c(2,v)}return h.$$set=T=>{"chosenId"in T&&c(0,p=T.chosenId),"name"in T&&c(1,y=T.name),"optionsArray"in T&&c(2,v=T.optionsArray),"width"in T&&c(3,w=T.width),"lowHeight"in T&&c(4,a=T.lowHeight)},[p,y,v,w,a,k]}class Su extends di{constructor(l){super(),fi(this,l,Ny,Uy,pi,{chosenId:0,name:1,optionsArray:2,width:3,lowHeight:4})}}function _f(h,l,c){const p=h.slice();return p[9]=l[c],p[11]=c,p}function qy(h){let l,c=h[4]+tc(ic(h[9],h[1].decimalPlaces))+h[3]+"",p,y;return{c(){l=ct("text"),p=Mt(c),this.h()},l(v){l=ut(v,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,stroke:!0,fill:!0,"stroke-width":!0});var w=me(l);p=Pt(w,c),w.forEach(W),this.h()},h(){S(l,"x",y=h[11]*(h[2]-20)/h[0].length),S(l,"y","45"),S(l,"text-anchor","middle"),S(l,"font-size","14px"),S(l,"stroke","black"),S(l,"fill","black"),S(l,"stroke-width","0.5px")},m(v,w){Ze(v,l,w),se(l,p)},p(v,w){w&27&&c!==(c=v[4]+tc(ic(v[9],v[1].decimalPlaces))+v[3]+"")&&$i(p,c),w&5&&y!==(y=v[11]*(v[2]-20)/v[0].length)&&S(l,"x",y)},d(v){v&&W(l)}}}function yf(h){let l,c,p,y,v,w,a,k,T=h[11]>0&&qy(h);return{c(){l=ct("rect"),v=ct("line"),T&&T.c(),k=ur(),this.h()},l(D){l=ut(D,"rect",{x:!0,width:!0,y:!0,height:!0,stroke:!0,fill:!0});var M=me(l);M.forEach(W),v=ut(D,"line",{x1:!0,x2:!0,y1:!0,y2:!0,"stroke-width":!0,stroke:!0}),me(v).forEach(W),T&&T.l(D),k=ur(),this.h()},h(){S(l,"x",c=h[11]*(h[2]-20)/h[0].length),S(l,"width",p=(h[2]-20)/h[0].length),S(l,"y","0"),S(l,"height","20"),S(l,"stroke","none"),S(l,"fill",y=h[5][h[11]]),S(v,"x1",w=h[11]*(h[2]-20)/h[0].length),S(v,"x2",a=h[11]*(h[2]-20)/h[0].length),S(v,"y1","0"),S(v,"y2","30"),S(v,"stroke-width","2px"),S(v,"stroke","black")},m(D,M){Ze(D,l,M),Ze(D,v,M),T&&T.m(D,M),Ze(D,k,M)},p(D,M){M&5&&c!==(c=D[11]*(D[2]-20)/D[0].length)&&S(l,"x",c),M&5&&p!==(p=(D[2]-20)/D[0].length)&&S(l,"width",p),M&32&&y!==(y=D[5][D[11]])&&S(l,"fill",y),M&5&&w!==(w=D[11]*(D[2]-20)/D[0].length)&&S(v,"x1",w),M&5&&a!==(a=D[11]*(D[2]-20)/D[0].length)&&S(v,"x2",a),D[11]>0&&T.p(D,M)},d(D){D&&W(l),D&&W(v),T&&T.d(D),D&&W(k)}}}function Gy(h){let l,c,p,y,v,w,a,k=h[0],T=[];for(let D=0;D<k.length;D+=1)T[D]=yf(_f(h,k,D));return{c(){l=qe("div"),c=ct("svg"),p=ct("g");for(let D=0;D<T.length;D+=1)T[D].c();y=ct("line"),this.h()},l(D){l=Ge(D,"DIV",{class:!0});var M=me(l);c=ut(M,"svg",{width:!0,height:!0});var A=me(c);p=ut(A,"g",{transform:!0});var N=me(p);for(let O=0;O<T.length;O+=1)T[O].l(N);y=ut(N,"line",{x1:!0,x2:!0,y1:!0,y2:!0,"stroke-width":!0,stroke:!0}),me(y).forEach(W),N.forEach(W),A.forEach(W),M.forEach(W),this.h()},h(){S(y,"x1",v=h[2]-20),S(y,"x2",w=h[2]-20),S(y,"y1","0"),S(y,"y2","30"),S(y,"stroke-width","2px"),S(y,"stroke","black"),S(p,"transform","translate(10,10)"),S(c,"width",h[2]),S(c,"height",h[6]),S(l,"class","svg-container"),ku(()=>h[7].call(l))},m(D,M){Ze(D,l,M),se(l,c),se(c,p);for(let A=0;A<T.length;A+=1)T[A]&&T[A].m(p,null);se(p,y),a=kf(l,h[7].bind(l))},p(D,[M]){if(M&63){k=D[0];let A;for(A=0;A<k.length;A+=1){const N=_f(D,k,A);T[A]?T[A].p(N,M):(T[A]=yf(N),T[A].c(),T[A].m(p,y))}for(;A<T.length;A+=1)T[A].d(1);T.length=k.length}M&4&&v!==(v=D[2]-20)&&S(y,"x1",v),M&4&&w!==(w=D[2]-20)&&S(y,"x2",w),M&4&&S(c,"width",D[2])},i:zi,o:zi,d(D){D&&W(l),Gi(T,D),a()}}}function jy(h,l,c){let p,y,v,{breaks:w,metadata:a}=l,k=400,T=60,D=["#b2182b","#d6604d","#fddbc7","#d1e5f0","#4393c3","#2166ac"];function M(){k=this.clientWidth,c(2,k)}return h.$$set=A=>{"breaks"in A&&c(0,w=A.breaks),"metadata"in A&&c(1,a=A.metadata)},h.$$.update=()=>{h.$$.dirty&2&&c(5,p=a.polarity==-1?D.slice().reverse():D),h.$$.dirty&2&&c(4,y=a.prefix===null?"":a.prefix),h.$$.dirty&2&&c(3,v=a.suffix===null?"":a.suffix)},[w,a,k,v,y,p,T,M]}class Zy extends di{constructor(l){super(),fi(this,l,jy,Gy,pi,{breaks:0,metadata:1})}}function Xy(h){let l=h[4][0]+"",c;return{c(){c=Mt(l)},l(p){c=Pt(p,l)},m(p,y){Ze(p,c,y)},p(p,y){y&16&&l!==(l=p[4][0]+"")&&$i(c,l)},i:zi,o:zi,d(p){p&&W(c)}}}function Wy(h){let l,c,p,y,v;function w(k){h[14](k)}let a={name:"select-time-period-dropdown",optionsArray:h[4],width:"120px",lowHeight:!0};return h[0]!==void 0&&(a.chosenId=h[0]),p=new Su({props:a}),gi.push(()=>bi(p,"chosenId",w)),{c(){l=qe("span"),c=qe("div"),Vt(p.$$.fragment),this.h()},l(k){l=Ge(k,"SPAN",{});var T=me(l);c=Ge(T,"DIV",{class:!0});var D=me(c);Ut(p.$$.fragment,D),D.forEach(W),T.forEach(W),this.h()},h(){S(c,"class","dropdown-container svelte-18064lb")},m(k,T){Ze(k,l,T),se(l,c),Nt(p,c,null),v=!0},p(k,T){const D={};T&16&&(D.optionsArray=k[4]),!y&&T&1&&(y=!0,D.chosenId=k[0],wi(()=>y=!1)),p.$set(D)},i(k){v||(We(p.$$.fragment,k),v=!0)},o(k){it(p.$$.fragment,k),v=!1},d(k){k&&W(l),qt(p)}}}function vf(h){let l,c,p;function y(w){h[15](w)}let v={data:h[3],idKey:"areacd",valueKey:"value",mapRange:"uk",useBreaks:!0,polarity:h[5].polarity};return h[2]!==void 0&&(v.breaks=h[2]),l=new qf({props:v}),gi.push(()=>bi(l,"breaks",y)),{c(){Vt(l.$$.fragment)},l(w){Ut(l.$$.fragment,w)},m(w,a){Nt(l,w,a),p=!0},p(w,a){const k={};a&8&&(k.data=w[3]),a&32&&(k.polarity=w[5].polarity),!c&&a&4&&(c=!0,k.breaks=w[2],wi(()=>c=!1)),l.$set(k)},i(w){p||(We(l.$$.fragment,w),p=!0)},o(w){it(l.$$.fragment,w),p=!1},d(w){qt(l,w)}}}function Hy(h){let l,c,p,y,v,w,a,k,T,D=h[5].subtitle+" in",M,A,N,O,G,Q,te,le,he;function Y(be){h[13](be)}let _e={name:"select-indicator-dropdown",optionsArray:h[6],width:"300px"};h[1]!==void 0&&(_e.chosenId=h[1]),v=new Su({props:_e}),gi.push(()=>bi(v,"chosenId",Y));const re=[Wy,Xy],we=[];function Le(be,Te){return be[4].length>1?0:1}N=Le(h),O=we[N]=re[N](h),te=new Zy({props:{breaks:h[2],metadata:h[5]}});let de=h[3]&&vf(h);return{c(){l=qe("div"),c=qe("div"),p=qe("div"),y=qe("div"),Vt(v.$$.fragment),a=vt(),k=qe("div"),T=qe("p"),M=Mt(D),A=vt(),O.c(),G=vt(),Q=qe("div"),Vt(te.$$.fragment),le=vt(),de&&de.c(),this.h()},l(be){l=Ge(be,"DIV",{class:!0});var Te=me(l);c=Ge(Te,"DIV",{class:!0});var Ce=me(c);p=Ge(Ce,"DIV",{class:!0});var rt=me(p);y=Ge(rt,"DIV",{class:!0});var nt=me(y);Ut(v.$$.fragment,nt),nt.forEach(W),rt.forEach(W),a=xt(Ce),k=Ge(Ce,"DIV",{class:!0});var Ve=me(k);T=Ge(Ve,"P",{class:!0});var Ue=me(T);M=Pt(Ue,D),A=xt(Ue),O.l(Ue),Ue.forEach(W),Ve.forEach(W),G=xt(Ce),Q=Ge(Ce,"DIV",{class:!0});var Oe=me(Q);Ut(te.$$.fragment,Oe),Oe.forEach(W),Ce.forEach(W),le=xt(Te),de&&de.l(Te),Te.forEach(W),this.h()},h(){S(y,"class","dropdown-container svelte-18064lb"),S(p,"class","title-container svelte-18064lb"),S(T,"class","svelte-18064lb"),S(k,"class","subtitle-container svelte-18064lb"),S(Q,"class","map-scale-container svelte-18064lb"),S(c,"class","legend-container svelte-18064lb"),S(l,"class","legend-and-map-container svelte-18064lb")},m(be,Te){Ze(be,l,Te),se(l,c),se(c,p),se(p,y),Nt(v,y,null),se(c,a),se(c,k),se(k,T),se(T,M),se(T,A),we[N].m(T,null),se(c,G),se(c,Q),Nt(te,Q,null),se(l,le),de&&de.m(l,null),he=!0},p(be,[Te]){const Ce={};!w&&Te&2&&(w=!0,Ce.chosenId=be[1],wi(()=>w=!1)),v.$set(Ce),(!he||Te&32)&&D!==(D=be[5].subtitle+" in")&&$i(M,D);let rt=N;N=Le(be),N===rt?we[N].p(be,Te):(vr(),it(we[rt],1,1,()=>{we[rt]=null}),xr(),O=we[N],O?O.p(be,Te):(O=we[N]=re[N](be),O.c()),We(O,1),O.m(T,null));const nt={};Te&4&&(nt.breaks=be[2]),Te&32&&(nt.metadata=be[5]),te.$set(nt),be[3]?de?(de.p(be,Te),Te&8&&We(de,1)):(de=vf(be),de.c(),We(de,1),de.m(l,null)):de&&(vr(),it(de,1,1,()=>{de=null}),xr())},i(be){he||(We(v.$$.fragment,be),We(O),We(te.$$.fragment,be),We(de),he=!0)},o(be){it(v.$$.fragment,be),it(O),it(te.$$.fragment,be),it(de),he=!1},d(be){be&&W(l),qt(v),we[N].d(),qt(te),de&&de.d()}}}function Ky(h,l,c){let p,y,v,w,a,k,T,{indicatorsList:D,latestData:M,initialData:A,otherData:N}=l,O=mi("indicatorsMetadata"),G=mi("indicators").filter(de=>D.includes(de.id)),Q=mi("indicatorsCalculations").filter(de=>D.includes(de.id)),te=mi("periodsLookup"),he=mi("areasGeogLevel").filter(de=>["both","lower"].includes(de.level)).map(de=>de.areacd),Y=G.map(de=>de.label),_e=[];function re(de){p=de,c(1,p),c(6,Y)}function we(de){k=de,c(0,k),c(19,te),c(18,Q),c(12,y),c(17,G),c(1,p),c(6,Y)}function Le(de){_e=de,c(2,_e)}return h.$$set=de=>{"indicatorsList"in de&&c(7,D=de.indicatorsList),"latestData"in de&&c(8,M=de.latestData),"initialData"in de&&c(9,A=de.initialData),"otherData"in de&&c(10,N=de.otherData)},h.$$.update=()=>{h.$$.dirty&2&&c(12,y=G.find(de=>de.label==p).id),h.$$.dirty&2&&c(5,v=O.find(de=>de.label==p)),h.$$.dirty&5888&&c(11,w=[...M.filter(de=>de.id===y),..."indicator-"+y in A?A["indicator-"+y]:[],..."indicator-"+y in N?N["indicator-"+y]:[]]),h.$$.dirty&2048&&c(4,a=[...new Set(w.map(de=>de.xDomainNumb))].sort((de,be)=>be-de).map(de=>te.find(be=>be.xDomainNumb==de).label)),h.$$.dirty&4096&&c(0,k=te.find(de=>de.xDomainNumb==Q.find(be=>be.id==y).maxXDomain).label),h.$$.dirty&1&&console.log(k),h.$$.dirty&2049&&c(3,T=k!=null?w.filter(de=>he.includes(de.areacd)&de.xDomainNumb===te.find(be=>be.label==k).xDomainNumb):null)},c(1,p=Y[0]),[k,p,_e,T,a,v,Y,D,M,A,N,w,y,re,we,Le]}class Jy extends di{constructor(l){super(),fi(this,l,Ky,Hy,pi,{indicatorsList:7,latestData:8,initialData:9,otherData:10})}}class Yy extends di{constructor(l){super(),fi(this,l,null,null,pi,{})}}function Qy(h){let l,c;return l=new Jy({props:{indicatorsList:h[1],latestData:h[2],initialData:h[3],otherData:h[4]}}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p(p,y){const v={};y&2&&(v.indicatorsList=p[1]),y&4&&(v.latestData=p[2]),y&8&&(v.initialData=p[3]),y&16&&(v.otherData=p[4]),l.$set(v)},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function $y(h){let l,c;return l=new Yy({}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p:zi,i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function e0(h){let l,c;return l=new Vy({props:{clusterName:h[0]}}),{c(){Vt(l.$$.fragment)},l(p){Ut(l.$$.fragment,p)},m(p,y){Nt(l,p,y),c=!0},p(p,y){const v={};y&1&&(v.clusterName=p[0]),l.$set(v)},i(p){c||(We(l.$$.fragment,p),c=!0)},o(p){it(l.$$.fragment,p),c=!1},d(p){qt(l,p)}}}function t0(h){let l,c,p,y,v,w,a;function k(N){h[7](N)}let T={asButtons:!0,name:"selectMapOption",optionsArray:h[6]};h[5]!==void 0&&(T.chosenId=h[5]),l=new qo({props:T}),gi.push(()=>bi(l,"chosenId",k));const D=[e0,$y,Qy],M=[];function A(N,O){return N[5]==0?0:N[5]==1?1:N[5]==2?2:-1}return~(v=A(h))&&(w=M[v]=D[v](h)),{c(){Vt(l.$$.fragment),p=vt(),y=qe("div"),w&&w.c(),this.h()},l(N){Ut(l.$$.fragment,N),p=xt(N),y=Ge(N,"DIV",{class:!0});var O=me(y);w&&w.l(O),O.forEach(W),this.h()},h(){S(y,"class","map-container svelte-16d1m22")},m(N,O){Nt(l,N,O),Ze(N,p,O),Ze(N,y,O),~v&&M[v].m(y,null),a=!0},p(N,[O]){const G={};!c&&O&32&&(c=!0,G.chosenId=N[5],wi(()=>c=!1)),l.$set(G);let Q=v;v=A(N),v===Q?~v&&M[v].p(N,O):(w&&(vr(),it(M[Q],1,1,()=>{M[Q]=null}),xr()),~v?(w=M[v],w?w.p(N,O):(w=M[v]=D[v](N),w.c()),We(w,1),w.m(y,null)):w=null)},i(N){a||(We(l.$$.fragment,N),We(w),a=!0)},o(N){it(l.$$.fragment,N),it(w),a=!1},d(N){qt(l,N),N&&W(p),N&&W(y),~v&&M[v].d()}}}function i0(h,l,c){let{topicName:p,indicatorsList:y,latestData:v,initialData:w,otherData:a}=l,k=0,T=[...Object.keys(ec).filter(M=>ec[M]===p).map(M=>rc(M)+" cluster"),rc(p)+" summary","Map an indicator"];function D(M){k=M,c(5,k)}return h.$$set=M=>{"topicName"in M&&c(0,p=M.topicName),"indicatorsList"in M&&c(1,y=M.indicatorsList),"latestData"in M&&c(2,v=M.latestData),"initialData"in M&&c(3,w=M.initialData),"otherData"in M&&c(4,a=M.otherData)},[p,y,v,w,a,k,T,D]}class r0 extends di{constructor(l){super(),fi(this,l,i0,t0,pi,{topicName:0,indicatorsList:1,latestData:2,initialData:3,otherData:4})}}function n0(h){let l,c,p,y,v,w,a,k;function T(A){h[21](A)}function D(A){h[22](A)}let M={width:h[17]-h[9],index:h[6],outerPadding:h[10],data:h[2],medianValue:h[4],medianAbsoluteDeviation:h[8],metadata:h[5],y:h[14],x:h[15],height:h[16],checkboxedRoles:h[7],chartHeight:h[12],chartWidth:h[11],spaceForAreasBeyondScale:h[13],showGroupMedianLine:!0};return h[0]!==void 0&&(M.xDomainGlobal=h[0]),h[1]!==void 0&&(M.hoverIndex=h[1]),v=new Gm({props:M}),gi.push(()=>bi(v,"xDomainGlobal",T)),gi.push(()=>bi(v,"hoverIndex",D)),{c(){l=qe("div"),c=qe("p"),p=Mt(h[3]),y=vt(),Vt(v.$$.fragment),this.h()},l(A){l=Ge(A,"DIV",{class:!0,style:!0});var N=me(l);c=Ge(N,"P",{class:!0,style:!0});var O=me(c);p=Pt(O,h[3]),O.forEach(W),y=xt(N),Ut(v.$$.fragment,N),N.forEach(W),this.h()},h(){S(c,"class","col1 svelte-8a6c7s"),Bt(c,"width",h[9]),S(l,"class","row svelte-8a6c7s"),Bt(l,"background-color",h[6]%2===0?"#fafafa":"#ffffff")},m(A,N){Ze(A,l,N),se(l,c),se(c,p),se(l,y),Nt(v,l,null),k=!0},p(A,[N]){(!k||N&8)&&$i(p,A[3]),(!k||N&512)&&Bt(c,"width",A[9]);const O={};N&131584&&(O.width=A[17]-A[9]),N&64&&(O.index=A[6]),N&1024&&(O.outerPadding=A[10]),N&4&&(O.data=A[2]),N&16&&(O.medianValue=A[4]),N&256&&(O.medianAbsoluteDeviation=A[8]),N&32&&(O.metadata=A[5]),N&16384&&(O.y=A[14]),N&32768&&(O.x=A[15]),N&65536&&(O.height=A[16]),N&128&&(O.checkboxedRoles=A[7]),N&4096&&(O.chartHeight=A[12]),N&2048&&(O.chartWidth=A[11]),N&8192&&(O.spaceForAreasBeyondScale=A[13]),!w&&N&1&&(w=!0,O.xDomainGlobal=A[0],wi(()=>w=!1)),!a&&N&2&&(a=!0,O.hoverIndex=A[1],wi(()=>a=!1)),v.$set(O),(!k||N&64)&&Bt(l,"background-color",A[6]%2===0?"#fafafa":"#ffffff")},i(A){k||(We(v.$$.fragment,A),k=!0)},o(A){it(v.$$.fragment,A),k=!1},d(A){A&&W(l),qt(v)}}}function a0(h,l,c){let{data:p,name:y,medianValue:v,metadata:w,index:a,checkboxedRoles:k,deviations:T,medianAbsoluteDeviation:D,col1Width:M,outerPadding:A,chartWidth:N,chartHeight:O,spaceForAreasBeyondScale:G,y:Q,yDomain:te,xDomainArray:le,xDomainGlobal:he,x:Y,height:_e,width:re,hoverIndex:we}=l;function Le(be){he=be,c(0,he)}function de(be){we=be,c(1,we)}return h.$$set=be=>{"data"in be&&c(2,p=be.data),"name"in be&&c(3,y=be.name),"medianValue"in be&&c(4,v=be.medianValue),"metadata"in be&&c(5,w=be.metadata),"index"in be&&c(6,a=be.index),"checkboxedRoles"in be&&c(7,k=be.checkboxedRoles),"deviations"in be&&c(18,T=be.deviations),"medianAbsoluteDeviation"in be&&c(8,D=be.medianAbsoluteDeviation),"col1Width"in be&&c(9,M=be.col1Width),"outerPadding"in be&&c(10,A=be.outerPadding),"chartWidth"in be&&c(11,N=be.chartWidth),"chartHeight"in be&&c(12,O=be.chartHeight),"spaceForAreasBeyondScale"in be&&c(13,G=be.spaceForAreasBeyondScale),"y"in be&&c(14,Q=be.y),"yDomain"in be&&c(19,te=be.yDomain),"xDomainArray"in be&&c(20,le=be.xDomainArray),"xDomainGlobal"in be&&c(0,he=be.xDomainGlobal),"x"in be&&c(15,Y=be.x),"height"in be&&c(16,_e=be.height),"width"in be&&c(17,re=be.width),"hoverIndex"in be&&c(1,we=be.hoverIndex)},[he,we,p,y,v,w,a,k,D,M,A,N,O,G,Q,Y,_e,re,T,te,le,Le,de]}class s0 extends di{constructor(l){super(),fi(this,l,a0,n0,pi,{data:2,name:3,medianValue:4,metadata:5,index:6,checkboxedRoles:7,deviations:18,medianAbsoluteDeviation:8,col1Width:9,outerPadding:10,chartWidth:11,chartHeight:12,spaceForAreasBeyondScale:13,y:14,yDomain:19,xDomainArray:20,xDomainGlobal:0,x:15,height:16,width:17,hoverIndex:1})}}function xf(h,l,c){const p=h.slice();return p[45]=l[c],p[47]=c,p}function bf(h){let l,c,p,y;function v(...D){return h[32](h[45],...D)}function w(...D){return h[33](h[45],...D)}function a(D){h[34](D)}function k(D){h[35](D)}let T={index:h[47],data:h[10].filter(v),name:h[17].find(w).name,checkboxedRoles:h[0],medianValue:h[9],metadata:h[7],deviations:h[8],medianAbsoluteDeviation:h[16],col1Width:jf,outerPadding:h[22],chartWidth:h[6],chartHeight:h[5],spaceForAreasBeyondScale:Zf,y:h[15],x:h[14],height:Gf,width:h[3]};return h[4]!==void 0&&(T.xDomainGlobal=h[4]),h[13]!==void 0&&(T.hoverIndex=h[13]),l=new s0({props:T}),gi.push(()=>bi(l,"xDomainGlobal",a)),gi.push(()=>bi(l,"hoverIndex",k)),{c(){Vt(l.$$.fragment)},l(D){Ut(l.$$.fragment,D)},m(D,M){Nt(l,D,M),y=!0},p(D,M){h=D;const A={};M[0]&3072&&(A.data=h[10].filter(v)),M[0]&133120&&(A.name=h[17].find(w).name),M[0]&1&&(A.checkboxedRoles=h[0]),M[0]&512&&(A.medianValue=h[9]),M[0]&128&&(A.metadata=h[7]),M[0]&256&&(A.deviations=h[8]),M[0]&65536&&(A.medianAbsoluteDeviation=h[16]),M[0]&64&&(A.chartWidth=h[6]),M[0]&32&&(A.chartHeight=h[5]),M[0]&32768&&(A.y=h[15]),M[0]&16384&&(A.x=h[14]),M[0]&8&&(A.width=h[3]),!c&&M[0]&16&&(c=!0,A.xDomainGlobal=h[4],wi(()=>c=!1)),!p&&M[0]&8192&&(p=!0,A.hoverIndex=h[13],wi(()=>p=!1)),l.$set(A)},i(D){y||(We(l.$$.fragment,D),y=!0)},o(D){it(l.$$.fragment,D),y=!1},d(D){qt(l,D)}}}function o0(h){let l,c,p,y,v,w,a,k,T,D,M,A=(h[12].length>0?h[18].find(h[30]).label:"")+"",N,O,G,Q,te,le,he,Y,_e,re,we;function Le(Oe){h[28](Oe)}let de={asButtons:!0,name:"selectGroupings",optionsArray:h[21]};h[2]!==void 0&&(de.chosenId=h[2]),l=new qo({props:de}),gi.push(()=>bi(l,"chosenId",Le));function be(Oe){h[29](Oe)}let Te={name:"select-indicator-dropdown",optionsArray:h[20].map(l0)};h[1]!==void 0&&(Te.chosenId=h[1]),a=new Su({props:Te}),gi.push(()=>bi(a,"chosenId",be)),G=new jm({props:{siblingAreas:h[19]}});function Ce(Oe){h[31](Oe)}let rt={areasWithData:h[19],colors:[Yl.custom1,Yl.custom2,Yl.custom3,Yl.custom4]};h[0]!==void 0&&(rt.checkboxedRoles=h[0]),le=new Tf({props:rt}),gi.push(()=>bi(le,"checkboxedRoles",Ce));let nt=h[11],Ve=[];for(let Oe=0;Oe<nt.length;Oe+=1)Ve[Oe]=bf(xf(h,nt,Oe));const Ue=Oe=>it(Ve[Oe],1,1,()=>{Ve[Oe]=null});return{c(){Vt(l.$$.fragment),p=vt(),y=qe("div"),v=qe("div"),w=qe("div"),Vt(a.$$.fragment),T=vt(),D=qe("p"),M=Mt("in "),N=Mt(A),O=vt(),Vt(G.$$.fragment),Q=vt(),te=qe("div"),Vt(le.$$.fragment),Y=vt(),_e=qe("div");for(let Oe=0;Oe<Ve.length;Oe+=1)Ve[Oe].c();this.h()},l(Oe){Ut(l.$$.fragment,Oe),p=xt(Oe),y=Ge(Oe,"DIV",{class:!0});var et=me(y);v=Ge(et,"DIV",{class:!0});var tt=me(v);w=Ge(tt,"DIV",{class:!0});var ft=me(w);Ut(a.$$.fragment,ft),ft.forEach(W),T=xt(tt),D=Ge(tt,"P",{class:!0});var Gt=me(D);M=Pt(Gt,"in "),N=Pt(Gt,A),Gt.forEach(W),tt.forEach(W),O=xt(et),Ut(G.$$.fragment,et),Q=xt(et),te=Ge(et,"DIV",{style:!0});var zt=me(te);Ut(le.$$.fragment,zt),zt.forEach(W),Y=xt(et),_e=Ge(et,"DIV",{class:!0});var Ke=me(_e);for(let Tt=0;Tt<Ve.length;Tt+=1)Ve[Tt].l(Ke);Ke.forEach(W),et.forEach(W),this.h()},h(){S(w,"class","dropdown-container svelte-1v2sdro"),S(D,"class","svelte-1v2sdro"),S(v,"class","title-container svelte-1v2sdro"),Bt(te,"margin-top","30px"),Bt(te,"margin-bottom","30px"),S(_e,"class","svgs-container"),S(y,"class","visualisation-container svelte-1v2sdro"),ku(()=>h[36].call(y))},m(Oe,et){Nt(l,Oe,et),Ze(Oe,p,et),Ze(Oe,y,et),se(y,v),se(v,w),Nt(a,w,null),se(v,T),se(v,D),se(D,M),se(D,N),se(y,O),Nt(G,y,null),se(y,Q),se(y,te),Nt(le,te,null),se(y,Y),se(y,_e);for(let tt=0;tt<Ve.length;tt+=1)Ve[tt]&&Ve[tt].m(_e,null);re=kf(y,h[36].bind(y)),we=!0},p(Oe,et){const tt={};!c&&et[0]&4&&(c=!0,tt.chosenId=Oe[2],wi(()=>c=!1)),l.$set(tt);const ft={};!k&&et[0]&2&&(k=!0,ft.chosenId=Oe[1],wi(()=>k=!1)),a.$set(ft),(!we||et[0]&4096)&&A!==(A=(Oe[12].length>0?Oe[18].find(Oe[30]).label:"")+"")&&$i(N,A);const Gt={};if(!he&&et[0]&1&&(he=!0,Gt.checkboxedRoles=Oe[0],wi(()=>he=!1)),le.$set(Gt),et[0]&4452345){nt=Oe[11];let zt;for(zt=0;zt<nt.length;zt+=1){const Ke=xf(Oe,nt,zt);Ve[zt]?(Ve[zt].p(Ke,et),We(Ve[zt],1)):(Ve[zt]=bf(Ke),Ve[zt].c(),We(Ve[zt],1),Ve[zt].m(_e,null))}for(vr(),zt=nt.length;zt<Ve.length;zt+=1)Ue(zt);xr()}},i(Oe){if(!we){We(l.$$.fragment,Oe),We(a.$$.fragment,Oe),We(G.$$.fragment,Oe),We(le.$$.fragment,Oe);for(let et=0;et<nt.length;et+=1)We(Ve[et]);we=!0}},o(Oe){it(l.$$.fragment,Oe),it(a.$$.fragment,Oe),it(G.$$.fragment,Oe),it(le.$$.fragment,Oe),Ve=Ve.filter(Boolean);for(let et=0;et<Ve.length;et+=1)it(Ve[et]);we=!1},d(Oe){qt(l,Oe),Oe&&W(p),Oe&&W(y),qt(a),qt(G),qt(le),Gi(Ve,Oe),re()}}}let Gf=70,jf=200,Zf=30;const l0=h=>h.label;function c0(h,l,c){let p,y,v,w,a,k,T,D,M,A,N,O,G,Q,{latestData:te,indicatorsList:le,topicName:he,checkboxedRoles:Y}=l,_e=mi("indicatorsMetadata"),re=mi("indicators"),we=mi("clustersInfo"),Le=mi("clustersLookup"),de=mi("periodsLookup"),Te=mi("areasGeogLevel").filter(He=>["both","lower"].includes(He.level)).map(He=>He.areacd),Ce=mi("areasParentsLookup"),rt=mi("areasGeogInfo"),nt=le.map((He,ii)=>({index:ii,id:He,label:_e.find(Ri=>Ri.code==re.find(br=>br.id==He).code).label})),Ve=nt[1].label,Ue=0,Oe=[...Object.keys(ec).filter(He=>ec[He]===he).map(He=>rc(He)+" cluster"),"Region","Deprivation Level","Urban/Rural"],et=1e3,tt={top:10,left:0,right:0,bottom:10},ft=[-1,1],Gt=null;function zt(He){Ue=He,c(2,Ue)}function Ke(He){Ve=He,c(1,Ve)}const Tt=He=>He.xDomainNumb===v[0].xDomainNumb;function Ct(He){Y=He,c(0,Y)}const ti=(He,ii)=>ii.group==He,hi=(He,ii)=>ii.id==He;function _i(He){ft=He,c(4,ft),c(1,Ve),c(2,Ue)}function Ye(He){Gt=He,c(13,Gt)}function Zt(){et=this.clientWidth,c(3,et)}return h.$$set=He=>{"latestData"in He&&c(23,te=He.latestData),"indicatorsList"in He&&c(24,le=He.indicatorsList),"topicName"in He&&c(25,he=He.topicName),"checkboxedRoles"in He&&c(0,Y=He.checkboxedRoles)},h.$$.update=()=>{h.$$.dirty[0]&2&&c(27,p=re.find(He=>He.code==_e.find(ii=>ii.label==Ve).code).id),h.$$.dirty[0]&134217728&&c(7,y=_e.find(He=>He.code==re.find(ii=>ii.id===p).code)),h.$$.dirty[0]&142606336&&c(12,v=te.filter(He=>He.id===p&Te.includes(He.areacd))),h.$$.dirty[0]&4100&&c(10,w=(Oe[Ue].includes("cluster")?v.map(He=>({...He,group:we.find(ii=>ii.areacd===He.areacd)[Oe[Ue].replace(" cluster","").toLowerCase()]})):Oe[Ue]==="Region"?v.map(He=>({...He,group:Ce.find(ii=>ii.areacd===He.areacd).parentcd})):Oe[Ue]==="Deprivation Level"?v.map(He=>({...He,group:rt.find(ii=>He.areacd===ii.areacd).imd})):Oe[Ue]==="Urban/Rural"?v.map(He=>({...He,group:rt.find(ii=>He.areacd===ii.areacd).urban})):[]).filter(He=>He.group!="")),h.$$.dirty[0]&1028&&c(11,a=Oe[Ue]==="Deprivation Level"?[...new Set(w.map(He=>He.group))].sort((He,ii)=>He-ii):[...new Set(w.map(He=>He.group))]),h.$$.dirty[0]&2052&&c(17,k=Oe[Ue].includes("cluster")?Le.filter(He=>[Oe[Ue].replace(" cluster","").toLowerCase(),"all"].includes(He.model)).map(He=>({id:He.id,name:He.alternativeDescription})):Oe[Ue]==="Region"?[...Hm,...Km].map(He=>({id:He.code,name:He.name})):Oe[Ue]==="Deprivation Level"?[{id:"5",name:"Least deprived"},{id:"4",name:"Low deprivation"},{id:"3",name:"Average"},{id:"2",name:"Above average deprivation"},{id:"1",name:"Most deprived"}]:Oe[Ue]==="Urban/Rural"?a.map(He=>({id:He,name:He})):[]),h.$$.dirty[0]&1024&&c(9,T=Qh(w,"value")),h.$$.dirty[0]&1536&&Math.max(Math.abs(T-Math.min(...w.map(He=>He.value))),Math.abs(T-Math.max(...w.map(He=>He.value)))),h.$$.dirty[0]&1536&&c(8,D=w.map(He=>Math.abs(He.value-T))),h.$$.dirty[0]&256&&c(16,M=Qh(D)),h.$$.dirty[0]&8&&c(6,A=et-tt.left-tt.right-jf-Zf*2),h.$$.dirty[0]&128&&c(26,O=[-y.polarity*Yh,y.polarity*Yh]),h.$$.dirty[0]&67108928&&c(15,G=$l().domain(O).range([0,A])),h.$$.dirty[0]&6&&c(4,ft=[-1,1]),h.$$.dirty[0]&48&&c(14,Q=$l().domain(ft).range([0,N]))},c(5,N=Gf-tt.top-tt.bottom),[Y,Ve,Ue,et,ft,N,A,y,D,T,w,a,v,Gt,Q,G,M,k,de,Te,nt,Oe,tt,te,le,he,O,p,zt,Ke,Tt,Ct,ti,hi,_i,Ye,Zt]}class u0 extends di{constructor(l){super(),fi(this,l,c0,o0,pi,{latestData:23,indicatorsList:24,topicName:25,checkboxedRoles:0},null,[-1,-1])}}function h0(h){let l=rc(h[2])+"",c;return{c(){c=Mt(l)},l(p){c=Pt(p,l)},m(p,y){Ze(p,c,y)},p:zi,d(p){p&&W(c)}}}function d0(h){let l="Topic information",c;return{c(){c=Mt(l)},l(p){c=Pt(p,l)},m(p,y){Ze(p,c,y)},p:zi,d(p){p&&W(c)}}}function f0(h){let l,c,p,y;return l=new Nm({props:{$$slots:{default:[h0]},$$scope:{ctx:h}}}),p=new qm({props:{$$slots:{default:[d0]},$$scope:{ctx:h}}}),{c(){Vt(l.$$.fragment),c=vt(),Vt(p.$$.fragment)},l(v){Ut(l.$$.fragment,v),c=xt(v),Ut(p.$$.fragment,v)},m(v,w){Nt(l,v,w),Ze(v,c,w),Nt(p,v,w),y=!0},p(v,w){const a={};w&128&&(a.$$scope={dirty:w,ctx:v}),l.$set(a);const k={};w&128&&(k.$$scope={dirty:w,ctx:v}),p.$set(k)},i(v){y||(We(l.$$.fragment,v),We(p.$$.fragment,v),y=!0)},o(v){it(l.$$.fragment,v),it(p.$$.fragment,v),y=!1},d(v){qt(l,v),v&&W(c),qt(p,v)}}}function p0(h){let l;return{c(){l=Mt("Find related publications")},l(c){l=Pt(c,"Find related publications")},m(c,p){Ze(c,l,p)},d(c){c&&W(l)}}}function m0(h){let l,c,p,y,v,w,a,k,T,D,M,A,N,O,G,Q,te,le,he,Y,_e,re,we,Le,de,be,Te,Ce,rt,nt,Ve,Ue,Oe,et;function tt(Ke){h[5](Ke)}let ft={indicatorsList:h[3],latestData:h[4],initialData:h[0].preloadedData.initialData,otherData:h[0].preloadedData.otherData};h[1]!==void 0&&(ft.checkboxedRoles=h[1]),v=new R_({props:ft}),gi.push(()=>bi(v,"checkboxedRoles",tt)),A=new r0({props:{indicatorsList:h[0].indicatorsList,topicName:h[2],latestData:h[4],initialData:h[0].preloadedData.initialData,otherData:h[0].preloadedData.otherData}});function Gt(Ke){h[6](Ke)}let zt={topicName:h[2],latestData:h[4],indicatorsList:h[0].indicatorsList};return h[1]!==void 0&&(zt.checkboxedRoles=h[1]),re=new u0({props:zt}),gi.push(()=>bi(re,"checkboxedRoles",Gt)),be=new Xm({props:{$$slots:{default:[p0]},$$scope:{ctx:h}}}),{c(){l=qe("section"),c=qe("h1"),p=Mt("Key indicators"),y=vt(),Vt(v.$$.fragment),a=vt(),k=qe("section"),T=qe("h1"),D=Mt("Explore geographically"),M=vt(),Vt(A.$$.fragment),N=vt(),O=qe("section"),G=qe("h1"),Q=Mt("Top and bottom ranked areas"),te=vt(),le=qe("section"),he=qe("h1"),Y=Mt("Compare areas by group"),_e=vt(),Vt(re.$$.fragment),Le=vt(),de=qe("section"),Vt(be.$$.fragment),Te=vt(),Ce=qe("section"),rt=qe("h2"),nt=Mt("Get the data"),Ve=vt(),Ue=qe("p"),Oe=Mt("Here, you can find information and links to the data."),this.h()},l(Ke){l=Ge(Ke,"SECTION",{title:!0,class:!0});var Tt=me(l);c=Ge(Tt,"H1",{});var Ct=me(c);p=Pt(Ct,"Key indicators"),Ct.forEach(W),y=xt(Tt),Ut(v.$$.fragment,Tt),Tt.forEach(W),a=xt(Ke),k=Ge(Ke,"SECTION",{title:!0,class:!0});var ti=me(k);T=Ge(ti,"H1",{});var hi=me(T);D=Pt(hi,"Explore geographically"),hi.forEach(W),M=xt(ti),Ut(A.$$.fragment,ti),ti.forEach(W),N=xt(Ke),O=Ge(Ke,"SECTION",{title:!0,class:!0});var _i=me(O);G=Ge(_i,"H1",{});var Ye=me(G);Q=Pt(Ye,"Top and bottom ranked areas"),Ye.forEach(W),_i.forEach(W),te=xt(Ke),le=Ge(Ke,"SECTION",{title:!0,class:!0});var Zt=me(le);he=Ge(Zt,"H1",{});var He=me(he);Y=Pt(He,"Compare areas by group"),He.forEach(W),_e=xt(Zt),Ut(re.$$.fragment,Zt),Zt.forEach(W),Le=xt(Ke),de=Ge(Ke,"SECTION",{title:!0,class:!0});var ii=me(de);Ut(be.$$.fragment,ii),ii.forEach(W),Te=xt(Ke),Ce=Ge(Ke,"SECTION",{title:!0,class:!0});var Ri=me(Ce);rt=Ge(Ri,"H2",{class:!0});var br=me(rt);nt=Pt(br,"Get the data"),br.forEach(W),Ve=xt(Ri),Ue=Ge(Ri,"P",{});var Hi=me(Ue);Oe=Pt(Hi,"Here, you can find information and links to the data."),Hi.forEach(W),Ri.forEach(W),this.h()},h(){S(l,"title","Key indicators"),S(l,"class","svelte-1go1lax"),S(k,"title","Explore geographically"),S(k,"class","svelte-1go1lax"),S(O,"title","Top and bottom ranked areas"),S(O,"class","svelte-1go1lax"),S(le,"title","Compare areas by group"),S(le,"class","svelte-1go1lax"),S(de,"title","Related publications"),S(de,"class","svelte-1go1lax"),S(rt,"class","ons-u-mt-xl"),S(Ce,"title","Get the data"),S(Ce,"class","svelte-1go1lax")},m(Ke,Tt){Ze(Ke,l,Tt),se(l,c),se(c,p),se(l,y),Nt(v,l,null),Ze(Ke,a,Tt),Ze(Ke,k,Tt),se(k,T),se(T,D),se(k,M),Nt(A,k,null),Ze(Ke,N,Tt),Ze(Ke,O,Tt),se(O,G),se(G,Q),Ze(Ke,te,Tt),Ze(Ke,le,Tt),se(le,he),se(he,Y),se(le,_e),Nt(re,le,null),Ze(Ke,Le,Tt),Ze(Ke,de,Tt),Nt(be,de,null),Ze(Ke,Te,Tt),Ze(Ke,Ce,Tt),se(Ce,rt),se(rt,nt),se(Ce,Ve),se(Ce,Ue),se(Ue,Oe),et=!0},p(Ke,Tt){const Ct={};Tt&1&&(Ct.initialData=Ke[0].preloadedData.initialData),Tt&1&&(Ct.otherData=Ke[0].preloadedData.otherData),!w&&Tt&2&&(w=!0,Ct.checkboxedRoles=Ke[1],wi(()=>w=!1)),v.$set(Ct);const ti={};Tt&1&&(ti.indicatorsList=Ke[0].indicatorsList),Tt&1&&(ti.initialData=Ke[0].preloadedData.initialData),Tt&1&&(ti.otherData=Ke[0].preloadedData.otherData),A.$set(ti);const hi={};Tt&1&&(hi.indicatorsList=Ke[0].indicatorsList),!we&&Tt&2&&(we=!0,hi.checkboxedRoles=Ke[1],wi(()=>we=!1)),re.$set(hi);const _i={};Tt&128&&(_i.$$scope={dirty:Tt,ctx:Ke}),be.$set(_i)},i(Ke){et||(We(v.$$.fragment,Ke),We(A.$$.fragment,Ke),We(re.$$.fragment,Ke),We(be.$$.fragment,Ke),et=!0)},o(Ke){it(v.$$.fragment,Ke),it(A.$$.fragment,Ke),it(re.$$.fragment,Ke),it(be.$$.fragment,Ke),et=!1},d(Ke){Ke&&W(l),qt(v),Ke&&W(a),Ke&&W(k),qt(A),Ke&&W(N),Ke&&W(O),Ke&&W(te),Ke&&W(le),qt(re),Ke&&W(Le),Ke&&W(de),qt(be),Ke&&W(Te),Ke&&W(Ce)}}}function g0(h){let l,c,p,y;return l=new Um({props:{breadcrumb:[{label:"Home",url:"/"},{label:"Explore subnational statistics",url:`${du}/`},{label:"Expore indicators",url:`${du}/indicators`},{label:"topic"}],$$slots:{default:[f0]},$$scope:{ctx:h}}}),p=new Zm({props:{contentsLabel:"Explore this indicator",$$slots:{default:[m0]},$$scope:{ctx:h}}}),{c(){Vt(l.$$.fragment),c=vt(),Vt(p.$$.fragment)},l(v){Ut(l.$$.fragment,v),c=xt(v),Ut(p.$$.fragment,v)},m(v,w){Nt(l,v,w),Ze(v,c,w),Nt(p,v,w),y=!0},p(v,[w]){const a={};w&128&&(a.$$scope={dirty:w,ctx:v}),l.$set(a);const k={};w&131&&(k.$$scope={dirty:w,ctx:v}),p.$set(k)},i(v){y||(We(l.$$.fragment,v),We(p.$$.fragment,v),y=!0)},o(v){it(l.$$.fragment,v),it(p.$$.fragment,v),y=!1},d(v){qt(l,v),v&&W(c),qt(p,v)}}}function _0(h,l,c){let p,{data:y}=l,v=y.topic,w=y.indicatorsList.slice(0,Math.min(5,y.indicatorsList.length)),a=y.latestData.filter(D=>y.indicatorsList.includes(D.id));function k(D){p=D,c(1,p)}function T(D){p=D,c(1,p)}return h.$$set=D=>{"data"in D&&c(0,y=D.data)},c(1,p={parent:!1,country:!1,uk:!1,neighbour:!1,cluster:!1,custom:null}),[y,p,v,w,a,k,T]}class O0 extends di{constructor(l){super(),fi(this,l,_0,g0,pi,{data:0})}}export{O0 as component};
