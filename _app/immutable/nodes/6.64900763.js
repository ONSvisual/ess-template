import{S as pi,i as gi,s as _i,E as gl,k as it,l as nt,m as be,h as G,n as A,p as ii,b as Be,I as _l,J as yl,K as vl,g as Le,d as Ze,e as si,L as hi,C as xi,q as fi,a as Rt,r as di,c as Ft,H as we,u as zi,y as Nt,z as Kt,A as Ut,B as Gt,v as wi,f as Ii,Q as $i,X as wp,O as Gi,Y as n1,F as ft,G as dt,R as wa,Z as mh,_ as ph,w as Et,$ as Bt,a0 as Ot,o as Gs,V as r1,M as Kf,a1 as ao,a2 as Yf,a3 as s1,N as Ln,W as oo,a4 as Ip,x as Wn,t as Pc,a5 as nh,a6 as bl,a7 as a1,a8 as o1,a9 as gh,aa as Jf,ab as Qf,ac as _h,ad as kp,P as l1,ae as c1,af as u1,ag as ul,T as h1,U as Xr,ah as yh,ai as f1,D as d1,aj as Ju}from"../chunks/index.bb22ce14.js";import{b as so}from"../chunks/paths.4f346436.js";import"../chunks/Table.svelte_svelte_type_style_lang.ca6fdd6c.js";import{B as m1,T as p1,S as g1}from"../chunks/Subhead.852801b0.js";import{N as Bc,a as _1}from"../chunks/NavSections.c12debc9.js";import"../chunks/index.6ae84391.js";import{A as y1}from"../chunks/AreaNav.ff9a16be.js";import{a as Hr,r as Ir,c as Rc,b as v1,d as Qu}from"../chunks/utils.9d6bb7a6.js";import{e as Nn,c as Vn,r as Ht,a as ni,b as ws,m as Fc,g as $f}from"../chunks/config.d8d581b4.js";import{f as b1,e as fl,a as x1,c as w1,g as I1}from"../chunks/functions.269506f5.js";import{w as k1}from"../chunks/index.397b26fc.js";function T1(i){return i}function S1(i){if(i==null)return T1;var n,s,c=i.scale[0],u=i.scale[1],d=i.translate[0],m=i.translate[1];return function(o,x){x||(n=s=0);var w=2,I=o.length,k=new Array(I);for(k[0]=(n+=o[0])*c+d,k[1]=(s+=o[1])*u+m;w<I;)k[w]=o[w],++w;return k}}function E1(i,n){for(var s,c=i.length,u=c-n;u<--c;)s=i[u],i[u++]=i[c],i[c]=s}function A1(i,n){return typeof n=="string"&&(n=i.objects[n]),n.type==="GeometryCollection"?{type:"FeatureCollection",features:n.geometries.map(function(s){return ed(i,s)})}:ed(i,n)}function ed(i,n){var s=n.id,c=n.bbox,u=n.properties==null?{}:n.properties,d=C1(i,n);return s==null&&c==null?{type:"Feature",properties:u,geometry:d}:c==null?{type:"Feature",id:s,properties:u,geometry:d}:{type:"Feature",id:s,bbox:c,properties:u,geometry:d}}function C1(i,n){var s=S1(i.transform),c=i.arcs;function u(I,k){k.length&&k.pop();for(var E=c[I<0?~I:I],B=0,K=E.length;B<K;++B)k.push(s(E[B],B));I<0&&E1(k,K)}function d(I){return s(I)}function m(I){for(var k=[],E=0,B=I.length;E<B;++E)u(I[E],k);return k.length<2&&k.push(k[0]),k}function o(I){for(var k=m(I);k.length<4;)k.push(k[0]);return k}function x(I){return I.map(o)}function w(I){var k=I.type,E;switch(k){case"GeometryCollection":return{type:k,geometries:I.geometries.map(w)};case"Point":E=d(I.coordinates);break;case"MultiPoint":E=I.coordinates.map(d);break;case"LineString":E=m(I.arcs);break;case"MultiLineString":E=I.arcs.map(m);break;case"Polygon":E=x(I.arcs);break;case"MultiPolygon":E=I.arcs.map(x);break;default:return null}return{type:k,coordinates:E}}return w(n)}var Mc,Tp,Sp;M1({thousands:",",grouping:[3],currency:["$",""]});function M1(i){return Mc=b1(i),Tp=Mc.format,Sp=Mc.formatPrefix,Mc}function z1(i){return Math.max(0,-fl(Math.abs(i)))}function D1(i,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(fl(n)/3)))*3-fl(Math.abs(i)))}function P1(i,n){return i=Math.abs(i),n=Math.abs(n)-i,Math.max(0,fl(n)-fl(i))+1}function L1(i){let n,s=`${i[0]}px`,c=`${i[1]}px`,u;const d=i[3].default,m=gl(d,i,i[2],null);return{c(){n=it("div"),m&&m.c(),this.h()},l(o){n=nt(o,"DIV",{class:!0});var x=be(n);m&&m.l(x),x.forEach(G),this.h()},h(){A(n,"class","placeholder-container svelte-1mhohmc"),ii(n,"height",s),ii(n,"margin-bottom",c)},m(o,x){Be(o,n,x),m&&m.m(n,null),u=!0},p(o,[x]){m&&m.p&&(!u||x&4)&&_l(m,d,o,o[2],u?vl(d,o[2],x,null):yl(o[2]),null),x&1&&s!==(s=`${o[0]}px`)&&ii(n,"height",s),x&2&&c!==(c=`${o[1]}px`)&&ii(n,"margin-bottom",c)},i(o){u||(Le(m,o),u=!0)},o(o){Ze(m,o),u=!1},d(o){o&&G(n),m&&m.d(o)}}}function B1(i,n,s){let{$$slots:c={},$$scope:u}=n,{height:d=400}=n,{margin:m=40}=n;return i.$$set=o=>{"height"in o&&s(0,d=o.height),"margin"in o&&s(1,m=o.margin),"$$scope"in o&&s(2,u=o.$$scope)},[d,m,u,c]}class R1 extends pi{constructor(n){super(),gi(this,n,B1,L1,_i,{height:0,margin:1})}}function F1(i){let n,s,c,u=i[0].label+"",d,m,o,x,w,I,k=i[1].prefix+Hr(Ir(i[9],i[1].decimalPlaces))+i[1].suffix+"",E,B,K,U,X,Q,Y,re,V,ne,oe,Ne,he=i[1].subText!=""&&td(i),fe=i[2]!=null&&id(i);return{c(){n=it("div"),s=it("h3"),c=it("a"),d=fi(u),o=Rt(),x=it("div"),w=it("div"),I=it("h4"),E=fi(k),B=Rt(),he&&he.c(),K=Rt(),U=it("div"),X=it("div"),Q=it("p"),Y=fi(i[7]),V=Rt(),ne=it("p"),oe=fi(i[6]),Ne=Rt(),fe&&fe.c(),this.h()},l(pe){n=nt(pe,"DIV",{class:!0});var Ee=be(n);s=nt(Ee,"H3",{class:!0});var ve=be(s);c=nt(ve,"A",{href:!0});var ze=be(c);d=di(ze,u),ze.forEach(G),ve.forEach(G),o=Ft(Ee),x=nt(Ee,"DIV",{class:!0});var De=be(x);w=nt(De,"DIV",{class:!0});var j=be(w);I=nt(j,"H4",{class:!0});var ce=be(I);E=di(ce,k),ce.forEach(G),B=Ft(j),he&&he.l(j),j.forEach(G),K=Ft(De),U=nt(De,"DIV",{class:!0});var rt=be(U);X=nt(rt,"DIV",{class:!0,style:!0});var Ke=be(X);Q=nt(Ke,"P",{class:!0});var qe=be(Q);Y=di(qe,i[7]),qe.forEach(G),Ke.forEach(G),V=Ft(rt),ne=nt(rt,"P",{class:!0});var Qe=be(ne);oe=di(Qe,i[6]),Qe.forEach(G),rt.forEach(G),Ne=Ft(De),fe&&fe.l(De),De.forEach(G),Ee.forEach(G),this.h()},h(){A(c,"href",m=so+"/indicators/"+i[0].code),A(s,"class","svelte-j4tg4p"),A(I,"class","svelte-j4tg4p"),A(w,"class","flexV column1 svelte-j4tg4p"),A(Q,"class","from-comparison-description svelte-j4tg4p"),A(X,"class","headlineLabel svelte-j4tg4p"),A(X,"style",re=+i[8]==null?null:"background-color:"+i[8]+"; box-shadow: 0 0 4px 3px "+i[8]+";"),A(ne,"class","additionalInfoText svelte-j4tg4p"),A(U,"class","flexV column2 svelte-j4tg4p"),A(x,"class","flexH svelte-j4tg4p"),A(n,"class","panel-container svelte-j4tg4p")},m(pe,Ee){Be(pe,n,Ee),we(n,s),we(s,c),we(c,d),we(n,o),we(n,x),we(x,w),we(w,I),we(I,E),we(w,B),he&&he.m(w,null),we(x,K),we(x,U),we(U,X),we(X,Q),we(Q,Y),we(U,V),we(U,ne),we(ne,oe),we(x,Ne),fe&&fe.m(x,null)},p(pe,Ee){Ee[0]&1&&u!==(u=pe[0].label+"")&&zi(d,u),Ee[0]&1&&m!==(m=so+"/indicators/"+pe[0].code)&&A(c,"href",m),Ee[0]&2&&k!==(k=pe[1].prefix+Hr(Ir(pe[9],pe[1].decimalPlaces))+pe[1].suffix+"")&&zi(E,k),pe[1].subText!=""?he?he.p(pe,Ee):(he=td(pe),he.c(),he.m(w,null)):he&&(he.d(1),he=null),Ee[0]&128&&zi(Y,pe[7]),Ee[0]&256&&re!==(re=+pe[8]==null?null:"background-color:"+pe[8]+"; box-shadow: 0 0 4px 3px "+pe[8]+";")&&A(X,"style",re),Ee[0]&64&&zi(oe,pe[6]),pe[2]!=null?fe?fe.p(pe,Ee):(fe=id(pe),fe.c(),fe.m(x,null)):fe&&(fe.d(1),fe=null)},d(pe){pe&&G(n),he&&he.d(),fe&&fe.d()}}}function td(i){let n,s=i[1].subText+"",c;return{c(){n=it("p"),c=fi(s),this.h()},l(u){n=nt(u,"P",{class:!0});var d=be(n);c=di(d,s),d.forEach(G),this.h()},h(){A(n,"class","subText svelte-j4tg4p")},m(u,d){Be(u,n,d),we(n,c)},p(u,d){d[0]&2&&s!==(s=u[1].subText+"")&&zi(c,s)},d(u){u&&G(n)}}}function id(i){let n,s,c,u,d,m,o,x;return{c(){n=it("div"),s=it("div"),c=it("p"),u=fi(i[4]),m=Rt(),o=it("p"),x=fi(i[3]),this.h()},l(w){n=nt(w,"DIV",{class:!0});var I=be(n);s=nt(I,"DIV",{class:!0,style:!0});var k=be(s);c=nt(k,"P",{class:!0});var E=be(c);u=di(E,i[4]),E.forEach(G),k.forEach(G),m=Ft(I),o=nt(I,"P",{class:!0});var B=be(o);x=di(B,i[3]),B.forEach(G),I.forEach(G),this.h()},h(){A(c,"class","from-comparison-description svelte-j4tg4p"),A(s,"class","headlineLabel svelte-j4tg4p"),A(s,"style",d=+i[8]==null?null:"background-color:"+i[5]+"; box-shadow: 0 0 4px 3px "+i[5]+";"),A(o,"class","additionalInfoText svelte-j4tg4p"),A(n,"class","flexV column3 svelte-j4tg4p")},m(w,I){Be(w,n,I),we(n,s),we(s,c),we(c,u),we(n,m),we(n,o),we(o,x)},p(w,I){I[0]&16&&zi(u,w[4]),I[0]&288&&d!==(d=+w[8]==null?null:"background-color:"+w[5]+"; box-shadow: 0 0 4px 3px "+w[5]+";")&&A(s,"style",d),I[0]&8&&zi(x,w[3])},d(w){w&&G(n)}}}function O1(i){let n,s=i[9]!=null&&F1(i);return{c(){s&&s.c(),n=si()},l(c){s&&s.l(c),n=si()},m(c,u){s&&s.m(c,u),Be(c,n,u)},p(c,u){c[9]!=null&&s.p(c,u)},i:hi,o:hi,d(c){s&&s.d(c),c&&G(n)}}}function V1(i,n,s){let c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y,re,V,ne,oe,Ne,he,fe,pe,Ee,ve,ze,De,j,ce,rt,{indicator:Ke,calculations:qe,metadata:Qe,chosenId11:Ie,baselineComparisonArea:lt,chosenId2:ot}=n,vt=xi("selectedArea"),gt=qe.calcs[qe.maxXDomain].main,We=xi("selectedAndRelatedAreas"),yt=qe.calcs[qe.maxXDomain].mad;return i.$$set=ue=>{"indicator"in ue&&s(0,Ke=ue.indicator),"calculations"in ue&&s(10,qe=ue.calculations),"metadata"in ue&&s(1,Qe=ue.metadata),"chosenId11"in ue&&s(11,Ie=ue.chosenId11),"baselineComparisonArea"in ue&&s(12,lt=ue.baselineComparisonArea),"chosenId2"in ue&&s(13,ot=ue.chosenId2)},i.$$.update=()=>{i.$$.dirty[0]&9216&&s(14,c=ot==="earliest available year"?qe.mainMinXDomain:ot==="previous year"?qe.maxXDomain-1:ot),i.$$.dirty[0]&5120&&s(26,u=qe.calcs[qe.maxXDomain][(lt.areacd==="median"?lt:We.find(ue=>lt.areacd===ue.areacd)).role]),i.$$.dirty[0]&67108864&&s(27,d=gt==null|u==null|yt==null?null:(gt-u)/yt),i.$$.dirty[0]&2048&&s(37,m=Ie.includes(1)),i.$$.dirty[0]&2&&s(36,o=Qe.polarity==0?null:Qe.polarity==-1?"better":"worse"),i.$$.dirty[0]&2&&s(35,x=Qe.polarity==0?null:"similar"),i.$$.dirty[0]&2&&s(34,w=Qe.polarity==0?null:Qe.polarity==1?"better":"worse"),i.$$.dirty[0]&2048&&s(31,I=Ie.includes(3)?2:1),i.$$.dirty[0]&134217730|i.$$.dirty[1]&121&&s(8,k=!m|d==null|Qe.polarity==0?null:d<-I?Nn[o]:d<=I?Nn[x]:Nn[w]),i.$$.dirty[0]&4096&&s(28,E=lt.areacd==="median"?"median":lt.areanm),i.$$.dirty[0]&2048&&s(33,B=Ie.includes(2)),i.$$.dirty[0]&2|i.$$.dirty[1]&4&&s(32,K=Qe.polarity==0|!B?"Lower than":Qe.polarity==-1?"Better than":"Worse than"),i.$$.dirty[0]&2|i.$$.dirty[1]&4&&s(29,X=Qe.polarity==0|!B?"Higher than":Qe.polarity==1?"Better than":"Worse than"),i.$$.dirty[0]&2080374784|i.$$.dirty[1]&3&&s(7,Q=gt==null?"No "+vt.areanm+" data":u==null?"No "+E+" data":(d<-I?K:d<=I?U:X)+" "+E),i.$$.dirty[0]&201330690&&s(6,Y=(d==0?"Equal":d>0?d>3?"Far above":"Above":d<-3?"Far below":"Below")+" "+(lt.areacd==="median"?"median":lt.areanm+"-wide average")+(d==0?".":" ("+Qe.prefix+Hr(Ir(u,Qe.decimalPlaces))+Qe.suffix+").")),i.$$.dirty[0]&17408&&s(2,re=c in qe.calcs?qe.calcs[c].main:null),i.$$.dirty[0]&4&&s(15,V=gt==null|re==null|yt==null?null:(gt-re)/yt),i.$$.dirty[0]&2048&&s(25,ne=Ie.includes(1)),i.$$.dirty[0]&2&&s(24,oe=Qe.polarity==0?null:Qe.polarity==-1?"better":"worse"),i.$$.dirty[0]&2&&s(23,Ne=Qe.polarity==0?null:"similar"),i.$$.dirty[0]&2&&s(22,he=Qe.polarity==0?null:Qe.polarity==1?"better":"worse"),i.$$.dirty[0]&2048&&s(19,fe=Ie.includes(3)?2:1),i.$$.dirty[0]&63489026&&s(5,pe=!ne|V==null|Qe.polarity==0|c==qe.maxXDomain?null:V<-fe?Nn[oe]:V<=fe?Nn[Ne]:Nn[he]),i.$$.dirty[0]&2048&&s(21,Ee=Ie.includes(2)),i.$$.dirty[0]&2097154&&s(20,ve=Qe.polarity==0|!Ee?"Decreased":Qe.polarity==-1?"Improved":"Worsened"),i.$$.dirty[0]&2097154&&s(17,De=Qe.polarity==0|!Ee?"Increased":Qe.polarity==1?"Improved":"Worsened"),i.$$.dirty[0]&2016260&&s(4,j=c==qe.maxXDomain?"No historical data":gt==null?"No data in "+qe.maxXDomain:re==null?"No data in "+c:(V<-fe?ve:V<=fe?ze:De)+" since "+c),i.$$.dirty[0]&4&&s(16,ce=Math.round(100*(gt-re)/re)),i.$$.dirty[0]&115712&&s(3,rt=V===0?"No change from ":Math.abs(ce)+"% "+(V>0?"increase":"descrease")+" from "+c+" to "+qe.maxXDomain+".")},s(30,U="Similar to"),s(18,ze="Little change"),[Ke,Qe,re,rt,j,pe,Y,Q,k,gt,qe,Ie,lt,ot,c,V,ce,De,ze,fe,ve,Ee,he,Ne,oe,ne,u,d,E,X,U,I,K,B,w,x,o,m]}class N1 extends pi{constructor(n){super(),gi(this,n,V1,O1,_i,{indicator:0,calculations:10,metadata:1,chosenId11:11,baselineComparisonArea:12,chosenId2:13},null,[-1,-1])}}function nd(i,n,s){const c=i.slice();return c[8]=n[s],c}function rd(i){let n,s;function c(...d){return i[6](i[8],...d)}function u(...d){return i[7](i[8],...d)}return n=new N1({props:{indicator:i[8],metadata:i[4].find(c),calculations:i[5].find(u),chosenId11:i[1],baselineComparisonArea:i[2],chosenId2:i[3]}}),{c(){Nt(n.$$.fragment)},l(d){Kt(n.$$.fragment,d)},m(d,m){Ut(n,d,m),s=!0},p(d,m){i=d;const o={};m&1&&(o.indicator=i[8]),m&1&&(o.metadata=i[4].find(c)),m&1&&(o.calculations=i[5].find(u)),m&2&&(o.chosenId11=i[1]),m&4&&(o.baselineComparisonArea=i[2]),m&8&&(o.chosenId2=i[3]),n.$set(o)},i(d){s||(Le(n.$$.fragment,d),s=!0)},o(d){Ze(n.$$.fragment,d),s=!1},d(d){Gt(n,d)}}}function U1(i){let n,s,c=i[0],u=[];for(let m=0;m<c.length;m+=1)u[m]=rd(nd(i,c,m));const d=m=>Ze(u[m],1,1,()=>{u[m]=null});return{c(){n=it("div");for(let m=0;m<u.length;m+=1)u[m].c();this.h()},l(m){n=nt(m,"DIV",{class:!0});var o=be(n);for(let x=0;x<u.length;x+=1)u[x].l(o);o.forEach(G),this.h()},h(){A(n,"class","rowsContainer")},m(m,o){Be(m,n,o);for(let x=0;x<u.length;x+=1)u[x]&&u[x].m(n,null);s=!0},p(m,o){if(o&63){c=m[0];let x;for(x=0;x<c.length;x+=1){const w=nd(m,c,x);u[x]?(u[x].p(w,o),Le(u[x],1)):(u[x]=rd(w),u[x].c(),Le(u[x],1),u[x].m(n,null))}for(wi(),x=c.length;x<u.length;x+=1)d(x);Ii()}},i(m){if(!s){for(let o=0;o<c.length;o+=1)Le(u[o]);s=!0}},o(m){u=u.filter(Boolean);for(let o=0;o<u.length;o+=1)Ze(u[o]);s=!1},d(m){m&&G(n),$i(u,m)}}}function G1(i){let n,s;return n=new Bc({props:{title:"Key indicators",$$slots:{default:[U1]},$$scope:{ctx:i}}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,[u]){const d={};u&2063&&(d.$$scope={dirty:u,ctx:c}),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function q1(i,n,s){let{indicators:c,chosenId11:u,baselineComparisonArea:d,chosenId2:m}=n,o=xi("indicatorsMetadata"),x=xi("indicatorsCalculations");const w=(k,E)=>E.code===k.code,I=(k,E)=>E.id===k.id;return i.$$set=k=>{"indicators"in k&&s(0,c=k.indicators),"chosenId11"in k&&s(1,u=k.chosenId11),"baselineComparisonArea"in k&&s(2,d=k.baselineComparisonArea),"chosenId2"in k&&s(3,m=k.chosenId2)},i.$$.update=()=>{i.$$.dirty&1&&console.log(c)},[c,u,d,m,o,x,w,I]}class j1 extends pi{constructor(n){super(),gi(this,n,q1,G1,_i,{indicators:0,chosenId11:1,baselineComparisonArea:2,chosenId2:3})}}function sd(i,n,s){const c=i.slice();return c[6]=n[s],c[8]=s,c}function ad(i){let n,s,c,u,d=i[6]+"",m,o,x,w,I;return x=wp(i[5][0]),{c(){n=it("label"),s=it("input"),c=Rt(),u=it("p"),m=fi(d),o=Rt(),this.h()},l(k){n=nt(k,"LABEL",{style:!0,class:!0});var E=be(n);s=nt(E,"INPUT",{type:!0,name:!0}),c=Ft(E),u=nt(E,"P",{class:!0});var B=be(u);m=di(B,d),B.forEach(G),o=Ft(E),E.forEach(G),this.h()},h(){A(s,"type","checkbox"),s.__value=i[8],s.value=s.__value,A(s,"name",i[2]),A(u,"class","svelte-8oxv8t"),ii(n,"margin-bottom",i[3]==null?null:i[3]),A(n,"class","svelte-8oxv8t"),x.p(s)},m(k,E){Be(k,n,E),we(n,s),s.checked=~(i[0]||[]).indexOf(s.__value),we(n,c),we(n,u),we(u,m),we(n,o),w||(I=Gi(s,"change",i[4]),w=!0)},p(k,E){E&4&&A(s,"name",k[2]),E&3&&(s.checked=~(k[0]||[]).indexOf(s.__value)),E&2&&d!==(d=k[6]+"")&&zi(m,d),E&8&&ii(n,"margin-bottom",k[3]==null?null:k[3])},d(k){k&&G(n),x.r(),w=!1,I()}}}function Z1(i){let n,s=i[1],c=[];for(let u=0;u<s.length;u+=1)c[u]=ad(sd(i,s,u));return{c(){n=it("div");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);for(let m=0;m<c.length;m+=1)c[m].l(d);d.forEach(G),this.h()},h(){A(n,"class","radio-container svelte-8oxv8t")},m(u,d){Be(u,n,d);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(n,null)},p(u,[d]){if(d&15){s=u[1];let m;for(m=0;m<s.length;m+=1){const o=sd(u,s,m);c[m]?c[m].p(o,d):(c[m]=ad(o),c[m].c(),c[m].m(n,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},i:hi,o:hi,d(u){u&&G(n),$i(c,u)}}}function X1(i,n,s){let{optionsArray:c,chosenId:u,name:d,spacing:m=null}=n;const o=[[]];function x(){u=n1(o[0],this.__value,this.checked),s(0,u)}return i.$$set=w=>{"optionsArray"in w&&s(1,c=w.optionsArray),"chosenId"in w&&s(0,u=w.chosenId),"name"in w&&s(2,d=w.name),"spacing"in w&&s(3,m=w.spacing)},[u,c,d,m,x,o]}class Oc extends pi{constructor(n){super(),gi(this,n,X1,Z1,_i,{optionsArray:1,chosenId:0,name:2,spacing:3})}}function od(i,n,s){const c=i.slice();return c[8]=n[s],c[10]=s,c}function ld(i){let n,s,c,u,d,m=i[8]+"",o,x,w,I,k;return w=wp(i[7][0]),{c(){n=it("label"),s=it("input"),c=Rt(),u=it("div"),d=it("p"),o=fi(m),x=Rt(),this.h()},l(E){n=nt(E,"LABEL",{style:!0,class:!0});var B=be(n);s=nt(B,"INPUT",{style:!0,type:!0,name:!0}),c=Ft(B),u=nt(B,"DIV",{class:!0,style:!0});var K=be(u);d=nt(K,"P",{style:!0,class:!0});var U=be(d);o=di(U,m),U.forEach(G),K.forEach(G),x=Ft(B),B.forEach(G),this.h()},h(){ii(s,"display","none"),A(s,"type","radio"),s.__value=i[10],s.value=s.__value,A(s,"name",i[2]),ii(d,"font-size",i[4]),A(d,"class","svelte-1o62d9i"),A(u,"class","optionLabel svelte-1o62d9i"),ii(u,"background-color",i[0]===i[10]?"white":"#e3e3e3"),ii(n,"margin-bottom",i[3]),ii(n,"max-width","500px"),A(n,"class","svelte-1o62d9i"),w.p(s)},m(E,B){Be(E,n,B),we(n,s),s.checked=s.__value===i[0],we(n,c),we(n,u),we(u,d),we(d,o),we(n,x),I||(k=Gi(s,"change",i[6]),I=!0)},p(E,B){B&4&&A(s,"name",E[2]),B&3&&(s.checked=s.__value===E[0]),B&2&&m!==(m=E[8]+"")&&zi(o,m),B&16&&ii(d,"font-size",E[4]),B&1&&ii(u,"background-color",E[0]===E[10]?"white":"#e3e3e3"),B&8&&ii(n,"margin-bottom",E[3])},d(E){E&&G(n),w.r(),I=!1,k()}}}function W1(i){let n,s=i[1],c=[];for(let u=0;u<s.length;u+=1)c[u]=ld(od(i,s,u));return{c(){n=it("div");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);for(let m=0;m<c.length;m+=1)c[m].l(d);d.forEach(G),this.h()},h(){A(n,"class","radio-container svelte-1o62d9i")},m(u,d){Be(u,n,d);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(n,null)},p(u,[d]){if(d&31){s=u[1];let m;for(m=0;m<s.length;m+=1){const o=od(u,s,m);c[m]?c[m].p(o,d):(c[m]=ld(o),c[m].c(),c[m].m(n,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},i:hi,o:hi,d(u){u&&G(n),$i(c,u)}}}function H1(i,n,s){let{optionsArray:c,chosenId:u,name:d,marginBottom:m=null,fontSize:o=null,width:x}=n;const w=[[]];function I(){u=this.__value,s(0,u)}return i.$$set=k=>{"optionsArray"in k&&s(1,c=k.optionsArray),"chosenId"in k&&s(0,u=k.chosenId),"name"in k&&s(2,d=k.name),"marginBottom"in k&&s(3,m=k.marginBottom),"fontSize"in k&&s(4,o=k.fontSize),"width"in k&&s(5,x=k.width)},[u,c,d,m,o,x,I,w]}class Ep extends pi{constructor(n){super(),gi(this,n,H1,W1,_i,{optionsArray:1,chosenId:0,name:2,marginBottom:3,fontSize:4,width:5})}}function cd(i,n,s){const c=i.slice();return c[2]=n[s],c[4]=s,c}function ud(i){let n,s,c;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(u){n=dt(u,"g",{transform:!0});var d=be(n);s=dt(d,"circle",{r:!0,stroke:!0,"stroke-width":!0,fill:!0,opacity:!0,"pointer-events":!0}),be(s).forEach(G),d.forEach(G),this.h()},h(){A(s,"r","7"),A(s,"stroke","white"),A(s,"stroke-width","2px"),A(s,"fill","#F39431"),A(s,"opacity","1"),A(s,"pointer-events","none"),A(n,"transform",c="translate("+i[2].x+","+i[1](i[2].y)+")")},m(u,d){Be(u,n,d),we(n,s)},p(u,d){d&3&&c!==(c="translate("+u[2].x+","+u[1](u[2].y)+")")&&A(n,"transform",c)},d(u){u&&G(n)}}}function K1(i){let n,s=i[0],c=[];for(let u=0;u<s.length;u+=1)c[u]=ud(cd(i,s,u));return{c(){n=ft("g");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){n=dt(u,"g",{class:!0});var d=be(n);for(let m=0;m<c.length;m+=1)c[m].l(d);d.forEach(G),this.h()},h(){A(n,"class","hoverCirclesGroup")},m(u,d){Be(u,n,d);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(n,null)},p(u,[d]){if(d&3){s=u[0];let m;for(m=0;m<s.length;m+=1){const o=cd(u,s,m);c[m]?c[m].p(o,d):(c[m]=ud(o),c[m].c(),c[m].m(n,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},i:hi,o:hi,d(u){u&&G(n),$i(c,u)}}}function Y1(i,n,s){let{backgroundCirclesStep2:c,y:u}=n;return i.$$set=d=>{"backgroundCirclesStep2"in d&&s(0,c=d.backgroundCirclesStep2),"y"in d&&s(1,u=d.y)},[c,u]}class J1 extends pi{constructor(n){super(),gi(this,n,Y1,K1,_i,{backgroundCirclesStep2:0,y:1})}}class Ap{constructor(n,s,c){this.items=n,this.diameter=s*2,this.diameterSq=this.diameter*this.diameter,this.xFun=c,this.tieBreakFn=u=>u,this._oneSided=!1}withTiesBrokenRandomly(){return this.tieBreakFn=this._sfc32(2654435769,608135816,3084996962,1),this}oneSided(){return this._oneSided=!0,this}calculateYPositions(){let n=this.items.map((u,d)=>({datum:u,originalIndex:d,x:this.xFun(u),y:null,placed:!1,minPositiveY:0,maxNegativeY:0,score:0,bestPosition:0,heapPos:-1})).sort((u,d)=>u.x-d.x);n.forEach(function(u,d){u.index=d});let s=this.tieBreakFn;n.forEach(function(u){u.tieBreaker=s(u.x)});let c=new Q1;for(c.push(...n);!c.isEmpty();){let u=c.pop();u.placed=!0,u.y=u.bestPosition,this._updateYBounds(u,n,c)}return n.sort((u,d)=>u.originalIndex-d.originalIndex),n.map(u=>({datum:u.datum,x:u.x,y:u.y}))}_sfc32(n,s,c,u){let d=function(){n>>>=0,s>>>=0,c>>>=0,u>>>=0;var m=n+s|0;return n=s^s>>>9,s=c+(c<<3)|0,c=c<<21|c>>>11,u=u+1|0,m=m+u|0,c=c+m|0,(m>>>0)/4294967296};for(let m=0;m<10;m++)d();return d}_updateYBounds(n,s,c){for(let u of[-1,1]){let d;for(let m=n.index+u;m>=0&&m<s.length&&(d=Math.abs(n.x-s[m].x))<this.diameter;m+=u){let o=s[m];if(o.placed)continue;let x=Math.sqrt(this.diameterSq-d*d);o.minPositiveY=Math.max(o.minPositiveY,n.y+x);let w=o.score;o.score=o.minPositiveY,o.bestPosition=o.minPositiveY,this._oneSided||(o.maxNegativeY=Math.min(o.maxNegativeY,n.y-x),-o.maxNegativeY<o.score&&(o.score=-o.maxNegativeY,o.bestPosition=o.maxNegativeY)),o.score>w&&c.deprioritise(o)}}}}class Q1{parent(n){return(n+1>>>1)-1}left(n){return(n<<1)+1}right(n){return n+1<<1}constructor(){this.TOP=0,this._heap=[]}size(){return this._heap.length}isEmpty(){return this.size()==0}peek(){return this._heap[this.TOP]}push(...n){return n.forEach(s=>{s.heapPos=this.size(),this._heap.push(s),this._siftUp()}),this.size()}pop(){const n=this.peek(),s=this.size()-1;return s>this.TOP&&this._swap(this.TOP,s),this._heap.pop(),this._siftDown(),n}deprioritise(n){this._siftDown(n.heapPos)}_greater(n,s){let c=this._heap[n],u=this._heap[s];return c.score<u.score?!0:c.score>u.score?!1:c.tieBreaker<u.tieBreaker}_swap(n,s){let c=this._heap[n];this._heap[n]=this._heap[s],this._heap[s]=c,this._heap[n].heapPos=n,this._heap[s].heapPos=s}_siftUp(){let n=this.size()-1;for(;n>this.TOP&&this._greater(n,this.parent(n));)this._swap(n,this.parent(n)),n=this.parent(n)}_siftDown(n=this.TOP){let s,c,u=this.size();for(;s=this.left(n),c=this.right(n),s<u&&this._greater(s,n)||c<u&&this._greater(c,n);){let d=c<u&&this._greater(c,s)?c:s;this._swap(n,d),n=d}}}var rh="http://www.w3.org/1999/xhtml";const hd={svg:"http://www.w3.org/2000/svg",xhtml:rh,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Cp(i){var n=i+="",s=n.indexOf(":");return s>=0&&(n=i.slice(0,s))!=="xmlns"&&(i=i.slice(s+1)),hd.hasOwnProperty(n)?{space:hd[n],local:i}:i}function $1(i){return function(){var n=this.ownerDocument,s=this.namespaceURI;return s===rh&&n.documentElement.namespaceURI===rh?n.createElement(i):n.createElementNS(s,i)}}function e0(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function Mp(i){var n=Cp(i);return(n.local?e0:$1)(n)}function t0(){}function zp(i){return i==null?t0:function(){return this.querySelector(i)}}function i0(i){typeof i!="function"&&(i=zp(i));for(var n=this._groups,s=n.length,c=new Array(s),u=0;u<s;++u)for(var d=n[u],m=d.length,o=c[u]=new Array(m),x,w,I=0;I<m;++I)(x=d[I])&&(w=i.call(x,x.__data__,I,d))&&("__data__"in x&&(w.__data__=x.__data__),o[I]=w);return new zr(c,this._parents)}function n0(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function r0(){return[]}function s0(i){return i==null?r0:function(){return this.querySelectorAll(i)}}function a0(i){return function(){return n0(i.apply(this,arguments))}}function o0(i){typeof i=="function"?i=a0(i):i=s0(i);for(var n=this._groups,s=n.length,c=[],u=[],d=0;d<s;++d)for(var m=n[d],o=m.length,x,w=0;w<o;++w)(x=m[w])&&(c.push(i.call(x,x.__data__,w,m)),u.push(x));return new zr(c,u)}function l0(i){return function(){return this.matches(i)}}function Dp(i){return function(n){return n.matches(i)}}var c0=Array.prototype.find;function u0(i){return function(){return c0.call(this.children,i)}}function h0(){return this.firstElementChild}function f0(i){return this.select(i==null?h0:u0(typeof i=="function"?i:Dp(i)))}var d0=Array.prototype.filter;function m0(){return Array.from(this.children)}function p0(i){return function(){return d0.call(this.children,i)}}function g0(i){return this.selectAll(i==null?m0:p0(typeof i=="function"?i:Dp(i)))}function _0(i){typeof i!="function"&&(i=l0(i));for(var n=this._groups,s=n.length,c=new Array(s),u=0;u<s;++u)for(var d=n[u],m=d.length,o=c[u]=[],x,w=0;w<m;++w)(x=d[w])&&i.call(x,x.__data__,w,d)&&o.push(x);return new zr(c,this._parents)}function Pp(i){return new Array(i.length)}function y0(){return new zr(this._enter||this._groups.map(Pp),this._parents)}function Vc(i,n){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=n}Vc.prototype={constructor:Vc,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,n){return this._parent.insertBefore(i,n)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function v0(i){return function(){return i}}function b0(i,n,s,c,u,d){for(var m=0,o,x=n.length,w=d.length;m<w;++m)(o=n[m])?(o.__data__=d[m],c[m]=o):s[m]=new Vc(i,d[m]);for(;m<x;++m)(o=n[m])&&(u[m]=o)}function x0(i,n,s,c,u,d,m){var o,x,w=new Map,I=n.length,k=d.length,E=new Array(I),B;for(o=0;o<I;++o)(x=n[o])&&(E[o]=B=m.call(x,x.__data__,o,n)+"",w.has(B)?u[o]=x:w.set(B,x));for(o=0;o<k;++o)B=m.call(i,d[o],o,d)+"",(x=w.get(B))?(c[o]=x,x.__data__=d[o],w.delete(B)):s[o]=new Vc(i,d[o]);for(o=0;o<I;++o)(x=n[o])&&w.get(E[o])===x&&(u[o]=x)}function w0(i){return i.__data__}function I0(i,n){if(!arguments.length)return Array.from(this,w0);var s=n?x0:b0,c=this._parents,u=this._groups;typeof i!="function"&&(i=v0(i));for(var d=u.length,m=new Array(d),o=new Array(d),x=new Array(d),w=0;w<d;++w){var I=c[w],k=u[w],E=k.length,B=k0(i.call(I,I&&I.__data__,w,c)),K=B.length,U=o[w]=new Array(K),X=m[w]=new Array(K),Q=x[w]=new Array(E);s(I,k,U,X,Q,B,n);for(var Y=0,re=0,V,ne;Y<K;++Y)if(V=U[Y]){for(Y>=re&&(re=Y+1);!(ne=X[re])&&++re<K;);V._next=ne||null}}return m=new zr(m,c),m._enter=o,m._exit=x,m}function k0(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function T0(){return new zr(this._exit||this._groups.map(Pp),this._parents)}function S0(i,n,s){var c=this.enter(),u=this,d=this.exit();return typeof i=="function"?(c=i(c),c&&(c=c.selection())):c=c.append(i+""),n!=null&&(u=n(u),u&&(u=u.selection())),s==null?d.remove():s(d),c&&u?c.merge(u).order():u}function E0(i){for(var n=i.selection?i.selection():i,s=this._groups,c=n._groups,u=s.length,d=c.length,m=Math.min(u,d),o=new Array(u),x=0;x<m;++x)for(var w=s[x],I=c[x],k=w.length,E=o[x]=new Array(k),B,K=0;K<k;++K)(B=w[K]||I[K])&&(E[K]=B);for(;x<u;++x)o[x]=s[x];return new zr(o,this._parents)}function A0(){for(var i=this._groups,n=-1,s=i.length;++n<s;)for(var c=i[n],u=c.length-1,d=c[u],m;--u>=0;)(m=c[u])&&(d&&m.compareDocumentPosition(d)^4&&d.parentNode.insertBefore(m,d),d=m);return this}function C0(i){i||(i=M0);function n(k,E){return k&&E?i(k.__data__,E.__data__):!k-!E}for(var s=this._groups,c=s.length,u=new Array(c),d=0;d<c;++d){for(var m=s[d],o=m.length,x=u[d]=new Array(o),w,I=0;I<o;++I)(w=m[I])&&(x[I]=w);x.sort(n)}return new zr(u,this._parents).order()}function M0(i,n){return i<n?-1:i>n?1:i>=n?0:NaN}function z0(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function D0(){return Array.from(this)}function P0(){for(var i=this._groups,n=0,s=i.length;n<s;++n)for(var c=i[n],u=0,d=c.length;u<d;++u){var m=c[u];if(m)return m}return null}function L0(){let i=0;for(const n of this)++i;return i}function B0(){return!this.node()}function R0(i){for(var n=this._groups,s=0,c=n.length;s<c;++s)for(var u=n[s],d=0,m=u.length,o;d<m;++d)(o=u[d])&&i.call(o,o.__data__,d,u);return this}function F0(i){return function(){this.removeAttribute(i)}}function O0(i){return function(){this.removeAttributeNS(i.space,i.local)}}function V0(i,n){return function(){this.setAttribute(i,n)}}function N0(i,n){return function(){this.setAttributeNS(i.space,i.local,n)}}function U0(i,n){return function(){var s=n.apply(this,arguments);s==null?this.removeAttribute(i):this.setAttribute(i,s)}}function G0(i,n){return function(){var s=n.apply(this,arguments);s==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,s)}}function q0(i,n){var s=Cp(i);if(arguments.length<2){var c=this.node();return s.local?c.getAttributeNS(s.space,s.local):c.getAttribute(s)}return this.each((n==null?s.local?O0:F0:typeof n=="function"?s.local?G0:U0:s.local?N0:V0)(s,n))}function Lp(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function j0(i){return function(){this.style.removeProperty(i)}}function Z0(i,n,s){return function(){this.style.setProperty(i,n,s)}}function X0(i,n,s){return function(){var c=n.apply(this,arguments);c==null?this.style.removeProperty(i):this.style.setProperty(i,c,s)}}function W0(i,n,s){return arguments.length>1?this.each((n==null?j0:typeof n=="function"?X0:Z0)(i,n,s??"")):H0(this.node(),i)}function H0(i,n){return i.style.getPropertyValue(n)||Lp(i).getComputedStyle(i,null).getPropertyValue(n)}function K0(i){return function(){delete this[i]}}function Y0(i,n){return function(){this[i]=n}}function J0(i,n){return function(){var s=n.apply(this,arguments);s==null?delete this[i]:this[i]=s}}function Q0(i,n){return arguments.length>1?this.each((n==null?K0:typeof n=="function"?J0:Y0)(i,n)):this.node()[i]}function Bp(i){return i.trim().split(/^|\s+/)}function vh(i){return i.classList||new Rp(i)}function Rp(i){this._node=i,this._names=Bp(i.getAttribute("class")||"")}Rp.prototype={add:function(i){var n=this._names.indexOf(i);n<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var n=this._names.indexOf(i);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function Fp(i,n){for(var s=vh(i),c=-1,u=n.length;++c<u;)s.add(n[c])}function Op(i,n){for(var s=vh(i),c=-1,u=n.length;++c<u;)s.remove(n[c])}function $0(i){return function(){Fp(this,i)}}function ey(i){return function(){Op(this,i)}}function ty(i,n){return function(){(n.apply(this,arguments)?Fp:Op)(this,i)}}function iy(i,n){var s=Bp(i+"");if(arguments.length<2){for(var c=vh(this.node()),u=-1,d=s.length;++u<d;)if(!c.contains(s[u]))return!1;return!0}return this.each((typeof n=="function"?ty:n?$0:ey)(s,n))}function ny(){this.textContent=""}function ry(i){return function(){this.textContent=i}}function sy(i){return function(){var n=i.apply(this,arguments);this.textContent=n??""}}function ay(i){return arguments.length?this.each(i==null?ny:(typeof i=="function"?sy:ry)(i)):this.node().textContent}function oy(){this.innerHTML=""}function ly(i){return function(){this.innerHTML=i}}function cy(i){return function(){var n=i.apply(this,arguments);this.innerHTML=n??""}}function uy(i){return arguments.length?this.each(i==null?oy:(typeof i=="function"?cy:ly)(i)):this.node().innerHTML}function hy(){this.nextSibling&&this.parentNode.appendChild(this)}function fy(){return this.each(hy)}function dy(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function my(){return this.each(dy)}function py(i){var n=typeof i=="function"?i:Mp(i);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function gy(){return null}function _y(i,n){var s=typeof i=="function"?i:Mp(i),c=n==null?gy:typeof n=="function"?n:zp(n);return this.select(function(){return this.insertBefore(s.apply(this,arguments),c.apply(this,arguments)||null)})}function yy(){var i=this.parentNode;i&&i.removeChild(this)}function vy(){return this.each(yy)}function by(){var i=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(i,this.nextSibling):i}function xy(){var i=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(i,this.nextSibling):i}function wy(i){return this.select(i?xy:by)}function Iy(i){return arguments.length?this.property("__data__",i):this.node().__data__}function ky(i){return function(n){i.call(this,n,this.__data__)}}function Ty(i){return i.trim().split(/^|\s+/).map(function(n){var s="",c=n.indexOf(".");return c>=0&&(s=n.slice(c+1),n=n.slice(0,c)),{type:n,name:s}})}function Sy(i){return function(){var n=this.__on;if(n){for(var s=0,c=-1,u=n.length,d;s<u;++s)d=n[s],(!i.type||d.type===i.type)&&d.name===i.name?this.removeEventListener(d.type,d.listener,d.options):n[++c]=d;++c?n.length=c:delete this.__on}}}function Ey(i,n,s){return function(){var c=this.__on,u,d=ky(n);if(c){for(var m=0,o=c.length;m<o;++m)if((u=c[m]).type===i.type&&u.name===i.name){this.removeEventListener(u.type,u.listener,u.options),this.addEventListener(u.type,u.listener=d,u.options=s),u.value=n;return}}this.addEventListener(i.type,d,s),u={type:i.type,name:i.name,value:n,listener:d,options:s},c?c.push(u):this.__on=[u]}}function Ay(i,n,s){var c=Ty(i+""),u,d=c.length,m;if(arguments.length<2){var o=this.node().__on;if(o){for(var x=0,w=o.length,I;x<w;++x)for(u=0,I=o[x];u<d;++u)if((m=c[u]).type===I.type&&m.name===I.name)return I.value}return}for(o=n?Ey:Sy,u=0;u<d;++u)this.each(o(c[u],n,s));return this}function Vp(i,n,s){var c=Lp(i),u=c.CustomEvent;typeof u=="function"?u=new u(n,s):(u=c.document.createEvent("Event"),s?(u.initEvent(n,s.bubbles,s.cancelable),u.detail=s.detail):u.initEvent(n,!1,!1)),i.dispatchEvent(u)}function Cy(i,n){return function(){return Vp(this,i,n)}}function My(i,n){return function(){return Vp(this,i,n.apply(this,arguments))}}function zy(i,n){return this.each((typeof n=="function"?My:Cy)(i,n))}function*Dy(){for(var i=this._groups,n=0,s=i.length;n<s;++n)for(var c=i[n],u=0,d=c.length,m;u<d;++u)(m=c[u])&&(yield m)}var Py=[null];function zr(i,n){this._groups=i,this._parents=n}function Ly(){return this}zr.prototype={constructor:zr,select:i0,selectAll:o0,selectChild:f0,selectChildren:g0,filter:_0,data:I0,enter:y0,exit:T0,join:S0,merge:E0,selection:Ly,order:A0,sort:C0,call:z0,nodes:D0,node:P0,size:L0,empty:B0,each:R0,attr:q0,style:W0,property:Q0,classed:iy,text:ay,html:uy,raise:fy,lower:my,append:py,insert:_y,remove:vy,clone:wy,datum:Iy,on:Ay,dispatch:zy,[Symbol.iterator]:Dy};function Np(i){return typeof i=="string"?new zr([[document.querySelector(i)]],[document.documentElement]):new zr([[i]],Py)}function fd(i,n,s){const c=i.slice();return c[17]=n[s],c[19]=s,c}function dd(i,n,s){const c=i.slice();return c[17]=n[s],c[19]=s,c}function md(i){let n,s,c,u;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(d){n=dt(d,"g",{transform:!0});var m=be(n);s=dt(m,"circle",{r:!0,stroke:!0,fill:!0,opacity:!0}),be(s).forEach(G),m.forEach(G),this.h()},h(){A(s,"r",c=Vn.background[i[1]===0?"split":"full"]+1),A(s,"stroke","none"),A(s,"fill","white"),A(s,"opacity","1"),A(n,"transform",u="translate("+i[17].x+","+i[2](i[17].y)+")")},m(d,m){Be(d,n,m),we(n,s)},p(d,m){m&2&&c!==(c=Vn.background[d[1]===0?"split":"full"]+1)&&A(s,"r",c),m&12&&u!==(u="translate("+d[17].x+","+d[2](d[17].y)+")")&&A(n,"transform",u)},d(d){d&&G(n)}}}function pd(i){let n,s,c,u,d,m,o;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(x){n=dt(x,"g",{transform:!0});var w=be(n);s=dt(w,"circle",{hoverid:!0,r:!0,stroke:!0,fill:!0,opacity:!0}),be(s).forEach(G),w.forEach(G),this.h()},h(){A(s,"hoverid",c=i[17].datum.areacd),A(s,"r",u=Vn.background[i[1]===0?"split":"full"]),A(s,"stroke","none"),A(s,"fill","#cccccc"),A(s,"opacity","0.5"),A(n,"transform",d="translate("+i[17].x+","+i[2](i[17].y)+")")},m(x,w){Be(x,n,w),we(n,s),m||(o=[Gi(s,"mouseover",i[4]),Gi(s,"mouseleave",i[5]),Gi(s,"focus",i[4])],m=!0)},p(x,w){w&8&&c!==(c=x[17].datum.areacd)&&A(s,"hoverid",c),w&2&&u!==(u=Vn.background[x[1]===0?"split":"full"])&&A(s,"r",u),w&12&&d!==(d="translate("+x[17].x+","+x[2](x[17].y)+")")&&A(n,"transform",d)},d(x){x&&G(n),m=!1,wa(o)}}}function By(i){let n,s,c,u,d,m,o,x=i[3],w=[];for(let E=0;E<x.length;E+=1)w[E]=md(dd(i,x,E));let I=i[3],k=[];for(let E=0;E<I.length;E+=1)k[E]=pd(fd(i,I,E));return m=new J1({props:{backgroundCirclesStep2:i[3].filter(i[16]),y:i[2]}}),{c(){n=ft("g");for(let E=0;E<w.length;E+=1)w[E].c();s=Rt(),c=ft("g");for(let E=0;E<k.length;E+=1)k[E].c();d=Rt(),Nt(m.$$.fragment),this.h()},l(E){n=dt(E,"g",{class:!0});var B=be(n);for(let U=0;U<w.length;U+=1)w[U].l(B);B.forEach(G),s=Ft(E),c=dt(E,"g",{class:!0,opacity:!0});var K=be(c);for(let U=0;U<k.length;U+=1)k[U].l(K);K.forEach(G),d=Ft(E),Kt(m.$$.fragment,E),this.h()},h(){A(n,"class","backgroundCirclesGroup"),A(c,"class","backgroundCirclesGroup"),A(c,"opacity",u=i[0]===null?1:.3)},m(E,B){Be(E,n,B);for(let K=0;K<w.length;K+=1)w[K]&&w[K].m(n,null);Be(E,s,B),Be(E,c,B);for(let K=0;K<k.length;K+=1)k[K]&&k[K].m(c,null);Be(E,d,B),Ut(m,E,B),o=!0},p(E,[B]){if(B&14){x=E[3];let U;for(U=0;U<x.length;U+=1){const X=dd(E,x,U);w[U]?w[U].p(X,B):(w[U]=md(X),w[U].c(),w[U].m(n,null))}for(;U<w.length;U+=1)w[U].d(1);w.length=x.length}if(B&62){I=E[3];let U;for(U=0;U<I.length;U+=1){const X=fd(E,I,U);k[U]?k[U].p(X,B):(k[U]=pd(X),k[U].c(),k[U].m(c,null))}for(;U<k.length;U+=1)k[U].d(1);k.length=I.length}(!o||B&1&&u!==(u=E[0]===null?1:.3))&&A(c,"opacity",u);const K={};B&9&&(K.backgroundCirclesStep2=E[3].filter(E[16])),B&4&&(K.y=E[2]),m.$set(K)},i(E){o||(Le(m.$$.fragment,E),o=!0)},o(E){Ze(m.$$.fragment,E),o=!1},d(E){E&&G(n),$i(w,E),E&&G(s),E&&G(c),$i(k,E),E&&G(d),Gt(m,E)}}}function Ry(i,n,s){let c,u,{chosenId3:d}=n,{visibleAreas:m,backgroundLatestData:o}=n,{x,y:w,yDomainGlobal:I}=n,{scaleWidth:k}=n,{medianValue:E,medianAbsoluteDeviation:B}=n,{chartIndex:K,hoverIndex:U,hoverChartIndex:X}=n;function Q(V){let ne=Np(this).attr("hoverid");!m.map(oe=>oe.areacd).includes(U)&d!=0&&(s(0,U=ne),s(7,X=K))}function Y(V){s(0,U=null),s(7,X=null)}const re=(V,ne)=>V.datum.areacd===U;return i.$$set=V=>{"chosenId3"in V&&s(1,d=V.chosenId3),"visibleAreas"in V&&s(8,m=V.visibleAreas),"backgroundLatestData"in V&&s(9,o=V.backgroundLatestData),"x"in V&&s(10,x=V.x),"y"in V&&s(2,w=V.y),"yDomainGlobal"in V&&s(6,I=V.yDomainGlobal),"scaleWidth"in V&&s(11,k=V.scaleWidth),"medianValue"in V&&s(12,E=V.medianValue),"medianAbsoluteDeviation"in V&&s(13,B=V.medianAbsoluteDeviation),"chartIndex"in V&&s(14,K=V.chartIndex),"hoverIndex"in V&&s(0,U=V.hoverIndex),"hoverChartIndex"in V&&s(7,X=V.hoverChartIndex)},i.$$.update=()=>{i.$$.dirty&12800&&s(15,c=o.map(V=>({...V,zScore:(V.value-E)/B}))),i.$$.dirty&35842&&s(3,u=new Ap(c,Vn.background[d===0?"split":"full"],V=>x(V.zScore)>k?k+Ht.areaSpaceBeyondXScale[d===0?"split":"full"]/2:x(V.zScore)<0?-Ht.areaSpaceBeyondXScale[d===0?"split":"full"]/2:x(V.zScore)).calculateYPositions()),i.$$.dirty&72&&s(6,I[0]=u!=null?Math.min(...u.map(V=>V.y),I[0]):I[0],I),i.$$.dirty&72&&s(6,I[1]=u!=null?Math.max(...u.map(V=>V.y),I[1]):I[1],I)},[U,d,w,u,Q,Y,I,X,m,o,x,k,E,B,K,c,re]}class Fy extends pi{constructor(n){super(),gi(this,n,Ry,By,_i,{chosenId3:1,visibleAreas:8,backgroundLatestData:9,x:10,y:2,yDomainGlobal:6,scaleWidth:11,medianValue:12,medianAbsoluteDeviation:13,chartIndex:14,hoverIndex:0,hoverChartIndex:7})}}function gd(i,n,s){const c=i.slice();return c[9]=n[s],c[10]=n,c[11]=s,c}function _d(i){let n,s=i[3],c=[];for(let u=0;u<s.length;u+=1)c[u]=yd(gd(i,s,u));return{c(){for(let u=0;u<c.length;u+=1)c[u].c();n=si()},l(u){for(let d=0;d<c.length;d+=1)c[d].l(u);n=si()},m(u,d){for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(u,d);Be(u,n,d)},p(u,d){if(d&61){s=u[3];let m;for(m=0;m<s.length;m+=1){const o=gd(u,s,m);c[m]?c[m].p(o,d):(c[m]=yd(o),c[m].c(),c[m].m(n.parentNode,n))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},d(u){$i(c,u),u&&G(n)}}}function yd(i){let n,s,c,u,d,m,o=i[2].prefix+Hr(Ir(i[9].datum.value,i[2].decimalPlaces))+i[2].suffix+"",x,w,I,k,E,B,K;function U(){i[8].call(m,i[11])}return{c(){n=ft("g"),s=ft("rect"),m=ft("text"),x=fi(o),this.h()},l(X){n=dt(X,"g",{class:!0,transform:!0});var Q=be(n);s=dt(Q,"rect",{labelid:!0,transform:!0,x:!0,y:!0,width:!0,height:!0,rx:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(s).forEach(G),m=dt(Q,"text",{labelid:!0,transform:!0,x:!0,y:!0,"text-anchor":!0,"stroke-width":!0,stroke:!0,fill:!0,"font-size":!0});var Y=be(m);x=di(Y,o),Y.forEach(G),Q.forEach(G),this.h()},h(){A(s,"labelid",i[11]),A(s,"transform","translate(0,0)"),A(s,"x","0"),A(s,"y","0"),A(s,"width",c=i[5].length>i[11]?i[5][i[11]].width+6:0),A(s,"height",u=i[9].datum.role!="main"?21:24),A(s,"rx","3px"),A(s,"stroke",d=ni[i[9].datum.role]),A(s,"fill","white"),A(s,"stroke-width","1.5px"),A(m,"labelid",i[11]),A(m,"transform","translate(0,0)"),A(m,"x","3"),A(m,"y",w=i[9].datum.role!="main"?16:18),A(m,"text-anchor","start"),A(m,"stroke-width","0.25px"),A(m,"stroke",I=ni[i[9].datum.role]),A(m,"fill",k=ni[i[9].datum.role]),A(m,"font-size",E=i[9].datum.role!="main"?"16px":"18px"),A(n,"class","value-label-group"),A(n,"transform",K="translate("+Math.min(i[0]+Ht.right.split+Ht.areaSpaceBeyondXScale.split-(i[5][i[11]]==null?0:i[5][i[11]].width+6),Math.max(-Ht.left.split-Ht.areaSpaceBeyondXScale.split,i[9].x-(i[5][i[11]]==null?0:i[3][i[11]].x<i[3][i[11]===0?i[3].length-1:0].x?i[5][i[11]].width+6:0)))+","+(i[4](0)+12)+")")},m(X,Q){Be(X,n,Q),we(n,s),we(n,m),we(m,x),B=mh.observe(m,U.bind(m))},p(X,Q){i=X,Q&32&&c!==(c=i[5].length>i[11]?i[5][i[11]].width+6:0)&&A(s,"width",c),Q&8&&u!==(u=i[9].datum.role!="main"?21:24)&&A(s,"height",u),Q&8&&d!==(d=ni[i[9].datum.role])&&A(s,"stroke",d),Q&12&&o!==(o=i[2].prefix+Hr(Ir(i[9].datum.value,i[2].decimalPlaces))+i[2].suffix+"")&&zi(x,o),Q&8&&w!==(w=i[9].datum.role!="main"?16:18)&&A(m,"y",w),Q&8&&I!==(I=ni[i[9].datum.role])&&A(m,"stroke",I),Q&8&&k!==(k=ni[i[9].datum.role])&&A(m,"fill",k),Q&8&&E!==(E=i[9].datum.role!="main"?"16px":"18px")&&A(m,"font-size",E),Q&57&&K!==(K="translate("+Math.min(i[0]+Ht.right.split+Ht.areaSpaceBeyondXScale.split-(i[5][i[11]]==null?0:i[5][i[11]].width+6),Math.max(-Ht.left.split-Ht.areaSpaceBeyondXScale.split,i[9].x-(i[5][i[11]]==null?0:i[3][i[11]].x<i[3][i[11]===0?i[3].length-1:0].x?i[5][i[11]].width+6:0)))+","+(i[4](0)+12)+")")&&A(n,"transform",K)},d(X){X&&G(n),B()}}}function Oy(i){let n,s=i[1]===0&&_d(i);return{c(){n=ft("g"),s&&s.c(),this.h()},l(c){n=dt(c,"g",{class:!0});var u=be(n);s&&s.l(u),u.forEach(G),this.h()},h(){A(n,"class","labels-group")},m(c,u){Be(c,n,u),s&&s.m(n,null)},p(c,[u]){c[1]===0?s?s.p(c,u):(s=_d(c),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:hi,o:hi,d(c){c&&G(n),s&&s.d()}}}function Vy(i,n,s){let c,{scaleWidth:u}=n,{chosenId3:d}=n,{metadata:m}=n,{primaryCirclesStep2:o}=n,{y:x}=n,{hoverIndex:w,hoverChartIndex:I}=n;function k(E){var B;c[E]=(B=ph.entries.get(this))==null?void 0:B.contentRect,s(5,c)}return i.$$set=E=>{"scaleWidth"in E&&s(0,u=E.scaleWidth),"chosenId3"in E&&s(1,d=E.chosenId3),"metadata"in E&&s(2,m=E.metadata),"primaryCirclesStep2"in E&&s(3,o=E.primaryCirclesStep2),"y"in E&&s(4,x=E.y),"hoverIndex"in E&&s(6,w=E.hoverIndex),"hoverChartIndex"in E&&s(7,I=E.hoverChartIndex)},s(5,c=[]),[u,d,m,o,x,c,w,I,k]}class Ny extends pi{constructor(n){super(),gi(this,n,Vy,Oy,_i,{scaleWidth:0,chosenId3:1,metadata:2,primaryCirclesStep2:3,y:4,hoverIndex:6,hoverChartIndex:7})}}function vd(i,n,s){const c=i.slice();return c[22]=n[s],c[24]=s,c}function bd(i){let n,s,c,u,d,m,o;return{c(){n=ft("line"),u=ft("line"),this.h()},l(x){n=dt(x,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(n).forEach(G),u=dt(x,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,fill:!0,opacity:!0,"stroke-width":!0}),be(u).forEach(G),this.h()},h(){A(n,"x1",s=Math.max(-i[22].x+Ht.areaSpaceBeyondXScale[i[1]===0?"split":"full"]/2,-25)),A(n,"x2",c=Math.min(i[3]-i[22].x+Ht.areaSpaceBeyondXScale[i[1]===0?"split":"full"]/2,25)),A(n,"y1","0"),A(n,"y2","0"),A(n,"stroke","white"),A(n,"fill","none"),A(n,"stroke-width","4px"),A(u,"x1",d=Math.max(-i[22].x+Ht.areaSpaceBeyondXScale[i[1]===0?"split":"full"]/2,-25)),A(u,"x2",m=Math.min(i[3]-i[22].x+Ht.areaSpaceBeyondXScale[i[1]===0?"split":"full"]/2,25)),A(u,"y1","0"),A(u,"y2","0"),A(u,"stroke",o=ni[i[22].datum.role]),A(u,"fill","none"),A(u,"opacity","0.5"),A(u,"stroke-width","4px")},m(x,w){Be(x,n,w),Be(x,u,w)},p(x,w){w&66&&s!==(s=Math.max(-x[22].x+Ht.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,-25))&&A(n,"x1",s),w&74&&c!==(c=Math.min(x[3]-x[22].x+Ht.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,25))&&A(n,"x2",c),w&66&&d!==(d=Math.max(-x[22].x+Ht.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,-25))&&A(u,"x1",d),w&74&&m!==(m=Math.min(x[3]-x[22].x+Ht.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,25))&&A(u,"x2",m),w&64&&o!==(o=ni[x[22].datum.role])&&A(u,"stroke",o)},d(x){x&&G(n),x&&G(u)}}}function Uy(i){let n,s,c;return{c(){n=ft("circle"),this.h()},l(u){n=dt(u,"circle",{"pointer-events":!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0,opacity:!0}),be(n).forEach(G),this.h()},h(){A(n,"pointer-events","none"),A(n,"r",s=Vn.primary[i[1]===0?"split":"full"]),A(n,"stroke","white"),A(n,"stroke-width","1px"),A(n,"fill",c=ni[i[22].datum.role]),A(n,"opacity","1")},m(u,d){Be(u,n,d)},p(u,d){d&2&&s!==(s=Vn.primary[u[1]===0?"split":"full"])&&A(n,"r",s),d&64&&c!==(c=ni[u[22].datum.role])&&A(n,"fill",c)},d(u){u&&G(n)}}}function Gy(i){let n,s,c,u,d,m,o;return{c(){n=ft("rect"),this.h()},l(x){n=dt(x,"rect",{"pointer-events":!0,transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0});var w=be(n);w.forEach(G),this.h()},h(){A(n,"pointer-events","none"),A(n,"transform",s=["country","uk"].includes(i[22].datum.role)?"rotate(45)":null),A(n,"x",c=-Vn.primary[i[1]===0?"split":"full"]+.5),A(n,"y",u=-Vn.primary[i[1]===0?"split":"full"]+.5),A(n,"width",d=Vn.primary[i[1]===0?"split":"full"]*2-1),A(n,"height",m=Vn.primary[i[1]===0?"split":"full"]*2-1),A(n,"fill",o=ni[i[22].datum.role]),A(n,"stroke","white"),A(n,"stroke-width","1px"),A(n,"opacity","1")},m(x,w){Be(x,n,w)},p(x,w){w&64&&s!==(s=["country","uk"].includes(x[22].datum.role)?"rotate(45)":null)&&A(n,"transform",s),w&2&&c!==(c=-Vn.primary[x[1]===0?"split":"full"]+.5)&&A(n,"x",c),w&2&&u!==(u=-Vn.primary[x[1]===0?"split":"full"]+.5)&&A(n,"y",u),w&2&&d!==(d=Vn.primary[x[1]===0?"split":"full"]*2-1)&&A(n,"width",d),w&2&&m!==(m=Vn.primary[x[1]===0?"split":"full"]*2-1)&&A(n,"height",m),w&64&&o!==(o=ni[x[22].datum.role])&&A(n,"fill",o)},d(x){x&&G(n)}}}function xd(i){let n,s=i[0].includes(0),c,u,d,m,o=s&&bd(i);function x(k,E){return E&64&&(u=null),u==null&&(u=!!["parent","country","uk"].includes(k[22].datum.role)),u?Gy:Uy}let w=x(i,-1),I=w(i);return{c(){n=ft("g"),o&&o.c(),c=ft("g"),I.c(),this.h()},l(k){n=dt(k,"g",{transform:!0});var E=be(n);o&&o.l(E),c=dt(E,"g",{transform:!0});var B=be(c);I.l(B),B.forEach(G),E.forEach(G),this.h()},h(){A(c,"transform",d="scale("+(i[1]===0&i[24]===0&i[7].length===2?.75:1)+")"),A(n,"transform",m="translate("+i[22].x+","+(i[0].includes(0)?-7.5+15*i[24]:i[22].y+i[8])+")")},m(k,E){Be(k,n,E),o&&o.m(n,null),we(n,c),I.m(c,null)},p(k,E){E&1&&(s=k[0].includes(0)),s?o?o.p(k,E):(o=bd(k),o.c(),o.m(n,c)):o&&(o.d(1),o=null),w===(w=x(k,E))&&I?I.p(k,E):(I.d(1),I=w(k),I&&(I.c(),I.m(c,null))),E&130&&d!==(d="scale("+(k[1]===0&k[24]===0&k[7].length===2?.75:1)+")")&&A(c,"transform",d),E&321&&m!==(m="translate("+k[22].x+","+(k[0].includes(0)?-7.5+15*k[24]:k[22].y+k[8])+")")&&A(n,"transform",m)},d(k){k&&G(n),o&&o.d(),I.d()}}}function wd(i){let n,s;return n=new Ny({props:{scaleWidth:i[3],chosenId3:i[1],metadata:i[2],primaryCirclesStep2:i[6],y:i[4],hoverIndex:i[5]}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u&8&&(d.scaleWidth=c[3]),u&2&&(d.chosenId3=c[1]),u&4&&(d.metadata=c[2]),u&64&&(d.primaryCirclesStep2=c[6]),u&16&&(d.y=c[4]),u&32&&(d.hoverIndex=c[5]),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function qy(i){let n,s,c,u,d=!i[0].includes(0),m,o,x=i[6],w=[];for(let k=0;k<x.length;k+=1)w[k]=xd(vd(i,x,k));let I=d&&wd(i);return{c(){n=ft("g");for(let k=0;k<w.length;k+=1)w[k].c();u=Rt(),I&&I.c(),m=si(),this.h()},l(k){n=dt(k,"g",{class:!0,transform:!0,opacity:!0});var E=be(n);for(let B=0;B<w.length;B+=1)w[B].l(E);E.forEach(G),u=Ft(k),I&&I.l(k),m=si(),this.h()},h(){A(n,"class","primaryCirclesGroup"),A(n,"transform",s="translate(0,"+i[4](0)+")"),A(n,"opacity",c=i[5]===null?1:.2)},m(k,E){Be(k,n,E);for(let B=0;B<w.length;B+=1)w[B]&&w[B].m(n,null);Be(k,u,E),I&&I.m(k,E),Be(k,m,E),o=!0},p(k,[E]){if(E&459){x=k[6];let B;for(B=0;B<x.length;B+=1){const K=vd(k,x,B);w[B]?w[B].p(K,E):(w[B]=xd(K),w[B].c(),w[B].m(n,null))}for(;B<w.length;B+=1)w[B].d(1);w.length=x.length}(!o||E&16&&s!==(s="translate(0,"+k[4](0)+")"))&&A(n,"transform",s),(!o||E&32&&c!==(c=k[5]===null?1:.2))&&A(n,"opacity",c),E&1&&(d=!k[0].includes(0)),d?I?(I.p(k,E),E&1&&Le(I,1)):(I=wd(k),I.c(),Le(I,1),I.m(m.parentNode,m)):I&&(wi(),Ze(I,1,1,()=>{I=null}),Ii())},i(k){o||(Le(I),o=!0)},o(k){Ze(I),o=!1},d(k){k&&G(n),$i(w,k),k&&G(u),I&&I.d(k),k&&G(m)}}}function jy(i,n,s){let c,u,d,m,o,{mainLatestValue:x}=n,{comparisonLatestValue:w}=n,{baselineComparisonArea:I}=n,{baselineComparisonName:k}=n,{chosenId6:E}=n,{chosenId3:B}=n,{visibleAreas:K,data:U}=n,{metadata:X}=n,{scaleWidth:Q}=n,{y:Y,x:re}=n,{medianValue:V,medianAbsoluteDeviation:ne}=n,{hoverIndex:oe}=n,Ne=xi("selectedArea"),he=xi("selectedAndRelatedAreas");return i.$$set=fe=>{"mainLatestValue"in fe&&s(9,x=fe.mainLatestValue),"comparisonLatestValue"in fe&&s(10,w=fe.comparisonLatestValue),"baselineComparisonArea"in fe&&s(11,I=fe.baselineComparisonArea),"baselineComparisonName"in fe&&s(12,k=fe.baselineComparisonName),"chosenId6"in fe&&s(0,E=fe.chosenId6),"chosenId3"in fe&&s(1,B=fe.chosenId3),"visibleAreas"in fe&&s(13,K=fe.visibleAreas),"data"in fe&&s(14,U=fe.data),"metadata"in fe&&s(2,X=fe.metadata),"scaleWidth"in fe&&s(3,Q=fe.scaleWidth),"y"in fe&&s(4,Y=fe.y),"x"in fe&&s(15,re=fe.x),"medianValue"in fe&&s(16,V=fe.medianValue),"medianAbsoluteDeviation"in fe&&s(17,ne=fe.medianAbsoluteDeviation),"hoverIndex"in fe&&s(5,oe=fe.hoverIndex)},i.$$.update=()=>{i.$$.dirty&7680&&s(7,c=[{areacd:I.areacd,areanm:k,value:w},{areacd:Ne.areacd,areanm:Ne.areanm,value:x}].filter(fe=>fe.value!=null)),i.$$.dirty&221314&&s(19,u=(B===0?c:U.filter(fe=>K.map(pe=>pe.areacd).includes(fe.areacd))).map(fe=>({...fe,role:fe.areacd==="median"?"median":[...he,...K].find(pe=>fe.areacd===pe.areacd).role,zScore:(fe.value-V)/ne}))),i.$$.dirty&557066&&s(6,d=new Ap(u,B===0?Vn.primary.split*.6:Vn.primary.full+1.5,fe=>re(fe.zScore)>Q?Q+Ht.areaSpaceBeyondXScale[B===0?"split":"full"]/2:re(fe.zScore)<0?-Ht.areaSpaceBeyondXScale[B===0?"split":"full"]/2:re(fe.zScore)).calculateYPositions()),i.$$.dirty&64&&s(18,m=[Math.min(...d.map(fe=>fe.y)),Math.max(...d.map(fe=>fe.y))]),i.$$.dirty&262144&&s(8,o=-(m[0]+m[1])/2)},[E,B,X,Q,Y,oe,d,c,o,x,w,I,k,K,U,re,V,ne,m,u]}class Zy extends pi{constructor(n){super(),gi(this,n,jy,qy,_i,{mainLatestValue:9,comparisonLatestValue:10,baselineComparisonArea:11,baselineComparisonName:12,chosenId6:0,chosenId3:1,visibleAreas:13,data:14,metadata:2,scaleWidth:3,y:4,x:15,medianValue:16,medianAbsoluteDeviation:17,hoverIndex:5})}}function Id(i){let n,s=(i[15].includes(0)?Math.random()<.5&i[17]!=null?"Statistically significant difference":"":i[19])+"",c;return{c(){n=it("p"),c=fi(s),this.h()},l(u){n=nt(u,"P",{class:!0});var d=be(n);c=di(d,s),d.forEach(G),this.h()},h(){A(n,"class","from-comparison-description svelte-hff5ty")},m(u,d){Be(u,n,d),we(n,c)},p(u,d){d[0]&688128&&s!==(s=(u[15].includes(0)?Math.random()<.5&u[17]!=null?"Statistically significant difference":"":u[19])+"")&&zi(c,s)},d(u){u&&G(n)}}}function kd(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K;function U(re){i[36](re)}function X(re){i[37](re)}function Q(re){i[38](re)}let Y={chosenId3:i[8],visibleAreas:i[9],backgroundLatestData:i[3].latestDataSameGeogLevel,scaleWidth:i[11],x:i[12],y:i[13],medianValue:i[21],medianAbsoluteDeviation:i[22],chartIndex:i[5]*100+i[4]};return i[0]!==void 0&&(Y.yDomainGlobal=i[0]),i[1]!==void 0&&(Y.hoverIndex=i[1]),i[2]!==void 0&&(Y.hoverChartIndex=i[2]),u=new Fy({props:Y}),Et.push(()=>Bt(u,"yDomainGlobal",U)),Et.push(()=>Bt(u,"hoverIndex",X)),Et.push(()=>Bt(u,"hoverChartIndex",Q)),w=new Zy({props:{mainLatestValue:i[23],comparisonLatestValue:i[18],baselineComparisonArea:i[10],baselineComparisonName:i[16],metadata:i[6],chosenId3:i[8],visibleAreas:i[9],data:i[3].latestData,scaleWidth:i[11],y:i[13],x:i[12],medianValue:i[21],medianAbsoluteDeviation:i[22],hoverIndex:i[1],chosenId6:i[15]}}),{c(){n=ft("svg"),s=ft("g"),c=ft("g"),Nt(u.$$.fragment),Nt(w.$$.fragment),this.h()},l(re){n=dt(re,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var V=be(n);s=dt(V,"g",{class:!0,transform:!0});var ne=be(s);c=dt(ne,"g",{opacity:!0});var oe=be(c);Kt(u.$$.fragment,oe),oe.forEach(G),Kt(w.$$.fragment,ne),ne.forEach(G),V.forEach(G),this.h()},h(){A(c,"opacity",x=i[15].includes(0)?0:1),A(s,"class","chart-container"),A(s,"transform",I="translate("+(Ht.left[i[8]===0?"split":"full"]+Ht.areaSpaceBeyondXScale[i[8]===0?"split":"full"])+","+Ht.top[i[8]===0?"split":"full"]+")"),A(n,"class",k="beeswarm-row-svg beeswarm-row-svg-"+(i[5]*100+i[4])+" svelte-hff5ty"),A(n,"viewBox",E="0 0 "+i[7]+" "+ws[i[8]===0?"split":"full"]),A(n,"width","100%"),A(n,"height",B=ws[i[8]===0?"split":"full"])},m(re,V){Be(re,n,V),we(n,s),we(s,c),Ut(u,c,null),Ut(w,s,null),K=!0},p(re,V){const ne={};V[0]&256&&(ne.chosenId3=re[8]),V[0]&512&&(ne.visibleAreas=re[9]),V[0]&8&&(ne.backgroundLatestData=re[3].latestDataSameGeogLevel),V[0]&2048&&(ne.scaleWidth=re[11]),V[0]&4096&&(ne.x=re[12]),V[0]&8192&&(ne.y=re[13]),V[0]&48&&(ne.chartIndex=re[5]*100+re[4]),!d&&V[0]&1&&(d=!0,ne.yDomainGlobal=re[0],Ot(()=>d=!1)),!m&&V[0]&2&&(m=!0,ne.hoverIndex=re[1],Ot(()=>m=!1)),!o&&V[0]&4&&(o=!0,ne.hoverChartIndex=re[2],Ot(()=>o=!1)),u.$set(ne),(!K||V[0]&32768&&x!==(x=re[15].includes(0)?0:1))&&A(c,"opacity",x);const oe={};V[0]&262144&&(oe.comparisonLatestValue=re[18]),V[0]&1024&&(oe.baselineComparisonArea=re[10]),V[0]&65536&&(oe.baselineComparisonName=re[16]),V[0]&64&&(oe.metadata=re[6]),V[0]&256&&(oe.chosenId3=re[8]),V[0]&512&&(oe.visibleAreas=re[9]),V[0]&8&&(oe.data=re[3].latestData),V[0]&2048&&(oe.scaleWidth=re[11]),V[0]&8192&&(oe.y=re[13]),V[0]&4096&&(oe.x=re[12]),V[0]&2&&(oe.hoverIndex=re[1]),V[0]&32768&&(oe.chosenId6=re[15]),w.$set(oe),(!K||V[0]&256&&I!==(I="translate("+(Ht.left[re[8]===0?"split":"full"]+Ht.areaSpaceBeyondXScale[re[8]===0?"split":"full"])+","+Ht.top[re[8]===0?"split":"full"]+")"))&&A(s,"transform",I),(!K||V[0]&48&&k!==(k="beeswarm-row-svg beeswarm-row-svg-"+(re[5]*100+re[4])+" svelte-hff5ty"))&&A(n,"class",k),(!K||V[0]&384&&E!==(E="0 0 "+re[7]+" "+ws[re[8]===0?"split":"full"]))&&A(n,"viewBox",E),(!K||V[0]&256&&B!==(B=ws[re[8]===0?"split":"full"]))&&A(n,"height",B)},i(re){K||(Le(u.$$.fragment,re),Le(w.$$.fragment,re),K=!0)},o(re){Ze(u.$$.fragment,re),Ze(w.$$.fragment,re),K=!1},d(re){re&&G(n),Gt(u),Gt(w)}}}function Xy(i){let n,s=i[14].includes(0)&i[8]===0,c,u,d,m=s&&Id(i),o=i[8]===0&&kd(i);return{c(){n=it("div"),m&&m.c(),c=Rt(),o&&o.c(),this.h()},l(x){n=nt(x,"DIV",{class:!0,style:!0});var w=be(n);m&&m.l(w),c=Ft(w),o&&o.l(w),w.forEach(G),this.h()},h(){A(n,"class","area-comparison-cell-container svelte-hff5ty"),A(n,"style",u=i[15].includes(0)|i[8]!=0|i[20]==null?null:"background-color:"+i[20]+"; box-shadow: 0 0 4px 3px "+i[20]+";")},m(x,w){Be(x,n,w),m&&m.m(n,null),we(n,c),o&&o.m(n,null),d=!0},p(x,w){w[0]&16640&&(s=x[14].includes(0)&x[8]===0),s?m?m.p(x,w):(m=Id(x),m.c(),m.m(n,c)):m&&(m.d(1),m=null),x[8]===0?o?(o.p(x,w),w[0]&256&&Le(o,1)):(o=kd(x),o.c(),Le(o,1),o.m(n,null)):o&&(wi(),Ze(o,1,1,()=>{o=null}),Ii()),(!d||w[0]&1081600&&u!==(u=x[15].includes(0)|x[8]!=0|x[20]==null?null:"background-color:"+x[20]+"; box-shadow: 0 0 4px 3px "+x[20]+";"))&&A(n,"style",u)},i(x){d||(Le(o),d=!0)},o(x){Ze(o),d=!1},d(x){x&&G(n),m&&m.d(),o&&o.d()}}}function Wy(i,n,s){let c,u,d,m,o,x,w,I,k,E,B,K,U,X,{indicator:Q}=n,{rowNumb:Y,topicNumb:re}=n,{metadata:V,calculations:ne}=n,{col2Width:oe}=n,{chosenId3:Ne}=n,{visibleAreas:he}=n,{baselineComparisonArea:fe}=n,{scaleHeight:pe,scaleWidth:Ee}=n,{x:ve,xDomain:ze,yDomainGlobal:De,y:j}=n,{hoverIndex:ce,hoverChartIndex:rt}=n,{chosenId11:Ke}=n,{chosenId6:qe}=n,Qe=xi("selectedAndRelatedAreas"),Ie=xi("selectedArea"),lt=ne.calcs[ne.maxXDomain].median,ot=ne.calcs[ne.maxXDomain].mad,vt=ne.calcs[ne.maxXDomain].main;function gt(ue){De=ue,s(0,De)}function We(ue){ce=ue,s(1,ce)}function yt(ue){rt=ue,s(2,rt)}return i.$$set=ue=>{"indicator"in ue&&s(3,Q=ue.indicator),"rowNumb"in ue&&s(4,Y=ue.rowNumb),"topicNumb"in ue&&s(5,re=ue.topicNumb),"metadata"in ue&&s(6,V=ue.metadata),"calculations"in ue&&s(24,ne=ue.calculations),"col2Width"in ue&&s(7,oe=ue.col2Width),"chosenId3"in ue&&s(8,Ne=ue.chosenId3),"visibleAreas"in ue&&s(9,he=ue.visibleAreas),"baselineComparisonArea"in ue&&s(10,fe=ue.baselineComparisonArea),"scaleHeight"in ue&&s(25,pe=ue.scaleHeight),"scaleWidth"in ue&&s(11,Ee=ue.scaleWidth),"x"in ue&&s(12,ve=ue.x),"xDomain"in ue&&s(26,ze=ue.xDomain),"yDomainGlobal"in ue&&s(0,De=ue.yDomainGlobal),"y"in ue&&s(13,j=ue.y),"hoverIndex"in ue&&s(1,ce=ue.hoverIndex),"hoverChartIndex"in ue&&s(2,rt=ue.hoverChartIndex),"chosenId11"in ue&&s(14,Ke=ue.chosenId11),"chosenId6"in ue&&s(15,qe=ue.chosenId6)},i.$$.update=()=>{i.$$.dirty[0]&16778240&&s(18,c=ne.calcs[ne.maxXDomain][(fe.areacd==="median"?fe:Qe.find(ue=>fe.areacd===ue.areacd)).role]),i.$$.dirty[0]&262144&&s(17,u=vt==null|c==null|ot==null?null:(vt-c)/ot),i.$$.dirty[0]&16384&&s(35,d=Ke.includes(1)),i.$$.dirty[0]&64&&s(34,m=V.polarity==0?null:V.polarity==-1?"better":"worse"),i.$$.dirty[0]&64&&s(33,o=V.polarity==0?null:"similar"),i.$$.dirty[0]&64&&s(32,x=V.polarity==0?null:V.polarity==1?"better":"worse"),i.$$.dirty[0]&16384&&s(29,w=Ke.includes(3)?2:1),i.$$.dirty[0]&537002048|i.$$.dirty[1]&30&&s(20,I=!d|u==null|V.polarity==0?null:u<-w?Nn[m]:u<=w?Nn[o]:Nn[x]),i.$$.dirty[0]&1024&&s(16,k=fe.areacd==="median"?"median":fe.areanm),i.$$.dirty[0]&16384&&s(31,E=Ke.includes(2)),i.$$.dirty[0]&64|i.$$.dirty[1]&1&&s(30,B=V.polarity==0|!E?"Lower than":V.polarity==-1?"Better than":"Worse than"),i.$$.dirty[0]&64|i.$$.dirty[1]&1&&s(27,U=V.polarity==0|!E?"Higher than":V.polarity==1?"Better than":"Worse than"),i.$$.dirty[0]&2030501888&&s(19,X=(vt==null?"No "+Ie.areanm+" data":c==null?"No "+k+" data":(u<-w?B:u<=w?K:U)+" "+k)+" in "+ne.maxXDomain)},s(28,K="Similar to"),[De,ce,rt,Q,Y,re,V,oe,Ne,he,fe,Ee,ve,j,Ke,qe,k,u,c,X,I,lt,ot,vt,ne,pe,ze,U,K,w,B,E,x,o,m,d,gt,We,yt]}class Hy extends pi{constructor(n){super(),gi(this,n,Wy,Xy,_i,{indicator:3,rowNumb:4,topicNumb:5,metadata:6,calculations:24,col2Width:7,chosenId3:8,visibleAreas:9,baselineComparisonArea:10,scaleHeight:25,scaleWidth:11,x:12,xDomain:26,yDomainGlobal:0,y:13,hoverIndex:1,hoverChartIndex:2,chosenId11:14,chosenId6:15},null,[-1,-1])}}function Td(i){let n,s,c,u,d,m,o,x,w;return{c(){n=ft("g"),s=ft("g"),c=ft("rect"),d=ft("text"),m=fi(i[4]),this.h()},l(I){n=dt(I,"g",{class:!0,transform:!0});var k=be(n);s=dt(k,"g",{transform:!0});var E=be(s);c=dt(E,"rect",{labelid:!0,transform:!0,x:!0,y:!0,width:!0,height:!0,rx:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(c).forEach(G),d=dt(E,"text",{labelid:!0,transform:!0,x:!0,y:!0,"text-anchor":!0,"stroke-width":!0,stroke:!0,fill:!0,"font-size":!0});var B=be(d);m=di(B,i[4]),B.forEach(G),E.forEach(G),k.forEach(G),this.h()},h(){A(c,"labelid",0),A(c,"transform","translate(0,0)"),A(c,"x","0"),A(c,"y","0"),A(c,"width",u=i[5].length>0?i[5][0].width+6:0),A(c,"height",22),A(c,"rx","3px"),A(c,"stroke",ni.main),A(c,"fill","white"),A(c,"stroke-width","1.5px"),A(d,"labelid",0),A(d,"transform","translate(0,0)"),A(d,"x",3),A(d,"y",16),A(d,"text-anchor","start"),A(d,"stroke-width","0.25px"),A(d,"stroke",ni.main),A(d,"fill",ni.main),A(d,"font-size","16px"),A(s,"transform",x="translate("+(i[0]>i[1]+Ht.right.split+Ht.areaSpaceBeyondXScale.split-(i[5].length>0?i[5][0].width/2:0)?0:i[5].length>0?i[5][0].width/2:0)+",0)"),A(n,"class","value-label-group"),A(n,"transform",w="translate("+Math.min(i[1]+Ht.right.split+Ht.areaSpaceBeyondXScale.split-(i[5][0]==null?0:i[5][0].width+6),Math.max(-Ht.left.split-Ht.areaSpaceBeyondXScale.split,i[0]-(i[5][0]==null?0:i[5][0].width+6)))+","+(i[3]+9)+")")},m(I,k){Be(I,n,k),we(n,s),we(s,c),we(s,d),we(d,m),o=mh.observe(d,i[9].bind(d))},p(I,k){k&32&&u!==(u=I[5].length>0?I[5][0].width+6:0)&&A(c,"width",u),k&16&&zi(m,I[4]),k&35&&x!==(x="translate("+(I[0]>I[1]+Ht.right.split+Ht.areaSpaceBeyondXScale.split-(I[5].length>0?I[5][0].width/2:0)?0:I[5].length>0?I[5][0].width/2:0)+",0)")&&A(s,"transform",x),k&43&&w!==(w="translate("+Math.min(I[1]+Ht.right.split+Ht.areaSpaceBeyondXScale.split-(I[5][0]==null?0:I[5][0].width+6),Math.max(-Ht.left.split-Ht.areaSpaceBeyondXScale.split,I[0]-(I[5][0]==null?0:I[5][0].width+6)))+","+(I[3]+9)+")")&&A(n,"transform",w)},d(I){I&&G(n),o()}}}function Ky(i){let n,s=i[2]===0&&Td(i);return{c(){n=ft("g"),s&&s.c(),this.h()},l(c){n=dt(c,"g",{class:!0});var u=be(n);s&&s.l(u),u.forEach(G),this.h()},h(){A(n,"class","labels-group")},m(c,u){Be(c,n,u),s&&s.m(n,null)},p(c,[u]){c[2]===0?s?s.p(c,u):(s=Td(c),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:hi,o:hi,d(c){c&&G(n),s&&s.d()}}}function Yy(i,n,s){let c,u,{xPosition:d,metadata:m,mainLatestValue:o,mainPreviousValue:x,scaleWidth:w,chosenId3:I,scaleHeight:k}=n;function E(){var B;c[0]=(B=ph.entries.get(this))==null?void 0:B.contentRect,s(5,c)}return i.$$set=B=>{"xPosition"in B&&s(0,d=B.xPosition),"metadata"in B&&s(6,m=B.metadata),"mainLatestValue"in B&&s(7,o=B.mainLatestValue),"mainPreviousValue"in B&&s(8,x=B.mainPreviousValue),"scaleWidth"in B&&s(1,w=B.scaleWidth),"chosenId3"in B&&s(2,I=B.chosenId3),"scaleHeight"in B&&s(3,k=B.scaleHeight)},i.$$.update=()=>{i.$$.dirty&448&&s(4,u=["pp","abs"].includes(m.howToMeasureChange)?(o-x>0?"+":"")+(m.howToMeasureChange=="pp"?"":m.prefix)+Hr(Ir(o-x,m.decimalPlaces))+(m.howToMeasureChange=="pp"?" pp":""):(o-x>0?"+":"")+Ir((o-x)/x,1)+"%")},s(5,c=[]),[d,w,I,k,u,c,m,o,x,E]}class Jy extends pi{constructor(n){super(),gi(this,n,Yy,Ky,_i,{xPosition:0,metadata:6,mainLatestValue:7,mainPreviousValue:8,scaleWidth:1,chosenId3:2,scaleHeight:3})}}function Lc(i,n){return i==null||n==null?NaN:i<n?-1:i>n?1:i>=n?0:NaN}function Qy(i,n){return i==null||n==null?NaN:n<i?-1:n>i?1:n>=i?0:NaN}function Up(i){let n,s,c;i.length!==2?(n=Lc,s=(o,x)=>Lc(i(o),x),c=(o,x)=>i(o)-x):(n=i===Lc||i===Qy?i:$y,s=i,c=i);function u(o,x,w=0,I=o.length){if(w<I){if(n(x,x)!==0)return I;do{const k=w+I>>>1;s(o[k],x)<0?w=k+1:I=k}while(w<I)}return w}function d(o,x,w=0,I=o.length){if(w<I){if(n(x,x)!==0)return I;do{const k=w+I>>>1;s(o[k],x)<=0?w=k+1:I=k}while(w<I)}return w}function m(o,x,w=0,I=o.length){const k=u(o,x,w,I-1);return k>w&&c(o[k-1],x)>-c(o[k],x)?k-1:k}return{left:u,center:m,right:d}}function $y(){return 0}function ev(i){return i===null?NaN:+i}const tv=Up(Lc),iv=tv.right;Up(ev).center;const nv=iv,rv=Math.sqrt(50),sv=Math.sqrt(10),av=Math.sqrt(2);function Nc(i,n,s){const c=(n-i)/Math.max(0,s),u=Math.floor(Math.log10(c)),d=c/Math.pow(10,u),m=d>=rv?10:d>=sv?5:d>=av?2:1;let o,x,w;return u<0?(w=Math.pow(10,-u)/m,o=Math.round(i*w),x=Math.round(n*w),o/w<i&&++o,x/w>n&&--x,w=-w):(w=Math.pow(10,u)*m,o=Math.round(i/w),x=Math.round(n/w),o*w<i&&++o,x*w>n&&--x),x<o&&.5<=s&&s<2?Nc(i,n,s*2):[o,x,w]}function ov(i,n,s){if(n=+n,i=+i,s=+s,!(s>0))return[];if(i===n)return[i];const c=n<i,[u,d,m]=c?Nc(n,i,s):Nc(i,n,s);if(!(d>=u))return[];const o=d-u+1,x=new Array(o);if(c)if(m<0)for(let w=0;w<o;++w)x[w]=(d-w)/-m;else for(let w=0;w<o;++w)x[w]=(d-w)*m;else if(m<0)for(let w=0;w<o;++w)x[w]=(u+w)/-m;else for(let w=0;w<o;++w)x[w]=(u+w)*m;return x}function sh(i,n,s){return n=+n,i=+i,s=+s,Nc(i,n,s)[2]}function lv(i,n,s){n=+n,i=+i,s=+s;const c=n<i,u=c?sh(n,i,s):sh(i,n,s);return(c?-1:1)*(u<0?1/-u:u)}function cv(i,n){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(n).domain(i);break}return this}function bh(i,n,s){i.prototype=n.prototype=s,s.constructor=i}function Gp(i,n){var s=Object.create(i.prototype);for(var c in n)s[c]=n[c];return s}function xl(){}var dl=.7,Uc=1/dl,ro="\\s*([+-]?\\d+)\\s*",ml="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",as="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",uv=/^#([0-9a-f]{3,8})$/,hv=new RegExp(`^rgb\\(${ro},${ro},${ro}\\)$`),fv=new RegExp(`^rgb\\(${as},${as},${as}\\)$`),dv=new RegExp(`^rgba\\(${ro},${ro},${ro},${ml}\\)$`),mv=new RegExp(`^rgba\\(${as},${as},${as},${ml}\\)$`),pv=new RegExp(`^hsl\\(${ml},${as},${as}\\)$`),gv=new RegExp(`^hsla\\(${ml},${as},${as},${ml}\\)$`),Sd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bh(xl,pl,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Ed,formatHex:Ed,formatHex8:_v,formatHsl:yv,formatRgb:Ad,toString:Ad});function Ed(){return this.rgb().formatHex()}function _v(){return this.rgb().formatHex8()}function yv(){return qp(this).formatHsl()}function Ad(){return this.rgb().formatRgb()}function pl(i){var n,s;return i=(i+"").trim().toLowerCase(),(n=uv.exec(i))?(s=n[1].length,n=parseInt(n[1],16),s===6?Cd(n):s===3?new fr(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):s===8?zc(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):s===4?zc(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=hv.exec(i))?new fr(n[1],n[2],n[3],1):(n=fv.exec(i))?new fr(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=dv.exec(i))?zc(n[1],n[2],n[3],n[4]):(n=mv.exec(i))?zc(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=pv.exec(i))?Dd(n[1],n[2]/100,n[3]/100,1):(n=gv.exec(i))?Dd(n[1],n[2]/100,n[3]/100,n[4]):Sd.hasOwnProperty(i)?Cd(Sd[i]):i==="transparent"?new fr(NaN,NaN,NaN,0):null}function Cd(i){return new fr(i>>16&255,i>>8&255,i&255,1)}function zc(i,n,s,c){return c<=0&&(i=n=s=NaN),new fr(i,n,s,c)}function vv(i){return i instanceof xl||(i=pl(i)),i?(i=i.rgb(),new fr(i.r,i.g,i.b,i.opacity)):new fr}function ah(i,n,s,c){return arguments.length===1?vv(i):new fr(i,n,s,c??1)}function fr(i,n,s,c){this.r=+i,this.g=+n,this.b=+s,this.opacity=+c}bh(fr,ah,Gp(xl,{brighter(i){return i=i==null?Uc:Math.pow(Uc,i),new fr(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?dl:Math.pow(dl,i),new fr(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new fr(ba(this.r),ba(this.g),ba(this.b),Gc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Md,formatHex:Md,formatHex8:bv,formatRgb:zd,toString:zd}));function Md(){return`#${va(this.r)}${va(this.g)}${va(this.b)}`}function bv(){return`#${va(this.r)}${va(this.g)}${va(this.b)}${va((isNaN(this.opacity)?1:this.opacity)*255)}`}function zd(){const i=Gc(this.opacity);return`${i===1?"rgb(":"rgba("}${ba(this.r)}, ${ba(this.g)}, ${ba(this.b)}${i===1?")":`, ${i})`}`}function Gc(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function ba(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function va(i){return i=ba(i),(i<16?"0":"")+i.toString(16)}function Dd(i,n,s,c){return c<=0?i=n=s=NaN:s<=0||s>=1?i=n=NaN:n<=0&&(i=NaN),new Wr(i,n,s,c)}function qp(i){if(i instanceof Wr)return new Wr(i.h,i.s,i.l,i.opacity);if(i instanceof xl||(i=pl(i)),!i)return new Wr;if(i instanceof Wr)return i;i=i.rgb();var n=i.r/255,s=i.g/255,c=i.b/255,u=Math.min(n,s,c),d=Math.max(n,s,c),m=NaN,o=d-u,x=(d+u)/2;return o?(n===d?m=(s-c)/o+(s<c)*6:s===d?m=(c-n)/o+2:m=(n-s)/o+4,o/=x<.5?d+u:2-d-u,m*=60):o=x>0&&x<1?0:m,new Wr(m,o,x,i.opacity)}function xv(i,n,s,c){return arguments.length===1?qp(i):new Wr(i,n,s,c??1)}function Wr(i,n,s,c){this.h=+i,this.s=+n,this.l=+s,this.opacity=+c}bh(Wr,xv,Gp(xl,{brighter(i){return i=i==null?Uc:Math.pow(Uc,i),new Wr(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?dl:Math.pow(dl,i),new Wr(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,n=isNaN(i)||isNaN(this.s)?0:this.s,s=this.l,c=s+(s<.5?s:1-s)*n,u=2*s-c;return new fr($u(i>=240?i-240:i+120,u,c),$u(i,u,c),$u(i<120?i+240:i-120,u,c),this.opacity)},clamp(){return new Wr(Pd(this.h),Dc(this.s),Dc(this.l),Gc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=Gc(this.opacity);return`${i===1?"hsl(":"hsla("}${Pd(this.h)}, ${Dc(this.s)*100}%, ${Dc(this.l)*100}%${i===1?")":`, ${i})`}`}}));function Pd(i){return i=(i||0)%360,i<0?i+360:i}function Dc(i){return Math.max(0,Math.min(1,i||0))}function $u(i,n,s){return(i<60?n+(s-n)*i/60:i<180?s:i<240?n+(s-n)*(240-i)/60:n)*255}const xh=i=>()=>i;function wv(i,n){return function(s){return i+s*n}}function Iv(i,n,s){return i=Math.pow(i,s),n=Math.pow(n,s)-i,s=1/s,function(c){return Math.pow(i+c*n,s)}}function kv(i){return(i=+i)==1?jp:function(n,s){return s-n?Iv(n,s,i):xh(isNaN(n)?s:n)}}function jp(i,n){var s=n-i;return s?wv(i,s):xh(isNaN(i)?n:i)}const Ld=function i(n){var s=kv(n);function c(u,d){var m=s((u=ah(u)).r,(d=ah(d)).r),o=s(u.g,d.g),x=s(u.b,d.b),w=jp(u.opacity,d.opacity);return function(I){return u.r=m(I),u.g=o(I),u.b=x(I),u.opacity=w(I),u+""}}return c.gamma=i,c}(1);function Tv(i,n){n||(n=[]);var s=i?Math.min(n.length,i.length):0,c=n.slice(),u;return function(d){for(u=0;u<s;++u)c[u]=i[u]*(1-d)+n[u]*d;return c}}function Sv(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Ev(i,n){var s=n?n.length:0,c=i?Math.min(s,i.length):0,u=new Array(c),d=new Array(s),m;for(m=0;m<c;++m)u[m]=wh(i[m],n[m]);for(;m<s;++m)d[m]=n[m];return function(o){for(m=0;m<c;++m)d[m]=u[m](o);return d}}function Av(i,n){var s=new Date;return i=+i,n=+n,function(c){return s.setTime(i*(1-c)+n*c),s}}function qc(i,n){return i=+i,n=+n,function(s){return i*(1-s)+n*s}}function Cv(i,n){var s={},c={},u;(i===null||typeof i!="object")&&(i={}),(n===null||typeof n!="object")&&(n={});for(u in n)u in i?s[u]=wh(i[u],n[u]):c[u]=n[u];return function(d){for(u in s)c[u]=s[u](d);return c}}var oh=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,eh=new RegExp(oh.source,"g");function Mv(i){return function(){return i}}function zv(i){return function(n){return i(n)+""}}function Dv(i,n){var s=oh.lastIndex=eh.lastIndex=0,c,u,d,m=-1,o=[],x=[];for(i=i+"",n=n+"";(c=oh.exec(i))&&(u=eh.exec(n));)(d=u.index)>s&&(d=n.slice(s,d),o[m]?o[m]+=d:o[++m]=d),(c=c[0])===(u=u[0])?o[m]?o[m]+=u:o[++m]=u:(o[++m]=null,x.push({i:m,x:qc(c,u)})),s=eh.lastIndex;return s<n.length&&(d=n.slice(s),o[m]?o[m]+=d:o[++m]=d),o.length<2?x[0]?zv(x[0].x):Mv(n):(n=x.length,function(w){for(var I=0,k;I<n;++I)o[(k=x[I]).i]=k.x(w);return o.join("")})}function wh(i,n){var s=typeof n,c;return n==null||s==="boolean"?xh(n):(s==="number"?qc:s==="string"?(c=pl(n))?(n=c,Ld):Dv:n instanceof pl?Ld:n instanceof Date?Av:Sv(n)?Tv:Array.isArray(n)?Ev:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?Cv:qc)(i,n)}function Pv(i,n){return i=+i,n=+n,function(s){return Math.round(i*(1-s)+n*s)}}function Lv(i){return function(){return i}}function Bv(i){return+i}var Bd=[0,1];function to(i){return i}function lh(i,n){return(n-=i=+i)?function(s){return(s-i)/n}:Lv(isNaN(n)?NaN:.5)}function Rv(i,n){var s;return i>n&&(s=i,i=n,n=s),function(c){return Math.max(i,Math.min(n,c))}}function Fv(i,n,s){var c=i[0],u=i[1],d=n[0],m=n[1];return u<c?(c=lh(u,c),d=s(m,d)):(c=lh(c,u),d=s(d,m)),function(o){return d(c(o))}}function Ov(i,n,s){var c=Math.min(i.length,n.length)-1,u=new Array(c),d=new Array(c),m=-1;for(i[c]<i[0]&&(i=i.slice().reverse(),n=n.slice().reverse());++m<c;)u[m]=lh(i[m],i[m+1]),d[m]=s(n[m],n[m+1]);return function(o){var x=nv(i,o,1,c)-1;return d[x](u[x](o))}}function Vv(i,n){return n.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function Nv(){var i=Bd,n=Bd,s=wh,c,u,d,m=to,o,x,w;function I(){var E=Math.min(i.length,n.length);return m!==to&&(m=Rv(i[0],i[E-1])),o=E>2?Ov:Fv,x=w=null,k}function k(E){return E==null||isNaN(E=+E)?d:(x||(x=o(i.map(c),n,s)))(c(m(E)))}return k.invert=function(E){return m(u((w||(w=o(n,i.map(c),qc)))(E)))},k.domain=function(E){return arguments.length?(i=Array.from(E,Bv),I()):i.slice()},k.range=function(E){return arguments.length?(n=Array.from(E),I()):n.slice()},k.rangeRound=function(E){return n=Array.from(E),s=Pv,I()},k.clamp=function(E){return arguments.length?(m=E?!0:to,I()):m!==to},k.interpolate=function(E){return arguments.length?(s=E,I()):s},k.unknown=function(E){return arguments.length?(d=E,k):d},function(E,B){return c=E,u=B,I()}}function Uv(){return Nv()(to,to)}function Gv(i,n,s,c){var u=lv(i,n,s),d;switch(c=x1(c??",f"),c.type){case"s":{var m=Math.max(Math.abs(i),Math.abs(n));return c.precision==null&&!isNaN(d=D1(u,m))&&(c.precision=d),Sp(c,m)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(d=P1(u,Math.max(Math.abs(i),Math.abs(n))))&&(c.precision=d-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(d=z1(u))&&(c.precision=d-(c.type==="%")*2);break}}return Tp(c)}function qv(i){var n=i.domain;return i.ticks=function(s){var c=n();return ov(c[0],c[c.length-1],s??10)},i.tickFormat=function(s,c){var u=n();return Gv(u[0],u[u.length-1],s??10,c)},i.nice=function(s){s==null&&(s=10);var c=n(),u=0,d=c.length-1,m=c[u],o=c[d],x,w,I=10;for(o<m&&(w=m,m=o,o=w,w=u,u=d,d=w);I-- >0;){if(w=sh(m,o,s),w===x)return c[u]=m,c[d]=o,n(c);if(w>0)m=Math.floor(m/w)*w,o=Math.ceil(o/w)*w;else if(w<0)m=Math.ceil(m*w)/w,o=Math.floor(o*w)/w;else break;x=w}return i},i}function Us(){var i=Uv();return i.copy=function(){return Vv(i,Us())},cv.apply(i,arguments),qv(i)}function $a(i){return function(){return i}}const ch=Math.PI,uh=2*ch,ya=1e-6,jv=uh-ya;function Zp(i){this._+=i[0];for(let n=1,s=i.length;n<s;++n)this._+=arguments[n]+i[n]}function Zv(i){let n=Math.floor(i);if(!(n>=0))throw new Error(`invalid digits: ${i}`);if(n>15)return Zp;const s=10**n;return function(c){this._+=c[0];for(let u=1,d=c.length;u<d;++u)this._+=Math.round(arguments[u]*s)/s+c[u]}}class Xv{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?Zp:Zv(n)}moveTo(n,s){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+s}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,s){this._append`L${this._x1=+n},${this._y1=+s}`}quadraticCurveTo(n,s,c,u){this._append`Q${+n},${+s},${this._x1=+c},${this._y1=+u}`}bezierCurveTo(n,s,c,u,d,m){this._append`C${+n},${+s},${+c},${+u},${this._x1=+d},${this._y1=+m}`}arcTo(n,s,c,u,d){if(n=+n,s=+s,c=+c,u=+u,d=+d,d<0)throw new Error(`negative radius: ${d}`);let m=this._x1,o=this._y1,x=c-n,w=u-s,I=m-n,k=o-s,E=I*I+k*k;if(this._x1===null)this._append`M${this._x1=n},${this._y1=s}`;else if(E>ya)if(!(Math.abs(k*x-w*I)>ya)||!d)this._append`L${this._x1=n},${this._y1=s}`;else{let B=c-m,K=u-o,U=x*x+w*w,X=B*B+K*K,Q=Math.sqrt(U),Y=Math.sqrt(E),re=d*Math.tan((ch-Math.acos((U+E-X)/(2*Q*Y)))/2),V=re/Y,ne=re/Q;Math.abs(V-1)>ya&&this._append`L${n+V*I},${s+V*k}`,this._append`A${d},${d},0,0,${+(k*B>I*K)},${this._x1=n+ne*x},${this._y1=s+ne*w}`}}arc(n,s,c,u,d,m){if(n=+n,s=+s,c=+c,m=!!m,c<0)throw new Error(`negative radius: ${c}`);let o=c*Math.cos(u),x=c*Math.sin(u),w=n+o,I=s+x,k=1^m,E=m?u-d:d-u;this._x1===null?this._append`M${w},${I}`:(Math.abs(this._x1-w)>ya||Math.abs(this._y1-I)>ya)&&this._append`L${w},${I}`,c&&(E<0&&(E=E%uh+uh),E>jv?this._append`A${c},${c},0,1,${k},${n-o},${s-x}A${c},${c},0,1,${k},${this._x1=w},${this._y1=I}`:E>ya&&this._append`A${c},${c},0,${+(E>=ch)},${k},${this._x1=n+c*Math.cos(d)},${this._y1=s+c*Math.sin(d)}`)}rect(n,s,c,u){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+s}h${c=+c}v${+u}h${-c}Z`}toString(){return this._}}function Wv(i){let n=3;return i.digits=function(s){if(!arguments.length)return n;if(s==null)n=null;else{const c=Math.floor(s);if(!(c>=0))throw new RangeError(`invalid digits: ${s}`);n=c}return i},()=>new Xv(n)}function Hv(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Xp(i){this._context=i}Xp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 1:this._point=2;default:this._context.lineTo(i,n);break}}};function Kv(i){return new Xp(i)}function Yv(i){return i[0]}function Jv(i){return i[1]}function Ih(i,n){var s=$a(!0),c=null,u=Kv,d=null,m=Wv(o);i=typeof i=="function"?i:i===void 0?Yv:$a(i),n=typeof n=="function"?n:n===void 0?Jv:$a(n);function o(x){var w,I=(x=Hv(x)).length,k,E=!1,B;for(c==null&&(d=u(B=m())),w=0;w<=I;++w)!(w<I&&s(k=x[w],w,x))===E&&((E=!E)?d.lineStart():d.lineEnd()),E&&d.point(+i(k,w,x),+n(k,w,x));if(B)return d=null,B+""||null}return o.x=function(x){return arguments.length?(i=typeof x=="function"?x:$a(+x),o):i},o.y=function(x){return arguments.length?(n=typeof x=="function"?x:$a(+x),o):n},o.defined=function(x){return arguments.length?(s=typeof x=="function"?x:$a(!!x),o):s},o.curve=function(x){return arguments.length?(u=x,c!=null&&(d=u(c)),o):u},o.context=function(x){return arguments.length?(x==null?c=d=null:d=u(c=x),o):c},o}function Rd(i,n,s){i._context.bezierCurveTo((2*i._x0+i._x1)/3,(2*i._y0+i._y1)/3,(i._x0+2*i._x1)/3,(i._y0+2*i._y1)/3,(i._x0+4*i._x1+n)/6,(i._y0+4*i._y1+s)/6)}function Wp(i){this._context=i}Wp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Rd(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,n){switch(i=+i,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,n):this._context.moveTo(i,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Rd(this,i,n);break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=n}};function Hp(i){return new Wp(i)}function Fd(i,n,s){const c=i.slice();return c[47]=n[s],c[49]=s,c}function Od(i,n,s){const c=i.slice();return c[47]=n[s],c[49]=s,c}function Vd(i){let n,s=(i[9].includes(0)?Math.random()<.5&i[13].length>1?"Statistically significant change":"":i[17])+"",c;return{c(){n=it("p"),c=fi(s),this.h()},l(u){n=nt(u,"P",{class:!0});var d=be(n);c=di(d,s),d.forEach(G),this.h()},h(){A(n,"class","from-comparison-description svelte-2j0wow")},m(u,d){Be(u,n,d),we(n,c)},p(u,d){d[0]&139776&&s!==(s=(u[9].includes(0)?Math.random()<.5&u[13].length>1?"Statistically significant change":"":u[17])+"")&&zi(c,s)},d(u){u&&G(n)}}}function Nd(i){let n,s,c=i[13].length>1&&Ud(i);return{c(){c&&c.c(),n=si()},l(u){c&&c.l(u),n=si()},m(u,d){c&&c.m(u,d),Be(u,n,d),s=!0},p(u,d){u[13].length>1?c?(c.p(u,d),d[0]&8192&&Le(c,1)):(c=Ud(u),c.c(),Le(c,1),c.m(n.parentNode,n)):c&&(wi(),Ze(c,1,1,()=>{c=null}),Ii())},i(u){s||(Le(c),s=!0)},o(u){Ze(c),s=!1},d(u){c&&c.d(u),u&&G(n)}}}function Ud(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K=i[3].maxXDomain+"",U,X,Q,Y,re,V,ne,oe,Ne=i[9].includes(0),he,fe,pe=i[9].includes(0),Ee,ve,ze=i[23]!=null&i[14]!=null&!i[9].includes(0),De,j,ce,rt,Ke,qe=Ne&&Gd(i),Qe=pe&&qd(i),Ie=i[12],lt=[];for(let We=0;We<Ie.length;We+=1)lt[We]=jd(Od(i,Ie,We));let ot=i[13],vt=[];for(let We=0;We<ot.length;We+=1)vt[We]=Zd(Fd(i,ot,We));let gt=ze&&Xd(i);return{c(){n=ft("svg"),s=ft("g"),c=ft("line"),m=ft("text"),o=fi(i[11]),I=ft("line"),B=ft("text"),U=fi(K),re=ft("g"),V=ft("path"),qe&&qe.c(),he=ft("path"),Qe&&Qe.c(),Ee=ft("g");for(let We=0;We<lt.length;We+=1)lt[We].c();for(let We=0;We<vt.length;We+=1)vt[We].c();ve=si(),gt&&gt.c(),this.h()},l(We){n=dt(We,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var yt=be(n);s=dt(yt,"g",{class:!0,transform:!0});var ue=be(s);c=dt(ue,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),be(c).forEach(G),m=dt(ue,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var ke=be(m);o=di(ke,i[11]),ke.forEach(G),I=dt(ue,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),be(I).forEach(G),B=dt(ue,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var Fe=be(B);U=di(Fe,K),Fe.forEach(G),re=dt(ue,"g",{opacity:!0});var bt=be(re);V=dt(bt,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(V).forEach(G),qe&&qe.l(bt),bt.forEach(G),he=dt(ue,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(he).forEach(G),Qe&&Qe.l(ue),Ee=dt(ue,"g",{opacity:!0});var mi=be(Ee);for(let et=0;et<lt.length;et+=1)lt[et].l(mi);mi.forEach(G);for(let et=0;et<vt.length;et+=1)vt[et].l(ue);ve=si(),gt&&gt.l(ue),ue.forEach(G),yt.forEach(G),this.h()},h(){A(c,"x1",u=i[19]<30|i[20]<30?0:25),A(c,"x2",d=i[19]<30|i[20]<30?i[7]-25:i[7]),A(c,"y1","0"),A(c,"y2","0"),A(c,"stroke","rgb(200,200,200)"),A(c,"stroke-width","1.5px"),A(m,"text-anchor",x=i[19]<30|i[20]<30?"start":"end"),A(m,"font-size","14px"),A(m,"x",w=i[19]<30|i[20]<30?i[7]-20:20),A(m,"y","5"),A(m,"stroke","rgb(175,175,175)"),A(m,"fill","rgb(175,175,175)"),A(m,"stroke-width","0.5px"),A(I,"x1",k=i[19]<30|i[20]<30?0:25),A(I,"x2",E=i[19]<30|i[20]<30?i[7]-25:i[7]),A(I,"y1",i[6]),A(I,"y2",i[6]),A(I,"stroke","rgb(200,200,200)"),A(I,"stroke-width","1.5px"),A(B,"text-anchor",X=i[19]<30|i[20]<30?"start":"end"),A(B,"font-size","14px"),A(B,"x",Q=i[19]<30|i[20]<30?i[7]-20:20),A(B,"y",Y=i[6]+5),A(B,"stroke","rgb(175,175,175)"),A(B,"fill","rgb(175,175,175)"),A(B,"stroke-width","0.5px"),A(V,"d",ne=i[18](i[12])),A(V,"stroke",oe=ni[i[15]]),A(V,"fill","none"),A(V,"stroke-width","2px"),A(re,"opacity","0.75"),A(he,"d",fe=i[18](i[13])),A(he,"stroke",ni.main),A(he,"fill","none"),A(he,"stroke-width","2px"),A(Ee,"opacity","0.75"),A(s,"class","chart-container"),A(s,"transform",De="translate("+(Ht.left[i[5]===0?"split":"full"]+Ht.areaSpaceBeyondXScale[i[5]===0?"split":"full"])+","+Ht.top[i[5]===0?"split":"full"]+")"),A(n,"class",j="line-row-svg line-row-svg-"+(i[1]*100+i[0])+" svelte-2j0wow"),A(n,"viewBox",ce="0 0 "+i[4]+" "+ws[i[5]===0?"split":"full"]),A(n,"width","100%"),A(n,"height",rt=20+ws[i[5]===0?"split":"full"])},m(We,yt){Be(We,n,yt),we(n,s),we(s,c),we(s,m),we(m,o),we(s,I),we(s,B),we(B,U),we(s,re),we(re,V),qe&&qe.m(re,null),we(s,he),Qe&&Qe.m(s,null),we(s,Ee);for(let ue=0;ue<lt.length;ue+=1)lt[ue]&&lt[ue].m(Ee,null);for(let ue=0;ue<vt.length;ue+=1)vt[ue]&&vt[ue].m(s,null);we(s,ve),gt&&gt.m(s,null),Ke=!0},p(We,yt){if((!Ke||yt[0]&1572864&&u!==(u=We[19]<30|We[20]<30?0:25))&&A(c,"x1",u),(!Ke||yt[0]&1572992&&d!==(d=We[19]<30|We[20]<30?We[7]-25:We[7]))&&A(c,"x2",d),(!Ke||yt[0]&2048)&&zi(o,We[11]),(!Ke||yt[0]&1572864&&x!==(x=We[19]<30|We[20]<30?"start":"end"))&&A(m,"text-anchor",x),(!Ke||yt[0]&1572992&&w!==(w=We[19]<30|We[20]<30?We[7]-20:20))&&A(m,"x",w),(!Ke||yt[0]&1572864&&k!==(k=We[19]<30|We[20]<30?0:25))&&A(I,"x1",k),(!Ke||yt[0]&1572992&&E!==(E=We[19]<30|We[20]<30?We[7]-25:We[7]))&&A(I,"x2",E),(!Ke||yt[0]&64)&&A(I,"y1",We[6]),(!Ke||yt[0]&64)&&A(I,"y2",We[6]),(!Ke||yt[0]&8)&&K!==(K=We[3].maxXDomain+"")&&zi(U,K),(!Ke||yt[0]&1572864&&X!==(X=We[19]<30|We[20]<30?"start":"end"))&&A(B,"text-anchor",X),(!Ke||yt[0]&1572992&&Q!==(Q=We[19]<30|We[20]<30?We[7]-20:20))&&A(B,"x",Q),(!Ke||yt[0]&64&&Y!==(Y=We[6]+5))&&A(B,"y",Y),(!Ke||yt[0]&266240&&ne!==(ne=We[18](We[12])))&&A(V,"d",ne),(!Ke||yt[0]&32768&&oe!==(oe=ni[We[15]]))&&A(V,"stroke",oe),yt[0]&512&&(Ne=We[9].includes(0)),Ne?qe?qe.p(We,yt):(qe=Gd(We),qe.c(),qe.m(re,null)):qe&&(qe.d(1),qe=null),(!Ke||yt[0]&270336&&fe!==(fe=We[18](We[13])))&&A(he,"d",fe),yt[0]&512&&(pe=We[9].includes(0)),pe?Qe?Qe.p(We,yt):(Qe=qd(We),Qe.c(),Qe.m(s,Ee)):Qe&&(Qe.d(1),Qe=null),yt[0]&39944){Ie=We[12];let ue;for(ue=0;ue<Ie.length;ue+=1){const ke=Od(We,Ie,ue);lt[ue]?lt[ue].p(ke,yt):(lt[ue]=jd(ke),lt[ue].c(),lt[ue].m(Ee,null))}for(;ue<lt.length;ue+=1)lt[ue].d(1);lt.length=Ie.length}if(yt[0]&11272){ot=We[13];let ue;for(ue=0;ue<ot.length;ue+=1){const ke=Fd(We,ot,ue);vt[ue]?vt[ue].p(ke,yt):(vt[ue]=Zd(ke),vt[ue].c(),vt[ue].m(s,ve))}for(;ue<vt.length;ue+=1)vt[ue].d(1);vt.length=ot.length}yt[0]&16896&&(ze=We[23]!=null&We[14]!=null&!We[9].includes(0)),ze?gt?(gt.p(We,yt),yt[0]&16896&&Le(gt,1)):(gt=Xd(We),gt.c(),Le(gt,1),gt.m(s,null)):gt&&(wi(),Ze(gt,1,1,()=>{gt=null}),Ii()),(!Ke||yt[0]&32&&De!==(De="translate("+(Ht.left[We[5]===0?"split":"full"]+Ht.areaSpaceBeyondXScale[We[5]===0?"split":"full"])+","+Ht.top[We[5]===0?"split":"full"]+")"))&&A(s,"transform",De),(!Ke||yt[0]&3&&j!==(j="line-row-svg line-row-svg-"+(We[1]*100+We[0])+" svelte-2j0wow"))&&A(n,"class",j),(!Ke||yt[0]&48&&ce!==(ce="0 0 "+We[4]+" "+ws[We[5]===0?"split":"full"]))&&A(n,"viewBox",ce),(!Ke||yt[0]&32&&rt!==(rt=20+ws[We[5]===0?"split":"full"]))&&A(n,"height",rt)},i(We){Ke||(Le(gt),Ke=!0)},o(We){Ze(gt),Ke=!1},d(We){We&&G(n),qe&&qe.d(),Qe&&Qe.d(),$i(lt,We),$i(vt,We),gt&&gt.d()}}}function Gd(i){let n,s,c;return{c(){n=ft("path"),this.h()},l(u){n=dt(u,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),be(n).forEach(G),this.h()},h(){A(n,"d",s=i[18](i[21])),A(n,"fill",c=ni[i[15]]),A(n,"stroke","none"),A(n,"stroke-width","2px"),A(n,"opacity","0.25")},m(u,d){Be(u,n,d)},p(u,d){d[0]&2359296&&s!==(s=u[18](u[21]))&&A(n,"d",s),d[0]&32768&&c!==(c=ni[u[15]])&&A(n,"fill",c)},d(u){u&&G(n)}}}function qd(i){let n,s;return{c(){n=ft("path"),this.h()},l(c){n=dt(c,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),be(n).forEach(G),this.h()},h(){A(n,"d",s=i[18](i[22])),A(n,"fill",ni.main),A(n,"stroke","none"),A(n,"stroke-width","2px"),A(n,"opacity","0.25")},m(c,u){Be(c,n,u)},p(c,u){u[0]&4456448&&s!==(s=c[18](c[22]))&&A(n,"d",s)},d(c){c&&G(n)}}}function jd(i){let n,s,c,u,d;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(m){n=dt(m,"g",{transform:!0});var o=be(n);s=dt(o,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),be(s).forEach(G),o.forEach(G),this.h()},h(){A(s,"r",c=i[47].xDomainNumb==i[11]?4:i[47].xDomainNumb==i[3].maxXDomain?5:0),A(s,"fill",u=ni[i[15]]),A(s,"stroke-width","1px"),A(s,"stroke","white"),A(n,"transform",d="translate("+i[47].zScore+","+i[10](i[47].xDomainNumb)+")")},m(m,o){Be(m,n,o),we(n,s)},p(m,o){o[0]&6152&&c!==(c=m[47].xDomainNumb==m[11]?4:m[47].xDomainNumb==m[3].maxXDomain?5:0)&&A(s,"r",c),o[0]&32768&&u!==(u=ni[m[15]])&&A(s,"fill",u),o[0]&5120&&d!==(d="translate("+m[47].zScore+","+m[10](m[47].xDomainNumb)+")")&&A(n,"transform",d)},d(m){m&&G(n)}}}function Zd(i){let n,s,c,u;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(d){n=dt(d,"g",{transform:!0});var m=be(n);s=dt(m,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),be(s).forEach(G),m.forEach(G),this.h()},h(){A(s,"r",c=i[47].xDomainNumb==i[11]?4:i[47].xDomainNumb==i[3].maxXDomain?5:0),A(s,"fill",ni.main),A(s,"stroke-width","1px"),A(s,"stroke","white"),A(n,"transform",u="translate("+i[47].zScore+","+i[10](i[47].xDomainNumb)+")")},m(d,m){Be(d,n,m),we(n,s)},p(d,m){m[0]&10248&&c!==(c=d[47].xDomainNumb==d[11]?4:d[47].xDomainNumb==d[3].maxXDomain?5:0)&&A(s,"r",c),m[0]&9216&&u!==(u="translate("+d[47].zScore+","+d[10](d[47].xDomainNumb)+")")&&A(n,"transform",u)},d(d){d&&G(n)}}}function Xd(i){let n,s;return n=new Jy({props:{xPosition:i[13].length>1?Math.abs(i[13][i[13].length-1].zScore-i[13][0].zScore)/2+Math.min(i[13][i[13].length-1].zScore,i[13][0].zScore):i[13][0].zScore,metadata:i[2],mainLatestValue:i[23],mainPreviousValue:i[14],scaleWidth:i[7],scaleHeight:i[6],chosenId3:i[5]}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u[0]&8192&&(d.xPosition=c[13].length>1?Math.abs(c[13][c[13].length-1].zScore-c[13][0].zScore)/2+Math.min(c[13][c[13].length-1].zScore,c[13][0].zScore):c[13][0].zScore),u[0]&4&&(d.metadata=c[2]),u[0]&16384&&(d.mainPreviousValue=c[14]),u[0]&128&&(d.scaleWidth=c[7]),u[0]&64&&(d.scaleHeight=c[6]),u[0]&32&&(d.chosenId3=c[5]),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function Qv(i){let n,s=i[8].includes(0)&i[5]===0,c,u,d,m=s&&Vd(i),o=i[5]===0&&Nd(i);return{c(){n=it("div"),m&&m.c(),c=Rt(),o&&o.c(),this.h()},l(x){n=nt(x,"DIV",{class:!0,style:!0});var w=be(n);m&&m.l(w),c=Ft(w),o&&o.l(w),w.forEach(G),this.h()},h(){A(n,"class","time-comparison-cell-container svelte-2j0wow"),A(n,"style",u=i[9].includes(0)|i[5]!=0|i[16]==null?null:"background-color:"+i[16]+"; box-shadow: 0 0 4px 3px "+i[16]+";")},m(x,w){Be(x,n,w),m&&m.m(n,null),we(n,c),o&&o.m(n,null),d=!0},p(x,w){w[0]&288&&(s=x[8].includes(0)&x[5]===0),s?m?m.p(x,w):(m=Vd(x),m.c(),m.m(n,c)):m&&(m.d(1),m=null),x[5]===0?o?(o.p(x,w),w[0]&32&&Le(o,1)):(o=Nd(x),o.c(),Le(o,1),o.m(n,null)):o&&(wi(),Ze(o,1,1,()=>{o=null}),Ii()),(!d||w[0]&66080&&u!==(u=x[9].includes(0)|x[5]!=0|x[16]==null?null:"background-color:"+x[16]+"; box-shadow: 0 0 4px 3px "+x[16]+";"))&&A(n,"style",u)},i(x){d||(Le(o),d=!0)},o(x){Ze(o),d=!1},d(x){x&&G(n),m&&m.d(),o&&o.d()}}}function $v(i,n,s){let c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y,re,V,ne,oe,Ne,he,fe,pe,Ee,{indicator:ve}=n,{rowNumb:ze,topicNumb:De}=n,{metadata:j,calculations:ce}=n,{col4Width:rt}=n,{chosenId2:Ke}=n,{chosenId3:qe}=n,{baselineComparisonArea:Qe}=n,{visibleAreas:Ie}=n,{scaleHeight:lt,scaleWidth:ot}=n,{x:vt,xDomain:gt}=n,{chosenId11:We}=n,{chosenId6:yt}=n,ue=ce.calcs[ce.maxXDomain].median,ke=ce.calcs[ce.maxXDomain].mad,Fe=ce.calcs[ce.maxXDomain].main,bt=Nn.better,mi="Improved since 2012";return i.$$set=et=>{"indicator"in et&&s(24,ve=et.indicator),"rowNumb"in et&&s(0,ze=et.rowNumb),"topicNumb"in et&&s(1,De=et.topicNumb),"metadata"in et&&s(2,j=et.metadata),"calculations"in et&&s(3,ce=et.calculations),"col4Width"in et&&s(4,rt=et.col4Width),"chosenId2"in et&&s(25,Ke=et.chosenId2),"chosenId3"in et&&s(5,qe=et.chosenId3),"baselineComparisonArea"in et&&s(26,Qe=et.baselineComparisonArea),"visibleAreas"in et&&s(27,Ie=et.visibleAreas),"scaleHeight"in et&&s(6,lt=et.scaleHeight),"scaleWidth"in et&&s(7,ot=et.scaleWidth),"x"in et&&s(28,vt=et.x),"xDomain"in et&&s(29,gt=et.xDomain),"chosenId11"in et&&s(8,We=et.chosenId11),"chosenId6"in et&&s(9,yt=et.chosenId6)},i.$$.update=()=>{i.$$.dirty[0]&33554440&&s(30,c=Ke==="earliest available year"?ce.mainMinXDomain:Ke==="previous year"?ce.maxXDomain-1:Ke),i.$$.dirty[0]&1073741832&&s(43,d=Array.from({length:ce.maxXDomain-c+1},(et,ht)=>c+ht).map(et=>({xDomainNumb:et,value:ce.calcs[et]==null?void 0:"main"in ce.calcs[et]?ce.calcs[et].main:void 0})).filter(et=>et.value!=null&!isNaN(et.value))),i.$$.dirty[0]&268435616|i.$$.dirty[1]&4096&&s(13,m=d.map(et=>({...et,zScore:Rc(Ht,qe,ot,vt,et.value,ue,ke)}))),i.$$.dirty[0]&8192&&s(22,o=[...m.map(et=>({...et,zScore:et.zScore-15})),...m.reverse().map(et=>({...et,zScore:et.zScore+15}))]),i.$$.dirty[0]&67108864|i.$$.dirty[1]&2048&&s(15,x=(Qe.areacd==="median"?Qe:u.find(et=>Qe.areacd===et.areacd)).role),i.$$.dirty[0]&1073774600&&s(41,w=Array.from({length:ce.maxXDomain-c+1},(et,ht)=>c+ht).map(et=>({xDomainNumb:et,value:ce.calcs[et]==null?void 0:x in ce.calcs[et]?ce.calcs[et][x]:void 0})).filter(et=>et.value!=null&!isNaN(et.value))),i.$$.dirty[0]&268435616|i.$$.dirty[1]&1024&&s(12,I=w.map(et=>({...et,zScore:Rc(Ht,qe,ot,vt,et.value,ue,ke)}))),i.$$.dirty[0]&4096&&s(21,k=[...I.map(et=>({...et,zScore:et.zScore-5})),...I.reverse().map(et=>({...et,zScore:et.zScore+5}))]),i.$$.dirty[0]&1073741832&&s(14,E=c in ce.calcs?ce.calcs[c].main:null),i.$$.dirty[0]&16384&&s(34,B=Fe==null|E==null|ke==null?null:(Fe-E)/ke),i.$$.dirty[0]&256&&s(40,K=We.includes(1)),i.$$.dirty[0]&4&&s(39,U=j.polarity==0?null:j.polarity==-1?"better":"worse"),i.$$.dirty[0]&4&&s(38,X=j.polarity==0?null:"similar"),i.$$.dirty[0]&4&&s(37,Q=j.polarity==0?null:j.polarity==1?"better":"worse"),i.$$.dirty[0]&256&&s(33,Y=We.includes(3)?2:1),i.$$.dirty[0]&1073741836|i.$$.dirty[1]&972&&s(16,bt=!K|B==null|j.polarity==0|c==ce.maxXDomain?null:B<-Y?Nn[U]:B<=Y?Nn[X]:Nn[Q]),i.$$.dirty[0]&67108864&&(Qe.areacd==="median"||Qe.areanm),i.$$.dirty[0]&256&&s(36,re=We.includes(2)),i.$$.dirty[0]&4|i.$$.dirty[1]&32&&s(35,V=j.polarity==0|!re?"Decreased":j.polarity==-1?"Improved":"Worsened"),i.$$.dirty[0]&4|i.$$.dirty[1]&32&&s(31,oe=j.polarity==0|!re?"Increased":j.polarity==1?"Improved":"Worsened"),i.$$.dirty[0]&1073758216|i.$$.dirty[1]&31&&s(17,mi=c==ce.maxXDomain?"No historical data":Fe==null?"No data in "+ce.maxXDomain:E==null?"No data in "+c:(B<-Y?V:B<=Y?ne:oe)+" since "+c),i.$$.dirty[0]&12288&&s(11,Ne=Math.min(...[...m,...I].map(et=>et.xDomainNumb))),i.$$.dirty[0]&12288&&s(20,he=Math.min(...[...m,...I].map(et=>et.zScore))),i.$$.dirty[0]&12288&&s(19,fe=Math.min(...[...m,...I].map(et=>et.zScore))),i.$$.dirty[0]&2120&&s(10,pe=Us().domain([Ne,ce.maxXDomain]).range([0,lt])),i.$$.dirty[0]&1024&&s(18,Ee=Ih().curve(Hp).x(et=>et.zScore).y(et=>pe(et.xDomainNumb)))},s(42,u=xi("selectedAndRelatedAreas")),s(32,ne="Little change"),[ze,De,j,ce,rt,qe,lt,ot,We,yt,pe,Ne,I,m,E,x,bt,mi,Ee,fe,he,k,o,Fe,ve,Ke,Qe,Ie,vt,gt,c,oe,ne,Y,B,V,re,Q,X,U,K,w,u,d]}let eb=class extends pi{constructor(n){super(),gi(this,n,$v,Qv,_i,{indicator:24,rowNumb:0,topicNumb:1,metadata:2,calculations:3,col4Width:4,chosenId2:25,chosenId3:5,baselineComparisonArea:26,visibleAreas:27,scaleHeight:6,scaleWidth:7,x:28,xDomain:29,chosenId11:8,chosenId6:9},null,[-1,-1])}};function tb(i){let n,s,c;return{c(){n=it("div"),s=ft("svg"),c=ft("path"),this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);s=dt(d,"svg",{width:!0,height:!0,class:!0,viewBox:!0,style:!0});var m=be(s);c=dt(m,"path",{d:!0}),be(c).forEach(G),m.forEach(G),d.forEach(G),this.h()},h(){A(c,"d","M24.15 34q.65 0 1.075-.425.425-.425.425-1.075v-9.05q0-.6-.45-1.025Q24.75 22 24.15 22q-.65 0-1.075.425-.425.425-.425 1.075v9.05q0 .6.45 1.025.45.425 1.05.425ZM24 18.3q.7 0 1.175-.45.475-.45.475-1.15t-.475-1.2Q24.7 15 24 15q-.7 0-1.175.5-.475.5-.475 1.2t.475 1.15q.475.45 1.175.45ZM24 44q-4.25 0-7.9-1.525-3.65-1.525-6.35-4.225-2.7-2.7-4.225-6.35Q4 28.25 4 24q0-4.2 1.525-7.85Q7.05 12.5 9.75 9.8q2.7-2.7 6.35-4.25Q19.75 4 24 4q4.2 0 7.85 1.55Q35.5 7.1 38.2 9.8q2.7 2.7 4.25 6.35Q44 19.8 44 24q0 4.25-1.55 7.9-1.55 3.65-4.25 6.35-2.7 2.7-6.35 4.225Q28.2 44 24 44Zm0-20Zm0 17q7 0 12-5t5-12q0-7-5-12T24 7q-7 0-12 5T7 24q0 7 5 12t12 5Z"),A(s,"width","20"),A(s,"height","20"),A(s,"class","c h-16 w-16 inline svelte-nloqxl svelte-1fiksfe"),A(s,"viewBox","0 0 48 48"),ii(s,"transform","rotate(0deg)"),A(n,"class","infoCell svelte-1fiksfe")},m(u,d){Be(u,n,d),we(n,s),we(s,c)},p:hi,i:hi,o:hi,d(u){u&&G(n)}}}class ib extends pi{constructor(n){super(),gi(this,n,null,tb,_i,{})}}function Wd(i,n,s){const c=i.slice();return c[54]=n[s],c[56]=s,c}function Hd(i,n,s){const c=i.slice();return c[54]=n[s],c[56]=s,c}function Kd(i){let n,s=(i[7].includes(0)?Math.random()<.5&i[8].length>1?"Statistically significant change":"":i[18])+"",c;return{c(){n=it("p"),c=fi(s),this.h()},l(u){n=nt(u,"P",{class:!0});var d=be(n);c=di(d,s),d.forEach(G),this.h()},h(){A(n,"class","from-comparison-description svelte-2j0wow")},m(u,d){Be(u,n,d),we(n,c)},p(u,d){d[0]&262528&&s!==(s=(u[7].includes(0)?Math.random()<.5&u[8].length>1?"Statistically significant change":"":u[18])+"")&&zi(c,s)},d(u){u&&G(n)}}}function Yd(i){let n,s=i[8].length>1&&Jd(i);return{c(){s&&s.c(),n=si()},l(c){s&&s.l(c),n=si()},m(c,u){s&&s.m(c,u),Be(c,n,u)},p(c,u){c[8].length>1?s?s.p(c,u):(s=Jd(c),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},d(c){s&&s.d(c),c&&G(n)}}}function Jd(i){let n,s,c,u,d,m,o,x,w,I,k=i[3].maxXDomain+"",E,B,K=i[26]!=null&i[9]!=null&!i[7].includes(0),U,X,Q,Y,re=i[7].includes(0),V,ne,oe=i[7].includes(0),Ne,he,fe=i[26]!=null&i[9]!=null&!i[7].includes(0),pe,Ee,ve,ze=K&&Qd(i),De=re&&$d(i),j=oe&&em(i),ce=i[13],rt=[];for(let Ie=0;Ie<ce.length;Ie+=1)rt[Ie]=tm(Hd(i,ce,Ie));let Ke=i[8],qe=[];for(let Ie=0;Ie<Ke.length;Ie+=1)qe[Ie]=im(Wd(i,Ke,Ie));let Qe=fe&&nm(i);return{c(){n=ft("svg"),s=ft("g"),c=ft("line"),d=ft("line"),o=ft("text"),x=fi(i[12]),I=ft("text"),E=fi(k),ze&&ze.c(),U=ft("g"),X=ft("path"),De&&De.c(),V=ft("path"),j&&j.c(),Ne=ft("g");for(let Ie=0;Ie<rt.length;Ie+=1)rt[Ie].c();for(let Ie=0;Ie<qe.length;Ie+=1)qe[Ie].c();he=si(),Qe&&Qe.c(),this.h()},l(Ie){n=dt(Ie,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var lt=be(n);s=dt(lt,"g",{class:!0,transform:!0});var ot=be(s);c=dt(ot,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0}),be(c).forEach(G),d=dt(ot,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0}),be(d).forEach(G),o=dt(ot,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var vt=be(o);x=di(vt,i[12]),vt.forEach(G),I=dt(ot,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var gt=be(I);E=di(gt,k),gt.forEach(G),ze&&ze.l(ot),U=dt(ot,"g",{opacity:!0});var We=be(U);X=dt(We,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(X).forEach(G),De&&De.l(We),We.forEach(G),V=dt(ot,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(V).forEach(G),j&&j.l(ot),Ne=dt(ot,"g",{opacity:!0});var yt=be(Ne);for(let ue=0;ue<rt.length;ue+=1)rt[ue].l(yt);yt.forEach(G);for(let ue=0;ue<qe.length;ue+=1)qe[ue].l(ot);he=si(),Qe&&Qe.l(ot),ot.forEach(G),lt.forEach(G),this.h()},h(){A(c,"y1",u=i[10]+Ht.areaSpaceBeyondXScale.split),A(c,"y2",i[22]),A(c,"x1","0"),A(c,"x2","0"),A(c,"stroke","rgb(200,200,200)"),A(c,"stroke-width","1.5px"),A(c,"stroke-dasharray","4 2"),A(d,"y1",m=i[10]+Ht.areaSpaceBeyondXScale.split),A(d,"y2",i[21]),A(d,"x1",i[11]),A(d,"x2",i[11]),A(d,"stroke","rgb(200,200,200)"),A(d,"stroke-width","1.5px"),A(d,"stroke-dasharray","4 2"),A(o,"text-anchor","middle"),A(o,"font-size","14px"),A(o,"x",0),A(o,"y",w=i[10]+15+Ht.areaSpaceBeyondXScale.split),A(o,"stroke","rgb(175,175,175)"),A(o,"fill","rgb(175,175,175)"),A(o,"stroke-width","0.5px"),A(I,"text-anchor","middle"),A(I,"font-size","14px"),A(I,"x",i[11]),A(I,"y",B=i[10]+15+Ht.areaSpaceBeyondXScale.split),A(I,"stroke","rgb(175,175,175)"),A(I,"fill","rgb(175,175,175)"),A(I,"stroke-width","0.5px"),A(X,"d",Q=i[20](i[13])),A(X,"stroke",Y=ni[i[14]]),A(X,"fill","none"),A(X,"stroke-width","2px"),A(U,"opacity","0.75"),A(V,"d",ne=i[20](i[8])),A(V,"stroke",ni.main),A(V,"fill","none"),A(V,"stroke-width","2px"),A(Ne,"opacity","0.75"),A(s,"class","chart-container"),A(s,"transform",pe="translate("+i[15].left+","+(i[15].top+Ht.areaSpaceBeyondXScale.split)+")"),A(n,"class",Ee="line-row-svg line-row-svg-"+(i[2]*100+i[1])+" svelte-2j0wow"),A(n,"viewBox",ve="0 0 "+i[4]+" "+i[16]),A(n,"width","100%"),A(n,"height",i[16])},m(Ie,lt){Be(Ie,n,lt),we(n,s),we(s,c),we(s,d),we(s,o),we(o,x),we(s,I),we(I,E),ze&&ze.m(s,null),we(s,U),we(U,X),De&&De.m(U,null),we(s,V),j&&j.m(s,null),we(s,Ne);for(let ot=0;ot<rt.length;ot+=1)rt[ot]&&rt[ot].m(Ne,null);for(let ot=0;ot<qe.length;ot+=1)qe[ot]&&qe[ot].m(s,null);we(s,he),Qe&&Qe.m(s,null)},p(Ie,lt){if(lt[0]&1024&&u!==(u=Ie[10]+Ht.areaSpaceBeyondXScale.split)&&A(c,"y1",u),lt[0]&4194304&&A(c,"y2",Ie[22]),lt[0]&1024&&m!==(m=Ie[10]+Ht.areaSpaceBeyondXScale.split)&&A(d,"y1",m),lt[0]&2097152&&A(d,"y2",Ie[21]),lt[0]&2048&&A(d,"x1",Ie[11]),lt[0]&2048&&A(d,"x2",Ie[11]),lt[0]&4096&&zi(x,Ie[12]),lt[0]&1024&&w!==(w=Ie[10]+15+Ht.areaSpaceBeyondXScale.split)&&A(o,"y",w),lt[0]&8&&k!==(k=Ie[3].maxXDomain+"")&&zi(E,k),lt[0]&2048&&A(I,"x",Ie[11]),lt[0]&1024&&B!==(B=Ie[10]+15+Ht.areaSpaceBeyondXScale.split)&&A(I,"y",B),lt[0]&640&&(K=Ie[26]!=null&Ie[9]!=null&!Ie[7].includes(0)),K?ze?ze.p(Ie,lt):(ze=Qd(Ie),ze.c(),ze.m(s,U)):ze&&(ze.d(1),ze=null),lt[0]&1056768&&Q!==(Q=Ie[20](Ie[13]))&&A(X,"d",Q),lt[0]&16384&&Y!==(Y=ni[Ie[14]])&&A(X,"stroke",Y),lt[0]&128&&(re=Ie[7].includes(0)),re?De?De.p(Ie,lt):(De=$d(Ie),De.c(),De.m(U,null)):De&&(De.d(1),De=null),lt[0]&1048832&&ne!==(ne=Ie[20](Ie[8]))&&A(V,"d",ne),lt[0]&128&&(oe=Ie[7].includes(0)),oe?j?j.p(Ie,lt):(j=em(Ie),j.c(),j.m(s,Ne)):j&&(j.d(1),j=null),lt[0]&28681){ce=Ie[13];let ot;for(ot=0;ot<ce.length;ot+=1){const vt=Hd(Ie,ce,ot);rt[ot]?rt[ot].p(vt,lt):(rt[ot]=tm(vt),rt[ot].c(),rt[ot].m(Ne,null))}for(;ot<rt.length;ot+=1)rt[ot].d(1);rt.length=ce.length}if(lt[0]&4361){Ke=Ie[8];let ot;for(ot=0;ot<Ke.length;ot+=1){const vt=Wd(Ie,Ke,ot);qe[ot]?qe[ot].p(vt,lt):(qe[ot]=im(vt),qe[ot].c(),qe[ot].m(s,he))}for(;ot<qe.length;ot+=1)qe[ot].d(1);qe.length=Ke.length}lt[0]&640&&(fe=Ie[26]!=null&Ie[9]!=null&!Ie[7].includes(0)),fe?Qe?Qe.p(Ie,lt):(Qe=nm(Ie),Qe.c(),Qe.m(s,null)):Qe&&(Qe.d(1),Qe=null),lt[0]&32768&&pe!==(pe="translate("+Ie[15].left+","+(Ie[15].top+Ht.areaSpaceBeyondXScale.split)+")")&&A(s,"transform",pe),lt[0]&6&&Ee!==(Ee="line-row-svg line-row-svg-"+(Ie[2]*100+Ie[1])+" svelte-2j0wow")&&A(n,"class",Ee),lt[0]&65552&&ve!==(ve="0 0 "+Ie[4]+" "+Ie[16])&&A(n,"viewBox",ve),lt[0]&65536&&A(n,"height",Ie[16])},d(Ie){Ie&&G(n),ze&&ze.d(),De&&De.d(),j&&j.d(),$i(rt,Ie),$i(qe,Ie),Qe&&Qe.d()}}}function Qd(i){let n,s,c,u,d,m,o,x,w;return{c(){n=ft("line"),m=ft("g"),o=ft("path"),this.h()},l(I){n=dt(I,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0,fill:!0}),be(n).forEach(G),m=dt(I,"g",{transform:!0});var k=be(m);o=dt(k,"path",{transform:!0,d:!0,stroke:!0,"stroke-width":!0,fill:!0}),be(o).forEach(G),k.forEach(G),this.h()},h(){A(n,"x1",s=i[11]+12),A(n,"x2",c=i[11]+12),A(n,"y1",u=i[8][0].zScore),A(n,"y2",d=i[8][i[8].length-1].zScore),A(n,"stroke",ni.main),A(n,"stroke-width","1.5px"),A(n,"fill","none"),A(o,"transform",x=i[8][0].zScore<i[8][i[8].length-1].zScore?"rotate(180)":null),A(o,"d","M0 0 l-3 3 l6 0 z"),A(o,"stroke",ni.main),A(o,"stroke-width","1.5px"),A(o,"fill",ni.main),A(m,"transform",w="translate("+(i[11]+12)+","+i[8][i[8].length-1].zScore+")")},m(I,k){Be(I,n,k),Be(I,m,k),we(m,o)},p(I,k){k[0]&2048&&s!==(s=I[11]+12)&&A(n,"x1",s),k[0]&2048&&c!==(c=I[11]+12)&&A(n,"x2",c),k[0]&256&&u!==(u=I[8][0].zScore)&&A(n,"y1",u),k[0]&256&&d!==(d=I[8][I[8].length-1].zScore)&&A(n,"y2",d),k[0]&256&&x!==(x=I[8][0].zScore<I[8][I[8].length-1].zScore?"rotate(180)":null)&&A(o,"transform",x),k[0]&2304&&w!==(w="translate("+(I[11]+12)+","+I[8][I[8].length-1].zScore+")")&&A(m,"transform",w)},d(I){I&&G(n),I&&G(m)}}}function $d(i){let n,s,c;return{c(){n=ft("path"),this.h()},l(u){n=dt(u,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),be(n).forEach(G),this.h()},h(){A(n,"d",s=i[20](i[23])),A(n,"fill",c=ni[i[14]]),A(n,"stroke","none"),A(n,"stroke-width","2px"),A(n,"opacity","0.25")},m(u,d){Be(u,n,d)},p(u,d){d[0]&9437184&&s!==(s=u[20](u[23]))&&A(n,"d",s),d[0]&16384&&c!==(c=ni[u[14]])&&A(n,"fill",c)},d(u){u&&G(n)}}}function em(i){let n,s;return{c(){n=ft("path"),this.h()},l(c){n=dt(c,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),be(n).forEach(G),this.h()},h(){A(n,"d",s=i[20](i[24])),A(n,"fill",ni.main),A(n,"stroke","none"),A(n,"stroke-width","2px"),A(n,"opacity","0.25")},m(c,u){Be(c,n,u)},p(c,u){u[0]&17825792&&s!==(s=c[20](c[24]))&&A(n,"d",s)},d(c){c&&G(n)}}}function tm(i){let n,s,c,u,d;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(m){n=dt(m,"g",{transform:!0});var o=be(n);s=dt(o,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),be(s).forEach(G),o.forEach(G),this.h()},h(){A(s,"r",c=i[54].xDomainNumb==i[12]?4:i[54].xDomainNumb==i[3].maxXDomain?5:0),A(s,"fill",u=ni[i[14]]),A(s,"stroke-width","1px"),A(s,"stroke","white"),A(n,"transform",d="translate("+i[0](i[54].xDomainNumb)+","+i[54].zScore+")")},m(m,o){Be(m,n,o),we(n,s)},p(m,o){o[0]&12296&&c!==(c=m[54].xDomainNumb==m[12]?4:m[54].xDomainNumb==m[3].maxXDomain?5:0)&&A(s,"r",c),o[0]&16384&&u!==(u=ni[m[14]])&&A(s,"fill",u),o[0]&8193&&d!==(d="translate("+m[0](m[54].xDomainNumb)+","+m[54].zScore+")")&&A(n,"transform",d)},d(m){m&&G(n)}}}function im(i){let n,s,c,u;return{c(){n=ft("g"),s=ft("circle"),this.h()},l(d){n=dt(d,"g",{transform:!0});var m=be(n);s=dt(m,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),be(s).forEach(G),m.forEach(G),this.h()},h(){A(s,"r",c=i[54].xDomainNumb==i[12]?4:i[54].xDomainNumb==i[3].maxXDomain?5:0),A(s,"fill",ni.main),A(s,"stroke-width","1px"),A(s,"stroke","white"),A(n,"transform",u="translate("+i[0](i[54].xDomainNumb)+","+i[54].zScore+")")},m(d,m){Be(d,n,m),we(n,s)},p(d,m){m[0]&4360&&c!==(c=d[54].xDomainNumb==d[12]?4:d[54].xDomainNumb==d[3].maxXDomain?5:0)&&A(s,"r",c),m[0]&257&&u!==(u="translate("+d[0](d[54].xDomainNumb)+","+d[54].zScore+")")&&A(n,"transform",u)},d(d){d&&G(n)}}}function nm(i){let n,s,c,u,d,m,o,x;return{c(){n=ft("g"),s=ft("g"),c=ft("rect"),d=ft("text"),m=fi(i[19]),this.h()},l(w){n=dt(w,"g",{class:!0,transform:!0});var I=be(n);s=dt(I,"g",{});var k=be(s);c=dt(k,"rect",{labelid:!0,transform:!0,x:!0,y:!0,width:!0,height:!0,rx:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(c).forEach(G),d=dt(k,"text",{labelid:!0,transform:!0,x:!0,y:!0,"text-anchor":!0,"stroke-width":!0,stroke:!0,fill:!0,"font-size":!0});var E=be(d);m=di(E,i[19]),E.forEach(G),k.forEach(G),I.forEach(G),this.h()},h(){A(c,"labelid",0),A(c,"transform","translate(0,0)"),A(c,"x","0"),A(c,"y","0"),A(c,"width",u=i[25].length>0?i[25][0].width+6:0),A(c,"height",22),A(c,"rx","3px"),A(c,"stroke",ni.main),A(c,"fill","white"),A(c,"stroke-width","1.5px"),A(d,"labelid",0),A(d,"transform","translate(0,0)"),A(d,"x",3),A(d,"y",16),A(d,"text-anchor","start"),A(d,"stroke-width","0.25px"),A(d,"stroke",ni.main),A(d,"fill",ni.main),A(d,"font-size","16px"),A(n,"class","value-label-group"),A(n,"transform",x="translate("+(i[11]+20)+","+(i[8][i[8].length-1].zScore-11)+")")},m(w,I){Be(w,n,I),we(n,s),we(s,c),we(s,d),we(d,m),o=mh.observe(d,i[47].bind(d))},p(w,I){I[0]&33554432&&u!==(u=w[25].length>0?w[25][0].width+6:0)&&A(c,"width",u),I[0]&524288&&zi(m,w[19]),I[0]&2304&&x!==(x="translate("+(w[11]+20)+","+(w[8][w[8].length-1].zScore-11)+")")&&A(n,"transform",x)},d(w){w&&G(n),o()}}}function nb(i){let n,s=i[6].includes(0)&i[5]===0,c,u,d=s&&Kd(i),m=i[5]===0&&Yd(i);return{c(){n=it("div"),d&&d.c(),c=Rt(),m&&m.c(),this.h()},l(o){n=nt(o,"DIV",{class:!0,style:!0});var x=be(n);d&&d.l(x),c=Ft(x),m&&m.l(x),x.forEach(G),this.h()},h(){A(n,"class","time-comparison-cell-container svelte-2j0wow"),A(n,"style",u=i[7].includes(0)&i[5]!=0|i[17]==null?null:"background-color:"+i[17]+"; box-shadow: 0 0 4px 3px "+i[17]+";")},m(o,x){Be(o,n,x),d&&d.m(n,null),we(n,c),m&&m.m(n,null)},p(o,x){x[0]&96&&(s=o[6].includes(0)&o[5]===0),s?d?d.p(o,x):(d=Kd(o),d.c(),d.m(n,c)):d&&(d.d(1),d=null),o[5]===0?m?m.p(o,x):(m=Yd(o),m.c(),m.m(n,null)):m&&(m.d(1),m=null),x[0]&131232&&u!==(u=o[7].includes(0)&o[5]!=0|o[17]==null?null:"background-color:"+o[17]+"; box-shadow: 0 0 4px 3px "+o[17]+";")&&A(n,"style",u)},i:hi,o:hi,d(o){o&&G(n),d&&d.d(),m&&m.d()}}}function rb(i,n,s){let c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y,re,V,ne,oe,Ne,he,fe,pe,Ee,ve,ze,De,j,ce,{indicator:rt}=n,{rowNumb:Ke,topicNumb:qe}=n,{metadata:Qe,calculations:Ie}=n,{col4Width:lt}=n,{chosenId2:ot}=n,{chosenId3:vt}=n,{baselineComparisonArea:gt}=n,{visibleAreas:We}=n,{x:yt,xDomain:ue}=n,{chosenId11:ke}=n,{chosenId6:Fe}=n,bt=xi("selectedAndRelatedAreas"),mi=Ie.calcs[Ie.maxXDomain].median,et=Ie.calcs[Ie.maxXDomain].mad,ht=Ie.calcs[Ie.maxXDomain].main,li=[-Fc,Fc],nn=Nn.better,ei="Improved since 2012";function on(){var tt;c[0]=(tt=ph.entries.get(this))==null?void 0:tt.contentRect,s(25,c)}return i.$$set=tt=>{"indicator"in tt&&s(27,rt=tt.indicator),"rowNumb"in tt&&s(1,Ke=tt.rowNumb),"topicNumb"in tt&&s(2,qe=tt.topicNumb),"metadata"in tt&&s(28,Qe=tt.metadata),"calculations"in tt&&s(3,Ie=tt.calculations),"col4Width"in tt&&s(4,lt=tt.col4Width),"chosenId2"in tt&&s(29,ot=tt.chosenId2),"chosenId3"in tt&&s(5,vt=tt.chosenId3),"baselineComparisonArea"in tt&&s(30,gt=tt.baselineComparisonArea),"visibleAreas"in tt&&s(31,We=tt.visibleAreas),"x"in tt&&s(0,yt=tt.x),"xDomain"in tt&&s(32,ue=tt.xDomain),"chosenId11"in tt&&s(6,ke=tt.chosenId11),"chosenId6"in tt&&s(7,Fe=tt.chosenId6)},i.$$.update=()=>{i.$$.dirty[0]&144&&s(11,u=lt-(Fe.includes(0)?50:110)),i.$$.dirty[0]&98304&&s(10,o=d-m.top-m.bottom-Ht.areaSpaceBeyondXScale.split*2),i.$$.dirty[0]&536870920&&s(34,x=ot==="earliest available year"?Ie.mainMinXDomain:ot==="previous year"?Ie.maxXDomain-1:ot),i.$$.dirty[0]&8|i.$$.dirty[1]&8&&s(46,w=Array.from({length:Ie.maxXDomain-x+1},(tt,ct)=>x+ct).map(tt=>({xDomainNumb:tt,value:Ie.calcs[tt]==null?void 0:"main"in Ie.calcs[tt]?Ie.calcs[tt].main:void 0})).filter(tt=>tt.value!=null&!isNaN(tt.value))),i.$$.dirty[0]&1024&&s(33,De=Us().domain(li).range([o,0])),i.$$.dirty[0]&2080|i.$$.dirty[1]&32772&&s(8,I=w.map(tt=>({...tt,zScore:Rc(Ht,vt,u,De,tt.value,mi,et)}))),i.$$.dirty[0]&256&&s(24,k=[...I.map(tt=>({...tt,zScore:tt.zScore-10})),...I.reverse().map(tt=>({...tt,zScore:tt.zScore+10}))]),i.$$.dirty[0]&1073741824&&s(14,E=(gt.areacd==="median"?gt:bt.find(tt=>gt.areacd===tt.areacd)).role),i.$$.dirty[0]&16392|i.$$.dirty[1]&8&&s(45,B=Array.from({length:Ie.maxXDomain-x+1},(tt,ct)=>x+ct).map(tt=>({xDomainNumb:tt,value:Ie.calcs[tt]==null?void 0:E in Ie.calcs[tt]?Ie.calcs[tt][E]:void 0})).filter(tt=>tt.value!=null&!isNaN(tt.value))),i.$$.dirty[0]&2080|i.$$.dirty[1]&16388&&s(13,K=B.map(tt=>({...tt,zScore:Rc(Ht,vt,u,De,tt.value,mi,et)}))),i.$$.dirty[0]&8192&&s(23,U=[...K.map(tt=>({...tt,zScore:tt.zScore-5})),...K.reverse().map(tt=>({...tt,zScore:tt.zScore+5}))]),i.$$.dirty[0]&8|i.$$.dirty[1]&8&&s(9,X=x in Ie.calcs?Ie.calcs[x].main:null),i.$$.dirty[0]&512&&s(38,Q=ht==null|X==null|et==null?null:(ht-X)/et),i.$$.dirty[0]&64&&s(44,Y=ke.includes(1)),i.$$.dirty[0]&268435456&&s(43,re=Qe.polarity==0?null:Qe.polarity==-1?"better":"worse"),i.$$.dirty[0]&268435456&&s(42,V=Qe.polarity==0?null:"similar"),i.$$.dirty[0]&268435456&&s(41,ne=Qe.polarity==0?null:Qe.polarity==1?"better":"worse"),i.$$.dirty[0]&64&&s(37,oe=ke.includes(3)?2:1),i.$$.dirty[0]&268435464|i.$$.dirty[1]&15560&&s(17,nn=!Y|Q==null|Qe.polarity==0|x==Ie.maxXDomain?null:Q<-oe?Nn[re]:Q<=oe?Nn[V]:Nn[ne]),i.$$.dirty[0]&1073741824&&(gt.areacd==="median"||gt.areanm),i.$$.dirty[0]&64&&s(40,Ne=ke.includes(2)),i.$$.dirty[0]&268435456|i.$$.dirty[1]&512&&s(39,he=Qe.polarity==0|!Ne?"Decreased":Qe.polarity==-1?"Improved":"Worsened"),i.$$.dirty[0]&268435456|i.$$.dirty[1]&512&&s(35,pe=Qe.polarity==0|!Ne?"Increased":Qe.polarity==1?"Improved":"Worsened"),i.$$.dirty[0]&520|i.$$.dirty[1]&504&&s(18,ei=x==Ie.maxXDomain?"No historical data":ht==null?"No data in "+Ie.maxXDomain:X==null?"No data in "+x:(Q<-oe?he:Q<=oe?fe:pe)+" since "+x),i.$$.dirty[0]&8448&&s(12,Ee=Math.min(...[...I,...K].map(tt=>tt.xDomainNumb))),i.$$.dirty[0]&12544&&s(22,ve=Math.max(...[...I,...K].filter(tt=>tt.xDomainNumb==Ee).map(tt=>tt.zScore))),i.$$.dirty[0]&8456&&s(21,ze=Math.max(...[...I,...K].filter(tt=>tt.xDomainNumb==Ie.maxXDomain).map(tt=>tt.zScore))),i.$$.dirty[0]&6152&&s(0,yt=Us().domain([Ee,Ie.maxXDomain]).range([0,u])),i.$$.dirty[0]&1&&s(20,j=Ih().curve(Hp).y(tt=>tt.zScore).x(tt=>yt(tt.xDomainNumb))),i.$$.dirty[0]&268435968&&s(19,ce=["pp","abs"].includes(Qe.howToMeasureChange)?(ht-X>0?"+":"")+(Qe.howToMeasureChange=="pp"?"":Qe.prefix)+Hr(Ir(ht-X,Qe.decimalPlaces))+(Qe.howToMeasureChange=="pp"?" pp":""):(ht-X>0?"+":"")+Ir((ht-X)/X,1)+"%"),i.$$.dirty[0]&256&&(I.length>1?Math.abs(I[I.length-1].zScore-I[0].zScore)/2+Math.min(I[I.length-1].zScore,I[0].zScore):I[0].zScore)},s(25,c=[]),s(16,d=80),s(15,m={top:5,left:25,right:0,bottom:25}),s(36,fe="Little change"),[yt,Ke,qe,Ie,lt,vt,ke,Fe,I,X,o,u,Ee,K,E,m,d,nn,ei,ce,j,ze,ve,U,k,c,ht,rt,Qe,ot,gt,We,ue,De,x,pe,fe,oe,Q,he,Ne,ne,V,re,Y,B,w,on]}class sb extends pi{constructor(n){super(),gi(this,n,rb,nb,_i,{indicator:27,rowNumb:1,topicNumb:2,metadata:28,calculations:3,col4Width:4,chosenId2:29,chosenId3:5,baselineComparisonArea:30,visibleAreas:31,x:0,xDomain:32,chosenId11:6,chosenId6:7},null,[-1,-1])}}function rm(i){let n,s,c,u=(i[22].includes(5)?i[6].originalTitle:i[5].label)+"",d,m,o,x,w,I,k,E,B,K,U;m=new ib({});function X(ne,oe){return oe&4194304&&(x=null),x==null&&(x=!!ne[22].includes(5)),x?ob:ab}let Q=X(i,-1),Y=Q(i),re=i[13]!=2&&sm(i),V=i[13]!=1&&am(i);return{c(){n=it("div"),s=it("p"),c=it("a"),d=fi(u),Nt(m.$$.fragment),o=Rt(),Y.c(),w=Rt(),I=it("div"),re&&re.c(),k=Rt(),E=it("div"),B=Rt(),K=it("div"),V&&V.c(),this.h()},l(ne){n=nt(ne,"DIV",{class:!0});var oe=be(n);s=nt(oe,"P",{class:!0});var Ne=be(s);c=nt(Ne,"A",{href:!0});var he=be(c);d=di(he,u),he.forEach(G),Kt(m.$$.fragment,Ne),Ne.forEach(G),o=Ft(oe),Y.l(oe),oe.forEach(G),w=Ft(ne),I=nt(ne,"DIV",{class:!0});var fe=be(I);re&&re.l(fe),fe.forEach(G),k=Ft(ne),E=nt(ne,"DIV",{class:!0}),be(E).forEach(G),B=Ft(ne),K=nt(ne,"DIV",{class:!0});var pe=be(K);V&&V.l(pe),pe.forEach(G),this.h()},h(){A(c,"href","https://www.ons.gov.uk/"),A(s,"class","indicator-label svelte-ghjv81"),A(n,"class","col1 svelte-ghjv81"),A(I,"class","col2 svelte-ghjv81"),A(E,"class","col3"),A(K,"class","col4 svelte-ghjv81")},m(ne,oe){Be(ne,n,oe),we(n,s),we(s,c),we(c,d),Ut(m,s,null),we(n,o),Y.m(n,null),Be(ne,w,oe),Be(ne,I,oe),re&&re.m(I,null),Be(ne,k,oe),Be(ne,E,oe),Be(ne,B,oe),Be(ne,K,oe),V&&V.m(K,null),U=!0},p(ne,oe){(!U||oe&4194400)&&u!==(u=(ne[22].includes(5)?ne[6].originalTitle:ne[5].label)+"")&&zi(d,u),Q===(Q=X(ne,oe))&&Y?Y.p(ne,oe):(Y.d(1),Y=Q(ne),Y&&(Y.c(),Y.m(n,null))),ne[13]!=2?re?(re.p(ne,oe),oe&8192&&Le(re,1)):(re=sm(ne),re.c(),Le(re,1),re.m(I,null)):re&&(wi(),Ze(re,1,1,()=>{re=null}),Ii()),ne[13]!=1?V?(V.p(ne,oe),oe&8192&&Le(V,1)):(V=am(ne),V.c(),Le(V,1),V.m(K,null)):V&&(wi(),Ze(V,1,1,()=>{V=null}),Ii())},i(ne){U||(Le(m.$$.fragment,ne),Le(re),Le(V),U=!0)},o(ne){Ze(m.$$.fragment,ne),Ze(re),Ze(V),U=!1},d(ne){ne&&G(n),Gt(m),Y.d(),ne&&G(w),ne&&G(I),re&&re.d(),ne&&G(k),ne&&G(E),ne&&G(B),ne&&G(K),V&&V.d()}}}function ab(i){let n,s=i[6].subtitle+"",c,u=i[13]===1?" in "+i[7].maxXDomain:"",d;return{c(){n=it("p"),c=fi(s),d=fi(u),this.h()},l(m){n=nt(m,"P",{class:!0});var o=be(n);c=di(o,s),d=di(o,u),o.forEach(G),this.h()},h(){A(n,"class","indicator-detail svelte-ghjv81")},m(m,o){Be(m,n,o),we(n,c),we(n,d)},p(m,o){o&64&&s!==(s=m[6].subtitle+"")&&zi(c,s),o&8320&&u!==(u=m[13]===1?" in "+m[7].maxXDomain:"")&&zi(d,u)},d(m){m&&G(n)}}}function ob(i){let n,s=i[6].originalSubtitle+"",c;return{c(){n=it("p"),c=fi(s),this.h()},l(u){n=nt(u,"P",{class:!0});var d=be(n);c=di(d,s),d.forEach(G),this.h()},h(){A(n,"class","indicator-detail svelte-ghjv81")},m(u,d){Be(u,n,d),we(n,c)},p(u,d){d&64&&s!==(s=u[6].originalSubtitle+"")&&zi(c,s)},d(u){u&&G(n)}}}function sm(i){let n,s,c,u,d;function m(I){i[25](I)}function o(I){i[26](I)}function x(I){i[27](I)}let w={indicator:i[5],rowNumb:i[3],topicNumb:i[4],metadata:i[6],calculations:i[7],col2Width:i[9],chosenId3:i[13],baselineComparisonArea:i[15],visibleAreas:i[14],scaleHeight:i[16],scaleWidth:i[17],x:i[20],xDomain:i[19],y:i[21],chosenId11:i[22],chosenId6:i[23]};return i[0]!==void 0&&(w.yDomainGlobal=i[0]),i[1]!==void 0&&(w.hoverIndex=i[1]),i[2]!==void 0&&(w.hoverChartIndex=i[2]),n=new Hy({props:w}),Et.push(()=>Bt(n,"yDomainGlobal",m)),Et.push(()=>Bt(n,"hoverIndex",o)),Et.push(()=>Bt(n,"hoverChartIndex",x)),{c(){Nt(n.$$.fragment)},l(I){Kt(n.$$.fragment,I)},m(I,k){Ut(n,I,k),d=!0},p(I,k){const E={};k&32&&(E.indicator=I[5]),k&8&&(E.rowNumb=I[3]),k&16&&(E.topicNumb=I[4]),k&64&&(E.metadata=I[6]),k&128&&(E.calculations=I[7]),k&512&&(E.col2Width=I[9]),k&8192&&(E.chosenId3=I[13]),k&32768&&(E.baselineComparisonArea=I[15]),k&16384&&(E.visibleAreas=I[14]),k&65536&&(E.scaleHeight=I[16]),k&131072&&(E.scaleWidth=I[17]),k&1048576&&(E.x=I[20]),k&524288&&(E.xDomain=I[19]),k&2097152&&(E.y=I[21]),k&4194304&&(E.chosenId11=I[22]),k&8388608&&(E.chosenId6=I[23]),!s&&k&1&&(s=!0,E.yDomainGlobal=I[0],Ot(()=>s=!1)),!c&&k&2&&(c=!0,E.hoverIndex=I[1],Ot(()=>c=!1)),!u&&k&4&&(u=!0,E.hoverChartIndex=I[2],Ot(()=>u=!1)),n.$set(E)},i(I){d||(Le(n.$$.fragment,I),d=!0)},o(I){Ze(n.$$.fragment,I),d=!1},d(I){Gt(n,I)}}}function am(i){let n,s,c,u,d;const m=[cb,lb],o=[];function x(w,I){return I&4194304&&(n=null),n==null&&(n=!!w[22].includes(4)),n?0:1}return s=x(i,-1),c=o[s]=m[s](i),{c(){c.c(),u=si()},l(w){c.l(w),u=si()},m(w,I){o[s].m(w,I),Be(w,u,I),d=!0},p(w,I){let k=s;s=x(w,I),s===k?o[s].p(w,I):(wi(),Ze(o[k],1,1,()=>{o[k]=null}),Ii(),c=o[s],c?c.p(w,I):(c=o[s]=m[s](w),c.c()),Le(c,1),c.m(u.parentNode,u))},i(w){d||(Le(c),d=!0)},o(w){Ze(c),d=!1},d(w){o[s].d(w),w&&G(u)}}}function lb(i){let n,s;return n=new eb({props:{indicator:i[5],rowNumb:i[3],topicNumb:i[4],metadata:i[6],calculations:i[7],col4Width:i[11],chosenId2:i[12],chosenId3:i[13],baselineComparisonArea:i[15],visibleAreas:i[14],scaleHeight:i[16],scaleWidth:i[18],x:i[20],xDomain:i[19],chosenId11:i[22],chosenId6:i[23]}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u&32&&(d.indicator=c[5]),u&8&&(d.rowNumb=c[3]),u&16&&(d.topicNumb=c[4]),u&64&&(d.metadata=c[6]),u&128&&(d.calculations=c[7]),u&2048&&(d.col4Width=c[11]),u&4096&&(d.chosenId2=c[12]),u&8192&&(d.chosenId3=c[13]),u&32768&&(d.baselineComparisonArea=c[15]),u&16384&&(d.visibleAreas=c[14]),u&65536&&(d.scaleHeight=c[16]),u&262144&&(d.scaleWidth=c[18]),u&1048576&&(d.x=c[20]),u&524288&&(d.xDomain=c[19]),u&4194304&&(d.chosenId11=c[22]),u&8388608&&(d.chosenId6=c[23]),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function cb(i){let n,s;return n=new sb({props:{indicator:i[5],rowNumb:i[3],topicNumb:i[4],metadata:i[6],calculations:i[7],col4Width:i[11],chosenId2:i[12],chosenId3:i[13],baselineComparisonArea:i[15],visibleAreas:i[14],scaleHeight:i[16],scaleWidth:i[18],x:i[20],xDomain:i[19],chosenId11:i[22],chosenId6:i[23]}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u&32&&(d.indicator=c[5]),u&8&&(d.rowNumb=c[3]),u&16&&(d.topicNumb=c[4]),u&64&&(d.metadata=c[6]),u&128&&(d.calculations=c[7]),u&2048&&(d.col4Width=c[11]),u&4096&&(d.chosenId2=c[12]),u&8192&&(d.chosenId3=c[13]),u&32768&&(d.baselineComparisonArea=c[15]),u&16384&&(d.visibleAreas=c[14]),u&65536&&(d.scaleHeight=c[16]),u&262144&&(d.scaleWidth=c[18]),u&1048576&&(d.x=c[20]),u&524288&&(d.xDomain=c[19]),u&4194304&&(d.chosenId11=c[22]),u&8388608&&(d.chosenId6=c[23]),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function ub(i){let n,s,c,u=i[24]&&rm(i);return{c(){n=it("div"),s=it("div"),u&&u.c(),this.h()},l(d){n=nt(d,"DIV",{class:!0,style:!0});var m=be(n);s=nt(m,"DIV",{class:!0,style:!0});var o=be(s);u&&u.l(o),o.forEach(G),m.forEach(G),this.h()},h(){A(s,"class","row-content-container svelte-ghjv81"),ii(s,"grid-template-columns","[line1] "+i[8]+"px [line2] "+i[9]+"px [line3] "+i[10]+"px [line4] "+i[11]+"px [end]"),A(n,"class","row-container svelte-ghjv81"),ii(n,"background-color",i[3]%2===0?"#fafafa":"#ffffff")},m(d,m){Be(d,n,m),we(n,s),u&&u.m(s,null),c=!0},p(d,[m]){d[24]?u?(u.p(d,m),m&16777216&&Le(u,1)):(u=rm(d),u.c(),Le(u,1),u.m(s,null)):u&&(wi(),Ze(u,1,1,()=>{u=null}),Ii()),(!c||m&3840)&&ii(s,"grid-template-columns","[line1] "+d[8]+"px [line2] "+d[9]+"px [line3] "+d[10]+"px [line4] "+d[11]+"px [end]"),(!c||m&8)&&ii(n,"background-color",d[3]%2===0?"#fafafa":"#ffffff")},i(d){c||(Le(u),c=!0)},o(d){Ze(u),c=!1},d(d){d&&G(n),u&&u.d()}}}function hb(i,n,s){let{rowNumb:c,topicNumb:u}=n,{indicator:d}=n,{metadata:m,calculations:o}=n,{col1Width:x,col2Width:w,col3Width:I,col4Width:k}=n,{chosenId2:E}=n,{chosenId3:B}=n,{visibleAreas:K}=n,{baselineComparisonArea:U}=n,{scaleHeight:X,scaleWidthArea:Q,scaleWidthTime:Y}=n,{xDomain:re,x:V,yDomainGlobal:ne,y:oe}=n,{hoverIndex:Ne,hoverChartIndex:he}=n,{chosenId11:fe}=n,{chosenId6:pe}=n,Ee=!1;Gs(()=>{s(24,Ee=!0)});function ve(j){ne=j,s(0,ne)}function ze(j){Ne=j,s(1,Ne)}function De(j){he=j,s(2,he)}return i.$$set=j=>{"rowNumb"in j&&s(3,c=j.rowNumb),"topicNumb"in j&&s(4,u=j.topicNumb),"indicator"in j&&s(5,d=j.indicator),"metadata"in j&&s(6,m=j.metadata),"calculations"in j&&s(7,o=j.calculations),"col1Width"in j&&s(8,x=j.col1Width),"col2Width"in j&&s(9,w=j.col2Width),"col3Width"in j&&s(10,I=j.col3Width),"col4Width"in j&&s(11,k=j.col4Width),"chosenId2"in j&&s(12,E=j.chosenId2),"chosenId3"in j&&s(13,B=j.chosenId3),"visibleAreas"in j&&s(14,K=j.visibleAreas),"baselineComparisonArea"in j&&s(15,U=j.baselineComparisonArea),"scaleHeight"in j&&s(16,X=j.scaleHeight),"scaleWidthArea"in j&&s(17,Q=j.scaleWidthArea),"scaleWidthTime"in j&&s(18,Y=j.scaleWidthTime),"xDomain"in j&&s(19,re=j.xDomain),"x"in j&&s(20,V=j.x),"yDomainGlobal"in j&&s(0,ne=j.yDomainGlobal),"y"in j&&s(21,oe=j.y),"hoverIndex"in j&&s(1,Ne=j.hoverIndex),"hoverChartIndex"in j&&s(2,he=j.hoverChartIndex),"chosenId11"in j&&s(22,fe=j.chosenId11),"chosenId6"in j&&s(23,pe=j.chosenId6)},[ne,Ne,he,c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y,re,V,oe,fe,pe,Ee,ve,ze,De]}class fb extends pi{constructor(n){super(),gi(this,n,hb,ub,_i,{rowNumb:3,topicNumb:4,indicator:5,metadata:6,calculations:7,col1Width:8,col2Width:9,col3Width:10,col4Width:11,chosenId2:12,chosenId3:13,visibleAreas:14,baselineComparisonArea:15,scaleHeight:16,scaleWidthArea:17,scaleWidthTime:18,xDomain:19,x:20,yDomainGlobal:0,y:21,hoverIndex:1,hoverChartIndex:2,chosenId11:22,chosenId6:23})}}function db(i){let n,s,c;return{c(){n=it("div"),s=it("img"),this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);s=nt(d,"IMG",{style:!0,width:!0,src:!0,alt:!0}),d.forEach(G),this.h()},h(){ii(s,"padding-top","10px"),A(s,"width","80%"),r1(s.src,c=`${so}/img/shareOptionsPlaceholder.png`)||A(s,"src",c),A(s,"alt","download buttons"),A(n,"class","svelte-1yu9en2")},m(u,d){Be(u,n,d),we(n,s)},p:hi,i:hi,o:hi,d(u){u&&G(n)}}}class Kp extends pi{constructor(n){super(),gi(this,n,null,db,_i,{})}}function om(i,n,s){const c=i.slice();return c[6]=n[s],c[8]=s,c}function lm(i){let n,s=i[6]+"",c,u;return{c(){n=it("option"),c=fi(s),this.h()},l(d){n=nt(d,"OPTION",{});var m=be(n);c=di(m,s),m.forEach(G),this.h()},h(){n.__value=u=i[6],n.value=n.__value},m(d,m){Be(d,n,m),we(n,c)},p(d,m){m&4&&s!==(s=d[6]+"")&&zi(c,s),m&4&&u!==(u=d[6])&&(n.__value=u,n.value=n.__value)},d(d){d&&G(n)}}}function mb(i){let n,s,c,u,d,m=i[2],o=[];for(let x=0;x<m.length;x+=1)o[x]=lm(om(i,m,x));return{c(){n=it("div"),s=it("select");for(let x=0;x<o.length;x+=1)o[x].c();this.h()},l(x){n=nt(x,"DIV",{class:!0,style:!0});var w=be(n);s=nt(w,"SELECT",{style:!0,id:!0,name:!0,class:!0});var I=be(s);for(let k=0;k<o.length;k+=1)o[k].l(I);I.forEach(G),w.forEach(G),this.h()},h(){ii(s,"text-wrap","balance"),A(s,"id",i[1]),A(s,"name",i[1]),A(s,"class",c=Kf("ons-input ons-input--select"+(i[4]?" low-height":""))+" svelte-9zngwk"),i[0]===void 0&&ao(()=>i[5].call(s)),A(n,"class","ons-field"),ii(n,"width",i[3])},m(x,w){Be(x,n,w),we(n,s);for(let I=0;I<o.length;I+=1)o[I]&&o[I].m(s,null);Yf(s,i[0],!0),u||(d=Gi(s,"change",i[5]),u=!0)},p(x,[w]){if(w&4){m=x[2];let I;for(I=0;I<m.length;I+=1){const k=om(x,m,I);o[I]?o[I].p(k,w):(o[I]=lm(k),o[I].c(),o[I].m(s,null))}for(;I<o.length;I+=1)o[I].d(1);o.length=m.length}w&2&&A(s,"id",x[1]),w&2&&A(s,"name",x[1]),w&16&&c!==(c=Kf("ons-input ons-input--select"+(x[4]?" low-height":""))+" svelte-9zngwk")&&A(s,"class",c),w&5&&Yf(s,x[0]),w&8&&ii(n,"width",x[3])},i:hi,o:hi,d(x){x&&G(n),$i(o,x),u=!1,d()}}}function pb(i,n,s){let{chosenId:c,name:u="",optionsArray:d,width:m=null,lowHeight:o=!1}=n;function x(){c=s1(this),s(0,c),s(2,d)}return i.$$set=w=>{"chosenId"in w&&s(0,c=w.chosenId),"name"in w&&s(1,u=w.name),"optionsArray"in w&&s(2,d=w.optionsArray),"width"in w&&s(3,m=w.width),"lowHeight"in w&&s(4,o=w.lowHeight)},[c,u,d,m,o,x]}class kh extends pi{constructor(n){super(),gi(this,n,pb,mb,_i,{chosenId:0,name:1,optionsArray:2,width:3,lowHeight:4})}}function gb(i){let n,s,c,u,d,m,o;function x(I){i[5](I)}let w={name:i[2],width:Math.min(i[4]-20,i[0].toString().length*20)+"px",optionsArray:i[1],lowHeight:!0};return i[0]!==void 0&&(w.chosenId=i[0]),d=new kh({props:w}),Et.push(()=>Bt(d,"chosenId",x)),{c(){n=it("div"),s=it("p"),c=Rt(),u=it("div"),Nt(d.$$.fragment),this.h()},l(I){n=nt(I,"DIV",{class:!0});var k=be(n);s=nt(k,"P",{class:!0});var E=be(s);E.forEach(G),c=Ft(k),u=nt(k,"DIV",{class:!0});var B=be(u);Kt(d.$$.fragment,B),B.forEach(G),k.forEach(G),this.h()},h(){A(s,"class","svelte-1dn4t0j"),A(u,"class","dropdown-container svelte-1dn4t0j"),A(n,"class","paragraph-container svelte-1dn4t0j")},m(I,k){Be(I,n,k),we(n,s),s.innerHTML=i[3],we(n,c),we(n,u),Ut(d,u,null),o=!0},p(I,[k]){(!o||k&8)&&(s.innerHTML=I[3]);const E={};k&4&&(E.name=I[2]),k&17&&(E.width=Math.min(I[4]-20,I[0].toString().length*20)+"px"),k&2&&(E.optionsArray=I[1]),!m&&k&1&&(m=!0,E.chosenId=I[0],Ot(()=>m=!1)),d.$set(E)},i(I){o||(Le(d.$$.fragment,I),o=!0)},o(I){Ze(d.$$.fragment,I),o=!1},d(I){I&&G(n),Gt(d)}}}function _b(i,n,s){xi("selectedArea");let{chosenId:c,optionsArray:u,name:d,text:m,width:o}=n;function x(w){c=w,s(0,c)}return i.$$set=w=>{"chosenId"in w&&s(0,c=w.chosenId),"optionsArray"in w&&s(1,u=w.optionsArray),"name"in w&&s(2,d=w.name),"text"in w&&s(3,m=w.text),"width"in w&&s(4,o=w.width)},[c,u,d,m,o,x]}class cm extends pi{constructor(n){super(),gi(this,n,_b,gb,_i,{chosenId:0,optionsArray:1,name:2,text:3,width:4})}}function yb(i){let n,s;return{c(){n=ft("path"),this.h()},l(c){n=dt(c,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(n).forEach(G),this.h()},h(){A(n,"d","M5 0 L15 10 L5 20"),A(n,"stroke",s=i[1]?"#222":"#206095"),A(n,"fill","none"),A(n,"stroke-width","3px")},m(c,u){Be(c,n,u)},p(c,u){u&2&&s!==(s=c[1]?"#222":"#206095")&&A(n,"stroke",s)},d(c){c&&G(n)}}}function vb(i){let n;return{c(){n=ft("path"),this.h()},l(s){n=dt(s,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),be(n).forEach(G),this.h()},h(){A(n,"d","M0 5 L10 15 L20 5"),A(n,"stroke","#222"),A(n,"fill","none"),A(n,"stroke-width","3px")},m(s,c){Be(s,n,c)},p:hi,d(s){s&&G(n)}}}function bb(i){let n,s;function c(m,o){return m[0]?vb:yb}let u=c(i),d=u(i);return{c(){n=it("div"),s=ft("svg"),d.c(),this.h()},l(m){n=nt(m,"DIV",{class:!0});var o=be(n);s=dt(o,"svg",{width:!0,height:!0,viewBox:!0,class:!0});var x=be(s);d.l(x),x.forEach(G),o.forEach(G),this.h()},h(){A(s,"width","20"),A(s,"height","20"),A(s,"viewBox","0 0 20 20"),A(s,"class","svelte-13774mx"),A(n,"class","infoCell svelte-13774mx")},m(m,o){Be(m,n,o),we(n,s),d.m(s,null)},p(m,[o]){u===(u=c(m))&&d?d.p(m,o):(d.d(1),d=u(m),d&&(d.c(),d.m(s,null)))},i:hi,o:hi,d(m){m&&G(n),d.d()}}}function xb(i,n,s){let{twistyOpen:c,hover:u}=n;return i.$$set=d=>{"twistyOpen"in d&&s(0,c=d.twistyOpen),"hover"in d&&s(1,u=d.hover)},[c,u]}class wb extends pi{constructor(n){super(),gi(this,n,xb,bb,_i,{twistyOpen:0,hover:1})}}function Ib(i,n){const s=i.getBoundingClientRect(),c=n.getBoundingClientRect(),u={};return u.top=s.top<0,u.left=s.left<0,u.bottom=s.bottom+c.height>(window.innerHeight||document.documentElement.clientHeight),u.right=s.right>(window.innerWidth||document.documentElement.clientWidth),u.any=u.top||u.left||u.bottom||u.right,u}function kb(i){let n,s=i[0](i[1],i[2])+"",c;return{c(){n=it("div"),this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);d.forEach(G),this.h()},h(){A(n,"class",c="item "+i[3]+" svelte-3e0qet")},m(u,d){Be(u,n,d),n.innerHTML=s},p(u,[d]){d&7&&s!==(s=u[0](u[1],u[2])+"")&&(n.innerHTML=s),d&8&&c!==(c="item "+u[3]+" svelte-3e0qet")&&A(n,"class",c)},i:hi,o:hi,d(u){u&&G(n)}}}function Tb(i,n,s){let{isActive:c=!1}=n,{isFirst:u=!1}=n,{isHover:d=!1}=n,{isSelectable:m=!1}=n,{getOptionLabel:o=void 0}=n,{item:x=void 0}=n,{filterText:w=""}=n,I="";return i.$$set=k=>{"isActive"in k&&s(4,c=k.isActive),"isFirst"in k&&s(5,u=k.isFirst),"isHover"in k&&s(6,d=k.isHover),"isSelectable"in k&&s(7,m=k.isSelectable),"getOptionLabel"in k&&s(0,o=k.getOptionLabel),"item"in k&&s(1,x=k.item),"filterText"in k&&s(2,w=k.filterText)},i.$$.update=()=>{if(i.$$.dirty&242){const k=[];c&&k.push("active"),u&&k.push("first"),d&&k.push("hover"),x.isGroupHeader&&k.push("groupHeader"),x.isGroupItem&&k.push("groupItem"),m||k.push("notSelectable"),s(3,I=k.join(" "))}},[o,x,w,I,c,u,d,m]}class Yp extends pi{constructor(n){super(),gi(this,n,Tb,kb,_i,{isActive:4,isFirst:5,isHover:6,isSelectable:7,getOptionLabel:0,item:1,filterText:2})}}function um(i,n,s){const c=i.slice();return c[41]=n[s],c[42]=s,c}function Sb(i){let n,s,c=i[1],u=[];for(let o=0;o<c.length;o+=1)u[o]=dm(um(i,c,o));const d=o=>Ze(u[o],1,1,()=>{u[o]=null});let m=null;return c.length||(m=hm(i)),{c(){for(let o=0;o<u.length;o+=1)u[o].c();n=si(),m&&m.c()},l(o){for(let x=0;x<u.length;x+=1)u[x].l(o);n=si(),m&&m.l(o)},m(o,x){for(let w=0;w<u.length;w+=1)u[w]&&u[w].m(o,x);Be(o,n,x),m&&m.m(o,x),s=!0},p(o,x){if(x[0]&114390){c=o[1];let w;for(w=0;w<c.length;w+=1){const I=um(o,c,w);u[w]?(u[w].p(I,x),Le(u[w],1)):(u[w]=dm(I),u[w].c(),Le(u[w],1),u[w].m(n.parentNode,n))}for(wi(),w=c.length;w<u.length;w+=1)d(w);Ii(),!c.length&&m?m.p(o,x):c.length?m&&(m.d(1),m=null):(m=hm(o),m.c(),m.m(n.parentNode,n))}},i(o){if(!s){for(let x=0;x<c.length;x+=1)Le(u[x]);s=!0}},o(o){u=u.filter(Boolean);for(let x=0;x<u.length;x+=1)Ze(u[x]);s=!1},d(o){$i(u,o),o&&G(n),m&&m.d(o)}}}function Eb(i){let n,s,c;var u=i[3];function d(m){return{props:{items:m[1],itemHeight:m[8],$$slots:{default:[Mb,({item:o,i:x})=>({41:o,42:x}),({item:o,i:x})=>[0,(o?1024:0)|(x?2048:0)]]},$$scope:{ctx:m}}}}return u&&(n=Wn(u,d(i))),{c(){n&&Nt(n.$$.fragment),s=si()},l(m){n&&Kt(n.$$.fragment,m),s=si()},m(m,o){n&&Ut(n,m,o),Be(m,s,o),c=!0},p(m,o){const x={};if(o[0]&2&&(x.items=m[1]),o[0]&256&&(x.itemHeight=m[8]),o[0]&9814|o[1]&11264&&(x.$$scope={dirty:o,ctx:m}),o[0]&8&&u!==(u=m[3])){if(n){wi();const w=n;Ze(w.$$.fragment,1,0,()=>{Gt(w,1)}),Ii()}u?(n=Wn(u,d(m)),Nt(n.$$.fragment),Le(n.$$.fragment,1),Ut(n,s.parentNode,s)):n=null}else u&&n.$set(x)},i(m){c||(n&&Le(n.$$.fragment,m),c=!0)},o(m){n&&Ze(n.$$.fragment,m),c=!1},d(m){m&&G(s),n&&Gt(n,m)}}}function hm(i){let n,s=!i[11]&&fm(i);return{c(){s&&s.c(),n=si()},l(c){s&&s.l(c),n=si()},m(c,u){s&&s.m(c,u),Be(c,n,u)},p(c,u){c[11]?s&&(s.d(1),s=null):s?s.p(c,u):(s=fm(c),s.c(),s.m(n.parentNode,n))},d(c){s&&s.d(c),c&&G(n)}}}function fm(i){let n,s;return{c(){n=it("div"),s=fi(i[12]),this.h()},l(c){n=nt(c,"DIV",{class:!0});var u=be(n);s=di(u,i[12]),u.forEach(G),this.h()},h(){A(n,"class","empty svelte-1uyqfml")},m(c,u){Be(c,n,u),we(n,s)},p(c,u){u[0]&4096&&zi(s,c[12])},d(c){c&&G(n)}}}function Ab(i){let n,s,c,u,d,m;var o=i[4];function x(E){return{props:{item:E[41],filterText:E[13],getOptionLabel:E[6],isFirst:hh(E[42]),isActive:jc(E[41],E[9],E[10]),isHover:Zc(E[2],E[41],E[42],E[1]),isSelectable:xa(E[41])}}}o&&(s=Wn(o,x(i)));function w(){return i[29](i[42])}function I(){return i[30](i[42])}function k(...E){return i[31](i[41],i[42],...E)}return{c(){n=it("div"),s&&Nt(s.$$.fragment),c=Rt(),this.h()},l(E){n=nt(E,"DIV",{class:!0,tabindex:!0});var B=be(n);s&&Kt(s.$$.fragment,B),c=Ft(B),B.forEach(G),this.h()},h(){A(n,"class","listItem"),A(n,"tabindex","-1")},m(E,B){Be(E,n,B),s&&Ut(s,n,null),we(n,c),u=!0,d||(m=[Gi(n,"mouseover",w),Gi(n,"focus",I),Gi(n,"click",k)],d=!0)},p(E,B){i=E;const K={};if(B[0]&2&&(K.item=i[41]),B[0]&8192&&(K.filterText=i[13]),B[0]&64&&(K.getOptionLabel=i[6]),B[0]&1538&&(K.isActive=jc(i[41],i[9],i[10])),B[0]&6&&(K.isHover=Zc(i[2],i[41],i[42],i[1])),B[0]&2&&(K.isSelectable=xa(i[41])),B[0]&16&&o!==(o=i[4])){if(s){wi();const U=s;Ze(U.$$.fragment,1,0,()=>{Gt(U,1)}),Ii()}o?(s=Wn(o,x(i)),Nt(s.$$.fragment),Le(s.$$.fragment,1),Ut(s,n,c)):s=null}else o&&s.$set(K)},i(E){u||(s&&Le(s.$$.fragment,E),u=!0)},o(E){s&&Ze(s.$$.fragment,E),u=!1},d(E){E&&G(n),s&&Gt(s),d=!1,wa(m)}}}function Cb(i){let n,s=i[7](i[41])+"",c;return{c(){n=it("div"),c=fi(s),this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);c=di(d,s),d.forEach(G),this.h()},h(){A(n,"class","listGroupTitle svelte-1uyqfml")},m(u,d){Be(u,n,d),we(n,c)},p(u,d){d[0]&130&&s!==(s=u[7](u[41])+"")&&zi(c,s)},i:hi,o:hi,d(u){u&&G(n)}}}function dm(i){let n,s,c,u;const d=[Cb,Ab],m=[];function o(x,w){return x[41].isGroupHeader&&!x[41].isSelectable?0:1}return n=o(i),s=m[n]=d[n](i),{c(){s.c(),c=si()},l(x){s.l(x),c=si()},m(x,w){m[n].m(x,w),Be(x,c,w),u=!0},p(x,w){let I=n;n=o(x),n===I?m[n].p(x,w):(wi(),Ze(m[I],1,1,()=>{m[I]=null}),Ii(),s=m[n],s?s.p(x,w):(s=m[n]=d[n](x),s.c()),Le(s,1),s.m(c.parentNode,c))},i(x){u||(Le(s),u=!0)},o(x){Ze(s),u=!1},d(x){m[n].d(x),x&&G(c)}}}function Mb(i){let n,s,c,u,d;var m=i[4];function o(k){return{props:{item:k[41],filterText:k[13],getOptionLabel:k[6],isFirst:hh(k[42]),isActive:jc(k[41],k[9],k[10]),isHover:Zc(k[2],k[41],k[42],k[1]),isSelectable:xa(k[41])}}}m&&(s=Wn(m,o(i)));function x(){return i[26](i[42])}function w(){return i[27](i[42])}function I(...k){return i[28](i[41],i[42],...k)}return{c(){n=it("div"),s&&Nt(s.$$.fragment),this.h()},l(k){n=nt(k,"DIV",{class:!0});var E=be(n);s&&Kt(s.$$.fragment,E),E.forEach(G),this.h()},h(){A(n,"class","listItem")},m(k,E){Be(k,n,E),s&&Ut(s,n,null),c=!0,u||(d=[Gi(n,"mouseover",x),Gi(n,"focus",w),Gi(n,"click",I)],u=!0)},p(k,E){i=k;const B={};if(E[1]&1024&&(B.item=i[41]),E[0]&8192&&(B.filterText=i[13]),E[0]&64&&(B.getOptionLabel=i[6]),E[1]&2048&&(B.isFirst=hh(i[42])),E[0]&1536|E[1]&1024&&(B.isActive=jc(i[41],i[9],i[10])),E[0]&6|E[1]&3072&&(B.isHover=Zc(i[2],i[41],i[42],i[1])),E[1]&1024&&(B.isSelectable=xa(i[41])),E[0]&16&&m!==(m=i[4])){if(s){wi();const K=s;Ze(K.$$.fragment,1,0,()=>{Gt(K,1)}),Ii()}m?(s=Wn(m,o(i)),Nt(s.$$.fragment),Le(s.$$.fragment,1),Ut(s,n,null)):s=null}else m&&s.$set(B)},i(k){c||(s&&Le(s.$$.fragment,k),c=!0)},o(k){s&&Ze(s.$$.fragment,k),c=!1},d(k){k&&G(n),s&&Gt(s),u=!1,wa(d)}}}function zb(i){let n,s,c,u,d,m;const o=[Eb,Sb],x=[];function w(I,k){return I[5]?0:1}return s=w(i),c=x[s]=o[s](i),{c(){n=it("div"),c.c(),this.h()},l(I){n=nt(I,"DIV",{class:!0,style:!0});var k=be(n);c.l(k),k.forEach(G),this.h()},h(){A(n,"class","listContainer svelte-1uyqfml"),A(n,"style",i[14]),Ln(n,"virtualList",i[5])},m(I,k){Be(I,n,k),x[s].m(n,null),i[32](n),u=!0,d||(m=[Gi(window,"keydown",i[17]),Gi(window,"resize",i[18])],d=!0)},p(I,k){let E=s;s=w(I),s===E?x[s].p(I,k):(wi(),Ze(x[E],1,1,()=>{x[E]=null}),Ii(),c=x[s],c?c.p(I,k):(c=x[s]=o[s](I),c.c()),Le(c,1),c.m(n,null)),(!u||k[0]&16384)&&A(n,"style",I[14]),(!u||k[0]&32)&&Ln(n,"virtualList",I[5])},i(I){u||(Le(c),u=!0)},o(I){Ze(c),u=!1},d(I){I&&G(n),x[s].d(),i[32](null),d=!1,wa(m)}}}function jc(i,n,s){return n&&n[s]===i[s]}function hh(i){return i===0}function Zc(i,n,s,c){return xa(n)&&(i===s||c.length===1)}function xa(i){return i.isGroupHeader&&i.isSelectable||i.selectable||!i.hasOwnProperty("selectable")}function Db(i,n,s){const c=oo();let{container:u=void 0}=n,{VirtualList:d=null}=n,{Item:m=Yp}=n,{isVirtualList:o=!1}=n,{items:x=[]}=n,{labelIdentifier:w="label"}=n,{getOptionLabel:I=(ue,ke)=>{if(ue)return ue.isCreator?`Create "${ke}"`:ue[w]}}=n,{getGroupHeaderLabel:k=null}=n,{itemHeight:E=40}=n,{hoverItemIndex:B=0}=n,{value:K=void 0}=n,{optionIdentifier:U="value"}=n,{hideEmptyState:X=!1}=n,{noOptionsMessage:Q="No options"}=n,{isMulti:Y=!1}=n,{activeItemIndex:re=0}=n,{filterText:V=""}=n,{parent:ne=null}=n,{listPlacement:oe=null}=n,{listAutoWidth:Ne=null}=n,{listOffset:he=5}=n,fe=0,pe=!1,Ee;Gs(()=>{if(x.length>0&&!Y&&K){const ue=x.findIndex(ke=>ke[U]===K[U]);ue&&s(2,B=ue)}Ke("active"),u.addEventListener("scroll",()=>{clearTimeout(fe),fe=setTimeout(()=>{pe=!1},100)},!1)}),Ip(()=>{x||s(1,x=[]),x!==Ee&&x.length>0&&s(2,B=0),Ee=x});function ve(ue){ue.isCreator||c("itemSelected",ue)}function ze(ue){pe||s(2,B=ue)}function De(ue){const{item:ke,i:Fe,event:bt}=ue;if(bt.stopPropagation(),K&&!Y&&K[U]===ke[U])return j();ke.isCreator?c("itemCreated",V):xa(ke)&&(s(19,re=Fe),s(2,B=Fe),ve(ke))}function j(){c("closeList")}async function ce(ue){if(o)return;let ke=!0;for(;ke;)ue>0&&B===x.length-1?s(2,B=0):ue<0&&B===0?s(2,B=x.length-1):s(2,B=B+ue),ke=!xa(x[B]);await Pc(),Ke("hover")}function rt(ue){switch(ue.key){case"Escape":ue.preventDefault(),j();break;case"ArrowDown":ue.preventDefault(),x.length&&ce(1);break;case"ArrowUp":ue.preventDefault(),x.length&&ce(-1);break;case"Enter":if(ue.preventDefault(),x.length===0)break;const ke=x[B];if(K&&!Y&&K[U]===ke[U]){j();break}ke.isCreator?c("itemCreated",V):(s(19,re=B),ve(x[B]));break;case"Tab":if(ue.preventDefault(),x.length===0||K&&K[U]===x[B][U])return j();s(19,re=B),ve(x[B]);break}}function Ke(ue){if(o||!u)return;let ke;const Fe=u.querySelector(`.listItem .${ue}`);Fe&&(ke=u.getBoundingClientRect().bottom-Fe.getBoundingClientRect().bottom),s(0,u.scrollTop-=ke,u)}let qe;function Qe(){const{height:ue,width:ke}=ne.getBoundingClientRect();s(14,qe=""),s(14,qe+=`min-width:${ke}px;width:${Ne?"auto":"100%"};`),oe==="top"||oe==="auto"&&Ib(ne,u).bottom?s(14,qe+=`bottom:${ue+he}px;`):s(14,qe+=`top:${ue+he}px;`)}const Ie=ue=>ze(ue),lt=ue=>ze(ue),ot=(ue,ke,Fe)=>De({item:ue,i:ke,event:Fe}),vt=ue=>ze(ue),gt=ue=>ze(ue),We=(ue,ke,Fe)=>De({item:ue,i:ke,event:Fe});function yt(ue){Et[ue?"unshift":"push"](()=>{u=ue,s(0,u)})}return i.$$set=ue=>{"container"in ue&&s(0,u=ue.container),"VirtualList"in ue&&s(3,d=ue.VirtualList),"Item"in ue&&s(4,m=ue.Item),"isVirtualList"in ue&&s(5,o=ue.isVirtualList),"items"in ue&&s(1,x=ue.items),"labelIdentifier"in ue&&s(20,w=ue.labelIdentifier),"getOptionLabel"in ue&&s(6,I=ue.getOptionLabel),"getGroupHeaderLabel"in ue&&s(7,k=ue.getGroupHeaderLabel),"itemHeight"in ue&&s(8,E=ue.itemHeight),"hoverItemIndex"in ue&&s(2,B=ue.hoverItemIndex),"value"in ue&&s(9,K=ue.value),"optionIdentifier"in ue&&s(10,U=ue.optionIdentifier),"hideEmptyState"in ue&&s(11,X=ue.hideEmptyState),"noOptionsMessage"in ue&&s(12,Q=ue.noOptionsMessage),"isMulti"in ue&&s(21,Y=ue.isMulti),"activeItemIndex"in ue&&s(19,re=ue.activeItemIndex),"filterText"in ue&&s(13,V=ue.filterText),"parent"in ue&&s(22,ne=ue.parent),"listPlacement"in ue&&s(23,oe=ue.listPlacement),"listAutoWidth"in ue&&s(24,Ne=ue.listAutoWidth),"listOffset"in ue&&s(25,he=ue.listOffset)},i.$$.update=()=>{i.$$.dirty[0]&4194305&&ne&&u&&Qe()},[u,x,B,d,m,o,I,k,E,K,U,X,Q,V,qe,ze,De,rt,Qe,re,w,Y,ne,oe,Ne,he,Ie,lt,ot,vt,gt,We,yt]}class Pb extends pi{constructor(n){super(),gi(this,n,Db,zb,_i,{container:0,VirtualList:3,Item:4,isVirtualList:5,items:1,labelIdentifier:20,getOptionLabel:6,getGroupHeaderLabel:7,itemHeight:8,hoverItemIndex:2,value:9,optionIdentifier:10,hideEmptyState:11,noOptionsMessage:12,isMulti:21,activeItemIndex:19,filterText:13,parent:22,listPlacement:23,listAutoWidth:24,listOffset:25},null,[-1,-1])}}function Lb(i){let n,s=i[0](i[1])+"";return{c(){n=it("div"),this.h()},l(c){n=nt(c,"DIV",{class:!0});var u=be(n);u.forEach(G),this.h()},h(){A(n,"class","selection svelte-pu1q1n")},m(c,u){Be(c,n,u),n.innerHTML=s},p(c,[u]){u&3&&s!==(s=c[0](c[1])+"")&&(n.innerHTML=s)},i:hi,o:hi,d(c){c&&G(n)}}}function Bb(i,n,s){let{getSelectionLabel:c=void 0}=n,{item:u=void 0}=n;return i.$$set=d=>{"getSelectionLabel"in d&&s(0,c=d.getSelectionLabel),"item"in d&&s(1,u=d.item)},[c,u]}class Rb extends pi{constructor(n){super(),gi(this,n,Bb,Lb,_i,{getSelectionLabel:0,item:1})}}function mm(i,n,s){const c=i.slice();return c[9]=n[s],c[11]=s,c}function pm(i){let n,s,c,u,d;function m(...o){return i[6](i[11],...o)}return{c(){n=it("div"),s=ft("svg"),c=ft("path"),this.h()},l(o){n=nt(o,"DIV",{class:!0});var x=be(n);s=dt(x,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,role:!0,class:!0});var w=be(s);c=dt(w,"path",{d:!0}),be(c).forEach(G),w.forEach(G),x.forEach(G),this.h()},h(){A(c,"d","M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124 l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z"),A(s,"width","100%"),A(s,"height","100%"),A(s,"viewBox","-2 -2 50 50"),A(s,"focusable","false"),A(s,"aria-hidden","true"),A(s,"role","presentation"),A(s,"class","svelte-liu9pa"),A(n,"class","multiSelectItem_clear svelte-liu9pa")},m(o,x){Be(o,n,x),we(n,s),we(s,c),u||(d=Gi(n,"click",m),u=!0)},p(o,x){i=o},d(o){o&&G(n),u=!1,d()}}}function gm(i){let n,s,c=i[4](i[9])+"",u,d,m,o,x,w=!i[2]&&!i[3]&&pm(i);function I(...k){return i[7](i[11],...k)}return{c(){n=it("div"),s=it("div"),u=Rt(),w&&w.c(),d=Rt(),this.h()},l(k){n=nt(k,"DIV",{class:!0});var E=be(n);s=nt(E,"DIV",{class:!0});var B=be(s);B.forEach(G),u=Ft(E),w&&w.l(E),d=Ft(E),E.forEach(G),this.h()},h(){A(s,"class","multiSelectItem_label svelte-liu9pa"),A(n,"class",m="multiSelectItem "+(i[1]===i[11]?"active":"")+" "+(i[2]?"disabled":"")+" svelte-liu9pa")},m(k,E){Be(k,n,E),we(n,s),s.innerHTML=c,we(n,u),w&&w.m(n,null),we(n,d),o||(x=Gi(n,"click",I),o=!0)},p(k,E){i=k,E&17&&c!==(c=i[4](i[9])+"")&&(s.innerHTML=c),!i[2]&&!i[3]?w?w.p(i,E):(w=pm(i),w.c(),w.m(n,d)):w&&(w.d(1),w=null),E&6&&m!==(m="multiSelectItem "+(i[1]===i[11]?"active":"")+" "+(i[2]?"disabled":"")+" svelte-liu9pa")&&A(n,"class",m)},d(k){k&&G(n),w&&w.d(),o=!1,x()}}}function Fb(i){let n,s=i[0],c=[];for(let u=0;u<s.length;u+=1)c[u]=gm(mm(i,s,u));return{c(){for(let u=0;u<c.length;u+=1)c[u].c();n=si()},l(u){for(let d=0;d<c.length;d+=1)c[d].l(u);n=si()},m(u,d){for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(u,d);Be(u,n,d)},p(u,[d]){if(d&63){s=u[0];let m;for(m=0;m<s.length;m+=1){const o=mm(u,s,m);c[m]?c[m].p(o,d):(c[m]=gm(o),c[m].c(),c[m].m(n.parentNode,n))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},i:hi,o:hi,d(u){$i(c,u),u&&G(n)}}}function Ob(i,n,s){const c=oo();let{value:u=[]}=n,{activeValue:d=void 0}=n,{isDisabled:m=!1}=n,{multiFullItemClearable:o=!1}=n,{getSelectionLabel:x=void 0}=n;function w(E,B){B.stopPropagation(),c("multiItemClear",{i:E})}const I=(E,B)=>w(E,B),k=(E,B)=>o?w(E,B):{};return i.$$set=E=>{"value"in E&&s(0,u=E.value),"activeValue"in E&&s(1,d=E.activeValue),"isDisabled"in E&&s(2,m=E.isDisabled),"multiFullItemClearable"in E&&s(3,o=E.multiFullItemClearable),"getSelectionLabel"in E&&s(4,x=E.getSelectionLabel)},[u,d,m,o,x,w,I,k]}class Vb extends pi{constructor(n){super(),gi(this,n,Ob,Fb,_i,{value:0,activeValue:1,isDisabled:2,multiFullItemClearable:3,getSelectionLabel:4})}}function _m(i,n,s){const c=i.slice();return c[23]=n[s],c}const Nb=i=>({item:i&32,i:i&32,hoverItemIndex:i&2}),ym=i=>({item:i[23].data,i:i[23].index,hoverItemIndex:i[1]});function Ub(i){let n;return{c(){n=fi("Missing template")},l(s){n=di(s,"Missing template")},m(s,c){Be(s,n,c)},d(s){s&&G(n)}}}function vm(i,n){let s,c,u;const d=n[15].default,m=gl(d,n,n[14],ym),o=m||Ub();return{key:i,first:null,c(){s=it("svelte-virtual-list-row"),o&&o.c(),c=Rt(),this.h()},l(x){s=nt(x,"SVELTE-VIRTUAL-LIST-ROW",{class:!0});var w=be(s);o&&o.l(w),c=Ft(w),w.forEach(G),this.h()},h(){nh(s,"class","svelte-g2cagw"),this.first=s},m(x,w){Be(x,s,w),o&&o.m(s,null),we(s,c),u=!0},p(x,w){n=x,m&&m.p&&(!u||w&16418)&&_l(m,d,n,n[14],u?vl(d,n[14],w,Nb):yl(n[14]),ym)},i(x){u||(Le(o,x),u=!0)},o(x){Ze(o,x),u=!1},d(x){x&&G(s),o&&o.d(x)}}}function Gb(i){let n,s,c=[],u=new Map,d,m,o,x,w=i[5];const I=k=>k[23].index;for(let k=0;k<w.length;k+=1){let E=_m(i,w,k),B=I(E);u.set(B,c[k]=vm(B,E))}return{c(){n=it("svelte-virtual-list-viewport"),s=it("svelte-virtual-list-contents");for(let k=0;k<c.length;k+=1)c[k].c();this.h()},l(k){n=nt(k,"SVELTE-VIRTUAL-LIST-VIEWPORT",{style:!0,class:!0});var E=be(n);s=nt(E,"SVELTE-VIRTUAL-LIST-CONTENTS",{style:!0,class:!0});var B=be(s);for(let K=0;K<c.length;K+=1)c[K].l(B);B.forEach(G),E.forEach(G),this.h()},h(){ii(s,"padding-top",i[6]+"px"),ii(s,"padding-bottom",i[7]+"px"),nh(s,"class","svelte-g2cagw"),ii(n,"height",i[0]),nh(n,"class","svelte-g2cagw"),ao(()=>i[18].call(n))},m(k,E){Be(k,n,E),we(n,s);for(let B=0;B<c.length;B+=1)c[B]&&c[B].m(s,null);i[16](s),i[17](n),d=bl(n,i[18].bind(n)),m=!0,o||(x=Gi(n,"scroll",i[8]),o=!0)},p(k,[E]){E&16418&&(w=k[5],wi(),c=a1(c,E,I,1,k,w,u,s,o1,vm,null,_m),Ii()),(!m||E&64)&&ii(s,"padding-top",k[6]+"px"),(!m||E&128)&&ii(s,"padding-bottom",k[7]+"px"),(!m||E&1)&&ii(n,"height",k[0])},i(k){if(!m){for(let E=0;E<w.length;E+=1)Le(c[E]);m=!0}},o(k){for(let E=0;E<c.length;E+=1)Ze(c[E]);m=!1},d(k){k&&G(n);for(let E=0;E<c.length;E+=1)c[E].d();i[16](null),i[17](null),d(),o=!1,x()}}}function qb(i,n,s){let{$$slots:c={},$$scope:u}=n,{items:d=void 0}=n,{height:m="100%"}=n,{itemHeight:o=40}=n,{hoverItemIndex:x=0}=n,{start:w=0}=n,{end:I=0}=n,k=[],E,B,K,U=0,X,Q,Y=0,re=0,V;async function ne(pe,Ee,ve){const{scrollTop:ze}=B;await Pc();let De=Y-ze,j=w;for(;De<Ee&&j<pe.length;){let rt=E[j-w];rt||(s(10,I=j+1),await Pc(),rt=E[j-w]);const Ke=k[j]=ve||rt.offsetHeight;De+=Ke,j+=1}s(10,I=j);const ce=pe.length-I;V=(Y+De)/I,s(7,re=ce*V),k.length=pe.length,B&&s(3,B.scrollTop=0,B)}async function oe(){const{scrollTop:pe}=B,Ee=w;for(let j=0;j<E.length;j+=1)k[w+j]=o||E[j].offsetHeight;let ve=0,ze=0;for(;ve<d.length;){const j=k[ve]||V;if(ze+j>pe){s(9,w=ve),s(6,Y=ze);break}ze+=j,ve+=1}for(;ve<d.length&&(ze+=k[ve]||V,ve+=1,!(ze>pe+U)););s(10,I=ve);const De=d.length-I;for(V=ze/I;ve<d.length;)k[ve++]=V;if(s(7,re=De*V),w<Ee){await Pc();let j=0,ce=0;for(let Ke=w;Ke<Ee;Ke+=1)E[Ke-w]&&(j+=k[Ke],ce+=o||E[Ke-w].offsetHeight);const rt=ce-j;B.scrollTo(0,pe+rt)}}Gs(()=>{E=K.getElementsByTagName("svelte-virtual-list-row"),s(13,Q=!0)});function Ne(pe){Et[pe?"unshift":"push"](()=>{K=pe,s(4,K)})}function he(pe){Et[pe?"unshift":"push"](()=>{B=pe,s(3,B)})}function fe(){U=this.offsetHeight,s(2,U)}return i.$$set=pe=>{"items"in pe&&s(11,d=pe.items),"height"in pe&&s(0,m=pe.height),"itemHeight"in pe&&s(12,o=pe.itemHeight),"hoverItemIndex"in pe&&s(1,x=pe.hoverItemIndex),"start"in pe&&s(9,w=pe.start),"end"in pe&&s(10,I=pe.end),"$$scope"in pe&&s(14,u=pe.$$scope)},i.$$.update=()=>{i.$$.dirty&3584&&s(5,X=d.slice(w,I).map((pe,Ee)=>({index:Ee+w,data:pe}))),i.$$.dirty&14340&&Q&&ne(d,U,o)},[m,x,U,B,K,X,Y,re,oe,w,I,d,o,Q,u,c,Ne,he,fe]}class jb extends pi{constructor(n){super(),gi(this,n,qb,Gb,_i,{items:11,height:0,itemHeight:12,hoverItemIndex:1,start:9,end:10})}}function Zb(i){let n,s;return{c(){n=ft("svg"),s=ft("path"),this.h()},l(c){n=dt(c,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,role:!0});var u=be(n);s=dt(u,"path",{fill:!0,d:!0}),be(s).forEach(G),u.forEach(G),this.h()},h(){A(s,"fill","currentColor"),A(s,"d",`M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124
    l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z`),A(n,"width","100%"),A(n,"height","100%"),A(n,"viewBox","-2 -2 50 50"),A(n,"focusable","false"),A(n,"aria-hidden","true"),A(n,"role","presentation")},m(c,u){Be(c,n,u),we(n,s)},p:hi,i:hi,o:hi,d(c){c&&G(n)}}}class Xb extends pi{constructor(n){super(),gi(this,n,null,Zb,_i,{})}}function Wb(i,n,s){let c;return function(){let d=this,m=arguments,o=function(){c=null,s||i.apply(d,m)},x=s&&!c;clearTimeout(c),c=setTimeout(o,n),x&&i.apply(d,m)}}function bm(i,n,s){const c=i.slice();return c[103]=n[s],c}function xm(i){let n,s,c,u,d;return{c(){n=it("span"),s=fi(i[33]),c=Rt(),u=it("span"),d=fi(i[32]),this.h()},l(m){n=nt(m,"SPAN",{id:!0});var o=be(n);s=di(o,i[33]),o.forEach(G),c=Ft(m),u=nt(m,"SPAN",{id:!0});var x=be(u);d=di(x,i[32]),x.forEach(G),this.h()},h(){A(n,"id","aria-selection"),A(u,"id","aria-context")},m(m,o){Be(m,n,o),we(n,s),Be(m,c,o),Be(m,u,o),we(u,d)},p(m,o){o[1]&4&&zi(s,m[33]),o[1]&2&&zi(d,m[32])},d(m){m&&G(n),m&&G(c),m&&G(u)}}}function wm(i){let n,s,c;const u=[i[18]];var d=i[17];function m(o){let x={};for(let w=0;w<u.length;w+=1)x=gh(x,u[w]);return{props:x}}return d&&(n=Wn(d,m())),{c(){n&&Nt(n.$$.fragment),s=si()},l(o){n&&Kt(n.$$.fragment,o),s=si()},m(o,x){n&&Ut(n,o,x),Be(o,s,x),c=!0},p(o,x){const w=x[0]&262144?_h(u,[kp(o[18])]):{};if(x[0]&131072&&d!==(d=o[17])){if(n){wi();const I=n;Ze(I.$$.fragment,1,0,()=>{Gt(I,1)}),Ii()}d?(n=Wn(d,m()),Nt(n.$$.fragment),Le(n.$$.fragment,1),Ut(n,s.parentNode,s)):n=null}else d&&n.$set(w)},i(o){c||(n&&Le(n.$$.fragment,o),c=!0)},o(o){n&&Ze(n.$$.fragment,o),c=!1},d(o){o&&G(s),n&&Gt(n,o)}}}function Im(i){let n,s,c;var u=i[26];function d(m){return{props:{value:m[2],getSelectionLabel:m[12],activeValue:m[30],isDisabled:m[9],multiFullItemClearable:m[8]}}}return u&&(n=Wn(u,d(i)),n.$on("multiItemClear",i[38]),n.$on("focus",i[40])),{c(){n&&Nt(n.$$.fragment),s=si()},l(m){n&&Kt(n.$$.fragment,m),s=si()},m(m,o){n&&Ut(n,m,o),Be(m,s,o),c=!0},p(m,o){const x={};if(o[0]&4&&(x.value=m[2]),o[0]&4096&&(x.getSelectionLabel=m[12]),o[0]&1073741824&&(x.activeValue=m[30]),o[0]&512&&(x.isDisabled=m[9]),o[0]&256&&(x.multiFullItemClearable=m[8]),o[0]&67108864&&u!==(u=m[26])){if(n){wi();const w=n;Ze(w.$$.fragment,1,0,()=>{Gt(w,1)}),Ii()}u?(n=Wn(u,d(m)),n.$on("multiItemClear",m[38]),n.$on("focus",m[40]),Nt(n.$$.fragment),Le(n.$$.fragment,1),Ut(n,s.parentNode,s)):n=null}else u&&n.$set(x)},i(m){c||(n&&Le(n.$$.fragment,m),c=!0)},o(m){n&&Ze(n.$$.fragment,m),c=!1},d(m){m&&G(s),n&&Gt(n,m)}}}function km(i){let n,s,c,u,d;var m=i[25];function o(x){return{props:{item:x[2],getSelectionLabel:x[12]}}}return m&&(s=Wn(m,o(i))),{c(){n=it("div"),s&&Nt(s.$$.fragment),this.h()},l(x){n=nt(x,"DIV",{class:!0});var w=be(n);s&&Kt(s.$$.fragment,w),w.forEach(G),this.h()},h(){A(n,"class","selectedItem svelte-17l1npl")},m(x,w){Be(x,n,w),s&&Ut(s,n,null),c=!0,u||(d=Gi(n,"focus",i[40]),u=!0)},p(x,w){const I={};if(w[0]&4&&(I.item=x[2]),w[0]&4096&&(I.getSelectionLabel=x[12]),w[0]&33554432&&m!==(m=x[25])){if(s){wi();const k=s;Ze(k.$$.fragment,1,0,()=>{Gt(k,1)}),Ii()}m?(s=Wn(m,o(x)),Nt(s.$$.fragment),Le(s.$$.fragment,1),Ut(s,n,null)):s=null}else m&&s.$set(I)},i(x){c||(s&&Le(s.$$.fragment,x),c=!0)},o(x){s&&Ze(s.$$.fragment,x),c=!1},d(x){x&&G(n),s&&Gt(s),u=!1,d()}}}function Tm(i){let n,s,c,u,d;var m=i[23];function o(x){return{}}return m&&(s=Wn(m,o())),{c(){n=it("div"),s&&Nt(s.$$.fragment),this.h()},l(x){n=nt(x,"DIV",{class:!0,"aria-hidden":!0});var w=be(n);s&&Kt(s.$$.fragment,w),w.forEach(G),this.h()},h(){A(n,"class","clearSelect svelte-17l1npl"),A(n,"aria-hidden","true")},m(x,w){Be(x,n,w),s&&Ut(s,n,null),c=!0,u||(d=Gi(n,"click",l1(i[27])),u=!0)},p(x,w){if(w[0]&8388608&&m!==(m=x[23])){if(s){wi();const I=s;Ze(I.$$.fragment,1,0,()=>{Gt(I,1)}),Ii()}m?(s=Wn(m,o()),Nt(s.$$.fragment),Le(s.$$.fragment,1),Ut(s,n,null)):s=null}},i(x){c||(s&&Le(s.$$.fragment,x),c=!0)},o(x){s&&Ze(s.$$.fragment,x),c=!1},d(x){x&&G(n),s&&Gt(s),u=!1,d()}}}function Sm(i){let n;function s(d,m){return d[22]?Kb:Hb}let c=s(i),u=c(i);return{c(){n=it("div"),u.c(),this.h()},l(d){n=nt(d,"DIV",{class:!0,"aria-hidden":!0});var m=be(n);u.l(m),m.forEach(G),this.h()},h(){A(n,"class","indicator svelte-17l1npl"),A(n,"aria-hidden","true")},m(d,m){Be(d,n,m),u.m(n,null)},p(d,m){c===(c=s(d))&&u?u.p(d,m):(u.d(1),u=c(d),u&&(u.c(),u.m(n,null)))},d(d){d&&G(n),u.d()}}}function Hb(i){let n,s;return{c(){n=ft("svg"),s=ft("path"),this.h()},l(c){n=dt(c,"svg",{width:!0,height:!0,viewBox:!0,focusable:!0,"aria-hidden":!0,class:!0});var u=be(n);s=dt(u,"path",{d:!0}),be(s).forEach(G),u.forEach(G),this.h()},h(){A(s,"d",`M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747
          3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0
          1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502
          0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0
          0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z`),A(n,"width","100%"),A(n,"height","100%"),A(n,"viewBox","0 0 20 20"),A(n,"focusable","false"),A(n,"aria-hidden","true"),A(n,"class","svelte-17l1npl")},m(c,u){Be(c,n,u),we(n,s)},p:hi,d(c){c&&G(n)}}}function Kb(i){let n,s;return{c(){n=new c1(!1),s=si(),this.h()},l(c){n=u1(c,!1),s=si(),this.h()},h(){n.a=s},m(c,u){n.m(i[22],c,u),Be(c,s,u)},p(c,u){u[0]&4194304&&n.p(c[22])},d(c){c&&G(s),c&&n.d()}}}function Em(i){let n,s,c;return{c(){n=it("div"),s=ft("svg"),c=ft("circle"),this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);s=dt(d,"svg",{class:!0,viewBox:!0});var m=be(s);c=dt(m,"circle",{class:!0,cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-miterlimit":!0}),be(c).forEach(G),m.forEach(G),d.forEach(G),this.h()},h(){A(c,"class","spinner_path svelte-17l1npl"),A(c,"cx","50"),A(c,"cy","50"),A(c,"r","20"),A(c,"fill","none"),A(c,"stroke","currentColor"),A(c,"stroke-width","5"),A(c,"stroke-miterlimit","10"),A(s,"class","spinner_icon svelte-17l1npl"),A(s,"viewBox","25 25 50 50"),A(n,"class","spinner svelte-17l1npl")},m(u,d){Be(u,n,d),we(n,s),we(s,c)},d(u){u&&G(n)}}}function Am(i){let n,s,c,u;const d=[i[34]];function m(w){i[84](w)}var o=i[24];function x(w){let I={};for(let k=0;k<d.length;k+=1)I=gh(I,d[k]);return w[28]!==void 0&&(I.hoverItemIndex=w[28]),{props:I}}return o&&(n=Wn(o,x(i)),Et.push(()=>Bt(n,"hoverItemIndex",m)),n.$on("itemSelected",i[43]),n.$on("itemCreated",i[44]),n.$on("closeList",i[45])),{c(){n&&Nt(n.$$.fragment),c=si()},l(w){n&&Kt(n.$$.fragment,w),c=si()},m(w,I){n&&Ut(n,w,I),Be(w,c,I),u=!0},p(w,I){const k=I[1]&8?_h(d,[kp(w[34])]):{};if(!s&&I[0]&268435456&&(s=!0,k.hoverItemIndex=w[28],Ot(()=>s=!1)),I[0]&16777216&&o!==(o=w[24])){if(n){wi();const E=n;Ze(E.$$.fragment,1,0,()=>{Gt(E,1)}),Ii()}o?(n=Wn(o,x(w)),Et.push(()=>Bt(n,"hoverItemIndex",m)),n.$on("itemSelected",w[43]),n.$on("itemCreated",w[44]),n.$on("closeList",w[45]),Nt(n.$$.fragment),Le(n.$$.fragment,1),Ut(n,c.parentNode,c)):n=null}else o&&n.$set(k)},i(w){u||(n&&Le(n.$$.fragment,w),u=!0)},o(w){n&&Ze(n.$$.fragment,w),u=!1},d(w){w&&G(c),n&&Gt(n,w)}}}function Cm(i){let n,s,c;return{c(){n=it("input"),this.h()},l(u){n=nt(u,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){A(n,"name",s=i[16].name),A(n,"type","hidden"),n.value=c=i[2]?i[12](i[2]):null,A(n,"class","svelte-17l1npl")},m(u,d){Be(u,n,d)},p(u,d){d[0]&65536&&s!==(s=u[16].name)&&A(n,"name",s),d[0]&4100&&c!==(c=u[2]?u[12](u[2]):null)&&(n.value=c)},d(u){u&&G(n)}}}function Mm(i){let n,s=i[2],c=[];for(let u=0;u<s.length;u+=1)c[u]=zm(bm(i,s,u));return{c(){for(let u=0;u<c.length;u+=1)c[u].c();n=si()},l(u){for(let d=0;d<c.length;d+=1)c[d].l(u);n=si()},m(u,d){for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(u,d);Be(u,n,d)},p(u,d){if(d[0]&69636){s=u[2];let m;for(m=0;m<s.length;m+=1){const o=bm(u,s,m);c[m]?c[m].p(o,d):(c[m]=zm(o),c[m].c(),c[m].m(n.parentNode,n))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},d(u){$i(c,u),u&&G(n)}}}function zm(i){let n,s,c;return{c(){n=it("input"),this.h()},l(u){n=nt(u,"INPUT",{name:!0,type:!0,class:!0}),this.h()},h(){A(n,"name",s=i[16].name),A(n,"type","hidden"),n.value=c=i[103]?i[12](i[103]):null,A(n,"class","svelte-17l1npl")},m(u,d){Be(u,n,d)},p(u,d){d[0]&65536&&s!==(s=u[16].name)&&A(n,"name",s),d[0]&4100&&c!==(c=u[103]?u[12](u[103]):null)&&(n.value=c)},d(u){u&&G(n)}}}function Yb(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y,re=i[1]&&xm(i),V=i[17]&&wm(i),ne=i[35]&&Im(i),oe=[{readOnly:o=!i[13]},i[31],{placeholder:i[36]},{style:i[14]},{disabled:i[9]}],Ne={};for(let j=0;j<oe.length;j+=1)Ne=gh(Ne,oe[j]);let he=!i[7]&&i[29]&&km(i),fe=i[37]&&Tm(i),pe=!i[37]&&(i[20]||i[19]&&!i[2]||!i[13]&&!i[9]&&!i[4]&&(i[29]&&!i[15]||!i[29]))&&Sm(i),Ee=i[4]&&Em(),ve=i[5]&&Am(i),ze=(!i[7]||i[7]&&!i[35])&&Cm(i),De=i[7]&&i[35]&&Mm(i);return{c(){n=it("div"),s=it("span"),re&&re.c(),c=Rt(),V&&V.c(),u=Rt(),ne&&ne.c(),d=Rt(),m=it("input"),x=Rt(),he&&he.c(),w=Rt(),fe&&fe.c(),I=Rt(),pe&&pe.c(),k=Rt(),Ee&&Ee.c(),E=Rt(),ve&&ve.c(),B=Rt(),ze&&ze.c(),K=Rt(),De&&De.c(),this.h()},l(j){n=nt(j,"DIV",{class:!0,style:!0});var ce=be(n);s=nt(ce,"SPAN",{"aria-live":!0,"aria-atomic":!0,"aria-relevant":!0,class:!0});var rt=be(s);re&&re.l(rt),rt.forEach(G),c=Ft(ce),V&&V.l(ce),u=Ft(ce),ne&&ne.l(ce),d=Ft(ce),m=nt(ce,"INPUT",{placeholder:!0,style:!0}),x=Ft(ce),he&&he.l(ce),w=Ft(ce),fe&&fe.l(ce),I=Ft(ce),pe&&pe.l(ce),k=Ft(ce),Ee&&Ee.l(ce),E=Ft(ce),ve&&ve.l(ce),B=Ft(ce),ze&&ze.l(ce),K=Ft(ce),De&&De.l(ce),ce.forEach(G),this.h()},h(){A(s,"aria-live","polite"),A(s,"aria-atomic","false"),A(s,"aria-relevant","additions text"),A(s,"class","a11yText svelte-17l1npl"),Jf(m,Ne),Ln(m,"svelte-17l1npl",!0),A(n,"class",U="selectContainer "+i[21]+" svelte-17l1npl"),A(n,"style",i[11]),Ln(n,"hasError",i[10]),Ln(n,"multiSelect",i[7]),Ln(n,"disabled",i[9]),Ln(n,"focused",i[1])},m(j,ce){Be(j,n,ce),we(n,s),re&&re.m(s,null),we(n,c),V&&V.m(n,null),we(n,u),ne&&ne.m(n,null),we(n,d),we(n,m),m.autofocus&&m.focus(),i[82](m),Qf(m,i[3]),we(n,x),he&&he.m(n,null),we(n,w),fe&&fe.m(n,null),we(n,I),pe&&pe.m(n,null),we(n,k),Ee&&Ee.m(n,null),we(n,E),ve&&ve.m(n,null),we(n,B),ze&&ze.m(n,null),we(n,K),De&&De.m(n,null),i[85](n),X=!0,Q||(Y=[Gi(window,"click",i[41]),Gi(window,"focusin",i[41]),Gi(window,"keydown",i[39]),Gi(m,"focus",i[40]),Gi(m,"input",i[83]),Gi(n,"click",i[42])],Q=!0)},p(j,ce){j[1]?re?re.p(j,ce):(re=xm(j),re.c(),re.m(s,null)):re&&(re.d(1),re=null),j[17]?V?(V.p(j,ce),ce[0]&131072&&Le(V,1)):(V=wm(j),V.c(),Le(V,1),V.m(n,u)):V&&(wi(),Ze(V,1,1,()=>{V=null}),Ii()),j[35]?ne?(ne.p(j,ce),ce[1]&16&&Le(ne,1)):(ne=Im(j),ne.c(),Le(ne,1),ne.m(n,d)):ne&&(wi(),Ze(ne,1,1,()=>{ne=null}),Ii()),Jf(m,Ne=_h(oe,[(!X||ce[0]&8192&&o!==(o=!j[13]))&&{readOnly:o},ce[1]&1&&j[31],(!X||ce[1]&32)&&{placeholder:j[36]},(!X||ce[0]&16384)&&{style:j[14]},(!X||ce[0]&512)&&{disabled:j[9]}])),ce[0]&8&&m.value!==j[3]&&Qf(m,j[3]),Ln(m,"svelte-17l1npl",!0),!j[7]&&j[29]?he?(he.p(j,ce),ce[0]&536871040&&Le(he,1)):(he=km(j),he.c(),Le(he,1),he.m(n,w)):he&&(wi(),Ze(he,1,1,()=>{he=null}),Ii()),j[37]?fe?(fe.p(j,ce),ce[1]&64&&Le(fe,1)):(fe=Tm(j),fe.c(),Le(fe,1),fe.m(n,I)):fe&&(wi(),Ze(fe,1,1,()=>{fe=null}),Ii()),!j[37]&&(j[20]||j[19]&&!j[2]||!j[13]&&!j[9]&&!j[4]&&(j[29]&&!j[15]||!j[29]))?pe?pe.p(j,ce):(pe=Sm(j),pe.c(),pe.m(n,k)):pe&&(pe.d(1),pe=null),j[4]?Ee||(Ee=Em(),Ee.c(),Ee.m(n,E)):Ee&&(Ee.d(1),Ee=null),j[5]?ve?(ve.p(j,ce),ce[0]&32&&Le(ve,1)):(ve=Am(j),ve.c(),Le(ve,1),ve.m(n,B)):ve&&(wi(),Ze(ve,1,1,()=>{ve=null}),Ii()),!j[7]||j[7]&&!j[35]?ze?ze.p(j,ce):(ze=Cm(j),ze.c(),ze.m(n,K)):ze&&(ze.d(1),ze=null),j[7]&&j[35]?De?De.p(j,ce):(De=Mm(j),De.c(),De.m(n,null)):De&&(De.d(1),De=null),(!X||ce[0]&2097152&&U!==(U="selectContainer "+j[21]+" svelte-17l1npl"))&&A(n,"class",U),(!X||ce[0]&2048)&&A(n,"style",j[11]),(!X||ce[0]&2098176)&&Ln(n,"hasError",j[10]),(!X||ce[0]&2097280)&&Ln(n,"multiSelect",j[7]),(!X||ce[0]&2097664)&&Ln(n,"disabled",j[9]),(!X||ce[0]&2097154)&&Ln(n,"focused",j[1])},i(j){X||(Le(V),Le(ne),Le(he),Le(fe),Le(ve),X=!0)},o(j){Ze(V),Ze(ne),Ze(he),Ze(fe),Ze(ve),X=!1},d(j){j&&G(n),re&&re.d(),V&&V.d(),ne&&ne.d(),i[82](null),he&&he.d(),fe&&fe.d(),pe&&pe.d(),Ee&&Ee.d(),ve&&ve.d(),ze&&ze.d(),De&&De.d(),i[85](null),Q=!1,wa(Y)}}}function Dm(i){return i.map((n,s)=>({index:s,value:n,label:`${n}`}))}function Jb(i,n,s){let c,u,d,m,o,x,w,I;const k=oo();let{id:E=null}=n,{container:B=void 0}=n,{input:K=void 0}=n,{isMulti:U=!1}=n,{multiFullItemClearable:X=!1}=n,{isDisabled:Q=!1}=n,{isCreatable:Y=!1}=n,{isFocused:re=!1}=n,{value:V=null}=n,{filterText:ne=""}=n,{placeholder:oe="Select..."}=n,{placeholderAlwaysShow:Ne=!1}=n,{items:he=null}=n,{itemFilter:fe=(ie,mt,At)=>`${ie}`.toLowerCase().includes(mt.toLowerCase())}=n,{groupBy:pe=void 0}=n,{groupFilter:Ee=ie=>ie}=n,{isGroupHeaderSelectable:ve=!1}=n,{getGroupHeaderLabel:ze=ie=>ie[De]||ie.id}=n,{labelIdentifier:De="label"}=n,{getOptionLabel:j=(ie,mt)=>ie.isCreator?`Create "${mt}"`:ie[De]}=n,{optionIdentifier:ce="value"}=n,{loadOptions:rt=void 0}=n,{hasError:Ke=!1}=n,{containerStyles:qe=""}=n,{getSelectionLabel:Qe=ie=>ie?ie[De]:null}=n,{createGroupHeaderItem:Ie=ie=>({value:ie,label:ie})}=n,{createItem:lt=ie=>({value:ie,label:ie})}=n;const ot=()=>c;let{isSearchable:vt=!0}=n,{inputStyles:gt=""}=n,{isClearable:We=!0}=n,{isWaiting:yt=!1}=n,{listPlacement:ue="auto"}=n,{listOpen:ke=!1}=n,{isVirtualList:Fe=!1}=n,{loadOptionsInterval:bt=300}=n,{noOptionsMessage:mi="No options"}=n,{hideEmptyState:et=!1}=n,{inputAttributes:ht={}}=n,{listAutoWidth:li=!0}=n,{itemHeight:nn=40}=n,{Icon:ei=void 0}=n,{iconProps:on={}}=n,{showChevron:tt=!1}=n,{showIndicator:ct=!1}=n,{containerClasses:en=""}=n,{indicatorSvg:An=void 0}=n,{listOffset:Dr=5}=n,{ClearIcon:sr=Xb}=n,{Item:Hn=Yp}=n,{List:Pr=Pb}=n,{Selection:ar=Rb}=n,{MultiSelection:Ye=Vb}=n,{VirtualList:It=jb}=n;function Lr(ie){if(ie.loadOptions&&ie.filterText.length>0)return;if(!ie.items)return[];ie.items&&ie.items.length>0&&typeof ie.items[0]!="object"&&(ie.items=Dm(ie.items));let mt=ie.items.filter(At=>{let oi=fe(j(At,ie.filterText),ie.filterText,At);return oi&&ie.isMulti&&ie.value&&Array.isArray(ie.value)&&(oi=!ie.value.some(Qt=>Qt[ie.optionIdentifier]===At[ie.optionIdentifier])),oi});return ie.groupBy&&(mt=dr(mt)),ie.isCreatable&&(mt=Un(mt,ie.filterText)),mt}function Un(ie,mt){if(mt.length===0)return ie;const At=lt(mt);return ie[0]&&mt===ie[0][De]?ie:(At.isCreator=!0,[...ie,At])}let{selectedValue:ki=null}=n,Ei,cn,kn,or,xt,ci;const ai=Wb(async()=>{s(4,yt=!0);let ie=await rt(ne).catch(mt=>{console.warn("svelte-select loadOptions error :>> ",mt),k("error",{type:"loadOptions",details:mt})});ie&&!ie.cancelled&&(ie?(ie&&ie.length>0&&typeof ie[0]!="object"&&(ie=Dm(ie)),s(81,c=[...ie]),k("loaded",{items:c})):s(81,c=[]),Y&&s(81,c=Un(c,ne)),s(4,yt=!1),s(1,re=!0),s(5,ke=!0))},bt);function mn(){typeof V=="string"?s(2,V={[ce]:V,label:V}):U&&Array.isArray(V)&&V.length>0&&s(2,V=V.map(ie=>typeof ie=="string"?{value:ie,label:ie}:ie))}let Bn;function ri(){s(31,Bn=Object.assign({autocapitalize:"none",autocomplete:"off",autocorrect:"off",spellcheck:!1,tabindex:0,type:"text","aria-autocomplete":"list"},ht)),E&&s(31,Bn.id=E,Bn),vt||s(31,Bn.readonly=!0,Bn)}function dr(ie){const mt=[],At={};ie.forEach(Qt=>{const ti=pe(Qt);mt.includes(ti)||(mt.push(ti),At[ti]=[],ti&&At[ti].push(Object.assign(Ie(ti,Qt),{id:ti,isGroupHeader:!0,isSelectable:ve}))),At[ti].push(Object.assign({isGroupItem:!!ti},Qt))});const oi=[];return Ee(mt).forEach(Qt=>{oi.push(...At[Qt])}),oi}function un(){if(U){JSON.stringify(V)!==JSON.stringify(cn)&&Br()&&k("select",V);return}(!cn||JSON.stringify(V[ce])!==JSON.stringify(cn[ce]))&&k("select",V)}function Kr(){re||ke?mr():K&&K.blur()}function rn(){V&&(Array.isArray(V)?s(2,V=[...V]):s(2,V=[V]))}function Tn(){V&&s(2,V=null)}function Li(){ne.length!==0&&(s(1,re=!0),s(5,ke=!0),rt?ai():(s(5,ke=!0),U&&s(30,Ei=void 0)))}Ip(async()=>{s(77,cn=V),s(78,kn=ne),s(79,or=re),s(80,xt=U)});function Br(){let ie=!0;if(V){const mt=[],At=[];V.forEach(oi=>{mt.includes(oi[ce])?ie=!1:(mt.push(oi[ce]),At.push(oi))}),ie||s(2,V=At)}return ie}function Kn(ie){let mt=ie?ie[ce]:V[ce];return he.find(At=>At[ce]===mt)}function Rr(ie){!ie||ie.length===0||ie.some(mt=>typeof mt!="object")||!V||(U?V.some(mt=>!mt||!mt[ce]):!V[ce])||(Array.isArray(V)?s(2,V=V.map(mt=>Kn(mt)||mt)):s(2,V=Kn()||V))}function kr(ie){const{detail:mt}=ie,At=V[mt?mt.i:V.length-1];V.length===1?s(2,V=void 0):s(2,V=V.filter(oi=>oi!==At)),k("clear",At)}function Yr(ie){if(re)switch(ie.key){case"ArrowDown":ie.preventDefault(),s(5,ke=!0),s(30,Ei=void 0);break;case"ArrowUp":ie.preventDefault(),s(5,ke=!0),s(30,Ei=void 0);break;case"Tab":ke||s(1,re=!1);break;case"Backspace":if(!U||ne.length>0)return;if(U&&V&&V.length>0){if(kr(Ei!==void 0?Ei:V.length-1),Ei===0||Ei===void 0)break;s(30,Ei=V.length>Ei?Ei-1:void 0)}break;case"ArrowLeft":if(!U||ne.length>0)return;Ei===void 0?s(30,Ei=V.length-1):V.length>Ei&&Ei!==0&&s(30,Ei-=1);break;case"ArrowRight":if(!U||ne.length>0||Ei===void 0)return;Ei===V.length-1?s(30,Ei=void 0):Ei<V.length-1&&s(30,Ei+=1);break}}function mr(){s(1,re=!0),K&&K.focus()}function te(ie){if(!B)return;const mt=ie.path&&ie.path.length>0?ie.path[0]:ie.target;B.contains(mt)||B.contains(ie.relatedTarget)||(s(1,re=!1),s(5,ke=!1),s(30,Ei=void 0),K&&K.blur())}function L(){Q||(s(1,re=!0),s(5,ke=!ke))}function N(){s(2,V=void 0),s(5,ke=!1),k("clear",V),mr()}Gs(()=>{re&&K&&K.focus()});function $(ie){const{detail:mt}=ie;if(mt){s(3,ne="");const At=Object.assign({},mt);(!At.isGroupHeader||At.isSelectable)&&(U?s(2,V=V?V.concat([At]):[At]):s(2,V=At),s(2,V),setTimeout(()=>{s(5,ke=!1),s(30,Ei=void 0)}))}}function ee(ie){const{detail:mt}=ie;U?(s(2,V=V||[]),s(2,V=[...V,lt(mt)])):s(2,V=lt(mt)),k("itemCreated",mt),s(3,ne=""),s(5,ke=!1),s(30,Ei=void 0)}function ye(){s(3,ne=""),s(5,ke=!1)}let{ariaValues:Se=ie=>`Option ${ie}, selected.`}=n,{ariaListOpen:xe=(ie,mt)=>`You are currently focused on option ${ie}. There are ${mt} results available.`}=n,{ariaFocused:_e=()=>"Select is focused, type to refine list, press down to open the menu."}=n;function Ae(){let ie;return U&&V.length>0?ie=V.map(mt=>Qe(mt)).join(", "):ie=Qe(V),Se(ie)}function Xe(){if(!re||!c||c.length===0)return"";let ie=c[ci];if(ke&&ie){let mt=Qe(ie),At=c?c.length:0;return xe(mt,At)}else return _e()}function ut(ie){Et[ie?"unshift":"push"](()=>{K=ie,s(6,K)})}function je(){ne=this.value,s(3,ne)}function qt(ie){ci=ie,s(28,ci)}function jt(ie){Et[ie?"unshift":"push"](()=>{B=ie,s(0,B)})}return i.$$set=ie=>{"id"in ie&&s(46,E=ie.id),"container"in ie&&s(0,B=ie.container),"input"in ie&&s(6,K=ie.input),"isMulti"in ie&&s(7,U=ie.isMulti),"multiFullItemClearable"in ie&&s(8,X=ie.multiFullItemClearable),"isDisabled"in ie&&s(9,Q=ie.isDisabled),"isCreatable"in ie&&s(47,Y=ie.isCreatable),"isFocused"in ie&&s(1,re=ie.isFocused),"value"in ie&&s(2,V=ie.value),"filterText"in ie&&s(3,ne=ie.filterText),"placeholder"in ie&&s(48,oe=ie.placeholder),"placeholderAlwaysShow"in ie&&s(49,Ne=ie.placeholderAlwaysShow),"items"in ie&&s(50,he=ie.items),"itemFilter"in ie&&s(51,fe=ie.itemFilter),"groupBy"in ie&&s(52,pe=ie.groupBy),"groupFilter"in ie&&s(53,Ee=ie.groupFilter),"isGroupHeaderSelectable"in ie&&s(54,ve=ie.isGroupHeaderSelectable),"getGroupHeaderLabel"in ie&&s(55,ze=ie.getGroupHeaderLabel),"labelIdentifier"in ie&&s(56,De=ie.labelIdentifier),"getOptionLabel"in ie&&s(57,j=ie.getOptionLabel),"optionIdentifier"in ie&&s(58,ce=ie.optionIdentifier),"loadOptions"in ie&&s(59,rt=ie.loadOptions),"hasError"in ie&&s(10,Ke=ie.hasError),"containerStyles"in ie&&s(11,qe=ie.containerStyles),"getSelectionLabel"in ie&&s(12,Qe=ie.getSelectionLabel),"createGroupHeaderItem"in ie&&s(60,Ie=ie.createGroupHeaderItem),"createItem"in ie&&s(61,lt=ie.createItem),"isSearchable"in ie&&s(13,vt=ie.isSearchable),"inputStyles"in ie&&s(14,gt=ie.inputStyles),"isClearable"in ie&&s(15,We=ie.isClearable),"isWaiting"in ie&&s(4,yt=ie.isWaiting),"listPlacement"in ie&&s(63,ue=ie.listPlacement),"listOpen"in ie&&s(5,ke=ie.listOpen),"isVirtualList"in ie&&s(64,Fe=ie.isVirtualList),"loadOptionsInterval"in ie&&s(65,bt=ie.loadOptionsInterval),"noOptionsMessage"in ie&&s(66,mi=ie.noOptionsMessage),"hideEmptyState"in ie&&s(67,et=ie.hideEmptyState),"inputAttributes"in ie&&s(16,ht=ie.inputAttributes),"listAutoWidth"in ie&&s(68,li=ie.listAutoWidth),"itemHeight"in ie&&s(69,nn=ie.itemHeight),"Icon"in ie&&s(17,ei=ie.Icon),"iconProps"in ie&&s(18,on=ie.iconProps),"showChevron"in ie&&s(19,tt=ie.showChevron),"showIndicator"in ie&&s(20,ct=ie.showIndicator),"containerClasses"in ie&&s(21,en=ie.containerClasses),"indicatorSvg"in ie&&s(22,An=ie.indicatorSvg),"listOffset"in ie&&s(70,Dr=ie.listOffset),"ClearIcon"in ie&&s(23,sr=ie.ClearIcon),"Item"in ie&&s(71,Hn=ie.Item),"List"in ie&&s(24,Pr=ie.List),"Selection"in ie&&s(25,ar=ie.Selection),"MultiSelection"in ie&&s(26,Ye=ie.MultiSelection),"VirtualList"in ie&&s(72,It=ie.VirtualList),"selectedValue"in ie&&s(73,ki=ie.selectedValue),"ariaValues"in ie&&s(74,Se=ie.ariaValues),"ariaListOpen"in ie&&s(75,xe=ie.ariaListOpen),"ariaFocused"in ie&&s(76,_e=ie.ariaFocused)},i.$$.update=()=>{i.$$.dirty[0]&140|i.$$.dirty[1]&405340160&&s(81,c=Lr({loadOptions:rt,filterText:ne,items:he,value:V,isMulti:U,optionIdentifier:ce,groupBy:pe,isCreatable:Y})),i.$$.dirty[2]&2048&&ki&&console.warn("selectedValue is no longer used. Please use value instead."),i.$$.dirty[1]&524288&&Rr(he),i.$$.dirty[0]&4&&V&&mn(),i.$$.dirty[0]&73728&&(ht||!vt)&&ri(),i.$$.dirty[0]&128|i.$$.dirty[2]&262144&&(U&&rn(),xt&&!U&&Tn()),i.$$.dirty[0]&132&&U&&V&&V.length>1&&Br(),i.$$.dirty[0]&4&&V&&un(),i.$$.dirty[0]&132|i.$$.dirty[2]&32768&&!V&&U&&cn&&k("select",V),i.$$.dirty[0]&2|i.$$.dirty[2]&131072&&re!==or&&Kr(),i.$$.dirty[0]&8|i.$$.dirty[2]&65536&&ne!==kn&&Li(),i.$$.dirty[0]&12&&s(29,u=V&&ne.length===0),i.$$.dirty[0]&536904208&&s(37,d=u&&We&&!Q&&!yt),i.$$.dirty[0]&132|i.$$.dirty[1]&393216&&s(36,m=Ne&&U?oe:V?"":oe),i.$$.dirty[0]&132&&s(35,o=U&&V&&V.length>0),i.$$.dirty[0]&141|i.$$.dirty[1]&218103808|i.$$.dirty[2]&526326&&s(34,x={Item:Hn,filterText:ne,optionIdentifier:ce,noOptionsMessage:mi,hideEmptyState:et,isVirtualList:Fe,VirtualList:It,value:V,isMulti:U,getGroupHeaderLabel:ze,items:c,itemHeight:nn,getOptionLabel:j,listPlacement:ue,parent:B,listAutoWidth:li,listOffset:Dr}),i.$$.dirty[0]&132&&s(33,w=V?Ae():""),i.$$.dirty[0]&268435490|i.$$.dirty[2]&524288&&s(32,I=Xe())},[B,re,V,ne,yt,ke,K,U,X,Q,Ke,qe,Qe,vt,gt,We,ht,ei,on,tt,ct,en,An,sr,Pr,ar,Ye,N,ci,u,Ei,Bn,I,w,x,o,m,d,kr,Yr,mr,te,L,$,ee,ye,E,Y,oe,Ne,he,fe,pe,Ee,ve,ze,De,j,ce,rt,Ie,lt,ot,ue,Fe,bt,mi,et,li,nn,Dr,Hn,It,ki,Se,xe,_e,cn,kn,or,xt,c,ut,je,qt,jt]}class Qb extends pi{constructor(n){super(),gi(this,n,Jb,Yb,_i,{id:46,container:0,input:6,isMulti:7,multiFullItemClearable:8,isDisabled:9,isCreatable:47,isFocused:1,value:2,filterText:3,placeholder:48,placeholderAlwaysShow:49,items:50,itemFilter:51,groupBy:52,groupFilter:53,isGroupHeaderSelectable:54,getGroupHeaderLabel:55,labelIdentifier:56,getOptionLabel:57,optionIdentifier:58,loadOptions:59,hasError:10,containerStyles:11,getSelectionLabel:12,createGroupHeaderItem:60,createItem:61,getFilteredItems:62,isSearchable:13,inputStyles:14,isClearable:15,isWaiting:4,listPlacement:63,listOpen:5,isVirtualList:64,loadOptionsInterval:65,noOptionsMessage:66,hideEmptyState:67,inputAttributes:16,listAutoWidth:68,itemHeight:69,Icon:17,iconProps:18,showChevron:19,showIndicator:20,containerClasses:21,indicatorSvg:22,listOffset:70,ClearIcon:23,Item:71,List:24,Selection:25,MultiSelection:26,VirtualList:72,selectedValue:73,handleClear:27,ariaValues:74,ariaListOpen:75,ariaFocused:76},null,[-1,-1,-1,-1])}get getFilteredItems(){return this.$$.ctx[62]}get handleClear(){return this.$$.ctx[27]}}function $b(i){let n,s,c,u,d,m,o,x,w;function I(Q){i[39](Q)}function k(Q){i[40](Q)}function E(Q){i[41](Q)}function B(Q){i[42](Q)}function K(Q){i[43](Q)}function U(Q){i[44](Q)}let X={id:i[2],container:i[3],items:i[4],placeholder:i[5],isMulti:i[10],isSearchable:i[6],groupBy:i[22],loadOptions:i[9],getSelectionLabel:i[12],getOptionLabel:i[21],itemFilter:i[19],ariaValues:i[25],ariaListOpen:i[26],ariaFocused:i[27],noOptionsMessage:i[20],indicatorSvg:i[23],containerStyles:i[24],optionIdentifier:i[8],showIndicator:!0,isClearable:i[7]?!i[10]:!1};return i[15]!==void 0&&(X.isFocused=i[15]),i[0]!==void 0&&(X.value=i[0]),i[16]!==void 0&&(X.listOpen=i[16]),i[1]!==void 0&&(X.filterText=i[1]),i[13]!==void 0&&(X.isWaiting=i[13]),i[17]!==void 0&&(X.handleClear=i[17]),s=new Qb({props:X}),Et.push(()=>Bt(s,"isFocused",I)),Et.push(()=>Bt(s,"value",k)),Et.push(()=>Bt(s,"listOpen",E)),Et.push(()=>Bt(s,"filterText",B)),Et.push(()=>Bt(s,"isWaiting",K)),Et.push(()=>Bt(s,"handleClear",U)),s.$on("select",i[28]),s.$on("clear",i[45]),s.$on("loaded",i[46]),s.$on("error",i[47]),{c(){n=it("div"),Nt(s.$$.fragment),this.h()},l(Q){n=nt(Q,"DIV",{class:!0});var Y=be(n);Kt(s.$$.fragment,Y),Y.forEach(G),this.h()},h(){A(n,"class","selectbox svelte-gskmgd"),Ln(n,"multi-selected",i[0]&&i[10]),Ln(n,"focused",i[15]),Ln(n,"selected",i[0]&&!i[16]&&!i[10]),ii(n,"--borderColor",i[11]),ii(n,"--firstItem",i[18](0)),ii(n,"--secondItem",i[18](1)),ii(n,"--thirdItem",i[18](2)),ii(n,"--fourthItem",i[18](3)),ii(n,"--fifthItem",i[18](4)),ii(n,"--sixthItem",i[18](5)),ii(n,"--seventhItem",i[18](6)),ii(n,"--eighthItem",i[18](7)),ii(n,"--ninethItem",i[18](8)),ii(n,"--tenthItem",i[18](9))},m(Q,Y){Be(Q,n,Y),Ut(s,n,null),i[48](n),w=!0},p(Q,Y){const re={};Y[0]&4&&(re.id=Q[2]),Y[0]&8&&(re.container=Q[3]),Y[0]&16&&(re.items=Q[4]),Y[0]&32&&(re.placeholder=Q[5]),Y[0]&1024&&(re.isMulti=Q[10]),Y[0]&64&&(re.isSearchable=Q[6]),Y[0]&512&&(re.loadOptions=Q[9]),Y[0]&4096&&(re.getSelectionLabel=Q[12]),Y[0]&524288&&(re.itemFilter=Q[19]),Y[0]&1048576&&(re.noOptionsMessage=Q[20]),Y[0]&256&&(re.optionIdentifier=Q[8]),Y[0]&1152&&(re.isClearable=Q[7]?!Q[10]:!1),!c&&Y[0]&32768&&(c=!0,re.isFocused=Q[15],Ot(()=>c=!1)),!u&&Y[0]&1&&(u=!0,re.value=Q[0],Ot(()=>u=!1)),!d&&Y[0]&65536&&(d=!0,re.listOpen=Q[16],Ot(()=>d=!1)),!m&&Y[0]&2&&(m=!0,re.filterText=Q[1],Ot(()=>m=!1)),!o&&Y[0]&8192&&(o=!0,re.isWaiting=Q[13],Ot(()=>o=!1)),!x&&Y[0]&131072&&(x=!0,re.handleClear=Q[17],Ot(()=>x=!1)),s.$set(re),(!w||Y[0]&1025)&&Ln(n,"multi-selected",Q[0]&&Q[10]),(!w||Y[0]&32768)&&Ln(n,"focused",Q[15]),(!w||Y[0]&66561)&&Ln(n,"selected",Q[0]&&!Q[16]&&!Q[10]),Y[0]&2048&&ii(n,"--borderColor",Q[11]),Y[0]&262144&&ii(n,"--firstItem",Q[18](0)),Y[0]&262144&&ii(n,"--secondItem",Q[18](1)),Y[0]&262144&&ii(n,"--thirdItem",Q[18](2)),Y[0]&262144&&ii(n,"--fourthItem",Q[18](3)),Y[0]&262144&&ii(n,"--fifthItem",Q[18](4)),Y[0]&262144&&ii(n,"--sixthItem",Q[18](5)),Y[0]&262144&&ii(n,"--seventhItem",Q[18](6)),Y[0]&262144&&ii(n,"--eighthItem",Q[18](7)),Y[0]&262144&&ii(n,"--ninethItem",Q[18](8)),Y[0]&262144&&ii(n,"--tenthItem",Q[18](9))},i(Q){w||(Le(s.$$.fragment,Q),w=!0)},o(Q){Ze(s.$$.fragment,Q),w=!1},d(Q){Q&&G(n),Gt(s),i[48](null)}}}function ex(i,n,s){let c,u,d;const m='<svg viewBox="0 0 20 20" fill-rule="evenodd"><path d="M0,8a8,8,0,1,0,16,0a8,8,0,1,0,-16,0ZM3,8a5,5,0,1,0,10,0a5,5,0,1,0,-10,0Z"/><path d="M18,20L20,18L14,12L12,14Z"/></svg>',o='<svg viewBox="0 0 20 20"><path d="M1,6L19,6L10,15Z"/></svg>',x=oo();let{id:w=""}=n,{container:I=void 0}=n,{mode:k="default"}=n,{items:E}=n,{placeholder:B="Select one..."}=n,{value:K=null}=n,{filterText:U=""}=n,{isSearchable:X=!0}=n,{isClearable:Q=!0}=n,{autoClear:Y=!1}=n,{idKey:re="value"}=n,{labelKey:V="label"}=n,{groupKey:ne=null}=n,{groupItems:oe=!1}=n,{loadOptions:Ne=void 0}=n,{fontSize:he="1em"}=n,{height:fe=42}=n,{isMulti:pe=!1}=n,{maxSelected:Ee=4}=n,{colors:ve=["#206095","#a8bd3a","#871a5b","#27a0cc"]}=n,{darkMode:ze=!1}=n,{borderColor:De=ze?"white":"#206095"}=n;const j=ne&&!oe?ct=>`${ct[V]} <span class="group">${ct[ne]}</span>`:ct=>ct[V];let{getSelectionLabel:ce=ct=>ct?j(ct):null}=n;const rt=oe&&ne?ct=>ct[ne]:void 0,Ke=k=="search"?m:o,qe=`--inputFontSize: ${he}; --groupTitleFontSize: ${he}; --height: ${fe}px; font-size: ${he};`,Qe=ct=>`${ct}, selected.`,Ie=(ct,en)=>`You are currently focused on ${ct}. There are ${en} results available.`,lt=()=>"Select is focused, type to refine list, press down to open the menu.";let ot,vt,gt,We,yt;const ue=ct=>new Promise(en=>setTimeout(en,ct));async function ke(ct){if(x("select",ct.detail),Y)yt();else if(Q){await ue(10);let en=ot.getElementsByClassName("clearSelect")[0];en&&(en.tabIndex=0,en.onkeypress=An=>{An.key=="Enter"&&yt()},en.removeAttribute("aria-hidden"),en.setAttribute("aria-label","Clear selection"))}}function Fe(ct){vt=ct,s(15,vt)}function bt(ct){K=ct,s(0,K)}function mi(ct){gt=ct,s(16,gt)}function et(ct){U=ct,s(1,U)}function ht(ct){We=ct,s(13,We)}function li(ct){yt=ct,s(17,yt)}function nn(ct){ul.call(this,i,ct)}function ei(ct){ul.call(this,i,ct)}function on(ct){ul.call(this,i,ct)}function tt(ct){Et[ct?"unshift":"push"](()=>{ot=ct,s(14,ot)})}return i.$$set=ct=>{"id"in ct&&s(2,w=ct.id),"container"in ct&&s(3,I=ct.container),"mode"in ct&&s(29,k=ct.mode),"items"in ct&&s(4,E=ct.items),"placeholder"in ct&&s(5,B=ct.placeholder),"value"in ct&&s(0,K=ct.value),"filterText"in ct&&s(1,U=ct.filterText),"isSearchable"in ct&&s(6,X=ct.isSearchable),"isClearable"in ct&&s(7,Q=ct.isClearable),"autoClear"in ct&&s(30,Y=ct.autoClear),"idKey"in ct&&s(8,re=ct.idKey),"labelKey"in ct&&s(31,V=ct.labelKey),"groupKey"in ct&&s(32,ne=ct.groupKey),"groupItems"in ct&&s(33,oe=ct.groupItems),"loadOptions"in ct&&s(9,Ne=ct.loadOptions),"fontSize"in ct&&s(34,he=ct.fontSize),"height"in ct&&s(35,fe=ct.height),"isMulti"in ct&&s(10,pe=ct.isMulti),"maxSelected"in ct&&s(36,Ee=ct.maxSelected),"colors"in ct&&s(37,ve=ct.colors),"darkMode"in ct&&s(38,ze=ct.darkMode),"borderColor"in ct&&s(11,De=ct.borderColor),"getSelectionLabel"in ct&&s(12,ce=ct.getSelectionLabel)},i.$$.update=()=>{i.$$.dirty[0]&536879106&&s(20,c=We?"Loading...":k=="search"&&U.length<3?"Enter 3 or more characters for suggestions":`No results match ${U}`),i.$$.dirty[0]&536870915|i.$$.dirty[1]&33&&s(19,u=Array.isArray(K)&&K.length>=Ee||k=="search"&&U.length<3?(ct,en,An)=>!1:(ct,en,An)=>`${An[V]}`.match(new RegExp(`\\b${en}`,"i"))),i.$$.dirty[1]&64&&s(18,d=ct=>ve[ct%ve.length])},[K,U,w,I,E,B,X,Q,re,Ne,pe,De,ce,We,ot,vt,gt,yt,d,u,c,j,rt,Ke,qe,Qe,Ie,lt,ke,k,Y,V,ne,oe,he,fe,Ee,ve,ze,Fe,bt,mi,et,ht,li,nn,ei,on,tt]}class tx extends pi{constructor(n){super(),gi(this,n,ex,$b,_i,{id:2,container:3,mode:29,items:4,placeholder:5,value:0,filterText:1,isSearchable:6,isClearable:7,autoClear:30,idKey:8,labelKey:31,groupKey:32,groupItems:33,loadOptions:9,fontSize:34,height:35,isMulti:10,maxSelected:36,colors:37,darkMode:38,borderColor:11,getSelectionLabel:12},null,[-1,-1])}}function ix(i){let n,s,c,u;function d(o){i[3](o)}let m={id:"multi",idKey:"areacd",labelKey:"areanm",groupKey:"parentnm",items:i[1],isMulti:!0,maxSelected:4,placeholder:"Add additional comparison areas"};return i[0].custom!==void 0&&(m.value=i[0].custom),s=new tx({props:m}),Et.push(()=>Bt(s,"value",d)),s.$on("select",i[2]),{c(){n=it("form"),Nt(s.$$.fragment),this.h()},l(o){n=nt(o,"FORM",{class:!0});var x=be(n);Kt(s.$$.fragment,x),x.forEach(G),this.h()},h(){A(n,"class","svelte-sfo7xy")},m(o,x){Be(o,n,x),Ut(s,n,null),u=!0},p(o,[x]){const w={};!c&&x&1&&(c=!0,w.value=o[0].custom,Ot(()=>c=!1)),s.$set(w)},i(o){u||(Le(s.$$.fragment,o),u=!0)},o(o){Ze(s.$$.fragment,o),u=!1},d(o){o&&G(n),Gt(s)}}}function nx(i,n,s){let{globalVisibleAreasTracker:c}=n,u=xi("areasParentsLookup"),d=xi("areas"),m=xi("selectedAndRelatedAreas"),o=u.filter(I=>!m.map(k=>k.areacd).includes(I.areacd));o.forEach(I=>{I.areanm=d.find(k=>k.areacd===I.areacd).areanm,I.parentnm=d.find(k=>I.parentcd===k.areacd)===void 0?"":d.find(k=>I.parentcd===k.areacd).areanm});function x(I){I.detail&&I.detail}function w(I){i.$$.not_equal(c.custom,I)&&(c.custom=I,s(0,c))}return i.$$set=I=>{"globalVisibleAreasTracker"in I&&s(0,c=I.globalVisibleAreasTracker)},[c,o,x,w]}class rx extends pi{constructor(n){super(),gi(this,n,nx,ix,_i,{globalVisibleAreasTracker:0})}}function Pm(i){let n,s,c,u=i[6]&&Lm(i),d=i[5]&&Bm(i);return{c(){u&&u.c(),n=Rt(),d&&d.c(),s=si()},l(m){u&&u.l(m),n=Ft(m),d&&d.l(m),s=si()},m(m,o){u&&u.m(m,o),Be(m,n,o),d&&d.m(m,o),Be(m,s,o),c=!0},p(m,o){m[6]?u?(u.p(m,o),o&64&&Le(u,1)):(u=Lm(m),u.c(),Le(u,1),u.m(n.parentNode,n)):u&&(wi(),Ze(u,1,1,()=>{u=null}),Ii()),m[5]?d?(d.p(m,o),o&32&&Le(d,1)):(d=Bm(m),d.c(),Le(d,1),d.m(s.parentNode,s)):d&&(wi(),Ze(d,1,1,()=>{d=null}),Ii())},i(m){c||(Le(u),Le(d),c=!0)},o(m){Ze(u),Ze(d),c=!1},d(m){u&&u.d(m),m&&G(n),d&&d.d(m),m&&G(s)}}}function Lm(i){let n,s,c,u,d,m,o,x,w,I,k,E;function B(Q){i[17](Q)}let K={optionsArray:i[12],width:i[9]/2-20,name:"select-baseline-area",text:"Comparing "+i[11].areanm+" to:"};i[2]!==void 0&&(K.chosenId=i[2]),c=new cm({props:K}),Et.push(()=>Bt(c,"chosenId",B));function U(Q){i[18](Q)}let X={optionsArray:i[13],width:i[9]/2-20,name:"select-previous-time period",text:"Comparing most recent time period to:"};return i[3]!==void 0&&(X.chosenId=i[3]),w=new cm({props:X}),Et.push(()=>Bt(w,"chosenId",U)),{c(){n=it("div"),s=it("div"),Nt(c.$$.fragment),d=Rt(),m=it("div"),o=Rt(),x=it("div"),Nt(w.$$.fragment),this.h()},l(Q){n=nt(Q,"DIV",{class:!0});var Y=be(n);s=nt(Y,"DIV",{class:!0});var re=be(s);Kt(c.$$.fragment,re),re.forEach(G),d=Ft(Y),m=nt(Y,"DIV",{class:!0}),be(m).forEach(G),o=Ft(Y),x=nt(Y,"DIV",{class:!0});var V=be(x);Kt(w.$$.fragment,V),V.forEach(G),Y.forEach(G),this.h()},h(){A(s,"class","col1 svelte-1ql21zt"),A(m,"class","divider svelte-1ql21zt"),A(x,"class","col2 svelte-1ql21zt"),A(n,"class","row-container svelte-1ql21zt"),ao(()=>i[19].call(n))},m(Q,Y){Be(Q,n,Y),we(n,s),Ut(c,s,null),we(n,d),we(n,m),we(n,o),we(n,x),Ut(w,x,null),k=bl(n,i[19].bind(n)),E=!0},p(Q,Y){const re={};Y&512&&(re.width=Q[9]/2-20),!u&&Y&4&&(u=!0,re.chosenId=Q[2],Ot(()=>u=!1)),c.$set(re);const V={};Y&512&&(V.width=Q[9]/2-20),!I&&Y&8&&(I=!0,V.chosenId=Q[3],Ot(()=>I=!1)),w.$set(V)},i(Q){E||(Le(c.$$.fragment,Q),Le(w.$$.fragment,Q),E=!0)},o(Q){Ze(c.$$.fragment,Q),Ze(w.$$.fragment,Q),E=!1},d(Q){Q&&G(n),Gt(c),Gt(w),k()}}}function Bm(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y,re,V,ne,oe,Ne;function he(De){i[20](De)}let fe={optionsArray:i[10].filter(ax).map(ox),name:"chosenComparison",spacing:"5px"};i[0]!==void 0&&(fe.chosenId=i[0]),m=new Oc({props:fe}),Et.push(()=>Bt(m,"chosenId",he));function pe(De){i[21](De)}let Ee={optionsArray:["Other areas in "+i[10].find(lx).areanm,"Statistically similar areas"],name:"chosenComparison",spacing:"5px"};i[1]!==void 0&&(Ee.chosenId=i[1]),U=new Oc({props:Ee}),Et.push(()=>Bt(U,"chosenId",pe));function ve(De){i[22](De)}let ze={};return i[4]!==void 0&&(ze.globalVisibleAreasTracker=i[4]),ne=new rx({props:ze}),Et.push(()=>Bt(ne,"globalVisibleAreasTracker",ve)),{c(){n=it("div"),s=it("div"),c=it("p"),u=fi("Parent areas:"),d=Rt(),Nt(m.$$.fragment),x=Rt(),w=it("div"),I=Rt(),k=it("div"),E=it("p"),B=fi("Related areas:"),K=Rt(),Nt(U.$$.fragment),Q=Rt(),Y=it("div"),re=Rt(),V=it("div"),Nt(ne.$$.fragment),this.h()},l(De){n=nt(De,"DIV",{class:!0});var j=be(n);s=nt(j,"DIV",{class:!0});var ce=be(s);c=nt(ce,"P",{class:!0});var rt=be(c);u=di(rt,"Parent areas:"),rt.forEach(G),d=Ft(ce),Kt(m.$$.fragment,ce),ce.forEach(G),x=Ft(j),w=nt(j,"DIV",{class:!0}),be(w).forEach(G),I=Ft(j),k=nt(j,"DIV",{class:!0});var Ke=be(k);E=nt(Ke,"P",{class:!0});var qe=be(E);B=di(qe,"Related areas:"),qe.forEach(G),K=Ft(Ke),Kt(U.$$.fragment,Ke),Ke.forEach(G),j.forEach(G),Q=Ft(De),Y=nt(De,"DIV",{class:!0}),be(Y).forEach(G),re=Ft(De),V=nt(De,"DIV",{class:!0});var Qe=be(V);Kt(ne.$$.fragment,Qe),Qe.forEach(G),this.h()},h(){A(c,"class","checkbox-title svelte-1ql21zt"),A(s,"class","col1 svelte-1ql21zt"),A(w,"class","divider svelte-1ql21zt"),A(E,"class","checkbox-title svelte-1ql21zt"),A(k,"class","col2 svelte-1ql21zt"),A(n,"class","row-container svelte-1ql21zt"),A(Y,"class","divider-horizontal svelte-1ql21zt"),A(V,"class","row-container svelte-1ql21zt")},m(De,j){Be(De,n,j),we(n,s),we(s,c),we(c,u),we(s,d),Ut(m,s,null),we(n,x),we(n,w),we(n,I),we(n,k),we(k,E),we(E,B),we(k,K),Ut(U,k,null),Be(De,Q,j),Be(De,Y,j),Be(De,re,j),Be(De,V,j),Ut(ne,V,null),Ne=!0},p(De,j){const ce={};!o&&j&1&&(o=!0,ce.chosenId=De[0],Ot(()=>o=!1)),m.$set(ce);const rt={};!X&&j&2&&(X=!0,rt.chosenId=De[1],Ot(()=>X=!1)),U.$set(rt);const Ke={};!oe&&j&16&&(oe=!0,Ke.globalVisibleAreasTracker=De[4],Ot(()=>oe=!1)),ne.$set(Ke)},i(De){Ne||(Le(m.$$.fragment,De),Le(U.$$.fragment,De),Le(ne.$$.fragment,De),Ne=!0)},o(De){Ze(m.$$.fragment,De),Ze(U.$$.fragment,De),Ze(ne.$$.fragment,De),Ne=!1},d(De){De&&G(n),Gt(m),Gt(U),De&&G(Q),De&&G(Y),De&&G(re),De&&G(V),Gt(ne)}}}function sx(i){let n,s,c,u=i[5]&i[6]?"Select comparison areas and previous time period":i[5]?"Select areas to compare "+i[11].areanm+" to":"Select comparison area and previous time period",d,m,o,x,w,I;c=new wb({props:{twistyOpen:i[7],hover:i[8]}});let k=i[7]&&Pm(i);return{c(){n=it("div"),s=it("p"),Nt(c.$$.fragment),d=fi(u),o=Rt(),k&&k.c(),this.h()},l(E){n=nt(E,"DIV",{class:!0});var B=be(n);s=nt(B,"P",{class:!0});var K=be(s);Kt(c.$$.fragment,K),d=di(K,u),K.forEach(G),o=Ft(B),k&&k.l(B),B.forEach(G),this.h()},h(){A(s,"class",m="twisty-label "+(i[7]?"twisty-label-open":"")+" svelte-1ql21zt"),A(n,"class","twisty-container svelte-1ql21zt")},m(E,B){Be(E,n,B),we(n,s),Ut(c,s,null),we(s,d),we(n,o),k&&k.m(n,null),x=!0,w||(I=[Gi(s,"mouseover",i[15]),Gi(s,"mouseleave",i[16]),Gi(s,"click",i[14])],w=!0)},p(E,[B]){const K={};B&128&&(K.twistyOpen=E[7]),B&256&&(K.hover=E[8]),c.$set(K),(!x||B&96)&&u!==(u=E[5]&E[6]?"Select comparison areas and previous time period":E[5]?"Select areas to compare "+E[11].areanm+" to":"Select comparison area and previous time period")&&zi(d,u),(!x||B&128&&m!==(m="twisty-label "+(E[7]?"twisty-label-open":"")+" svelte-1ql21zt"))&&A(s,"class",m),E[7]?k?(k.p(E,B),B&128&&Le(k,1)):(k=Pm(E),k.c(),Le(k,1),k.m(n,null)):k&&(wi(),Ze(k,1,1,()=>{k=null}),Ii())},i(E){x||(Le(c.$$.fragment,E),Le(k),x=!0)},o(E){Ze(c.$$.fragment,E),Ze(k),x=!1},d(E){E&&G(n),Gt(c),k&&k.d(),w=!1,wa(I)}}}const ax=i=>i.role!="main",ox=i=>i.areanm,lx=i=>i.role==="parent";function cx(i,n,s){let{chosenId1:c}=n,{chosenId2:u}=n,{chosenId4:d}=n,{chosenId5:m}=n,{globalVisibleAreasTracker:o}=n,{showAreaOptions:x,showBaselines:w}=n,I=xi("selectedAndRelatedAreas"),k=xi("selectedArea"),E=xi("baselineComparisonOptions"),B=xi("previousTimePeriodOptions"),K=!1,U=!1;const X=()=>{s(7,K=!K)},Q=()=>{s(8,U=!0)},Y=()=>{s(8,U=!1)};let re=1e3;function V(pe){c=pe,s(2,c)}function ne(pe){u=pe,s(3,u)}function oe(){re=this.offsetWidth,s(9,re)}function Ne(pe){d=pe,s(0,d)}function he(pe){m=pe,s(1,m)}function fe(pe){o=pe,s(4,o),s(1,m),s(0,d),s(10,I)}return i.$$set=pe=>{"chosenId1"in pe&&s(2,c=pe.chosenId1),"chosenId2"in pe&&s(3,u=pe.chosenId2),"chosenId4"in pe&&s(0,d=pe.chosenId4),"chosenId5"in pe&&s(1,m=pe.chosenId5),"globalVisibleAreasTracker"in pe&&s(4,o=pe.globalVisibleAreasTracker),"showAreaOptions"in pe&&s(5,x=pe.showAreaOptions),"showBaselines"in pe&&s(6,w=pe.showBaselines)},i.$$.update=()=>{i.$$.dirty&2&&(s(4,o.neighbour=m.includes(0),o),s(4,o.cluster=m.includes(1),o)),i.$$.dirty&1&&(s(4,o.parent=!1,o),s(4,o.country=!1,o),s(4,o.uk=!1,o),d.forEach(pe=>{s(4,o[I.find(Ee=>I[pe+1].areanm===Ee.areanm).role]=!0,o)}))},[d,m,c,u,o,x,w,K,U,re,I,k,E,B,X,Q,Y,V,ne,oe,Ne,he,fe]}class Jp extends pi{constructor(n){super(),gi(this,n,cx,sx,_i,{chosenId1:2,chosenId2:3,chosenId4:0,chosenId5:1,globalVisibleAreasTracker:4,showAreaOptions:5,showBaselines:6})}}function Rm(i,n,s){const c=i.slice();return c[20]=n[s],c[22]=s,c}function ux(i){let n,s;return{c(){n=ft("circle"),this.h()},l(c){n=dt(c,"circle",{r:!0,fill:!0,stroke:!0});var u=be(n);u.forEach(G),this.h()},h(){A(n,"r",6),A(n,"fill",s=ni[i[20].role]),A(n,"stroke","white")},m(c,u){Be(c,n,u)},p(c,u){u&128&&s!==(s=ni[c[20].role])&&A(n,"fill",s)},d(c){c&&G(n)}}}function hx(i){let n,s,c;return{c(){n=ft("rect"),this.h()},l(u){n=dt(u,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0});var d=be(n);d.forEach(G),this.h()},h(){A(n,"transform",s=["country","uk"].includes(i[20].role)?"rotate(45)":null),A(n,"x",-6),A(n,"y",-6),A(n,"width",2*6),A(n,"height",2*6),A(n,"fill",c=ni[i[20].role]),A(n,"stroke","white")},m(u,d){Be(u,n,d)},p(u,d){d&128&&s!==(s=["country","uk"].includes(u[20].role)?"rotate(45)":null)&&A(n,"transform",s),d&128&&c!==(c=ni[u[20].role])&&A(n,"fill",c)},d(u){u&&G(n)}}}function Fm(i){let n,s,c,u,d,m,o=i[20].areanm+"",x,w;function I(B,K){return K&128&&(u=null),u==null&&(u=!!["parent","country","uk"].includes(B[20].role)),u?hx:ux}let k=I(i,-1),E=k(i);return{c(){n=it("div"),s=ft("svg"),c=ft("g"),E.c(),d=Rt(),m=it("p"),x=fi(o),w=Rt(),this.h()},l(B){n=nt(B,"DIV",{class:!0});var K=be(n);s=dt(K,"svg",{width:!0,height:!0});var U=be(s);c=dt(U,"g",{transform:!0});var X=be(c);E.l(X),X.forEach(G),U.forEach(G),d=Ft(K),m=nt(K,"P",{style:!0,class:!0});var Q=be(m);x=di(Q,o),Q.forEach(G),w=Ft(K),K.forEach(G),this.h()},h(){A(c,"transform","translate(10,12)"),A(s,"width","20"),A(s,"height","24"),ii(m,"color",ni[i[20].role]),A(m,"class","svelte-1f6uc8m"),A(n,"class","area-container svelte-1f6uc8m")},m(B,K){Be(B,n,K),we(n,s),we(s,c),E.m(c,null),we(n,d),we(n,m),we(m,x),we(n,w)},p(B,K){k===(k=I(B,K))&&E?E.p(B,K):(E.d(1),E=k(B),E&&(E.c(),E.m(c,null))),K&128&&o!==(o=B[20].areanm+"")&&zi(x,o),K&128&&ii(m,"color",ni[B[20].role])},d(B){B&&G(n),E.d()}}}function fx(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K;function U(fe){i[12](fe)}function X(fe){i[13](fe)}function Q(fe){i[14](fe)}function Y(fe){i[15](fe)}function re(fe){i[16](fe)}let V={showAreaOptions:i[6]!=0,showBaselines:i[6]!=1};i[0]!==void 0&&(V.chosenId1=i[0]),i[1]!==void 0&&(V.chosenId2=i[1]),i[4]!==void 0&&(V.globalVisibleAreasTracker=i[4]),i[2]!==void 0&&(V.chosenId4=i[2]),i[3]!==void 0&&(V.chosenId5=i[3]),c=new Jp({props:V}),Et.push(()=>Bt(c,"chosenId1",U)),Et.push(()=>Bt(c,"chosenId2",X)),Et.push(()=>Bt(c,"globalVisibleAreasTracker",Q)),Et.push(()=>Bt(c,"chosenId4",Y)),Et.push(()=>Bt(c,"chosenId5",re));function ne(fe){i[17](fe)}let oe={optionsArray:["Include 95% confidence intervals"],name:"chosenComparison"};i[5]!==void 0&&(oe.chosenId=i[5]),I=new Oc({props:oe}),Et.push(()=>Bt(I,"chosenId",ne));let Ne=i[7],he=[];for(let fe=0;fe<Ne.length;fe+=1)he[fe]=Fm(Rm(i,Ne,fe));return{c(){n=it("div"),s=it("div"),Nt(c.$$.fragment),w=Rt(),Nt(I.$$.fragment),E=Rt(),B=it("div");for(let fe=0;fe<he.length;fe+=1)he[fe].c();this.h()},l(fe){n=nt(fe,"DIV",{class:!0});var pe=be(n);s=nt(pe,"DIV",{});var Ee=be(s);Kt(c.$$.fragment,Ee),Ee.forEach(G),w=Ft(pe),Kt(I.$$.fragment,pe),E=Ft(pe),B=nt(pe,"DIV",{class:!0});var ve=be(B);for(let ze=0;ze<he.length;ze+=1)he[ze].l(ve);ve.forEach(G),pe.forEach(G),this.h()},h(){A(B,"class","key-container svelte-1f6uc8m"),A(n,"class","sticky svelte-1f6uc8m")},m(fe,pe){Be(fe,n,pe),we(n,s),Ut(c,s,null),we(n,w),Ut(I,n,null),we(n,E),we(n,B);for(let Ee=0;Ee<he.length;Ee+=1)he[Ee]&&he[Ee].m(B,null);K=!0},p(fe,[pe]){const Ee={};pe&64&&(Ee.showAreaOptions=fe[6]!=0),pe&64&&(Ee.showBaselines=fe[6]!=1),!u&&pe&1&&(u=!0,Ee.chosenId1=fe[0],Ot(()=>u=!1)),!d&&pe&2&&(d=!0,Ee.chosenId2=fe[1],Ot(()=>d=!1)),!m&&pe&16&&(m=!0,Ee.globalVisibleAreasTracker=fe[4],Ot(()=>m=!1)),!o&&pe&4&&(o=!0,Ee.chosenId4=fe[2],Ot(()=>o=!1)),!x&&pe&8&&(x=!0,Ee.chosenId5=fe[3],Ot(()=>x=!1)),c.$set(Ee);const ve={};if(!k&&pe&32&&(k=!0,ve.chosenId=fe[5],Ot(()=>k=!1)),I.$set(ve),pe&128){Ne=fe[7];let ze;for(ze=0;ze<Ne.length;ze+=1){const De=Rm(fe,Ne,ze);he[ze]?he[ze].p(De,pe):(he[ze]=Fm(De),he[ze].c(),he[ze].m(B,null))}for(;ze<he.length;ze+=1)he[ze].d(1);he.length=Ne.length}},i(fe){K||(Le(c.$$.fragment,fe),Le(I.$$.fragment,fe),K=!0)},o(fe){Ze(c.$$.fragment,fe),Ze(I.$$.fragment,fe),K=!1},d(fe){fe&&G(n),Gt(c),Gt(I),$i(he,fe)}}}function dx(i,n,s){let c,{baselineComparisonArea:u}=n,{chosenId3:d}=n,{visibleAreas:m}=n,{chosenId1:o}=n,{chosenId2:x}=n,{chosenId4:w}=n,{chosenId5:I}=n,{globalVisibleAreasTracker:k}=n,{showAreaOptions:E,showBaselines:B}=n,{chosenId6:K}=n,U=xi("selectedAndRelatedAreas");xi("selectedArea");function X(oe){o=oe,s(0,o)}function Q(oe){x=oe,s(1,x)}function Y(oe){k=oe,s(4,k)}function re(oe){w=oe,s(2,w)}function V(oe){I=oe,s(3,I)}function ne(oe){K=oe,s(5,K)}return i.$$set=oe=>{"baselineComparisonArea"in oe&&s(8,u=oe.baselineComparisonArea),"chosenId3"in oe&&s(6,d=oe.chosenId3),"visibleAreas"in oe&&s(9,m=oe.visibleAreas),"chosenId1"in oe&&s(0,o=oe.chosenId1),"chosenId2"in oe&&s(1,x=oe.chosenId2),"chosenId4"in oe&&s(2,w=oe.chosenId4),"chosenId5"in oe&&s(3,I=oe.chosenId5),"globalVisibleAreasTracker"in oe&&s(4,k=oe.globalVisibleAreasTracker),"showAreaOptions"in oe&&s(10,E=oe.showAreaOptions),"showBaselines"in oe&&s(11,B=oe.showBaselines),"chosenId6"in oe&&s(5,K=oe.chosenId6)},i.$$.update=()=>{i.$$.dirty&832&&s(7,c=d===0?[U[0],u.areacd==="median"?u:U.find(oe=>u.areacd===oe.areacd)]:m)},[o,x,w,I,k,K,d,c,u,m,E,B,X,Q,Y,re,V,ne]}class mx extends pi{constructor(n){super(),gi(this,n,dx,fx,_i,{baselineComparisonArea:8,chosenId3:6,visibleAreas:9,chosenId1:0,chosenId2:1,chosenId4:2,chosenId5:3,globalVisibleAreasTracker:4,showAreaOptions:10,showBaselines:11,chosenId6:5})}}function Om(i,n,s){const c=i.slice();return c[43]=n[s],c[45]=s,c}function Vm(i,n,s){const c=i.slice();return c[46]=n[s],c[48]=s,c}function Nm(i){let n,s,c,u,d,m,o;function x(...K){return i[36](i[46],...K)}function w(...K){return i[37](i[46],...K)}function I(K){i[38](K)}function k(K){i[39](K)}function E(K){i[40](K)}let B={rowNumb:i[48],topicNumb:i[45],indicator:i[46],metadata:i[24].find(x),calculations:i[25].find(w),col1Width:cl,col2Width:i[17],col3Width:i[18],col4Width:i[16],chosenId2:i[2],chosenId3:i[11],visibleAreas:i[8],baselineComparisonArea:i[9],scaleHeight:i[14],scaleWidthArea:i[15],scaleWidthTime:i[23],xDomain:i[27],x:i[22],y:i[21],chosenId11:i[10],chosenId6:i[5]};return i[13]!==void 0&&(B.yDomainGlobal=i[13]),i[19]!==void 0&&(B.hoverIndex=i[19]),i[20]!==void 0&&(B.hoverChartIndex=i[20]),c=new fb({props:B}),Et.push(()=>Bt(c,"yDomainGlobal",I)),Et.push(()=>Bt(c,"hoverIndex",k)),Et.push(()=>Bt(c,"hoverChartIndex",E)),{c(){n=it("div"),s=Rt(),Nt(c.$$.fragment),this.h()},l(K){n=nt(K,"DIV",{class:!0}),be(n).forEach(G),s=Ft(K),Kt(c.$$.fragment,K),this.h()},h(){A(n,"class","divider svelte-1km6wui")},m(K,U){Be(K,n,U),Be(K,s,U),Ut(c,K,U),o=!0},p(K,U){i=K;const X={};U[0]&192&&(X.indicator=i[46]),U[0]&192&&(X.metadata=i[24].find(x)),U[0]&192&&(X.calculations=i[25].find(w)),U[0]&131072&&(X.col2Width=i[17]),U[0]&262144&&(X.col3Width=i[18]),U[0]&65536&&(X.col4Width=i[16]),U[0]&4&&(X.chosenId2=i[2]),U[0]&2048&&(X.chosenId3=i[11]),U[0]&256&&(X.visibleAreas=i[8]),U[0]&512&&(X.baselineComparisonArea=i[9]),U[0]&16384&&(X.scaleHeight=i[14]),U[0]&32768&&(X.scaleWidthArea=i[15]),U[0]&8388608&&(X.scaleWidthTime=i[23]),U[0]&4194304&&(X.x=i[22]),U[0]&2097152&&(X.y=i[21]),U[0]&1024&&(X.chosenId11=i[10]),U[0]&32&&(X.chosenId6=i[5]),!u&&U[0]&8192&&(u=!0,X.yDomainGlobal=i[13],Ot(()=>u=!1)),!d&&U[0]&524288&&(d=!0,X.hoverIndex=i[19],Ot(()=>d=!1)),!m&&U[0]&1048576&&(m=!0,X.hoverChartIndex=i[20],Ot(()=>m=!1)),c.$set(X)},i(K){o||(Le(c.$$.fragment,K),o=!0)},o(K){Ze(c.$$.fragment,K),o=!1},d(K){K&&G(n),K&&G(s),Gt(c,K)}}}function Um(i){let n,s,c=i[43][0].toUpperCase()+i[43].substring(1)+"",u,d,m,o,x,w,I;function k(...U){return i[35](i[43],...U)}let E=i[7].filter(k),B=[];for(let U=0;U<E.length;U+=1)B[U]=Nm(Vm(i,E,U));const K=U=>Ze(B[U],1,1,()=>{B[U]=null});return{c(){n=it("div"),s=it("h4"),u=fi(c),d=Rt(),m=it("div");for(let U=0;U<B.length;U+=1)B[U].c();o=Rt(),x=it("div"),w=Rt(),this.h()},l(U){n=nt(U,"DIV",{class:!0});var X=be(n);s=nt(X,"H4",{class:!0});var Q=be(s);u=di(Q,c),Q.forEach(G),d=Ft(X),m=nt(X,"DIV",{class:!0});var Y=be(m);for(let re=0;re<B.length;re+=1)B[re].l(Y);Y.forEach(G),o=Ft(X),x=nt(X,"DIV",{class:!0}),be(x).forEach(G),w=Ft(X),X.forEach(G),this.h()},h(){A(s,"class","sub-topic-header svelte-1km6wui"),A(m,"class","sub-topic-rows-container svelte-1km6wui"),A(x,"class","divider svelte-1km6wui"),A(n,"class","sub-topic-container svelte-1km6wui")},m(U,X){Be(U,n,X),we(n,s),we(s,u),we(n,d),we(n,m);for(let Q=0;Q<B.length;Q+=1)B[Q]&&B[Q].m(m,null);we(n,o),we(n,x),we(n,w),I=!0},p(U,X){if(i=U,(!I||X[0]&64)&&c!==(c=i[43][0].toUpperCase()+i[43].substring(1)+"")&&zi(u,c),X[0]&201322468){E=i[7].filter(k);let Q;for(Q=0;Q<E.length;Q+=1){const Y=Vm(i,E,Q);B[Q]?(B[Q].p(Y,X),Le(B[Q],1)):(B[Q]=Nm(Y),B[Q].c(),Le(B[Q],1),B[Q].m(m,null))}for(wi(),Q=E.length;Q<B.length;Q+=1)K(Q);Ii()}},i(U){if(!I){for(let X=0;X<E.length;X+=1)Le(B[X]);I=!0}},o(U){B=B.filter(Boolean);for(let X=0;X<B.length;X+=1)Ze(B[X]);I=!1},d(U){U&&G(n),$i(B,U)}}}function px(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y;function re(j){i[28](j)}let V={name:"select-row-view",optionsArray:i[26],width:i[12]};i[11]!==void 0&&(V.chosenId=i[11]),n=new Ep({props:V}),Et.push(()=>Bt(n,"chosenId",re));function ne(j){i[29](j)}function oe(j){i[30](j)}function Ne(j){i[31](j)}function he(j){i[32](j)}function fe(j){i[33](j)}function pe(j){i[34](j)}let Ee={baselineComparisonArea:i[9],chosenId3:i[11],visibleAreas:i[8],showAreaOptions:i[11]!=0,showBaselines:i[11]!=1};i[1]!==void 0&&(Ee.chosenId1=i[1]),i[2]!==void 0&&(Ee.chosenId2=i[2]),i[0]!==void 0&&(Ee.globalVisibleAreasTracker=i[0]),i[3]!==void 0&&(Ee.chosenId4=i[3]),i[4]!==void 0&&(Ee.chosenId5=i[4]),i[5]!==void 0&&(Ee.chosenId6=i[5]),o=new mx({props:Ee}),Et.push(()=>Bt(o,"chosenId1",ne)),Et.push(()=>Bt(o,"chosenId2",oe)),Et.push(()=>Bt(o,"globalVisibleAreasTracker",Ne)),Et.push(()=>Bt(o,"chosenId4",he)),Et.push(()=>Bt(o,"chosenId5",fe)),Et.push(()=>Bt(o,"chosenId6",pe));let ve=i[6].subTopicsList,ze=[];for(let j=0;j<ve.length;j+=1)ze[j]=Um(Om(i,ve,j));const De=j=>Ze(ze[j],1,1,()=>{ze[j]=null});return X=new Kp({}),{c(){Nt(n.$$.fragment),c=Rt(),u=it("div"),d=it("div"),m=it("div"),Nt(o.$$.fragment),K=Rt();for(let j=0;j<ze.length;j+=1)ze[j].c();U=Rt(),Nt(X.$$.fragment),this.h()},l(j){Kt(n.$$.fragment,j),c=Ft(j),u=nt(j,"DIV",{class:!0});var ce=be(u);d=nt(ce,"DIV",{class:!0});var rt=be(d);m=nt(rt,"DIV",{class:!0});var Ke=be(m);Kt(o.$$.fragment,Ke),K=Ft(Ke);for(let qe=0;qe<ze.length;qe+=1)ze[qe].l(Ke);Ke.forEach(G),U=Ft(rt),Kt(X.$$.fragment,rt),rt.forEach(G),ce.forEach(G),this.h()},h(){A(m,"class","key-and-rows-container"),A(d,"class","digest-beeswarm-line-inner-container svelte-1km6wui"),ao(()=>i[41].call(d)),A(u,"class","digest-beeswarm-line-outer-container svelte-1km6wui")},m(j,ce){Ut(n,j,ce),Be(j,c,ce),Be(j,u,ce),we(u,d),we(d,m),Ut(o,m,null),we(m,K);for(let rt=0;rt<ze.length;rt+=1)ze[rt]&&ze[rt].m(m,null);we(d,U),Ut(X,d,null),Q=bl(d,i[41].bind(d)),Y=!0},p(j,ce){const rt={};ce[0]&4096&&(rt.width=j[12]),!s&&ce[0]&2048&&(s=!0,rt.chosenId=j[11],Ot(()=>s=!1)),n.$set(rt);const Ke={};if(ce[0]&512&&(Ke.baselineComparisonArea=j[9]),ce[0]&2048&&(Ke.chosenId3=j[11]),ce[0]&256&&(Ke.visibleAreas=j[8]),ce[0]&2048&&(Ke.showAreaOptions=j[11]!=0),ce[0]&2048&&(Ke.showBaselines=j[11]!=1),!x&&ce[0]&2&&(x=!0,Ke.chosenId1=j[1],Ot(()=>x=!1)),!w&&ce[0]&4&&(w=!0,Ke.chosenId2=j[2],Ot(()=>w=!1)),!I&&ce[0]&1&&(I=!0,Ke.globalVisibleAreasTracker=j[0],Ot(()=>I=!1)),!k&&ce[0]&8&&(k=!0,Ke.chosenId4=j[3],Ot(()=>k=!1)),!E&&ce[0]&16&&(E=!0,Ke.chosenId5=j[4],Ot(()=>E=!1)),!B&&ce[0]&32&&(B=!0,Ke.chosenId6=j[5],Ot(()=>B=!1)),o.$set(Ke),ce[0]&201322468){ve=j[6].subTopicsList;let qe;for(qe=0;qe<ve.length;qe+=1){const Qe=Om(j,ve,qe);ze[qe]?(ze[qe].p(Qe,ce),Le(ze[qe],1)):(ze[qe]=Um(Qe),ze[qe].c(),Le(ze[qe],1),ze[qe].m(m,null))}for(wi(),qe=ve.length;qe<ze.length;qe+=1)De(qe);Ii()}},i(j){if(!Y){Le(n.$$.fragment,j),Le(o.$$.fragment,j);for(let ce=0;ce<ve.length;ce+=1)Le(ze[ce]);Le(X.$$.fragment,j),Y=!0}},o(j){Ze(n.$$.fragment,j),Ze(o.$$.fragment,j),ze=ze.filter(Boolean);for(let ce=0;ce<ze.length;ce+=1)Ze(ze[ce]);Ze(X.$$.fragment,j),Y=!1},d(j){Gt(n,j),j&&G(c),j&&G(u),Gt(o),$i(ze,j),Gt(X),Q()}}}let cl=240;function gx(i,n,s){let c,u,d,m,o,x,w,I,{topic:k}=n,{indicators:E}=n,{visibleAreas:B,globalVisibleAreasTracker:K}=n,{chosenId1:U,baselineComparisonArea:X}=n,{chosenId2:Q}=n,{chosenId4:Y,chosenId5:re}=n,{chosenId11:V}=n,{chosenId6:ne}=n,oe=xi("indicatorsMetadata"),Ne=xi("indicatorsCalculations");xi("selectedArea");let he=0,fe=["Summary","Compared to other areas","Change over time"],pe=1e3,Ee=[-Fc,Fc],ve=[-1,1],ze=null,De=null;function j(ke){he=ke,s(11,he)}function ce(ke){U=ke,s(1,U)}function rt(ke){Q=ke,s(2,Q)}function Ke(ke){K=ke,s(0,K)}function qe(ke){Y=ke,s(3,Y)}function Qe(ke){re=ke,s(4,re)}function Ie(ke){ne=ke,s(5,ne)}const lt=(ke,Fe)=>Fe.subTopic===ke,ot=(ke,Fe)=>Fe.code===ke.code,vt=(ke,Fe)=>Fe.id===ke.id;function gt(ke){ve=ke,s(13,ve)}function We(ke){ze=ke,s(19,ze)}function yt(ke){De=ke,s(20,De)}function ue(){pe=this.offsetWidth,s(12,pe)}return i.$$set=ke=>{"topic"in ke&&s(6,k=ke.topic),"indicators"in ke&&s(7,E=ke.indicators),"visibleAreas"in ke&&s(8,B=ke.visibleAreas),"globalVisibleAreasTracker"in ke&&s(0,K=ke.globalVisibleAreasTracker),"chosenId1"in ke&&s(1,U=ke.chosenId1),"baselineComparisonArea"in ke&&s(9,X=ke.baselineComparisonArea),"chosenId2"in ke&&s(2,Q=ke.chosenId2),"chosenId4"in ke&&s(3,Y=ke.chosenId4),"chosenId5"in ke&&s(4,re=ke.chosenId5),"chosenId11"in ke&&s(10,V=ke.chosenId11),"chosenId6"in ke&&s(5,ne=ke.chosenId6)},i.$$.update=()=>{i.$$.dirty[0]&2048&&s(18,c=he===0?20:0),i.$$.dirty[0]&268288&&s(17,u=he===0?(pe-cl-c-5)/2:he===1?pe-cl-c:0),i.$$.dirty[0]&268288&&s(16,d=he===0?(pe-cl-c-5)/2:he===1?0:pe-cl-c),i.$$.dirty[0]&2048&&s(14,m=ws[he===0?"split":"full"]-Ht.bottom[he===0?"split":"full"]-Ht.top[he===0?"split":"full"]),i.$$.dirty[0]&133120&&s(15,o=u-Ht.left[he===0?"split":"full"]-Ht.right[he===0?"split":"full"]-Ht.areaSpaceBeyondXScale[he===0?"split":"full"]*2),i.$$.dirty[0]&67584&&s(23,x=d-Ht.left[he===0?"split":"full"]-Ht.right[he===0?"split":"full"]-Ht.areaSpaceBeyondXScale[he===0?"split":"full"]*2),i.$$.dirty[0]&32768&&s(22,w=Us().domain(Ee).range([0,o])),i.$$.dirty[0]&24576&&s(21,I=Us().domain(ve).range([0,m]))},[K,U,Q,Y,re,ne,k,E,B,X,V,he,pe,ve,m,o,d,u,c,ze,De,I,w,x,oe,Ne,fe,Ee,j,ce,rt,Ke,qe,Qe,Ie,lt,ot,vt,gt,We,yt,ue]}class _x extends pi{constructor(n){super(),gi(this,n,gx,px,_i,{topic:6,indicators:7,visibleAreas:8,globalVisibleAreasTracker:0,chosenId1:1,baselineComparisonArea:9,chosenId2:2,chosenId4:3,chosenId5:4,chosenId11:10,chosenId6:5},null,[-1,-1])}}var Qp={exports:{}};(function(i,n){(function(s,c){i.exports=c()})(w1,function(){var s,c,u;function d(o,x){if(!s)s=x;else if(!c)c=x;else{var w="var sharedChunk = {}; ("+s+")(sharedChunk); ("+c+")(sharedChunk);",I={};s(I),u=x(I),typeof window<"u"&&(u.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}d(["exports"],function(o){var x=w;function w(r,e,a,h){this.cx=3*r,this.bx=3*(a-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(h-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=a,this.p2y=h}function I(r,e,a,h){const g=new x(r,e,a,h);return function(y){return g.solve(y)}}w.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var a=r,h=0;h<8;h++){var g=this.sampleCurveX(a)-r;if(Math.abs(g)<e)return a;var y=this.sampleCurveDerivativeX(a);if(Math.abs(y)<1e-6)break;a-=g/y}var b=0,S=1;for(a=r,h=0;h<20&&(g=this.sampleCurveX(a),!(Math.abs(g-r)<e));h++)r>g?b=a:S=a,a=.5*(S-b)+b;return a},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};const k=I(.25,.1,.25,1);function E(r,e,a){return Math.min(a,Math.max(e,r))}function B(r,e,a){const h=a-e,g=((r-e)%h+h)%h+e;return g===e?a:g}function K(r,...e){for(const a of e)for(const h in a)r[h]=a[h];return r}let U=1;function X(r,e){r.forEach(a=>{e[a]&&(e[a]=e[a].bind(e))})}function Q(r,e,a){const h={};for(const g in r)h[g]=e.call(a||this,r[g],g,r);return h}function Y(r,e,a){const h={};for(const g in r)e.call(a||this,r[g],g,r)&&(h[g]=r[g]);return h}function re(r){return Array.isArray(r)?r.map(re):typeof r=="object"&&r?Q(r,re):r}const V={};function ne(r){V[r]||(typeof console<"u"&&console.warn(r),V[r]=!0)}function oe(r,e,a){return(a.y-r.y)*(e.x-r.x)>(e.y-r.y)*(a.x-r.x)}function Ne(r){let e=0;for(let a,h,g=0,y=r.length,b=y-1;g<y;b=g++)a=r[g],h=r[b],e+=(h.x-a.x)*(a.y+h.y);return e}function he(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fe(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,g,y)=>{const b=g||y;return e[h]=!b||b.toLowerCase(),""}),e["max-age"]){const a=parseInt(e["max-age"],10);isNaN(a)?delete e["max-age"]:e["max-age"]=a}return e}let pe,Ee,ve=null;function ze(r){if(ve==null){const e=r.navigator?r.navigator.userAgent:null;ve=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ve}function De(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const j={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const a=window.document.createElement("canvas"),h=a.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return a.width=r.width,a.height=r.height,h.drawImage(r,0,0,r.width,r.height),h.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(pe||(pe=document.createElement("a")),pe.href=r,pe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ee==null&&(Ee=matchMedia("(prefers-reduced-motion: reduce)")),Ee.matches)}};var ce=rt;function rt(r,e){this.x=r,this.y=e}rt.prototype={clone:function(){return new rt(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,a=r.y-this.y;return e*e+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),a=Math.sin(r),h=a*this.x+e*this.y;return this.x=e*this.x-a*this.y,this.y=h,this},_rotateAround:function(r,e){var a=Math.cos(r),h=Math.sin(r),g=e.y+h*(this.x-e.x)+a*(this.y-e.y);return this.x=e.x+a*(this.x-e.x)-h*(this.y-e.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},rt.convert=function(r){return r instanceof rt?r:Array.isArray(r)?new rt(r[0],r[1]):r};const Ke={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},qe="mapbox-tiles";let Qe,Ie,lt=500,ot=50;function vt(){typeof caches>"u"||Qe||(Qe=caches.open(qe))}let gt=1/0;const We={supported:!1,testSupport:function(r){!ke&&ue&&(Fe?bt(r):yt=r)}};let yt,ue,ke=!1,Fe=!1;function bt(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ue),r.isContextLost())return;We.supported=!0}catch{}r.deleteTexture(e),ke=!0}typeof document<"u"&&(ue=document.createElement("img"),ue.onload=function(){yt&&bt(yt),yt=null,Fe=!0},ue.onerror=function(){ke=!0,yt=null},ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(mi);class et extends Error{constructor(e,a,h,g){super(`AJAXError: ${a} (${e}): ${h}`),this.status=e,this.statusText=a,this.url=h,this.body=g}}const ht=he()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function li(r,e){const a=new AbortController,h=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:ht(),signal:a.signal});let g=!1,y=!1;return r.type==="json"&&h.headers.set("Accept","application/json"),((b,S,C)=>{if(y)return;const D=Date.now();fetch(h).then(R=>R.ok?((O,Z,H)=>{(r.type==="arrayBuffer"?O.arrayBuffer():r.type==="json"?O.json():O.text()).then(J=>{y||(Z&&H&&function(ge,me,Pe){if(vt(),!Qe)return;const Ge={status:me.status,statusText:me.statusText,headers:new Headers};me.headers.forEach((Ve,at)=>Ge.headers.set(at,Ve));const Me=fe(me.headers.get("Cache-Control")||"");Me["no-store"]||(Me["max-age"]&&Ge.headers.set("Expires",new Date(Pe+1e3*Me["max-age"]).toUTCString()),new Date(Ge.headers.get("Expires")).getTime()-Pe<42e4||function(Ve,at){if(Ie===void 0)try{new Response(new ReadableStream),Ie=!0}catch{Ie=!1}Ie?at(Ve.body):Ve.blob().then(at)}(me,Ve=>{const at=new Response(Ve,Ge);vt(),Qe&&Qe.then(st=>st.put(function(Lt){const Zt=Lt.indexOf("?");return Zt<0?Lt:Lt.slice(0,Zt)}(ge.url),at)).catch(st=>ne(st.message))}))}(h,Z,H),g=!0,e(null,J,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(J=>{y||e(new Error(J.message))})})(R,null,D):R.blob().then(O=>e(new et(R.status,R.statusText,r.url,O)))).catch(R=>{R.code!==20&&e(new Error(R.message))})})(),{cancel:()=>{y=!0,g||a.abort()}}}const nn=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(he()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!he()){const h=r.url.substring(0,r.url.indexOf("://"));return(Ke.REGISTERED_PROTOCOLS[h]||li)(r,e)}}if(!(/^file:/.test(a=r.url)||/^file:/.test(ht())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return li(r,e);if(he()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var a;return function(h,g){const y=new XMLHttpRequest;y.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const b in h.headers)y.setRequestHeader(b,h.headers[b]);return h.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=h.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let b=y.response;if(h.type==="json")try{b=JSON.parse(y.response)}catch(S){return g(S)}g(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const b=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new et(y.status,y.statusText,h.url,b))}},y.send(h.body),{cancel:()=>y.abort()}}(r,e)},ei=function(r,e){return nn(K(r,{type:"arrayBuffer"}),e)};function on(r){const e=window.document.createElement("a");return e.href=r,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ct,en;ct=[],en=0;const An=function(r,e){if(We.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),en>=Ke.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ct.push(y),y}en++;let a=!1;const h=()=>{if(!a)for(a=!0,en--;ct.length&&en<Ke.MAX_PARALLEL_IMAGE_REQUESTS;){const y=ct.shift(),{requestParameters:b,callback:S,cancelled:C}=y;C||(y.cancel=An(b,S).cancel)}},g=ei(r,(y,b,S,C)=>{h(),y?e(y):b&&function(D,R){typeof createImageBitmap=="function"?function(O,Z){const H=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(H).then(J=>{Z(null,J)}).catch(J=>{Z(new Error(`Could not load image because of ${J.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(D,R):function(O,Z){const H=new Image;H.onload=()=>{Z(null,H),URL.revokeObjectURL(H.src),H.onload=null,window.requestAnimationFrame(()=>{H.src=tt})},H.onerror=()=>Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const J=new Blob([new Uint8Array(O)],{type:"image/png"});H.src=O.byteLength?URL.createObjectURL(J):tt}(D,R)}(b,(D,R)=>{D!=null?e(D):R!=null&&e(null,R,{cacheControl:S,expires:C})})});return{cancel:()=>{g.cancel(),h()}}};function Dr(r,e,a){a[r]&&a[r].indexOf(e)!==-1||(a[r]=a[r]||[],a[r].push(e))}function sr(r,e,a){if(a&&a[r]){const h=a[r].indexOf(e);h!==-1&&a[r].splice(h,1)}}class Hn{constructor(e,a={}){K(this,a),this.type=e}}class Pr extends Hn{constructor(e,a={}){super("error",K({error:e},a))}}class ar{on(e,a){return this._listeners=this._listeners||{},Dr(e,a,this._listeners),this}off(e,a){return sr(e,a,this._listeners),sr(e,a,this._oneTimeListeners),this}once(e,a){return this._oneTimeListeners=this._oneTimeListeners||{},Dr(e,a,this._oneTimeListeners),this}fire(e,a){typeof e=="string"&&(e=new Hn(e,a||{}));const h=e.type;if(this.listens(h)){e.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const S of g)S.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const S of y)sr(h,S,this._oneTimeListeners),S.call(this,e);const b=this._eventedParent;b&&(K(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(e))}else e instanceof Pr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,a){return this._eventedParent=e,this._eventedParentData=a,this}}var Ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class It{constructor(e,a,h,g){this.message=(e?`${e}: `:"")+h,g&&(this.identifier=g),a!=null&&a.__line__&&(this.line=a.__line__)}}function Lr(r){const e=r.value;return e?[new It(r.key,e,"constants have been deprecated as of v8")]:[]}function Un(r,...e){for(const a of e)for(const h in a)r[h]=a[h];return r}function ki(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ei(r){if(Array.isArray(r))return r.map(Ei);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const a in r)e[a]=Ei(r[a]);return e}return ki(r)}class cn extends Error{constructor(e,a){super(a),this.message=a,this.key=e}}class kn{constructor(e,a=[]){this.parent=e,this.bindings={};for(const[h,g]of a)this.bindings[h]=g}concat(e){return new kn(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const or={kind:"null"},xt={kind:"number"},ci={kind:"string"},ai={kind:"boolean"},mn={kind:"color"},Bn={kind:"object"},ri={kind:"value"},dr={kind:"collator"},un={kind:"formatted"},Kr={kind:"padding"},rn={kind:"resolvedImage"};function Tn(r,e){return{kind:"array",itemType:r,N:e}}function Li(r){if(r.kind==="array"){const e=Li(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Br=[or,xt,ci,ai,mn,un,Bn,Tn(ri),Kr,rn];function Kn(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Kn(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const a of Br)if(!Kn(a,e))return null}}return`Expected ${Li(r)} but found ${Li(e)} instead.`}function Rr(r,e){return e.some(a=>a.kind===r.kind)}function kr(r,e){return e.some(a=>a==="null"?r===null:a==="array"?Array.isArray(r):a==="object"?r&&!Array.isArray(r)&&typeof r=="object":a===typeof r)}var Yr,mr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function te(r){return(r=Math.round(r))<0?0:r>255?255:r}function L(r){return te(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function N(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function $(r,e,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?r+(e-r)*a*6:2*a<1?e:3*a<2?r+(e-r)*(2/3-a)*6:r}try{Yr={}.parseCSSColor=function(r){var e,a=r.replace(/ /g,"").toLowerCase();if(a in mr)return mr[a].slice();if(a[0]==="#")return a.length===4?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:a.length===7&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var h=a.indexOf("("),g=a.indexOf(")");if(h!==-1&&g+1===a.length){var y=a.substr(0,h),b=a.substr(h+1,g-(h+1)).split(","),S=1;switch(y){case"rgba":if(b.length!==4)return null;S=N(b.pop());case"rgb":return b.length!==3?null:[L(b[0]),L(b[1]),L(b[2]),S];case"hsla":if(b.length!==4)return null;S=N(b.pop());case"hsl":if(b.length!==3)return null;var C=(parseFloat(b[0])%360+360)%360/360,D=N(b[1]),R=N(b[2]),O=R<=.5?R*(D+1):R+D-R*D,Z=2*R-O;return[te(255*$(Z,O,C+1/3)),te(255*$(Z,O,C)),te(255*$(Z,O,C-1/3)),S];default:return null}}return null}}catch{}class ee{constructor(e,a,h,g=1){this.r=e,this.g=a,this.b=h,this.a=g}static parse(e){if(!e)return;if(e instanceof ee)return e;if(typeof e!="string")return;const a=Yr(e);return a?new ee(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[e,a,h,g]=this.toArray();return`rgba(${Math.round(e)},${Math.round(a)},${Math.round(h)},${g})`}toArray(){const{r:e,g:a,b:h,a:g}=this;return g===0?[0,0,0,0]:[255*e/g,255*a/g,255*h/g,g]}}ee.black=new ee(0,0,0,1),ee.white=new ee(1,1,1,1),ee.transparent=new ee(0,0,0,0),ee.red=new ee(1,0,0,1);class ye{constructor(e,a,h){this.sensitivity=e?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,a){return this.collator.compare(e,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Se{constructor(e,a,h,g,y){this.text=e,this.image=a,this.scale=h,this.fontStack=g,this.textColor=y}}class xe{constructor(e){this.sections=e}static fromString(e){return new xe([new Se(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof xe?e:xe.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class _e{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof _e)return e;if(typeof e=="number")return new _e([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const a of e)if(typeof a!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new _e(e)}}toString(){return JSON.stringify(this.values)}}class Ae{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ae({name:e,available:!1}):null}}function Xe(r,e,a,h){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[r,e,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[r,e,a,h]:[r,e,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ut(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof ee||r instanceof ye||r instanceof xe||r instanceof _e||r instanceof Ae)return!0;if(Array.isArray(r)){for(const e of r)if(!ut(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ut(r[e]))return!1;return!0}return!1}function je(r){if(r===null)return or;if(typeof r=="string")return ci;if(typeof r=="boolean")return ai;if(typeof r=="number")return xt;if(r instanceof ee)return mn;if(r instanceof ye)return dr;if(r instanceof xe)return un;if(r instanceof _e)return Kr;if(r instanceof Ae)return rn;if(Array.isArray(r)){const e=r.length;let a;for(const h of r){const g=je(h);if(a){if(a===g)continue;a=ri;break}a=g}return Tn(a||ri,e)}return Bn}function qt(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ee||r instanceof xe||r instanceof _e||r instanceof Ae?r.toString():JSON.stringify(r)}class jt{constructor(e,a){this.type=e,this.value=a}static parse(e,a){if(e.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ut(e[1]))return a.error("invalid value");const h=e[1];let g=je(h);const y=a.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new jt(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ie{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const mt={string:ci,number:xt,boolean:ai,object:Bn};class At{constructor(e,a){this.type=e,this.args=a}static parse(e,a){if(e.length<2)return a.error("Expected at least one argument.");let h,g=1;const y=e[0];if(y==="array"){let S,C;if(e.length>2){const D=e[1];if(typeof D!="string"||!(D in mt)||D==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);S=mt[D],g++}else S=ri;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=e[2],g++}h=Tn(S,C)}else{if(!mt[y])throw new Error(`Types doesn't contain name = ${y}`);h=mt[y]}const b=[];for(;g<e.length;g++){const S=a.parse(e[g],g,ri);if(!S)return null;b.push(S)}return new At(h,b)}evaluate(e){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(e);if(!Kn(this.type,je(h)))return h;if(a===this.args.length-1)throw new ie(`Expected value to be of type ${Li(this.type)}, but found ${Li(je(h))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const oi={"to-boolean":ai,"to-color":mn,"to-number":xt,"to-string":ci};class Qt{constructor(e,a){this.type=e,this.args=a}static parse(e,a){if(e.length<2)return a.error("Expected at least one argument.");const h=e[0];if(!oi[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&e.length!==2)return a.error("Expected one argument.");const g=oi[h],y=[];for(let b=1;b<e.length;b++){const S=a.parse(e[b],b,ri);if(!S)return null;y.push(S)}return new Qt(g,y)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let a,h;for(const g of this.args){if(a=g.evaluate(e),h=null,a instanceof ee)return a;if(typeof a=="string"){const y=e.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Xe(a[0],a[1],a[2],a[3]),!h))return new ee(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ie(h||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}if(this.type.kind==="padding"){let a;for(const h of this.args){a=h.evaluate(e);const g=_e.parse(a);if(g)return g}throw new ie(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}if(this.type.kind==="number"){let a=null;for(const h of this.args){if(a=h.evaluate(e),a===null)return 0;const g=Number(a);if(!isNaN(g))return g}throw new ie(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?xe.fromString(qt(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ae.fromString(qt(this.args[0].evaluate(e))):qt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ti=["Unknown","Point","LineString","Polygon"];class Ci{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let a=this._parseColorCache[e];return a||(a=this._parseColorCache[e]=ee.parse(e)),a}}class Vi{constructor(e,a,h,g){this.name=e,this.type=a,this._evaluate=h,this.args=g}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,a){const h=e[0],g=Vi.definitions[h];if(!g)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,S=b.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let C=null;for(const[D,R]of S){C=new Ts(a.registry,a.path,null,a.scope);const O=[];let Z=!1;for(let H=1;H<e.length;H++){const J=e[H],ge=Array.isArray(D)?D[H-1]:D.type,me=C.parse(J,1+O.length,ge);if(!me){Z=!0;break}O.push(me)}if(!Z)if(Array.isArray(D)&&D.length!==O.length)C.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let H=0;H<O.length;H++){const J=Array.isArray(D)?D[H]:D.type,ge=O[H];C.concat(H+1).checkSubtype(J,ge.type)}if(C.errors.length===0)return new Vi(h,y,R,O)}}if(S.length===1)a.errors.push(...C.errors);else{const D=(S.length?S:b).map(([O])=>{return Z=O,Array.isArray(Z)?`(${Z.map(Li).join(", ")})`:`(${Li(Z.type)}...)`;var Z}).join(" | "),R=[];for(let O=1;O<e.length;O++){const Z=a.parse(e[O],1+R.length);if(!Z)return null;R.push(Li(Z.type))}a.error(`Expected arguments of type ${D}, but found (${R.join(", ")}) instead.`)}return null}static register(e,a){Vi.definitions=a;for(const h in a)e[h]=Vi}}class yn{constructor(e,a,h){this.type=dr,this.locale=h,this.caseSensitive=e,this.diacriticSensitive=a}static parse(e,a){if(e.length!==2)return a.error("Expected one argument.");const h=e[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const g=a.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ai);if(!g)return null;const y=a.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ai);if(!y)return null;let b=null;return h.locale&&(b=a.parse(h.locale,1,ci),!b)?null:new yn(g,y,b)}evaluate(e){return new ye(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Wi=8192;function Cn(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Is(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function qs(r,e){const a=(180+r[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,g=Math.pow(2,e.z);return[Math.round(a*g*Wi),Math.round(h*g*Wi)]}function Ni(r,e,a){const h=r[0]-e[0],g=r[1]-e[1],y=r[0]-a[0],b=r[1]-a[1];return h*b-y*g==0&&h*y<=0&&g*b<=0}function lo(r,e){let a=!1;for(let b=0,S=e.length;b<S;b++){const C=e[b];for(let D=0,R=C.length;D<R-1;D++){if(Ni(r,C[D],C[D+1]))return!1;(g=C[D])[1]>(h=r)[1]!=(y=C[D+1])[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}}var h,g,y;return a}function co(r,e){for(let a=0;a<e.length;a++)if(lo(r,e[a]))return!0;return!1}function Il(r,e,a,h){const g=h[0]-a[0],y=h[1]-a[1],b=(r[0]-a[0])*y-g*(r[1]-a[1]),S=(e[0]-a[0])*y-g*(e[1]-a[1]);return b>0&&S<0||b<0&&S>0}function kl(r,e,a){for(const D of a)for(let R=0;R<D.length-1;++R)if((S=[(b=D[R+1])[0]-(y=D[R])[0],b[1]-y[1]])[0]*(C=[(g=e)[0]-(h=r)[0],g[1]-h[1]])[1]-S[1]*C[0]!=0&&Il(h,g,y,b)&&Il(y,b,h,g))return!0;var h,g,y,b,S,C;return!1}function uo(r,e){for(let a=0;a<r.length;++a)if(!lo(r[a],e))return!1;for(let a=0;a<r.length-1;++a)if(kl(r[a],r[a+1],e))return!1;return!0}function Wc(r,e){for(let a=0;a<e.length;a++)if(uo(r,e[a]))return!0;return!1}function Ia(r,e,a){const h=[];for(let g=0;g<r.length;g++){const y=[];for(let b=0;b<r[g].length;b++){const S=qs(r[g][b],a);Cn(e,S),y.push(S)}h.push(y)}return h}function ho(r,e,a){const h=[];for(let g=0;g<r.length;g++){const y=Ia(r[g],e,a);h.push(y)}return h}function Tl(r,e,a,h){if(r[0]<a[0]||r[0]>a[2]){const g=.5*h;let y=r[0]-a[0]>g?-h:a[0]-r[0]>g?h:0;y===0&&(y=r[0]-a[2]>g?-h:a[2]-r[0]>g?h:0),r[0]+=y}Cn(e,r)}function Sl(r,e,a,h){const g=Math.pow(2,h.z)*Wi,y=[h.x*Wi,h.y*Wi],b=[];for(const S of r)for(const C of S){const D=[C.x+y[0],C.y+y[1]];Tl(D,e,a,g),b.push(D)}return b}function El(r,e,a,h){const g=Math.pow(2,h.z)*Wi,y=[h.x*Wi,h.y*Wi],b=[];for(const C of r){const D=[];for(const R of C){const O=[R.x+y[0],R.y+y[1]];Cn(e,O),D.push(O)}b.push(D)}if(e[2]-e[0]<=g/2){(S=e)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const C of b)for(const D of C)Tl(D,e,a,g)}var S;return b}class os{constructor(e,a){this.type=ai,this.geojson=e,this.geometries=a}static parse(e,a){if(e.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ut(e[1])){const h=e[1];if(h.type==="FeatureCollection")for(let g=0;g<h.features.length;++g){const y=h.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new os(h,h.features[g].geometry)}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new os(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new os(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(a,h){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=a.canonicalID();if(h.type==="Polygon"){const S=Ia(h.coordinates,y,b),C=Sl(a.geometry(),g,y,b);if(!Is(g,y))return!1;for(const D of C)if(!lo(D,S))return!1}if(h.type==="MultiPolygon"){const S=ho(h.coordinates,y,b),C=Sl(a.geometry(),g,y,b);if(!Is(g,y))return!1;for(const D of C)if(!co(D,S))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(a,h){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=a.canonicalID();if(h.type==="Polygon"){const S=Ia(h.coordinates,y,b),C=El(a.geometry(),g,y,b);if(!Is(g,y))return!1;for(const D of C)if(!uo(D,S))return!1}if(h.type==="MultiPolygon"){const S=ho(h.coordinates,y,b),C=El(a.geometry(),g,y,b);if(!Is(g,y))return!1;for(const D of C)if(!Wc(D,S))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function js(r){if(r instanceof Vi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof os)return!1;let e=!0;return r.eachChild(a=>{e&&!js(a)&&(e=!1)}),e}function ks(r){if(r instanceof Vi&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(a=>{e&&!ks(a)&&(e=!1)}),e}function ka(r,e){if(r instanceof Vi&&e.indexOf(r.name)>=0)return!1;let a=!0;return r.eachChild(h=>{a&&!ka(h,e)&&(a=!1)}),a}class Ta{constructor(e,a){this.type=a.type,this.name=e,this.boundExpression=a}static parse(e,a){if(e.length!==2||typeof e[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=e[1];return a.scope.has(h)?new Ta(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Ts{constructor(e,a=[],h,g=new kn,y=[]){this.registry=e,this.path=a,this.key=a.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h}parse(e,a,h,g,y={}){return a?this.concat(a,h,g)._parse(e,y):this._parse(e,y)}_parse(e,a){function h(g,y,b){return b==="assert"?new At(y,[g]):b==="coerce"?new Qt(y,[g]):g}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=e[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let b=y.parse(e,this);if(!b)return null;if(this.expectedType){const S=this.expectedType,C=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||C.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(S.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array"){if(this.checkSubtype(S,C))return null}else b=h(b,S,a.typeAnnotation||"coerce");else b=h(b,S,a.typeAnnotation||"coerce");else b=h(b,S,a.typeAnnotation||"assert")}if(!(b instanceof jt)&&b.type.kind!=="resolvedImage"&&fo(b)){const S=new Ci;try{b=new jt(b.type,b.evaluate(S))}catch(C){return this.error(C.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,a,h){const g=typeof e=="number"?this.path.concat(e):this.path,y=h?this.scope.concat(h):this.scope;return new Ts(this.registry,g,a||null,y,this.errors)}error(e,...a){const h=`${this.key}${a.map(g=>`[${g}]`).join("")}`;this.errors.push(new cn(h,e))}checkSubtype(e,a){const h=Kn(e,a);return h&&this.error(h),h}}function fo(r){if(r instanceof Ta)return fo(r.boundExpression);if(r instanceof Vi&&r.name==="error"||r instanceof yn||r instanceof os)return!1;const e=r instanceof Qt||r instanceof At;let a=!0;return r.eachChild(h=>{a=e?a&&fo(h):a&&h instanceof jt}),!!a&&js(r)&&ka(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Sa(r,e){const a=r.length-1;let h,g,y=0,b=a,S=0;for(;y<=b;)if(S=Math.floor((y+b)/2),h=r[S],g=r[S+1],h<=e){if(S===a||e<g)return S;y=S+1}else{if(!(h>e))throw new ie("Input is not a number.");b=S-1}return 0}class Zs{constructor(e,a,h){this.type=e,this.input=a,this.labels=[],this.outputs=[];for(const[g,y]of h)this.labels.push(g),this.outputs.push(y)}static parse(e,a){if(e.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(e[1],1,xt);if(!h)return null;const g=[];let y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(let b=1;b<e.length;b+=2){const S=b===1?-1/0:e[b],C=e[b+1],D=b,R=b+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=a.parse(C,R,y);if(!O)return null;y=y||O.type,g.push([S,O])}return new Zs(y,h,g)}evaluate(e){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(e);const g=this.input.evaluate(e);if(g<=a[0])return h[0].evaluate(e);const y=a.length;return g>=a[y-1]?h[y-1].evaluate(e):h[Sa(a,g)].evaluate(e)}eachChild(e){e(this.input);for(const a of this.outputs)e(a)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Hi(r,e,a){return r*(1-a)+e*a}var Xs=Object.freeze({__proto__:null,number:Hi,color:function(r,e,a){return new ee(Hi(r.r,e.r,a),Hi(r.g,e.g,a),Hi(r.b,e.b,a),Hi(r.a,e.a,a))},array:function(r,e,a){return r.map((h,g)=>Hi(h,e[g],a))},padding:function(r,e,a){const h=r.values,g=e.values;return new _e([Hi(h[0],g[0],a),Hi(h[1],g[1],a),Hi(h[2],g[2],a),Hi(h[3],g[3],a)])}});const Al=.95047,Cl=1.08883,mo=4/29,Ea=6/29,Ml=3*Ea*Ea,Hc=Math.PI/180,Kc=180/Math.PI;function po(r){return r>.008856451679035631?Math.pow(r,1/3):r/Ml+mo}function go(r){return r>Ea?r*r*r:Ml*(r-mo)}function _o(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function yo(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Di(r){const e=yo(r.r),a=yo(r.g),h=yo(r.b),g=po((.4124564*e+.3575761*a+.1804375*h)/Al),y=po((.2126729*e+.7151522*a+.072175*h)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-po((.0193339*e+.119192*a+.9503041*h)/Cl)),alpha:r.a}}function zl(r){let e=(r.l+16)/116,a=isNaN(r.a)?e:e+r.a/500,h=isNaN(r.b)?e:e-r.b/200;return e=1*go(e),a=Al*go(a),h=Cl*go(h),new ee(_o(3.2404542*a-1.5371385*e-.4985314*h),_o(-.969266*a+1.8760108*e+.041556*h),_o(.0556434*a-.2040259*e+1.0572252*h),r.alpha)}function Yc(r,e,a){const h=e-r;return r+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const Ws={forward:Di,reverse:zl,interpolate:function(r,e,a){return{l:Hi(r.l,e.l,a),a:Hi(r.a,e.a,a),b:Hi(r.b,e.b,a),alpha:Hi(r.alpha,e.alpha,a)}}},Hs={forward:function(r){const{l:e,a,b:h}=Di(r),g=Math.atan2(h,a)*Kc;return{h:g<0?g+360:g,c:Math.sqrt(a*a+h*h),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Hc,a=r.c;return zl({l:r.l,a:Math.cos(e)*a,b:Math.sin(e)*a,alpha:r.alpha})},interpolate:function(r,e,a){return{h:Yc(r.h,e.h,a),c:Hi(r.c,e.c,a),l:Hi(r.l,e.l,a),alpha:Hi(r.alpha,e.alpha,a)}}};var Dl=Object.freeze({__proto__:null,lab:Ws,hcl:Hs});class Yn{constructor(e,a,h,g,y){this.type=e,this.operator=a,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[b,S]of y)this.labels.push(b),this.outputs.push(S)}static interpolationFactor(e,a,h,g){let y=0;if(e.name==="exponential")y=vo(a,e.base,h,g);else if(e.name==="linear")y=vo(a,1,h,g);else if(e.name==="cubic-bezier"){const b=e.controlPoints;y=new x(b[0],b[1],b[2],b[3]).solve(vo(a,1,h,g))}return y}static parse(e,a){let[h,g,y,...b]=e;if(!Array.isArray(g)||g.length===0)return a.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(R=>typeof R!="number"||R<0||R>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,xt),!y)return null;const S=[];let C=null;h==="interpolate-hcl"||h==="interpolate-lab"?C=mn:a.expectedType&&a.expectedType.kind!=="value"&&(C=a.expectedType);for(let D=0;D<b.length;D+=2){const R=b[D],O=b[D+1],Z=D+3,H=D+4;if(typeof R!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(S.length&&S[S.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const J=a.parse(O,H,C);if(!J)return null;C=C||J.type,S.push([R,J])}return C.kind==="number"||C.kind==="color"||C.kind==="padding"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Yn(C,h,g,y,S):a.error(`Type ${Li(C)} is not interpolatable.`)}evaluate(e){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(e);const g=this.input.evaluate(e);if(g<=a[0])return h[0].evaluate(e);const y=a.length;if(g>=a[y-1])return h[y-1].evaluate(e);const b=Sa(a,g),S=Yn.interpolationFactor(this.interpolation,g,a[b],a[b+1]),C=h[b].evaluate(e),D=h[b+1].evaluate(e);return this.operator==="interpolate"?Xs[this.type.kind.toLowerCase()](C,D,S):this.operator==="interpolate-hcl"?Hs.reverse(Hs.interpolate(Hs.forward(C),Hs.forward(D),S)):Ws.reverse(Ws.interpolate(Ws.forward(C),Ws.forward(D),S))}eachChild(e){e(this.input);for(const a of this.outputs)e(a)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function vo(r,e,a,h){const g=h-a,y=r-a;return g===0?0:e===1?y/g:(Math.pow(e,y)-1)/(Math.pow(e,g)-1)}class Aa{constructor(e,a){this.type=e,this.args=a}static parse(e,a){if(e.length<2)return a.error("Expectected at least one argument.");let h=null;const g=a.expectedType;g&&g.kind!=="value"&&(h=g);const y=[];for(const S of e.slice(1)){const C=a.parse(S,1+y.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,y.push(C)}if(!h)throw new Error("No output type");const b=g&&y.some(S=>Kn(g,S.type));return new Aa(b?ri:h,y)}evaluate(e){let a,h=null,g=0;for(const y of this.args)if(g++,h=y.evaluate(e),h&&h instanceof Ae&&!h.available&&(a||(a=h.name),h=null,g===this.args.length&&(h=a)),h!==null)break;return h}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Ca{constructor(e,a){this.type=a.type,this.bindings=[].concat(e),this.result=a}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const a of this.bindings)e(a[1]);e(this.result)}static parse(e,a){if(e.length<4)return a.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const h=[];for(let y=1;y<e.length-1;y+=2){const b=e[y];if(typeof b!="string")return a.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const S=a.parse(e[y+1],y+1);if(!S)return null;h.push([b,S])}const g=a.parse(e[e.length-1],e.length-1,a.expectedType,h);return g?new Ca(h,g):null}outputDefined(){return this.result.outputDefined()}}class bo{constructor(e,a,h){this.type=e,this.index=a,this.input=h}static parse(e,a){if(e.length!==3)return a.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=a.parse(e[1],1,xt),g=a.parse(e[2],2,Tn(a.expectedType||ri));return h&&g?new bo(g.type.itemType,h,g):null}evaluate(e){const a=this.index.evaluate(e),h=this.input.evaluate(e);if(a<0)throw new ie(`Array index out of bounds: ${a} < 0.`);if(a>=h.length)throw new ie(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a!==Math.floor(a))throw new ie(`Array index must be an integer, but found ${a} instead.`);return h[a]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class xo{constructor(e,a){this.type=ai,this.needle=e,this.haystack=a}static parse(e,a){if(e.length!==3)return a.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const h=a.parse(e[1],1,ri),g=a.parse(e[2],2,ri);return h&&g?Rr(h.type,[ai,ci,xt,or,ri])?new xo(h,g):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(h.type)} instead`):null}evaluate(e){const a=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!h)return!1;if(!kr(a,["boolean","string","number","null"]))throw new ie(`Expected first argument to be of type boolean, string, number or null, but found ${Li(je(a))} instead.`);if(!kr(h,["string","array"]))throw new ie(`Expected second argument to be of type array or string, but found ${Li(je(h))} instead.`);return h.indexOf(a)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ma{constructor(e,a,h){this.type=xt,this.needle=e,this.haystack=a,this.fromIndex=h}static parse(e,a){if(e.length<=2||e.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=a.parse(e[1],1,ri),g=a.parse(e[2],2,ri);if(!h||!g)return null;if(!Rr(h.type,[ai,ci,xt,or,ri]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(h.type)} instead`);if(e.length===4){const y=a.parse(e[3],3,xt);return y?new Ma(h,g,y):null}return new Ma(h,g)}evaluate(e){const a=this.needle.evaluate(e),h=this.haystack.evaluate(e);if(!kr(a,["boolean","string","number","null"]))throw new ie(`Expected first argument to be of type boolean, string, number or null, but found ${Li(je(a))} instead.`);if(!kr(h,["string","array"]))throw new ie(`Expected second argument to be of type array or string, but found ${Li(je(h))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(e);return h.indexOf(a,g)}return h.indexOf(a)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class wo{constructor(e,a,h,g,y,b){this.inputType=e,this.type=a,this.input=h,this.cases=g,this.outputs=y,this.otherwise=b}static parse(e,a){if(e.length<5)return a.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return a.error("Expected an even number of arguments.");let h,g;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);const y={},b=[];for(let D=2;D<e.length-1;D+=2){let R=e[D];const O=e[D+1];Array.isArray(R)||(R=[R]);const Z=a.concat(D);if(R.length===0)return Z.error("Expected at least one branch label.");for(const J of R){if(typeof J!="number"&&typeof J!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return Z.error("Numeric branch labels must be integer values.");if(h){if(Z.checkSubtype(h,je(J)))return null}else h=je(J);if(y[String(J)]!==void 0)return Z.error("Branch labels must be unique.");y[String(J)]=b.length}const H=a.parse(O,D,g);if(!H)return null;g=g||H.type,b.push(H)}const S=a.parse(e[1],1,ri);if(!S)return null;const C=a.parse(e[e.length-1],e.length-1,g);return C?S.type.kind!=="value"&&a.concat(1).checkSubtype(h,S.type)?null:new wo(h,g,S,y,b,C):null}evaluate(e){const a=this.input.evaluate(e);return(je(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Io{constructor(e,a,h){this.type=e,this.branches=a,this.otherwise=h}static parse(e,a){if(e.length<4)return a.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const g=[];for(let b=1;b<e.length-1;b+=2){const S=a.parse(e[b],b,ai);if(!S)return null;const C=a.parse(e[b+1],b+1,h);if(!C)return null;g.push([S,C]),h=h||C.type}const y=a.parse(e[e.length-1],e.length-1,h);if(!y)return null;if(!h)throw new Error("Can't infer output type");return new Io(h,g,y)}evaluate(e){for(const[a,h]of this.branches)if(a.evaluate(e))return h.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[a,h]of this.branches)e(a),e(h);e(this.otherwise)}outputDefined(){return this.branches.every(([e,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class za{constructor(e,a,h,g){this.type=e,this.input=a,this.beginIndex=h,this.endIndex=g}static parse(e,a){if(e.length<=2||e.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const h=a.parse(e[1],1,ri),g=a.parse(e[2],2,xt);if(!h||!g)return null;if(!Rr(h.type,[Tn(ri),ci,ri]))return a.error(`Expected first argument to be of type array or string, but found ${Li(h.type)} instead`);if(e.length===4){const y=a.parse(e[3],3,xt);return y?new za(h.type,h,g,y):null}return new za(h.type,h,g)}evaluate(e){const a=this.input.evaluate(e),h=this.beginIndex.evaluate(e);if(!kr(a,["string","array"]))throw new ie(`Expected first argument to be of type array or string, but found ${Li(je(a))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(e);return a.slice(h,g)}return a.slice(h)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Pl(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ll(r,e,a,h){return h.compare(e,a)===0}function Ss(r,e,a){const h=r!=="=="&&r!=="!=";return class $p{constructor(y,b,S){this.type=ai,this.lhs=y,this.rhs=b,this.collator=S,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}static parse(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");const S=y[0];let C=b.parse(y[1],1,ri);if(!C)return null;if(!Pl(S,C.type))return b.concat(1).error(`"${S}" comparisons are not supported for type '${Li(C.type)}'.`);let D=b.parse(y[2],2,ri);if(!D)return null;if(!Pl(S,D.type))return b.concat(2).error(`"${S}" comparisons are not supported for type '${Li(D.type)}'.`);if(C.type.kind!==D.type.kind&&C.type.kind!=="value"&&D.type.kind!=="value")return b.error(`Cannot compare types '${Li(C.type)}' and '${Li(D.type)}'.`);h&&(C.type.kind==="value"&&D.type.kind!=="value"?C=new At(D.type,[C]):C.type.kind!=="value"&&D.type.kind==="value"&&(D=new At(C.type,[D])));let R=null;if(y.length===4){if(C.type.kind!=="string"&&D.type.kind!=="string"&&C.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(y[3],3,dr),!R)return null}return new $p(C,D,R)}evaluate(y){const b=this.lhs.evaluate(y),S=this.rhs.evaluate(y);if(h&&this.hasUntypedArgument){const C=je(b),D=je(S);if(C.kind!==D.kind||C.kind!=="string"&&C.kind!=="number")throw new ie(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=je(b),D=je(S);if(C.kind!=="string"||D.kind!=="string")return e(y,b,S)}return this.collator?a(y,b,S,this.collator.evaluate(y)):e(y,b,S)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Jc=Ss("==",function(r,e,a){return e===a},Ll),Qc=Ss("!=",function(r,e,a){return e!==a},function(r,e,a,h){return!Ll(0,e,a,h)}),$c=Ss("<",function(r,e,a){return e<a},function(r,e,a,h){return h.compare(e,a)<0}),eu=Ss(">",function(r,e,a){return e>a},function(r,e,a,h){return h.compare(e,a)>0}),tu=Ss("<=",function(r,e,a){return e<=a},function(r,e,a,h){return h.compare(e,a)<=0}),iu=Ss(">=",function(r,e,a){return e>=a},function(r,e,a,h){return h.compare(e,a)>=0});class ko{constructor(e,a,h,g,y){this.type=ci,this.number=e,this.locale=a,this.currency=h,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(e,a){if(e.length!==3)return a.error("Expected two arguments.");const h=a.parse(e[1],1,xt);if(!h)return null;const g=e[2];if(typeof g!="object"||Array.isArray(g))return a.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=a.parse(g.locale,1,ci),!y))return null;let b=null;if(g.currency&&(b=a.parse(g.currency,1,ci),!b))return null;let S=null;if(g["min-fraction-digits"]&&(S=a.parse(g["min-fraction-digits"],1,xt),!S))return null;let C=null;return g["max-fraction-digits"]&&(C=a.parse(g["max-fraction-digits"],1,xt),!C)?null:new ko(h,y,b,S,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Da{constructor(e){this.type=un,this.sections=e}static parse(e,a){if(e.length<2)return a.error("Expected at least one argument.");const h=e[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const g=[];let y=!1;for(let b=1;b<=e.length-1;++b){const S=e[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;let C=null;if(S["font-scale"]&&(C=a.parse(S["font-scale"],1,xt),!C))return null;let D=null;if(S["text-font"]&&(D=a.parse(S["text-font"],1,Tn(ci)),!D))return null;let R=null;if(S["text-color"]&&(R=a.parse(S["text-color"],1,mn),!R))return null;const O=g[g.length-1];O.scale=C,O.font=D,O.textColor=R}else{const C=a.parse(e[b],1,ri);if(!C)return null;const D=C.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:C,scale:null,font:null,textColor:null})}}return new Da(g)}evaluate(e){return new xe(this.sections.map(a=>{const h=a.content.evaluate(e);return je(h)===rn?new Se("",h,null,null,null):new Se(qt(h),null,a.scale?a.scale.evaluate(e):null,a.font?a.font.evaluate(e).join(","):null,a.textColor?a.textColor.evaluate(e):null)}))}eachChild(e){for(const a of this.sections)e(a.content),a.scale&&e(a.scale),a.font&&e(a.font),a.textColor&&e(a.textColor)}outputDefined(){return!1}}class To{constructor(e){this.type=rn,this.input=e}static parse(e,a){if(e.length!==2)return a.error("Expected two arguments.");const h=a.parse(e[1],1,ci);return h?new To(h):a.error("No image name provided.")}evaluate(e){const a=this.input.evaluate(e),h=Ae.fromString(a);return h&&e.availableImages&&(h.available=e.availableImages.indexOf(a)>-1),h}eachChild(e){e(this.input)}outputDefined(){return!1}}class So{constructor(e){this.type=xt,this.input=e}static parse(e,a){if(e.length!==2)return a.error(`Expected 1 argument, but found ${e.length-1} instead.`);const h=a.parse(e[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Li(h.type)} instead.`):new So(h):null}evaluate(e){const a=this.input.evaluate(e);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ie(`Expected value to be of type string or array, but found ${Li(je(a))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Es={"==":Jc,"!=":Qc,">":eu,"<":$c,">=":iu,"<=":tu,array:At,at:bo,boolean:At,case:Io,coalesce:Aa,collator:yn,format:Da,image:To,in:xo,"index-of":Ma,interpolate:Yn,"interpolate-hcl":Yn,"interpolate-lab":Yn,length:So,let:Ca,literal:jt,match:wo,number:At,"number-format":ko,object:At,slice:za,step:Zs,string:At,"to-boolean":Qt,"to-color":Qt,"to-number":Qt,"to-string":Qt,var:Ta,within:os};function Bl(r,[e,a,h,g]){e=e.evaluate(r),a=a.evaluate(r),h=h.evaluate(r);const y=g?g.evaluate(r):1,b=Xe(e,a,h,y);if(b)throw new ie(b);return new ee(e/255*y,a/255*y,h/255*y,y)}function Rl(r,e){return r in e}function Pa(r,e){const a=e[r];return a===void 0?null:a}function ls(r){return{type:r}}function Fl(r){return{result:"success",value:r}}function As(r){return{result:"error",value:r}}function Zi(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Ol(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Si(r){return!!r.expression&&r.expression.interpolated}function Pi(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function ji(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ki(r){return r}function Ks(r,e){const a=e.type==="color",h=r.stops&&typeof r.stops[0][0]=="object",g=h||!(h||r.property!==void 0),y=r.type||(Si(e)?"exponential":"interval");if(a||e.type==="padding"){const D=a?ee.parse:_e.parse;(r=Un({},r)).stops&&(r.stops=r.stops.map(R=>[R[0],D(R[1])])),r.default=D(r.default?r.default:e.default)}if(r.colorSpace&&r.colorSpace!=="rgb"&&!Dl[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let b,S,C;if(y==="exponential")b=Vl;else if(y==="interval")b=ru;else if(y==="categorical"){b=nu,S=Object.create(null);for(const D of r.stops)S[D[0]]=D[1];C=typeof r.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=su}if(h){const D={},R=[];for(let H=0;H<r.stops.length;H++){const J=r.stops[H],ge=J[0].zoom;D[ge]===void 0&&(D[ge]={zoom:ge,type:r.type,property:r.property,default:r.default,stops:[]},R.push(ge)),D[ge].stops.push([J[0].value,J[1]])}const O=[];for(const H of R)O.push([D[H].zoom,Ks(D[H],e)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:Yn.interpolationFactor.bind(void 0,Z),zoomStops:O.map(H=>H[0]),evaluate:({zoom:H},J)=>Vl({stops:O,base:r.base},e,H).evaluate(H,J)}}if(g){const D=y==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Yn.interpolationFactor.bind(void 0,D),zoomStops:r.stops.map(R=>R[0]),evaluate:({zoom:R})=>b(r,e,R,S,C)}}return{kind:"source",evaluate(D,R){const O=R&&R.properties?R.properties[r.property]:void 0;return O===void 0?Cs(r.default,e.default):b(r,e,O,S,C)}}}function Cs(r,e,a){return r!==void 0?r:e!==void 0?e:a!==void 0?a:void 0}function nu(r,e,a,h,g){return Cs(typeof a===g?h[a]:void 0,r.default,e.default)}function ru(r,e,a){if(Pi(a)!=="number")return Cs(r.default,e.default);const h=r.stops.length;if(h===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[h-1][0])return r.stops[h-1][1];const g=Sa(r.stops.map(y=>y[0]),a);return r.stops[g][1]}function Vl(r,e,a){const h=r.base!==void 0?r.base:1;if(Pi(a)!=="number")return Cs(r.default,e.default);const g=r.stops.length;if(g===1||a<=r.stops[0][0])return r.stops[0][1];if(a>=r.stops[g-1][0])return r.stops[g-1][1];const y=Sa(r.stops.map(R=>R[0]),a),b=function(R,O,Z,H){const J=H-Z,ge=R-Z;return J===0?0:O===1?ge/J:(Math.pow(O,ge)-1)/(Math.pow(O,J)-1)}(a,h,r.stops[y][0],r.stops[y+1][0]),S=r.stops[y][1],C=r.stops[y+1][1];let D=Xs[e.type]||Ki;if(r.colorSpace&&r.colorSpace!=="rgb"){const R=Dl[r.colorSpace];D=(O,Z)=>R.reverse(R.interpolate(R.forward(O),R.forward(Z),b))}return typeof S.evaluate=="function"?{evaluate(...R){const O=S.evaluate.apply(void 0,R),Z=C.evaluate.apply(void 0,R);if(O!==void 0&&Z!==void 0)return D(O,Z,b)}}:D(S,C,b)}function su(r,e,a){switch(e.type){case"color":a=ee.parse(a);break;case"formatted":a=xe.fromString(a.toString());break;case"resolvedImage":a=Ae.fromString(a.toString());break;case"padding":a=_e.parse(a);break;default:Pi(a)===e.type||e.type==="enum"&&e.values[a]||(a=void 0)}return Cs(a,r.default,e.default)}Vi.register(Es,{error:[{kind:"error"},[ci],(r,[e])=>{throw new ie(e.evaluate(r))}],typeof:[ci,[ri],(r,[e])=>Li(je(e.evaluate(r)))],"to-rgba":[Tn(xt,4),[mn],(r,[e])=>e.evaluate(r).toArray()],rgb:[mn,[xt,xt,xt],Bl],rgba:[mn,[xt,xt,xt,xt],Bl],has:{type:ai,overloads:[[[ci],(r,[e])=>Rl(e.evaluate(r),r.properties())],[[ci,Bn],(r,[e,a])=>Rl(e.evaluate(r),a.evaluate(r))]]},get:{type:ri,overloads:[[[ci],(r,[e])=>Pa(e.evaluate(r),r.properties())],[[ci,Bn],(r,[e,a])=>Pa(e.evaluate(r),a.evaluate(r))]]},"feature-state":[ri,[ci],(r,[e])=>Pa(e.evaluate(r),r.featureState||{})],properties:[Bn,[],r=>r.properties()],"geometry-type":[ci,[],r=>r.geometryType()],id:[ri,[],r=>r.id()],zoom:[xt,[],r=>r.globals.zoom],"heatmap-density":[xt,[],r=>r.globals.heatmapDensity||0],"line-progress":[xt,[],r=>r.globals.lineProgress||0],accumulated:[ri,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[xt,ls(xt),(r,e)=>{let a=0;for(const h of e)a+=h.evaluate(r);return a}],"*":[xt,ls(xt),(r,e)=>{let a=1;for(const h of e)a*=h.evaluate(r);return a}],"-":{type:xt,overloads:[[[xt,xt],(r,[e,a])=>e.evaluate(r)-a.evaluate(r)],[[xt],(r,[e])=>-e.evaluate(r)]]},"/":[xt,[xt,xt],(r,[e,a])=>e.evaluate(r)/a.evaluate(r)],"%":[xt,[xt,xt],(r,[e,a])=>e.evaluate(r)%a.evaluate(r)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(r,[e,a])=>Math.pow(e.evaluate(r),a.evaluate(r))],sqrt:[xt,[xt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[xt,[xt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[xt,[xt],(r,[e])=>Math.log(e.evaluate(r))],log2:[xt,[xt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[xt,[xt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[xt,[xt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[xt,[xt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[xt,[xt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[xt,[xt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[xt,[xt],(r,[e])=>Math.atan(e.evaluate(r))],min:[xt,ls(xt),(r,e)=>Math.min(...e.map(a=>a.evaluate(r)))],max:[xt,ls(xt),(r,e)=>Math.max(...e.map(a=>a.evaluate(r)))],abs:[xt,[xt],(r,[e])=>Math.abs(e.evaluate(r))],round:[xt,[xt],(r,[e])=>{const a=e.evaluate(r);return a<0?-Math.round(-a):Math.round(a)}],floor:[xt,[xt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[xt,[xt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ai,[ci,ri],(r,[e,a])=>r.properties()[e.value]===a.value],"filter-id-==":[ai,[ri],(r,[e])=>r.id()===e.value],"filter-type-==":[ai,[ci],(r,[e])=>r.geometryType()===e.value],"filter-<":[ai,[ci,ri],(r,[e,a])=>{const h=r.properties()[e.value],g=a.value;return typeof h==typeof g&&h<g}],"filter-id-<":[ai,[ri],(r,[e])=>{const a=r.id(),h=e.value;return typeof a==typeof h&&a<h}],"filter->":[ai,[ci,ri],(r,[e,a])=>{const h=r.properties()[e.value],g=a.value;return typeof h==typeof g&&h>g}],"filter-id->":[ai,[ri],(r,[e])=>{const a=r.id(),h=e.value;return typeof a==typeof h&&a>h}],"filter-<=":[ai,[ci,ri],(r,[e,a])=>{const h=r.properties()[e.value],g=a.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[ai,[ri],(r,[e])=>{const a=r.id(),h=e.value;return typeof a==typeof h&&a<=h}],"filter->=":[ai,[ci,ri],(r,[e,a])=>{const h=r.properties()[e.value],g=a.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[ai,[ri],(r,[e])=>{const a=r.id(),h=e.value;return typeof a==typeof h&&a>=h}],"filter-has":[ai,[ri],(r,[e])=>e.value in r.properties()],"filter-has-id":[ai,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ai,[Tn(ci)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ai,[Tn(ri)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ai,[ci,Tn(ri)],(r,[e,a])=>a.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ai,[ci,Tn(ri)],(r,[e,a])=>function(h,g,y,b){for(;y<=b;){const S=y+b>>1;if(g[S]===h)return!0;g[S]>h?b=S-1:y=S+1}return!1}(r.properties()[e.value],a.value,0,a.value.length-1)],all:{type:ai,overloads:[[[ai,ai],(r,[e,a])=>e.evaluate(r)&&a.evaluate(r)],[ls(ai),(r,e)=>{for(const a of e)if(!a.evaluate(r))return!1;return!0}]]},any:{type:ai,overloads:[[[ai,ai],(r,[e,a])=>e.evaluate(r)||a.evaluate(r)],[ls(ai),(r,e)=>{for(const a of e)if(a.evaluate(r))return!0;return!1}]]},"!":[ai,[ai],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ai,[ci],(r,[e])=>{const a=r.globals&&r.globals.isSupportedScript;return!a||a(e.evaluate(r))}],upcase:[ci,[ci],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[ci,[ci],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[ci,ls(ri),(r,e)=>e.map(a=>qt(a.evaluate(r))).join("")],"resolved-locale":[ci,[dr],(r,[e])=>e.evaluate(r).resolvedLocale()]});class La{constructor(e,a){this.expression=e,this._warningHistory={},this._evaluator=new Ci,this._defaultValue=a?function(h){return h.type==="color"&&ji(h.default)?new ee(0,0,0,0):h.type==="color"?ee.parse(h.default)||null:h.type==="padding"?_e.parse(h.default)||null:h.default===void 0?null:h.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(e,a,h,g,y,b){return this._evaluator.globals=e,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(e,a,h,g,y,b){this._evaluator.globals=e,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new ie(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function Ys(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Es}function Js(r,e){const a=new Ts(Es,[],e?function(g){const y={color:mn,string:ci,number:xt,enum:ci,boolean:ai,formatted:un,padding:Kr,resolvedImage:rn};return g.type==="array"?Tn(y[g.value]||ri,g.length):y[g.type]}(e):void 0),h=a.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Fl(new La(h,e)):As(a.errors)}class Qs{constructor(e,a){this.kind=e,this._styleExpression=a,this.isStateDependent=e!=="constant"&&!ks(a.expression)}evaluateWithoutErrorHandling(e,a,h,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(e,a,h,g,y,b)}evaluate(e,a,h,g,y,b){return this._styleExpression.evaluate(e,a,h,g,y,b)}}class Eo{constructor(e,a,h,g){this.kind=e,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=e!=="camera"&&!ks(a.expression),this.interpolationType=g}evaluateWithoutErrorHandling(e,a,h,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(e,a,h,g,y,b)}evaluate(e,a,h,g,y,b){return this._styleExpression.evaluate(e,a,h,g,y,b)}interpolationFactor(e,a,h){return this.interpolationType?Yn.interpolationFactor(this.interpolationType,e,a,h):0}}function Nl(r,e){const a=Js(r,e);if(a.result==="error")return a;const h=a.value.expression,g=js(h);if(!g&&!Zi(e))return As([new cn("","data expressions not supported")]);const y=ka(h,["zoom"]);if(!y&&!Ol(e))return As([new cn("","zoom expressions not supported")]);const b=Ra(h);return b||y?b instanceof cn?As([b]):b instanceof Yn&&!Si(e)?As([new cn("",'"interpolate" expressions cannot be used with this property')]):Fl(b?new Eo(g?"camera":"composite",a.value,b.labels,b instanceof Yn?b.interpolation:void 0):new Qs(g?"constant":"source",a.value)):As([new cn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ba{constructor(e,a){this._parameters=e,this._specification=a,Un(this,Ks(this._parameters,this._specification))}static deserialize(e){return new Ba(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ra(r){let e=null;if(r instanceof Ca)e=Ra(r.result);else if(r instanceof Aa){for(const a of r.args)if(e=Ra(a),e)break}else(r instanceof Zs||r instanceof Yn)&&r.input instanceof Vi&&r.input.name==="zoom"&&(e=r);return e instanceof cn||r.eachChild(a=>{const h=Ra(a);h instanceof cn?e=h:!e&&h?e=new cn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&h&&e!==h&&(e=new cn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function pr(r){const e=r.key,a=r.value,h=r.valueSpec||{},g=r.objectElementValidators||{},y=r.style,b=r.styleSpec;let S=[];const C=Pi(a);if(C!=="object")return[new It(e,a,`object expected, ${C} found`)];for(const D in a){const R=D.split(".")[0],O=h[R]||h["*"];let Z;if(g[R])Z=g[R];else if(h[R])Z=Qn;else if(g["*"])Z=g["*"];else{if(!h["*"]){S.push(new It(e,a[D],`unknown property "${D}"`));continue}Z=Qn}S=S.concat(Z({key:(e&&`${e}.`)+D,value:a[D],valueSpec:O,style:y,styleSpec:b,object:a,objectKey:D},a))}for(const D in h)g[D]||h[D].required&&h[D].default===void 0&&a[D]===void 0&&S.push(new It(e,a,`missing required property "${D}"`));return S}function Ul(r){const e=r.value,a=r.valueSpec,h=r.style,g=r.styleSpec,y=r.key,b=r.arrayElementValidator||Qn;if(Pi(e)!=="array")return[new It(y,e,`array expected, ${Pi(e)} found`)];if(a.length&&e.length!==a.length)return[new It(y,e,`array length ${a.length} expected, length ${e.length} found`)];if(a["min-length"]&&e.length<a["min-length"])return[new It(y,e,`array length at least ${a["min-length"]} expected, length ${e.length} found`)];let S={type:a.value,values:a.values};g.$version<7&&(S.function=a.function),Pi(a.value)==="object"&&(S=a.value);let C=[];for(let D=0;D<e.length;D++)C=C.concat(b({array:e,arrayIndex:D,value:e[D],valueSpec:S,style:h,styleSpec:g,key:`${y}[${D}]`}));return C}function Ao(r){const e=r.key,a=r.value,h=r.valueSpec;let g=Pi(a);return g==="number"&&a!=a&&(g="NaN"),g!=="number"?[new It(e,a,`number expected, ${g} found`)]:"minimum"in h&&a<h.minimum?[new It(e,a,`${a} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&a>h.maximum?[new It(e,a,`${a} is greater than the maximum value ${h.maximum}`)]:[]}function Gl(r){const e=r.valueSpec,a=ki(r.value.type);let h,g,y,b={};const S=a!=="categorical"&&r.value.property===void 0,C=!S,D=Pi(r.value.stops)==="array"&&Pi(r.value.stops[0])==="array"&&Pi(r.value.stops[0][0])==="object",R=pr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(H){if(a==="identity")return[new It(H.key,H.value,'identity function may not have a "stops" property')];let J=[];const ge=H.value;return J=J.concat(Ul({key:H.key,value:ge,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:O})),Pi(ge)==="array"&&ge.length===0&&J.push(new It(H.key,ge,"array must have at least one stop")),J},default:function(H){return Qn({key:H.key,value:H.value,valueSpec:e,style:H.style,styleSpec:H.styleSpec})}}});return a==="identity"&&S&&R.push(new It(r.key,r.value,'missing required property "property"')),a==="identity"||r.value.stops||R.push(new It(r.key,r.value,'missing required property "stops"')),a==="exponential"&&r.valueSpec.expression&&!Si(r.valueSpec)&&R.push(new It(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(C&&!Zi(r.valueSpec)?R.push(new It(r.key,r.value,"property functions not supported")):S&&!Ol(r.valueSpec)&&R.push(new It(r.key,r.value,"zoom functions not supported"))),a!=="categorical"&&!D||r.value.property!==void 0||R.push(new It(r.key,r.value,'"property" property is required')),R;function O(H){let J=[];const ge=H.value,me=H.key;if(Pi(ge)!=="array")return[new It(me,ge,`array expected, ${Pi(ge)} found`)];if(ge.length!==2)return[new It(me,ge,`array length 2 expected, length ${ge.length} found`)];if(D){if(Pi(ge[0])!=="object")return[new It(me,ge,`object expected, ${Pi(ge[0])} found`)];if(ge[0].zoom===void 0)return[new It(me,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new It(me,ge,"object stop key must have value")];if(y&&y>ki(ge[0].zoom))return[new It(me,ge[0].zoom,"stop zoom values must appear in ascending order")];ki(ge[0].zoom)!==y&&(y=ki(ge[0].zoom),g=void 0,b={}),J=J.concat(pr({key:`${me}[0]`,value:ge[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Ao,value:Z}}))}else J=J.concat(Z({key:`${me}[0]`,value:ge[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},ge));return Ys(Ei(ge[1]))?J.concat([new It(`${me}[1]`,ge[1],"expressions are not allowed in function stops.")]):J.concat(Qn({key:`${me}[1]`,value:ge[1],valueSpec:e,style:H.style,styleSpec:H.styleSpec}))}function Z(H,J){const ge=Pi(H.value),me=ki(H.value),Pe=H.value!==null?H.value:J;if(h){if(ge!==h)return[new It(H.key,Pe,`${ge} stop domain type must match previous stop domain type ${h}`)]}else h=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new It(H.key,Pe,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&a!=="categorical"){let Ge=`number expected, ${ge} found`;return Zi(e)&&a===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(H.key,Pe,Ge)]}return a!=="categorical"||ge!=="number"||isFinite(me)&&Math.floor(me)===me?a!=="categorical"&&ge==="number"&&g!==void 0&&me<g?[new It(H.key,Pe,"stop domain values must appear in ascending order")]:(g=me,a==="categorical"&&me in b?[new It(H.key,Pe,"stop domain values must be unique")]:(b[me]=!0,[])):[new It(H.key,Pe,`integer expected, found ${me}`)]}}function cs(r){const e=(r.expressionContext==="property"?Nl:Js)(Ei(r.value),r.valueSpec);if(e.result==="error")return e.value.map(h=>new It(`${r.key}${h.key}`,r.value,h.message));const a=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!a.outputDefined())return[new It(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!ks(a))return[new It(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!ks(a))return[new It(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ka(a,["zoom","feature-state"]))return[new It(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!js(a))return[new It(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $s(r){const e=r.key,a=r.value,h=r.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(ki(a))===-1&&g.push(new It(e,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(h.values).indexOf(ki(a))===-1&&g.push(new It(e,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Ms(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Ms(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const au={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fa(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Ms(r)||(r=ea(r));const e=Js(r,au);if(e.result==="error")throw new Error(e.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,h,g)=>e.value.evaluate(a,h,{},g),needGeometry:jl(r)}}function ql(r,e){return r<e?-1:r>e?1:0}function jl(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(jl(r[e]))return!0;return!1}function ea(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Co(r[1],r[2],"=="):e==="!="?zs(Co(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Co(r[1],r[2],e):e==="any"?(a=r.slice(1),["any"].concat(a.map(ea))):e==="all"?["all"].concat(r.slice(1).map(ea)):e==="none"?["all"].concat(r.slice(1).map(ea).map(zs)):e==="in"?Oa(r[1],r.slice(2)):e==="!in"?zs(Oa(r[1],r.slice(2))):e==="has"?ta(r[1]):e==="!has"?zs(ta(r[1])):e!=="within"||r;var a}function Co(r,e,a){switch(r){case"$type":return[`filter-type-${a}`,e];case"$id":return[`filter-id-${a}`,e];default:return[`filter-${a}`,r,e]}}function Oa(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(a=>typeof a!=typeof e[0])?["filter-in-large",r,["literal",e.sort(ql)]]:["filter-in-small",r,["literal",e]]}}function ta(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function zs(r){return["!",r]}function ia(r){return Ms(Ei(r.value))?cs(Un({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Zl(r)}function Zl(r){const e=r.value,a=r.key;if(Pi(e)!=="array")return[new It(a,e,`array expected, ${Pi(e)} found`)];const h=r.styleSpec;let g,y=[];if(e.length<1)return[new It(a,e,"filter array must have at least 1 element")];switch(y=y.concat($s({key:`${a}[0]`,value:e[0],valueSpec:h.filter_operator,style:r.style,styleSpec:r.styleSpec})),ki(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ki(e[1])==="$type"&&y.push(new It(a,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&y.push(new It(a,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(g=Pi(e[1]),g!=="string"&&y.push(new It(`${a}[1]`,e[1],`string expected, ${g} found`)));for(let b=2;b<e.length;b++)g=Pi(e[b]),ki(e[1])==="$type"?y=y.concat($s({key:`${a}[${b}]`,value:e[b],valueSpec:h.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new It(`${a}[${b}]`,e[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<e.length;b++)y=y.concat(Zl({key:`${a}[${b}]`,value:e[b],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Pi(e[1]),e.length!==2?y.push(new It(a,e,`filter array for "${e[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new It(`${a}[1]`,e[1],`string expected, ${g} found`));break;case"within":g=Pi(e[1]),e.length!==2?y.push(new It(a,e,`filter array for "${e[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new It(`${a}[1]`,e[1],`object expected, ${g} found`))}return y}function na(r,e){const a=r.key,h=r.style,g=r.styleSpec,y=r.value,b=r.objectKey,S=g[`${e}_${r.layerType}`];if(!S)return[];const C=b.match(/^(.*)-transition$/);if(e==="paint"&&C&&S[C[1]]&&S[C[1]].transition)return Qn({key:a,value:y,valueSpec:g.transition,style:h,styleSpec:g});const D=r.valueSpec||S[b];if(!D)return[new It(a,y,`unknown property "${b}"`)];let R;if(Pi(y)==="string"&&Zi(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(y)))return[new It(a,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const O=[];return r.layerType==="symbol"&&(b==="text-field"&&h&&!h.glyphs&&O.push(new It(a,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&ji(Ei(y))&&ki(y.type)==="identity"&&O.push(new It(a,y,'"text-font" does not support identity functions'))),O.concat(Qn({key:r.key,value:y,valueSpec:D,style:h,styleSpec:g,expressionContext:"property",propertyType:e,propertyKey:b}))}function Xl(r){return na(r,"paint")}function Wl(r){return na(r,"layout")}function Hl(r){let e=[];const a=r.value,h=r.key,g=r.style,y=r.styleSpec;a.type||a.ref||e.push(new It(h,a,'either "type" or "ref" is required'));let b=ki(a.type);const S=ki(a.ref);if(a.id){const C=ki(a.id);for(let D=0;D<r.arrayIndex;D++){const R=g.layers[D];ki(R.id)===C&&e.push(new It(h,a.id,`duplicate layer id "${a.id}", previously used at line ${R.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in a&&e.push(new It(h,a[D],`"${D}" is prohibited for ref layers`))}),g.layers.forEach(D=>{ki(D.id)===S&&(C=D)}),C?C.ref?e.push(new It(h,a.ref,"ref cannot reference another ref layer")):b=ki(C.type):e.push(new It(h,a.ref,`ref layer "${S}" not found`))}else if(b!=="background")if(a.source){const C=g.sources&&g.sources[a.source],D=C&&ki(C.type);C?D==="vector"&&b==="raster"?e.push(new It(h,a.source,`layer "${a.id}" requires a raster source`)):D==="raster"&&b!=="raster"?e.push(new It(h,a.source,`layer "${a.id}" requires a vector source`)):D!=="vector"||a["source-layer"]?D==="raster-dem"&&b!=="hillshade"?e.push(new It(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!a.paint||!a.paint["line-gradient"]||D==="geojson"&&C.lineMetrics||e.push(new It(h,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new It(h,a,`layer "${a.id}" must specify a "source-layer"`)):e.push(new It(h,a.source,`source "${a.source}" not found`))}else e.push(new It(h,a,'missing required property "source"'));return e=e.concat(pr({key:h,value:a,valueSpec:y.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Qn({key:`${h}.type`,value:a.type,valueSpec:y.layer.type,style:r.style,styleSpec:r.styleSpec,object:a,objectKey:"type"}),filter:ia,layout:C=>pr({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Wl(Un({layerType:b},D))}}),paint:C=>pr({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Xl(Un({layerType:b},D))}})}})),e}function Ds(r){const e=r.value,a=r.key,h=Pi(e);return h!=="string"?[new It(a,e,`string expected, ${h} found`)]:[]}const Kl={promoteId:function({key:r,value:e}){if(Pi(e)==="string")return Ds({key:r,value:e});{const a=[];for(const h in e)a.push(...Ds({key:`${r}.${h}`,value:e[h]}));return a}}};function ra(r){const e=r.value,a=r.key,h=r.styleSpec,g=r.style;if(!e.type)return[new It(a,e,'"type" is required')];const y=ki(e.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=pr({key:a,value:e,valueSpec:h[`source_${y.replace("-","_")}`],style:r.style,styleSpec:h,objectElementValidators:Kl}),b;case"geojson":if(b=pr({key:a,value:e,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:Kl}),e.cluster)for(const S in e.clusterProperties){const[C,D]=e.clusterProperties[S],R=typeof C=="string"?[C,["accumulated"],["get",S]]:C;b.push(...cs({key:`${a}.${S}.map`,value:D,expressionContext:"cluster-map"})),b.push(...cs({key:`${a}.${S}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return b;case"video":return pr({key:a,value:e,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return pr({key:a,value:e,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new It(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $s({key:`${a}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:h})}}function sa(r){const e=r.value,a=r.styleSpec,h=a.light,g=r.style;let y=[];const b=Pi(e);if(e===void 0)return y;if(b!=="object")return y=y.concat([new It("light",e,`object expected, ${b} found`)]),y;for(const S in e){const C=S.match(/^(.*)-transition$/);y=y.concat(C&&h[C[1]]&&h[C[1]].transition?Qn({key:S,value:e[S],valueSpec:a.transition,style:g,styleSpec:a}):h[S]?Qn({key:S,value:e[S],valueSpec:h[S],style:g,styleSpec:a}):[new It(S,e[S],`unknown property "${S}"`)])}return y}function Jn(r){const e=r.value,a=r.styleSpec,h=a.terrain,g=r.style;let y=[];const b=Pi(e);if(e===void 0)return y;if(b!=="object")return y=y.concat([new It("terrain",e,`object expected, ${b} found`)]),y;for(const S in e)y=y.concat(h[S]?Qn({key:S,value:e[S],valueSpec:h[S],style:g,styleSpec:a}):[new It(S,e[S],`unknown property "${S}"`)]);return y}const aa={"*":()=>[],array:Ul,boolean:function(r){const e=r.value,a=r.key,h=Pi(e);return h!=="boolean"?[new It(a,e,`boolean expected, ${h} found`)]:[]},number:Ao,color:function(r){const e=r.key,a=r.value,h=Pi(a);return h!=="string"?[new It(e,a,`color expected, ${h} found`)]:Yr(a)===null?[new It(e,a,`color expected, "${a}" found`)]:[]},constants:Lr,enum:$s,filter:ia,function:Gl,layer:Hl,object:pr,source:ra,light:sa,terrain:Jn,string:Ds,formatted:function(r){return Ds(r).length===0?[]:cs(r)},resolvedImage:function(r){return Ds(r).length===0?[]:cs(r)},padding:function(r){const e=r.key,a=r.value;if(Pi(a)==="array"){if(a.length<1||a.length>4)return[new It(e,a,`padding requires 1 to 4 values; ${a.length} values found`)];const h={type:"number"};let g=[];for(let y=0;y<a.length;y++)g=g.concat(Qn({key:`${e}[${y}]`,value:a[y],valueSpec:h}));return g}return Ao({key:e,value:a,valueSpec:{}})}};function Qn(r){const e=r.value,a=r.valueSpec,h=r.styleSpec;return a.expression&&ji(ki(e))?Gl(r):a.expression&&Ys(Ei(e))?cs(r):a.type&&aa[a.type]?aa[a.type](r):pr(Un({},r,{valueSpec:a.type?h[a.type]:a}))}function ou(r){const e=r.value,a=r.key,h=Ds(r);return h.length||(e.indexOf("{fontstack}")===-1&&h.push(new It(a,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&h.push(new It(a,e,'"glyphs" url must include a "{range}" token'))),h}function Jr(r,e=Ye){let a=[];return a=a.concat(Qn({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:ou,"*":()=>[]}})),r.constants&&(a=a.concat(Lr({key:"constants",value:r.constants,style:r,styleSpec:e}))),Yl(a)}function Yl(r){return[].concat(r).sort((e,a)=>e.line-a.line)}function Fr(r){return function(...e){return Yl(r.apply(this,e))}}Jr.source=Fr(ra),Jr.light=Fr(sa),Jr.terrain=Fr(Jn),Jr.layer=Fr(Hl),Jr.filter=Fr(ia),Jr.paintProperty=Fr(Xl),Jr.layoutProperty=Fr(Wl);const oa=Jr,Mo=oa.light,lu=oa.paintProperty,cu=oa.layoutProperty;function Va(r,e){let a=!1;if(e&&e.length)for(const h of e)r.fire(new Pr(new Error(h.message))),a=!0;return a}class la{constructor(e,a,h){const g=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const b=new Int32Array(this.arrayBuffer);e=b[0],this.d=(a=b[1])+2*(h=b[2]);for(let C=0;C<this.d*this.d;C++){const D=b[3+C],R=b[3+C+1];g.push(D===R?null:b.subarray(D,R))}const S=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],S),this.bboxes=b.subarray(S),this.insert=this._insertReadonly}else{this.d=a+2*h;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=e,this.padding=h,this.scale=a/e,this.uid=0;const y=h/a*e;this.min=-y,this.max=e+y}insert(e,a,h,g,y){this._forEachCell(a,h,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,a,h,g,y,b){this.cells[y].push(b)}query(e,a,h,g,y){const b=this.min,S=this.max;if(e<=b&&a<=b&&S<=h&&S<=g&&!y)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(e,a,h,g,this._queryCell,C,{},y),C}}_queryCell(e,a,h,g,y,b,S,C){const D=this.cells[y];if(D!==null){const R=this.keys,O=this.bboxes;for(let Z=0;Z<D.length;Z++){const H=D[Z];if(S[H]===void 0){const J=4*H;(C?C(O[J+0],O[J+1],O[J+2],O[J+3]):e<=O[J+2]&&a<=O[J+3]&&h>=O[J+0]&&g>=O[J+1])?(S[H]=!0,b.push(R[H])):S[H]=!1}}}}_forEachCell(e,a,h,g,y,b,S,C){const D=this._convertToCellCoord(e),R=this._convertToCellCoord(a),O=this._convertToCellCoord(h),Z=this._convertToCellCoord(g);for(let H=D;H<=O;H++)for(let J=R;J<=Z;J++){const ge=this.d*J+H;if((!C||C(this._convertFromCellCoord(H),this._convertFromCellCoord(J),this._convertFromCellCoord(H+1),this._convertFromCellCoord(J+1)))&&y.call(this,e,a,h,g,ge,b,S,C))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,a=3+this.cells.length+1+1;let h=0;for(let b=0;b<this.cells.length;b++)h+=this.cells[b].length;const g=new Int32Array(a+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=a;for(let b=0;b<e.length;b++){const S=e[b];g[3+b]=y,g.set(S,y),y+=S.length}return g[3+e.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+e.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(e,a){const h=e.toArrayBuffer();return a&&a.push(h),{buffer:h}}static deserialize(e){return new la(e.buffer)}}const Or={};function Vt(r,e,a={}){if(Or[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Or[r]={klass:e,omit:a.omit||[],shallow:a.shallow||[]}}Vt("Object",Object),Vt("TransferableGridIndex",la),Vt("Color",ee),Vt("Error",Error),Vt("AJAXError",et),Vt("ResolvedImage",Ae),Vt("StylePropertyFunction",Ba),Vt("StyleExpression",La,{omit:["_evaluator"]}),Vt("ZoomDependentExpression",Eo),Vt("ZoomConstantExpression",Qs),Vt("CompoundExpression",Vi,{omit:["_evaluate"]});for(const r in Es)Es[r]._classRegistryKey||Vt(`Expression_${r}`,Es[r]);function Jl(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function us(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Jl(r)||De(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const a=r;return e&&e.push(a.buffer),a}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const a=[];for(const h of r)a.push(us(h,e));return a}if(typeof r=="object"){const a=r.constructor,h=a._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!Or[h])throw new Error(`${h} is not registered.`);const g=a.serialize?a.serialize(r,e):{};if(a.serialize){if(e&&g===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in r){if(!r.hasOwnProperty(y)||Or[h].omit.indexOf(y)>=0)continue;const b=r[y];g[y]=Or[h].shallow.indexOf(y)>=0?b:us(b,e)}r instanceof Error&&(g.message=r.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(g.$name=h),g}throw new Error("can't serialize object of type "+typeof r)}function Qr(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Jl(r)||De(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Qr);if(typeof r=="object"){const e=r.$name||"Object";if(!Or[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:a}=Or[e];if(!a)throw new Error(`can't deserialize unregistered class ${e}`);if(a.deserialize)return a.deserialize(r);const h=Object.create(a.prototype);for(const g of Object.keys(r)){if(g==="$name")continue;const y=r[g];h[g]=Or[e].shallow.indexOf(g)>=0?y:Qr(y)}return h}throw new Error("can't deserialize object of type "+typeof r)}class zo{constructor(){this.first=!0}update(e,a){const h=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=a),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=h,!0))}}const Ct={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Na(r){for(const e of r)if(Po(e.charCodeAt(0)))return!0;return!1}function uu(r){for(const e of r)if(!Do(e.charCodeAt(0)))return!1;return!0}function Do(r){return!(Ct.Arabic(r)||Ct["Arabic Supplement"](r)||Ct["Arabic Extended-A"](r)||Ct["Arabic Presentation Forms-A"](r)||Ct["Arabic Presentation Forms-B"](r))}function Po(r){return!(r!==746&&r!==747&&(r<4352||!(Ct["Bopomofo Extended"](r)||Ct.Bopomofo(r)||Ct["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ct["CJK Compatibility Ideographs"](r)||Ct["CJK Compatibility"](r)||Ct["CJK Radicals Supplement"](r)||Ct["CJK Strokes"](r)||!(!Ct["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ct["CJK Unified Ideographs Extension A"](r)||Ct["CJK Unified Ideographs"](r)||Ct["Enclosed CJK Letters and Months"](r)||Ct["Hangul Compatibility Jamo"](r)||Ct["Hangul Jamo Extended-A"](r)||Ct["Hangul Jamo Extended-B"](r)||Ct["Hangul Jamo"](r)||Ct["Hangul Syllables"](r)||Ct.Hiragana(r)||Ct["Ideographic Description Characters"](r)||Ct.Kanbun(r)||Ct["Kangxi Radicals"](r)||Ct["Katakana Phonetic Extensions"](r)||Ct.Katakana(r)&&r!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ct["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](r)||Ct["Unified Canadian Aboriginal Syllabics Extended"](r)||Ct["Vertical Forms"](r)||Ct["Yijing Hexagram Symbols"](r)||Ct["Yi Syllables"](r)||Ct["Yi Radicals"](r))))}function Ql(r){return!(Po(r)||function(e){return!!(Ct["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ct["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ct["Letterlike Symbols"](e)||Ct["Number Forms"](e)||Ct["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ct["Control Pictures"](e)&&e!==9251||Ct["Optical Character Recognition"](e)||Ct["Enclosed Alphanumerics"](e)||Ct["Geometric Shapes"](e)||Ct["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ct["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ct["CJK Symbols and Punctuation"](e)||Ct.Katakana(e)||Ct["Private Use Area"](e)||Ct["CJK Compatibility Forms"](e)||Ct["Small Form Variants"](e)||Ct["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function $l(r){return r>=1424&&r<=2303||Ct["Arabic Presentation Forms-A"](r)||Ct["Arabic Presentation Forms-B"](r)}function hu(r,e){return!(!e&&$l(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ct.Khmer(r))}function ec(r){for(const e of r)if($l(e.charCodeAt(0)))return!0;return!1}const Lo="deferred",Bo="loading",Ro="loaded";let Fo=null,Gn="unavailable",$r=null;const tc=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Gn="error"),Fo&&Fo(r)};function Ps(){Oo.fire(new Hn("pluginStateChange",{pluginStatus:Gn,pluginURL:$r}))}const Oo=new ar,ca=function(){return Gn},ic=function(){if(Gn!==Lo||!$r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gn=Bo,Ps(),$r&&ei({url:$r},r=>{r?tc(r):(Gn=Ro,Ps())})},lr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gn===Ro||lr.applyArabicShaping!=null,isLoading:()=>Gn===Bo,setState(r){if(!he())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gn=r.pluginStatus,$r=r.pluginURL},isParsed(){if(!he())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return lr.applyArabicShaping!=null&&lr.processBidirectionalText!=null&&lr.processStyledBidirectionalText!=null},getPluginURL(){if(!he())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return $r}};class Yi{constructor(e,a){this.zoom=e,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zo,this.transition={})}isSupportedScript(e){return function(a,h){for(const g of a)if(!hu(g.charCodeAt(0),h))return!1;return!0}(e,lr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,a=e-Math.floor(e),h=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*a}}}class ua{constructor(e,a){this.property=e,this.value=a,this.expression=function(h,g){if(ji(h))return new Ba(h,g);if(Ys(h)){const y=Nl(h,g);if(y.result==="error")throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=h;return g.type==="color"&&typeof h=="string"?y=ee.parse(h):g.type!=="padding"||typeof h!="number"&&!Array.isArray(h)||(y=_e.parse(h)),{kind:"constant",evaluate:()=>y}}}(a===void 0?e.specification.default:a,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,a,h){return this.property.possiblyEvaluate(this,e,a,h)}}class Ua{constructor(e){this.property=e,this.value=new ua(e,void 0)}transitioned(e,a){return new rc(this.property,this.value,a,K({},e.transition,this.transition),e.now)}untransitioned(){return new rc(this.property,this.value,null,{},0)}}class nc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return re(this._values[e].value.value)}setValue(e,a){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ua(this._values[e].property)),this._values[e].value=new ua(this._values[e].property,a===null?void 0:re(a))}getTransition(e){return re(this._values[e].transition)}setTransition(e,a){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Ua(this._values[e].property)),this._values[e].transition=re(a)||void 0}serialize(){const e={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(e[a]=h);const g=this.getTransition(a);g!==void 0&&(e[`${a}-transition`]=g)}return e}transitioned(e,a){const h=new sc(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(e,a._values[g]);return h}untransitioned(){const e=new sc(this._properties);for(const a of Object.keys(this._values))e._values[a]=this._values[a].untransitioned();return e}}class rc{constructor(e,a,h,g,y){this.property=e,this.value=a,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,e.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(e,a,h){const g=e.now||0,y=this.value.possiblyEvaluate(e,a,h),b=this.prior;if(b){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return b.possiblyEvaluate(e,a,h);{const S=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,a,h),y,function(C){if(C<=0)return 0;if(C>=1)return 1;const D=C*C,R=D*C;return 4*(C<.5?R:3*(C-D)+R-.75)}(S))}}return y}}class sc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,a,h){const g=new ha(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(e,a,h);return g}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return re(this._values[e].value)}setValue(e,a){this._values[e]=new ua(this._values[e].property,a===null?void 0:re(a))}serialize(){const e={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(e[a]=h)}return e}possiblyEvaluate(e,a,h){const g=new ha(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(e,a,h);return g}}class Tr{constructor(e,a,h){this.property=e,this.value=a,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,a,h,g){return this.property.evaluate(this.value,this.parameters,e,a,h,g)}}class ha{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Xt{constructor(e){this.specification=e}possiblyEvaluate(e,a){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(a)}interpolate(e,a,h){const g=Xs[this.specification.type];return g?g(e,a,h):e}}class $t{constructor(e,a){this.specification=e,this.overrides=a}possiblyEvaluate(e,a,h,g){return new Tr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(a,null,{},h,g)}:e.expression,a)}interpolate(e,a,h){if(e.value.kind!=="constant"||a.value.kind!=="constant")return e;if(e.value.value===void 0||a.value.value===void 0)return new Tr(this,{kind:"constant",value:void 0},e.parameters);const g=Xs[this.specification.type];return g?new Tr(this,{kind:"constant",value:g(e.value.value,a.value.value,h)},e.parameters):e}evaluate(e,a,h,g,y,b){return e.kind==="constant"?e.value:e.evaluate(a,h,g,y,b)}}class Ls extends $t{possiblyEvaluate(e,a,h,g){if(e.value===void 0)return new Tr(this,{kind:"constant",value:void 0},a);if(e.expression.kind==="constant"){const y=e.expression.evaluate(a,null,{},h,g),b=e.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,S=this._calculate(b,b,b,a);return new Tr(this,{kind:"constant",value:S},a)}if(e.expression.kind==="camera"){const y=this._calculate(e.expression.evaluate({zoom:a.zoom-1}),e.expression.evaluate({zoom:a.zoom}),e.expression.evaluate({zoom:a.zoom+1}),a);return new Tr(this,{kind:"constant",value:y},a)}return new Tr(this,e.expression,a)}evaluate(e,a,h,g,y,b){if(e.kind==="source"){const S=e.evaluate(a,h,g,y,b);return this._calculate(S,S,S,a)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(a.zoom)-1},h,g),e.evaluate({zoom:Math.floor(a.zoom)},h,g),e.evaluate({zoom:Math.floor(a.zoom)+1},h,g),a):e.value}_calculate(e,a,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:e,to:a}:{from:h,to:a}}interpolate(e){return e}}class Vo{constructor(e){this.specification=e}possiblyEvaluate(e,a,h,g){if(e.value!==void 0){if(e.expression.kind==="constant"){const y=e.expression.evaluate(a,null,{},h,g);return this._calculate(y,y,y,a)}return this._calculate(e.expression.evaluate(new Yi(Math.floor(a.zoom-1),a)),e.expression.evaluate(new Yi(Math.floor(a.zoom),a)),e.expression.evaluate(new Yi(Math.floor(a.zoom+1),a)),a)}}_calculate(e,a,h,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:e,to:a}:{from:h,to:a}}interpolate(e){return e}}class es{constructor(e){this.specification=e}possiblyEvaluate(e,a,h,g){return!!e.expression.evaluate(a,null,{},h,g)}interpolate(){return!1}}class Sn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in e){const h=e[a];h.specification.overridable&&this.overridableProperties.push(a);const g=this.defaultPropertyValues[a]=new ua(h,void 0),y=this.defaultTransitionablePropertyValues[a]=new Ua(h);this.defaultTransitioningPropertyValues[a]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=g.possiblyEvaluate({})}}}Vt("DataDrivenProperty",$t),Vt("DataConstantProperty",Xt),Vt("CrossFadedDataDrivenProperty",Ls),Vt("CrossFadedProperty",Vo),Vt("ColorRampProperty",es);const ts="-transition";class Sr extends ar{constructor(e,a){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),a.layout&&(this._unevaluatedLayout=new fu(a.layout)),a.paint)){this._transitionablePaint=new nc(a.paint);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ha(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,a,h={}){a!=null&&this._validate(cu,`layers.${this.id}.layout.${e}`,e,a,h)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,a):this.visibility=a)}getPaintProperty(e){return e.endsWith(ts)?this._transitionablePaint.getTransition(e.slice(0,-ts.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,a,h={}){if(a!=null&&this._validate(lu,`layers.${this.id}.paint.${e}`,e,a,h))return!1;if(e.endsWith(ts))return this._transitionablePaint.setTransition(e.slice(0,-ts.length),a||void 0),!1;{const g=this._transitionablePaint._values[e],y=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),S=g.value;this._transitionablePaint.setValue(e,a),this._handleSpecialPaintPropertyUpdate(e);const C=this._transitionablePaint._values[e].value;return C.isDataDriven()||b||y||this._handleOverridablePaintPropertyUpdate(e,S,C)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,a,h){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,a){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,a)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Y(e,(a,h)=>!(a===void 0||h==="layout"&&!Object.keys(a).length||h==="paint"&&!Object.keys(a).length))}_validate(e,a,h,g,y={}){return(!y||y.validate!==!1)&&Va(this,e.call(oa,{key:a,layerType:this.type,objectKey:h,value:g,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const a=this.paint.get(e);if(a instanceof Tr&&Zi(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const ac={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class is{constructor(e,a){this._structArray=e,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,a){return e._trim(),a&&(e.isTransferred=!0,a.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const a=Object.create(this.prototype);return a.arrayBuffer=e.arrayBuffer,a.length=e.length,a.capacity=e.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function hn(r,e=1){let a=0,h=0;return{members:r.map(g=>{const y=ac[g.type].BYTES_PER_ELEMENT,b=a=No(a,Math.max(e,y)),S=g.components||1;return h=Math.max(h,y),a+=y*S,{name:g.name,type:g.type,components:S,offset:b}}),size:No(a,Math.max(h,e)),alignment:e}}function No(r,e){return Math.ceil(r/e)*e}class hs extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,a)}emplace(e,a,h){const g=2*e;return this.int16[g+0]=a,this.int16[g+1]=h,e}}hs.prototype.bytesPerElement=4,Vt("StructArrayLayout2i4",hs);class p extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,a,h,g)}emplace(e,a,h,g,y){const b=4*e;return this.int16[b+0]=a,this.int16[b+1]=h,this.int16[b+2]=g,this.int16[b+3]=y,e}}p.prototype.bytesPerElement=8,Vt("StructArrayLayout4i8",p);class t extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,a,h,g,y,b)}emplace(e,a,h,g,y,b,S){const C=6*e;return this.int16[C+0]=a,this.int16[C+1]=h,this.int16[C+2]=g,this.int16[C+3]=y,this.int16[C+4]=b,this.int16[C+5]=S,e}}t.prototype.bytesPerElement=12,Vt("StructArrayLayout2i4i12",t);class l extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,a,h,g,y,b)}emplace(e,a,h,g,y,b,S){const C=4*e,D=8*e;return this.int16[C+0]=a,this.int16[C+1]=h,this.uint8[D+4]=g,this.uint8[D+5]=y,this.uint8[D+6]=b,this.uint8[D+7]=S,e}}l.prototype.bytesPerElement=8,Vt("StructArrayLayout2i4ub8",l);class f extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,a)}emplace(e,a,h){const g=2*e;return this.float32[g+0]=a,this.float32[g+1]=h,e}}f.prototype.bytesPerElement=8,Vt("StructArrayLayout2f8",f);class _ extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b,S,C,D,R){const O=this.length;return this.resize(O+1),this.emplace(O,e,a,h,g,y,b,S,C,D,R)}emplace(e,a,h,g,y,b,S,C,D,R,O){const Z=10*e;return this.uint16[Z+0]=a,this.uint16[Z+1]=h,this.uint16[Z+2]=g,this.uint16[Z+3]=y,this.uint16[Z+4]=b,this.uint16[Z+5]=S,this.uint16[Z+6]=C,this.uint16[Z+7]=D,this.uint16[Z+8]=R,this.uint16[Z+9]=O,e}}_.prototype.bytesPerElement=20,Vt("StructArrayLayout10ui20",_);class v extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b,S,C,D,R,O,Z){const H=this.length;return this.resize(H+1),this.emplace(H,e,a,h,g,y,b,S,C,D,R,O,Z)}emplace(e,a,h,g,y,b,S,C,D,R,O,Z,H){const J=12*e;return this.int16[J+0]=a,this.int16[J+1]=h,this.int16[J+2]=g,this.int16[J+3]=y,this.uint16[J+4]=b,this.uint16[J+5]=S,this.uint16[J+6]=C,this.uint16[J+7]=D,this.int16[J+8]=R,this.int16[J+9]=O,this.int16[J+10]=Z,this.int16[J+11]=H,e}}v.prototype.bytesPerElement=24,Vt("StructArrayLayout4i4ui4i24",v);class T extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,a,h)}emplace(e,a,h,g){const y=3*e;return this.float32[y+0]=a,this.float32[y+1]=h,this.float32[y+2]=g,e}}T.prototype.bytesPerElement=12,Vt("StructArrayLayout3f12",T);class M extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.uint32[1*e+0]=a,e}}M.prototype.bytesPerElement=4,Vt("StructArrayLayout1ul4",M);class z extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b,S,C,D){const R=this.length;return this.resize(R+1),this.emplace(R,e,a,h,g,y,b,S,C,D)}emplace(e,a,h,g,y,b,S,C,D,R){const O=10*e,Z=5*e;return this.int16[O+0]=a,this.int16[O+1]=h,this.int16[O+2]=g,this.int16[O+3]=y,this.int16[O+4]=b,this.int16[O+5]=S,this.uint32[Z+3]=C,this.uint16[O+8]=D,this.uint16[O+9]=R,e}}z.prototype.bytesPerElement=20,Vt("StructArrayLayout6i1ul2ui20",z);class P extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,a,h,g,y,b)}emplace(e,a,h,g,y,b,S){const C=6*e;return this.int16[C+0]=a,this.int16[C+1]=h,this.int16[C+2]=g,this.int16[C+3]=y,this.int16[C+4]=b,this.int16[C+5]=S,e}}P.prototype.bytesPerElement=12,Vt("StructArrayLayout2i2i2i12",P);class F extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,a,h,g,y)}emplace(e,a,h,g,y,b){const S=4*e,C=8*e;return this.float32[S+0]=a,this.float32[S+1]=h,this.float32[S+2]=g,this.int16[C+6]=y,this.int16[C+7]=b,e}}F.prototype.bytesPerElement=16,Vt("StructArrayLayout2f1f2i16",F);class q extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,a,h,g)}emplace(e,a,h,g,y){const b=12*e,S=3*e;return this.uint8[b+0]=a,this.uint8[b+1]=h,this.float32[S+1]=g,this.float32[S+2]=y,e}}q.prototype.bytesPerElement=12,Vt("StructArrayLayout2ub2f12",q);class W extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,a,h)}emplace(e,a,h,g){const y=3*e;return this.uint16[y+0]=a,this.uint16[y+1]=h,this.uint16[y+2]=g,e}}W.prototype.bytesPerElement=6,Vt("StructArrayLayout3ui6",W);class le extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge,me,Pe){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge,me,Pe)}emplace(e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge,me,Pe,Ge){const Me=24*e,Ve=12*e,at=48*e;return this.int16[Me+0]=a,this.int16[Me+1]=h,this.uint16[Me+2]=g,this.uint16[Me+3]=y,this.uint32[Ve+2]=b,this.uint32[Ve+3]=S,this.uint32[Ve+4]=C,this.uint16[Me+10]=D,this.uint16[Me+11]=R,this.uint16[Me+12]=O,this.float32[Ve+7]=Z,this.float32[Ve+8]=H,this.uint8[at+36]=J,this.uint8[at+37]=ge,this.uint8[at+38]=me,this.uint32[Ve+10]=Pe,this.int16[Me+22]=Ge,e}}le.prototype.bytesPerElement=48,Vt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",le);class se extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge,me,Pe,Ge,Me,Ve,at,st,Lt,Zt,Mt,Tt,wt,zt){const St=this.length;return this.resize(St+1),this.emplace(St,e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge,me,Pe,Ge,Me,Ve,at,st,Lt,Zt,Mt,Tt,wt,zt)}emplace(e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge,me,Pe,Ge,Me,Ve,at,st,Lt,Zt,Mt,Tt,wt,zt,St){const _t=34*e,Jt=17*e;return this.int16[_t+0]=a,this.int16[_t+1]=h,this.int16[_t+2]=g,this.int16[_t+3]=y,this.int16[_t+4]=b,this.int16[_t+5]=S,this.int16[_t+6]=C,this.int16[_t+7]=D,this.uint16[_t+8]=R,this.uint16[_t+9]=O,this.uint16[_t+10]=Z,this.uint16[_t+11]=H,this.uint16[_t+12]=J,this.uint16[_t+13]=ge,this.uint16[_t+14]=me,this.uint16[_t+15]=Pe,this.uint16[_t+16]=Ge,this.uint16[_t+17]=Me,this.uint16[_t+18]=Ve,this.uint16[_t+19]=at,this.uint16[_t+20]=st,this.uint16[_t+21]=Lt,this.uint16[_t+22]=Zt,this.uint32[Jt+12]=Mt,this.float32[Jt+13]=Tt,this.float32[Jt+14]=wt,this.float32[Jt+15]=zt,this.float32[Jt+16]=St,e}}se.prototype.bytesPerElement=68,Vt("StructArrayLayout8i15ui1ul4f68",se);class ae extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.float32[1*e+0]=a,e}}ae.prototype.bytesPerElement=4,Vt("StructArrayLayout1f4",ae);class Te extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,a,h)}emplace(e,a,h,g){const y=3*e;return this.int16[y+0]=a,this.int16[y+1]=h,this.int16[y+2]=g,e}}Te.prototype.bytesPerElement=6,Vt("StructArrayLayout3i6",Te);class Ce extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,a,h)}emplace(e,a,h,g){const y=4*e;return this.uint32[2*e+0]=a,this.uint16[y+2]=h,this.uint16[y+3]=g,e}}Ce.prototype.bytesPerElement=8,Vt("StructArrayLayout1ul2ui8",Ce);class Re extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,a)}emplace(e,a,h){const g=2*e;return this.uint16[g+0]=a,this.uint16[g+1]=h,e}}Re.prototype.bytesPerElement=4,Vt("StructArrayLayout2ui4",Re);class de extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const a=this.length;return this.resize(a+1),this.emplace(a,e)}emplace(e,a){return this.uint16[1*e+0]=a,e}}de.prototype.bytesPerElement=2,Vt("StructArrayLayout1ui2",de);class Ue extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,a,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,a,h,g)}emplace(e,a,h,g,y){const b=4*e;return this.float32[b+0]=a,this.float32[b+1]=h,this.float32[b+2]=g,this.float32[b+3]=y,e}}Ue.prototype.bytesPerElement=16,Vt("StructArrayLayout4f16",Ue);class Oe extends is{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ce(this.anchorPointX,this.anchorPointY)}}Oe.prototype.size=20;class Je extends z{get(e){return new Oe(this,e)}}Vt("CollisionBoxArray",Je);class $e extends is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}$e.prototype.size=48;class pt extends le{get(e){return new $e(this,e)}}Vt("PlacedSymbolArray",pt);class He extends is{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}He.prototype.size=68;class Dt extends se{get(e){return new He(this,e)}}Vt("SymbolInstanceArray",Dt);class kt extends ae{getoffsetX(e){return this.float32[1*e+0]}}Vt("GlyphOffsetArray",kt);class Pt extends Te{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Vt("SymbolLineVertexArray",Pt);class ui extends is{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ui.prototype.size=8;class yi extends Ce{get(e){return new ui(this,e)}}Vt("FeatureIndexArray",yi);class Yt extends hs{}class Ri extends hs{}class Fi extends hs{}class Ai extends t{}class Mi extends l{}class Oi extends f{}class vn extends _{}class Er extends v{}class gr extends T{}class Ar extends M{}class ns extends P{}class cr extends q{}class qn extends W{}class Vr extends Re{}const Ga=hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pn}=Ga;class bi{constructor(e=[]){this.segments=e}prepareSegment(e,a,h,g){let y=this.segments[this.segments.length-1];return e>bi.MAX_VERTEX_ARRAY_LENGTH&&ne(`Max vertices per segment is ${bi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>bi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:a.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const e of this.segments)for(const a in e.vaos)e.vaos[a].destroy()}static simpleSegment(e,a,h,g){return new bi([{vertexOffset:e,primitiveOffset:a,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function Bi(r,e){return 256*(r=E(Math.floor(r),0,255))+E(Math.floor(e),0,255)}bi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt("SegmentVector",bi);const bn=hn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xn={exports:{}},Ji={exports:{}};Ji.exports=function(r,e){var a,h,g,y,b,S,C,D;for(h=r.length-(a=3&r.length),g=e,b=3432918353,S=461845907,D=0;D<h;)C=255&r.charCodeAt(D)|(255&r.charCodeAt(++D))<<8|(255&r.charCodeAt(++D))<<16|(255&r.charCodeAt(++D))<<24,++D,g=27492+(65535&(y=5*(65535&(g=(g^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(C=0,a){case 3:C^=(255&r.charCodeAt(D+2))<<16;case 2:C^=(255&r.charCodeAt(D+1))<<8;case 1:g^=C=(65535&(C=(C=(65535&(C^=255&r.charCodeAt(D)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*S+(((C>>>16)*S&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var ur={exports:{}};ur.exports=function(r,e){for(var a,h=r.length,g=e^h,y=0;h>=4;)a=1540483477*(65535&(a=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(a>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++y;switch(h){case 3:g^=(255&r.charCodeAt(y+2))<<16;case 2:g^=(255&r.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var fs=Ji.exports,Uo=ur.exports;xn.exports=fs,xn.exports.murmur3=fs,xn.exports.murmur2=Uo;class Bs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,a,h,g){this.ids.push(oc(e)),this.positions.push(a,h,g)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=oc(e);let h=0,g=this.ids.length-1;for(;h<g;){const b=h+g>>1;this.ids[b]>=a?g=b:h=b+1}const y=[];for(;this.ids[h]===a;)y.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return y}static serialize(e,a){const h=new Float64Array(e.ids),g=new Uint32Array(e.positions);return Go(h,g,0,h.length-1),a&&a.push(h.buffer,g.buffer),{ids:h,positions:g}}static deserialize(e){const a=new Bs;return a.ids=e.ids,a.positions=e.positions,a.indexed=!0,a}}function oc(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:xn.exports(String(r))}function Go(r,e,a,h){for(;a<h;){const g=r[a+h>>1];let y=a-1,b=h+1;for(;;){do y++;while(r[y]<g);do b--;while(r[b]>g);if(y>=b)break;rs(r,y,b),rs(e,3*y,3*b),rs(e,3*y+1,3*b+1),rs(e,3*y+2,3*b+2)}b-a<h-b?(Go(r,e,a,b),a=b+1):(Go(r,e,b+1,h),h=b)}}function rs(r,e,a){const h=r[e];r[e]=r[a],r[a]=h}Vt("FeaturePositionMap",Bs);class ds{constructor(e,a){this.gl=e.gl,this.location=a}}class ms extends ds{constructor(e,a){super(e,a),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class qa extends ds{constructor(e,a){super(e,a),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Sh extends ds{constructor(e,a){super(e,a),this.current=ee.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const pg=new Float32Array(16);function du(r){return[Bi(255*r.r,255*r.g),Bi(255*r.b,255*r.a)]}class qo{constructor(e,a,h){this.value=e,this.uniformNames=a.map(g=>`u_${g}`),this.type=h}setUniform(e,a,h){e.set(h.constantOr(this.value))}getBinding(e,a,h){return this.type==="color"?new Sh(e,a):new ms(e,a)}}class ja{constructor(e,a){this.uniformNames=a.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=e.tlbr}setUniform(e,a,h,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&e.set(y)}getBinding(e,a,h){return h.substr(0,9)==="u_pattern"?new qa(e,a):new ms(e,a)}}class ps{constructor(e,a,h,g){this.expression=e,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,a,h,g,y){const b=this.paintVertexArray.length,S=this.expression.evaluate(new Yi(0),a,{},g,[],y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,S)}updatePaintArray(e,a,h,g){const y=this.expression.evaluate({zoom:0},h,g);this._setPaintValue(e,a,y)}_setPaintValue(e,a,h){if(this.type==="color"){const g=du(h);for(let y=e;y<a;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=e;g<a;g++)this.paintVertexArray.emplace(g,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nr{constructor(e,a,h,g,y,b){this.expression=e,this.uniformNames=a.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=a.map(S=>({name:`a_${S}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(e,a,h,g,y){const b=this.expression.evaluate(new Yi(this.zoom),a,{},g,[],y),S=this.expression.evaluate(new Yi(this.zoom+1),a,{},g,[],y),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,b,S)}updatePaintArray(e,a,h,g){const y=this.expression.evaluate({zoom:this.zoom},h,g),b=this.expression.evaluate({zoom:this.zoom+1},h,g);this._setPaintValue(e,a,y,b)}_setPaintValue(e,a,h,g){if(this.type==="color"){const y=du(h),b=du(g);for(let S=e;S<a;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1])}else{for(let y=e;y<a;y++)this.paintVertexArray.emplace(y,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,a){const h=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,g=E(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);e.set(g)}getBinding(e,a,h){return new ms(e,a)}}class Rs{constructor(e,a,h,g,y,b){this.expression=e,this.type=a,this.useIntegerZoom=h,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,a,h){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(g,e,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(e,a,h,g,y){this._setPaintValues(e,a,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(e,a,h,g){if(!g||!h)return;const{min:y,mid:b,max:S}=h,C=g[y],D=g[b],R=g[S];if(C&&D&&R)for(let O=e;O<a;O++)this.zoomInPaintVertexArray.emplace(O,D.tl[0],D.tl[1],D.br[0],D.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],D.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,D.tl[0],D.tl[1],D.br[0],D.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],D.pixelRatio,R.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,bn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,bn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Eh{constructor(e,a,h){this.binders={},this._buffers=[];const g=[];for(const y in e.paint._values){if(!h(y))continue;const b=e.paint.get(y);if(!(b instanceof Tr&&Zi(b.property.specification)))continue;const S=gg(y,e.type),C=b.value,D=b.property.specification.type,R=b.property.useIntegerZoom,O=b.property.specification["property-type"],Z=O==="cross-faded"||O==="cross-faded-data-driven";if(C.kind==="constant")this.binders[y]=Z?new ja(C.value,S):new qo(C.value,S,D),g.push(`/u_${y}`);else if(C.kind==="source"||Z){const H=Ah(y,D,"source");this.binders[y]=Z?new Rs(C,D,R,a,H,e.id):new ps(C,S,D,H),g.push(`/a_${y}`)}else{const H=Ah(y,D,"composite");this.binders[y]=new Nr(C,S,D,R,a,H),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(e){const a=this.binders[e];return a instanceof ps||a instanceof Nr?a.maxValue:0}populatePaintArrays(e,a,h,g,y){for(const b in this.binders){const S=this.binders[b];(S instanceof ps||S instanceof Nr||S instanceof Rs)&&S.populatePaintArray(e,a,h,g,y)}}setConstantPatternPositions(e,a){for(const h in this.binders){const g=this.binders[h];g instanceof ja&&g.setConstantPatternPositions(e,a)}}updatePaintArrays(e,a,h,g,y){let b=!1;for(const S in e){const C=a.getPositions(S);for(const D of C){const R=h.feature(D.index);for(const O in this.binders){const Z=this.binders[O];if((Z instanceof ps||Z instanceof Nr||Z instanceof Rs)&&Z.expression.isStateDependent===!0){const H=g.paint.get(O);Z.expression=H.value,Z.updatePaintArray(D.start,D.end,R,e[S],y),b=!0}}}}return b}defines(){const e=[];for(const a in this.binders){const h=this.binders[a];(h instanceof qo||h instanceof ja)&&e.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return e}getBinderAttributes(){const e=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof ps||h instanceof Nr)for(let g=0;g<h.paintVertexAttributes.length;g++)e.push(h.paintVertexAttributes[g].name);else if(h instanceof Rs)for(let g=0;g<bn.members.length;g++)e.push(bn.members[g].name)}return e}getBinderUniforms(){const e=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof qo||h instanceof ja||h instanceof Nr)for(const g of h.uniformNames)e.push(g)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,a){const h=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof qo||y instanceof ja||y instanceof Nr){for(const b of y.uniformNames)if(a[b]){const S=y.getBinding(e,a[b],b);h.push({name:b,property:g,binding:S})}}}return h}setUniforms(e,a,h,g){for(const{name:y,property:b,binding:S}of a)this.binders[b].setUniform(S,g,h.get(b),y)}updatePaintBuffers(e){this._buffers=[];for(const a in this.binders){const h=this.binders[a];if(e&&h instanceof Rs){const g=e.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(h instanceof ps||h instanceof Nr)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(e){for(const a in this.binders){const h=this.binders[a];(h instanceof ps||h instanceof Nr||h instanceof Rs)&&h.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const a=this.binders[e];(a instanceof ps||a instanceof Nr||a instanceof Rs)&&a.destroy()}}}class fa{constructor(e,a,h=()=>!0){this.programConfigurations={};for(const g of e)this.programConfigurations[g.id]=new Eh(g,a,h);this.needsUpload=!1,this._featureMap=new Bs,this._bufferOffset=0}populatePaintArrays(e,a,h,g,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,a,g,y,b);a.id!==void 0&&this._featureMap.add(a.id,h,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,a,h,g){for(const y of h)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,a,y,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function gg(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Ah(r,e,a){const h={color:{source:f,composite:Ue},number:{source:ae,composite:f}},g=function(y){return{"line-pattern":{source:vn,composite:vn},"fill-pattern":{source:vn,composite:vn},"fill-extrusion-pattern":{source:vn,composite:vn}}[y]}(r);return g&&g[a]||h[e][a]}Vt("ConstantBinder",qo),Vt("CrossFadedConstantBinder",ja),Vt("SourceExpressionBinder",ps),Vt("CrossFadedCompositeBinder",Rs),Vt("CompositeExpressionBinder",Nr),Vt("ProgramConfiguration",Eh,{omit:["_buffers"]}),Vt("ProgramConfigurationSet",fa);var gn=8192;const mu=Math.pow(2,14)-1,Ch=-mu-1;function da(r){const e=gn/r.extent,a=r.loadGeometry();for(let h=0;h<a.length;h++){const g=a[h];for(let y=0;y<g.length;y++){const b=g[y],S=Math.round(b.x*e),C=Math.round(b.y*e);b.x=E(S,Ch,mu),b.y=E(C,Ch,mu),(S<b.x||S>b.x+1||C<b.y||C>b.y+1)&&ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function ma(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?da(r):[]}}function lc(r,e,a,h,g){r.emplaceBack(2*e+(h+1)/2,2*a+(g+1)/2)}class pu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ri,this.indexArray=new qn,this.segments=new bi,this.programConfigurations=new fa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(e,a,h){const g=this.layers[0],y=[];let b=null,S=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),S=!b.isConstant());for(const{feature:C,id:D,index:R,sourceLayerIndex:O}of e){const Z=this.layers[0]._featureFilter.needGeometry,H=ma(C,Z);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),H,h))continue;const J=S?b.evaluate(H,{},h):void 0,ge={id:D,properties:C.properties,type:C.type,sourceLayerIndex:O,index:R,geometry:Z?H.geometry:da(C),patterns:{},sortKey:J};y.push(ge)}S&&y.sort((C,D)=>C.sortKey-D.sortKey);for(const C of y){const{geometry:D,index:R,sourceLayerIndex:O}=C,Z=e[R].feature;this.addFeature(C,D,R,h),a.featureIndex.insert(Z,D,R,O,this.index)}}update(e,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,a,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,a,h,g){for(const y of a)for(const b of y){const S=b.x,C=b.y;if(S<0||S>=gn||C<0||C>=gn)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=D.vertexLength;lc(this.layoutVertexArray,S,C,-1,-1),lc(this.layoutVertexArray,S,C,1,-1),lc(this.layoutVertexArray,S,C,1,1),lc(this.layoutVertexArray,S,C,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,{},g)}}function Mh(r,e){for(let a=0;a<r.length;a++)if(Za(e,r[a]))return!0;for(let a=0;a<e.length;a++)if(Za(r,e[a]))return!0;return!!gu(r,e)}function _g(r,e,a){return!!Za(r,e)||!!_u(e,r,a)}function zh(r,e){if(r.length===1)return Ph(e,r[0]);for(let a=0;a<e.length;a++){const h=e[a];for(let g=0;g<h.length;g++)if(Za(r,h[g]))return!0}for(let a=0;a<r.length;a++)if(Ph(e,r[a]))return!0;for(let a=0;a<e.length;a++)if(gu(r,e[a]))return!0;return!1}function yg(r,e,a){if(r.length>1){if(gu(r,e))return!0;for(let h=0;h<e.length;h++)if(_u(e[h],r,a))return!0}for(let h=0;h<r.length;h++)if(_u(r[h],e,a))return!0;return!1}function gu(r,e){if(r.length===0||e.length===0)return!1;for(let a=0;a<r.length-1;a++){const h=r[a],g=r[a+1];for(let y=0;y<e.length-1;y++)if(vg(h,g,e[y],e[y+1]))return!0}return!1}function vg(r,e,a,h){return oe(r,a,h)!==oe(e,a,h)&&oe(r,e,a)!==oe(r,e,h)}function _u(r,e,a){const h=a*a;if(e.length===1)return r.distSqr(e[0])<h;for(let g=1;g<e.length;g++)if(Dh(r,e[g-1],e[g])<h)return!0;return!1}function Dh(r,e,a){const h=e.distSqr(a);if(h===0)return r.distSqr(e);const g=((r.x-e.x)*(a.x-e.x)+(r.y-e.y)*(a.y-e.y))/h;return r.distSqr(g<0?e:g>1?a:a.sub(e)._mult(g)._add(e))}function Ph(r,e){let a,h,g,y=!1;for(let b=0;b<r.length;b++){a=r[b];for(let S=0,C=a.length-1;S<a.length;C=S++)h=a[S],g=a[C],h.y>e.y!=g.y>e.y&&e.x<(g.x-h.x)*(e.y-h.y)/(g.y-h.y)+h.x&&(y=!y)}return y}function Za(r,e){let a=!1;for(let h=0,g=r.length-1;h<r.length;g=h++){const y=r[h],b=r[g];y.y>e.y!=b.y>e.y&&e.x<(b.x-y.x)*(e.y-y.y)/(b.y-y.y)+y.x&&(a=!a)}return a}function bg(r,e,a){const h=a[0],g=a[2];if(r.x<h.x&&e.x<h.x||r.x>g.x&&e.x>g.x||r.y<h.y&&e.y<h.y||r.y>g.y&&e.y>g.y)return!1;const y=oe(r,e,a[0]);return y!==oe(r,e,a[1])||y!==oe(r,e,a[2])||y!==oe(r,e,a[3])}function jo(r,e,a){const h=e.paint.get(r).value;return h.kind==="constant"?h.value:a.programConfigurations.get(e.id).getMaxValue(r)}function cc(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function uc(r,e,a,h,g){if(!e[0]&&!e[1])return r;const y=ce.convert(e)._mult(g);a==="viewport"&&y._rotate(-h);const b=[];for(let S=0;S<r.length;S++)b.push(r[S].sub(y));return b}Vt("CircleBucket",pu,{omit:["layers"]});const xg=new Sn({"circle-sort-key":new $t(Ye.layout_circle["circle-sort-key"])});var wg={paint:new Sn({"circle-radius":new $t(Ye.paint_circle["circle-radius"]),"circle-color":new $t(Ye.paint_circle["circle-color"]),"circle-blur":new $t(Ye.paint_circle["circle-blur"]),"circle-opacity":new $t(Ye.paint_circle["circle-opacity"]),"circle-translate":new Xt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(Ye.paint_circle["circle-stroke-opacity"])}),layout:xg},jn=1e-6,Zn=typeof Float32Array<"u"?Float32Array:Array;function Lh(){var r=new Zn(9);return Zn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function yu(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Bh(r,e,a){var h=e[0],g=e[1],y=e[2],b=e[3],S=e[4],C=e[5],D=e[6],R=e[7],O=e[8],Z=e[9],H=e[10],J=e[11],ge=e[12],me=e[13],Pe=e[14],Ge=e[15],Me=a[0],Ve=a[1],at=a[2],st=a[3];return r[0]=Me*h+Ve*S+at*O+st*ge,r[1]=Me*g+Ve*C+at*Z+st*me,r[2]=Me*y+Ve*D+at*H+st*Pe,r[3]=Me*b+Ve*R+at*J+st*Ge,r[4]=(Me=a[4])*h+(Ve=a[5])*S+(at=a[6])*O+(st=a[7])*ge,r[5]=Me*g+Ve*C+at*Z+st*me,r[6]=Me*y+Ve*D+at*H+st*Pe,r[7]=Me*b+Ve*R+at*J+st*Ge,r[8]=(Me=a[8])*h+(Ve=a[9])*S+(at=a[10])*O+(st=a[11])*ge,r[9]=Me*g+Ve*C+at*Z+st*me,r[10]=Me*y+Ve*D+at*H+st*Pe,r[11]=Me*b+Ve*R+at*J+st*Ge,r[12]=(Me=a[12])*h+(Ve=a[13])*S+(at=a[14])*O+(st=a[15])*ge,r[13]=Me*g+Ve*C+at*Z+st*me,r[14]=Me*y+Ve*D+at*H+st*Pe,r[15]=Me*b+Ve*R+at*J+st*Ge,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Zo,Ig=Bh;function Rh(){var r=new Zn(3);return Zn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Fh(r,e,a){var h=new Zn(3);return h[0]=r,h[1]=e,h[2]=a,h}function hc(r,e,a){var h=e[0],g=e[1],y=e[2],b=e[3];return r[0]=a[0]*h+a[4]*g+a[8]*y+a[12]*b,r[1]=a[1]*h+a[5]*g+a[9]*y+a[13]*b,r[2]=a[2]*h+a[6]*g+a[10]*y+a[14]*b,r[3]=a[3]*h+a[7]*g+a[11]*y+a[15]*b,r}function Oh(){var r=new Zn(4);return Zn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Vh(r,e){const a=hc([],[r.x,r.y,0,1],e);return new ce(a[0]/a[3],a[1]/a[3])}Rh(),Zo=new Zn(4),Zn!=Float32Array&&(Zo[0]=0,Zo[1]=0,Zo[2]=0,Zo[3]=0),Rh(),Fh(1,0,0),Fh(0,1,0),Oh(),Oh(),Lh(),function(){var r;r=new Zn(2),Zn!=Float32Array&&(r[0]=0,r[1]=0)}();class Nh extends pu{}Vt("HeatmapBucket",Nh,{omit:["layers"]});var kg={paint:new Sn({"heatmap-radius":new $t(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new es(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt(Ye.paint_heatmap["heatmap-opacity"])})};function vu(r,{width:e,height:a},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==e*a*h)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${e*a*h}`)}else g=new Uint8Array(e*a*h);return r.width=e,r.height=a,r.data=g,r}function Uh(r,{width:e,height:a},h){if(e===r.width&&a===r.height)return;const g=vu({},{width:e,height:a},h);bu(r,g,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,a)},h),r.width=e,r.height=a,r.data=g.data}function bu(r,e,a,h,g,y){if(g.width===0||g.height===0)return e;if(g.width>r.width||g.height>r.height||a.x>r.width-g.width||a.y>r.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>e.width||g.height>e.height||h.x>e.width-g.width||h.y>e.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=r.data,S=e.data;if(b===S)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<g.height;C++){const D=((a.y+C)*r.width+a.x)*y,R=((h.y+C)*e.width+h.x)*y;for(let O=0;O<g.width*y;O++)S[R+O]=b[D+O]}return e}class Xo{constructor(e,a){vu(this,e,1,a)}resize(e){Uh(this,e,1)}clone(){return new Xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,a,h,g,y){bu(e,a,h,g,y,1)}}class _r{constructor(e,a){vu(this,e,4,a)}resize(e){Uh(this,e,4)}replace(e,a){a?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _r({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,a,h,g,y){bu(e,a,h,g,y,4)}}function Gh(r){const e={},a=r.resolution||256,h=r.clips?r.clips.length:1,g=r.image||new _r({width:a,height:h});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const y=(b,S,C)=>{e[r.evaluationKey]=C;const D=r.expression.evaluate(e);g.data[b+S+0]=Math.floor(255*D.r/D.a),g.data[b+S+1]=Math.floor(255*D.g/D.a),g.data[b+S+2]=Math.floor(255*D.b/D.a),g.data[b+S+3]=Math.floor(255*D.a)};if(r.clips)for(let b=0,S=0;b<h;++b,S+=4*a)for(let C=0,D=0;C<a;C++,D+=4){const R=C/(a-1),{start:O,end:Z}=r.clips[b];y(S,D,O*(1-R)+Z*R)}else for(let b=0,S=0;b<a;b++,S+=4)y(0,S,b/(a-1));return g}Vt("AlphaImage",Xo),Vt("RGBAImage",_r);var Tg={paint:new Sn({"hillshade-illumination-direction":new Xt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt(Ye.paint_hillshade["hillshade-accent-color"])})};const Sg=hn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Eg}=Sg;var fc={exports:{}};function dc(r,e,a){a=a||2;var h,g,y,b,S,C,D,R=e&&e.length,O=R?e[0]*a:r.length,Z=qh(r,0,O,a,!0),H=[];if(!Z||Z.next===Z.prev)return H;if(R&&(Z=function(ge,me,Pe,Ge){var Me,Ve,at,st=[];for(Me=0,Ve=me.length;Me<Ve;Me++)(at=qh(ge,me[Me]*Ge,Me<Ve-1?me[Me+1]*Ge:ge.length,Ge,!1))===at.next&&(at.steiner=!0),st.push(Bg(at));for(st.sort(Dg),Me=0;Me<st.length;Me++)Pe=Pg(st[Me],Pe);return Pe}(r,e,Z,a)),r.length>80*a){h=y=r[0],g=b=r[1];for(var J=a;J<O;J+=a)(S=r[J])<h&&(h=S),(C=r[J+1])<g&&(g=C),S>y&&(y=S),C>b&&(b=C);D=(D=Math.max(y-h,b-g))!==0?32767/D:0}return Wo(Z,H,a,h,g,D,0),H}function qh(r,e,a,h,g){var y,b;if(g===Iu(r,e,a,h)>0)for(y=e;y<a;y+=h)b=Xh(y,r[y],r[y+1],b);else for(y=a-h;y>=e;y-=h)b=Xh(y,r[y],r[y+1],b);return b&&mc(b,b.next)&&(Ko(b),b=b.next),b}function pa(r,e){if(!r)return r;e||(e=r);var a,h=r;do if(a=!1,h.steiner||!mc(h,h.next)&&ln(h.prev,h,h.next)!==0)h=h.next;else{if(Ko(h),(h=e=h.prev)===h.next)break;a=!0}while(a||h!==e);return e}function Wo(r,e,a,h,g,y,b){if(r){!b&&y&&function(R,O,Z,H){var J=R;do J.z===0&&(J.z=xu(J.x,J.y,O,Z,H)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==R);J.prevZ.nextZ=null,J.prevZ=null,function(ge){var me,Pe,Ge,Me,Ve,at,st,Lt,Zt=1;do{for(Pe=ge,ge=null,Ve=null,at=0;Pe;){for(at++,Ge=Pe,st=0,me=0;me<Zt&&(st++,Ge=Ge.nextZ);me++);for(Lt=Zt;st>0||Lt>0&&Ge;)st!==0&&(Lt===0||!Ge||Pe.z<=Ge.z)?(Me=Pe,Pe=Pe.nextZ,st--):(Me=Ge,Ge=Ge.nextZ,Lt--),Ve?Ve.nextZ=Me:ge=Me,Me.prevZ=Ve,Ve=Me;Pe=Ge}Ve.nextZ=null,Zt*=2}while(at>1)}(J)}(r,h,g,y);for(var S,C,D=r;r.prev!==r.next;)if(S=r.prev,C=r.next,y?Cg(r,h,g,y):Ag(r))e.push(S.i/a|0),e.push(r.i/a|0),e.push(C.i/a|0),Ko(r),r=C.next,D=C.next;else if((r=C)===D){b?b===1?Wo(r=Mg(pa(r),e,a),e,a,h,g,y,2):b===2&&zg(r,e,a,h,g,y):Wo(pa(r),e,a,h,g,y,1);break}}}function Ag(r){var e=r.prev,a=r,h=r.next;if(ln(e,a,h)>=0)return!1;for(var g=e.x,y=a.x,b=h.x,S=e.y,C=a.y,D=h.y,R=g<y?g<b?g:b:y<b?y:b,O=S<C?S<D?S:D:C<D?C:D,Z=g>y?g>b?g:b:y>b?y:b,H=S>C?S>D?S:D:C>D?C:D,J=h.next;J!==e;){if(J.x>=R&&J.x<=Z&&J.y>=O&&J.y<=H&&Xa(g,S,y,C,b,D,J.x,J.y)&&ln(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function Cg(r,e,a,h){var g=r.prev,y=r,b=r.next;if(ln(g,y,b)>=0)return!1;for(var S=g.x,C=y.x,D=b.x,R=g.y,O=y.y,Z=b.y,H=S<C?S<D?S:D:C<D?C:D,J=R<O?R<Z?R:Z:O<Z?O:Z,ge=S>C?S>D?S:D:C>D?C:D,me=R>O?R>Z?R:Z:O>Z?O:Z,Pe=xu(H,J,e,a,h),Ge=xu(ge,me,e,a,h),Me=r.prevZ,Ve=r.nextZ;Me&&Me.z>=Pe&&Ve&&Ve.z<=Ge;){if(Me.x>=H&&Me.x<=ge&&Me.y>=J&&Me.y<=me&&Me!==g&&Me!==b&&Xa(S,R,C,O,D,Z,Me.x,Me.y)&&ln(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,Ve.x>=H&&Ve.x<=ge&&Ve.y>=J&&Ve.y<=me&&Ve!==g&&Ve!==b&&Xa(S,R,C,O,D,Z,Ve.x,Ve.y)&&ln(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Me&&Me.z>=Pe;){if(Me.x>=H&&Me.x<=ge&&Me.y>=J&&Me.y<=me&&Me!==g&&Me!==b&&Xa(S,R,C,O,D,Z,Me.x,Me.y)&&ln(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;Ve&&Ve.z<=Ge;){if(Ve.x>=H&&Ve.x<=ge&&Ve.y>=J&&Ve.y<=me&&Ve!==g&&Ve!==b&&Xa(S,R,C,O,D,Z,Ve.x,Ve.y)&&ln(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function Mg(r,e,a){var h=r;do{var g=h.prev,y=h.next.next;!mc(g,y)&&jh(g,h,h.next,y)&&Ho(g,y)&&Ho(y,g)&&(e.push(g.i/a|0),e.push(h.i/a|0),e.push(y.i/a|0),Ko(h),Ko(h.next),h=r=y),h=h.next}while(h!==r);return pa(h)}function zg(r,e,a,h,g,y){var b=r;do{for(var S=b.next.next;S!==b.prev;){if(b.i!==S.i&&Rg(b,S)){var C=Zh(b,S);return b=pa(b,b.next),C=pa(C,C.next),Wo(b,e,a,h,g,y,0),void Wo(C,e,a,h,g,y,0)}S=S.next}b=b.next}while(b!==r)}function Dg(r,e){return r.x-e.x}function Pg(r,e){var a=function(g,y){var b,S=y,C=g.x,D=g.y,R=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var O=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(O<=C&&O>R&&(R=O,b=S.x<S.next.x?S:S.next,O===C))return b}S=S.next}while(S!==y);if(!b)return null;var Z,H=b,J=b.x,ge=b.y,me=1/0;S=b;do C>=S.x&&S.x>=J&&C!==S.x&&Xa(D<ge?C:R,D,J,ge,D<ge?R:C,D,S.x,S.y)&&(Z=Math.abs(D-S.y)/(C-S.x),Ho(S,g)&&(Z<me||Z===me&&(S.x>b.x||S.x===b.x&&Lg(b,S)))&&(b=S,me=Z)),S=S.next;while(S!==H);return b}(r,e);if(!a)return e;var h=Zh(a,r);return pa(h,h.next),pa(a,a.next)}function Lg(r,e){return ln(r.prev,r,e.prev)<0&&ln(e.next,r,r.next)<0}function xu(r,e,a,h,g){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-a)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-h)*g|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bg(r){var e=r,a=r;do(e.x<a.x||e.x===a.x&&e.y<a.y)&&(a=e),e=e.next;while(e!==r);return a}function Xa(r,e,a,h,g,y,b,S){return(g-b)*(e-S)>=(r-b)*(y-S)&&(r-b)*(h-S)>=(a-b)*(e-S)&&(a-b)*(y-S)>=(g-b)*(h-S)}function Rg(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(a,h){var g=a;do{if(g.i!==a.i&&g.next.i!==a.i&&g.i!==h.i&&g.next.i!==h.i&&jh(g,g.next,a,h))return!0;g=g.next}while(g!==a);return!1}(r,e)&&(Ho(r,e)&&Ho(e,r)&&function(a,h){var g=a,y=!1,b=(a.x+h.x)/2,S=(a.y+h.y)/2;do g.y>S!=g.next.y>S&&g.next.y!==g.y&&b<(g.next.x-g.x)*(S-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==a);return y}(r,e)&&(ln(r.prev,r,e.prev)||ln(r,e.prev,e))||mc(r,e)&&ln(r.prev,r,r.next)>0&&ln(e.prev,e,e.next)>0)}function ln(r,e,a){return(e.y-r.y)*(a.x-e.x)-(e.x-r.x)*(a.y-e.y)}function mc(r,e){return r.x===e.x&&r.y===e.y}function jh(r,e,a,h){var g=gc(ln(r,e,a)),y=gc(ln(r,e,h)),b=gc(ln(a,h,r)),S=gc(ln(a,h,e));return g!==y&&b!==S||!(g!==0||!pc(r,a,e))||!(y!==0||!pc(r,h,e))||!(b!==0||!pc(a,r,h))||!(S!==0||!pc(a,e,h))}function pc(r,e,a){return e.x<=Math.max(r.x,a.x)&&e.x>=Math.min(r.x,a.x)&&e.y<=Math.max(r.y,a.y)&&e.y>=Math.min(r.y,a.y)}function gc(r){return r>0?1:r<0?-1:0}function Ho(r,e){return ln(r.prev,r,r.next)<0?ln(r,e,r.next)>=0&&ln(r,r.prev,e)>=0:ln(r,e,r.prev)<0||ln(r,r.next,e)<0}function Zh(r,e){var a=new wu(r.i,r.x,r.y),h=new wu(e.i,e.x,e.y),g=r.next,y=e.prev;return r.next=e,e.prev=r,a.next=g,g.prev=a,h.next=a,a.prev=h,y.next=h,h.prev=y,h}function Xh(r,e,a,h){var g=new wu(r,e,a);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Ko(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function wu(r,e,a){this.i=r,this.x=e,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Iu(r,e,a,h){for(var g=0,y=e,b=a-h;y<a;y+=h)g+=(r[b]-r[y])*(r[y+1]+r[b+1]),b=y;return g}function Fg(r,e,a,h,g){Wh(r,e,a||0,h||r.length-1,g||Og)}function Wh(r,e,a,h,g){for(;h>a;){if(h-a>600){var y=h-a+1,b=e-a+1,S=Math.log(y),C=.5*Math.exp(2*S/3),D=.5*Math.sqrt(S*C*(y-C)/y)*(b-y/2<0?-1:1);Wh(r,e,Math.max(a,Math.floor(e-b*C/y+D)),Math.min(h,Math.floor(e+(y-b)*C/y+D)),g)}var R=r[e],O=a,Z=h;for(Yo(r,a,e),g(r[h],R)>0&&Yo(r,a,h);O<Z;){for(Yo(r,O,Z),O++,Z--;g(r[O],R)<0;)O++;for(;g(r[Z],R)>0;)Z--}g(r[a],R)===0?Yo(r,a,Z):Yo(r,++Z,h),Z<=e&&(a=Z+1),e<=Z&&(h=Z-1)}}function Yo(r,e,a){var h=r[e];r[e]=r[a],r[a]=h}function Og(r,e){return r<e?-1:r>e?1:0}function ku(r,e){const a=r.length;if(a<=1)return[r];const h=[];let g,y;for(let b=0;b<a;b++){const S=Ne(r[b]);S!==0&&(r[b].area=Math.abs(S),y===void 0&&(y=S<0),y===S<0?(g&&h.push(g),g=[r[b]]):g.push(r[b]))}if(g&&h.push(g),e>1)for(let b=0;b<h.length;b++)h[b].length<=e||(Fg(h[b],e,1,h[b].length-1,Vg),h[b]=h[b].slice(0,e));return h}function Vg(r,e){return e.area-r.area}function Tu(r,e,a){const h=a.patternDependencies;let g=!1;for(const y of e){const b=y.paint.get(`${r}-pattern`);b.isConstant()||(g=!0);const S=b.constantOr(null);S&&(g=!0,h[S.to]=!0,h[S.from]=!0)}return g}function Su(r,e,a,h,g){const y=g.patternDependencies;for(const b of e){const S=b.paint.get(`${r}-pattern`).value;if(S.kind!=="constant"){let C=S.evaluate({zoom:h-1},a,{},g.availableImages),D=S.evaluate({zoom:h},a,{},g.availableImages),R=S.evaluate({zoom:h+1},a,{},g.availableImages);C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,R=R&&R.name?R.name:R,y[C]=!0,y[D]=!0,y[R]=!0,a.patterns[b.id]={min:C,mid:D,max:R}}}return a}fc.exports=dc,fc.exports.default=dc,dc.deviation=function(r,e,a,h){var g=e&&e.length,y=Math.abs(Iu(r,0,g?e[0]*a:r.length,a));if(g)for(var b=0,S=e.length;b<S;b++)y-=Math.abs(Iu(r,e[b]*a,b<S-1?e[b+1]*a:r.length,a));var C=0;for(b=0;b<h.length;b+=3){var D=h[b]*a,R=h[b+1]*a,O=h[b+2]*a;C+=Math.abs((r[D]-r[O])*(r[R+1]-r[D+1])-(r[D]-r[R])*(r[O+1]-r[D+1]))}return y===0&&C===0?0:Math.abs((C-y)/y)},dc.flatten=function(r){for(var e=r[0][0].length,a={vertices:[],holes:[],dimensions:e},h=0,g=0;g<r.length;g++){for(var y=0;y<r[g].length;y++)for(var b=0;b<e;b++)a.vertices.push(r[g][y][b]);g>0&&a.holes.push(h+=r[g-1].length)}return a};class Eu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fi,this.indexArray=new qn,this.indexArray2=new Vr,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new bi,this.segments2=new bi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(e,a,h){this.hasPattern=Tu("fill",this.layers,a);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),b=[];for(const{feature:S,id:C,index:D,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,Z=ma(S,O);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),Z,h))continue;const H=y?g.evaluate(Z,{},h,a.availableImages):void 0,J={id:C,properties:S.properties,type:S.type,sourceLayerIndex:R,index:D,geometry:O?Z.geometry:da(S),patterns:{},sortKey:H};b.push(J)}y&&b.sort((S,C)=>S.sortKey-C.sortKey);for(const S of b){const{geometry:C,index:D,sourceLayerIndex:R}=S;if(this.hasPattern){const O=Su("fill",this.layers,S,this.zoom,a);this.patternFeatures.push(O)}else this.addFeature(S,C,D,h,{});a.featureIndex.insert(e[D].feature,C,D,R,this.index)}}update(e,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,a,this.stateDependentLayers,h)}addFeatures(e,a,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Eg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,a,h,g,y){for(const b of ku(a,500)){let S=0;for(const H of b)S+=H.length;const C=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),D=C.vertexLength,R=[],O=[];for(const H of b){if(H.length===0)continue;H!==b[0]&&O.push(R.length/2);const J=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ge=J.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ge+H.length-1,ge),R.push(H[0].x),R.push(H[0].y);for(let me=1;me<H.length;me++)this.layoutVertexArray.emplaceBack(H[me].x,H[me].y),this.indexArray2.emplaceBack(ge+me-1,ge+me),R.push(H[me].x),R.push(H[me].y);J.vertexLength+=H.length,J.primitiveLength+=H.length}const Z=fc.exports(R,O);for(let H=0;H<Z.length;H+=3)this.indexArray.emplaceBack(D+Z[H],D+Z[H+1],D+Z[H+2]);C.vertexLength+=S,C.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,g)}}Vt("FillBucket",Eu,{omit:["layers","patternFeatures"]});const Ng=new Sn({"fill-sort-key":new $t(Ye.layout_fill["fill-sort-key"])});var Ug={paint:new Sn({"fill-antialias":new Xt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new $t(Ye.paint_fill["fill-opacity"]),"fill-color":new $t(Ye.paint_fill["fill-color"]),"fill-outline-color":new $t(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Xt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ls(Ye.paint_fill["fill-pattern"])}),layout:Ng};const Gg=hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),qg=hn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:jg}=Gg;var Fs={},Zg=ce,Hh=Wa;function Wa(r,e,a,h,g){this.properties={},this.extent=a,this.type=0,this._pbf=r,this._geometry=-1,this._keys=h,this._values=g,r.readFields(Xg,this,e)}function Xg(r,e,a){r==1?e.id=a.readVarint():r==2?function(h,g){for(var y=h.readVarint()+h.pos;h.pos<y;){var b=g._keys[h.readVarint()],S=g._values[h.readVarint()];g.properties[b]=S}}(a,e):r==3?e.type=a.readVarint():r==4&&(e._geometry=a.pos)}function Wg(r){for(var e,a,h=0,g=0,y=r.length,b=y-1;g<y;b=g++)h+=((a=r[b]).x-(e=r[g]).x)*(e.y+a.y);return h}Wa.types=["Unknown","Point","LineString","Polygon"],Wa.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,a=r.readVarint()+r.pos,h=1,g=0,y=0,b=0,S=[];r.pos<a;){if(g<=0){var C=r.readVarint();h=7&C,g=C>>3}if(g--,h===1||h===2)y+=r.readSVarint(),b+=r.readSVarint(),h===1&&(e&&S.push(e),e=[]),e.push(new Zg(y,b));else{if(h!==7)throw new Error("unknown command "+h);e&&e.push(e[0].clone())}}return e&&S.push(e),S},Wa.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,a=1,h=0,g=0,y=0,b=1/0,S=-1/0,C=1/0,D=-1/0;r.pos<e;){if(h<=0){var R=r.readVarint();a=7&R,h=R>>3}if(h--,a===1||a===2)(g+=r.readSVarint())<b&&(b=g),g>S&&(S=g),(y+=r.readSVarint())<C&&(C=y),y>D&&(D=y);else if(a!==7)throw new Error("unknown command "+a)}return[b,C,S,D]},Wa.prototype.toGeoJSON=function(r,e,a){var h,g,y=this.extent*Math.pow(2,a),b=this.extent*r,S=this.extent*e,C=this.loadGeometry(),D=Wa.types[this.type];function R(H){for(var J=0;J<H.length;J++){var ge=H[J];H[J]=[360*(ge.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+S)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(h=0;h<C.length;h++)O[h]=C[h][0];R(C=O);break;case 2:for(h=0;h<C.length;h++)R(C[h]);break;case 3:for(C=function(H){var J=H.length;if(J<=1)return[H];for(var ge,me,Pe=[],Ge=0;Ge<J;Ge++){var Me=Wg(H[Ge]);Me!==0&&(me===void 0&&(me=Me<0),me===Me<0?(ge&&Pe.push(ge),ge=[H[Ge]]):ge.push(H[Ge]))}return ge&&Pe.push(ge),Pe}(C),h=0;h<C.length;h++)for(g=0;g<C[h].length;g++)R(C[h][g])}C.length===1?C=C[0]:D="Multi"+D;var Z={type:"Feature",geometry:{type:D,coordinates:C},properties:this.properties};return"id"in this&&(Z.id=this.id),Z};var Hg=Hh,Kh=Yh;function Yh(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Kg,this,e),this.length=this._features.length}function Kg(r,e,a){r===15?e.version=a.readVarint():r===1?e.name=a.readString():r===5?e.extent=a.readVarint():r===2?e._features.push(a.pos):r===3?e._keys.push(a.readString()):r===4&&e._values.push(function(h){for(var g=null,y=h.readVarint()+h.pos;h.pos<y;){var b=h.readVarint()>>3;g=b===1?h.readString():b===2?h.readFloat():b===3?h.readDouble():b===4?h.readVarint64():b===5?h.readVarint():b===6?h.readSVarint():b===7?h.readBoolean():null}return g}(a))}Yh.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Hg(this._pbf,e,this.extent,this._keys,this._values)};var Yg=Kh;function Jg(r,e,a){if(r===3){var h=new Yg(a,a.readVarint()+a.pos);h.length&&(e[h.name]=h)}}Fs.VectorTile=function(r,e){this.layers=r.readFields(Jg,{},e)},Fs.VectorTileFeature=Hh,Fs.VectorTileLayer=Kh;const Qg=Fs.VectorTileFeature.types,Au=Math.pow(2,13);function Jo(r,e,a,h,g,y,b,S){r.emplaceBack(e,a,2*Math.floor(h*Au)+b,g*Au*2,y*Au*2,Math.round(S))}class Cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ai,this.centroidVertexArray=new Yt,this.indexArray=new qn,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new bi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(e,a,h){this.features=[],this.hasPattern=Tu("fill-extrusion",this.layers,a);for(const{feature:g,id:y,index:b,sourceLayerIndex:S}of e){const C=this.layers[0]._featureFilter.needGeometry,D=ma(g,C);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),D,h))continue;const R={id:y,sourceLayerIndex:S,index:b,geometry:C?D.geometry:da(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Su("fill-extrusion",this.layers,R,this.zoom,a)):this.addFeature(R,R.geometry,b,h,{}),a.featureIndex.insert(g,R.geometry,b,S,this.index,!0)}}addFeatures(e,a,h){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,a,h)}}update(e,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,a,this.stateDependentLayers,h)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jg),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,qg.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,a,h,g,y){const b={x:0,y:0,vertexCount:0};for(const S of ku(a,500)){let C=0;for(const J of S)C+=J.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const J of S){if(J.length===0||e_(J))continue;let ge=0;for(let me=0;me<J.length;me++){const Pe=J[me];if(me>=1){const Ge=J[me-1];if(!$g(Pe,Ge)){D.vertexLength+4>bi.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Me=Pe.sub(Ge)._perp()._unit(),Ve=Ge.dist(Pe);ge+Ve>32768&&(ge=0),Jo(this.layoutVertexArray,Pe.x,Pe.y,Me.x,Me.y,0,0,ge),Jo(this.layoutVertexArray,Pe.x,Pe.y,Me.x,Me.y,0,1,ge),b.x+=2*Pe.x,b.y+=2*Pe.y,b.vertexCount+=2,ge+=Ve,Jo(this.layoutVertexArray,Ge.x,Ge.y,Me.x,Me.y,0,0,ge),Jo(this.layoutVertexArray,Ge.x,Ge.y,Me.x,Me.y,0,1,ge),b.x+=2*Ge.x,b.y+=2*Ge.y,b.vertexCount+=2;const at=D.vertexLength;this.indexArray.emplaceBack(at,at+2,at+1),this.indexArray.emplaceBack(at+1,at+2,at+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+C>bi.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),Qg[e.type]!=="Polygon")continue;const R=[],O=[],Z=D.vertexLength;for(const J of S)if(J.length!==0){J!==S[0]&&O.push(R.length/2);for(let ge=0;ge<J.length;ge++){const me=J[ge];Jo(this.layoutVertexArray,me.x,me.y,0,0,1,1,0),b.x+=me.x,b.y+=me.y,b.vertexCount+=1,R.push(me.x),R.push(me.y)}}const H=fc.exports(R,O);for(let J=0;J<H.length;J+=3)this.indexArray.emplaceBack(Z+H[J],Z+H[J+2],Z+H[J+1]);D.primitiveLength+=H.length/3,D.vertexLength+=C}for(let S=0;S<b.vertexCount;S++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,g)}}function $g(r,e){return r.x===e.x&&(r.x<0||r.x>gn)||r.y===e.y&&(r.y<0||r.y>gn)}function e_(r){return r.every(e=>e.x<0)||r.every(e=>e.x>gn)||r.every(e=>e.y<0)||r.every(e=>e.y>gn)}Vt("FillExtrusionBucket",Cu,{omit:["layers","features"]});var t_={paint:new Sn({"fill-extrusion-opacity":new Xt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ls(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $t(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Qo(r,e){return r.x*e.x+r.y*e.y}function Jh(r,e){if(r.length===1){let a=0;const h=e[a++];let g;for(;!g||h.equals(g);)if(g=e[a++],!g)return 1/0;for(;a<e.length;a++){const y=e[a],b=r[0],S=g.sub(h),C=y.sub(h),D=b.sub(h),R=Qo(S,S),O=Qo(S,C),Z=Qo(C,C),H=Qo(D,S),J=Qo(D,C),ge=R*Z-O*O,me=(Z*H-O*J)/ge,Pe=(R*J-O*H)/ge,Ge=h.z*(1-me-Pe)+g.z*me+y.z*Pe;if(isFinite(Ge))return Ge}return 1/0}{let a=1/0;for(const h of e)a=Math.min(a,h.z);return a}}const i_=hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:n_}=i_,r_=hn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:s_}=r_,a_=Fs.VectorTileFeature.types,o_=Math.cos(Math.PI/180*37.5),Qh=Math.pow(2,14)/.5;class Mu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Mi,this.layoutVertexArray2=new Oi,this.indexArray=new qn,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new bi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(e,a,h){this.hasPattern=Tu("line",this.layers,a);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),b=[];for(const{feature:S,id:C,index:D,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,Z=ma(S,O);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),Z,h))continue;const H=y?g.evaluate(Z,{},h):void 0,J={id:C,properties:S.properties,type:S.type,sourceLayerIndex:R,index:D,geometry:O?Z.geometry:da(S),patterns:{},sortKey:H};b.push(J)}y&&b.sort((S,C)=>S.sortKey-C.sortKey);for(const S of b){const{geometry:C,index:D,sourceLayerIndex:R}=S;if(this.hasPattern){const O=Su("line",this.layers,S,this.zoom,a);this.patternFeatures.push(O)}else this.addFeature(S,C,D,h,{});a.featureIndex.insert(e[D].feature,C,D,R,this.index)}}update(e,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,a,this.stateDependentLayers,h)}addFeatures(e,a,h){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,s_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,a,h,g,y){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),C=b.get("line-cap"),D=b.get("line-miter-limit"),R=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of a)this.addLine(O,e,S,C,D,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,h,y,g)}addLine(e,a,h,g,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<e.length-1;Pe++)this.totalDistance+=e[Pe].dist(e[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=a_[a.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let D=0;for(;D<C-1&&e[D].equals(e[D+1]);)D++;if(C<(S?3:2))return;h==="bevel"&&(y=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let Z,H,J,ge,me;this.e1=this.e2=-1,S&&(Z=e[C-2],me=e[D].sub(Z)._unit()._perp());for(let Pe=D;Pe<C;Pe++){if(J=Pe===C-1?S?e[D+1]:void 0:e[Pe+1],J&&e[Pe].equals(J))continue;me&&(ge=me),Z&&(H=Z),Z=e[Pe],me=J?J.sub(Z)._unit()._perp():ge,ge=ge||me;let Ge=ge.add(me);Ge.x===0&&Ge.y===0||Ge._unit();const Me=ge.x*me.x+ge.y*me.y,Ve=Ge.x*me.x+Ge.y*me.y,at=Ve!==0?1/Ve:1/0,st=2*Math.sqrt(2-2*Ve),Lt=Ve<o_&&H&&J,Zt=ge.x*me.y-ge.y*me.x>0;if(Lt&&Pe>D){const wt=Z.dist(H);if(wt>2*R){const zt=Z.sub(Z.sub(H)._mult(R/wt)._round());this.updateDistance(H,zt),this.addCurrentVertex(zt,ge,0,0,O),H=zt}}const Mt=H&&J;let Tt=Mt?h:S?"butt":g;if(Mt&&Tt==="round"&&(at<b?Tt="miter":at<=2&&(Tt="fakeround")),Tt==="miter"&&at>y&&(Tt="bevel"),Tt==="bevel"&&(at>2&&(Tt="flipbevel"),at<y&&(Tt="miter")),H&&this.updateDistance(H,Z),Tt==="miter")Ge._mult(at),this.addCurrentVertex(Z,Ge,0,0,O);else if(Tt==="flipbevel"){if(at>100)Ge=me.mult(-1);else{const wt=at*ge.add(me).mag()/ge.sub(me).mag();Ge._perp()._mult(wt*(Zt?-1:1))}this.addCurrentVertex(Z,Ge,0,0,O),this.addCurrentVertex(Z,Ge.mult(-1),0,0,O)}else if(Tt==="bevel"||Tt==="fakeround"){const wt=-Math.sqrt(at*at-1),zt=Zt?wt:0,St=Zt?0:wt;if(H&&this.addCurrentVertex(Z,ge,zt,St,O),Tt==="fakeround"){const _t=Math.round(180*st/Math.PI/20);for(let Jt=1;Jt<_t;Jt++){let Wt=Jt/_t;if(Wt!==.5){const Xi=Wt-.5;Wt+=Wt*Xi*(Wt-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*Xi*Xi+(.848013+Me*(.215638*Me-1.06021)))}const vi=me.sub(ge)._mult(Wt)._add(ge)._unit()._mult(Zt?-1:1);this.addHalfVertex(Z,vi.x,vi.y,!1,Zt,0,O)}}J&&this.addCurrentVertex(Z,me,-zt,-St,O)}else if(Tt==="butt")this.addCurrentVertex(Z,Ge,0,0,O);else if(Tt==="square"){const wt=H?1:-1;this.addCurrentVertex(Z,Ge,wt,wt,O)}else Tt==="round"&&(H&&(this.addCurrentVertex(Z,ge,0,0,O),this.addCurrentVertex(Z,ge,1,1,O,!0)),J&&(this.addCurrentVertex(Z,me,-1,-1,O,!0),this.addCurrentVertex(Z,me,0,0,O)));if(Lt&&Pe<C-1){const wt=Z.dist(J);if(wt>2*R){const zt=Z.add(J.sub(Z)._mult(R/wt)._round());this.updateDistance(Z,zt),this.addCurrentVertex(zt,me,0,0,O),Z=zt}}}}addCurrentVertex(e,a,h,g,y,b=!1){const S=a.y*g-a.x,C=-a.y-a.x*g;this.addHalfVertex(e,a.x+a.y*h,a.y-a.x*h,b,!1,h,y),this.addHalfVertex(e,S,C,b,!0,-g,y),this.distance>Qh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,a,h,g,y,b))}addHalfVertex({x:e,y:a},h,g,y,b,S,C){const D=.5*(this.lineClips?this.scaledDistance*(Qh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(a<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(S===0?0:S<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),C.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,a){this.distance+=e.dist(a),this.updateScaledDistance()}}Vt("LineBucket",Mu,{omit:["layers","patternFeatures"]});const l_=new Sn({"line-cap":new Xt(Ye.layout_line["line-cap"]),"line-join":new $t(Ye.layout_line["line-join"]),"line-miter-limit":new Xt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Xt(Ye.layout_line["line-round-limit"]),"line-sort-key":new $t(Ye.layout_line["line-sort-key"])});var $h={paint:new Sn({"line-opacity":new $t(Ye.paint_line["line-opacity"]),"line-color":new $t(Ye.paint_line["line-color"]),"line-translate":new Xt(Ye.paint_line["line-translate"]),"line-translate-anchor":new Xt(Ye.paint_line["line-translate-anchor"]),"line-width":new $t(Ye.paint_line["line-width"]),"line-gap-width":new $t(Ye.paint_line["line-gap-width"]),"line-offset":new $t(Ye.paint_line["line-offset"]),"line-blur":new $t(Ye.paint_line["line-blur"]),"line-dasharray":new Vo(Ye.paint_line["line-dasharray"]),"line-pattern":new Ls(Ye.paint_line["line-pattern"]),"line-gradient":new es(Ye.paint_line["line-gradient"])}),layout:l_};const ef=new class extends $t{possiblyEvaluate(r,e){return e=new Yi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,a,h){return e=K({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,a,h)}}($h.paint.properties["line-width"].specification);function tf(r,e){return e>0?e+2*r:r}ef.useIntegerZoom=!0;const c_=hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),u_=hn([{name:"a_projected_pos",components:3,type:"Float32"}],4);hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const h_=hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);hn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nf=hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),f_=hn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function d_(r,e,a){return r.sections.forEach(h=>{h.text=function(g,y,b){const S=y.layout.get("text-transform").evaluate(b,{});return S==="uppercase"?g=g.toLocaleUpperCase():S==="lowercase"&&(g=g.toLocaleLowerCase()),lr.applyArabicShaping&&(g=lr.applyArabicShaping(g)),g}(h.text,e,a)}),r}hn([{name:"triangle",components:3,type:"Uint16"}]),hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),hn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),hn([{type:"Float32",name:"offsetX"}]),hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const $o={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var En=24,zu=Ui,rf=function(r,e,a,h,g){var y,b,S=8*g-h-1,C=(1<<S)-1,D=C>>1,R=-7,O=a?g-1:0,Z=a?-1:1,H=r[e+O];for(O+=Z,y=H&(1<<-R)-1,H>>=-R,R+=S;R>0;y=256*y+r[e+O],O+=Z,R-=8);for(b=y&(1<<-R)-1,y>>=-R,R+=h;R>0;b=256*b+r[e+O],O+=Z,R-=8);if(y===0)y=1-D;else{if(y===C)return b?NaN:1/0*(H?-1:1);b+=Math.pow(2,h),y-=D}return(H?-1:1)*b*Math.pow(2,y-h)},sf=function(r,e,a,h,g,y){var b,S,C,D=8*y-g-1,R=(1<<D)-1,O=R>>1,Z=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=h?0:y-1,J=h?1:-1,ge=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(S=isNaN(e)?1:0,b=R):(b=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-b))<1&&(b--,C*=2),(e+=b+O>=1?Z/C:Z*Math.pow(2,1-O))*C>=2&&(b++,C/=2),b+O>=R?(S=0,b=R):b+O>=1?(S=(e*C-1)*Math.pow(2,g),b+=O):(S=e*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;r[a+H]=255&S,H+=J,S/=256,g-=8);for(b=b<<g|S,D+=g;D>0;r[a+H]=255&b,H+=J,b/=256,D-=8);r[a+H-J]|=128*ge};function Ui(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Ui.Varint=0,Ui.Fixed64=1,Ui.Bytes=2,Ui.Fixed32=5;var Os,Du=4294967296,af=1/Du,of=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gs(r){return r.type===Ui.Bytes?r.readVarint()+r.pos:r.pos+1}function Ha(r,e,a){return a?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function lf(r,e,a){var h=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));a.realloc(h);for(var g=a.pos-1;g>=r;g--)a.buf[g+h]=a.buf[g]}function m_(r,e){for(var a=0;a<r.length;a++)e.writeVarint(r[a])}function p_(r,e){for(var a=0;a<r.length;a++)e.writeSVarint(r[a])}function g_(r,e){for(var a=0;a<r.length;a++)e.writeFloat(r[a])}function __(r,e){for(var a=0;a<r.length;a++)e.writeDouble(r[a])}function y_(r,e){for(var a=0;a<r.length;a++)e.writeBoolean(r[a])}function v_(r,e){for(var a=0;a<r.length;a++)e.writeFixed32(r[a])}function b_(r,e){for(var a=0;a<r.length;a++)e.writeSFixed32(r[a])}function x_(r,e){for(var a=0;a<r.length;a++)e.writeFixed64(r[a])}function w_(r,e){for(var a=0;a<r.length;a++)e.writeSFixed64(r[a])}function _c(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Ka(r,e,a){r[a]=e,r[a+1]=e>>>8,r[a+2]=e>>>16,r[a+3]=e>>>24}function cf(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function I_(r,e,a){r===1&&a.readMessage(k_,e)}function k_(r,e,a){if(r===3){const{id:h,bitmap:g,width:y,height:b,left:S,top:C,advance:D}=a.readMessage(T_,{});e.push({id:h,bitmap:new Xo({width:y+6,height:b+6},g),metrics:{width:y,height:b,left:S,top:C,advance:D}})}}function T_(r,e,a){r===1?e.id=a.readVarint():r===2?e.bitmap=a.readBytes():r===3?e.width=a.readVarint():r===4?e.height=a.readVarint():r===5?e.left=a.readSVarint():r===6?e.top=a.readSVarint():r===7&&(e.advance=a.readVarint())}function uf(r){let e=0,a=0;for(const b of r)e+=b.w*b.h,a=Math.max(a,b.w);r.sort((b,S)=>S.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),a),h:1/0}];let g=0,y=0;for(const b of r)for(let S=h.length-1;S>=0;S--){const C=h[S];if(!(b.w>C.w||b.h>C.h)){if(b.x=C.x,b.y=C.y,y=Math.max(y,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===C.w&&b.h===C.h){const D=h.pop();S<h.length&&(h[S]=D)}else b.h===C.h?(C.x+=b.w,C.w-=b.w):b.w===C.w?(C.y+=b.h,C.h-=b.h):(h.push({x:C.x+b.w,y:C.y,w:C.w-b.w,h:b.h}),C.y+=b.h,C.h-=b.h);break}}return{w:g,h:y,fill:e/(g*y)||0}}Ui.prototype={destroy:function(){this.buf=null},readFields:function(r,e,a){for(a=a||this.length;this.pos<a;){var h=this.readVarint(),g=h>>3,y=this.pos;this.type=7&h,r(g,e,this),this.pos===y&&this.skip(h)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=_c(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=cf(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=_c(this.buf,this.pos)+_c(this.buf,this.pos+4)*Du;return this.pos+=8,r},readSFixed64:function(){var r=_c(this.buf,this.pos)+cf(this.buf,this.pos+4)*Du;return this.pos+=8,r},readFloat:function(){var r=rf(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=rf(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,a,h=this.buf;return e=127&(a=h[this.pos++]),a<128?e:(e|=(127&(a=h[this.pos++]))<<7,a<128?e:(e|=(127&(a=h[this.pos++]))<<14,a<128?e:(e|=(127&(a=h[this.pos++]))<<21,a<128?e:function(g,y,b){var S,C,D=b.buf;if(S=(112&(C=D[b.pos++]))>>4,C<128||(S|=(127&(C=D[b.pos++]))<<3,C<128)||(S|=(127&(C=D[b.pos++]))<<10,C<128)||(S|=(127&(C=D[b.pos++]))<<17,C<128)||(S|=(127&(C=D[b.pos++]))<<24,C<128)||(S|=(1&(C=D[b.pos++]))<<31,C<128))return Ha(g,S,y);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(a=h[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&of?function(a,h,g){return of.decode(a.subarray(h,g))}(this.buf,e,r):function(a,h,g){for(var y="",b=h;b<g;){var S,C,D,R=a[b],O=null,Z=R>239?4:R>223?3:R>191?2:1;if(b+Z>g)break;Z===1?R<128&&(O=R):Z===2?(192&(S=a[b+1]))==128&&(O=(31&R)<<6|63&S)<=127&&(O=null):Z===3?(C=a[b+2],(192&(S=a[b+1]))==128&&(192&C)==128&&((O=(15&R)<<12|(63&S)<<6|63&C)<=2047||O>=55296&&O<=57343)&&(O=null)):Z===4&&(C=a[b+2],D=a[b+3],(192&(S=a[b+1]))==128&&(192&C)==128&&(192&D)==128&&((O=(15&R)<<18|(63&S)<<12|(63&C)<<6|63&D)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,Z=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),b+=Z}return y}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Ui.Bytes)return r.push(this.readVarint(e));var a=gs(this);for(r=r||[];this.pos<a;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Ui.Bytes)return r.push(this.readSVarint());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Ui.Bytes)return r.push(this.readBoolean());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Ui.Bytes)return r.push(this.readFloat());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Ui.Bytes)return r.push(this.readDouble());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Ui.Bytes)return r.push(this.readFixed32());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Ui.Bytes)return r.push(this.readSFixed32());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Ui.Bytes)return r.push(this.readFixed64());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Ui.Bytes)return r.push(this.readSFixed64());var e=gs(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Ui.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ui.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ui.Fixed32)this.pos+=4;else{if(e!==Ui.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var a=new Uint8Array(e);a.set(this.buf),this.buf=a,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Ka(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Ka(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Ka(this.buf,-1&r,this.pos),Ka(this.buf,Math.floor(r*af),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Ka(this.buf,-1&r,this.pos),Ka(this.buf,Math.floor(r*af),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,a){var h,g;if(e>=0?(h=e%4294967296|0,g=e/4294967296|0):(g=~(-e/4294967296),4294967295^(h=~(-e%4294967296))?h=h+1|0:(h=0,g=g+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(y,b,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)}(h,0,a),function(y,b){var S=(7&y)<<4;b.buf[b.pos++]|=S|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(g,a)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(h,g,y){for(var b,S,C=0;C<g.length;C++){if((b=g.charCodeAt(C))>55295&&b<57344){if(!S){b>56319||C+1===g.length?(h[y++]=239,h[y++]=191,h[y++]=189):S=b;continue}if(b<56320){h[y++]=239,h[y++]=191,h[y++]=189,S=b;continue}b=S-55296<<10|b-56320|65536,S=null}else S&&(h[y++]=239,h[y++]=191,h[y++]=189,S=null);b<128?h[y++]=b:(b<2048?h[y++]=b>>6|192:(b<65536?h[y++]=b>>12|224:(h[y++]=b>>18|240,h[y++]=b>>12&63|128),h[y++]=b>>6&63|128),h[y++]=63&b|128)}return y}(this.buf,r,this.pos);var a=this.pos-e;a>=128&&lf(e,a,this),this.pos=e-1,this.writeVarint(a),this.pos+=a},writeFloat:function(r){this.realloc(4),sf(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),sf(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var a=0;a<e;a++)this.buf[this.pos++]=r[a]},writeRawMessage:function(r,e){this.pos++;var a=this.pos;r(e,this);var h=this.pos-a;h>=128&&lf(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h},writeMessage:function(r,e,a){this.writeTag(r,Ui.Bytes),this.writeRawMessage(e,a)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,m_,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,p_,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,y_,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,g_,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,__,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,v_,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,b_,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,x_,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,w_,e)},writeBytesField:function(r,e){this.writeTag(r,Ui.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Ui.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Ui.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Ui.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Ui.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Ui.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Ui.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Ui.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Ui.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Ui.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};class Pu{constructor(e,{pixelRatio:a,version:h,stretchX:g,stretchY:y,content:b}){this.paddedRect=e,this.pixelRatio=a,this.stretchX=g,this.stretchY=y,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hf{constructor(e,a){const h={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,h,y),this.addImages(a,g,y);const{w:b,h:S}=uf(y),C=new _r({width:b||1,height:S||1});for(const D in e){const R=e[D],O=h[D].paddedRect;_r.copy(R.data,C,{x:0,y:0},{x:O.x+1,y:O.y+1},R.data)}for(const D in a){const R=a[D],O=g[D].paddedRect,Z=O.x+1,H=O.y+1,J=R.data.width,ge=R.data.height;_r.copy(R.data,C,{x:0,y:0},{x:Z,y:H},R.data),_r.copy(R.data,C,{x:0,y:ge-1},{x:Z,y:H-1},{width:J,height:1}),_r.copy(R.data,C,{x:0,y:0},{x:Z,y:H+ge},{width:J,height:1}),_r.copy(R.data,C,{x:J-1,y:0},{x:Z-1,y:H},{width:1,height:ge}),_r.copy(R.data,C,{x:0,y:0},{x:Z+J,y:H},{width:1,height:ge})}this.image=C,this.iconPositions=h,this.patternPositions=g}addImages(e,a,h){for(const g in e){const y=e[g],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};h.push(b),a[g]=new Pu(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(e,a){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in e.updatedImages)this.patchUpdatedImage(this.iconPositions[h],e.getImage(h),a),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h),a)}patchUpdatedImage(e,a,h){if(!e||!a||e.version===a.version)return;e.version=a.version;const[g,y]=e.tl;h.update(a.data,void 0,{x:g,y})}}Vt("ImagePosition",Pu),Vt("ImageAtlas",hf),o.WritingMode=void 0,(Os=o.WritingMode||(o.WritingMode={}))[Os.none=0]="none",Os[Os.horizontal=1]="horizontal",Os[Os.vertical=2]="vertical",Os[Os.horizontalOnly=3]="horizontalOnly";const yc=-17;class el{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,a){const h=new el;return h.scale=e||1,h.fontStack=a,h}static forImage(e){const a=new el;return a.imageName=e,a}}class Ya{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,a){const h=new Ya;for(let g=0;g<e.sections.length;g++){const y=e.sections[g];y.image?h.addImageSection(y):h.addTextSection(y,a)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let a="";for(let h=0;h<e.length;h++){const g=e.charCodeAt(h+1)||null,y=e.charCodeAt(h-1)||null;a+=g&&Ql(g)&&!$o[e[h+1]]||y&&Ql(y)&&!$o[e[h-1]]||!$o[e[h]]?e[h]:$o[e[h]]}return a}(this.text)}trim(){let e=0;for(let h=0;h<this.text.length&&bc[this.text.charCodeAt(h)];h++)e++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=e&&bc[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(e,a),this.sectionIndex=this.sectionIndex.slice(e,a)}substring(e,a){const h=new Ya;return h.text=this.text.substring(e,a),h.sectionIndex=this.sectionIndex.slice(e,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,a)=>Math.max(e,this.sections[a].scale),0)}addTextSection(e,a){this.text+=e.text,this.sections.push(el.forText(e.scale,e.fontStack||a));const h=this.sections.length-1;for(let g=0;g<e.text.length;++g)this.sectionIndex.push(h)}addImageSection(e){const a=e.image?e.image.name:"";if(a.length===0)return void ne("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(el.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ne("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vc(r,e,a,h,g,y,b,S,C,D,R,O,Z,H,J,ge){const me=Ya.fromFeature(r,g);let Pe;O===o.WritingMode.vertical&&me.verticalizePunctuation();const{processBidirectionalText:Ge,processStyledBidirectionalText:Me}=lr;if(Ge&&me.sections.length===1){Pe=[];const st=Ge(me.toString(),Lu(me,D,y,e,h,H,J));for(const Lt of st){const Zt=new Ya;Zt.text=Lt,Zt.sections=me.sections;for(let Mt=0;Mt<Lt.length;Mt++)Zt.sectionIndex.push(0);Pe.push(Zt)}}else if(Me){Pe=[];const st=Me(me.text,me.sectionIndex,Lu(me,D,y,e,h,H,J));for(const Lt of st){const Zt=new Ya;Zt.text=Lt[0],Zt.sectionIndex=Lt[1],Zt.sections=me.sections,Pe.push(Zt)}}else Pe=function(st,Lt){const Zt=[],Mt=st.text;let Tt=0;for(const wt of Lt)Zt.push(st.substring(Tt,wt)),Tt=wt;return Tt<Mt.length&&Zt.push(st.substring(Tt,Mt.length)),Zt}(me,Lu(me,D,y,e,h,H,J));const Ve=[],at={positionedLines:Ve,text:me.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(st,Lt,Zt,Mt,Tt,wt,zt,St,_t,Jt,Wt,vi){let Xi=0,Qi=yc,_n=0,vr=0;const Mn=St==="right"?1:St==="left"?0:.5;let fn=0;for(const dn of Tt){dn.trim();const Dn=dn.getMaxScale(),Fn=(Dn-1)*En,Xn={positionedGlyphs:[],lineOffset:0};st.positionedLines[fn]=Xn;const er=Xn.positionedGlyphs;let tr=0;if(!dn.length()){Qi+=wt,++fn;continue}for(let In=0;In<dn.length();In++){const Ti=dn.getSection(In),hr=dn.getSectionIndex(In),Pn=dn.getCharCode(In);let On=0,Cr=null,Ur=null,Gr=null,ys=En;const Mr=!(_t===o.WritingMode.horizontal||!Wt&&!Po(Pn)||Wt&&(bc[Pn]||(wn=Pn,Ct.Arabic(wn)||Ct["Arabic Supplement"](wn)||Ct["Arabic Extended-A"](wn)||Ct["Arabic Presentation Forms-A"](wn)||Ct["Arabic Presentation Forms-B"](wn))));if(Ti.imageName){const br=Mt[Ti.imageName];if(!br)continue;Gr=Ti.imageName,st.iconsInText=st.iconsInText||!0,Ur=br.paddedRect;const ir=br.displaySize;Ti.scale=Ti.scale*En/vi,Cr={width:ir[0],height:ir[1],left:1,top:-3,advance:Mr?ir[1]:ir[0]},On=Fn+(En-ir[1]*Ti.scale),ys=Cr.advance;const vs=Mr?ir[0]*Ti.scale-En*Dn:ir[1]*Ti.scale-En*Dn;vs>0&&vs>tr&&(tr=vs)}else{const br=Zt[Ti.fontStack],ir=br&&br[Pn];if(ir&&ir.rect)Ur=ir.rect,Cr=ir.metrics;else{const vs=Lt[Ti.fontStack],nl=vs&&vs[Pn];if(!nl)continue;Cr=nl.metrics}On=(Dn-Ti.scale)*En}Mr?(st.verticalizable=!0,er.push({glyph:Pn,imageName:Gr,x:Xi,y:Qi+On,vertical:Mr,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:hr,metrics:Cr,rect:Ur}),Xi+=ys*Ti.scale+Jt):(er.push({glyph:Pn,imageName:Gr,x:Xi,y:Qi+On,vertical:Mr,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:hr,metrics:Cr,rect:Ur}),Xi+=Cr.advance*Ti.scale+Jt)}er.length!==0&&(_n=Math.max(Xi-Jt,_n),A_(er,0,er.length-1,Mn,tr)),Xi=0;const tn=wt*Dn+tr;Xn.lineOffset=Math.max(tr,Fn),Qi+=tn,vr=Math.max(tn,vr),++fn}var wn;const zn=Qi-yc,{horizontalAlign:Rn,verticalAlign:$n}=Bu(zt);(function(dn,Dn,Fn,Xn,er,tr,tn,In,Ti){const hr=(Dn-Fn)*er;let Pn=0;Pn=tr!==tn?-In*Xn-yc:(-Xn*Ti+.5)*tn;for(const On of dn)for(const Cr of On.positionedGlyphs)Cr.x+=hr,Cr.y+=Pn})(st.positionedLines,Mn,Rn,$n,_n,vr,wt,zn,Tt.length),st.top+=-$n*zn,st.bottom=st.top+zn,st.left+=-Rn*_n,st.right=st.left+_n}(at,e,a,h,Pe,b,S,C,O,D,Z,ge),!function(st){for(const Lt of st)if(Lt.positionedGlyphs.length!==0)return!1;return!0}(Ve)&&at}const bc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},S_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ff(r,e,a,h,g,y){if(e.imageName){const b=h[e.imageName];return b?b.displaySize[0]*e.scale*En/y+g:0}{const b=a[e.fontStack],S=b&&b[r];return S?S.metrics.advance*e.scale+g:0}}function df(r,e,a,h){const g=Math.pow(r-e,2);return h?r<e?g/2:2*g:g+Math.abs(a)*a}function E_(r,e,a){let h=0;return r===10&&(h-=1e4),a&&(h+=150),r!==40&&r!==65288||(h+=50),e!==41&&e!==65289||(h+=50),h}function mf(r,e,a,h,g,y){let b=null,S=df(e,a,g,y);for(const C of h){const D=df(e-C.x,a,g,y)+C.badness;D<=S&&(b=C,S=D)}return{index:r,x:e,priorBreak:b,badness:S}}function pf(r){return r?pf(r.priorBreak).concat(r.index):[]}function Lu(r,e,a,h,g,y,b){if(y!=="point")return[];if(!r)return[];const S=[],C=function(Z,H,J,ge,me,Pe){let Ge=0;for(let Me=0;Me<Z.length();Me++){const Ve=Z.getSection(Me);Ge+=ff(Z.getCharCode(Me),Ve,ge,me,H,Pe)}return Ge/Math.max(1,Math.ceil(Ge/J))}(r,e,a,h,g,b),D=r.text.indexOf("")>=0;let R=0;for(let Z=0;Z<r.length();Z++){const H=r.getSection(Z),J=r.getCharCode(Z);if(bc[J]||(R+=ff(J,H,h,g,e,b)),Z<r.length()-1){const ge=!((O=J)<11904||!(Ct["Bopomofo Extended"](O)||Ct.Bopomofo(O)||Ct["CJK Compatibility Forms"](O)||Ct["CJK Compatibility Ideographs"](O)||Ct["CJK Compatibility"](O)||Ct["CJK Radicals Supplement"](O)||Ct["CJK Strokes"](O)||Ct["CJK Symbols and Punctuation"](O)||Ct["CJK Unified Ideographs Extension A"](O)||Ct["CJK Unified Ideographs"](O)||Ct["Enclosed CJK Letters and Months"](O)||Ct["Halfwidth and Fullwidth Forms"](O)||Ct.Hiragana(O)||Ct["Ideographic Description Characters"](O)||Ct["Kangxi Radicals"](O)||Ct["Katakana Phonetic Extensions"](O)||Ct.Katakana(O)||Ct["Vertical Forms"](O)||Ct["Yi Radicals"](O)||Ct["Yi Syllables"](O)));(S_[J]||ge||H.imageName)&&S.push(mf(Z+1,R,C,S,E_(J,r.getCharCode(Z+1),ge&&D),!1))}}var O;return pf(mf(r.length(),R,C,S,0,!0))}function Bu(r){let e=.5,a=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:e,verticalAlign:a}}function A_(r,e,a,h,g){if(!h&&!g)return;const y=r[a],b=(r[a].x+y.metrics.advance*y.scale)*h;for(let S=e;S<=a;S++)r[S].x-=b,r[S].y+=g}function C_(r,e,a){const{horizontalAlign:h,verticalAlign:g}=Bu(a),y=e[0]-r.displaySize[0]*h,b=e[1]-r.displaySize[1]*g;return{image:r,top:b,bottom:b+r.displaySize[1],left:y,right:y+r.displaySize[0]}}function gf(r,e,a,h,g,y){const b=r.image;let S;if(b.content){const me=b.content,Pe=b.pixelRatio||1;S=[me[0]/Pe,me[1]/Pe,b.displaySize[0]-me[2]/Pe,b.displaySize[1]-me[3]/Pe]}const C=e.left*y,D=e.right*y;let R,O,Z,H;a==="width"||a==="both"?(H=g[0]+C-h[3],O=g[0]+D+h[1]):(H=g[0]+(C+D-b.displaySize[0])/2,O=H+b.displaySize[0]);const J=e.top*y,ge=e.bottom*y;return a==="height"||a==="both"?(R=g[1]+J-h[0],Z=g[1]+ge+h[2]):(R=g[1]+(J+ge-b.displaySize[1])/2,Z=R+b.displaySize[1]),{image:b,top:R,right:O,bottom:Z,left:H,collisionPadding:S}}const _s=128;function _f(r,e){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Yi(r+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=a;let y=0;for(;y<h.length&&h[y]<=r;)y++;y=Math.max(0,y-1);let b=y;for(;b<h.length&&h[b]<r+1;)b++;b=Math.min(h.length-1,b);const S=h[y],C=h[b];return a.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:S,maxZoom:C,minSize:a.evaluate(new Yi(S)),maxSize:a.evaluate(new Yi(C)),interpolationType:g}}}class Vs extends ce{constructor(e,a,h,g){super(e,a),this.angle=h,g!==void 0&&(this.segment=g)}clone(){return new Vs(this.x,this.y,this.angle,this.segment)}}function yf(r,e,a,h,g){if(e.segment===void 0)return!0;let y=e,b=e.segment+1,S=0;for(;S>-a/2;){if(b--,b<0)return!1;S-=r[b].dist(y),y=r[b]}S+=r[b].dist(r[b+1]),b++;const C=[];let D=0;for(;S<a/2;){const R=r[b],O=r[b+1];if(!O)return!1;let Z=r[b-1].angleTo(R)-R.angleTo(O);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:S,angleDelta:Z}),D+=Z;S-C[0].distance>h;)D-=C.shift().angleDelta;if(D>g)return!1;b++,S+=R.dist(O)}return!0}function vf(r){let e=0;for(let a=0;a<r.length-1;a++)e+=r[a].dist(r[a+1]);return e}function bf(r,e,a){return r?.6*e*a:0}function xf(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function M_(r,e,a,h,g,y){const b=bf(a,g,y),S=xf(a,h)*y;let C=0;const D=vf(r)/2;for(let R=0;R<r.length-1;R++){const O=r[R],Z=r[R+1],H=O.dist(Z);if(C+H>D){const J=(D-C)/H,ge=Hi(O.x,Z.x,J),me=Hi(O.y,Z.y,J),Pe=new Vs(ge,me,Z.angleTo(O),R);return Pe._round(),!b||yf(r,Pe,S,b,e)?Pe:void 0}C+=H}}function z_(r,e,a,h,g,y,b,S,C){const D=bf(h,y,b),R=xf(h,g),O=R*b,Z=r[0].x===0||r[0].x===C||r[0].y===0||r[0].y===C;return e-O<e/4&&(e=O+e/4),wf(r,Z?e/2*S%e:(R/2+2*y)*b*S%e,e,D,a,O,Z,!1,C)}function wf(r,e,a,h,g,y,b,S,C){const D=y/2,R=vf(r);let O=0,Z=e-a,H=[];for(let J=0;J<r.length-1;J++){const ge=r[J],me=r[J+1],Pe=ge.dist(me),Ge=me.angleTo(ge);for(;Z+a<O+Pe;){Z+=a;const Me=(Z-O)/Pe,Ve=Hi(ge.x,me.x,Me),at=Hi(ge.y,me.y,Me);if(Ve>=0&&Ve<C&&at>=0&&at<C&&Z-D>=0&&Z+D<=R){const st=new Vs(Ve,at,Ge,J);st._round(),h&&!yf(r,st,y,h,g)||H.push(st)}}O+=Pe}return S||H.length||b||(H=wf(r,O/2,a,h,g,y,b,!0,C)),H}function If(r,e,a,h,g){const y=[];for(let b=0;b<r.length;b++){const S=r[b];let C;for(let D=0;D<S.length-1;D++){let R=S[D],O=S[D+1];R.x<e&&O.x<e||(R.x<e?R=new ce(e,R.y+(e-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x<e&&(O=new ce(e,R.y+(e-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y<a&&O.y<a||(R.y<a?R=new ce(R.x+(a-R.y)/(O.y-R.y)*(O.x-R.x),a)._round():O.y<a&&(O=new ce(R.x+(a-R.y)/(O.y-R.y)*(O.x-R.x),a)._round()),R.x>=h&&O.x>=h||(R.x>=h?R=new ce(h,R.y+(h-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x>=h&&(O=new ce(h,R.y+(h-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y>=g&&O.y>=g||(R.y>=g?R=new ce(R.x+(g-R.y)/(O.y-R.y)*(O.x-R.x),g)._round():O.y>=g&&(O=new ce(R.x+(g-R.y)/(O.y-R.y)*(O.x-R.x),g)._round()),C&&R.equals(C[C.length-1])||(C=[R],y.push(C)),C.push(O)))))}}return y}function kf(r,e,a,h){const g=[],y=r.image,b=y.pixelRatio,S=y.paddedRect.w-2,C=y.paddedRect.h-2,D=r.right-r.left,R=r.bottom-r.top,O=y.stretchX||[[0,S]],Z=y.stretchY||[[0,C]],H=(wt,zt)=>wt+zt[1]-zt[0],J=O.reduce(H,0),ge=Z.reduce(H,0),me=S-J,Pe=C-ge;let Ge=0,Me=J,Ve=0,at=ge,st=0,Lt=me,Zt=0,Mt=Pe;if(y.content&&h){const wt=y.content;Ge=xc(O,0,wt[0]),Ve=xc(Z,0,wt[1]),Me=xc(O,wt[0],wt[2]),at=xc(Z,wt[1],wt[3]),st=wt[0]-Ge,Zt=wt[1]-Ve,Lt=wt[2]-wt[0]-Me,Mt=wt[3]-wt[1]-at}const Tt=(wt,zt,St,_t)=>{const Jt=wc(wt.stretch-Ge,Me,D,r.left),Wt=Ic(wt.fixed-st,Lt,wt.stretch,J),vi=wc(zt.stretch-Ve,at,R,r.top),Xi=Ic(zt.fixed-Zt,Mt,zt.stretch,ge),Qi=wc(St.stretch-Ge,Me,D,r.left),_n=Ic(St.fixed-st,Lt,St.stretch,J),vr=wc(_t.stretch-Ve,at,R,r.top),Mn=Ic(_t.fixed-Zt,Mt,_t.stretch,ge),fn=new ce(Jt,vi),wn=new ce(Qi,vi),zn=new ce(Qi,vr),Rn=new ce(Jt,vr),$n=new ce(Wt/b,Xi/b),dn=new ce(_n/b,Mn/b),Dn=e*Math.PI/180;if(Dn){const er=Math.sin(Dn),tr=Math.cos(Dn),tn=[tr,-er,er,tr];fn._matMult(tn),wn._matMult(tn),Rn._matMult(tn),zn._matMult(tn)}const Fn=wt.stretch+wt.fixed,Xn=zt.stretch+zt.fixed;return{tl:fn,tr:wn,bl:Rn,br:zn,tex:{x:y.paddedRect.x+1+Fn,y:y.paddedRect.y+1+Xn,w:St.stretch+St.fixed-Fn,h:_t.stretch+_t.fixed-Xn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$n,pixelOffsetBR:dn,minFontScaleX:Lt/b/D,minFontScaleY:Mt/b/R,isSDF:a}};if(h&&(y.stretchX||y.stretchY)){const wt=Tf(O,me,J),zt=Tf(Z,Pe,ge);for(let St=0;St<wt.length-1;St++){const _t=wt[St],Jt=wt[St+1];for(let Wt=0;Wt<zt.length-1;Wt++)g.push(Tt(_t,zt[Wt],Jt,zt[Wt+1]))}}else g.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:C+1}));return g}function xc(r,e,a){let h=0;for(const g of r)h+=Math.max(e,Math.min(a,g[1]))-Math.max(e,Math.min(a,g[0]));return h}function Tf(r,e,a){const h=[{fixed:-1,stretch:0}];for(const[g,y]of r){const b=h[h.length-1];h.push({fixed:g-b.stretch,stretch:b.stretch}),h.push({fixed:g-b.stretch,stretch:b.stretch+(y-g)})}return h.push({fixed:e+1,stretch:a}),h}function wc(r,e,a,h){return r/e*a+h}function Ic(r,e,a,h){return r-e*a/h}Vt("Anchor",Vs);class kc{constructor(e,a,h,g,y,b,S,C,D,R){if(this.boxStartIndex=e.length,D){let O=b.top,Z=b.bottom;const H=b.collisionPadding;H&&(O-=H[1],Z+=H[3]);let J=Z-O;J>0&&(J=Math.max(10,J),this.circleDiameter=J)}else{let O=b.top*S-C[0],Z=b.bottom*S+C[2],H=b.left*S-C[3],J=b.right*S+C[1];const ge=b.collisionPadding;if(ge&&(H-=ge[0]*S,O-=ge[1]*S,J+=ge[2]*S,Z+=ge[3]*S),R){const me=new ce(H,O),Pe=new ce(J,O),Ge=new ce(H,Z),Me=new ce(J,Z),Ve=R*Math.PI/180;me._rotate(Ve),Pe._rotate(Ve),Ge._rotate(Ve),Me._rotate(Ve),H=Math.min(me.x,Pe.x,Ge.x,Me.x),J=Math.max(me.x,Pe.x,Ge.x,Me.x),O=Math.min(me.y,Pe.y,Ge.y,Me.y),Z=Math.max(me.y,Pe.y,Ge.y,Me.y)}e.emplaceBack(a.x,a.y,H,O,J,Z,h,g,y)}this.boxEndIndex=e.length}}class D_{constructor(e=[],a=P_){if(this.data=e,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:a,compare:h}=this,g=a[e];for(;e>0;){const y=e-1>>1,b=a[y];if(h(g,b)>=0)break;a[e]=b,e=y}a[e]=g}_down(e){const{data:a,compare:h}=this,g=this.length>>1,y=a[e];for(;e<g;){let b=1+(e<<1),S=a[b];const C=b+1;if(C<this.length&&h(a[C],S)<0&&(b=C,S=a[C]),h(S,y)>=0)break;a[e]=S,e=b}a[e]=y}}function P_(r,e){return r<e?-1:r>e?1:0}function L_(r,e=1,a=!1){let h=1/0,g=1/0,y=-1/0,b=-1/0;const S=r[0];for(let H=0;H<S.length;H++){const J=S[H];(!H||J.x<h)&&(h=J.x),(!H||J.y<g)&&(g=J.y),(!H||J.x>y)&&(y=J.x),(!H||J.y>b)&&(b=J.y)}const C=Math.min(y-h,b-g);let D=C/2;const R=new D_([],B_);if(C===0)return new ce(h,g);for(let H=h;H<y;H+=C)for(let J=g;J<b;J+=C)R.push(new Ja(H+D,J+D,D,r));let O=function(H){let J=0,ge=0,me=0;const Pe=H[0];for(let Ge=0,Me=Pe.length,Ve=Me-1;Ge<Me;Ve=Ge++){const at=Pe[Ge],st=Pe[Ve],Lt=at.x*st.y-st.x*at.y;ge+=(at.x+st.x)*Lt,me+=(at.y+st.y)*Lt,J+=3*Lt}return new Ja(ge/J,me/J,0,H)}(r),Z=R.length;for(;R.length;){const H=R.pop();(H.d>O.d||!O.d)&&(O=H,a&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,Z)),H.max-O.d<=e||(D=H.h/2,R.push(new Ja(H.p.x-D,H.p.y-D,D,r)),R.push(new Ja(H.p.x+D,H.p.y-D,D,r)),R.push(new Ja(H.p.x-D,H.p.y+D,D,r)),R.push(new Ja(H.p.x+D,H.p.y+D,D,r)),Z+=4)}return a&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${O.d}`)),O.p}function B_(r,e){return e.max-r.max}function Ja(r,e,a,h){this.p=new ce(r,e),this.h=a,this.d=function(g,y){let b=!1,S=1/0;for(let C=0;C<y.length;C++){const D=y[C];for(let R=0,O=D.length,Z=O-1;R<O;Z=R++){const H=D[R],J=D[Z];H.y>g.y!=J.y>g.y&&g.x<(J.x-H.x)*(g.y-H.y)/(J.y-H.y)+H.x&&(b=!b),S=Math.min(S,Dh(g,H,J))}}return(b?1:-1)*Math.sqrt(S)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const Ru=Number.POSITIVE_INFINITY;function Sf(r,e){return e[1]!==Ru?function(a,h,g){let y=0,b=0;switch(h=Math.abs(h),g=Math.abs(g),a){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(a){case"top-right":case"bottom-right":case"right":y=-h;break;case"top-left":case"bottom-left":case"left":y=h}return[y,b]}(r,e[0],e[1]):function(a,h){let g=0,y=0;h<0&&(h=0);const b=h/Math.sqrt(2);switch(a){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-h;break;case"top":y=h-7}switch(a){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=h;break;case"right":g=-h}return[g,y]}(r,e[0])}function Fu(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function R_(r,e,a,h,g,y,b,S,C,D,R){let O=y.textMaxSize.evaluate(e,{});O===void 0&&(O=b);const Z=r.layers[0].layout,H=Z.get("icon-offset").evaluate(e,{},R),J=Af(a.horizontal),ge=b/24,me=r.tilePixelRatio*ge,Pe=r.tilePixelRatio*O/24,Ge=r.tilePixelRatio*S,Me=r.tilePixelRatio*Z.get("symbol-spacing"),Ve=Z.get("text-padding")*r.tilePixelRatio,at=function(_t,Jt,Wt,vi=1){const Xi=_t.get("icon-padding").evaluate(Jt,{},Wt),Qi=Xi&&Xi.values;return[Qi[0]*vi,Qi[1]*vi,Qi[2]*vi,Qi[3]*vi]}(Z,e,R,r.tilePixelRatio),st=Z.get("text-max-angle")/180*Math.PI,Lt=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Zt=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",Mt=Z.get("symbol-placement"),Tt=Me/2,wt=Z.get("icon-text-fit");let zt;h&&wt!=="none"&&(r.allowVerticalPlacement&&a.vertical&&(zt=gf(h,a.vertical,wt,Z.get("icon-text-fit-padding"),H,ge)),J&&(h=gf(h,J,wt,Z.get("icon-text-fit-padding"),H,ge)));const St=(_t,Jt)=>{Jt.x<0||Jt.x>=gn||Jt.y<0||Jt.y>=gn||function(Wt,vi,Xi,Qi,_n,vr,Mn,fn,wn,zn,Rn,$n,dn,Dn,Fn,Xn,er,tr,tn,In,Ti,hr,Pn,On,Cr){const Ur=Wt.addToLineVertexArray(vi,Xi);let Gr,ys,Mr,br,ir=0,vs=0,nl=0,jf=0,Wu=-1,Hu=-1;const bs={};let Zf=xn.exports(""),Ku=0,Yu=0;if(fn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ku,Yu]=fn.layout.get("text-offset").evaluate(Ti,{},On).map(nr=>nr*En):(Ku=fn.layout.get("text-radial-offset").evaluate(Ti,{},On)*En,Yu=Ru),Wt.allowVerticalPlacement&&Qi.vertical){const nr=fn.layout.get("text-rotate").evaluate(Ti,{},On)+90;Mr=new kc(wn,vi,zn,Rn,$n,Qi.vertical,dn,Dn,Fn,nr),Mn&&(br=new kc(wn,vi,zn,Rn,$n,Mn,er,tr,Fn,nr))}if(_n){const nr=fn.layout.get("icon-rotate").evaluate(Ti,{}),ss=fn.layout.get("icon-text-fit")!=="none",rl=kf(_n,nr,Pn,ss),sl=Mn?kf(Mn,nr,Pn,ss):void 0;ys=new kc(wn,vi,zn,Rn,$n,_n,er,tr,!1,nr),ir=4*rl.length;const Hf=Wt.iconSizeData;let _a=null;Hf.kind==="source"?(_a=[_s*fn.layout.get("icon-size").evaluate(Ti,{})],_a[0]>Ns&&ne(`${Wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Hf.kind==="composite"&&(_a=[_s*hr.compositeIconSizes[0].evaluate(Ti,{},On),_s*hr.compositeIconSizes[1].evaluate(Ti,{},On)],(_a[0]>Ns||_a[1]>Ns)&&ne(`${Wt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,rl,_a,In,tn,Ti,o.WritingMode.none,vi,Ur.lineStartIndex,Ur.lineLength,-1,On),Wu=Wt.icon.placedSymbolArray.length-1,sl&&(vs=4*sl.length,Wt.addSymbols(Wt.icon,sl,_a,In,tn,Ti,o.WritingMode.vertical,vi,Ur.lineStartIndex,Ur.lineLength,-1,On),Hu=Wt.icon.placedSymbolArray.length-1)}const Xf=Object.keys(Qi.horizontal);for(const nr of Xf){const ss=Qi.horizontal[nr];if(!Gr){Zf=xn.exports(ss.text);const sl=fn.layout.get("text-rotate").evaluate(Ti,{},On);Gr=new kc(wn,vi,zn,Rn,$n,ss,dn,Dn,Fn,sl)}const rl=ss.positionedLines.length===1;if(nl+=Ef(Wt,vi,ss,vr,fn,Fn,Ti,Xn,Ur,Qi.vertical?o.WritingMode.horizontal:o.WritingMode.horizontalOnly,rl?Xf:[nr],bs,Wu,hr,On),rl)break}Qi.vertical&&(jf+=Ef(Wt,vi,Qi.vertical,vr,fn,Fn,Ti,Xn,Ur,o.WritingMode.vertical,["vertical"],bs,Hu,hr,On));const K_=Gr?Gr.boxStartIndex:Wt.collisionBoxArray.length,Y_=Gr?Gr.boxEndIndex:Wt.collisionBoxArray.length,J_=Mr?Mr.boxStartIndex:Wt.collisionBoxArray.length,Q_=Mr?Mr.boxEndIndex:Wt.collisionBoxArray.length,$_=ys?ys.boxStartIndex:Wt.collisionBoxArray.length,e1=ys?ys.boxEndIndex:Wt.collisionBoxArray.length,t1=br?br.boxStartIndex:Wt.collisionBoxArray.length,i1=br?br.boxEndIndex:Wt.collisionBoxArray.length;let qr=-1;const Cc=(nr,ss)=>nr&&nr.circleDiameter?Math.max(nr.circleDiameter,ss):ss;qr=Cc(Gr,qr),qr=Cc(Mr,qr),qr=Cc(ys,qr),qr=Cc(br,qr);const Wf=qr>-1?1:0;Wf&&(qr*=Cr/En),Wt.glyphOffsetArray.length>=Qa.MAX_GLYPHS&&ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ti.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,Ti.sortKey),Wt.symbolInstances.emplaceBack(vi.x,vi.y,bs.right>=0?bs.right:-1,bs.center>=0?bs.center:-1,bs.left>=0?bs.left:-1,bs.vertical||-1,Wu,Hu,Zf,K_,Y_,J_,Q_,$_,e1,t1,i1,zn,nl,jf,ir,vs,Wf,0,dn,Ku,Yu,qr)}(r,Jt,_t,a,h,g,zt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,me,[Ve,Ve,Ve,Ve],Lt,C,Ge,at,Zt,H,e,y,D,R,b)};if(Mt==="line")for(const _t of If(e.geometry,0,0,gn,gn)){const Jt=z_(_t,Me,st,a.vertical||J,h,24,Pe,r.overscaling,gn);for(const Wt of Jt){const vi=J;vi&&F_(r,vi.text,Tt,Wt)||St(_t,Wt)}}else if(Mt==="line-center"){for(const _t of e.geometry)if(_t.length>1){const Jt=M_(_t,st,a.vertical||J,h,24,Pe);Jt&&St(_t,Jt)}}else if(e.type==="Polygon")for(const _t of ku(e.geometry,0)){const Jt=L_(_t,16);St(_t[0],new Vs(Jt.x,Jt.y,0))}else if(e.type==="LineString")for(const _t of e.geometry)St(_t,new Vs(_t[0].x,_t[0].y,0));else if(e.type==="Point")for(const _t of e.geometry)for(const Jt of _t)St([Jt],new Vs(Jt.x,Jt.y,0))}const Ns=32640;function Ef(r,e,a,h,g,y,b,S,C,D,R,O,Z,H,J){const ge=function(Ge,Me,Ve,at,st,Lt,Zt,Mt){const Tt=at.layout.get("text-rotate").evaluate(Lt,{})*Math.PI/180,wt=[];for(const zt of Me.positionedLines)for(const St of zt.positionedGlyphs){if(!St.rect)continue;const _t=St.rect||{};let Jt=4,Wt=!0,vi=1,Xi=0;const Qi=(st||Mt)&&St.vertical,_n=St.metrics.advance*St.scale/2;if(Mt&&Me.verticalizable){const tn=(St.scale-1)*En,In=(En-St.metrics.width*St.scale)/2;Xi=zt.lineOffset/2-(St.imageName?-In:tn)}if(St.imageName){const tn=Zt[St.imageName];Wt=tn.sdf,vi=tn.pixelRatio,Jt=1/vi}const vr=st?[St.x+_n,St.y]:[0,0];let Mn=st?[0,0]:[St.x+_n+Ve[0],St.y+Ve[1]-Xi],fn=[0,0];Qi&&(fn=Mn,Mn=[0,0]);const wn=(St.metrics.left-Jt)*St.scale-_n+Mn[0],zn=(-St.metrics.top-Jt)*St.scale+Mn[1],Rn=wn+_t.w*St.scale/vi,$n=zn+_t.h*St.scale/vi,dn=new ce(wn,zn),Dn=new ce(Rn,zn),Fn=new ce(wn,$n),Xn=new ce(Rn,$n);if(Qi){const tn=new ce(-_n,_n-yc),In=-Math.PI/2,Ti=12-_n,hr=new ce(22-Ti,-(St.imageName?Ti:0)),Pn=new ce(...fn);dn._rotateAround(In,tn)._add(hr)._add(Pn),Dn._rotateAround(In,tn)._add(hr)._add(Pn),Fn._rotateAround(In,tn)._add(hr)._add(Pn),Xn._rotateAround(In,tn)._add(hr)._add(Pn)}if(Tt){const tn=Math.sin(Tt),In=Math.cos(Tt),Ti=[In,-tn,tn,In];dn._matMult(Ti),Dn._matMult(Ti),Fn._matMult(Ti),Xn._matMult(Ti)}const er=new ce(0,0),tr=new ce(0,0);wt.push({tl:dn,tr:Dn,bl:Fn,br:Xn,tex:_t,writingMode:Me.writingMode,glyphOffset:vr,sectionIndex:St.sectionIndex,isSDF:Wt,pixelOffsetTL:er,pixelOffsetBR:tr,minFontScaleX:0,minFontScaleY:0})}return wt}(0,a,S,g,y,b,h,r.allowVerticalPlacement),me=r.textSizeData;let Pe=null;me.kind==="source"?(Pe=[_s*g.layout.get("text-size").evaluate(b,{})],Pe[0]>Ns&&ne(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):me.kind==="composite"&&(Pe=[_s*H.compositeTextSizes[0].evaluate(b,{},J),_s*H.compositeTextSizes[1].evaluate(b,{},J)],(Pe[0]>Ns||Pe[1]>Ns)&&ne(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,ge,Pe,S,y,b,D,e,C.lineStartIndex,C.lineLength,Z,J);for(const Ge of R)O[Ge]=r.text.placedSymbolArray.length-1;return 4*ge.length}function Af(r){for(const e in r)return r[e];return null}function F_(r,e,a,h){const g=r.compareText;if(e in g){const y=g[e];for(let b=y.length-1;b>=0;b--)if(h.dist(y[b])<a)return!0}else g[e]=[];return g[e].push(h),!1}const O_=Fs.VectorTileFeature.types,V_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Tc(r,e,a,h,g,y,b,S,C,D,R,O,Z){const H=S?Math.min(Ns,Math.round(S[0])):0,J=S?Math.min(Ns,Math.round(S[1])):0;r.emplaceBack(e,a,Math.round(32*h),Math.round(32*g),y,b,(H<<1)+(C?1:0),J,16*D,16*R,256*O,256*Z)}function Ou(r,e,a){r.emplaceBack(e.x,e.y,a),r.emplaceBack(e.x,e.y,a),r.emplaceBack(e.x,e.y,a),r.emplaceBack(e.x,e.y,a)}function N_(r){for(const e of r.sections)if(ec(e.text))return!0;return!1}class Vu{constructor(e){this.layoutVertexArray=new Er,this.indexArray=new qn,this.programConfigurations=e,this.segments=new bi,this.dynamicLayoutVertexArray=new gr,this.opacityVertexArray=new Ar,this.placedSymbolArray=new pt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,a,h,g){this.isEmpty()||(h&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,c_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,u_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,V_,!0),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Vt("SymbolBuffers",Vu);class Nu{constructor(e,a,h){this.layoutVertexArray=new e,this.layoutAttributes=a,this.indexArray=new h,this.segments=new bi,this.collisionVertexArray=new cr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,h_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Vt("CollisionBuffers",Nu);class Qa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(b=>b.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yu([]),this.placementViewportMatrix=yu([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_f(this.zoom,a["text-size"]),this.iconSizeData=_f(this.zoom,a["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),y=h.get("symbol-z-order");this.canOverlap=Gu(h,"text-overlap","text-allow-overlap")!=="never"||Gu(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(b=>o.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=e.sourceID}createArrays(){this.text=new Vu(new fa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Vu(new fa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new kt,this.lineVertexArray=new Pt,this.symbolInstances=new Dt}calculateGlyphDependencies(e,a,h,g,y){for(let b=0;b<e.length;b++)if(a[e.charCodeAt(b)]=!0,(h||g)&&y){const S=$o[e.charAt(b)];S&&(a[S.charCodeAt(0)]=!0)}}populate(e,a,h){const g=this.layers[0],y=g.layout,b=y.get("text-font"),S=y.get("text-field"),C=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof xe&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),R=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,O=y.get("symbol-sort-key");if(this.features=[],!D&&!R)return;const Z=a.iconDependencies,H=a.glyphDependencies,J=a.availableImages,ge=new Yi(this.zoom);for(const{feature:me,id:Pe,index:Ge,sourceLayerIndex:Me}of e){const Ve=g._featureFilter.needGeometry,at=ma(me,Ve);if(!g._featureFilter.filter(ge,at,h))continue;let st,Lt;if(Ve||(at.geometry=da(me)),D){const Mt=g.getValueAndResolveTokens("text-field",at,h,J),Tt=xe.factory(Mt);N_(Tt)&&(this.hasRTLText=!0),(!this.hasRTLText||ca()==="unavailable"||this.hasRTLText&&lr.isParsed())&&(st=d_(Tt,g,at))}if(R){const Mt=g.getValueAndResolveTokens("icon-image",at,h,J);Lt=Mt instanceof Ae?Mt:Ae.fromString(Mt)}if(!st&&!Lt)continue;const Zt=this.sortFeaturesByKey?O.evaluate(at,{},h):void 0;if(this.features.push({id:Pe,text:st,icon:Lt,index:Ge,sourceLayerIndex:Me,geometry:at.geometry,properties:me.properties,type:O_[me.type],sortKey:Zt}),Lt&&(Z[Lt.name]=!0),st){const Mt=b.evaluate(at,{},h).join(","),Tt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(o.WritingMode.vertical)>=0;for(const wt of st.sections)if(wt.image)Z[wt.image.name]=!0;else{const zt=Na(st.toString()),St=wt.fontStack||Mt,_t=H[St]=H[St]||{};this.calculateGlyphDependencies(wt.text,_t,Tt,this.allowVerticalPlacement,zt)}}}y.get("symbol-placement")==="line"&&(this.features=function(me){const Pe={},Ge={},Me=[];let Ve=0;function at(Mt){Me.push(me[Mt]),Ve++}function st(Mt,Tt,wt){const zt=Ge[Mt];return delete Ge[Mt],Ge[Tt]=zt,Me[zt].geometry[0].pop(),Me[zt].geometry[0]=Me[zt].geometry[0].concat(wt[0]),zt}function Lt(Mt,Tt,wt){const zt=Pe[Tt];return delete Pe[Tt],Pe[Mt]=zt,Me[zt].geometry[0].shift(),Me[zt].geometry[0]=wt[0].concat(Me[zt].geometry[0]),zt}function Zt(Mt,Tt,wt){const zt=wt?Tt[0][Tt[0].length-1]:Tt[0][0];return`${Mt}:${zt.x}:${zt.y}`}for(let Mt=0;Mt<me.length;Mt++){const Tt=me[Mt],wt=Tt.geometry,zt=Tt.text?Tt.text.toString():null;if(!zt){at(Mt);continue}const St=Zt(zt,wt),_t=Zt(zt,wt,!0);if(St in Ge&&_t in Pe&&Ge[St]!==Pe[_t]){const Jt=Lt(St,_t,wt),Wt=st(St,_t,Me[Jt].geometry);delete Pe[St],delete Ge[_t],Ge[Zt(zt,Me[Wt].geometry,!0)]=Wt,Me[Jt].geometry=null}else St in Ge?st(St,_t,wt):_t in Pe?Lt(St,_t,wt):(at(Mt),Pe[St]=Ve-1,Ge[_t]=Ve-1)}return Me.filter(Mt=>Mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,Pe)=>me.sortKey-Pe.sortKey)}update(e,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,a,this.layers,h),this.icon.programConfigurations.updatePaintArrays(e,a,this.layers,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,a){const h=this.lineVertexArray.length;if(e.segment!==void 0){let g=e.dist(a[e.segment+1]),y=e.dist(a[e.segment]);const b={};for(let S=e.segment+1;S<a.length;S++)b[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:g},S<a.length-1&&(g+=a[S+1].dist(a[S]));for(let S=e.segment||0;S>=0;S--)b[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:y},S>0&&(y+=a[S-1].dist(a[S]));for(let S=0;S<a.length;S++){const C=b[S];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(e,a,h,g,y,b,S,C,D,R,O,Z){const H=e.indexArray,J=e.layoutVertexArray,ge=e.segments.prepareSegment(4*a.length,J,H,this.canOverlap?b.sortKey:void 0),me=this.glyphOffsetArray.length,Pe=ge.vertexLength,Ge=this.allowVerticalPlacement&&S===o.WritingMode.vertical?Math.PI/2:0,Me=b.text&&b.text.sections;for(let Ve=0;Ve<a.length;Ve++){const{tl:at,tr:st,bl:Lt,br:Zt,tex:Mt,pixelOffsetTL:Tt,pixelOffsetBR:wt,minFontScaleX:zt,minFontScaleY:St,glyphOffset:_t,isSDF:Jt,sectionIndex:Wt}=a[Ve],vi=ge.vertexLength,Xi=_t[1];Tc(J,C.x,C.y,at.x,Xi+at.y,Mt.x,Mt.y,h,Jt,Tt.x,Tt.y,zt,St),Tc(J,C.x,C.y,st.x,Xi+st.y,Mt.x+Mt.w,Mt.y,h,Jt,wt.x,Tt.y,zt,St),Tc(J,C.x,C.y,Lt.x,Xi+Lt.y,Mt.x,Mt.y+Mt.h,h,Jt,Tt.x,wt.y,zt,St),Tc(J,C.x,C.y,Zt.x,Xi+Zt.y,Mt.x+Mt.w,Mt.y+Mt.h,h,Jt,wt.x,wt.y,zt,St),Ou(e.dynamicLayoutVertexArray,C,Ge),H.emplaceBack(vi,vi+1,vi+2),H.emplaceBack(vi+1,vi+2,vi+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),Ve!==a.length-1&&Wt===a[Ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,b,b.index,{},Z,Me&&Me[Wt])}e.placedSymbolArray.emplaceBack(C.x,C.y,me,this.glyphOffsetArray.length-me,Pe,D,R,C.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],S,0,!1,0,O)}_addCollisionDebugVertex(e,a,h,g,y,b){return a.emplaceBack(0,0),e.emplaceBack(h.x,h.y,g,y,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(e,a,h,g,y,b,S){const C=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=C.vertexLength,R=y.layoutVertexArray,O=y.collisionVertexArray,Z=S.anchorX,H=S.anchorY;this._addCollisionDebugVertex(R,O,b,Z,H,new ce(e,a)),this._addCollisionDebugVertex(R,O,b,Z,H,new ce(h,a)),this._addCollisionDebugVertex(R,O,b,Z,H,new ce(h,g)),this._addCollisionDebugVertex(R,O,b,Z,H,new ce(e,g)),C.vertexLength+=4;const J=y.indexArray;J.emplaceBack(D,D+1),J.emplaceBack(D+1,D+2),J.emplaceBack(D+2,D+3),J.emplaceBack(D+3,D),C.primitiveLength+=4}addDebugCollisionBoxes(e,a,h,g){for(let y=e;y<a;y++){const b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nu(ns,nf.members,Vr),this.iconCollisionBox=new Nu(ns,nf.members,Vr);for(let e=0;e<this.symbolInstances.length;e++){const a=this.symbolInstances.get(e);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(e,a,h,g,y,b,S,C,D){const R={};for(let O=a;O<h;O++){const Z=e.get(O);R.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.textFeatureIndex=Z.featureIndex;break}for(let O=g;O<y;O++){const Z=e.get(O);R.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.verticalTextFeatureIndex=Z.featureIndex;break}for(let O=b;O<S;O++){const Z=e.get(O);R.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.iconFeatureIndex=Z.featureIndex;break}for(let O=C;O<D;O++){const Z=e.get(O);R.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},R.verticalIconFeatureIndex=Z.featureIndex;break}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,a){const h=e.placedSymbolArray.get(a),g=h.vertexStartIndex+4*h.numGlyphs;for(let y=h.vertexStartIndex;y<g;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(e),h=Math.cos(e),g=[],y=[],b=[];for(let S=0;S<this.symbolInstances.length;++S){b.push(S);const C=this.symbolInstances.get(S);g.push(0|Math.round(a*C.anchorX+h*C.anchorY)),y.push(C.featureIndex)}return b.sort((S,C)=>g[S]-g[C]||y[C]-y[S]),b}addToSortKeyRanges(e,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((g,y,b)=>{g>=0&&b.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Vt("SymbolBucket",Qa,{omit:["layers","collisionBoxArray","features","compareText"]}),Qa.MAX_GLYPHS=65535,Qa.addDynamicAttributes=Ou;const U_=new Sn({"symbol-placement":new Xt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xt(Ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xt(Ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(Ye.layout_symbol["icon-size"]),"icon-text-fit":new Xt(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(Ye.layout_symbol["icon-image"]),"icon-rotate":new $t(Ye.layout_symbol["icon-rotate"]),"icon-padding":new $t(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(Ye.layout_symbol["icon-offset"]),"icon-anchor":new $t(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new $t(Ye.layout_symbol["text-field"]),"text-font":new $t(Ye.layout_symbol["text-font"]),"text-size":new $t(Ye.layout_symbol["text-size"]),"text-max-width":new $t(Ye.layout_symbol["text-max-width"]),"text-line-height":new Xt(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new $t(Ye.layout_symbol["text-justify"]),"text-radial-offset":new $t(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new $t(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Xt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new $t(Ye.layout_symbol["text-rotate"]),"text-padding":new Xt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Xt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new $t(Ye.layout_symbol["text-transform"]),"text-offset":new $t(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Xt(Ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Xt(Ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Xt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Xt(Ye.layout_symbol["text-optional"])});var Uu={paint:new Sn({"icon-opacity":new $t(Ye.paint_symbol["icon-opacity"]),"icon-color":new $t(Ye.paint_symbol["icon-color"]),"icon-halo-color":new $t(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new $t(Ye.paint_symbol["text-opacity"]),"text-color":new $t(Ye.paint_symbol["text-color"],{runtimeType:mn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new $t(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new $t(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Xt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Xt(Ye.paint_symbol["text-translate-anchor"])}),layout:U_};class Cf{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:or,this.defaultValue=e}evaluate(e){if(e.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(e.formattedSection))return a.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt("FormatSectionOverride",Cf,{omit:["defaultValue"]});class Sc extends Sr{constructor(e){super(e,Uu)}recalculate(e,a){if(super.recalculate(e,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const y of h)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,a,h,g){const y=this.layout.get(e).evaluate(a,{},h,g),b=this._unevaluatedLayout._values[e];return b.isDataDriven()||Ys(b.value)||!y?y:function(S,C){return C.replace(/{([^{}]+)}/g,(D,R)=>R in S?String(S[R]):"")}(a.properties,y)}createBucket(e){return new Qa(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Uu.paint.overridableProperties){if(!Sc.hasPaintOverride(this.layout,e))continue;const a=this.paint.get(e),h=new Cf(a),g=new La(h,a.property.specification);let y=null;y=a.value.kind==="constant"||a.value.kind==="source"?new Qs("source",g):new Eo("composite",g,a.value.zoomStops),this.paint._values[e]=new Tr(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(e,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&Sc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,a){const h=e.get("text-field"),g=Uu.paint.properties[a];let y=!1;const b=S=>{for(const C of S)if(g.overrides&&g.overrides.hasOverride(C))return void(y=!0)};if(h.value.kind==="constant"&&h.value.value instanceof xe)b(h.value.value.sections);else if(h.value.kind==="source"){const S=D=>{y||(D instanceof jt&&je(D.value)===un?b(D.value.sections):D instanceof Da?b(D.sections):D.eachChild(S))},C=h.value;C._styleExpression&&S(C._styleExpression.expression)}return y}}function Gu(r,e,a){let h="never";const g=r.get(e);return g?h=g:r.get(a)&&(h="always"),h}var G_={paint:new Sn({"background-color":new Xt(Ye.paint_background["background-color"]),"background-pattern":new Vo(Ye.paint_background["background-pattern"]),"background-opacity":new Xt(Ye.paint_background["background-opacity"])})},q_={paint:new Sn({"raster-opacity":new Xt(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Xt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Xt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt(Ye.paint_raster["raster-fade-duration"])})};class j_ extends Sr{constructor(e){super(e,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Z_={circle:class extends Sr{constructor(r){super(r,wg)}createBucket(r){return new pu(r)}queryRadius(r){const e=r;return jo("circle-radius",this,e)+jo("circle-stroke-width",this,e)+cc(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,a,h,g,y,b,S){const C=uc(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),D=this.paint.get("circle-radius").evaluate(e,a)+this.paint.get("circle-stroke-width").evaluate(e,a),R=this.paint.get("circle-pitch-alignment")==="map",O=R?C:function(H,J){return H.map(ge=>Vh(ge,J))}(C,S),Z=R?D*b:D;for(const H of h)for(const J of H){const ge=R?J:Vh(J,S);let me=Z;const Pe=hc([],[J.x,J.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?me*=Pe[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(me*=y.cameraToCenterDistance/Pe[3]),_g(O,ge,me))return!0}return!1}},heatmap:class extends Sr{constructor(r){super(r,kg),this._updateColorRamp()}createBucket(r){return new Nh(r)}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Sr{constructor(r){super(r,Tg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Sr{constructor(r){super(r,Ug)}recalculate(r,e){super.recalculate(r,e);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Eu(r)}queryRadius(){return cc(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,a,h,g,y,b){return zh(uc(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Sr{constructor(r){super(r,t_)}createBucket(r){return new Cu(r)}queryRadius(){return cc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,e,a,h,g,y,b,S){const C=uc(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),D=this.paint.get("fill-extrusion-height").evaluate(e,a),R=this.paint.get("fill-extrusion-base").evaluate(e,a),O=function(H,J,ge,me){const Pe=[];for(const Ge of H){const Me=[Ge.x,Ge.y,0,1];hc(Me,Me,J),Pe.push(new ce(Me[0]/Me[3],Me[1]/Me[3]))}return Pe}(C,S),Z=function(H,J,ge,me){const Pe=[],Ge=[],Me=me[8]*J,Ve=me[9]*J,at=me[10]*J,st=me[11]*J,Lt=me[8]*ge,Zt=me[9]*ge,Mt=me[10]*ge,Tt=me[11]*ge;for(const wt of H){const zt=[],St=[];for(const _t of wt){const Jt=_t.x,Wt=_t.y,vi=me[0]*Jt+me[4]*Wt+me[12],Xi=me[1]*Jt+me[5]*Wt+me[13],Qi=me[2]*Jt+me[6]*Wt+me[14],_n=me[3]*Jt+me[7]*Wt+me[15],vr=Qi+at,Mn=_n+st,fn=vi+Lt,wn=Xi+Zt,zn=Qi+Mt,Rn=_n+Tt,$n=new ce((vi+Me)/Mn,(Xi+Ve)/Mn);$n.z=vr/Mn,zt.push($n);const dn=new ce(fn/Rn,wn/Rn);dn.z=zn/Rn,St.push(dn)}Pe.push(zt),Ge.push(St)}return[Pe,Ge]}(h,R,D,S);return function(H,J,ge){let me=1/0;zh(ge,J)&&(me=Jh(ge,J[0]));for(let Pe=0;Pe<J.length;Pe++){const Ge=J[Pe],Me=H[Pe];for(let Ve=0;Ve<Ge.length-1;Ve++){const at=Ge[Ve],st=[at,Ge[Ve+1],Me[Ve+1],Me[Ve],at];Mh(ge,st)&&(me=Math.min(me,Jh(ge,st)))}}return me!==1/0&&me}(Z[0],Z[1],O)}},line:class extends Sr{constructor(r){super(r,$h),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Zs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=ef.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Mu(r)}queryRadius(r){const e=r,a=tf(jo("line-width",this,e),jo("line-gap-width",this,e)),h=jo("line-offset",this,e);return a/2+Math.abs(h)+cc(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,a,h,g,y,b){const S=uc(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),C=b/2*tf(this.paint.get("line-width").evaluate(e,a),this.paint.get("line-gap-width").evaluate(e,a)),D=this.paint.get("line-offset").evaluate(e,a);return D&&(h=function(R,O){const Z=[];for(let H=0;H<R.length;H++){const J=R[H],ge=[];for(let me=0;me<J.length;me++){const Pe=J[me-1],Ge=J[me],Me=J[me+1],Ve=me===0?new ce(0,0):Ge.sub(Pe)._unit()._perp(),at=me===J.length-1?new ce(0,0):Me.sub(Ge)._unit()._perp(),st=Ve._add(at)._unit(),Lt=st.x*at.x+st.y*at.y;Lt!==0&&st._mult(1/Lt),ge.push(st._mult(O)._add(Ge))}Z.push(ge)}return Z}(h,D*b)),function(R,O,Z){for(let H=0;H<O.length;H++){const J=O[H];if(R.length>=3){for(let ge=0;ge<J.length;ge++)if(Za(R,J[ge]))return!0}if(yg(R,J,Z))return!0}return!1}(S,h,C)}isTileClipped(){return!0}},symbol:Sc,background:class extends Sr{constructor(r){super(r,G_)}},raster:class extends Sr{constructor(r){super(r,q_)}}};class X_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Mf=63710088e-1;class an{constructor(e,a){if(isNaN(e)||isNaN(a))throw new Error(`Invalid LngLat object: (${e}, ${a})`);if(this.lng=+e,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new an(B(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const a=Math.PI/180,h=this.lat*a,g=e.lat*a,y=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((e.lng-this.lng)*a);return Mf*Math.acos(Math.min(y,1))}toBounds(e=0){const a=360*e/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new ga(new an(this.lng-h,this.lat-a),new an(this.lng+h,this.lat+a))}static convert(e){if(e instanceof an)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new an(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new an(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ga{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}setSouthWest(e){return this._sw=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}extend(e){const a=this._sw,h=this._ne;let g,y;if(e instanceof an)g=e,y=e;else{if(!(e instanceof ga))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ga.convert(e)):this.extend(an.convert(e)):this;if(g=e._sw,y=e._ne,!g||!y)return this}return a||h?(a.lng=Math.min(g.lng,a.lng),a.lat=Math.min(g.lat,a.lat),h.lng=Math.max(y.lng,h.lng),h.lat=Math.max(y.lat,h.lat)):(this._sw=new an(g.lng,g.lat),this._ne=new an(y.lng,y.lat)),this}getCenter(){return new an((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new an(this.getWest(),this.getNorth())}getSouthEast(){return new an(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:h}=an.convert(e);let g=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g}static convert(e){return e instanceof ga?e:e&&new ga(e)}}const zf=2*Math.PI*Mf;function Df(r){return zf*Math.cos(r*Math.PI/180)}function Pf(r){return(180+r)/360}function Lf(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Bf(r,e){return r/Df(e)}function qu(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ec{constructor(e,a,h=0){this.x=+e,this.y=+a,this.z=+h}static fromLngLat(e,a=0){const h=an.convert(e);return new Ec(Pf(h.lng),Lf(h.lat),Bf(a,h.lat))}toLngLat(){return new an(360*this.x-180,qu(this.y))}toAltitude(){return this.z*Df(qu(this.y))}meterInMercatorCoordinateUnits(){return 1/zf*(e=qu(this.y),1/Math.cos(e*Math.PI/180));var e}}function Rf(r,e,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[r*h-2*Math.PI*6378137/2,e*h-2*Math.PI*6378137/2]}class ju{constructor(e,a,h){if(e<0||e>25||h<0||h>=Math.pow(2,e)||a<0||a>=Math.pow(2,e))throw new Error(`x=${a}, y=${h}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=a,this.y=h,this.key=tl(0,e,e,a,h)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,a,h){const g=(b=this.y,S=this.z,C=Rf(256*(y=this.x),256*(b=Math.pow(2,S)-b-1),S),D=Rf(256*(y+1),256*(b+1),S),C[0]+","+C[1]+","+D[0]+","+D[1]);var y,b,S,C,D;const R=function(O,Z,H){let J,ge="";for(let me=O;me>0;me--)J=1<<me-1,ge+=(Z&J?1:0)+(H&J?2:0);return ge}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,g)}isChildOf(e){const a=this.z-e.z;return a>0&&e.x===this.x>>a&&e.y===this.y>>a}getTilePoint(e){const a=Math.pow(2,this.z);return new ce((e.x*a-this.x)*gn,(e.y*a-this.y)*gn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ff{constructor(e,a){this.wrap=e,this.canonical=a,this.key=tl(e,a.z,a.z,a.x,a.y)}}class yr{constructor(e,a,h,g,y){if(e<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${h}`);this.overscaledZ=e,this.wrap=a,this.canonical=new ju(h,+g,+y),this.key=tl(a,e,h,g,y)}clone(){return new yr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?new yr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yr(e,this.wrap,e,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(e,a){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-e;return e>this.canonical.z?tl(this.wrap*+a,e,this.canonical.z,this.canonical.x,this.canonical.y):tl(this.wrap*+a,e,e,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const a=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>a&&e.canonical.y===this.canonical.y>>a}children(e){if(this.overscaledZ>=e)return[new yr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new yr(a,this.wrap,a,h,g),new yr(a,this.wrap,a,h+1,g),new yr(a,this.wrap,a,h,g+1),new yr(a,this.wrap,a,h+1,g+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new yr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new yr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ff(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ec(e.x-this.wrap,e.y))}}function tl(r,e,a,h,g){(r*=2)<0&&(r=-1*r-1);const y=1<<a;return(y*y*r+y*g+h).toString(36)+a.toString(36)+e.toString(36)}Vt("CanonicalTileID",ju),Vt("OverscaledTileID",yr,{omit:["posMatrix"]});class Of{constructor(e,a,h){if(this.uid=e,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void ne(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const g=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=h||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let b=0;b<g;b++){const S=this.get(y,b);S>this.max&&(this.max=S),S<this.min&&(this.min=S)}}get(e,a){const h=new Uint8Array(this.data.buffer),g=4*this._idx(e,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(h[g],h[g+1],h[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,a){if(e<-1||e>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(e+1)}_unpackMapbox(e,a,h){return(256*e*256+256*a+h)/10-1e4}_unpackTerrarium(e,a,h){return 256*e+a+h/256-32768}getPixels(){return new _r({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,a,h){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let g=a*this.dim,y=a*this.dim+this.dim,b=h*this.dim,S=h*this.dim+this.dim;switch(a){case-1:g=y-1;break;case 1:y=g+1}switch(h){case-1:b=S-1;break;case 1:S=b+1}const C=-a*this.dim,D=-h*this.dim;for(let R=b;R<S;R++)for(let O=g;O<y;O++)this.data[this._idx(O,R)]=e.data[this._idx(O+C,R+D)]}}Vt("DEMData",Of);class Vf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let a=0;a<e.length;a++){const h=e[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Nf{constructor(e,a,h,g,y){this.type="Feature",this._vectorTileFeature=e,e._z=a,e._x=h,e._y=g,this.properties=e.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(e[a]=this[a]);return e}}class Uf{constructor(e,a){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new la(gn,16,0),this.grid3D=new la(gn,16,0),this.featureIndexArray=new yi,this.promoteId=a}insert(e,a,h,g,y,b){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,y);const C=b?this.grid3D:this.grid;for(let D=0;D<a.length;D++){const R=a[D],O=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<R.length;Z++){const H=R[Z];O[0]=Math.min(O[0],H.x),O[1]=Math.min(O[1],H.y),O[2]=Math.max(O[2],H.x),O[3]=Math.max(O[3],H.y)}O[0]<gn&&O[1]<gn&&O[2]>=0&&O[3]>=0&&C.insert(S,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Fs.VectorTile(new zu(this.rawTileData)).layers,this.sourceLayerCoder=new Vf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,a,h,g){this.loadVTLayers();const y=e.params||{},b=gn/e.tileSize/e.scale,S=Fa(y.filter),C=e.queryGeometry,D=e.queryPadding*b,R=qf(C),O=this.grid.query(R.minX-D,R.minY-D,R.maxX+D,R.maxY+D),Z=qf(e.cameraQueryGeometry),H=this.grid3D.query(Z.minX-D,Z.minY-D,Z.maxX+D,Z.maxY+D,(me,Pe,Ge,Me)=>function(Ve,at,st,Lt,Zt){for(const Tt of Ve)if(at<=Tt.x&&st<=Tt.y&&Lt>=Tt.x&&Zt>=Tt.y)return!0;const Mt=[new ce(at,st),new ce(at,Zt),new ce(Lt,Zt),new ce(Lt,st)];if(Ve.length>2){for(const Tt of Mt)if(Za(Ve,Tt))return!0}for(let Tt=0;Tt<Ve.length-1;Tt++)if(bg(Ve[Tt],Ve[Tt+1],Mt))return!0;return!1}(e.cameraQueryGeometry,me-D,Pe-D,Ge+D,Me+D));for(const me of H)O.push(me);O.sort(W_);const J={};let ge;for(let me=0;me<O.length;me++){const Pe=O[me];if(Pe===ge)continue;ge=Pe;const Ge=this.featureIndexArray.get(Pe);let Me=null;this.loadMatchingFeature(J,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,S,y.layers,y.availableImages,a,h,g,(Ve,at,st)=>(Me||(Me=da(Ve)),at.queryIntersectsFeature(C,Ve,st,Me,this.z,e.transform,b,e.pixelPosMatrix)))}return J}loadMatchingFeature(e,a,h,g,y,b,S,C,D,R,O){const Z=this.bucketLayerIDs[a];if(b&&!function(me,Pe){for(let Ge=0;Ge<me.length;Ge++)if(Pe.indexOf(me[Ge])>=0)return!0;return!1}(b,Z))return;const H=this.sourceLayerCoder.decode(h),J=this.vtLayers[H].feature(g);if(y.needGeometry){const me=ma(J,!0);if(!y.filter(new Yi(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!y.filter(new Yi(this.tileID.overscaledZ),J))return;const ge=this.getId(J,H);for(let me=0;me<Z.length;me++){const Pe=Z[me];if(b&&b.indexOf(Pe)<0)continue;const Ge=C[Pe];if(!Ge)continue;let Me={};ge&&R&&(Me=R.getState(Ge.sourceLayer||"_geojsonTileLayer",ge));const Ve=K({},D[Pe]);Ve.paint=Gf(Ve.paint,Ge.paint,J,Me,S),Ve.layout=Gf(Ve.layout,Ge.layout,J,Me,S);const at=!O||O(J,Ge,Me);if(!at)continue;const st=new Nf(J,this.z,this.x,this.y,ge);st.layer=Ve;let Lt=e[Pe];Lt===void 0&&(Lt=e[Pe]=[]),Lt.push({featureIndex:g,feature:st,intersectionZ:at})}}lookupSymbolFeatures(e,a,h,g,y,b,S,C){const D={};this.loadVTLayers();const R=Fa(y);for(const O of e)this.loadMatchingFeature(D,h,g,O,R,b,S,C,a);return D}hasLayer(e){for(const a of this.bucketLayerIDs)for(const h of a)if(e===h)return!0;return!1}getId(e,a){let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof h=="boolean"&&(h=Number(h))),h}}function Gf(r,e,a,h,g){return Q(r,(y,b)=>{const S=e instanceof ha?e.get(b):null;return S&&S.evaluate?S.evaluate(a,h,g):S})}function qf(r){let e=1/0,a=1/0,h=-1/0,g=-1/0;for(const y of r)e=Math.min(e,y.x),a=Math.min(a,y.y),h=Math.max(h,y.x),g=Math.max(g,y.y);return{minX:e,minY:a,maxX:h,maxY:g}}function W_(r,e){return e-r}var Zu;Vt("FeatureIndex",Uf,{omit:["rawTileData","sourceLayerCoder"]}),o.PerformanceMarkers=void 0,(Zu=o.PerformanceMarkers||(o.PerformanceMarkers={})).create="create",Zu.load="load",Zu.fullLoad="fullLoad";let Ac=null,il=[];const Xu=1e3/30,H_={mark(r){performance.mark(r)},frame(r){const e=r;Ac!=null&&il.push(e-Ac),Ac=e},clearMetrics(){Ac=null,il=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const r in o.PerformanceMarkers)performance.clearMarks(o.PerformanceMarkers[r])},getPerformanceMetrics(){performance.measure("loadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.load),performance.measure("fullLoadTime",o.PerformanceMarkers.create,o.PerformanceMarkers.fullLoad);const r=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,a=il.length,h=1/(il.reduce((y,b)=>y+b,0)/a/1e3),g=il.filter(y=>y>Xu).reduce((y,b)=>y+(b-Xu)/Xu,0);return{loadTime:r,fullLoadTime:e,fps:h,percentDroppedFrames:g/(a+g)*100}}};o.AJAXError=et,o.ARRAY_TYPE=Zn,o.Actor=class{constructor(r,e,a){this.target=r,this.parent=e,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},X(["receive","process"],this),this.invoker=new X_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=he()?r:window}send(r,e,a,h,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[y]=a);const b=ze(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:r,hasCallback:!!a,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:us(e,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(r){const e=r.data,a=e.id;if(a&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[a];const h=this.cancelCallbacks[a];delete this.cancelCallbacks[a],h&&h()}else he()||e.mustQueue?(this.tasks[a]=e,this.taskQueue.push(a),this.invoker.trigger()):this.processTask(a,e)}process(){if(!this.taskQueue.length)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){if(e.type==="<response>"){const a=this.callbacks[r];delete this.callbacks[r],a&&(e.error?a(Qr(e.error)):a(null,Qr(e.data)))}else{let a=!1;const h=ze(this.globalScope)?void 0:[],g=e.hasCallback?(S,C)=>{a=!0,delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:S?us(S):null,data:us(C,h)},h)}:S=>{a=!0};let y=null;const b=Qr(e.data);if(this.parent[e.type])y=this.parent[e.type](e.sourceMapId,b,g);else if(this.parent.getWorkerSource){const S=e.type.split(".");y=this.parent.getWorkerSource(e.sourceMapId,S[0],b.source)[S[1]](b,g)}else g(new Error(`Could not find function ${e.type}`));!a&&y&&y.cancel&&(this.cancelCallbacks[r]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.AlphaImage=Xo,o.CanonicalTileID=ju,o.CollisionBoxArray=Je,o.CollisionCircleLayoutArray=class extends F{},o.Color=ee,o.DEMData=Of,o.DataConstantProperty=Xt,o.DictionaryCoder=Vf,o.EXTENT=gn,o.ErrorEvent=Pr,o.EvaluationParameters=Yi,o.Event=Hn,o.Evented=ar,o.FeatureIndex=Uf,o.FillBucket=Eu,o.FillExtrusionBucket=Cu,o.GeoJSONFeature=Nf,o.ImageAtlas=hf,o.ImagePosition=Pu,o.LineBucket=Mu,o.LineStripIndexArray=class extends de{},o.LngLat=an,o.LngLatBounds=ga,o.MercatorCoordinate=Ec,o.ONE_EM=En,o.OverscaledTileID=yr,o.PerformanceUtils=H_,o.PosArray=Yt,o.Properties=Sn,o.QuadTriangleArray=class extends W{},o.RGBAImage=_r,o.RasterBoundsArray=class extends p{},o.RequestPerformance=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},o.ResourceType=mi,o.SegmentVector=bi,o.SymbolBucket=Qa,o.Transitionable=nc,o.TriangleIndexArray=qn,o.Uniform1f=ms,o.Uniform1i=class extends ds{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},o.Uniform2f=class extends ds{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},o.Uniform3f=class extends ds{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},o.Uniform4f=qa,o.UniformColor=Sh,o.UniformMatrix4f=class extends ds{constructor(r,e){super(r,e),this.current=pg}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},o.UnwrappedTileID=Ff,o.ValidationError=It,o.ZoomHistory=zo,o.add=function(r,e,a){return r[0]=e[0]+a[0],r[1]=e[1]+a[1],r[2]=e[2]+a[2],r},o.addDynamicAttributes=Ou,o.asyncAll=function(r,e,a){if(!r.length)return a(null,[]);let h=r.length;const g=new Array(r.length);let y=null;r.forEach((b,S)=>{e(b,(C,D)=>{C&&(y=C),g[S]=D,--h==0&&a(y,g)})})},o.bezier=I,o.bindAll=X,o.cacheEntryPossiblyAdded=function(r){gt++,gt>ot&&(r.getActor().send("enforceCacheSizeLimit",lt),gt=0)},o.clamp=E,o.clearTileCache=function(r){const e=caches.delete(qe);r&&e.catch(r).then(()=>r())},o.clipLine=If,o.clone=function(r){var e=new Zn(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},o.clone$1=re,o.clone$2=function(r){var e=new Zn(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},o.collisionCircleLayout=f_,o.config=Ke,o.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},o.create=function(){var r=new Zn(16);return Zn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},o.create$1=Lh,o.createExpression=Js,o.createFilter=Fa,o.createLayout=hn,o.createStyleLayer=function(r){return r.type==="custom"?new j_(r):new Z_[r.type](r)},o.cross=function(r,e,a){var h=e[0],g=e[1],y=e[2],b=a[0],S=a[1],C=a[2];return r[0]=g*C-y*S,r[1]=y*b-h*C,r[2]=h*S-g*b,r},o.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},o.dot$1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},o.ease=k,o.emitValidationErrors=Va,o.enforceCacheSizeLimit=function(r){vt(),Qe&&Qe.then(e=>{e.keys().then(a=>{for(let h=0;h<a.length-r;h++)e.delete(a[h])})})},o.equals=function(r,e){var a=r[0],h=r[1],g=r[2],y=r[3],b=r[4],S=r[5],C=r[6],D=r[7],R=r[8],O=r[9],Z=r[10],H=r[11],J=r[12],ge=r[13],me=r[14],Pe=r[15],Ge=e[0],Me=e[1],Ve=e[2],at=e[3],st=e[4],Lt=e[5],Zt=e[6],Mt=e[7],Tt=e[8],wt=e[9],zt=e[10],St=e[11],_t=e[12],Jt=e[13],Wt=e[14],vi=e[15];return Math.abs(a-Ge)<=jn*Math.max(1,Math.abs(a),Math.abs(Ge))&&Math.abs(h-Me)<=jn*Math.max(1,Math.abs(h),Math.abs(Me))&&Math.abs(g-Ve)<=jn*Math.max(1,Math.abs(g),Math.abs(Ve))&&Math.abs(y-at)<=jn*Math.max(1,Math.abs(y),Math.abs(at))&&Math.abs(b-st)<=jn*Math.max(1,Math.abs(b),Math.abs(st))&&Math.abs(S-Lt)<=jn*Math.max(1,Math.abs(S),Math.abs(Lt))&&Math.abs(C-Zt)<=jn*Math.max(1,Math.abs(C),Math.abs(Zt))&&Math.abs(D-Mt)<=jn*Math.max(1,Math.abs(D),Math.abs(Mt))&&Math.abs(R-Tt)<=jn*Math.max(1,Math.abs(R),Math.abs(Tt))&&Math.abs(O-wt)<=jn*Math.max(1,Math.abs(O),Math.abs(wt))&&Math.abs(Z-zt)<=jn*Math.max(1,Math.abs(Z),Math.abs(zt))&&Math.abs(H-St)<=jn*Math.max(1,Math.abs(H),Math.abs(St))&&Math.abs(J-_t)<=jn*Math.max(1,Math.abs(J),Math.abs(_t))&&Math.abs(ge-Jt)<=jn*Math.max(1,Math.abs(ge),Math.abs(Jt))&&Math.abs(me-Wt)<=jn*Math.max(1,Math.abs(me),Math.abs(Wt))&&Math.abs(Pe-vi)<=jn*Math.max(1,Math.abs(Pe),Math.abs(vi))},o.evaluateSizeForFeature=function(r,{uSize:e,uSizeT:a},{lowerSize:h,upperSize:g}){return r.kind==="source"?h/_s:r.kind==="composite"?Hi(h/_s,g/_s,a):e},o.evaluateSizeForZoom=function(r,e){let a=0,h=0;if(r.kind==="constant")h=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=r,S=g?E(Yn.interpolationFactor(g,e,y,b),0,1):0;r.kind==="camera"?h=Hi(r.minSize,r.maxSize,S):a=S}return{uSizeT:a,uSize:h}},o.evaluateVariableOffset=Sf,o.evented=Oo,o.exported=j,o.exported$1=We,o.extend=K,o.filterObject=Y,o.fromRotation=function(r,e){var a=Math.sin(e),h=Math.cos(e);return r[0]=h,r[1]=a,r[2]=0,r[3]=-a,r[4]=h,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},o.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},o.getAnchorAlignment=Bu,o.getAnchorJustification=Fu,o.getArrayBuffer=ei,o.getImage=An,o.getJSON=function(r,e){return nn(K(r,{type:"json"}),e)},o.getOverlapMode=Gu,o.getRTLTextPluginStatus=ca,o.getReferrer=ht,o.getVideo=function(r,e){const a=window.document.createElement("video");a.muted=!0,a.onloadstart=function(){e(null,a)};for(let h=0;h<r.length;h++){const g=window.document.createElement("source");on(r[h])||(a.crossOrigin="Anonymous"),g.src=r[h],a.appendChild(g)}return{cancel:()=>{}}},o.identity=yu,o.invert=function(r,e){var a=e[0],h=e[1],g=e[2],y=e[3],b=e[4],S=e[5],C=e[6],D=e[7],R=e[8],O=e[9],Z=e[10],H=e[11],J=e[12],ge=e[13],me=e[14],Pe=e[15],Ge=a*S-h*b,Me=a*C-g*b,Ve=a*D-y*b,at=h*C-g*S,st=h*D-y*S,Lt=g*D-y*C,Zt=R*ge-O*J,Mt=R*me-Z*J,Tt=R*Pe-H*J,wt=O*me-Z*ge,zt=O*Pe-H*ge,St=Z*Pe-H*me,_t=Ge*St-Me*zt+Ve*wt+at*Tt-st*Mt+Lt*Zt;return _t?(r[0]=(S*St-C*zt+D*wt)*(_t=1/_t),r[1]=(g*zt-h*St-y*wt)*_t,r[2]=(ge*Lt-me*st+Pe*at)*_t,r[3]=(Z*st-O*Lt-H*at)*_t,r[4]=(C*Tt-b*St-D*Mt)*_t,r[5]=(a*St-g*Tt+y*Mt)*_t,r[6]=(me*Ve-J*Lt-Pe*Me)*_t,r[7]=(R*Lt-Z*Ve+H*Me)*_t,r[8]=(b*zt-S*Tt+D*Zt)*_t,r[9]=(h*Tt-a*zt-y*Zt)*_t,r[10]=(J*st-ge*Ve+Pe*Ge)*_t,r[11]=(O*Ve-R*st-H*Ge)*_t,r[12]=(S*Mt-b*wt-C*Zt)*_t,r[13]=(a*wt-h*Mt+g*Zt)*_t,r[14]=(ge*Me-J*at-me*Ge)*_t,r[15]=(R*at-O*Me+Z*Ge)*_t,r):null},o.isImageBitmap=De,o.isSafari=ze,o.isWorker=he,o.keysDifference=function(r,e){const a=[];for(const h in r)h in e||a.push(h);return a},o.lazyLoadRTLTextPlugin=function(){lr.isLoading()||lr.isLoaded()||ca()!=="deferred"||ic()},o.makeRequest=nn,o.mapObject=Q,o.mercatorXfromLng=Pf,o.mercatorYfromLat=Lf,o.mercatorZfromAltitude=Bf,o.mul=Ig,o.mul$1=function(r,e,a){return r[0]=e[0]*a[0],r[1]=e[1]*a[1],r[2]=e[2]*a[2],r[3]=e[3]*a[3],r},o.multiply=Bh,o.nextPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},o.normalize=function(r,e){var a=e[0],h=e[1],g=e[2],y=a*a+h*h+g*g;return y>0&&(y=1/Math.sqrt(y)),r[0]=e[0]*y,r[1]=e[1]*y,r[2]=e[2]*y,r},o.number=Hi,o.ortho=function(r,e,a,h,g,y,b){var S=1/(e-a),C=1/(h-g),D=1/(y-b);return r[0]=-2*S,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*C,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*D,r[11]=0,r[12]=(e+a)*S,r[13]=(g+h)*C,r[14]=(b+y)*D,r[15]=1,r},o.parseCacheControl=fe,o.parseGlyphPbf=function(r){return new zu(r).readFields(I_,[])},o.pbf=zu,o.performSymbolLayout=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=gn/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0].layout,a=r.bucket.layers[0]._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new Yi(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Yi(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Yi(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:D}=r.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Yi(C),r.canonical),a["text-size"].possiblyEvaluate(new Yi(D),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:D}=r.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Yi(C),r.canonical),a["icon-size"].possiblyEvaluate(new Yi(D),r.canonical)]}const g=e.get("text-line-height")*En,y=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",b=e.get("text-keep-upright"),S=e.get("text-size");for(const C of r.bucket.features){const D=e.get("text-font").evaluate(C,{},r.canonical).join(","),R=S.evaluate(C,{},r.canonical),O=h.layoutTextSize.evaluate(C,{},r.canonical),Z=h.layoutIconSize.evaluate(C,{},r.canonical),H={horizontal:{},vertical:void 0},J=C.text;let ge,me=[0,0];if(J){const Me=J.toString(),Ve=e.get("text-letter-spacing").evaluate(C,{},r.canonical)*En,at=uu(Me)?Ve:0,st=e.get("text-anchor").evaluate(C,{},r.canonical),Lt=e.get("text-variable-anchor");if(!Lt){const zt=e.get("text-radial-offset").evaluate(C,{},r.canonical);me=zt?Sf(st,[zt*En,Ru]):e.get("text-offset").evaluate(C,{},r.canonical).map(St=>St*En)}let Zt=y?"center":e.get("text-justify").evaluate(C,{},r.canonical);const Mt=e.get("symbol-placement"),Tt=Mt==="point"?e.get("text-max-width").evaluate(C,{},r.canonical)*En:0,wt=()=>{r.bucket.allowVerticalPlacement&&Na(Me)&&(H.vertical=vc(J,r.glyphMap,r.glyphPositions,r.imagePositions,D,Tt,g,st,"left",at,me,o.WritingMode.vertical,!0,Mt,O,R))};if(!y&&Lt){const zt=Zt==="auto"?Lt.map(_t=>Fu(_t)):[Zt];let St=!1;for(let _t=0;_t<zt.length;_t++){const Jt=zt[_t];if(!H.horizontal[Jt])if(St)H.horizontal[Jt]=H.horizontal[0];else{const Wt=vc(J,r.glyphMap,r.glyphPositions,r.imagePositions,D,Tt,g,"center",Jt,at,me,o.WritingMode.horizontal,!1,Mt,O,R);Wt&&(H.horizontal[Jt]=Wt,St=Wt.positionedLines.length===1)}}wt()}else{Zt==="auto"&&(Zt=Fu(st));const zt=vc(J,r.glyphMap,r.glyphPositions,r.imagePositions,D,Tt,g,st,Zt,at,me,o.WritingMode.horizontal,!1,Mt,O,R);zt&&(H.horizontal[Zt]=zt),wt(),Na(Me)&&y&&b&&(H.vertical=vc(J,r.glyphMap,r.glyphPositions,r.imagePositions,D,Tt,g,st,Zt,at,me,o.WritingMode.vertical,!1,Mt,O,R))}}let Pe=!1;if(C.icon&&C.icon.name){const Me=r.imageMap[C.icon.name];Me&&(ge=C_(r.imagePositions[C.icon.name],e.get("icon-offset").evaluate(C,{},r.canonical),e.get("icon-anchor").evaluate(C,{},r.canonical)),Pe=!!Me.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Pe:r.bucket.sdfIcons!==Pe&&ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Me.pixelRatio!==r.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const Ge=Af(H.horizontal)||H.vertical;r.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||ge)&&R_(r.bucket,C,H,ge,r.imageMap,h,O,Z,me,Pe,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},o.perspective=function(r,e,a,h,g){var y,b=1/Math.tan(e/2);return r[0]=b/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,g!=null&&g!==1/0?(r[10]=(g+h)*(y=1/(h-g)),r[14]=2*g*h*y):(r[10]=-1,r[14]=-2*h),r},o.pick=function(r,e){const a={};for(let h=0;h<e.length;h++){const g=e[h];g in r&&(a[g]=r[g])}return a},o.plugin=lr,o.pointGeometry=ce,o.polygonIntersectsPolygon=Mh,o.potpack=uf,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=Vt,o.registerForPluginStateChange=function(r){return r({pluginStatus:Gn,pluginURL:$r}),Oo.on("pluginStateChange",r),r},o.renderColorRamp=Gh,o.rotateX=function(r,e,a){var h=Math.sin(a),g=Math.cos(a),y=e[4],b=e[5],S=e[6],C=e[7],D=e[8],R=e[9],O=e[10],Z=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=y*g+D*h,r[5]=b*g+R*h,r[6]=S*g+O*h,r[7]=C*g+Z*h,r[8]=D*g-y*h,r[9]=R*g-b*h,r[10]=O*g-S*h,r[11]=Z*g-C*h,r},o.rotateZ=function(r,e,a){var h=Math.sin(a),g=Math.cos(a),y=e[0],b=e[1],S=e[2],C=e[3],D=e[4],R=e[5],O=e[6],Z=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=y*g+D*h,r[1]=b*g+R*h,r[2]=S*g+O*h,r[3]=C*g+Z*h,r[4]=D*g-y*h,r[5]=R*g-b*h,r[6]=O*g-S*h,r[7]=Z*g-C*h,r},o.scale=function(r,e,a){var h=a[0],g=a[1],y=a[2];return r[0]=e[0]*h,r[1]=e[1]*h,r[2]=e[2]*h,r[3]=e[3]*h,r[4]=e[4]*g,r[5]=e[5]*g,r[6]=e[6]*g,r[7]=e[7]*g,r[8]=e[8]*y,r[9]=e[9]*y,r[10]=e[10]*y,r[11]=e[11]*y,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},o.scale$1=function(r,e,a){return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r},o.setCacheLimits=function(r,e){lt=r,ot=e},o.setRTLTextPlugin=function(r,e,a=!1){if(Gn===Lo||Gn===Bo||Gn===Ro)throw new Error("setRTLTextPlugin cannot be called multiple times.");$r=j.resolveURL(r),Gn=Lo,Fo=e,Ps(),a||ic()},o.spec=Ye,o.sphericalToCartesian=function([r,e,a]){return e+=90,e*=Math.PI/180,a*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(a),y:r*Math.sin(e)*Math.sin(a),z:r*Math.cos(a)}},o.sqrLen=function(r){var e=r[0],a=r[1];return e*e+a*a},o.sub=function(r,e,a){return r[0]=e[0]-a[0],r[1]=e[1]-a[1],r[2]=e[2]-a[2],r},o.toEvaluationFeature=ma,o.transformMat3=function(r,e,a){var h=e[0],g=e[1],y=e[2];return r[0]=h*a[0]+g*a[3]+y*a[6],r[1]=h*a[1]+g*a[4]+y*a[7],r[2]=h*a[2]+g*a[5]+y*a[8],r},o.transformMat4=hc,o.transformMat4$1=function(r,e,a){var h=e[0],g=e[1];return r[0]=a[0]*h+a[4]*g+a[12],r[1]=a[1]*h+a[5]*g+a[13],r},o.translate=function(r,e,a){var h,g,y,b,S,C,D,R,O,Z,H,J,ge=a[0],me=a[1],Pe=a[2];return e===r?(r[12]=e[0]*ge+e[4]*me+e[8]*Pe+e[12],r[13]=e[1]*ge+e[5]*me+e[9]*Pe+e[13],r[14]=e[2]*ge+e[6]*me+e[10]*Pe+e[14],r[15]=e[3]*ge+e[7]*me+e[11]*Pe+e[15]):(g=e[1],y=e[2],b=e[3],S=e[4],C=e[5],D=e[6],R=e[7],O=e[8],Z=e[9],H=e[10],J=e[11],r[0]=h=e[0],r[1]=g,r[2]=y,r[3]=b,r[4]=S,r[5]=C,r[6]=D,r[7]=R,r[8]=O,r[9]=Z,r[10]=H,r[11]=J,r[12]=h*ge+S*me+O*Pe+e[12],r[13]=g*ge+C*me+Z*Pe+e[13],r[14]=y*ge+D*me+H*Pe+e[14],r[15]=b*ge+R*me+J*Pe+e[15]),r},o.triggerPluginCompletionEvent=tc,o.unicodeBlockLookup=Ct,o.uniqueId=function(){return U++},o.validateCustomStyleLayer=function(r){const e=[],a=r.id;return a===void 0&&e.push({message:`layers.${a}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${a}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateLight=Mo,o.validateStyle=oa,o.vectorTile=Fs,o.warnOnce=ne,o.wrap=B}),d(["./shared"],function(o){function x(te){const L=typeof te;if(L==="number"||L==="boolean"||L==="string"||te==null)return JSON.stringify(te);if(Array.isArray(te)){let ee="[";for(const ye of te)ee+=`${x(ye)},`;return`${ee}]`}const N=Object.keys(te).sort();let $="{";for(let ee=0;ee<N.length;ee++)$+=`${JSON.stringify(N[ee])}:${x(te[N[ee]])},`;return`${$}}`}function w(te){let L="";for(const N of o.refProperties)L+=`/${x(te[N])}`;return L}class I{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,N){for(const ee of L){this._layerConfigs[ee.id]=ee;const ye=this._layers[ee.id]=o.createStyleLayer(ee);ye._featureFilter=o.createFilter(ye.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of N)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const $=function(ee,ye){const Se={};for(let _e=0;_e<ee.length;_e++){const Ae=ye&&ye[ee[_e].id]||w(ee[_e]);ye&&(ye[ee[_e].id]=Ae);let Xe=Se[Ae];Xe||(Xe=Se[Ae]=[]),Xe.push(ee[_e])}const xe=[];for(const _e in Se)xe.push(Se[_e]);return xe}(Object.values(this._layerConfigs),this.keyCache);for(const ee of $){const ye=ee.map(ut=>this._layers[ut.id]),Se=ye[0];if(Se.visibility==="none")continue;const xe=Se.source||"";let _e=this.familiesBySource[xe];_e||(_e=this.familiesBySource[xe]={});const Ae=Se.sourceLayer||"_geojsonTileLayer";let Xe=_e[Ae];Xe||(Xe=_e[Ae]=[]),Xe.push(ye)}}}class k{constructor(L){const N={},$=[];for(const xe in L){const _e=L[xe],Ae=N[xe]={};for(const Xe in _e){const ut=_e[+Xe];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const je={x:0,y:0,w:ut.bitmap.width+2,h:ut.bitmap.height+2};$.push(je),Ae[Xe]={rect:je,metrics:ut.metrics}}}const{w:ee,h:ye}=o.potpack($),Se=new o.AlphaImage({width:ee||1,height:ye||1});for(const xe in L){const _e=L[xe];for(const Ae in _e){const Xe=_e[+Ae];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const ut=N[xe][Ae].rect;o.AlphaImage.copy(Xe.bitmap,Se,{x:0,y:0},{x:ut.x+1,y:ut.y+1},Xe.bitmap)}}this.image=Se,this.positions=N}}o.register("GlyphAtlas",k);class E{constructor(L){this.tileID=new o.OverscaledTileID(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId}parse(L,N,$,ee,ye){this.status="parsing",this.data=L,this.collisionBoxArray=new o.CollisionBoxArray;const Se=new o.DictionaryCoder(Object.keys(L.layers).sort()),xe=new o.FeatureIndex(this.tileID,this.promoteId);xe.bucketLayerIDs=[];const _e={},Ae={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},Xe=N.familiesBySource[this.source];for(const Qt in Xe){const ti=L.layers[Qt];if(!ti)continue;ti.version===1&&o.warnOnce(`Vector tile source "${this.source}" layer "${Qt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ci=Se.encode(Qt),Vi=[];for(let yn=0;yn<ti.length;yn++){const Wi=ti.feature(yn),Cn=xe.getId(Wi,Qt);Vi.push({feature:Wi,id:Cn,index:yn,sourceLayerIndex:Ci})}for(const yn of Xe[Qt]){const Wi=yn[0];Wi.source!==this.source&&o.warnOnce(`layer.source = ${Wi.source} does not equal this.source = ${this.source}`),Wi.minzoom&&this.zoom<Math.floor(Wi.minzoom)||Wi.maxzoom&&this.zoom>=Wi.maxzoom||Wi.visibility!=="none"&&(B(yn,this.zoom,$),(_e[Wi.id]=Wi.createBucket({index:xe.bucketLayerIDs.length,layers:yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ci,sourceID:this.source})).populate(Vi,Ae,this.tileID.canonical),xe.bucketLayerIDs.push(yn.map(Cn=>Cn.id)))}}let ut,je,qt,jt;const ie=o.mapObject(Ae.glyphDependencies,Qt=>Object.keys(Qt).map(Number));Object.keys(ie).length?ee.send("getGlyphs",{uid:this.uid,stacks:ie},(Qt,ti)=>{ut||(ut=Qt,je=ti,oi.call(this))}):je={};const mt=Object.keys(Ae.iconDependencies);mt.length?ee.send("getImages",{icons:mt,source:this.source,tileID:this.tileID,type:"icons"},(Qt,ti)=>{ut||(ut=Qt,qt=ti,oi.call(this))}):qt={};const At=Object.keys(Ae.patternDependencies);function oi(){if(ut)return ye(ut);if(je&&qt&&jt){const Qt=new k(je),ti=new o.ImageAtlas(qt,jt);for(const Ci in _e){const Vi=_e[Ci];Vi instanceof o.SymbolBucket?(B(Vi.layers,this.zoom,$),o.performSymbolLayout({bucket:Vi,glyphMap:je,glyphPositions:Qt.positions,imageMap:qt,imagePositions:ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vi.hasPattern&&(Vi instanceof o.LineBucket||Vi instanceof o.FillBucket||Vi instanceof o.FillExtrusionBucket)&&(B(Vi.layers,this.zoom,$),Vi.addFeatures(Ae,this.tileID.canonical,ti.patternPositions))}this.status="done",ye(null,{buckets:Object.values(_e).filter(Ci=>!Ci.isEmpty()),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Qt.image,imageAtlas:ti,glyphMap:this.returnDependencies?je:null,iconMap:this.returnDependencies?qt:null,glyphPositions:this.returnDependencies?Qt.positions:null})}}At.length?ee.send("getImages",{icons:At,source:this.source,tileID:this.tileID,type:"patterns"},(Qt,ti)=>{ut||(ut=Qt,jt=ti,oi.call(this))}):jt={},oi.call(this)}}function B(te,L,N){const $=new o.EvaluationParameters(L);for(const ee of te)ee.recalculate($,N)}function K(te,L){const N=o.getArrayBuffer(te.request,($,ee,ye,Se)=>{$?L($):ee&&L(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(ee)),rawData:ee,cacheControl:ye,expires:Se})});return()=>{N.cancel(),L()}}class U{constructor(L,N,$,ee){this.actor=L,this.layerIndex=N,this.availableImages=$,this.loadVectorData=ee||K,this.loading={},this.loaded={}}loadTile(L,N){const $=L.uid;this.loading||(this.loading={});const ee=!!(L&&L.request&&L.request.collectResourceTiming)&&new o.RequestPerformance(L.request),ye=this.loading[$]=new E(L);ye.abort=this.loadVectorData(L,(Se,xe)=>{if(delete this.loading[$],Se||!xe)return ye.status="done",this.loaded[$]=ye,N(Se);const _e=xe.rawData,Ae={};xe.expires&&(Ae.expires=xe.expires),xe.cacheControl&&(Ae.cacheControl=xe.cacheControl);const Xe={};if(ee){const ut=ee.finish();ut&&(Xe.resourceTiming=JSON.parse(JSON.stringify(ut)))}ye.vectorTile=xe.vectorTile,ye.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,(ut,je)=>{if(ut||!je)return N(ut);N(null,o.extend({rawTileData:_e.slice(0)},je,Ae,Xe))}),this.loaded=this.loaded||{},this.loaded[$]=ye})}reloadTile(L,N){const $=this.loaded,ee=L.uid,ye=this;if($&&$[ee]){const Se=$[ee];Se.showCollisionBoxes=L.showCollisionBoxes;const xe=(_e,Ae)=>{const Xe=Se.reloadCallback;Xe&&(delete Se.reloadCallback,Se.parse(Se.vectorTile,ye.layerIndex,this.availableImages,ye.actor,Xe)),N(_e,Ae)};Se.status==="parsing"?Se.reloadCallback=xe:Se.status==="done"&&(Se.vectorTile?Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,xe):xe())}}abortTile(L,N){const $=this.loading,ee=L.uid;$&&$[ee]&&$[ee].abort&&($[ee].abort(),delete $[ee]),N()}removeTile(L,N){const $=this.loaded,ee=L.uid;$&&$[ee]&&delete $[ee],N()}}class X{constructor(){this.loaded={}}loadTile(L,N){const{uid:$,encoding:ee,rawImageData:ye}=L,Se=o.isImageBitmap(ye)?this.getImageData(ye):ye,xe=new o.DEMData($,Se,ee);this.loaded=this.loaded||{},this.loaded[$]=xe,N(null,xe)}getImageData(L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const N=this.offscreenCanvasContext.getImageData(-1,-1,L.width+2,L.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:N.width,height:N.height},N.data)}removeTile(L){const N=this.loaded,$=L.uid;N&&N[$]&&delete N[$]}}var Q=function te(L,N){var $,ee=L&&L.type;if(ee==="FeatureCollection")for($=0;$<L.features.length;$++)te(L.features[$],N);else if(ee==="GeometryCollection")for($=0;$<L.geometries.length;$++)te(L.geometries[$],N);else if(ee==="Feature")te(L.geometry,N);else if(ee==="Polygon")Y(L.coordinates,N);else if(ee==="MultiPolygon")for($=0;$<L.coordinates.length;$++)Y(L.coordinates[$],N);return L};function Y(te,L){if(te.length!==0){re(te[0],L);for(var N=1;N<te.length;N++)re(te[N],!L)}}function re(te,L){for(var N=0,$=0,ee=0,ye=te.length,Se=ye-1;ee<ye;Se=ee++){var xe=(te[ee][0]-te[Se][0])*(te[Se][1]+te[ee][1]),_e=N+xe;$+=Math.abs(N)>=Math.abs(xe)?N-_e+xe:xe-_e+N,N=_e}N+$>=0!=!!L&&te.reverse()}const V=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ne{constructor(L){this._feature=L,this.extent=o.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const N of this._feature.geometry)L.push([new o.pointGeometry(N[0],N[1])]);return L}{const L=[];for(const N of this._feature.geometry){const $=[];for(const ee of N)$.push(new o.pointGeometry(ee[0],ee[1]));L.push($)}return L}}toGeoJSON(L,N,$){return V.call(this,L,N,$)}}class oe{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=L.length,this._features=L}feature(L){return new ne(this._features[L])}}var Ne={exports:{}},he=o.pointGeometry,fe=o.vectorTile.VectorTileFeature,pe=Ee;function Ee(te,L){this.options=L||{},this.features=te,this.length=te.length}function ve(te,L){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=L||4096}Ee.prototype.feature=function(te){return new ve(this.features[te],this.options.extent)},ve.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var L=0;L<te.length;L++){for(var N=te[L],$=[],ee=0;ee<N.length;ee++)$.push(new he(N[ee][0],N[ee][1]));this.geometry.push($)}return this.geometry},ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,L=1/0,N=-1/0,$=1/0,ee=-1/0,ye=0;ye<te.length;ye++)for(var Se=te[ye],xe=0;xe<Se.length;xe++){var _e=Se[xe];L=Math.min(L,_e.x),N=Math.max(N,_e.x),$=Math.min($,_e.y),ee=Math.max(ee,_e.y)}return[L,$,N,ee]},ve.prototype.toGeoJSON=fe.prototype.toGeoJSON;var ze=o.pbf,De=pe;function j(te){var L=new ze;return function(N,$){for(var ee in N.layers)$.writeMessage(3,ce,N.layers[ee])}(te,L),L.finish()}function ce(te,L){var N;L.writeVarintField(15,te.version||1),L.writeStringField(1,te.name||""),L.writeVarintField(5,te.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<te.length;N++)$.feature=te.feature(N),L.writeMessage(2,rt,$);var ee=$.keys;for(N=0;N<ee.length;N++)L.writeStringField(3,ee[N]);var ye=$.values;for(N=0;N<ye.length;N++)L.writeMessage(4,lt,ye[N])}function rt(te,L){var N=te.feature;N.id!==void 0&&L.writeVarintField(1,N.id),L.writeMessage(2,Ke,te),L.writeVarintField(3,N.type),L.writeMessage(4,Ie,N)}function Ke(te,L){var N=te.feature,$=te.keys,ee=te.values,ye=te.keycache,Se=te.valuecache;for(var xe in N.properties){var _e=N.properties[xe],Ae=ye[xe];if(_e!==null){Ae===void 0&&($.push(xe),ye[xe]=Ae=$.length-1),L.writeVarint(Ae);var Xe=typeof _e;Xe!=="string"&&Xe!=="boolean"&&Xe!=="number"&&(_e=JSON.stringify(_e));var ut=Xe+":"+_e,je=Se[ut];je===void 0&&(ee.push(_e),Se[ut]=je=ee.length-1),L.writeVarint(je)}}}function qe(te,L){return(L<<3)+(7&te)}function Qe(te){return te<<1^te>>31}function Ie(te,L){for(var N=te.loadGeometry(),$=te.type,ee=0,ye=0,Se=N.length,xe=0;xe<Se;xe++){var _e=N[xe],Ae=1;$===1&&(Ae=_e.length),L.writeVarint(qe(1,Ae));for(var Xe=$===3?_e.length-1:_e.length,ut=0;ut<Xe;ut++){ut===1&&$!==1&&L.writeVarint(qe(2,Xe-1));var je=_e[ut].x-ee,qt=_e[ut].y-ye;L.writeVarint(Qe(je)),L.writeVarint(Qe(qt)),ee+=je,ye+=qt}$===3&&L.writeVarint(qe(7,1))}}function lt(te,L){var N=typeof te;N==="string"?L.writeStringField(1,te):N==="boolean"?L.writeBooleanField(7,te):N==="number"&&(te%1!=0?L.writeDoubleField(3,te):te<0?L.writeSVarintField(6,te):L.writeVarintField(5,te))}function ot(te,L,N,$,ee,ye){if(ee-$<=N)return;const Se=$+ee>>1;vt(te,L,Se,$,ee,ye%2),ot(te,L,N,$,Se-1,ye+1),ot(te,L,N,Se+1,ee,ye+1)}function vt(te,L,N,$,ee,ye){for(;ee>$;){if(ee-$>600){const Ae=ee-$+1,Xe=N-$+1,ut=Math.log(Ae),je=.5*Math.exp(2*ut/3),qt=.5*Math.sqrt(ut*je*(Ae-je)/Ae)*(Xe-Ae/2<0?-1:1);vt(te,L,N,Math.max($,Math.floor(N-Xe*je/Ae+qt)),Math.min(ee,Math.floor(N+(Ae-Xe)*je/Ae+qt)),ye)}const Se=L[2*N+ye];let xe=$,_e=ee;for(gt(te,L,$,N),L[2*ee+ye]>Se&&gt(te,L,$,ee);xe<_e;){for(gt(te,L,xe,_e),xe++,_e--;L[2*xe+ye]<Se;)xe++;for(;L[2*_e+ye]>Se;)_e--}L[2*$+ye]===Se?gt(te,L,$,_e):(_e++,gt(te,L,_e,ee)),_e<=N&&($=_e+1),N<=_e&&(ee=_e-1)}}function gt(te,L,N,$){We(te,N,$),We(L,2*N,2*$),We(L,2*N+1,2*$+1)}function We(te,L,N){const $=te[L];te[L]=te[N],te[N]=$}function yt(te,L,N,$){const ee=te-N,ye=L-$;return ee*ee+ye*ye}Ne.exports=j,Ne.exports.fromVectorTileJs=j,Ne.exports.fromGeojsonVt=function(te,L){L=L||{};var N={};for(var $ in te)N[$]=new De(te[$].features,L),N[$].name=$,N[$].version=L.version,N[$].extent=L.extent;return j({layers:N})},Ne.exports.GeoJSONWrapper=De;const ue=te=>te[0],ke=te=>te[1];class Fe{constructor(L,N=ue,$=ke,ee=64,ye=Float64Array){this.nodeSize=ee,this.points=L;const Se=L.length<65536?Uint16Array:Uint32Array,xe=this.ids=new Se(L.length),_e=this.coords=new ye(2*L.length);for(let Ae=0;Ae<L.length;Ae++)xe[Ae]=Ae,_e[2*Ae]=N(L[Ae]),_e[2*Ae+1]=$(L[Ae]);ot(xe,_e,ee,0,xe.length-1,0)}range(L,N,$,ee){return function(ye,Se,xe,_e,Ae,Xe,ut){const je=[0,ye.length-1,0],qt=[];let jt,ie;for(;je.length;){const mt=je.pop(),At=je.pop(),oi=je.pop();if(At-oi<=ut){for(let Ci=oi;Ci<=At;Ci++)jt=Se[2*Ci],ie=Se[2*Ci+1],jt>=xe&&jt<=Ae&&ie>=_e&&ie<=Xe&&qt.push(ye[Ci]);continue}const Qt=Math.floor((oi+At)/2);jt=Se[2*Qt],ie=Se[2*Qt+1],jt>=xe&&jt<=Ae&&ie>=_e&&ie<=Xe&&qt.push(ye[Qt]);const ti=(mt+1)%2;(mt===0?xe<=jt:_e<=ie)&&(je.push(oi),je.push(Qt-1),je.push(ti)),(mt===0?Ae>=jt:Xe>=ie)&&(je.push(Qt+1),je.push(At),je.push(ti))}return qt}(this.ids,this.coords,L,N,$,ee,this.nodeSize)}within(L,N,$){return function(ee,ye,Se,xe,_e,Ae){const Xe=[0,ee.length-1,0],ut=[],je=_e*_e;for(;Xe.length;){const qt=Xe.pop(),jt=Xe.pop(),ie=Xe.pop();if(jt-ie<=Ae){for(let ti=ie;ti<=jt;ti++)yt(ye[2*ti],ye[2*ti+1],Se,xe)<=je&&ut.push(ee[ti]);continue}const mt=Math.floor((ie+jt)/2),At=ye[2*mt],oi=ye[2*mt+1];yt(At,oi,Se,xe)<=je&&ut.push(ee[mt]);const Qt=(qt+1)%2;(qt===0?Se-_e<=At:xe-_e<=oi)&&(Xe.push(ie),Xe.push(mt-1),Xe.push(Qt)),(qt===0?Se+_e>=At:xe+_e>=oi)&&(Xe.push(mt+1),Xe.push(jt),Xe.push(Qt))}return ut}(this.ids,this.coords,L,N,$,this.nodeSize)}}const bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},mi=Math.fround||(et=new Float32Array(1),te=>(et[0]=+te,et[0]));var et;class ht{constructor(L){this.options=An(Object.create(bt),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:N,minZoom:$,maxZoom:ee,nodeSize:ye}=this.options;N&&console.time("total time");const Se=`prepare ${L.length} points`;N&&console.time(Se),this.points=L;let xe=[];for(let _e=0;_e<L.length;_e++)L[_e].geometry&&xe.push(nn(L[_e],_e));this.trees[ee+1]=new Fe(xe,Dr,sr,ye,Float32Array),N&&console.timeEnd(Se);for(let _e=ee;_e>=$;_e--){const Ae=+Date.now();xe=this._cluster(xe,_e),this.trees[_e]=new Fe(xe,Dr,sr,ye,Float32Array),N&&console.log("z%d: %d clusters in %dms",_e,xe.length,+Date.now()-Ae)}return N&&console.timeEnd("total time"),this}getClusters(L,N){let $=((L[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,L[1]));let ye=L[2]===180?180:((L[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)$=-180,ye=180;else if($>ye){const Xe=this.getClusters([$,ee,180,Se],N),ut=this.getClusters([-180,ee,ye,Se],N);return Xe.concat(ut)}const xe=this.trees[this._limitZoom(N)],_e=xe.range(tt($),ct(Se),tt(ye),ct(ee)),Ae=[];for(const Xe of _e){const ut=xe.points[Xe];Ae.push(ut.numPoints?ei(ut):this.points[ut.index])}return Ae}getChildren(L){const N=this._getOriginId(L),$=this._getOriginZoom(L),ee="No cluster with the specified id.",ye=this.trees[$];if(!ye)throw new Error(ee);const Se=ye.points[N];if(!Se)throw new Error(ee);const xe=this.options.radius/(this.options.extent*Math.pow(2,$-1)),_e=ye.within(Se.x,Se.y,xe),Ae=[];for(const Xe of _e){const ut=ye.points[Xe];ut.parentId===L&&Ae.push(ut.numPoints?ei(ut):this.points[ut.index])}if(Ae.length===0)throw new Error(ee);return Ae}getLeaves(L,N,$){const ee=[];return this._appendLeaves(ee,L,N=N||10,$=$||0,0),ee}getTile(L,N,$){const ee=this.trees[this._limitZoom(L)],ye=Math.pow(2,L),{extent:Se,radius:xe}=this.options,_e=xe/Se,Ae=($-_e)/ye,Xe=($+1+_e)/ye,ut={features:[]};return this._addTileFeatures(ee.range((N-_e)/ye,Ae,(N+1+_e)/ye,Xe),ee.points,N,$,ye,ut),N===0&&this._addTileFeatures(ee.range(1-_e/ye,Ae,1,Xe),ee.points,ye,$,ye,ut),N===ye-1&&this._addTileFeatures(ee.range(0,Ae,_e/ye,Xe),ee.points,-1,$,ye,ut),ut.features.length?ut:null}getClusterExpansionZoom(L){let N=this._getOriginZoom(L)-1;for(;N<=this.options.maxZoom;){const $=this.getChildren(L);if(N++,$.length!==1)break;L=$[0].properties.cluster_id}return N}_appendLeaves(L,N,$,ee,ye){const Se=this.getChildren(N);for(const xe of Se){const _e=xe.properties;if(_e&&_e.cluster?ye+_e.point_count<=ee?ye+=_e.point_count:ye=this._appendLeaves(L,_e.cluster_id,$,ee,ye):ye<ee?ye++:L.push(xe),L.length===$)break}return ye}_addTileFeatures(L,N,$,ee,ye,Se){for(const xe of L){const _e=N[xe],Ae=_e.numPoints;let Xe,ut,je;if(Ae)Xe=on(_e),ut=_e.x,je=_e.y;else{const ie=this.points[_e.index];Xe=ie.properties,ut=tt(ie.geometry.coordinates[0]),je=ct(ie.geometry.coordinates[1])}const qt={type:1,geometry:[[Math.round(this.options.extent*(ut*ye-$)),Math.round(this.options.extent*(je*ye-ee))]],tags:Xe};let jt;Ae?jt=_e.id:this.options.generateId?jt=_e.index:this.points[_e.index].id&&(jt=this.points[_e.index].id),jt!==void 0&&(qt.id=jt),Se.features.push(qt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,N){const $=[],{radius:ee,extent:ye,reduce:Se,minPoints:xe}=this.options,_e=ee/(ye*Math.pow(2,N));for(let Ae=0;Ae<L.length;Ae++){const Xe=L[Ae];if(Xe.zoom<=N)continue;Xe.zoom=N;const ut=this.trees[N+1],je=ut.within(Xe.x,Xe.y,_e),qt=Xe.numPoints||1;let jt=qt;for(const ie of je){const mt=ut.points[ie];mt.zoom>N&&(jt+=mt.numPoints||1)}if(jt>qt&&jt>=xe){let ie=Xe.x*qt,mt=Xe.y*qt,At=Se&&qt>1?this._map(Xe,!0):null;const oi=(Ae<<5)+(N+1)+this.points.length;for(const Qt of je){const ti=ut.points[Qt];if(ti.zoom<=N)continue;ti.zoom=N;const Ci=ti.numPoints||1;ie+=ti.x*Ci,mt+=ti.y*Ci,ti.parentId=oi,Se&&(At||(At=this._map(Xe,!0)),Se(At,this._map(ti)))}Xe.parentId=oi,$.push(li(ie/jt,mt/jt,oi,jt,At))}else if($.push(Xe),jt>1)for(const ie of je){const mt=ut.points[ie];mt.zoom<=N||(mt.zoom=N,$.push(mt))}}return $}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,N){if(L.numPoints)return N?An({},L.properties):L.properties;const $=this.points[L.index].properties,ee=this.options.map($);return N&&ee===$?An({},ee):ee}}function li(te,L,N,$,ee){return{x:mi(te),y:mi(L),zoom:1/0,id:N,parentId:-1,numPoints:$,properties:ee}}function nn(te,L){const[N,$]=te.geometry.coordinates;return{x:mi(tt(N)),y:mi(ct($)),zoom:1/0,index:L,parentId:-1}}function ei(te){return{type:"Feature",id:te.id,properties:on(te),geometry:{type:"Point",coordinates:[(L=te.x,360*(L-.5)),en(te.y)]}};var L}function on(te){const L=te.numPoints,N=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return An(An({},te.properties),{cluster:!0,cluster_id:te.id,point_count:L,point_count_abbreviated:N})}function tt(te){return te/360+.5}function ct(te){const L=Math.sin(te*Math.PI/180),N=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return N<0?0:N>1?1:N}function en(te){const L=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function An(te,L){for(const N in L)te[N]=L[N];return te}function Dr(te){return te.x}function sr(te){return te.y}function Hn(te,L,N,$){for(var ee,ye=$,Se=N-L>>1,xe=N-L,_e=te[L],Ae=te[L+1],Xe=te[N],ut=te[N+1],je=L+3;je<N;je+=3){var qt=Pr(te[je],te[je+1],_e,Ae,Xe,ut);if(qt>ye)ee=je,ye=qt;else if(qt===ye){var jt=Math.abs(je-Se);jt<xe&&(ee=je,xe=jt)}}ye>$&&(ee-L>3&&Hn(te,L,ee,$),te[ee+2]=ye,N-ee>3&&Hn(te,ee,N,$))}function Pr(te,L,N,$,ee,ye){var Se=ee-N,xe=ye-$;if(Se!==0||xe!==0){var _e=((te-N)*Se+(L-$)*xe)/(Se*Se+xe*xe);_e>1?(N=ee,$=ye):_e>0&&(N+=Se*_e,$+=xe*_e)}return(Se=te-N)*Se+(xe=L-$)*xe}function ar(te,L,N,$){var ee={id:te===void 0?null:te,type:L,geometry:N,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Se=ye.geometry,xe=ye.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Ye(ye,Se);else if(xe==="Polygon"||xe==="MultiLineString")for(var _e=0;_e<Se.length;_e++)Ye(ye,Se[_e]);else if(xe==="MultiPolygon")for(_e=0;_e<Se.length;_e++)for(var Ae=0;Ae<Se[_e].length;Ae++)Ye(ye,Se[_e][Ae])}(ee),ee}function Ye(te,L){for(var N=0;N<L.length;N+=3)te.minX=Math.min(te.minX,L[N]),te.minY=Math.min(te.minY,L[N+1]),te.maxX=Math.max(te.maxX,L[N]),te.maxY=Math.max(te.maxY,L[N+1])}function It(te,L,N,$){if(L.geometry){var ee=L.geometry.coordinates,ye=L.geometry.type,Se=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),xe=[],_e=L.id;if(N.promoteId?_e=L.properties[N.promoteId]:N.generateId&&(_e=$||0),ye==="Point")Lr(ee,xe);else if(ye==="MultiPoint")for(var Ae=0;Ae<ee.length;Ae++)Lr(ee[Ae],xe);else if(ye==="LineString")Un(ee,xe,Se,!1);else if(ye==="MultiLineString"){if(N.lineMetrics){for(Ae=0;Ae<ee.length;Ae++)Un(ee[Ae],xe=[],Se,!1),te.push(ar(_e,"LineString",xe,L.properties));return}ki(ee,xe,Se,!1)}else if(ye==="Polygon")ki(ee,xe,Se,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(Ae=0;Ae<L.geometry.geometries.length;Ae++)It(te,{id:_e,geometry:L.geometry.geometries[Ae],properties:L.properties},N,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ae=0;Ae<ee.length;Ae++){var Xe=[];ki(ee[Ae],Xe,Se,!0),xe.push(Xe)}}te.push(ar(_e,ye,xe,L.properties))}}function Lr(te,L){L.push(Ei(te[0])),L.push(cn(te[1])),L.push(0)}function Un(te,L,N,$){for(var ee,ye,Se=0,xe=0;xe<te.length;xe++){var _e=Ei(te[xe][0]),Ae=cn(te[xe][1]);L.push(_e),L.push(Ae),L.push(0),xe>0&&(Se+=$?(ee*Ae-_e*ye)/2:Math.sqrt(Math.pow(_e-ee,2)+Math.pow(Ae-ye,2))),ee=_e,ye=Ae}var Xe=L.length-3;L[2]=1,Hn(L,0,Xe,N),L[Xe+2]=1,L.size=Math.abs(Se),L.start=0,L.end=L.size}function ki(te,L,N,$){for(var ee=0;ee<te.length;ee++){var ye=[];Un(te[ee],ye,N,$),L.push(ye)}}function Ei(te){return te/360+.5}function cn(te){var L=Math.sin(te*Math.PI/180),N=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return N<0?0:N>1?1:N}function kn(te,L,N,$,ee,ye,Se,xe){if($/=L,ye>=(N/=L)&&Se<$)return te;if(Se<N||ye>=$)return null;for(var _e=[],Ae=0;Ae<te.length;Ae++){var Xe=te[Ae],ut=Xe.geometry,je=Xe.type,qt=ee===0?Xe.minX:Xe.minY,jt=ee===0?Xe.maxX:Xe.maxY;if(qt>=N&&jt<$)_e.push(Xe);else if(!(jt<N||qt>=$)){var ie=[];if(je==="Point"||je==="MultiPoint")or(ut,ie,N,$,ee);else if(je==="LineString")xt(ut,ie,N,$,ee,!1,xe.lineMetrics);else if(je==="MultiLineString")ai(ut,ie,N,$,ee,!1);else if(je==="Polygon")ai(ut,ie,N,$,ee,!0);else if(je==="MultiPolygon")for(var mt=0;mt<ut.length;mt++){var At=[];ai(ut[mt],At,N,$,ee,!0),At.length&&ie.push(At)}if(ie.length){if(xe.lineMetrics&&je==="LineString"){for(mt=0;mt<ie.length;mt++)_e.push(ar(Xe.id,je,ie[mt],Xe.tags));continue}je!=="LineString"&&je!=="MultiLineString"||(ie.length===1?(je="LineString",ie=ie[0]):je="MultiLineString"),je!=="Point"&&je!=="MultiPoint"||(je=ie.length===3?"Point":"MultiPoint"),_e.push(ar(Xe.id,je,ie,Xe.tags))}}}return _e.length?_e:null}function or(te,L,N,$,ee){for(var ye=0;ye<te.length;ye+=3){var Se=te[ye+ee];Se>=N&&Se<=$&&(L.push(te[ye]),L.push(te[ye+1]),L.push(te[ye+2]))}}function xt(te,L,N,$,ee,ye,Se){for(var xe,_e,Ae=ci(te),Xe=ee===0?Bn:ri,ut=te.start,je=0;je<te.length-3;je+=3){var qt=te[je],jt=te[je+1],ie=te[je+2],mt=te[je+3],At=te[je+4],oi=ee===0?qt:jt,Qt=ee===0?mt:At,ti=!1;Se&&(xe=Math.sqrt(Math.pow(qt-mt,2)+Math.pow(jt-At,2))),oi<N?Qt>N&&(_e=Xe(Ae,qt,jt,mt,At,N),Se&&(Ae.start=ut+xe*_e)):oi>$?Qt<$&&(_e=Xe(Ae,qt,jt,mt,At,$),Se&&(Ae.start=ut+xe*_e)):mn(Ae,qt,jt,ie),Qt<N&&oi>=N&&(_e=Xe(Ae,qt,jt,mt,At,N),ti=!0),Qt>$&&oi<=$&&(_e=Xe(Ae,qt,jt,mt,At,$),ti=!0),!ye&&ti&&(Se&&(Ae.end=ut+xe*_e),L.push(Ae),Ae=ci(te)),Se&&(ut+=xe)}var Ci=te.length-3;qt=te[Ci],jt=te[Ci+1],ie=te[Ci+2],(oi=ee===0?qt:jt)>=N&&oi<=$&&mn(Ae,qt,jt,ie),Ci=Ae.length-3,ye&&Ci>=3&&(Ae[Ci]!==Ae[0]||Ae[Ci+1]!==Ae[1])&&mn(Ae,Ae[0],Ae[1],Ae[2]),Ae.length&&L.push(Ae)}function ci(te){var L=[];return L.size=te.size,L.start=te.start,L.end=te.end,L}function ai(te,L,N,$,ee,ye){for(var Se=0;Se<te.length;Se++)xt(te[Se],L,N,$,ee,ye,!1)}function mn(te,L,N,$){te.push(L),te.push(N),te.push($)}function Bn(te,L,N,$,ee,ye){var Se=(ye-L)/($-L);return te.push(ye),te.push(N+(ee-N)*Se),te.push(1),Se}function ri(te,L,N,$,ee,ye){var Se=(ye-N)/(ee-N);return te.push(L+($-L)*Se),te.push(ye),te.push(1),Se}function dr(te,L){for(var N=[],$=0;$<te.length;$++){var ee,ye=te[$],Se=ye.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ee=un(ye.geometry,L);else if(Se==="MultiLineString"||Se==="Polygon"){ee=[];for(var xe=0;xe<ye.geometry.length;xe++)ee.push(un(ye.geometry[xe],L))}else if(Se==="MultiPolygon")for(ee=[],xe=0;xe<ye.geometry.length;xe++){for(var _e=[],Ae=0;Ae<ye.geometry[xe].length;Ae++)_e.push(un(ye.geometry[xe][Ae],L));ee.push(_e)}N.push(ar(ye.id,Se,ee,ye.tags))}return N}function un(te,L){var N=[];N.size=te.size,te.start!==void 0&&(N.start=te.start,N.end=te.end);for(var $=0;$<te.length;$+=3)N.push(te[$]+L,te[$+1],te[$+2]);return N}function Kr(te,L){if(te.transformed)return te;var N,$,ee,ye=1<<te.z,Se=te.x,xe=te.y;for(N=0;N<te.features.length;N++){var _e=te.features[N],Ae=_e.geometry,Xe=_e.type;if(_e.geometry=[],Xe===1)for($=0;$<Ae.length;$+=2)_e.geometry.push(rn(Ae[$],Ae[$+1],L,ye,Se,xe));else for($=0;$<Ae.length;$++){var ut=[];for(ee=0;ee<Ae[$].length;ee+=2)ut.push(rn(Ae[$][ee],Ae[$][ee+1],L,ye,Se,xe));_e.geometry.push(ut)}}return te.transformed=!0,te}function rn(te,L,N,$,ee,ye){return[Math.round(N*(te*$-ee)),Math.round(N*(L*$-ye))]}function Tn(te,L,N,$,ee){for(var ye=L===ee.maxZoom?0:ee.tolerance/((1<<L)*ee.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:$,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<te.length;xe++){Se.numFeatures++,Li(Se,te[xe],ye,ee);var _e=te[xe].minX,Ae=te[xe].minY,Xe=te[xe].maxX,ut=te[xe].maxY;_e<Se.minX&&(Se.minX=_e),Ae<Se.minY&&(Se.minY=Ae),Xe>Se.maxX&&(Se.maxX=Xe),ut>Se.maxY&&(Se.maxY=ut)}return Se}function Li(te,L,N,$){var ee=L.geometry,ye=L.type,Se=[];if(ye==="Point"||ye==="MultiPoint")for(var xe=0;xe<ee.length;xe+=3)Se.push(ee[xe]),Se.push(ee[xe+1]),te.numPoints++,te.numSimplified++;else if(ye==="LineString")Br(Se,ee,te,N,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(xe=0;xe<ee.length;xe++)Br(Se,ee[xe],te,N,ye==="Polygon",xe===0);else if(ye==="MultiPolygon")for(var _e=0;_e<ee.length;_e++){var Ae=ee[_e];for(xe=0;xe<Ae.length;xe++)Br(Se,Ae[xe],te,N,!0,xe===0)}if(Se.length){var Xe=L.tags||null;if(ye==="LineString"&&$.lineMetrics){for(var ut in Xe={},L.tags)Xe[ut]=L.tags[ut];Xe.mapbox_clip_start=ee.start/ee.size,Xe.mapbox_clip_end=ee.end/ee.size}var je={geometry:Se,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Xe};L.id!==null&&(je.id=L.id),te.features.push(je)}}function Br(te,L,N,$,ee,ye){var Se=$*$;if($>0&&L.size<(ee?Se:$))N.numPoints+=L.length/3;else{for(var xe=[],_e=0;_e<L.length;_e+=3)($===0||L[_e+2]>Se)&&(N.numSimplified++,xe.push(L[_e]),xe.push(L[_e+1])),N.numPoints++;ee&&function(Ae,Xe){for(var ut=0,je=0,qt=Ae.length,jt=qt-2;je<qt;jt=je,je+=2)ut+=(Ae[je]-Ae[jt])*(Ae[je+1]+Ae[jt+1]);if(ut>0===Xe)for(je=0,qt=Ae.length;je<qt/2;je+=2){var ie=Ae[je],mt=Ae[je+1];Ae[je]=Ae[qt-2-je],Ae[je+1]=Ae[qt-1-je],Ae[qt-2-je]=ie,Ae[qt-1-je]=mt}}(xe,ye),te.push(xe)}}function Kn(te,L){var N=(L=this.options=function(ee,ye){for(var Se in ye)ee[Se]=ye[Se];return ee}(Object.create(this.options),L)).debug;if(N&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(ee,ye){var Se=[];if(ee.type==="FeatureCollection")for(var xe=0;xe<ee.features.length;xe++)It(Se,ee.features[xe],ye,xe);else It(Se,ee.type==="Feature"?ee:{geometry:ee},ye);return Se}(te,L);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(ee,ye){var Se=ye.buffer/ye.extent,xe=ee,_e=kn(ee,1,-1-Se,Se,0,-1,2,ye),Ae=kn(ee,1,1-Se,2+Se,0,-1,2,ye);return(_e||Ae)&&(xe=kn(ee,1,-Se,1+Se,0,-1,2,ye)||[],_e&&(xe=dr(_e,1).concat(xe)),Ae&&(xe=xe.concat(dr(Ae,-1)))),xe}($,L),$.length&&this.splitTile($,0,0,0),N&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Rr(te,L,N){return 32*((1<<te)*N+L)+te}function kr(te,L){const N=te.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const $=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!$)return L(null,null);const ee=new oe($.features);let ye=Ne.exports(ee);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),L(null,{vectorTile:ee,rawData:ye.buffer})}Kn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Kn.prototype.splitTile=function(te,L,N,$,ee,ye,Se){for(var xe=[te,L,N,$],_e=this.options,Ae=_e.debug;xe.length;){$=xe.pop(),N=xe.pop(),L=xe.pop(),te=xe.pop();var Xe=1<<L,ut=Rr(L,N,$),je=this.tiles[ut];if(!je&&(Ae>1&&console.time("creation"),je=this.tiles[ut]=Tn(te,L,N,$,_e),this.tileCoords.push({z:L,x:N,y:$}),Ae)){Ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,N,$,je.numFeatures,je.numPoints,je.numSimplified),console.timeEnd("creation"));var qt="z"+L;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(je.source=te,ee){if(L===_e.maxZoom||L===ee)continue;var jt=1<<ee-L;if(N!==Math.floor(ye/jt)||$!==Math.floor(Se/jt))continue}else if(L===_e.indexMaxZoom||je.numPoints<=_e.indexMaxPoints)continue;if(je.source=null,te.length!==0){Ae>1&&console.time("clipping");var ie,mt,At,oi,Qt,ti,Ci=.5*_e.buffer/_e.extent,Vi=.5-Ci,yn=.5+Ci,Wi=1+Ci;ie=mt=At=oi=null,Qt=kn(te,Xe,N-Ci,N+yn,0,je.minX,je.maxX,_e),ti=kn(te,Xe,N+Vi,N+Wi,0,je.minX,je.maxX,_e),te=null,Qt&&(ie=kn(Qt,Xe,$-Ci,$+yn,1,je.minY,je.maxY,_e),mt=kn(Qt,Xe,$+Vi,$+Wi,1,je.minY,je.maxY,_e),Qt=null),ti&&(At=kn(ti,Xe,$-Ci,$+yn,1,je.minY,je.maxY,_e),oi=kn(ti,Xe,$+Vi,$+Wi,1,je.minY,je.maxY,_e),ti=null),Ae>1&&console.timeEnd("clipping"),xe.push(ie||[],L+1,2*N,2*$),xe.push(mt||[],L+1,2*N,2*$+1),xe.push(At||[],L+1,2*N+1,2*$),xe.push(oi||[],L+1,2*N+1,2*$+1)}}},Kn.prototype.getTile=function(te,L,N){var $=this.options,ee=$.extent,ye=$.debug;if(te<0||te>24)return null;var Se=1<<te,xe=Rr(te,L=(L%Se+Se)%Se,N);if(this.tiles[xe])return Kr(this.tiles[xe],ee);ye>1&&console.log("drilling down to z%d-%d-%d",te,L,N);for(var _e,Ae=te,Xe=L,ut=N;!_e&&Ae>0;)Ae--,Xe=Math.floor(Xe/2),ut=Math.floor(ut/2),_e=this.tiles[Rr(Ae,Xe,ut)];return _e&&_e.source?(ye>1&&console.log("found parent tile z%d-%d-%d",Ae,Xe,ut),ye>1&&console.time("drilling down"),this.splitTile(_e.source,Ae,Xe,ut,te,L,N),ye>1&&console.timeEnd("drilling down"),this.tiles[xe]?Kr(this.tiles[xe],ee):null):null};class Yr extends U{constructor(L,N,$,ee){super(L,N,$,kr),ee&&(this.loadGeoJSON=ee)}loadData(L,N){var $;($=this._pendingRequest)===null||$===void 0||$.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ee=!!(L&&L.request&&L.request.collectResourceTiming)&&new o.RequestPerformance(L.request);this._pendingCallback=N,this._pendingRequest=this.loadGeoJSON(L,(ye,Se)=>{if(delete this._pendingCallback,delete this._pendingRequest,ye||!Se)return N(ye);if(typeof Se!="object")return N(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{Q(Se,!0);try{if(L.filter){const _e=o.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Se={type:"FeatureCollection",features:Se.features.filter(Xe=>_e.value.evaluate({zoom:0},Xe))}}this._geoJSONIndex=L.cluster?new ht(function({superclusterOptions:_e,clusterProperties:Ae}){if(!Ae||!_e)return _e;const Xe={},ut={},je={accumulated:null,zoom:0},qt={properties:null},jt=Object.keys(Ae);for(const ie of jt){const[mt,At]=Ae[ie],oi=o.createExpression(At),Qt=o.createExpression(typeof mt=="string"?[mt,["accumulated"],["get",ie]]:mt);Xe[ie]=oi.value,ut[ie]=Qt.value}return _e.map=ie=>{qt.properties=ie;const mt={};for(const At of jt)mt[At]=Xe[At].evaluate(je,qt);return mt},_e.reduce=(ie,mt)=>{qt.properties=mt;for(const At of jt)je.accumulated=ie[At],ie[At]=ut[At].evaluate(je,qt)},_e}(L)).load(Se.features):function(_e,Ae){return new Kn(_e,Ae)}(Se,L.geojsonVtOptions)}catch(_e){return N(_e)}this.loaded={};const xe={};if(ee){const _e=ee.finish();_e&&(xe.resourceTiming={},xe.resourceTiming[L.source]=JSON.parse(JSON.stringify(_e)))}N(null,xe)}})}reloadTile(L,N){const $=this.loaded;return $&&$[L.uid]?super.reloadTile(L,N):this.loadTile(L,N)}loadGeoJSON(L,N){if(L.request)return o.getJSON(L.request,N);if(typeof L.data=="string")try{N(null,JSON.parse(L.data))}catch{N(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}else N(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(L,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()}getClusterExpansionZoom(L,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch($){N($)}}getClusterChildren(L,N){try{N(null,this._geoJSONIndex.getChildren(L.clusterId))}catch($){N($)}}getClusterLeaves(L,N){try{N(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch($){N($)}}}class mr{constructor(L){this.self=L,this.actor=new o.Actor(L,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:U,geojson:Yr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,$)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=$},this.self.registerRTLTextPlugin=N=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=N.applyArabicShaping,o.plugin.processBidirectionalText=N.processBidirectionalText,o.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}setReferrer(L,N){this.referrer=N}setImages(L,N,$){this.availableImages[L]=N;for(const ee in this.workerSources[L]){const ye=this.workerSources[L][ee];for(const Se in ye)ye[Se].availableImages=N}$()}setLayers(L,N,$){this.getLayerIndex(L).replace(N),$()}updateLayers(L,N,$){this.getLayerIndex(L).update(N.layers,N.removedIds),$()}loadTile(L,N,$){this.getWorkerSource(L,N.type,N.source).loadTile(N,$)}loadDEMTile(L,N,$){this.getDEMWorkerSource(L,N.source).loadTile(N,$)}reloadTile(L,N,$){this.getWorkerSource(L,N.type,N.source).reloadTile(N,$)}abortTile(L,N,$){this.getWorkerSource(L,N.type,N.source).abortTile(N,$)}removeTile(L,N,$){this.getWorkerSource(L,N.type,N.source).removeTile(N,$)}removeDEMTile(L,N){this.getDEMWorkerSource(L,N.source).removeTile(N)}removeSource(L,N,$){if(!this.workerSources[L]||!this.workerSources[L][N.type]||!this.workerSources[L][N.type][N.source])return;const ee=this.workerSources[L][N.type][N.source];delete this.workerSources[L][N.type][N.source],ee.removeSource!==void 0?ee.removeSource(N,$):$()}loadWorkerSource(L,N,$){try{this.self.importScripts(N.url),$()}catch(ee){$(ee.toString())}}syncRTLPluginState(L,N,$){try{o.plugin.setState(N);const ee=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const ye=o.plugin.isParsed();$(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),ye)}}catch(ee){$(ee.toString())}}getAvailableImages(L){let N=this.availableImages[L];return N||(N=[]),N}getLayerIndex(L){let N=this.layerIndexes[L];return N||(N=this.layerIndexes[L]=new I),N}getWorkerSource(L,N,$){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][N]||(this.workerSources[L][N]={}),!this.workerSources[L][N][$]){const ee={send:(ye,Se,xe)=>{this.actor.send(ye,Se,xe,L)}};this.workerSources[L][N][$]=new this.workerSourceTypes[N](ee,this.getLayerIndex(L),this.getAvailableImages(L))}return this.workerSources[L][N][$]}getDEMWorkerSource(L,N){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][N]||(this.demWorkerSources[L][N]=new X),this.demWorkerSources[L][N]}enforceCacheSizeLimit(L,N){o.enforceCacheSizeLimit(N)}}return o.isWorker()&&(self.worker=new mr(self)),mr}),d(["./shared"],function(o){var x=w;function w(p){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{_=new Worker(T),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(T),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===f.width}()?(I[l=t&&t.failIfMajorPerformanceCaveat]===void 0&&(I[l]=function(f){var _,v=function(T){var M=document.createElement("canvas"),z=Object.create(w.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=T,M.getContext("webgl",z)||M.getContext("experimental-webgl",z)}(f);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(l)),I[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(p)}var I={};function k(p,t){if(Array.isArray(p)){if(!Array.isArray(t)||p.length!==t.length)return!1;for(let l=0;l<p.length;l++)if(!k(p[l],t[l]))return!1;return!0}if(typeof p=="object"&&p!==null&&t!==null){if(typeof t!="object"||Object.keys(p).length!==Object.keys(t).length)return!1;for(const l in p)if(!k(p[l],t[l]))return!1;return!0}return p===t}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class E{static testProp(t){if(!E.docStyle)return t[0];for(let l=0;l<t.length;l++)if(t[l]in E.docStyle)return t[l];return t[0]}static create(t,l,f){const _=window.document.createElement(t);return l!==void 0&&(_.className=l),f&&f.appendChild(_),_}static createNS(t,l){return window.document.createElementNS(t,l)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(t,l){t.style[E.transformProp]=l}static addEventListener(t,l,f,_={}){t.addEventListener(l,f,"passive"in _?_:_.capture)}static removeEventListener(t,l,f,_={}){t.removeEventListener(l,f,"passive"in _?_:_.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static mousePos(t,l){const f=t.getBoundingClientRect();return new o.pointGeometry(l.clientX-f.left-t.clientLeft,l.clientY-f.top-t.clientTop)}static touchPos(t,l){const f=t.getBoundingClientRect(),_=[];for(let v=0;v<l.length;v++)_.push(new o.pointGeometry(l[v].clientX-f.left-t.clientLeft,l[v].clientY-f.top-t.clientTop));return _}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);class B{constructor(t){this._transformRequestFn=t}transformRequest(t,l){return this._transformRequestFn&&this._transformRequestFn(t,l)||{url:t}}normalizeSpriteURL(t,l,f){const _=function(v){const T=v.match(K);if(!T)throw new Error(`Unable to parse URL "${v}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(t);return _.path+=`${l}${f}`,function(v){const T=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${T}`}(_)}setTransformRequest(t){this._transformRequestFn=t}}const K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class U{constructor(t,l,f,_){this.context=t,this.format=f,this.texture=t.gl.createTexture(),this.update(l,_)}update(t,l,f){const{width:_,height:v}=t,T=!(this.size&&this.size[0]===_&&this.size[1]===v||f),{context:M}=this,{gl:z}=M;if(this.useMipmap=!!(l&&l.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!l||l.premultiply!==!1)),T)this.size=[_,v],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,t):z.texImage2D(z.TEXTURE_2D,0,this.format,_,v,0,this.format,z.UNSIGNED_BYTE,t.data);else{const{x:P,y:F}=f||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||o.isImageBitmap(t)?z.texSubImage2D(z.TEXTURE_2D,0,P,F,z.RGBA,z.UNSIGNED_BYTE,t):z.texSubImage2D(z.TEXTURE_2D,0,P,F,_,v,z.RGBA,z.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(t,l,f){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),f!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=v.LINEAR),t!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,t),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,f||t),this.filter=t),l!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function X(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class Q extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,l){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,l){if(!t)return!0;let f=0;for(const _ of t){if(_[0]<f||_[1]<_[0]||l<_[1])return!1;f=_[1]}return!0}_validateContent(t,l){return!(t&&(t.length!==4||t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,l){const f=this.images[t];if(f.data.width!==l.data.width||f.data.height!==l.data.height)throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=f.version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,l){let f=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(f=!1);this.isLoaded()||f?this._notify(t,l):this.requestors.push({ids:t,callback:l})}_notify(t,l){const f={};for(const _ of t){this.images[_]||this.fire(new o.Event("styleimagemissing",{id:_}));const v=this.images[_];v?f[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],f=this.getImage(t);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const _={w:f.data.width+2,h:f.data.height+2,x:0,y:0},v=new o.ImagePosition(_,f);this.patterns[t]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new U(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:l,h:f}=o.potpack(t),_=this.atlasImage;_.resize({width:l||1,height:f||1});for(const v in this.patterns){const{bin:T}=this.patterns[v],M=T.x+1,z=T.y+1,P=this.images[v].data,F=P.width,q=P.height;o.RGBAImage.copy(P,_,{x:0,y:0},{x:M,y:z},{width:F,height:q}),o.RGBAImage.copy(P,_,{x:0,y:q-1},{x:M,y:z-1},{width:F,height:1}),o.RGBAImage.copy(P,_,{x:0,y:0},{x:M,y:z+q},{width:F,height:1}),o.RGBAImage.copy(P,_,{x:F-1,y:0},{x:M-1,y:z},{width:1,height:q}),o.RGBAImage.copy(P,_,{x:0,y:0},{x:M+F,y:z},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.images[l];f||o.warnOnce(`Image with ID: "${l}" was not found`),X(f)&&this.updateImage(l,f)}}}const Y=1e20;function re(p,t,l,f,_,v,T,M,z){for(let P=t;P<t+f;P++)V(p,l*v+P,v,_,T,M,z);for(let P=l;P<l+_;P++)V(p,P*v+t,1,f,T,M,z)}function V(p,t,l,f,_,v,T){v[0]=0,T[0]=-Y,T[1]=Y,_[0]=p[t];for(let M=1,z=0,P=0;M<f;M++){_[M]=p[t+M*l];const F=M*M;do{const q=v[z];P=(_[M]-_[q]+F-q*q)/(M-q)/2}while(P<=T[z]&&--z>-1);z++,v[z]=M,T[z]=P,T[z+1]=Y}for(let M=0,z=0;M<f;M++){for(;T[z+1]<M;)z++;const P=v[z],F=M-P;p[t+M*l]=_[P]+F*F}}class ne{constructor(t,l){this.requestManager=t,this.localIdeographFontFamily=l,this.entries={}}setURL(t){this.url=t}getGlyphs(t,l){const f=[];for(const _ in t)for(const v of t[_])f.push({stack:_,id:v});o.asyncAll(f,({stack:_,id:v},T)=>{let M=this.entries[_];M||(M=this.entries[_]={glyphs:{},requests:{},ranges:{}});let z=M.glyphs[v];if(z!==void 0)return void T(null,{stack:_,id:v,glyph:z});if(z=this._tinySDF(M,_,v),z)return M.glyphs[v]=z,void T(null,{stack:_,id:v,glyph:z});const P=Math.floor(v/256);if(256*P>65535)return void T(new Error("glyphs > 65535 not supported"));if(M.ranges[P])return void T(null,{stack:_,id:v,glyph:z});let F=M.requests[P];F||(F=M.requests[P]=[],ne.loadGlyphRange(_,P,this.url,this.requestManager,(q,W)=>{if(W){for(const le in W)this._doesCharSupportLocalGlyph(+le)||(M.glyphs[+le]=W[+le]);M.ranges[P]=!0}for(const le of F)le(q,W);delete M.requests[P]})),F.push((q,W)=>{q?T(q):W&&T(null,{stack:_,id:v,glyph:W[v]||null})})},(_,v)=>{if(_)l(_);else if(v){const T={};for(const{stack:M,id:z,glyph:P}of v)(T[M]||(T[M]={}))[z]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};l(null,T)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(o.unicodeBlockLookup["CJK Unified Ideographs"](t)||o.unicodeBlockLookup["Hangul Syllables"](t)||o.unicodeBlockLookup.Hiragana(t)||o.unicodeBlockLookup.Katakana(t))}_tinySDF(t,l,f){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(f))return;let v=t.tinySDF;if(!v){let M="400";/bold/i.test(l)?M="900":/medium/i.test(l)?M="500":/light/i.test(l)&&(M="200"),v=t.tinySDF=new ne.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:M})}const T=v.draw(String.fromCharCode(f));return{id:f,bitmap:new o.AlphaImage({width:T.width||30,height:T.height||30},T.data),metrics:{width:T.glyphWidth||24,height:T.glyphHeight||24,left:T.glyphLeft||0,top:T.glyphTop-27||-8,advance:T.glyphAdvance||24}}}}ne.loadGlyphRange=function(p,t,l,f,_){const v=256*t,T=v+255,M=f.transformRequest(l.replace("{fontstack}",p).replace("{range}",`${v}-${T}`),o.ResourceType.Glyphs);o.getArrayBuffer(M,(z,P)=>{if(z)_(z);else if(P){const F={};for(const q of o.parseGlyphPbf(P))F[q.id]=q;_(null,F)}})},ne.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:l=8,cutoff:f=.25,fontFamily:_="sans-serif",fontWeight:v="normal",fontStyle:T="normal"}={}){this.buffer=t,this.cutoff=f,this.radius=l;const M=this.size=p+4*t,z=this._createCanvas(M),P=this.ctx=z.getContext("2d",{willReadFrequently:!0});P.font=`${T} ${v} ${p}px ${_}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:_,actualBoundingBoxRight:v}=this.ctx.measureText(p),T=Math.ceil(l),M=Math.min(this.size-this.buffer,Math.ceil(v-_)),z=Math.min(this.size-this.buffer,T+Math.ceil(f)),P=M+2*this.buffer,F=z+2*this.buffer,q=Math.max(P*F,0),W=new Uint8ClampedArray(q),le={data:W,width:P,height:F,glyphWidth:M,glyphHeight:z,glyphTop:T,glyphLeft:0,glyphAdvance:t};if(M===0||z===0)return le;const{ctx:se,buffer:ae,gridInner:Te,gridOuter:Ce}=this;se.clearRect(ae,ae,M,z),se.fillText(p,ae,ae+T);const Re=se.getImageData(ae,ae,M,z);Ce.fill(Y,0,q),Te.fill(0,0,q);for(let de=0;de<z;de++)for(let Ue=0;Ue<M;Ue++){const Oe=Re.data[4*(de*M+Ue)+3]/255;if(Oe===0)continue;const Je=(de+ae)*P+Ue+ae;if(Oe===1)Ce[Je]=0,Te[Je]=Y;else{const $e=.5-Oe;Ce[Je]=$e>0?$e*$e:0,Te[Je]=$e<0?$e*$e:0}}re(Ce,0,0,P,F,P,this.f,this.v,this.z),re(Te,ae,ae,M,z,P,this.f,this.v,this.z);for(let de=0;de<q;de++){const Ue=Math.sqrt(Ce[de])-Math.sqrt(Te[de]);W[de]=Math.round(255-255*(Ue/this.radius+this.cutoff))}return le}};const oe=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(p,t){return o.sphericalToCartesian(p.expression.evaluate(t))}interpolate(p,t,l){return{x:o.number(p.x,t.x,l),y:o.number(p.y,t.y,l),z:o.number(p.z,t.z,l)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Ne="-transition";class he extends o.Evented{constructor(t){super(),this._transitionable=new o.Transitionable(oe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(o.validateLight,t,l))for(const f in t){const _=t[f];f.endsWith(Ne)?this._transitionable.setTransition(f.slice(0,-Ne.length),_):this._transitionable.setValue(f,_)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,f){return(!f||f.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class fe{constructor(t,l){this.width=t,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,l){const f=t.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,l)),this.dashEntry[f]}getDashRanges(t,l,f){const _=[];let v=t.length%2==1?-t[t.length-1]*f:0,T=t[0]*f,M=!0;_.push({left:v,right:T,isDash:M,zeroLength:t[0]===0});let z=t[0];for(let P=1;P<t.length;P++){M=!M;const F=t[P];v=z*f,z+=F,T=z*f,_.push({left:v,right:T,isDash:M,zeroLength:F===0})}return _}addRoundDash(t,l,f){const _=l/2;for(let v=-f;v<=f;v++){const T=this.width*(this.nextRow+f+v);let M=0,z=t[M];for(let P=0;P<this.width;P++){P/z.right>1&&(z=t[++M]);const F=Math.abs(P-z.left),q=Math.abs(P-z.right),W=Math.min(F,q);let le;const se=v/f*(_+1);if(z.isDash){const ae=_-Math.abs(se);le=Math.sqrt(W*W+ae*ae)}else le=_-Math.sqrt(W*W+se*se);this.data[T+P]=Math.max(0,Math.min(255,le+128))}}}addRegularDash(t){for(let M=t.length-1;M>=0;--M){const z=t[M],P=t[M+1];z.zeroLength?t.splice(M,1):P&&P.isDash===z.isDash&&(P.left=z.left,t.splice(M,1))}const l=t[0],f=t[t.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const _=this.width*this.nextRow;let v=0,T=t[v];for(let M=0;M<this.width;M++){M/T.right>1&&(T=t[++v]);const z=Math.abs(M-T.left),P=Math.abs(M-T.right),F=Math.min(z,P);this.data[_+M]=Math.max(0,Math.min(255,(T.isDash?F:-F)+128))}}addDash(t,l){const f=l?7:0,_=2*f+1;if(this.nextRow+_>this.height)return o.warnOnce("LineAtlas out of space"),null;let v=0;for(let M=0;M<t.length;M++)v+=t[M];if(v!==0){const M=this.width/v,z=this.getDashRanges(t,this.width,M);l?this.addRoundDash(z,M,f):this.addRegularDash(z)}const T={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:v};return this.nextRow+=_,this.dirty=!0,T}bind(t){const l=t.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}class pe{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const f=this.workerPool.acquire(this.id);for(let _=0;_<f.length;_++){const v=new pe.Actor(f[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,l,f){o.asyncAll(this.actors,(_,v)=>{_.send(t,l,v)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ee(p,t,l){const f=function(_,v){if(_)return l(_);if(v){const T=o.pick(o.extend(v,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(T.vectorLayers=v.vector_layers,T.vectorLayerIds=T.vectorLayers.map(M=>M.id)),l(null,T)}};return p.url?o.getJSON(t.transformRequest(p.url,o.ResourceType.Source),f):o.exported.frame(()=>f(null,p))}pe.Actor=o.Actor;class ve{constructor(t,l,f){this.bounds=o.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),f=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*l),T=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*l);return t.x>=f&&t.x<v&&t.y>=_&&t.y<T}}class ze extends o.Evented{constructor(t,l,f,_){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(l,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new o.ErrorEvent(t)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new ve(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(t,l){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,o.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(T,M){return delete t.request,t.aborted?l(null):T&&T.status!==404?l(T):(M&&M.resourceTiming&&(t.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&t.setExpiryData(M),t.loadVectorData(M,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=l:t.request=t.actor.send("reloadTile",_,v.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",_,v.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class De extends o.Evented{constructor(t,l,f,_){super(),this.id=t,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},l),o.extend(this,o.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ee(this._options,this.map._requestManager,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):l&&(o.extend(this,l),l.bounds&&(this.tileBounds=new ve(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(_,v,T)=>{if(delete t.request,t.aborted)t.state="unloaded",l(null);else if(_)t.state="errored",l(_);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData(T);const M=this.map.painter.context,z=M.gl;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new U(M,v,z.RGBA,{useMipmap:!0}),t.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),M.extTextureFilterAnisotropic&&z.texParameterf(z.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax)),t.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l()}unloadTile(t,l){t.texture&&this.map.painter.saveTileTexture(t.texture),l()}hasTransition(){return!1}}let j;class ce extends De{constructor(t,l,f,_){super(t,l,f,_),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,l){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(v,T){v&&(t.state="errored",l(v)),T&&(t.dem=T,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",l(null))}t.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(function(v,T){if(delete t.request,t.aborted)t.state="unloaded",l(null);else if(v)t.state="errored",l(v);else if(T){this.map._refreshExpiredTiles&&t.setExpiryData(T),delete T.cacheControl,delete T.expires;const M=o.isImageBitmap(T)&&(j==null&&(j=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),j)?T:o.exported.getImageData(T,1),z={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:M,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",z,_.bind(this)))}}).bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const l=t.canonical,f=Math.pow(2,l.z),_=(l.x-1+f)%f,v=l.x===0?t.wrap-1:t.wrap,T=(l.x+1+f)%f,M=l.x+1===f?t.wrap+1:t.wrap,z={};return z[new o.OverscaledTileID(t.overscaledZ,v,l.z,_,l.y).key]={backfilled:!1},z[new o.OverscaledTileID(t.overscaledZ,M,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(z[new o.OverscaledTileID(t.overscaledZ,v,l.z,_,l.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(t.overscaledZ,t.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},z[new o.OverscaledTileID(t.overscaledZ,M,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<f&&(z[new o.OverscaledTileID(t.overscaledZ,v,l.z,_,l.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(t.overscaledZ,t.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},z[new o.OverscaledTileID(t.overscaledZ,M,l.z,T,l.y+1).key]={backfilled:!1}),z}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class rt extends o.Evented{constructor(t,l,f,_){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(_),this._data=l.data,this._options=o.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const v=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*v,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*v,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.EXTENT,radius:(l.clusterRadius||50)*v,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},l),this}getClusterChildren(t,l){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},l),this}getClusterLeaves(t,l,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:l,offset:f},_),this}_updateWorkerData(t){const l=o.extend({},this.workerOptions),f=this._data;typeof f=="string"?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(f),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(f),this._pendingLoads++,this.fire(new o.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,l,(_,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new o.Event("dataabort",{dataType:"source",sourceDataType:t}));let T=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(T=v.resourceTiming[this.id].slice(0)),_)return void this.fire(new o.ErrorEvent(_));const M={dataType:"source",sourceDataType:t};this._collectResourceTiming&&T&&T.length>0&&o.extend(M,{resourceTiming:T}),this.fire(new o.Event("data",M))})}loaded(){return this._pendingLoads===0}loadTile(t,l){const f=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const _={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(f,_,(v,T)=>(delete t.request,t.unloadVectorData(),t.aborted?l(null):v?l(v):(t.loadVectorData(T,this.map.painter,f==="reloadTile"),l(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ke=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qe extends o.Evented{constructor(t,l,f,_){super(),this.id=t,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(t,l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(f,_)=>{this._loaded=!0,f?this.fire(new o.ErrorEvent(f)):_&&(this.image=_,t&&(this.coordinates=t),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const l=t.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(_){let v=1/0,T=1/0,M=-1/0,z=-1/0;for(const W of _)v=Math.min(v,W.x),T=Math.min(T,W.y),M=Math.max(M,W.x),z=Math.max(z,W.y);const P=Math.max(M-v,z-T),F=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),q=Math.pow(2,F);return new o.CanonicalTileID(F,Math.floor((v+M)/2*q),Math.floor((T+z)/2*q))}(l),this.minzoom=this.maxzoom=this.tileID.z;const f=l.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new o.RasterBoundsArray,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,l=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ke.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new U(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(t,l){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},l(null)):(t.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Qe extends qe{constructor(t,l,f,_){super(t,l,f,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const l of t.urls)this.urls.push(this.map._requestManager.transformRequest(l,o.ResourceType.Source).url);o.getVideo(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new o.ErrorEvent(l)):f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const l=this.video.seekable;t<l.start(0)||t>l.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,l=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ke.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new U(t,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ie extends qe{constructor(t,l,f,_){super(t,l,f,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(T=>typeof T!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,Ke.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new U(l,this.canvas,f.RGBA,{premultiply:!0});for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const lt={vector:ze,raster:De,"raster-dem":ce,geojson:rt,video:Qe,image:qe,canvas:Ie};function ot(p,t){const l=o.create();return o.translate(l,l,[1,1,0]),o.scale(l,l,[.5*p.width,.5*p.height,1]),o.multiply(l,l,p.calculatePosMatrix(t.toUnwrapped()))}function vt(p,t,l,f,_,v){const T=function(q,W,le){if(q)for(const se of q){const ae=W[se];if(ae&&ae.source===le&&ae.type==="fill-extrusion")return!0}else for(const se in W){const ae=W[se];if(ae.source===le&&ae.type==="fill-extrusion")return!0}return!1}(_&&_.layers,t,p.id),M=v.maxPitchScaleFactor(),z=p.tilesIn(f,M,T);z.sort(gt);const P=[];for(const q of z)P.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(t,l,p._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,_,v,M,ot(p.transform,q.tileID))});const F=function(q){const W={},le={};for(const se of q){const ae=se.queryResults,Te=se.wrappedTileID,Ce=le[Te]=le[Te]||{};for(const Re in ae){const de=ae[Re],Ue=Ce[Re]=Ce[Re]||{},Oe=W[Re]=W[Re]||[];for(const Je of de)Ue[Je.featureIndex]||(Ue[Je.featureIndex]=!0,Oe.push(Je))}}return W}(P);for(const q in F)F[q].forEach(W=>{const le=W.feature,se=p.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=se});return F}function gt(p,t){const l=p.tileID,f=t.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}class We{constructor(t,l){this.tileID=t,this.uid=o.uniqueId(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const l=t+this.timeAdded;l<o.exported.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(l=>t.saveTileTexture(l)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(_,v){const T={};if(!v)return T;for(const M of _){const z=M.layerIds.map(P=>v.getLayer(P)).filter(Boolean);if(z.length!==0){M.layers=z,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(P=>z.filter(F=>F.id===P)[0]));for(const P of z)T[P.id]=M}}return T}(t.buckets,l.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof o.SymbolBucket){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof o.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,o.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(_).queryRadius(v))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const _=this.buckets[f];_.uploadPending()&&_.upload(t)}const l=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new U(t,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new U(t,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,l,f,_,v,T,M,z,P,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:v,scale:T,tileSize:this.tileSize,pixelPosMatrix:F,transform:z,params:M,queryPadding:this.queryPadding*P},t,l,f):{}}querySourceFeatures(t,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),v=l?l.sourceLayer:"",T=_._geojsonTileLayer||_[v];if(!T)return;const M=o.createFilter(l&&l.filter),{z,x:P,y:F}=this.tileID.canonical,q={z,x:P,y:F};for(let W=0;W<T.length;W++){const le=T.feature(W);if(M.needGeometry){const Te=o.toEvaluationFeature(le,!0);if(!M.filter(new o.EvaluationParameters(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!M.filter(new o.EvaluationParameters(this.tileID.overscaledZ),le))continue;const se=f.getId(le,v),ae=new o.GeoJSONFeature(le,z,P,F,se);ae.tile=q,t.push(ae)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const l=this.expirationTime;if(t.cacheControl){const f=o.parseCacheControl(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{const v=this.expirationTime-l;v?this.expirationTime=f+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!l.style.hasLayer(_))continue;const v=this.buckets[_],T=v.layers[0].sourceLayer||"_geojsonTileLayer",M=f[T],z=t[T];if(!M||!z||Object.keys(z).length===0)continue;v.update(z,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=l&&l.style&&l.style.getLayer(_);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.exported.now()+t}setDependencies(t,l){const f={};for(const _ of l)f[_]=!0;this.dependencies[t]=f}hasDependency(t,l){for(const f of t){const _=this.dependencies[f];if(_){for(const v of l)if(_[v])return!0}}return!1}}class yt{constructor(t,l){this.max=t,this.onRemove=l,this.reset()}reset(){for(const t in this.data)for(const l of this.data[t])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(t,l,f){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:l,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},f)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const l=this.data[t].shift();return l.timeout&&clearTimeout(l.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),l.value}getByKey(t){const l=this.data[t];return l?l[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,l){if(!this.has(t))return this;const f=t.wrapped().key,_=l===void 0?0:this.data[f].indexOf(l),v=this.data[f][_];return this.data[f].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(t){const l=[];for(const f in this.data)for(const _ of this.data[f])t(_.value)||l.push(_);for(const f of l)this.remove(f.value.tileID,f)}}class ue{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,l,f){const _=String(l);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},o.extend(this.stateChanges[t][_],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==_&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const v in this.state[t][_])f[v]||(this.deletedStates[t][_][v]=null)}else for(const v in f)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][v]===null&&delete this.deletedStates[t][_][v]}removeFeatureState(t,l,f){if(this.deletedStates[t]===null)return;const _=String(l);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&l!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][f]=null);else if(l!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(f in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][f]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,l){const f=String(l),_=o.extend({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const v=this.deletedStates[t][l];if(v===null)return{};for(const T in v)delete _[T]}return _}initializeTileState(t,l){t.setFeatureState(this.state,l)}coalesceChanges(t,l){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const T in this.stateChanges[_])this.state[_][T]||(this.state[_][T]={}),o.extend(this.state[_][T],this.stateChanges[_][T]),v[T]=this.state[_][T];f[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const T in this.state[_])v[T]={},this.state[_][T]={};else for(const T in this.deletedStates[_]){if(this.deletedStates[_][T]===null)this.state[_][T]={};else for(const M of Object.keys(this.deletedStates[_][T]))delete this.state[_][T][M];v[T]=this.state[_][T]}f[_]=f[_]||{},o.extend(f[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in t)t[_].setFeatureState(f,l)}}class ke extends o.Evented{constructor(t,l,f){super(),this.id=t,this.dispatcher=f,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,v,T,M){const z=new lt[v.type](_,v,T,M);if(z.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${z.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],z),z}(t,l,f,this),this._tiles={},this._cache=new yt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ue}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const l=this._tiles[t];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,l){return this._source.loadTile(t,l)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new o.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(t),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Fe).map(t=>t.key)}getRenderableIds(t){const l=[];for(const f in this._tiles)this._isIdRenderable(f,t)&&l.push(this._tiles[f]);return t?l.sort((f,_)=>{const v=f.tileID,T=_.tileID,M=new o.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),z=new o.pointGeometry(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-T.overscaledZ||z.y-M.y||z.x-M.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(Fe).map(f=>f.key)}hasRenderableParent(t){const l=this.findLoadedParent(t,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(t,l){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(l||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,l){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,t,l)))}_tileLoaded(t,l,f,_){if(_)return t.state="errored",void(_.status!==404?this._source.fire(new o.ErrorEvent(_,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=o.exported.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(l,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const l=this.getRenderableIds();for(let _=0;_<l.length;_++){const v=l[_];if(t.neighboringTiles&&t.neighboringTiles[v]){const T=this.getTileByID(v);f(t,T),f(T,t)}}function f(_,v){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let T=v.tileID.canonical.x-_.tileID.canonical.x;const M=v.tileID.canonical.y-_.tileID.canonical.y,z=Math.pow(2,_.tileID.canonical.z),P=v.tileID.key;T===0&&M===0||Math.abs(M)>1||(Math.abs(T)>1&&(Math.abs(T+z)===1?T+=z:Math.abs(T-z)===1&&(T-=z)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,T,M),_.neighboringTiles&&_.neighboringTiles[P]&&(_.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,l,f,_){for(const v in this._tiles){let T=this._tiles[v];if(_[v]||!T.hasData()||T.tileID.overscaledZ<=l||T.tileID.overscaledZ>f)continue;let M=T.tileID;for(;T&&T.tileID.overscaledZ>l+1;){const P=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[P.key],T&&T.hasData()&&(M=P)}let z=M;for(;z.overscaledZ>l;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){_[M.key]=M;break}}}findLoadedParent(t,l){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=t.overscaledZ-1;f>=l;f--){const _=t.scaledTo(f),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(t){const l=this._tiles[t.key];return l&&l.hasData()?l:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const l=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,_=Math.floor(l*f*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(t){const l=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,l){const f={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),f[v.tileID.key]=v}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(t,l){if(this.transform=t,this.terrain=l,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new o.OverscaledTileID(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(f=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(f=f.filter(P=>this._source.hasTile(P)))):f=[];const _=t.coveringZoomLevel(this._source),v=Math.max(_-ke.maxOverzooming,this._source.minzoom),T=Math.max(_+ke.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const F of f)if(F.canonical.z>this._source.minzoom){const q=F.scaledTo(F.canonical.z-1);P[q.key]=q;const W=F.scaledTo(Math.max(this._source.minzoom,Math.min(F.canonical.z,5)));P[W.key]=W}f=f.concat(Object.values(P))}const M=this._updateRetainedTiles(f,_);if(bt(this._source.type)){const P={},F={},q=Object.keys(M);for(const W of q){const le=M[W],se=this._tiles[W];if(!se||se.fadeEndTime&&se.fadeEndTime<=o.exported.now())continue;const ae=this.findLoadedParent(le,v);ae&&(this._addTile(ae.tileID),P[ae.tileID.key]=ae.tileID),F[W]=le}this._retainLoadedChildren(F,_,T,M);for(const W in P)M[W]||(this._coveredTiles[W]=!0,M[W]=P[W]);if(l){const W={},le={};for(const se of f)this._tiles[se.key].hasData()?W[se.key]=se:le[se.key]=se;for(const se in le){const ae=le[se].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(W[ae[0].key]=M[ae[0].key]=ae[0],W[ae[1].key]=M[ae[1].key]=ae[1],W[ae[2].key]=M[ae[2].key]=ae[2],W[ae[3].key]=M[ae[3].key]=ae[3],delete le[se])}for(const se in le){const ae=this.findLoadedParent(le[se],this._source.minzoom);if(ae){W[ae.tileID.key]=M[ae.tileID.key]=ae.tileID;for(const Te in W)W[Te].isChildOf(ae.tileID)&&delete W[Te]}}for(const se in this._tiles)W[se]||(this._coveredTiles[se]=!0)}}for(const P in M)this._tiles[P].clearFadeHold();const z=o.keysDifference(this._tiles,M);for(const P of z){const F=this._tiles[P];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,l){const f={},_={},v=Math.max(l-ke.maxOverzooming,this._source.minzoom),T=Math.max(l+ke.maxUnderzooming,this._source.minzoom),M={};for(const z of t){const P=this._addTile(z);f[z.key]=z,P.hasData()||l<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,l,T,f);for(const z of t){let P=this._tiles[z.key];if(P.hasData())continue;if(l+1>this._source.maxzoom){const q=z.children(this._source.maxzoom)[0],W=this.getTile(q);if(W&&W.hasData()){f[q.key]=q;continue}}else{const q=z.children(this._source.maxzoom);if(f[q[0].key]&&f[q[1].key]&&f[q[2].key]&&f[q[3].key])continue}let F=P.wasRequested();for(let q=z.overscaledZ-1;q>=v;--q){const W=z.scaledTo(q);if(_[W.key]||(_[W.key]=!0,P=this.getTile(W),!P&&F&&(P=this._addTile(W)),P&&(f[W.key]=W,F=P.wasRequested(),P.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const l=[];let f,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}l.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;_=v}for(const v of l)this._loadedParentTiles[v]=f}}_addTile(t){let l=this._tiles[t.key];if(l)return l;l=this._cache.getAndRemove(t),l&&(this._setTileReloadTimer(t.key,l),l.tileID=t,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,l)));const f=l;return l||(l=new We(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(l,this._tileLoaded.bind(this,l,t.key,l.state))),l.uses++,this._tiles[t.key]=l,f||this._source.fire(new o.Event("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(t,l){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=l.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){const l=this._tiles[t];l&&(l.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,l,f){const _=[],v=this.transform;if(!v)return _;const T=f?v.getCameraQueryGeometry(t):t,M=t.map(se=>v.pointCoordinate(se,this.terrain)),z=T.map(se=>v.pointCoordinate(se,this.terrain)),P=this.getIds();let F=1/0,q=1/0,W=-1/0,le=-1/0;for(const se of z)F=Math.min(F,se.x),q=Math.min(q,se.y),W=Math.max(W,se.x),le=Math.max(le,se.y);for(let se=0;se<P.length;se++){const ae=this._tiles[P[se]];if(ae.holdingForFade())continue;const Te=ae.tileID,Ce=Math.pow(2,v.zoom-ae.tileID.overscaledZ),Re=l*ae.queryPadding*o.EXTENT/ae.tileSize/Ce,de=[Te.getTilePoint(new o.MercatorCoordinate(F,q)),Te.getTilePoint(new o.MercatorCoordinate(W,le))];if(de[0].x-Re<o.EXTENT&&de[0].y-Re<o.EXTENT&&de[1].x+Re>=0&&de[1].y+Re>=0){const Ue=M.map(Je=>Te.getTilePoint(Je)),Oe=z.map(Je=>Te.getTilePoint(Je));_.push({tile:ae,tileID:Te,queryGeometry:Ue,cameraQueryGeometry:Oe,scale:Ce})}}return _}getVisibleCoordinates(t){const l=this.getRenderableIds(t).map(f=>this._tiles[f].tileID);for(const f of l)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(bt(this._source.type))for(const t in this._tiles){const l=this._tiles[t];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.exported.now())return!0}return!1}setFeatureState(t,l,f){this._state.updateState(t=t||"_geojsonTileLayer",l,f)}removeFeatureState(t,l,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",l,f)}getFeatureState(t,l){return this._state.getState(t=t||"_geojsonTileLayer",l)}setDependencies(t,l,f){const _=this._tiles[t];_&&_.setDependencies(l,f)}reloadTilesForDependencies(t,l){for(const f in this._tiles)this._tiles[f].hasDependency(t,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(t,l))}}function Fe(p,t){const l=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||f-l||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function bt(p){return p==="raster"||p==="image"||p==="video"}ke.maxOverzooming=10,ke.maxUnderzooming=3;const mi="mapboxgl_preloaded_worker_pool";class et{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<et.workerCount;)this.workers.push(new Worker(hs.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mi]}numActive(){return Object.keys(this.active).length}}const ht=Math.floor(o.exported.hardwareConcurrency/2);let li;function nn(){return li||(li=new et),li}function ei(p,t){const l={};for(const f in p)f!=="ref"&&(l[f]=p[f]);return o.refProperties.forEach(f=>{f in t&&(l[f]=t[f])}),l}function on(p){p=p.slice();const t=Object.create(null);for(let l=0;l<p.length;l++)t[p[l].id]=p[l];for(let l=0;l<p.length;l++)"ref"in p[l]&&(p[l]=ei(p[l],t[p[l].ref]));return p}et.workerCount=Math.max(Math.min(ht,6),1);const tt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ct(p,t,l){l.push({command:tt.addSource,args:[p,t[p]]})}function en(p,t,l){t.push({command:tt.removeSource,args:[p]}),l[p]=!0}function An(p,t,l,f){en(p,l,f),ct(p,t,l)}function Dr(p,t,l){let f;for(f in p[l])if(Object.prototype.hasOwnProperty.call(p[l],f)&&f!=="data"&&!k(p[l][f],t[l][f]))return!1;for(f in t[l])if(Object.prototype.hasOwnProperty.call(t[l],f)&&f!=="data"&&!k(p[l][f],t[l][f]))return!1;return!0}function sr(p,t,l,f,_,v){let T;for(T in t=t||{},p=p||{})Object.prototype.hasOwnProperty.call(p,T)&&(k(p[T],t[T])||l.push({command:v,args:[f,T,t[T],_]}));for(T in t)Object.prototype.hasOwnProperty.call(t,T)&&!Object.prototype.hasOwnProperty.call(p,T)&&(k(p[T],t[T])||l.push({command:v,args:[f,T,t[T],_]}))}function Hn(p){return p.id}function Pr(p,t){return p[t.id]=t,p}class ar{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let l=1,f=this._distances[l];const _=t*this.paddedLength+this.padding;for(;f<_&&l<this._distances.length;)f=this._distances[++l];const v=l-1,T=this._distances[v],M=f-T,z=M>0?(_-T)/M:0;return this.points[v].mult(1-z).add(this.points[l].mult(z))}}function Ye(p,t){let l=!0;return p==="always"||p!=="never"&&t!=="never"||(l=!1),l}class It{constructor(t,l,f){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(l/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,f,_,v){this._forEachCell(l,f,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(t,l,f,_){this._forEachCell(l-_,f-_,l+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(f),this.circles.push(_)}_insertBoxCell(t,l,f,_,v,T){this.boxCells[v].push(T)}_insertCircleCell(t,l,f,_,v,T){this.circleCells[v].push(T)}_query(t,l,f,_,v,T,M){if(f<0||t>this.width||_<0||l>this.height)return[];const z=[];if(t<=0&&l<=0&&this.width<=f&&this.height<=_){if(v)return[{key:null,x1:t,y1:l,x2:f,y2:_}];for(let P=0;P<this.boxKeys.length;P++)z.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const F=this.circles[3*P],q=this.circles[3*P+1],W=this.circles[3*P+2];z.push({key:this.circleKeys[P],x1:F-W,y1:q-W,x2:F+W,y2:q+W})}}else this._forEachCell(t,l,f,_,this._queryCell,z,{hitTest:v,overlapMode:T,seenUids:{box:{},circle:{}}},M);return z}query(t,l,f,_){return this._query(t,l,f,_,!1,null)}hitTest(t,l,f,_,v,T){return this._query(t,l,f,_,!0,v,T).length>0}hitTestCircle(t,l,f,_,v){const T=t-f,M=t+f,z=l-f,P=l+f;if(M<0||T>this.width||P<0||z>this.height)return!1;const F=[];return this._forEachCell(T,z,M,P,this._queryCellCircle,F,{hitTest:!0,overlapMode:_,circle:{x:t,y:l,radius:f},seenUids:{box:{},circle:{}}},v),F.length>0}_queryCell(t,l,f,_,v,T,M,z){const{seenUids:P,hitTest:F,overlapMode:q}=M,W=this.boxCells[v];if(W!==null){const se=this.bboxes;for(const ae of W)if(!P.box[ae]){P.box[ae]=!0;const Te=4*ae,Ce=this.boxKeys[ae];if(t<=se[Te+2]&&l<=se[Te+3]&&f>=se[Te+0]&&_>=se[Te+1]&&(!z||z(Ce))&&(!F||!Ye(q,Ce.overlapMode))&&(T.push({key:Ce,x1:se[Te],y1:se[Te+1],x2:se[Te+2],y2:se[Te+3]}),F))return!0}}const le=this.circleCells[v];if(le!==null){const se=this.circles;for(const ae of le)if(!P.circle[ae]){P.circle[ae]=!0;const Te=3*ae,Ce=this.circleKeys[ae];if(this._circleAndRectCollide(se[Te],se[Te+1],se[Te+2],t,l,f,_)&&(!z||z(Ce))&&(!F||!Ye(q,Ce.overlapMode))){const Re=se[Te],de=se[Te+1],Ue=se[Te+2];if(T.push({key:Ce,x1:Re-Ue,y1:de-Ue,x2:Re+Ue,y2:de+Ue}),F)return!0}}}return!1}_queryCellCircle(t,l,f,_,v,T,M,z){const{circle:P,seenUids:F,overlapMode:q}=M,W=this.boxCells[v];if(W!==null){const se=this.bboxes;for(const ae of W)if(!F.box[ae]){F.box[ae]=!0;const Te=4*ae,Ce=this.boxKeys[ae];if(this._circleAndRectCollide(P.x,P.y,P.radius,se[Te+0],se[Te+1],se[Te+2],se[Te+3])&&(!z||z(Ce))&&!Ye(q,Ce.overlapMode))return T.push(!0),!0}}const le=this.circleCells[v];if(le!==null){const se=this.circles;for(const ae of le)if(!F.circle[ae]){F.circle[ae]=!0;const Te=3*ae,Ce=this.circleKeys[ae];if(this._circlesCollide(se[Te],se[Te+1],se[Te+2],P.x,P.y,P.radius)&&(!z||z(Ce))&&!Ye(q,Ce.overlapMode))return T.push(!0),!0}}}_forEachCell(t,l,f,_,v,T,M,z){const P=this._convertToXCellCoord(t),F=this._convertToYCellCoord(l),q=this._convertToXCellCoord(f),W=this._convertToYCellCoord(_);for(let le=P;le<=q;le++)for(let se=F;se<=W;se++)if(v.call(this,t,l,f,_,this.xCellCount*se+le,T,M,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,f,_,v,T){const M=_-t,z=v-l,P=f+T;return P*P>M*M+z*z}_circleAndRectCollide(t,l,f,_,v,T,M){const z=(T-_)/2,P=Math.abs(t-(_+z));if(P>z+f)return!1;const F=(M-v)/2,q=Math.abs(l-(v+F));if(q>F+f)return!1;if(P<=z||q<=F)return!0;const W=P-z,le=q-F;return W*W+le*le<=f*f}}function Lr(p,t,l,f,_){const v=o.create();return t?(o.scale(v,v,[1/_,1/_,1]),l||o.rotateZ(v,v,f.angle)):o.multiply(v,f.labelPlaneMatrix,p),v}function Un(p,t,l,f,_){if(t){const v=o.clone(p);return o.scale(v,v,[_,_,1]),l||o.rotateZ(v,v,-f.angle),v}return f.glCoordMatrix}function ki(p,t,l){let f;l?(f=[p.x,p.y,l(p.x,p.y),1],o.transformMat4(f,f,t)):(f=[p.x,p.y,0,1],dr(f,f,t));const _=f[3];return{point:new o.pointGeometry(f[0]/_,f[1]/_),signedDistanceFromCamera:_}}function Ei(p,t){return .5+p/t*.5}function cn(p,t){const l=p[0]/p[3],f=p[1]/p[3];return l>=-t[0]&&l<=t[0]&&f>=-t[1]&&f<=t[1]}function kn(p,t,l,f,_,v,T,M,z,P){const F=f?p.textSizeData:p.iconSizeData,q=o.evaluateSizeForZoom(F,l.transform.zoom),W=[256/l.width*2+1,256/l.height*2+1],le=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;le.clear();const se=p.lineVertexArray,ae=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,Te=l.transform.width/l.transform.height;let Ce=!1;for(let Re=0;Re<ae.length;Re++){const de=ae.get(Re);if(de.hidden||de.writingMode===o.WritingMode.vertical&&!Ce){ri(de.numGlyphs,le);continue}let Ue;if(Ce=!1,P?(Ue=[de.anchorX,de.anchorY,P(de.anchorX,de.anchorY),1],o.transformMat4(Ue,Ue,t)):(Ue=[de.anchorX,de.anchorY,0,1],dr(Ue,Ue,t)),!cn(Ue,W)){ri(de.numGlyphs,le);continue}const Oe=Ei(l.transform.cameraToCenterDistance,Ue[3]),Je=o.evaluateSizeForFeature(F,q,de),$e=T?Je/Oe:Je*Oe,pt=new o.pointGeometry(de.anchorX,de.anchorY),He=ki(pt,_,P).point,Dt={},kt=ci(de,$e,!1,M,t,_,v,p.glyphOffsetArray,se,le,He,pt,Dt,Te,z,P);Ce=kt.useVertical,(kt.notEnoughRoom||Ce||kt.needsFlipping&&ci(de,$e,!0,M,t,_,v,p.glyphOffsetArray,se,le,He,pt,Dt,Te,z,P).notEnoughRoom)&&ri(de.numGlyphs,le)}f?p.text.dynamicLayoutVertexBuffer.updateData(le):p.icon.dynamicLayoutVertexBuffer.updateData(le)}function or(p,t,l,f,_,v,T,M,z,P,F,q,W){const le=M.glyphStartIndex+M.numGlyphs,se=M.lineStartIndex,ae=M.lineStartIndex+M.lineLength,Te=t.getoffsetX(M.glyphStartIndex),Ce=t.getoffsetX(le-1),Re=mn(p*Te,l,f,_,v,T,M.segment,se,ae,z,P,F,q,W);if(!Re)return null;const de=mn(p*Ce,l,f,_,v,T,M.segment,se,ae,z,P,F,q,W);return de?{first:Re,last:de}:null}function xt(p,t,l,f){return p===o.WritingMode.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*f?{useVertical:!0}:(p===o.WritingMode.vertical?t.y<l.y:t.x>l.x)?{needsFlipping:!0}:null}function ci(p,t,l,f,_,v,T,M,z,P,F,q,W,le,se,ae){const Te=t/24,Ce=p.lineOffsetX*Te,Re=p.lineOffsetY*Te;let de;if(p.numGlyphs>1){const Ue=p.glyphStartIndex+p.numGlyphs,Oe=p.lineStartIndex,Je=p.lineStartIndex+p.lineLength,$e=or(Te,M,Ce,Re,l,F,q,p,z,v,W,se,ae);if(!$e)return{notEnoughRoom:!0};const pt=ki($e.first.point,T,ae).point,He=ki($e.last.point,T,ae).point;if(f&&!l){const Dt=xt(p.writingMode,pt,He,le);if(Dt)return Dt}de=[$e.first];for(let Dt=p.glyphStartIndex+1;Dt<Ue-1;Dt++)de.push(mn(Te*M.getoffsetX(Dt),Ce,Re,l,F,q,p.segment,Oe,Je,z,v,W,se,ae));de.push($e.last)}else{if(f&&!l){const Oe=ki(q,_,ae).point,Je=p.lineStartIndex+p.segment+1,$e=new o.pointGeometry(z.getx(Je),z.gety(Je)),pt=ki($e,_,ae),He=pt.signedDistanceFromCamera>0?pt.point:ai(q,$e,Oe,1,_,ae),Dt=xt(p.writingMode,Oe,He,le);if(Dt)return Dt}const Ue=mn(Te*M.getoffsetX(p.glyphStartIndex),Ce,Re,l,F,q,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,z,v,W,se,ae);if(!Ue)return{notEnoughRoom:!0};de=[Ue]}for(const Ue of de)o.addDynamicAttributes(P,Ue.point,Ue.angle);return{}}function ai(p,t,l,f,_,v){const T=ki(p.add(p.sub(t)._unit()),_,v).point,M=l.sub(T);return l.add(M._mult(f/M.mag()))}function mn(p,t,l,f,_,v,T,M,z,P,F,q,W,le){const se=f?p-t:p+t;let ae=se>0?1:-1,Te=0;f&&(ae*=-1,Te=Math.PI),ae<0&&(Te+=Math.PI);let Ce=ae>0?M+T:M+T+1,Re=_,de=_,Ue=0,Oe=0;const Je=Math.abs(se),$e=[];for(;Ue+Oe<=Je;){if(Ce+=ae,Ce<M||Ce>=z)return null;if(de=Re,$e.push(Re),Re=q[Ce],Re===void 0){const Pt=new o.pointGeometry(P.getx(Ce),P.gety(Ce)),ui=ki(Pt,F,le);if(ui.signedDistanceFromCamera>0)Re=q[Ce]=ui.point;else{const yi=Ce-ae;Re=ai(Ue===0?v:new o.pointGeometry(P.getx(yi),P.gety(yi)),Pt,de,Je-Ue+1,F,le)}}Ue+=Oe,Oe=de.dist(Re)}const pt=(Je-Ue)/Oe,He=Re.sub(de),Dt=He.mult(pt)._add(de);Dt._add(He._unit()._perp()._mult(l*ae));const kt=Te+Math.atan2(Re.y-de.y,Re.x-de.x);return $e.push(Dt),{point:Dt,angle:W?kt:0,path:$e}}const Bn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ri(p,t){for(let l=0;l<p;l++){const f=t.length;t.resize(f+4),t.float32.set(Bn,3*f)}}function dr(p,t,l){const f=t[0],_=t[1];return p[0]=l[0]*f+l[4]*_+l[12],p[1]=l[1]*f+l[5]*_+l[13],p[3]=l[3]*f+l[7]*_+l[15],p}const un=100;class Kr{constructor(t,l=new It(t.width+200,t.height+200,25),f=new It(t.width+200,t.height+200,25)){this.transform=t,this.grid=l,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+un,this.screenBottomBoundary=t.height+un,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,l,f,_,v,T){const M=this.projectAndGetPerspectiveRatio(_,t.anchorPointX,t.anchorPointY,T),z=f*M.perspectiveRatio,P=t.x1*z+M.point.x,F=t.y1*z+M.point.y,q=t.x2*z+M.point.x,W=t.y2*z+M.point.y;return!this.isInsideGrid(P,F,q,W)||l!=="always"&&this.grid.hitTest(P,F,q,W,l,v)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[P,F,q,W],offscreen:this.isOffscreen(P,F,q,W)}}placeCollisionCircles(t,l,f,_,v,T,M,z,P,F,q,W,le,se){const ae=[],Te=new o.pointGeometry(l.anchorX,l.anchorY),Ce=ki(Te,T,se),Re=Ei(this.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),de=(F?v/Re:v*Re)/o.ONE_EM,Ue=ki(Te,M,se).point,Oe=or(de,_,l.lineOffsetX*de,l.lineOffsetY*de,!1,Ue,Te,l,f,M,{},!1,se);let Je=!1,$e=!1,pt=!0;if(Oe){const He=.5*W*Re+le,Dt=new o.pointGeometry(-100,-100),kt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Pt=new ar,ui=Oe.first,yi=Oe.last;let Yt=[];for(let Ai=ui.path.length-1;Ai>=1;Ai--)Yt.push(ui.path[Ai]);for(let Ai=1;Ai<yi.path.length;Ai++)Yt.push(yi.path[Ai]);const Ri=2.5*He;if(z){const Ai=Yt.map(Mi=>ki(Mi,z,se));Yt=Ai.some(Mi=>Mi.signedDistanceFromCamera<=0)?[]:Ai.map(Mi=>Mi.point)}let Fi=[];if(Yt.length>0){const Ai=Yt[0].clone(),Mi=Yt[0].clone();for(let Oi=1;Oi<Yt.length;Oi++)Ai.x=Math.min(Ai.x,Yt[Oi].x),Ai.y=Math.min(Ai.y,Yt[Oi].y),Mi.x=Math.max(Mi.x,Yt[Oi].x),Mi.y=Math.max(Mi.y,Yt[Oi].y);Fi=Ai.x>=Dt.x&&Mi.x<=kt.x&&Ai.y>=Dt.y&&Mi.y<=kt.y?[Yt]:Mi.x<Dt.x||Ai.x>kt.x||Mi.y<Dt.y||Ai.y>kt.y?[]:o.clipLine([Yt],Dt.x,Dt.y,kt.x,kt.y)}for(const Ai of Fi){Pt.reset(Ai,.25*He);let Mi=0;Mi=Pt.length<=.5*He?1:Math.ceil(Pt.paddedLength/Ri)+1;for(let Oi=0;Oi<Mi;Oi++){const vn=Oi/Math.max(Mi-1,1),Er=Pt.lerp(vn),gr=Er.x+un,Ar=Er.y+un;ae.push(gr,Ar,He,0);const ns=gr-He,cr=Ar-He,qn=gr+He,Vr=Ar+He;if(pt=pt&&this.isOffscreen(ns,cr,qn,Vr),$e=$e||this.isInsideGrid(ns,cr,qn,Vr),t!=="always"&&this.grid.hitTestCircle(gr,Ar,He,t,q)&&(Je=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Je}}}}return{circles:!P&&Je||!$e||Re<this.perspectiveRatioCutoff?[]:ae,offscreen:pt,collisionDetected:Je}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,_=1/0,v=-1/0,T=-1/0;for(const F of t){const q=new o.pointGeometry(F.x+un,F.y+un);f=Math.min(f,q.x),_=Math.min(_,q.y),v=Math.max(v,q.x),T=Math.max(T,q.y),l.push(q)}const M=this.grid.query(f,_,v,T).concat(this.ignoredGrid.query(f,_,v,T)),z={},P={};for(const F of M){const q=F.key;if(z[q.bucketInstanceId]===void 0&&(z[q.bucketInstanceId]={}),z[q.bucketInstanceId][q.featureIndex])continue;const W=[new o.pointGeometry(F.x1,F.y1),new o.pointGeometry(F.x2,F.y1),new o.pointGeometry(F.x2,F.y2),new o.pointGeometry(F.x1,F.y2)];o.polygonIntersectsPolygon(l,W)&&(z[q.bucketInstanceId][q.featureIndex]=!0,P[q.bucketInstanceId]===void 0&&(P[q.bucketInstanceId]=[]),P[q.bucketInstanceId].push(q.featureIndex))}return P}insertCollisionBox(t,l,f,_,v,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:T,overlapMode:l},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,f,_,v,T){const M=f?this.ignoredGrid:this.grid,z={bucketInstanceId:_,featureIndex:v,collisionGroupID:T,overlapMode:l};for(let P=0;P<t.length;P+=4)M.insertCircle(z,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,l,f,_){let v;return _?(v=[l,f,_(l,f),1],o.transformMat4(v,v,t)):(v=[l,f,0,1],dr(v,v,t)),{point:new o.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+un,(-v[1]/v[3]+1)/2*this.transform.height+un),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(t,l,f,_){return f<un||t>=this.screenRightBoundary||_<un||l>this.screenBottomBoundary}isInsideGrid(t,l,f,_){return f>=0&&t<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function rn(p,t,l){return t*(o.EXTENT/(p.tileSize*Math.pow(2,l-p.tileID.overscaledZ)))}class Tn{constructor(t,l,f,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Li{constructor(t,l,f,_,v){this.text=new Tn(t?t.text:null,l,f,v),this.icon=new Tn(t?t.icon:null,l,_,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Br{constructor(t,l,f){this.text=t,this.icon=l,this.skipFade=f}}class Kn{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Rr{constructor(t,l,f,_,v){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=v}}class kr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[t]}}function Yr(p,t,l,f,_){const{horizontalAlign:v,verticalAlign:T}=o.getAnchorAlignment(p),M=-(v-.5)*t,z=-(T-.5)*l,P=o.evaluateVariableOffset(p,f);return new o.pointGeometry(M+P[0]*_,z+P[1]*_)}function mr(p,t,l,f,_,v){const{x1:T,x2:M,y1:z,y2:P,anchorPointX:F,anchorPointY:q}=p,W=new o.pointGeometry(t,l);return f&&W._rotate(_?v:-v),{x1:T+W.x,y1:z+W.y,x2:M+W.x,y2:P+W.y,anchorPointX:F,anchorPointY:q}}class te{constructor(t,l,f,_,v){this.transform=t.clone(),this.terrain=l,this.collisionIndex=new Kr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new kr(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,l,f,_){const v=f.getBucket(l),T=f.latestFeatureIndex;if(!v||!T||l.id!==v.layerIds[0])return;const M=f.collisionBoxArray,z=v.layers[0].layout,P=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),F=f.tileSize/o.EXTENT,q=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),W=z.get("text-pitch-alignment")==="map",le=z.get("text-rotation-alignment")==="map",se=rn(f,1,this.transform.zoom),ae=Lr(q,W,le,this.transform,se);let Te=null;if(W){const Re=Un(q,W,le,this.transform,se);Te=o.multiply([],this.transform.labelPlaneMatrix,Re)}this.retainedQueryData[v.bucketInstanceId]=new Rr(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,f.tileID);const Ce={bucket:v,layout:z,posMatrix:q,textLabelPlaneMatrix:ae,labelToScreenMatrix:Te,scale:P,textPixelRatio:F,holdingForFade:f.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const Re of v.sortKeyRanges){const{sortKey:de,symbolInstanceStart:Ue,symbolInstanceEnd:Oe}=Re;t.push({sortKey:de,symbolInstanceStart:Ue,symbolInstanceEnd:Oe,parameters:Ce})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(t,l,f,_,v,T,M,z,P,F,q,W,le,se,ae,Te){const Ce=[W.textOffset0,W.textOffset1],Re=Yr(t,f,_,Ce,v),de=this.collisionIndex.placeCollisionBox(mr(l,Re.x,Re.y,T,M,this.transform.angle),q,z,P,F.predicate,Te);if((!ae||this.collisionIndex.placeCollisionBox(mr(ae,Re.x,Re.y,T,M,this.transform.angle),q,z,P,F.predicate,Te).box.length!==0)&&de.box.length>0){let Ue;if(this.prevPlacement&&this.prevPlacement.variableOffsets[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID]&&this.prevPlacement.placements[W.crossTileID].text&&(Ue=this.prevPlacement.variableOffsets[W.crossTileID].anchor),W.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[W.crossTileID]={textOffset:Ce,width:f,height:_,anchor:t,textBoxScale:v,prevAnchor:Ue},this.markUsedJustification(le,t,W,se),le.allowVerticalPlacement&&(this.markUsedOrientation(le,se,W),this.placedOrientations[W.crossTileID]=se),{shift:Re,placedGlyphBoxes:de}}}placeLayerBucketPart(t,l,f){const{bucket:_,layout:v,posMatrix:T,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:P,holdingForFade:F,collisionBoxArray:q,partiallyEvaluatedTextSize:W,collisionGroup:le}=t.parameters,se=v.get("text-optional"),ae=v.get("icon-optional"),Te=o.getOverlapMode(v,"text-overlap","text-allow-overlap"),Ce=Te==="always",Re=o.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),de=Re==="always",Ue=v.get("text-rotation-alignment")==="map",Oe=v.get("text-pitch-alignment")==="map",Je=v.get("icon-text-fit")!=="none",$e=v.get("symbol-z-order")==="viewport-y",pt=Ce&&(de||!_.hasIconData()||ae),He=de&&(Ce||!_.hasTextData()||se);!_.collisionArrays&&q&&_.deserializeCollisionBoxes(q);const Dt=(kt,Pt)=>{if(l[kt.crossTileID])return;if(F)return void(this.placements[kt.crossTileID]=new Br(!1,!1,!1));let ui=!1,yi=!1,Yt=!0,Ri=null,Fi={box:null,offscreen:null},Ai={box:null,offscreen:null},Mi=null,Oi=null,vn=null,Er=0,gr=0,Ar=0;Pt.textFeatureIndex?Er=Pt.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Er=kt.featureIndex),Pt.verticalTextFeatureIndex&&(gr=Pt.verticalTextFeatureIndex);const ns=this.retainedQueryData[_.bucketInstanceId].tileID,cr=this.terrain?(pn,bi)=>this.terrain.getElevation(ns,pn,bi):null;for(const pn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const bi=Pt[pn];bi&&(bi.elevation=cr?cr(bi.anchorPointX,bi.anchorPointY):0)}const qn=Pt.textBox;if(qn){const pn=Bi=>{let bn=o.WritingMode.horizontal;if(_.allowVerticalPlacement&&!Bi&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[kt.crossTileID];xn&&(this.placedOrientations[kt.crossTileID]=xn,bn=xn,this.markUsedOrientation(_,bn,kt))}return bn},bi=(Bi,bn)=>{if(_.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Pt.verticalTextBox){for(const xn of _.writingModes)if(xn===o.WritingMode.vertical?(Fi=bn(),Ai=Fi):Fi=Bi(),Fi&&Fi.box&&Fi.box.length)break}else Fi=Bi()};if(v.get("text-variable-anchor")){let Bi=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt.crossTileID]){const Ji=this.prevPlacement.variableOffsets[kt.crossTileID];Bi.indexOf(Ji.anchor)>0&&(Bi=Bi.filter(ur=>ur!==Ji.anchor),Bi.unshift(Ji.anchor))}const bn=(Ji,ur,fs)=>{const Uo=Ji.x2-Ji.x1,Bs=Ji.y2-Ji.y1,oc=kt.textBoxScale,Go=Je&&Re==="never"?ur:null;let rs={box:[],offscreen:!1};const ds=Te!=="never"?2*Bi.length:Bi.length;for(let ms=0;ms<ds;++ms){const qa=this.attemptAnchorPlacement(Bi[ms%Bi.length],Ji,Uo,Bs,oc,Ue,Oe,P,T,le,ms>=Bi.length?Te:"never",kt,_,fs,Go,cr);if(qa&&(rs=qa.placedGlyphBoxes,rs&&rs.box&&rs.box.length)){ui=!0,Ri=qa.shift;break}}return rs};bi(()=>bn(qn,Pt.iconBox,o.WritingMode.horizontal),()=>{const Ji=Pt.verticalTextBox;return _.allowVerticalPlacement&&!(Fi&&Fi.box&&Fi.box.length)&&kt.numVerticalGlyphVertices>0&&Ji?bn(Ji,Pt.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Fi&&(ui=Fi.box,Yt=Fi.offscreen);const xn=pn(Fi&&Fi.box);if(!ui&&this.prevPlacement){const Ji=this.prevPlacement.variableOffsets[kt.crossTileID];Ji&&(this.variableOffsets[kt.crossTileID]=Ji,this.markUsedJustification(_,Ji.anchor,kt,xn))}}else{const Bi=(bn,xn)=>{const Ji=this.collisionIndex.placeCollisionBox(bn,Te,P,T,le.predicate,cr);return Ji&&Ji.box&&Ji.box.length&&(this.markUsedOrientation(_,xn,kt),this.placedOrientations[kt.crossTileID]=xn),Ji};bi(()=>Bi(qn,o.WritingMode.horizontal),()=>{const bn=Pt.verticalTextBox;return _.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&bn?Bi(bn,o.WritingMode.vertical):{box:null,offscreen:null}}),pn(Fi&&Fi.box&&Fi.box.length)}}if(Mi=Fi,ui=Mi&&Mi.box&&Mi.box.length>0,Yt=Mi&&Mi.offscreen,kt.useRuntimeCollisionCircles){const pn=_.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),bi=o.evaluateSizeForFeature(_.textSizeData,W,pn),Bi=v.get("text-padding");Oi=this.collisionIndex.placeCollisionCircles(Te,pn,_.lineVertexArray,_.glyphOffsetArray,bi,T,M,z,f,Oe,le.predicate,kt.collisionCircleDiameter,Bi,cr),Oi.circles.length&&Oi.collisionDetected&&!f&&o.warnOnce("Collisions detected, but collision boxes are not shown"),ui=Ce||Oi.circles.length>0&&!Oi.collisionDetected,Yt=Yt&&Oi.offscreen}if(Pt.iconFeatureIndex&&(Ar=Pt.iconFeatureIndex),Pt.iconBox){const pn=bi=>{const Bi=Je&&Ri?mr(bi,Ri.x,Ri.y,Ue,Oe,this.transform.angle):bi;return this.collisionIndex.placeCollisionBox(Bi,Re,P,T,le.predicate,cr)};Ai&&Ai.box&&Ai.box.length&&Pt.verticalIconBox?(vn=pn(Pt.verticalIconBox),yi=vn.box.length>0):(vn=pn(Pt.iconBox),yi=vn.box.length>0),Yt=Yt&&vn.offscreen}const Vr=se||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,Ga=ae||kt.numIconVertices===0;if(Vr||Ga?Ga?Vr||(yi=yi&&ui):ui=yi&&ui:yi=ui=yi&&ui,ui&&Mi&&Mi.box&&this.collisionIndex.insertCollisionBox(Mi.box,Te,v.get("text-ignore-placement"),_.bucketInstanceId,Ai&&Ai.box&&gr?gr:Er,le.ID),yi&&vn&&this.collisionIndex.insertCollisionBox(vn.box,Re,v.get("icon-ignore-placement"),_.bucketInstanceId,Ar,le.ID),Oi&&(ui&&this.collisionIndex.insertCollisionCircles(Oi.circles,Te,v.get("text-ignore-placement"),_.bucketInstanceId,Er,le.ID),f)){const pn=_.bucketInstanceId;let bi=this.collisionCircleArrays[pn];bi===void 0&&(bi=this.collisionCircleArrays[pn]=new Kn);for(let Bi=0;Bi<Oi.circles.length;Bi+=4)bi.circles.push(Oi.circles[Bi+0]),bi.circles.push(Oi.circles[Bi+1]),bi.circles.push(Oi.circles[Bi+2]),bi.circles.push(Oi.collisionDetected?1:0)}if(kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new Br(ui||pt,yi||He,Yt||_.justReloaded),l[kt.crossTileID]=!0};if($e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=_.getSortedSymbolIndexes(this.transform.angle);for(let Pt=kt.length-1;Pt>=0;--Pt){const ui=kt[Pt];Dt(_.symbolInstances.get(ui),_.collisionArrays[ui])}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)Dt(_.symbolInstances.get(kt),_.collisionArrays[kt]);if(f&&_.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[_.bucketInstanceId];o.invert(kt.invProjMatrix,T),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,l,f,_){let v;v=_===o.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(l)];const T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const M of T)M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=v>=0&&M!==v?0:f.crossTileID)}markUsedOrientation(t,l,f){const _=l===o.WritingMode.horizontal||l===o.WritingMode.horizontalOnly?l:0,v=l===o.WritingMode.vertical?l:0,T=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const M of T)t.text.placedSymbolArray.get(M).placedOrientation=_;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(t):1,v=l?l.opacities:{},T=l?l.variableOffsets:{},M=l?l.placedOrientations:{};for(const z in this.placements){const P=this.placements[z],F=v[z];F?(this.opacities[z]=new Li(F,_,P.text,P.icon),f=f||P.text!==F.text.placed||P.icon!==F.icon.placed):(this.opacities[z]=new Li(null,_,P.text,P.icon,P.skipFade),f=f||P.text||P.icon)}for(const z in v){const P=v[z];if(!this.opacities[z]){const F=new Li(P,_,!1,!1);F.isHidden()||(this.opacities[z]=F,f=f||P.text.placed||P.icon.placed)}}for(const z in T)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=T[z]);for(const z in M)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=M[z]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const f={};for(const _ of l){const v=_.getBucket(t);v&&_.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,f,_.collisionBoxArray)}}updateBucketOpacities(t,l,f){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0].layout,v=new Li(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),P=_.get("text-rotation-alignment")==="map",F=_.get("text-pitch-alignment")==="map",q=_.get("icon-text-fit")!=="none",W=new Li(null,0,T&&(M||!t.hasIconData()||_.get("icon-optional")),M&&(T||!t.hasTextData()||_.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const le=(se,ae,Te)=>{for(let Ce=0;Ce<ae/4;Ce++)se.opacityVertexArray.emplaceBack(Te)};for(let se=0;se<t.symbolInstances.length;se++){const ae=t.symbolInstances.get(se),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:Ce,crossTileID:Re}=ae;let de=this.opacities[Re];l[Re]?de=v:de||(de=W,this.opacities[Re]=de),l[Re]=!0;const Ue=ae.numIconVertices>0,Oe=this.placedOrientations[ae.crossTileID],Je=Oe===o.WritingMode.vertical,$e=Oe===o.WritingMode.horizontal||Oe===o.WritingMode.horizontalOnly;if(Te>0||Ce>0){const pt=Ae(de.text);le(t.text,Te,Je?Xe:pt),le(t.text,Ce,$e?Xe:pt);const He=de.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(Pt=>{Pt>=0&&(t.text.placedSymbolArray.get(Pt).hidden=He||Je?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=He||$e?1:0);const Dt=this.variableOffsets[ae.crossTileID];Dt&&this.markUsedJustification(t,Dt.anchor,ae,Oe);const kt=this.placedOrientations[ae.crossTileID];kt&&(this.markUsedJustification(t,"left",ae,kt),this.markUsedOrientation(t,kt,ae))}if(Ue){const pt=Ae(de.icon),He=!(q&&ae.verticalPlacedIconSymbolIndex&&Je);ae.placedIconSymbolIndex>=0&&(le(t.icon,ae.numIconVertices,He?pt:Xe),t.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=de.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(le(t.icon,ae.numVerticalIconVertices,He?Xe:pt),t.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const pt=t.collisionArrays[se];if(pt){let He=new o.pointGeometry(0,0);if(pt.textBox||pt.verticalTextBox){let kt=!0;if(z){const Pt=this.variableOffsets[Re];Pt?(He=Yr(Pt.anchor,Pt.width,Pt.height,Pt.textOffset,Pt.textBoxScale),P&&He._rotate(F?this.transform.angle:-this.transform.angle)):kt=!1}pt.textBox&&L(t.textCollisionBox.collisionVertexArray,de.text.placed,!kt||Je,He.x,He.y),pt.verticalTextBox&&L(t.textCollisionBox.collisionVertexArray,de.text.placed,!kt||$e,He.x,He.y)}const Dt=!!(!$e&&pt.verticalIconBox);pt.iconBox&&L(t.iconCollisionBox.collisionVertexArray,de.icon.placed,Dt,q?He.x:0,q?He.y:0),pt.verticalIconBox&&L(t.iconCollisionBox.collisionVertexArray,de.icon.placed,!Dt,q?He.x:0,q?He.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=se.invProjMatrix,t.placementViewportMatrix=se.viewportMatrix,t.collisionCircleArray=se.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function L(p,t,l,f,_){p.emplaceBack(t?1:0,l?1:0,f||0,_||0),p.emplaceBack(t?1:0,l?1:0,f||0,_||0),p.emplaceBack(t?1:0,l?1:0,f||0,_||0),p.emplaceBack(t?1:0,l?1:0,f||0,_||0)}const N=Math.pow(2,25),$=Math.pow(2,24),ee=Math.pow(2,17),ye=Math.pow(2,16),Se=Math.pow(2,9),xe=Math.pow(2,8),_e=Math.pow(2,1);function Ae(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,l=Math.floor(127*p.opacity);return l*N+t*$+l*ee+t*ye+l*Se+t*xe+l*_e+t}const Xe=0;class ut{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,f,_,v){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(T,_,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((M,z)=>M.sortKey-z.sortKey));this._currentPartIndex<T.length;)if(l.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,v())return!0;return!1}}class je{constructor(t,l,f,_,v,T,M,z){this.placement=new te(t,l,T,M,z),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,l,f){const _=o.exported.now(),v=()=>{const T=o.exported.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=l[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new ut(T)),this._inProgressLayer.continuePlacement(f[T.source],this.placement,this._showCollisionBoxes,T,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const qt=512/o.EXTENT/2;class jt{constructor(t,l,f){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let _=0;_<l.length;_++){const v=l.get(_),T=v.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,t)})}}getScaledCoordinates(t,l){const f=qt/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*o.EXTENT+t.anchorX)*f),y:Math.floor((l.canonical.y*o.EXTENT+t.anchorY)*f)}}findMatches(t,l,f){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<t.length;v++){const T=t.get(v);if(T.crossTileID)continue;const M=this.indexedSymbolInstances[T.key];if(!M)continue;const z=this.getScaledCoordinates(T,l);for(const P of M)if(Math.abs(P.coord.x-z.x)<=_&&Math.abs(P.coord.y-z.y)<=_&&!f[P.crossTileID]){f[P.crossTileID]=!0,T.crossTileID=P.crossTileID;break}}}}class ie{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(l!==0)for(const f in this.indexes){const _=this.indexes[f],v={};for(const T in _){const M=_[T];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+l),v[M.tileID.key]=M}this.indexes[f]=v}this.lng=t}addBucket(t,l,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const _=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const T=this.indexes[v];if(Number(v)>t.overscaledZ)for(const M in T){const z=T[M];z.tileID.isChildOf(t)&&z.findMatches(l.symbolInstances,t,_)}else{const M=T[t.scaledTo(Number(v)).key];M&&M.findMatches(l.symbolInstances,t,_)}}for(let v=0;v<l.symbolInstances.length;v++){const T=l.symbolInstances.get(v);T.crossTileID||(T.crossTileID=f.generate(),_[T.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new jt(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const f in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[f])delete this.usedCrossTileIDs[t][_.crossTileID]}removeStaleBuckets(t){let l=!1;for(const f in this.indexes){const _=this.indexes[f];for(const v in _)t[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[v]),delete _[v],l=!0)}return l}}class At{constructor(){this.layerIndexes={},this.crossTileIDs=new ie,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,f){let _=this.layerIndexes[t.id];_===void 0&&(_=this.layerIndexes[t.id]=new mt);let v=!1;const T={};_.handleWrapJump(f);for(const M of l){const z=M.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(M.tileID,z,this.crossTileIDs)&&(v=!0),T[z.bucketInstanceId]=!0)}return _.removeStaleBuckets(T)&&(v=!0),v}pruneUnusedLayers(t){const l={};t.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}var oi=o.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Qt extends o.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const l=this._tiles[t];l.textures.forEach(f=>f.destroy()),l.textures=[]}}update(t,l){this.sourceCache.update(t,l),this._renderableTilesKeys=[];for(const f of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.posMatrix=new Float64Array(16),o.ortho(f.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),this._tiles[f.key]=new We(f,this.tileSize))}removeOutdated(t){const l={};this.renderHistory=this.renderHistory.filter((f,_)=>this.renderHistory.indexOf(f)===_).slice(0,this.renderHistorySize);for(const f of this._renderableTilesKeys)l[f]=!0;for(const f of this.renderHistory)l[f]=!0;for(const f in this._tiles)l[f]||(this._tiles[f].clearTextures(t),delete this._tiles[f])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const l={};for(const f of this._renderableTilesKeys){const _=this._tiles[f].tileID;if(_.canonical.equals(t.canonical)){const v=t.clone();v.posMatrix=new Float64Array(16),o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),l[f]=v}else if(_.canonical.isChildOf(t.canonical)){const v=t.clone();v.posMatrix=new Float64Array(16);const T=_.canonical.z-t.canonical.z,M=_.canonical.x-(_.canonical.x>>T<<T),z=_.canonical.y-(_.canonical.y>>T<<T),P=o.EXTENT>>T;o.ortho(v.posMatrix,0,P,0,P,0,1),o.translate(v.posMatrix,v.posMatrix,[-M*P,-z*P,0]),l[f]=v}else if(t.canonical.isChildOf(_.canonical)){const v=t.clone();v.posMatrix=new Float64Array(16);const T=t.canonical.z-_.canonical.z,M=t.canonical.x-(t.canonical.x>>T<<T),z=t.canonical.y-(t.canonical.y>>T<<T),P=o.EXTENT>>T;o.ortho(v.posMatrix,0,o.EXTENT,0,o.EXTENT,0,1),o.translate(v.posMatrix,v.posMatrix,[M*P,z*P,0]),o.scale(v.posMatrix,v.posMatrix,[1/2**T,1/2**T,0]),l[f]=v}}return l}getSourceTile(t,l){const f=this.sourceCache._source;let _=t.overscaledZ-this.deltaZoom;if(_>f.maxzoom&&(_=f.maxzoom),_<f.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(_).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!v||!v.dem)&&l)for(;_>=f.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(t.scaledTo(_--).key);return v}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(l=>l.timeLoaded>=t)}}class ti{constructor(t,l,f){this.style=t,this.sourceCache=new Qt(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.elevationOffset=typeof f.elevationOffset=="number"?f.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,l,f,_=o.EXTENT){if(!(l>=0&&l<_&&f>=0&&f<_))return this.elevationOffset;let v=0;const T=this.getTerrainData(t);if(T.tile&&T.tile.dem){const M=o.transformMat4$1([],[l/_*o.EXTENT,f/_*o.EXTENT],T.u_terrain_matrix),z=[M[0]*T.tile.dem.dim,M[1]*T.tile.dem.dim],P=[Math.floor(z[0]),Math.floor(z[1])],F=T.tile.dem.get(P[0],P[1]),q=T.tile.dem.get(P[0],P[1]+1),W=T.tile.dem.get(P[0]+1,P[1]),le=T.tile.dem.get(P[0]+1,P[1]+1);v=o.number(o.number(F,q,z[0]-P[0]),o.number(W,le,z[0]-P[0]),z[1]-P[1])}return v}rememberForRerender(t,l){for(const f in this.sourceCache._tiles){const _=this.sourceCache._tiles[f];(_.tileID.equals(l)||_.tileID.isChildOf(l))&&(t===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][_.tileID.key]=!0)}}needsRerender(t,l){return this._rerender[t]&&this._rerender[t][l.key]}clearRerenderCache(){this._rerender={}}getElevation(t,l,f,_=o.EXTENT){return(this.getDEMElevation(t,l,f,_)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const _=this.style.map.painter.context,v=new o.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new U(_,v,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new U(_,new o.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.identity([])}const l=this.sourceCache.getSourceTile(t,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const _=this.style.map.painter.context;l.demTexture=this.style.map.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new U(_,l.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),l.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const _=this.sourceCache.sourceCache._source.maxzoom;let v=t.canonical.z-l.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=_?v=t.canonical.z-_:o.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=t.canonical.x-(t.canonical.x>>v<<v),M=t.canonical.y-(t.canonical.y>>v<<v),z=o.fromScaling(new Float64Array(16),[1/(o.EXTENT<<v),1/(o.EXTENT<<v),0]);o.translate(z,z,[T*o.EXTENT,M*o.EXTENT,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const l=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(l,l,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,l,l))}return this._rttFramebuffer}getFramebuffer(t){const l=this.style.map.painter,f=l.width/devicePixelRatio,_=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new U(l.context,{width:f,height:_,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new U(l.context,{width:f,height:_,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,_,!0),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,_))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,T=0;v<this._coordsTextureSize;v++)for(let M=0;M<this._coordsTextureSize;M++,T+=4)l[T+0]=255&M,l[T+1]=255&v,l[T+2]=M>>8<<4|v>>8,l[T+3]=0;const f=new o.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),_=new U(t,f,t.gl.RGBA,{premultiply:!1});return _.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(t){const l=new Uint8Array(4),f=this.style.map.painter,_=f.context,v=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(t.x,f.height/devicePixelRatio-t.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,l),_.bindFramebuffer.set(null);const T=l[0]+(l[2]>>4<<8),M=l[1]+((15&l[2])<<8),z=this.coordsIndex[255-l[3]],P=z&&this.sourceCache.getTileByID(z);if(!P)return null;const F=this._coordsTextureSize,q=(1<<P.tileID.canonical.z)*F;return new o.MercatorCoordinate((P.tileID.canonical.x*F+T)/q,(P.tileID.canonical.y*F+M)/q,this.getElevation(P.tileID,T,M,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,l=new o.PosArray,f=new o.TriangleIndexArray,_=this.meshSize,v=o.EXTENT/_,T=_*_;for(let M=0;M<=_;M++)for(let z=0;z<=_;z++)l.emplaceBack(z*v,M*v);for(let M=0;M<T;M+=_+1)for(let z=0;z<_;z++)f.emplaceBack(z+M,_+z+M+1,_+z+M+2),f.emplaceBack(z+M,_+z+M+2,z+M+1);return this._mesh={indexBuffer:t.createIndexBuffer(f),vertexBuffer:t.createVertexBuffer(l,oi.members),segments:o.SegmentVector.simpleSegment(0,0,l.length,f.length)},this._mesh}getMinMaxElevation(t){const l=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=(l.dem.min+this.elevationOffset)*this.exaggeration,f.maxElevation=(l.dem.max+this.elevationOffset)*this.exaggeration),f}}const Ci=(p,t)=>o.emitValidationErrors(p,t&&t.filter(l=>l.identifier!=="source.canvas")),Vi=o.pick(tt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),yn=o.pick(tt,["setCenter","setZoom","setBearing","setPitch"]),Wi=function(){const p={},t=o.spec.$version;for(const l in o.spec.$root){const f=o.spec.$root[l];if(f.required){let _=null;_=l==="version"?t:f.type==="array"?[]:{},_!=null&&(p[l]=_)}}return p}();class Cn extends o.Evented{constructor(t,l={}){super(),this.map=t,this.dispatcher=new pe(nn(),this),this.imageManager=new Q,this.imageManager.setEventedParent(this),this.glyphManager=new ne(t._requestManager,l.localIdeographFontFamily),this.lineAtlas=new fe(256,512),this.crossTileSymbolIndex=new At,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const f=this;this._rtlTextPluginCallback=Cn.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,T)=>{if(o.triggerPluginCompletionEvent(v),T&&T.every(M=>M))for(const M in f.sourceCaches)f.sourceCaches[M].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.sourceCaches[_.sourceId];if(!v)return;const T=v.getSource();if(T&&T.vectorLayerIds)for(const M in this._layers){const z=this._layers[M];z.source===T.id&&this._validateLayer(z)}})}loadURL(t,l={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const f=typeof l.validate!="boolean"||l.validate,_=this.map._requestManager.transformRequest(t,o.ResourceType.Style);this._request=o.getJSON(_,(v,T)=>{this._request=null,v?this.fire(new o.ErrorEvent(v)):T&&this._load(T,f)})}loadJSON(t,l={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(t,l.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Wi,!1)}_load(t,l){if(l&&Ci(this,o.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const _ in t.sources)this.addSource(_,t.sources[_],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const f=on(this.stylesheet.layers);this._order=f.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of f)_=o.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new he(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(l,f,_,v){let T,M,z;const P=_>1?"@2x":"";let F=o.getJSON(f.transformRequest(f.normalizeSpriteURL(l,P,".json"),o.ResourceType.SpriteJSON),(le,se)=>{F=null,z||(z=le,T=se,W())}),q=o.getImage(f.transformRequest(f.normalizeSpriteURL(l,P,".png"),o.ResourceType.SpriteImage),(le,se)=>{q=null,z||(z=le,M=se,W())});function W(){if(z)v(z);else if(T&&M){const le=o.exported.getImageData(M),se={};for(const ae in T){const{width:Te,height:Ce,x:Re,y:de,sdf:Ue,pixelRatio:Oe,stretchX:Je,stretchY:$e,content:pt}=T[ae],He=new o.RGBAImage({width:Te,height:Ce});o.RGBAImage.copy(le,He,{x:Re,y:de},{x:0,y:0},{width:Te,height:Ce}),se[ae]={data:He,pixelRatio:Oe,sdf:Ue,stretchX:Je,stretchY:$e,content:pt}}v(null,se)}}return{cancel(){F&&(F.cancel(),F=null),q&&(q.cancel(),q=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(l,f)=>{if(this._spriteRequest=null,l)this.fire(new o.ErrorEvent(l));else if(f)for(const _ in f)this.imageManager.addImage(_,f[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(t){const l=this.sourceCaches[t.source];if(!l)return;const f=t.sourceLayer;if(!f)return;const _=l.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${_.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const l=[];for(const f of t){const _=this._layers[f];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const T in this._updatedSources){const M=this._updatedSources[T];if(M==="reload")this._reloadSource(T);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(T)}}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const f={};for(const _ in this.sourceCaches){const v=this.sourceCaches[_];f[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const _ in f){const v=this.sourceCaches[_];f[_]!==v.used&&v.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(t),this.z=t.zoom,l&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const l=this.sourceCaches[t.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new ti(this,l,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=f=>{f.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=f=>{f.tile&&(f.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(f.sourceId,f.tile.tileID)):f.source.type==="geojson"&&this.terrain.rememberForRerender(f.sourceId,f.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new o.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),Ci(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=on(t.layers);const l=function(_,v){if(!_)return[{command:tt.setStyle,args:[v]}];let T=[];try{if(!k(_.version,v.version))return[{command:tt.setStyle,args:[v]}];k(_.center,v.center)||T.push({command:tt.setCenter,args:[v.center]}),k(_.zoom,v.zoom)||T.push({command:tt.setZoom,args:[v.zoom]}),k(_.bearing,v.bearing)||T.push({command:tt.setBearing,args:[v.bearing]}),k(_.pitch,v.pitch)||T.push({command:tt.setPitch,args:[v.pitch]}),k(_.sprite,v.sprite)||T.push({command:tt.setSprite,args:[v.sprite]}),k(_.glyphs,v.glyphs)||T.push({command:tt.setGlyphs,args:[v.glyphs]}),k(_.transition,v.transition)||T.push({command:tt.setTransition,args:[v.transition]}),k(_.light,v.light)||T.push({command:tt.setLight,args:[v.light]});const M={},z=[];(function(F,q,W,le){let se;for(se in q=q||{},F=F||{})Object.prototype.hasOwnProperty.call(F,se)&&(Object.prototype.hasOwnProperty.call(q,se)||en(se,W,le));for(se in q)Object.prototype.hasOwnProperty.call(q,se)&&(Object.prototype.hasOwnProperty.call(F,se)?k(F[se],q[se])||(F[se].type==="geojson"&&q[se].type==="geojson"&&Dr(F,q,se)?W.push({command:tt.setGeoJSONSourceData,args:[se,q[se].data]}):An(se,q,W,le)):ct(se,q,W))})(_.sources,v.sources,z,M);const P=[];_.layers&&_.layers.forEach(F=>{M[F.source]?T.push({command:tt.removeLayer,args:[F.id]}):P.push(F)}),T=T.concat(z),function(F,q,W){q=q||[];const le=(F=F||[]).map(Hn),se=q.map(Hn),ae=F.reduce(Pr,{}),Te=q.reduce(Pr,{}),Ce=le.slice(),Re=Object.create(null);let de,Ue,Oe,Je,$e,pt,He;for(de=0,Ue=0;de<le.length;de++)Oe=le[de],Object.prototype.hasOwnProperty.call(Te,Oe)?Ue++:(W.push({command:tt.removeLayer,args:[Oe]}),Ce.splice(Ce.indexOf(Oe,Ue),1));for(de=0,Ue=0;de<se.length;de++)Oe=se[se.length-1-de],Ce[Ce.length-1-de]!==Oe&&(Object.prototype.hasOwnProperty.call(ae,Oe)?(W.push({command:tt.removeLayer,args:[Oe]}),Ce.splice(Ce.lastIndexOf(Oe,Ce.length-Ue),1)):Ue++,pt=Ce[Ce.length-de],W.push({command:tt.addLayer,args:[Te[Oe],pt]}),Ce.splice(Ce.length-de,0,Oe),Re[Oe]=!0);for(de=0;de<se.length;de++)if(Oe=se[de],Je=ae[Oe],$e=Te[Oe],!Re[Oe]&&!k(Je,$e))if(k(Je.source,$e.source)&&k(Je["source-layer"],$e["source-layer"])&&k(Je.type,$e.type)){for(He in sr(Je.layout,$e.layout,W,Oe,null,tt.setLayoutProperty),sr(Je.paint,$e.paint,W,Oe,null,tt.setPaintProperty),k(Je.filter,$e.filter)||W.push({command:tt.setFilter,args:[Oe,$e.filter]}),k(Je.minzoom,$e.minzoom)&&k(Je.maxzoom,$e.maxzoom)||W.push({command:tt.setLayerZoomRange,args:[Oe,$e.minzoom,$e.maxzoom]}),Je)Object.prototype.hasOwnProperty.call(Je,He)&&He!=="layout"&&He!=="paint"&&He!=="filter"&&He!=="metadata"&&He!=="minzoom"&&He!=="maxzoom"&&(He.indexOf("paint.")===0?sr(Je[He],$e[He],W,Oe,He.slice(6),tt.setPaintProperty):k(Je[He],$e[He])||W.push({command:tt.setLayerProperty,args:[Oe,He,$e[He]]}));for(He in $e)Object.prototype.hasOwnProperty.call($e,He)&&!Object.prototype.hasOwnProperty.call(Je,He)&&He!=="layout"&&He!=="paint"&&He!=="filter"&&He!=="metadata"&&He!=="minzoom"&&He!=="maxzoom"&&(He.indexOf("paint.")===0?sr(Je[He],$e[He],W,Oe,He.slice(6),tt.setPaintProperty):k(Je[He],$e[He])||W.push({command:tt.setLayerProperty,args:[Oe,He,$e[He]]}))}else W.push({command:tt.removeLayer,args:[Oe]}),pt=Ce[Ce.lastIndexOf(Oe)+1],W.push({command:tt.addLayer,args:[$e,pt]})}(P,v.layers,T)}catch(M){console.warn("Unable to compute style diff:",M),T=[{command:tt.setStyle,args:[v]}]}return T}(this.serialize(),t).filter(_=>!(_.command in yn));if(l.length===0)return!1;const f=l.filter(_=>!(_.command in Vi));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=t,!0}addImage(t,l){if(this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,l),this._afterImageUpdated(t)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,l,f={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.validateStyle.source,`sources.${t}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=this.sourceCaches[t]=new ke(t,l,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:t})),_.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],l.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,l){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.sourceCaches[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,l,f={}){this._checkLoaded();const _=t.id;if(this.getLayer(_))return void this.fire(new o.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let v;if(t.type==="custom"){if(Ci(this,o.validateCustomStyleLayer(t)))return;v=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=o.clone$1(t),t=o.extend(t,{source:_})),this._validate(o.validateStyle.layer,`layers.${_}`,t,{arrayIndex:-1},f))return;v=o.createStyleLayer(t),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}const T=l?this._order.indexOf(l):this._order.length;if(l&&T===-1)this.fire(new o.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${l}".`)));else{if(this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=v,this._removedLayers[_]&&v.source&&v.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const f=this._order.indexOf(t);this._order.splice(f,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new o.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${l}".`))):(this._order.splice(_,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new o.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));l.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,l,f){this._checkLoaded();const _=this.getLayer(t);_?_.minzoom===l&&_.maxzoom===f||(l!=null&&(_.minzoom=l),f!=null&&(_.maxzoom=f),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,l,f={}){this._checkLoaded();const _=this.getLayer(t);if(_){if(!k(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(o.validateStyle.filter,`layers.${_.id}.filter`,l,null,f)||(_.filter=o.clone$1(l),this._updateLayer(_)))}else this.fire(new o.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,l,f,_={}){this._checkLoaded();const v=this.getLayer(t);v?k(v.getLayoutProperty(l),f)||(v.setLayoutProperty(l,f,_),this._updateLayer(v)):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,l){const f=this.getLayer(t);if(f)return f.getLayoutProperty(l);this.fire(new o.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,l,f,_={}){this._checkLoaded();const v=this.getLayer(t);v?k(v.getPaintProperty(l),f)||(v.setPaintProperty(l,f,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,l){return this.getLayer(t).getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const f=t.source,_=t.sourceLayer,v=this.sourceCaches[f];if(v===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const T=v.getSource().type;T==="geojson"&&_?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||_?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(_,t.id,l)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,l){this._checkLoaded();const f=t.source,_=this.sourceCaches[f];if(_===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const v=_.getSource().type,T=v==="vector"?t.sourceLayer:void 0;v!=="vector"||T?l&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(T,t.id,l):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const l=t.source,f=t.sourceLayer,_=this.sourceCaches[l];if(_!==void 0)return _.getSource().type!=="vector"||f?(t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(f,t.id)):void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const l=T=>this._layers[T].type==="fill-extrusion",f={},_=[];for(let T=this._order.length-1;T>=0;T--){const M=this._order[T];if(l(M)){f[M]=T;for(const z of t){const P=z[M];if(P)for(const F of P)_.push(F)}}}_.sort((T,M)=>M.intersectionZ-T.intersectionZ);const v=[];for(let T=this._order.length-1;T>=0;T--){const M=this._order[T];if(l(M))for(let z=_.length-1;z>=0;z--){const P=_[z].feature;if(f[P.layer.id]<T)break;v.push(P),_.pop()}else for(const z of t){const P=z[M];if(P)for(const F of P)v.push(F.feature)}}return v}queryRenderedFeatures(t,l,f){l&&l.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const T of l.layers){const M=this._layers[T];if(!M)return this.fire(new o.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];_[M.source]=!0}}const v=[];l.availableImages=this._availableImages;for(const T in this.sourceCaches)l.layers&&!_[T]||v.push(vt(this.sourceCaches[T],this._layers,this._serializedLayers,t,l,f));return this.placement&&v.push(function(T,M,z,P,F,q,W){const le={},se=q.queryRenderedSymbols(P),ae=[];for(const Te of Object.keys(se).map(Number))ae.push(W[Te]);ae.sort(gt);for(const Te of ae){const Ce=Te.featureIndex.lookupSymbolFeatures(se[Te.bucketInstanceId],M,Te.bucketIndex,Te.sourceLayerIndex,F.filter,F.layers,F.availableImages,T);for(const Re in Ce){const de=le[Re]=le[Re]||[],Ue=Ce[Re];Ue.sort((Oe,Je)=>{const $e=Te.featureSortOrder;if($e){const pt=$e.indexOf(Oe.featureIndex);return $e.indexOf(Je.featureIndex)-pt}return Je.featureIndex-Oe.featureIndex});for(const Oe of Ue)de.push(Oe)}}for(const Te in le)le[Te].forEach(Ce=>{const Re=Ce.feature,de=z[T[Te].source].getFeatureState(Re.layer["source-layer"],Re.id);Re.source=Re.layer.source,Re.layer["source-layer"]&&(Re.sourceLayer=Re.layer["source-layer"]),Re.state=de});return le}(this._layers,this._serializedLayers,this.sourceCaches,t,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,l){l&&l.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[t];return f?function(_,v){const T=_.getRenderableIds().map(P=>_.getTileByID(P)),M=[],z={};for(let P=0;P<T.length;P++){const F=T[P],q=F.tileID.canonical.key;z[q]||(z[q]=!0,F.querySourceFeatures(M,v))}return M}(f,l):[]}addSourceType(t,l,f){return Cn.getSourceType(t)?f(new Error(`A source type called "${t}" already exists.`)):(Cn.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const T in t)if(!k(t[T],f[T])){_=!0;break}if(!_)return;const v={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,l),this.light.updateTransitions(v)}_validate(t,l,f,_,v={}){return(!v||v.validate!==!1)&&Ci(this,t.call(o.validateStyle,o.extend({key:l,style:this.serialize(),value:f,styleSpec:o.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const l=this.sourceCaches[t];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const l in this.sourceCaches)this.sourceCaches[l].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,l,f,_,v=!1){let T=!1,M=!1;const z={};for(const P of this._order){const F=this._layers[P];if(F.type!=="symbol")continue;if(!z[F.source]){const W=this.sourceCaches[F.source];z[F.source]=W.getRenderableIds(!0).map(le=>W.getTileByID(le)).sort((le,se)=>se.tileID.overscaledZ-le.tileID.overscaledZ||(le.tileID.isLessThan(se.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(F,z[F.source],t.center.lng);T=T||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new je(t,this.terrain,this._order,v,l,f,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),M=!0),T&&this.pauseablePlacement.placement.setStale()),M||T)for(const P of this._order){const F=this._layers[P];F.type==="symbol"&&this.placement.updateLayerOpacities(F,z[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const _=this.sourceCaches[l.source];_&&_.setDependencies(l.tileID.key,l.type,l.icons)}getGlyphs(t,l,f){this.glyphManager.getGlyphs(l.stacks,f)}getResource(t,l,f){return o.makeRequest(l,f)}}Cn.getSourceType=function(p){return lt[p]},Cn.setSourceType=function(p,t){lt[p]=t},Cn.registerForPluginStateChange=o.registerForPluginStateChange;var Is="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const qs={prelude:Ni(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ni(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ni(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ni(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ni("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ni(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ni("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ni("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ni(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ni(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ni(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ni(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ni(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ni(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ni(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ni(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ni("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Is),terrainDepth:Ni("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Is),terrainCoords:Ni("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Is)};function Ni(p,t){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/attribute ([\w]+) ([\w]+)/g),_=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=v?v.concat(_):_,M={};return{fragmentSource:p=p.replace(l,(z,P,F,q,W)=>(M[W]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${W}
varying ${F} ${q} ${W};
#else
uniform ${F} ${q} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${F} ${q} ${W} = u_${W};
#endif
`)),vertexSource:t=t.replace(l,(z,P,F,q,W)=>{const le=q==="float"?"vec2":"vec4",se=W.match(/color/)?"color":le;return M[W]?P==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${le} a_${W};
varying ${F} ${q} ${W};
#else
uniform ${F} ${q} u_${W};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${F} ${q} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${se}(a_${W}, u_${W}_t);
#else
    ${F} ${q} ${W} = u_${W};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
attribute ${F} ${le} a_${W};
#else
uniform ${F} ${q} u_${W};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${q} ${W} = a_${W};
#else
    ${F} ${q} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${F} ${q} ${W} = unpack_mix_${se}(a_${W}, u_${W}_t);
#else
    ${F} ${q} ${W} = u_${W};
#endif
`}),staticAttributes:f,staticUniforms:T}}class lo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,f,_,v,T,M,z,P){this.context=t;let F=this.boundPaintVertexBuffers.length!==_.length;for(let q=0;!F&&q<_.length;q++)this.boundPaintVertexBuffers[q]!==_[q]&&(F=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===f&&!F&&this.boundIndexBuffer===v&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===z&&this.boundDynamicVertexBuffer3===P?(t.bindVertexArrayOES.set(this.vao),M&&M.bind(),v&&v.dynamicDraw&&v.bind(),z&&z.bind(),P&&P.bind()):this.freshBind(l,f,_,v,T,M,z,P)}freshBind(t,l,f,_,v,T,M,z){let P;const F=t.numAttributes,q=this.context,W=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=z;else{P=q.currentNumAttributes||0;for(let le=F;le<P;le++)W.disableVertexAttribArray(le)}l.enableAttributes(W,t);for(const le of f)le.enableAttributes(W,t);T&&T.enableAttributes(W,t),M&&M.enableAttributes(W,t),z&&z.enableAttributes(W,t),l.bind(),l.setVertexAttribPointers(W,t,v);for(const le of f)le.bind(),le.setVertexAttribPointers(W,t,v);T&&(T.bind(),T.setVertexAttribPointers(W,t,v)),_&&_.bind(),M&&(M.bind(),M.setVertexAttribPointers(W,t,v)),z&&(z.bind(),z.setVertexAttribPointers(W,t,v)),q.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function co(p){const t=[];for(let l=0;l<p.length;l++){if(p[l]===null)continue;const f=p[l].split(" ");t.push(f.pop())}return t}class Il{constructor(t,l,f,_,v,T,M){const z=t.gl;this.program=z.createProgram();const P=co(f.staticAttributes),F=_?_.getBinderAttributes():[],q=P.concat(F),W=qs.prelude.staticUniforms?co(qs.prelude.staticUniforms):[],le=f.staticUniforms?co(f.staticUniforms):[],se=_?_.getBinderUniforms():[],ae=W.concat(le).concat(se),Te=[];for(const $e of ae)Te.indexOf($e)<0&&Te.push($e);const Ce=_?_.defines():[];T&&Ce.push("#define OVERDRAW_INSPECTOR;"),M&&Ce.push("#define TERRAIN3D;");const Re=Ce.concat(qs.prelude.fragmentSource,f.fragmentSource).join(`
`),de=Ce.concat(qs.prelude.vertexSource,f.vertexSource).join(`
`),Ue=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Ue,Re),z.compileShader(Ue),z.attachShader(this.program,Ue);const Oe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Oe,de),z.compileShader(Oe),z.attachShader(this.program,Oe),this.attributes={};const Je={};this.numAttributes=q.length;for(let $e=0;$e<this.numAttributes;$e++)q[$e]&&(z.bindAttribLocation(this.program,$e,q[$e]),this.attributes[q[$e]]=$e);z.linkProgram(this.program),z.deleteShader(Oe),z.deleteShader(Ue);for(let $e=0;$e<Te.length;$e++){const pt=Te[$e];if(pt&&!Je[pt]){const He=z.getUniformLocation(this.program,pt);He&&(Je[pt]=He)}}this.fixedUniforms=v(t,Je),this.terrainUniforms=(($e,pt)=>({u_depth:new o.Uniform1i($e,pt.u_depth),u_terrain:new o.Uniform1i($e,pt.u_terrain),u_terrain_dim:new o.Uniform1f($e,pt.u_terrain_dim),u_terrain_matrix:new o.UniformMatrix4f($e,pt.u_terrain_matrix),u_terrain_unpack:new o.Uniform4f($e,pt.u_terrain_unpack),u_terrain_offset:new o.Uniform1f($e,pt.u_terrain_offset),u_terrain_exaggeration:new o.Uniform1f($e,pt.u_terrain_exaggeration)}))(t,Je),this.binderUniforms=_?_.getUniforms(t,Je):[]}draw(t,l,f,_,v,T,M,z,P,F,q,W,le,se,ae,Te,Ce,Re){const de=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(_),t.setColorMode(v),t.setCullFace(T),z){t.activeTexture.set(de.TEXTURE2),de.bindTexture(de.TEXTURE_2D,z.depthTexture),t.activeTexture.set(de.TEXTURE3),de.bindTexture(de.TEXTURE_2D,z.texture);for(const Oe in this.terrainUniforms)this.terrainUniforms[Oe].set(z[Oe])}for(const Oe in this.fixedUniforms)this.fixedUniforms[Oe].set(M[Oe]);ae&&ae.setUniforms(t,this.binderUniforms,le,{zoom:se});let Ue=0;switch(l){case de.LINES:Ue=2;break;case de.TRIANGLES:Ue=3;break;case de.LINE_STRIP:Ue=1}for(const Oe of W.get()){const Je=Oe.vaos||(Oe.vaos={});(Je[P]||(Je[P]=new lo)).bind(t,this,F,ae?ae.getPaintVertexBuffers():[],q,Oe.vertexOffset,Te,Ce,Re),de.drawElements(l,Oe.primitiveLength*Ue,de.UNSIGNED_SHORT,Oe.primitiveOffset*Ue*2)}}}function kl(p,t,l){const f=1/rn(l,1,t.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,t.transform.tileZoom)/_,T=v*(l.tileID.canonical.x+l.tileID.wrap*_),M=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,M>>16],u_pixel_coord_lower:[65535&T,65535&M]}}const uo=(p,t,l,f)=>{const _=t.style.light,v=_.properties.get("position"),T=[v.x,v.y,v.z],M=o.create$1();_.properties.get("anchor")==="viewport"&&o.fromRotation(M,-t.transform.angle),o.transformMat3(T,T,M);const z=_.properties.get("color");return{u_matrix:p,u_lightpos:T,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+l,u_opacity:f}},Wc=(p,t,l,f,_,v,T)=>o.extend(uo(p,t,l,f),kl(v,t,T),{u_height_factor:-Math.pow(2,_.overscaledZ)/T.tileSize/8}),Ia=p=>({u_matrix:p}),ho=(p,t,l,f)=>o.extend(Ia(p),kl(l,t,f)),Tl=(p,t)=>({u_matrix:p,u_world:t}),Sl=(p,t,l,f,_)=>o.extend(ho(p,t,l,f),{u_world:_}),El=(p,t,l,f)=>{const _=p.transform;let v,T;if(f.paint.get("circle-pitch-alignment")==="map"){const M=rn(l,1,_.zoom);v=!0,T=[M,M]}else v=!1,T=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:T}},os=(p,t,l)=>{const f=rn(l,1,t.zoom),_=Math.pow(2,t.zoom-l.tileID.overscaledZ),v=l.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[t.pixelsToGLUnits[0]/(f*_),t.pixelsToGLUnits[1]/(f*_)],u_overscale_factor:v}},js=(p,t,l=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:l}),ks=p=>({u_matrix:p}),ka=(p,t,l,f)=>({u_matrix:p,u_extrude_scale:rn(t,1,l),u_intensity:f});function Ta(p,t){const l=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new o.MercatorCoordinate(0,f/l).toLngLat().lat,new o.MercatorCoordinate(0,(f+1)/l).toLngLat().lat]}const Ts=(p,t,l,f)=>{const _=p.transform;return{u_matrix:Xs(p,t,l,f),u_ratio:1/rn(t,1,_.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},fo=(p,t,l,f,_)=>o.extend(Ts(p,t,l,_),{u_image:0,u_image_height:f}),Sa=(p,t,l,f,_)=>{const v=p.transform,T=Hi(t,v);return{u_matrix:Xs(p,t,l,_),u_texsize:t.imageAtlasTexture.size,u_ratio:1/rn(t,1,v.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[T,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Zs=(p,t,l,f,_,v)=>{const T=p.lineAtlas,M=Hi(t,p.transform),z=l.layout.get("line-cap")==="round",P=T.getDash(f.from,z),F=T.getDash(f.to,z),q=P.width*_.fromScale,W=F.width*_.toScale;return o.extend(Ts(p,t,l,v),{u_patternscale_a:[M/q,-P.height/2],u_patternscale_b:[M/W,-F.height/2],u_sdfgamma:T.width/(256*Math.min(q,W)*p.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:F.y,u_mix:_.t})};function Hi(p,t){return 1/rn(p,1,t.tileZoom)}function Xs(p,t,l,f){return p.translatePosMatrix(f?f.posMatrix:t.tileID.posMatrix,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const Al=(p,t,l,f,_)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Cl(_.paint.get("raster-hue-rotate"))};var v,T};function Cl(p){p*=Math.PI/180;const t=Math.sin(p),l=Math.cos(p);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const mo=(p,t,l,f,_,v,T,M,z,P)=>{const F=_.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:F.width/F.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+z,u_pitch_with_map:+f,u_texsize:P,u_texture:0}},Ea=(p,t,l,f,_,v,T,M,z,P,F)=>{const q=_.transform;return o.extend(mo(p,t,l,f,_,v,T,M,z,P),{u_gamma_scale:f?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+F})},Ml=(p,t,l,f,_,v,T,M,z,P)=>o.extend(Ea(p,t,l,f,_,v,T,M,!0,z,!0),{u_texsize_icon:P,u_texture_icon:1}),Hc=(p,t,l)=>({u_matrix:p,u_opacity:t,u_color:l}),Kc=(p,t,l,f,_,v)=>o.extend(function(T,M,z,P){const F=z.imageManager.getPattern(T.from.toString()),q=z.imageManager.getPattern(T.to.toString()),{width:W,height:le}=z.imageManager.getPixelSize(),se=Math.pow(2,P.tileID.overscaledZ),ae=P.tileSize*Math.pow(2,z.transform.tileZoom)/se,Te=ae*(P.tileID.canonical.x+P.tileID.wrap*se),Ce=ae*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[W,le],u_mix:M.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/rn(P,1,z.transform.tileZoom),u_pixel_coord_upper:[Te>>16,Ce>>16],u_pixel_coord_lower:[65535&Te,65535&Ce]}}(f,v,l,_),{u_matrix:p,u_opacity:t}),po={fillExtrusion:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_lightpos:new o.Uniform3f(p,t.u_lightpos),u_lightintensity:new o.Uniform1f(p,t.u_lightintensity),u_lightcolor:new o.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,t.u_vertical_gradient),u_opacity:new o.Uniform1f(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_lightpos:new o.Uniform3f(p,t.u_lightpos),u_lightintensity:new o.Uniform1f(p,t.u_lightintensity),u_lightcolor:new o.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(p,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(p,t.u_height_factor),u_image:new o.Uniform1i(p,t.u_image),u_texsize:new o.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,t.u_scale),u_fade:new o.Uniform1f(p,t.u_fade),u_opacity:new o.Uniform1f(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_image:new o.Uniform1i(p,t.u_image),u_texsize:new o.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,t.u_scale),u_fade:new o.Uniform1f(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_world:new o.Uniform2f(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_world:new o.Uniform2f(p,t.u_world),u_image:new o.Uniform1i(p,t.u_image),u_texsize:new o.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(p,t.u_scale),u_fade:new o.Uniform1f(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new o.Uniform1f(p,t.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(p,t.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(p,t.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(p,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(p,t.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(p,t.u_extrude_scale),u_overscale_factor:new o.Uniform1f(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(p,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(p,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new o.UniformColor(p,t.u_color),u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_overlay:new o.Uniform1i(p,t.u_overlay),u_overlay_scale:new o.Uniform1f(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new o.Uniform1f(p,t.u_extrude_scale),u_intensity:new o.Uniform1f(p,t.u_intensity),u_matrix:new o.UniformMatrix4f(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_world:new o.Uniform2f(p,t.u_world),u_image:new o.Uniform1i(p,t.u_image),u_color_ramp:new o.Uniform1i(p,t.u_color_ramp),u_opacity:new o.Uniform1f(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_image:new o.Uniform1i(p,t.u_image),u_latrange:new o.Uniform2f(p,t.u_latrange),u_light:new o.Uniform2f(p,t.u_light),u_shadow:new o.UniformColor(p,t.u_shadow),u_highlight:new o.UniformColor(p,t.u_highlight),u_accent:new o.UniformColor(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_image:new o.Uniform1i(p,t.u_image),u_dimension:new o.Uniform2f(p,t.u_dimension),u_zoom:new o.Uniform1f(p,t.u_zoom),u_unpack:new o.Uniform4f(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_ratio:new o.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_ratio:new o.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,t.u_units_to_pixels),u_image:new o.Uniform1i(p,t.u_image),u_image_height:new o.Uniform1f(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_texsize:new o.Uniform2f(p,t.u_texsize),u_ratio:new o.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_image:new o.Uniform1i(p,t.u_image),u_units_to_pixels:new o.Uniform2f(p,t.u_units_to_pixels),u_scale:new o.Uniform3f(p,t.u_scale),u_fade:new o.Uniform1f(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_ratio:new o.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(p,t.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(p,t.u_patternscale_a),u_patternscale_b:new o.Uniform2f(p,t.u_patternscale_b),u_sdfgamma:new o.Uniform1f(p,t.u_sdfgamma),u_image:new o.Uniform1i(p,t.u_image),u_tex_y_a:new o.Uniform1f(p,t.u_tex_y_a),u_tex_y_b:new o.Uniform1f(p,t.u_tex_y_b),u_mix:new o.Uniform1f(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_tl_parent:new o.Uniform2f(p,t.u_tl_parent),u_scale_parent:new o.Uniform1f(p,t.u_scale_parent),u_buffer_scale:new o.Uniform1f(p,t.u_buffer_scale),u_fade_t:new o.Uniform1f(p,t.u_fade_t),u_opacity:new o.Uniform1f(p,t.u_opacity),u_image0:new o.Uniform1i(p,t.u_image0),u_image1:new o.Uniform1i(p,t.u_image1),u_brightness_low:new o.Uniform1f(p,t.u_brightness_low),u_brightness_high:new o.Uniform1f(p,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(p,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(p,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new o.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,t.u_size_t),u_size:new o.Uniform1f(p,t.u_size),u_camera_to_center_distance:new o.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,t.u_pitch),u_rotate_symbol:new o.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,t.u_fade_change),u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new o.Uniform1i(p,t.u_is_text),u_pitch_with_map:new o.Uniform1i(p,t.u_pitch_with_map),u_texsize:new o.Uniform2f(p,t.u_texsize),u_texture:new o.Uniform1i(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new o.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,t.u_size_t),u_size:new o.Uniform1f(p,t.u_size),u_camera_to_center_distance:new o.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,t.u_pitch),u_rotate_symbol:new o.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,t.u_fade_change),u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new o.Uniform1i(p,t.u_is_text),u_pitch_with_map:new o.Uniform1i(p,t.u_pitch_with_map),u_texsize:new o.Uniform2f(p,t.u_texsize),u_texture:new o.Uniform1i(p,t.u_texture),u_gamma_scale:new o.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new o.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(p,t.u_size_t),u_size:new o.Uniform1f(p,t.u_size),u_camera_to_center_distance:new o.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new o.Uniform1f(p,t.u_pitch),u_rotate_symbol:new o.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(p,t.u_fade_change),u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new o.Uniform1i(p,t.u_is_text),u_pitch_with_map:new o.Uniform1i(p,t.u_pitch_with_map),u_texsize:new o.Uniform2f(p,t.u_texsize),u_texsize_icon:new o.Uniform2f(p,t.u_texsize_icon),u_texture:new o.Uniform1i(p,t.u_texture),u_texture_icon:new o.Uniform1i(p,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_opacity:new o.Uniform1f(p,t.u_opacity),u_color:new o.UniformColor(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_opacity:new o.Uniform1f(p,t.u_opacity),u_image:new o.Uniform1i(p,t.u_image),u_pattern_tl_a:new o.Uniform2f(p,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(p,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(p,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(p,t.u_pattern_br_b),u_texsize:new o.Uniform2f(p,t.u_texsize),u_mix:new o.Uniform1f(p,t.u_mix),u_pattern_size_a:new o.Uniform2f(p,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(p,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(p,t.u_scale_a),u_scale_b:new o.Uniform1f(p,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_texture:new o.Uniform1i(p,t.u_texture)}),terrainDepth:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix)}),terrainCoords:(p,t)=>({u_matrix:new o.UniformMatrix4f(p,t.u_matrix),u_texture:new o.Uniform1i(p,t.u_texture),u_terrain_coords_id:new o.Uniform1f(p,t.u_terrain_coords_id)})};class go{constructor(t,l,f){this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _o={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yo{constructor(t,l,f,_){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let f=0;f<this.attributes.length;f++){const _=l.attributes[this.attributes[f].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,l,f){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],T=l.attributes[v.name];T!==void 0&&t.vertexAttribPointer(T,v.components,t[_o[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Di{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zl extends Di{getDefault(){return o.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yc extends Di{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ws extends Di{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Hs extends Di{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dl extends Di{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Yn extends Di{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class vo extends Di{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Aa extends Di{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ca extends Di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class bo extends Di{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class xo extends Di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ma extends Di{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class wo extends Di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class Io extends Di{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class za extends Di{getDefault(){return o.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Pl extends Di{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ll extends Di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class Ss extends Di{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Jc extends Di{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Qc extends Di{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class $c extends Di{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class eu extends Di{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tu extends Di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class iu extends Di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ko extends Di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Da extends Di{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class To extends Di{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class So extends Di{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Es extends Di{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Bl extends Di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Rl extends Di{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Pa extends Di{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class ls extends Pa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Fl extends Pa{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class As{constructor(t,l,f,_){this.context=t,this.width=l,this.height=f;const v=t.gl,T=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new ls(t,T),_&&(this.depthAttachment=new Fl(t,T)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}class Zi{constructor(t,l,f){this.blendFunction=t,this.blendColor=l,this.mask=f}}Zi.Replace=[1,0],Zi.disabled=new Zi(Zi.Replace,o.Color.transparent,[!1,!1,!1,!1]),Zi.unblended=new Zi(Zi.Replace,o.Color.transparent,[!0,!0,!0,!0]),Zi.alphaBlended=new Zi([1,771],o.Color.transparent,[!0,!0,!0,!0]);class Ol{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new zl(this),this.clearDepth=new Yc(this),this.clearStencil=new Ws(this),this.colorMask=new Hs(this),this.depthMask=new Dl(this),this.stencilMask=new Yn(this),this.stencilFunc=new vo(this),this.stencilOp=new Aa(this),this.stencilTest=new Ca(this),this.depthRange=new bo(this),this.depthTest=new xo(this),this.depthFunc=new Ma(this),this.blend=new wo(this),this.blendFunc=new Io(this),this.blendColor=new za(this),this.blendEquation=new Pl(this),this.cullFace=new Ll(this),this.cullFaceSide=new Ss(this),this.frontFace=new Jc(this),this.program=new Qc(this),this.activeTexture=new $c(this),this.viewport=new eu(this),this.bindFramebuffer=new tu(this),this.bindRenderbuffer=new iu(this),this.bindTexture=new ko(this),this.bindVertexBuffer=new Da(this),this.bindElementBuffer=new To(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new So(this),this.pixelStoreUnpack=new Es(this),this.pixelStoreUnpackPremultiplyAlpha=new Bl(this),this.pixelStoreUnpackFlipY=new Rl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new go(this,t,l)}createVertexBuffer(t,l,f){return new yo(this,t,l,f)}createRenderbuffer(t,l,f){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,t,l,f),this.bindRenderbuffer.set(null),v}createFramebuffer(t,l,f){return new As(this,t,l,f)}clear({color:t,depth:l}){const f=this.gl;let _=0;t&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){k(t.blendFunction,Zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Si{constructor(t,l,f){this.func=t,this.mask=l,this.range=f}}Si.ReadOnly=!1,Si.ReadWrite=!0,Si.disabled=new Si(519,Si.ReadOnly,[0,1]);const Pi=7680;class ji{constructor(t,l,f,_,v,T){this.test=t,this.ref=l,this.mask=f,this.fail=_,this.depthFail=v,this.pass=T}}ji.disabled=new ji({func:519,mask:0},0,0,Pi,Pi,Pi);class Ki{constructor(t,l,f){this.enable=t,this.mode=l,this.frontFace=f}}let Ks;function Cs(p,t,l,f,_,v,T){const M=p.context,z=M.gl,P=p.useProgram("collisionBox"),F=[];let q=0,W=0;for(let de=0;de<f.length;de++){const Ue=f[de],Oe=t.getTile(Ue),Je=Oe.getBucket(l);if(!Je)continue;let $e=Ue.posMatrix;_[0]===0&&_[1]===0||($e=p.translatePosMatrix(Ue.posMatrix,Oe,_,v));const pt=T?Je.textCollisionBox:Je.iconCollisionBox,He=Je.collisionCircleArray;if(He.length>0){const Dt=o.create(),kt=$e;o.mul(Dt,Je.placementInvProjMatrix,p.transform.glCoordMatrix),o.mul(Dt,Dt,Je.placementViewportMatrix),F.push({circleArray:He,circleOffset:W,transform:kt,invTransform:Dt,coord:Ue}),q+=He.length/4,W=q}pt&&P.draw(M,z.LINES,Si.disabled,ji.disabled,p.colorModeForRenderPass(),Ki.disabled,os($e,p.transform,Oe),p.style.terrain&&p.style.terrain.getTerrainData(Ue),l.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,p.transform.zoom,null,null,pt.collisionVertexBuffer)}if(!T||!F.length)return;const le=p.useProgram("collisionCircle"),se=new o.CollisionCircleLayoutArray;se.resize(4*q),se._trim();let ae=0;for(const de of F)for(let Ue=0;Ue<de.circleArray.length/4;Ue++){const Oe=4*Ue,Je=de.circleArray[Oe+0],$e=de.circleArray[Oe+1],pt=de.circleArray[Oe+2],He=de.circleArray[Oe+3];se.emplace(ae++,Je,$e,pt,He,0),se.emplace(ae++,Je,$e,pt,He,1),se.emplace(ae++,Je,$e,pt,He,2),se.emplace(ae++,Je,$e,pt,He,3)}(!Ks||Ks.length<2*q)&&(Ks=function(de){const Ue=2*de,Oe=new o.QuadTriangleArray;Oe.resize(Ue),Oe._trim();for(let Je=0;Je<Ue;Je++){const $e=6*Je;Oe.uint16[$e+0]=4*Je+0,Oe.uint16[$e+1]=4*Je+1,Oe.uint16[$e+2]=4*Je+2,Oe.uint16[$e+3]=4*Je+2,Oe.uint16[$e+4]=4*Je+3,Oe.uint16[$e+5]=4*Je+0}return Oe}(q));const Te=M.createIndexBuffer(Ks,!0),Ce=M.createVertexBuffer(se,o.collisionCircleLayout.members,!0);for(const de of F){const Ue={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(Re=p.transform).cameraToCenterDistance,u_viewport_size:[Re.width,Re.height]};le.draw(M,z.TRIANGLES,Si.disabled,ji.disabled,p.colorModeForRenderPass(),Ki.disabled,Ue,p.style.terrain&&p.style.terrain.getTerrainData(de.coord),l.id,Ce,Te,o.SegmentVector.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,p.transform.zoom,null,null,null)}var Re;Ce.destroy(),Te.destroy()}Ki.disabled=new Ki(!1,1029,2305),Ki.backCCW=new Ki(!0,1029,2305);const nu=o.identity(new Float32Array(16));function ru(p,t,l,f,_,v){const{horizontalAlign:T,verticalAlign:M}=o.getAnchorAlignment(p),z=-(T-.5)*t,P=-(M-.5)*l,F=o.evaluateVariableOffset(p,f);return new o.pointGeometry((z/_+F[0])*v,(P/_+F[1])*v)}function Vl(p,t,l,f,_,v,T,M,z,P,F){const q=p.text.placedSymbolArray,W=p.text.dynamicLayoutVertexArray,le=p.icon.dynamicLayoutVertexArray,se={};W.clear();for(let ae=0;ae<q.length;ae++){const Te=q.get(ae),Ce=p.allowVerticalPlacement&&!Te.placedOrientation,Re=Te.hidden||!Te.crossTileID||Ce?null:f[Te.crossTileID];if(Re){const de=new o.pointGeometry(Te.anchorX,Te.anchorY),Ue=ki(de,l?T:v,F),Oe=Ei(_.cameraToCenterDistance,Ue.signedDistanceFromCamera);let Je=o.evaluateSizeForFeature(p.textSizeData,z,Te)*Oe/o.ONE_EM;l&&(Je*=p.tilePixelRatio/M);const{width:$e,height:pt,anchor:He,textOffset:Dt,textBoxScale:kt}=Re,Pt=ru(He,$e,pt,Dt,kt,Je),ui=l?ki(de.add(Pt),v,F).point:Ue.point.add(t?Pt.rotate(-_.angle):Pt),yi=p.allowVerticalPlacement&&Te.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Yt=0;Yt<Te.numGlyphs;Yt++)o.addDynamicAttributes(W,ui,yi);P&&Te.associatedIconIndex>=0&&(se[Te.associatedIconIndex]={shiftedAnchor:ui,angle:yi})}else ri(Te.numGlyphs,W)}if(P){le.clear();const ae=p.icon.placedSymbolArray;for(let Te=0;Te<ae.length;Te++){const Ce=ae.get(Te);if(Ce.hidden)ri(Ce.numGlyphs,le);else{const Re=se[Te];if(Re)for(let de=0;de<Ce.numGlyphs;de++)o.addDynamicAttributes(le,Re.shiftedAnchor,Re.angle);else ri(Ce.numGlyphs,le)}}p.icon.dynamicLayoutVertexBuffer.updateData(le)}p.text.dynamicLayoutVertexBuffer.updateData(W)}function su(p,t,l){return l.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function La(p,t,l,f,_,v,T,M,z,P,F,q){const W=p.context,le=W.gl,se=p.transform,ae=M==="map",Te=z==="map",Ce=M!=="viewport"&&l.layout.get("symbol-placement")!=="point",Re=ae&&!Te&&!Ce,de=!l.layout.get("symbol-sort-key").isConstant();let Ue=!1;const Oe=p.depthModeForSublayer(0,Si.ReadOnly),Je=l.layout.get("text-variable-anchor"),$e=[];for(const pt of f){const He=t.getTile(pt),Dt=He.getBucket(l);if(!Dt)continue;const kt=_?Dt.text:Dt.icon;if(!kt||!kt.segments.get().length)continue;const Pt=kt.programConfigurations.get(l.id),ui=_||Dt.sdfIcons,yi=_?Dt.textSizeData:Dt.iconSizeData,Yt=Te||se.pitch!==0,Ri=p.useProgram(su(ui,_,Dt),Pt),Fi=o.evaluateSizeForZoom(yi,se.zoom),Ai=p.style.terrain&&p.style.terrain.getTerrainData(pt);let Mi,Oi,vn,Er,gr=[0,0],Ar=null;if(_){if(Oi=He.glyphAtlasTexture,vn=le.LINEAR,Mi=He.glyphAtlasTexture.size,Dt.iconsInText){gr=He.imageAtlasTexture.size,Ar=He.imageAtlasTexture;const ur=yi.kind==="composite"||yi.kind==="camera";Er=Yt||p.options.rotating||p.options.zooming||ur?le.LINEAR:le.NEAREST}}else{const ur=l.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear;Oi=He.imageAtlasTexture,vn=ui||p.options.rotating||p.options.zooming||ur||Yt?le.LINEAR:le.NEAREST,Mi=He.imageAtlasTexture.size}const ns=rn(He,1,p.transform.zoom),cr=Lr(pt.posMatrix,Te,ae,p.transform,ns),qn=Un(pt.posMatrix,Te,ae,p.transform,ns),Vr=Je&&Dt.hasTextData(),Ga=l.layout.get("icon-text-fit")!=="none"&&Vr&&Dt.hasIconData();if(Ce){const ur=p.style.terrain?(Uo,Bs)=>p.style.terrain.getElevation(pt,Uo,Bs):null,fs=l.layout.get("text-rotation-alignment")==="map";kn(Dt,pt.posMatrix,p,_,cr,qn,Te,P,fs,ur)}const pn=p.translatePosMatrix(pt.posMatrix,He,v,T),bi=Ce||_&&Je||Ga?nu:cr,Bi=p.translatePosMatrix(qn,He,v,T,!0),bn=ui&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xn;xn=ui?Dt.iconsInText?Ml(yi.kind,Fi,Re,Te,p,pn,bi,Bi,Mi,gr):Ea(yi.kind,Fi,Re,Te,p,pn,bi,Bi,_,Mi,!0):mo(yi.kind,Fi,Re,Te,p,pn,bi,Bi,_,Mi);const Ji={program:Ri,buffers:kt,uniformValues:xn,atlasTexture:Oi,atlasTextureIcon:Ar,atlasInterpolation:vn,atlasInterpolationIcon:Er,isSDF:ui,hasHalo:bn};if(de&&Dt.canOverlap){Ue=!0;const ur=kt.segments.get();for(const fs of ur)$e.push({segments:new o.SegmentVector([fs]),sortKey:fs.sortKey,state:Ji,terrainData:Ai})}else $e.push({segments:kt.segments,sortKey:0,state:Ji,terrainData:Ai})}Ue&&$e.sort((pt,He)=>pt.sortKey-He.sortKey);for(const pt of $e){const He=pt.state;if(W.activeTexture.set(le.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,le.CLAMP_TO_EDGE),He.atlasTextureIcon&&(W.activeTexture.set(le.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),He.isSDF){const Dt=He.uniformValues;He.hasHalo&&(Dt.u_is_halo=1,Ys(He.buffers,pt.segments,l,p,He.program,Oe,F,q,Dt,pt.terrainData)),Dt.u_is_halo=0}Ys(He.buffers,pt.segments,l,p,He.program,Oe,F,q,He.uniformValues,pt.terrainData)}}function Ys(p,t,l,f,_,v,T,M,z,P){const F=f.context;_.draw(F,F.gl.TRIANGLES,v,T,M,Ki.disabled,z,P,l.id,p.layoutVertexBuffer,p.indexBuffer,t,l.paint,f.transform.zoom,p.programConfigurations.get(l.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Js(p,t,l,f,_,v,T){const M=p.context.gl,z=l.paint.get("fill-pattern"),P=z&&z.constantOr(1),F=l.getCrossfadeParameters();let q,W,le,se,ae;T?(W=P&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",q=M.LINES):(W=P?"fillPattern":"fill",q=M.TRIANGLES);for(const Te of f){const Ce=t.getTile(Te);if(P&&!Ce.patternsLoaded())continue;const Re=Ce.getBucket(l);if(!Re)continue;const de=Re.programConfigurations.get(l.id),Ue=p.useProgram(W,de),Oe=p.style.terrain&&p.style.terrain.getTerrainData(Te);P&&(p.context.activeTexture.set(M.TEXTURE0),Ce.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),de.updatePaintBuffers(F));const Je=z.constantOr(null);if(Je&&Ce.imageAtlas){const He=Ce.imageAtlas,Dt=He.patternPositions[Je.to.toString()],kt=He.patternPositions[Je.from.toString()];Dt&&kt&&de.setConstantPatternPositions(Dt,kt)}const $e=Oe?Te:null,pt=p.translatePosMatrix($e?$e.posMatrix:Te.posMatrix,Ce,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(T){se=Re.indexBuffer2,ae=Re.segments2;const He=[M.drawingBufferWidth,M.drawingBufferHeight];le=W==="fillOutlinePattern"&&P?Sl(pt,p,F,Ce,He):Tl(pt,He)}else se=Re.indexBuffer,ae=Re.segments,le=P?ho(pt,p,F,Ce):Ia(pt);Ue.draw(p.context,q,_,p.stencilModeForClipping(Te),v,Ki.disabled,le,Oe,l.id,Re.layoutVertexBuffer,se,ae,l.paint,p.transform.zoom,de)}}function Qs(p,t,l,f,_,v,T){const M=p.context,z=M.gl,P=l.paint.get("fill-extrusion-pattern"),F=P.constantOr(1),q=l.getCrossfadeParameters(),W=l.paint.get("fill-extrusion-opacity");for(const le of f){const se=t.getTile(le),ae=se.getBucket(l);if(!ae)continue;const Te=p.style.terrain&&p.style.terrain.getTerrainData(le),Ce=ae.programConfigurations.get(l.id),Re=p.useProgram(F?"fillExtrusionPattern":"fillExtrusion",Ce);F&&(p.context.activeTexture.set(z.TEXTURE0),se.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ce.updatePaintBuffers(q));const de=P.constantOr(null);if(de&&se.imageAtlas){const $e=se.imageAtlas,pt=$e.patternPositions[de.to.toString()],He=$e.patternPositions[de.from.toString()];pt&&He&&Ce.setConstantPatternPositions(pt,He)}const Ue=p.translatePosMatrix(le.posMatrix,se,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Oe=l.paint.get("fill-extrusion-vertical-gradient"),Je=F?Wc(Ue,p,Oe,W,le,q,se):uo(Ue,p,Oe,W);Re.draw(M,M.gl.TRIANGLES,_,v,T,Ki.backCCW,Je,Te,l.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,l.paint,p.transform.zoom,Ce,p.style.terrain&&ae.centroidVertexBuffer)}}function Eo(p,t,l,f,_,v,T){const M=p.context,z=M.gl,P=l.fbo;if(!P)return;const F=p.useProgram("hillshade"),q=p.style.terrain&&p.style.terrain.getTerrainData(t);M.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,P.colorAttachment.get()),F.draw(M,z.TRIANGLES,_,v,T,Ki.disabled,((W,le,se,ae)=>{const Te=se.paint.get("hillshade-shadow-color"),Ce=se.paint.get("hillshade-highlight-color"),Re=se.paint.get("hillshade-accent-color");let de=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(de-=W.transform.angle);const Ue=!W.options.moving;return{u_matrix:ae?ae.posMatrix:W.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Ue),u_image:0,u_latrange:Ta(0,le.tileID),u_light:[se.paint.get("hillshade-exaggeration"),de],u_shadow:Te,u_highlight:Ce,u_accent:Re}})(p,l,f,q?t:null),q,f.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function Nl(p,t,l,f,_,v){const T=p.context,M=T.gl,z=t.dem;if(z&&z.data){const P=z.dim,F=z.stride,q=z.getPixels();if(T.activeTexture.set(M.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(F),t.demTexture){const le=t.demTexture;le.update(q,{premultiply:!1}),le.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else t.demTexture=new U(T,q,M.RGBA,{premultiply:!1}),t.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);T.activeTexture.set(M.TEXTURE0);let W=t.fbo;if(!W){const le=new U(T,{width:P,height:P,data:null},M.RGBA);le.bind(M.LINEAR,M.CLAMP_TO_EDGE),W=t.fbo=T.createFramebuffer(P,P,!0),W.colorAttachment.set(le.texture)}T.bindFramebuffer.set(W.framebuffer),T.viewport.set([0,0,P,P]),p.useProgram("hillshadePrepare").draw(T,M.TRIANGLES,f,_,v,Ki.disabled,((le,se)=>{const ae=se.stride,Te=o.create();return o.ortho(Te,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Te,Te,[0,-o.EXTENT,0]),{u_matrix:Te,u_image:1,u_dimension:[ae,ae],u_zoom:le.overscaledZ,u_unpack:se.getUnpackVector()}})(t.tileID,z),null,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ba(p,t,l,f,_,v){const T=f.paint.get("raster-fade-duration");if(!v&&T>0){const M=o.exported.now(),z=(M-p.timeAdded)/T,P=t?(M-t.timeAdded)/T:-1,F=l.getSource(),q=_.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),W=!t||Math.abs(t.tileID.overscaledZ-q)>Math.abs(p.tileID.overscaledZ-q),le=W&&p.refreshedUponExpiration?1:o.clamp(W?z:1-P,0,1);return p.refreshedUponExpiration&&z>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}const Ra=new o.Color(1,0,0,1),pr=new o.Color(0,1,0,1),Ul=new o.Color(0,0,1,1),Ao=new o.Color(1,0,1,1),Gl=new o.Color(0,1,1,1);function cs(p,t,l,f){Ms(p,0,t+l/2,p.transform.width,l,f)}function $s(p,t,l,f){Ms(p,t-l/2,0,l,p.transform.height,f)}function Ms(p,t,l,f,_,v){const T=p.context,M=T.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*p.pixelRatio,l*p.pixelRatio,f*p.pixelRatio,_*p.pixelRatio),T.clear({color:v}),M.disable(M.SCISSOR_TEST)}function au(p,t,l){const f=p.context,_=f.gl,v=l.posMatrix,T=p.useProgram("debug"),M=Si.disabled,z=ji.disabled,P=p.colorModeForRenderPass(),F="$debug",q=p.style.terrain&&p.style.terrain.getTerrainData(l);f.activeTexture.set(_.TEXTURE0),p.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const W=t.getTileByID(l.key).latestRawTileData,le=Math.floor((W&&W.byteLength||0)/1024),se=t.getTile(l).tileSize,ae=512/Math.min(se,512)*(l.overscaledZ/p.transform.zoom)*.5;let Te=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Te+=` => ${l.overscaledZ}`),function(Ce,Re){Ce.initDebugOverlayCanvas();const de=Ce.debugOverlayCanvas,Ue=Ce.context.gl,Oe=Ce.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,de.width,de.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(Re,5,5),Oe.strokeText(Re,5,5),Ce.debugOverlayTexture.update(de),Ce.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(p,`${Te} ${le}kB`),T.draw(f,_.TRIANGLES,M,z,Zi.alphaBlended,Ki.disabled,js(v,o.Color.transparent,ae),null,F,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),T.draw(f,_.LINE_STRIP,M,z,P,Ki.disabled,js(v,o.Color.red),q,F,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Fa(p,t,l){const f=p.context,_=f.gl,v=p.colorModeForRenderPass(),T=new Si(_.LEQUAL,Si.ReadWrite,p.depthRangeFor3D),M=p.useProgram("terrain"),z=t.getTerrainMesh(),P=t.getTerrainData(l.tileID);f.bindFramebuffer.set(null),f.viewport.set([0,0,p.width,p.height]),f.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const F=p.transform.calculatePosMatrix(l.tileID.toUnwrapped());M.draw(f,_.TRIANGLES,T,ji.disabled,v,Ki.backCCW,{u_matrix:F,u_texture:0},P,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}function ql(p,t,l,f){const _=p.context,v=l.tileSize*t.qualityFactor;l.textures[f]||(l.textures[f]=p.getTileTexture(v)||new U(_,{width:v,height:v,data:null},_.gl.RGBA),l.textures[f].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),f===0&&t.sourceCache.renderHistory.unshift(l.tileID.key));const T=t.getRTTFramebuffer();T.colorAttachment.set(l.textures[f].texture),_.bindFramebuffer.set(T.framebuffer),_.viewport.set([0,0,v,v])}class jl{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,l=t.terrain;for(const f in t.sourceCaches){this._coordsDescendingInv[f]={};const _=t.sourceCaches[f].getVisibleCoordinates();for(const v of _){const T=l.sourceCache.getTerrainCoords(v);for(const M in T)this._coordsDescendingInv[f][M]||(this._coordsDescendingInv[f][M]=[]),this._coordsDescendingInv[f][M].push(T[M])}}for(const f of t._order){const _=t._layers[f],v=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const T in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][T]=this._coordsDescendingInv[v][T].map(M=>M.key).sort().join()}}return this._renderableTiles.forEach(f=>{for(const _ in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[_][f.tileID.key];v&&v!==f.textureCoords[_]&&f.clearTextures(this.painter),l.needsRerender(_,f.tileID)&&f.clearTextures(this.painter)}this._rerender[f.tileID.key]=!f.textures.length}),l.clearRerenderCache(),l.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const l=t.type,f=this.painter,_=f.style._order,v=f.currentLayer,T=v+1===_.length;if(this._renderToTexture[l]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(_[v]),!T))return!0;if(this._renderToTexture[this._prevType]||l==="hillshade"||this._renderToTexture[l]&&T){this._prevType=l;const M=this._stacks.length-1,z=this._stacks[M]||[];for(const P of this._renderableTiles){if(ql(f,f.style.terrain,P,M),this._rerender[P.tileID.key]){f.context.clear({color:o.Color.transparent});for(let F=0;F<z.length;F++){const q=f.style._layers[z[F]],W=q.source?this._coordsDescendingInv[q.source][P.tileID.key]:[P.tileID];f._renderTileClippingMasks(q,W),f.renderLayer(f,f.style.sourceCaches[q.source],q,W),q.source&&(P.textureCoords[q.source]=this._coordsDescendingInvStr[q.source][P.tileID.key])}}Fa(f,f.style.terrain,P)}if(l==="hillshade"){this._stacks.push([_[v]]);for(const P of this._renderableTiles){const F=this._coordsDescendingInv[t.source][P.tileID.key];ql(f,f.style.terrain,P,this._stacks.length-1),f.context.clear({color:o.Color.transparent}),f._renderTileClippingMasks(t,F),f.renderLayer(f,f.style.sourceCaches[t.source],t,F),Fa(f,f.style.terrain,P)}return!0}return this._renderToTexture[l]}return!1}}const ea={symbol:function(p,t,l,f,_){if(p.renderPass!=="translucent")return;const v=ji.disabled,T=p.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(M,z,P,F,q,W,le){const se=z.transform,ae=q==="map",Te=W==="map";for(const Ce of M){const Re=F.getTile(Ce),de=Re.getBucket(P);if(!de||!de.text||!de.text.segments.get().length)continue;const Ue=o.evaluateSizeForZoom(de.textSizeData,se.zoom),Oe=rn(Re,1,z.transform.zoom),Je=Lr(Ce.posMatrix,Te,ae,z.transform,Oe),$e=P.layout.get("icon-text-fit")!=="none"&&de.hasIconData();if(Ue){const pt=Math.pow(2,se.zoom-Re.tileID.overscaledZ);Vl(de,ae,Te,le,se,Je,Ce.posMatrix,pt,Ue,$e,z.style.terrain?(He,Dt)=>z.style.terrain.getElevation(Ce,He,Dt):null)}}}(f,p,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&La(p,t,l,f,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,T),l.paint.get("text-opacity").constantOr(1)!==0&&La(p,t,l,f,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,T),t.map.showCollisionBoxes&&(Cs(p,t,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Cs(p,t,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(p,t,l,f){if(p.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),M=!l.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(v.constantOr(1)===0||T.constantOr(1)===0))return;const z=p.context,P=z.gl,F=p.depthModeForSublayer(0,Si.ReadOnly),q=ji.disabled,W=p.colorModeForRenderPass(),le=[];for(let se=0;se<f.length;se++){const ae=f[se],Te=t.getTile(ae),Ce=Te.getBucket(l);if(!Ce)continue;const Re=Ce.programConfigurations.get(l.id),de=p.useProgram("circle",Re),Ue=Ce.layoutVertexBuffer,Oe=Ce.indexBuffer,Je=p.style.terrain&&p.style.terrain.getTerrainData(ae),$e={programConfiguration:Re,program:de,layoutVertexBuffer:Ue,indexBuffer:Oe,uniformValues:El(p,ae,Te,l),terrainData:Je};if(M){const pt=Ce.segments.get();for(const He of pt)le.push({segments:new o.SegmentVector([He]),sortKey:He.sortKey,state:$e})}else le.push({segments:Ce.segments,sortKey:0,state:$e})}M&&le.sort((se,ae)=>se.sortKey-ae.sortKey);for(const se of le){const{programConfiguration:ae,program:Te,layoutVertexBuffer:Ce,indexBuffer:Re,uniformValues:de,terrainData:Ue}=se.state;Te.draw(z,P.TRIANGLES,F,q,W,Ki.disabled,de,Ue,l.id,Ce,Re,se.segments,l.paint,p.transform.zoom,ae)}},heatmap:function(p,t,l,f){if(l.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const _=p.context,v=_.gl,T=ji.disabled,M=new Zi([v.ONE,v.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(z,P,F){const q=z.gl;z.activeTexture.set(q.TEXTURE1),z.viewport.set([0,0,P.width/4,P.height/4]);let W=F.heatmapFbo;if(W)q.bindTexture(q.TEXTURE_2D,W.colorAttachment.get()),z.bindFramebuffer.set(W.framebuffer);else{const le=q.createTexture();q.bindTexture(q.TEXTURE_2D,le),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),W=F.heatmapFbo=z.createFramebuffer(P.width/4,P.height/4,!1),function(se,ae,Te,Ce){const Re=se.gl;Re.texImage2D(Re.TEXTURE_2D,0,Re.RGBA,ae.width/4,ae.height/4,0,Re.RGBA,se.extRenderToTextureHalfFloat?se.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),Ce.colorAttachment.set(Te)}(z,P,le,W)}})(_,p,l),_.clear({color:o.Color.transparent});for(let z=0;z<f.length;z++){const P=f[z];if(t.hasRenderableParent(P))continue;const F=t.getTile(P),q=F.getBucket(l);if(!q)continue;const W=q.programConfigurations.get(l.id),le=p.useProgram("heatmap",W),{zoom:se}=p.transform;le.draw(_,v.TRIANGLES,Si.disabled,T,M,Ki.disabled,ka(P.posMatrix,F,se,l.paint.get("heatmap-intensity")),null,l.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,l.paint,p.transform.zoom,W)}_.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(_,v){const T=_.context,M=T.gl,z=v.heatmapFbo;if(!z)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1);let P=v.colorRampTexture;P||(P=v.colorRampTexture=new U(T,v.colorRamp,M.RGBA)),P.bind(M.LINEAR,M.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(T,M.TRIANGLES,Si.disabled,ji.disabled,_.colorModeForRenderPass(),Ki.disabled,((F,q,W,le)=>{const se=o.create();o.ortho(se,0,F.width,F.height,0,0,1);const ae=F.context.gl;return{u_matrix:se,u_world:[ae.drawingBufferWidth,ae.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}})(_,v),null,v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(p,l))},line:function(p,t,l,f){if(p.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const T=p.depthModeForSublayer(0,Si.ReadOnly),M=p.colorModeForRenderPass(),z=l.paint.get("line-dasharray"),P=l.paint.get("line-pattern"),F=P.constantOr(1),q=l.paint.get("line-gradient"),W=l.getCrossfadeParameters(),le=F?"linePattern":z?"lineSDF":q?"lineGradient":"line",se=p.context,ae=se.gl;let Te=!0;for(const Ce of f){const Re=t.getTile(Ce);if(F&&!Re.patternsLoaded())continue;const de=Re.getBucket(l);if(!de)continue;const Ue=de.programConfigurations.get(l.id),Oe=p.context.program.get(),Je=p.useProgram(le,Ue),$e=Te||Je.program!==Oe,pt=p.style.terrain&&p.style.terrain.getTerrainData(Ce),He=P.constantOr(null);if(He&&Re.imageAtlas){const Pt=Re.imageAtlas,ui=Pt.patternPositions[He.to.toString()],yi=Pt.patternPositions[He.from.toString()];ui&&yi&&Ue.setConstantPatternPositions(ui,yi)}const Dt=pt?Ce:null,kt=F?Sa(p,Re,l,W,Dt):z?Zs(p,Re,l,z,W,Dt):q?fo(p,Re,l,de.lineClipsArray.length,Dt):Ts(p,Re,l,Dt);if(F)se.activeTexture.set(ae.TEXTURE0),Re.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ue.updatePaintBuffers(W);else if(z&&($e||p.lineAtlas.dirty))se.activeTexture.set(ae.TEXTURE0),p.lineAtlas.bind(se);else if(q){const Pt=de.gradients[l.id];let ui=Pt.texture;if(l.gradientVersion!==Pt.version){let yi=256;if(l.stepInterpolant){const Yt=t.getSource().maxzoom,Ri=Ce.canonical.z===Yt?Math.ceil(1<<p.transform.maxZoom-Ce.canonical.z):1;yi=o.clamp(o.nextPowerOfTwo(de.maxLineLength/o.EXTENT*1024*Ri),256,se.maxTextureSize)}Pt.gradient=o.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:yi,image:Pt.gradient||void 0,clips:de.lineClipsArray}),Pt.texture?Pt.texture.update(Pt.gradient):Pt.texture=new U(se,Pt.gradient,ae.RGBA),Pt.version=l.gradientVersion,ui=Pt.texture}se.activeTexture.set(ae.TEXTURE0),ui.bind(l.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Je.draw(se,ae.TRIANGLES,T,p.stencilModeForClipping(Ce),M,Ki.disabled,kt,pt,l.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,l.paint,p.transform.zoom,Ue,de.layoutVertexBuffer2),Te=!1}},fill:function(p,t,l,f){const _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const T=p.colorModeForRenderPass(),M=l.paint.get("fill-pattern"),z=p.opaquePassEnabledForLayer()&&!M.constantOr(1)&&_.constantOr(o.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===z){const P=p.depthModeForSublayer(1,p.renderPass==="opaque"?Si.ReadWrite:Si.ReadOnly);Js(p,t,l,f,P,T,!1)}if(p.renderPass==="translucent"&&l.paint.get("fill-antialias")){const P=p.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Si.ReadOnly);Js(p,t,l,f,P,T,!0)}},"fill-extrusion":function(p,t,l,f){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&p.renderPass==="translucent"){const v=new Si(p.context.gl.LEQUAL,Si.ReadWrite,p.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Qs(p,t,l,f,v,ji.disabled,Zi.disabled),Qs(p,t,l,f,v,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const T=p.colorModeForRenderPass();Qs(p,t,l,f,v,ji.disabled,T)}}},hillshade:function(p,t,l,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const _=p.context,v=p.depthModeForSublayer(0,Si.ReadOnly),T=p.colorModeForRenderPass(),[M,z]=p.renderPass==="translucent"?p.stencilConfigForOverlap(f):[{},f];for(const P of z){const F=t.getTile(P);F.needsHillshadePrepare!==void 0&&F.needsHillshadePrepare&&p.renderPass==="offscreen"?Nl(p,F,l,v,ji.disabled,T):p.renderPass==="translucent"&&Eo(p,P,F,l,v,M[P.overscaledZ],T)}_.viewport.set([0,0,p.width,p.height])},raster:function(p,t,l,f){if(p.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!f.length)return;const _=p.context,v=_.gl,T=t.getSource(),M=p.useProgram("raster"),z=p.colorModeForRenderPass(),[P,F]=T instanceof qe?[{},f]:p.stencilConfigForOverlap(f),q=F[F.length-1].overscaledZ,W=!p.options.moving;for(const le of F){const se=p.depthModeForSublayer(le.overscaledZ-q,l.paint.get("raster-opacity")===1?Si.ReadWrite:Si.ReadOnly,v.LESS),ae=t.getTile(le);ae.registerFadeDuration(l.paint.get("raster-fade-duration"));const Te=t.findLoadedParent(le,0),Ce=Ba(ae,Te,t,l,p.transform,p.style.terrain);let Re,de;const Ue=l.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;_.activeTexture.set(v.TEXTURE0),ae.texture.bind(Ue,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(v.TEXTURE1),Te?(Te.texture.bind(Ue,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,Te.tileID.overscaledZ-ae.tileID.overscaledZ),de=[ae.tileID.canonical.x*Re%1,ae.tileID.canonical.y*Re%1]):ae.texture.bind(Ue,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const Oe=p.style.terrain&&p.style.terrain.getTerrainData(le),Je=Oe?le:null,$e=Je?Je.posMatrix:p.transform.calculatePosMatrix(le.toUnwrapped(),W),pt=Al($e,de||[0,0],Re||1,Ce,l);T instanceof qe?M.draw(_,v.TRIANGLES,se,ji.disabled,z,Ki.disabled,pt,Oe,l.id,T.boundsBuffer,p.quadTriangleIndexBuffer,T.boundsSegments):M.draw(_,v.TRIANGLES,se,P[le.overscaledZ],z,Ki.disabled,pt,Oe,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,t,l,f){const _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;const T=p.context,M=T.gl,z=p.transform,P=z.tileSize,F=l.paint.get("background-pattern");if(p.isPatternMissing(F))return;const q=!F&&_.a===1&&v===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==q)return;const W=ji.disabled,le=p.depthModeForSublayer(0,q==="opaque"?Si.ReadWrite:Si.ReadOnly),se=p.colorModeForRenderPass(),ae=p.useProgram(F?"backgroundPattern":"background"),Te=f||z.coveringTiles({tileSize:P,terrain:p.style.terrain});F&&(T.activeTexture.set(M.TEXTURE0),p.imageManager.bind(p.context));const Ce=l.getCrossfadeParameters();for(const Re of Te){const de=f?Re.posMatrix:p.transform.calculatePosMatrix(Re.toUnwrapped()),Ue=F?Kc(de,v,p,F,{tileID:Re,tileSize:P},Ce):Hc(de,v,_),Oe=p.style.terrain&&p.style.terrain.getTerrainData(Re);ae.draw(T,M.TRIANGLES,le,W,se,Ki.disabled,Ue,Oe,l.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}},debug:function(p,t,l){for(let f=0;f<l.length;f++)au(p,t,l[f])},custom:function(p,t,l){const f=p.context,_=l.implementation;if(p.renderPass==="offscreen"){const v=_.prerender;v&&(p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),v.call(_,f.gl,p.transform.customLayerMatrix()),f.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),f.setStencilMode(ji.disabled);const v=_.renderingMode==="3d"?new Si(p.context.gl.LEQUAL,Si.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Si.ReadOnly);f.setDepthMode(v),_.render(f.gl,p.transform.customLayerMatrix()),f.setDirty(),p.setBaseState(),f.bindFramebuffer.set(null)}}};class Co{constructor(t,l){this.context=new Ol(t),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.create(),renderTime:0},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new At,this.gpuTimers={}}resize(t,l,f){if(this.width=t*f,this.height=l*f,this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const t=this.context,l=new o.PosArray;l.emplaceBack(0,0),l.emplaceBack(o.EXTENT,0),l.emplaceBack(0,o.EXTENT),l.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(l,oi.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const f=new o.PosArray;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(f,oi.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _=new o.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(o.EXTENT,0,o.EXTENT,0),_.emplaceBack(0,o.EXTENT,0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(_,Ke.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,oi.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const T=new o.LineStripIndexArray;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(T);const M=new o.TriangleIndexArray;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new U(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const z=this.context.gl;this.stencilClearMode=new ji({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=o.create();o.ortho(f,0,this.width,this.height,0,0,1),o.scale(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,l.TRIANGLES,Si.disabled,this.stencilClearMode,Zi.disabled,Ki.disabled,ks(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!l||!l.length)return;this.currentStencilSource=t.source;const f=this.context,_=f.gl;this.nextStencilID+l.length>256&&this.clearStencil(),f.setColorMode(Zi.disabled),f.setDepthMode(Si.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of l){const M=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,z=this.style.terrain&&this.style.terrain.getTerrainData(T);v.draw(f,_.TRIANGLES,Si.disabled,new ji({func:_.ALWAYS,mask:0},M,255,_.KEEP,_.KEEP,_.REPLACE),Zi.disabled,Ki.disabled,ks(T.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new ji({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){const l=this.context.gl;return new ji({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,f=t.sort((T,M)=>M.overscaledZ-T.overscaledZ),_=f[f.length-1].overscaledZ,v=f[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const T={};for(let M=0;M<v;M++)T[M+_]=new ji({func:l.GEQUAL,mask:255},M+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[T,f]}return[{[_]:ji.disabled},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Zi([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Zi.unblended:Zi.alphaBlended}depthModeForSublayer(t,l,f){if(!this.opaquePassEnabledForLayer())return Si.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Si(f||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const f=this.style._order,_=this.style.sourceCaches,v=this.style.terrain&&new jl(this);for(const P in _){const F=_[P];F.used&&F.prepare(this.context)}const T={},M={},z={};for(const P in _){const F=_[P];T[P]=F.getVisibleCoordinates(),M[P]=T[P].slice().reverse(),z[P]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<f.length;P++)if(this.style._layers[f[P]].is3D()){this.opaquePassCutoff=P;break}if(v){this.opaquePassCutoff=0;const P=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!o.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(o.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,q){const W=F.context,le=W.gl,se=Zi.unblended,ae=new Si(le.LEQUAL,Si.ReadWrite,[0,1]),Te=q.getTerrainMesh(),Ce=q.sourceCache.getRenderableTiles(),Re=F.useProgram("terrainDepth");W.bindFramebuffer.set(q.getFramebuffer("depth").framebuffer),W.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),W.clear({color:o.Color.transparent,depth:1});for(const de of Ce){const Ue=q.getTerrainData(de.tileID),Oe=F.transform.calculatePosMatrix(de.tileID.toUnwrapped());Re.draw(W,le.TRIANGLES,ae,ji.disabled,se,Ki.backCCW,{u_matrix:Oe},Ue,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments)}W.bindFramebuffer.set(null),W.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain),function(F,q){const W=F.context,le=W.gl,se=Zi.unblended,ae=new Si(le.LEQUAL,Si.ReadWrite,[0,1]),Te=q.getTerrainMesh(),Ce=q.getCoordsTexture(),Re=q.sourceCache.getRenderableTiles(),de=F.useProgram("terrainCoords");W.bindFramebuffer.set(q.getFramebuffer("coords").framebuffer),W.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),W.clear({color:o.Color.transparent,depth:1}),q.coordsIndex=[];for(const Ue of Re){const Oe=q.getTerrainData(Ue.tileID);W.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_2D,Ce.texture);const Je=F.transform.calculatePosMatrix(Ue.tileID.toUnwrapped());de.draw(W,le.TRIANGLES,ae,ji.disabled,se,Ki.backCCW,{u_matrix:Je,u_terrain_coords_id:(255-q.coordsIndex.length)/255,u_texture:0},Oe,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments),q.coordsIndex.push(Ue.tileID.key)}W.bindFramebuffer.set(null),W.viewport.set([0,0,F.width,F.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const P of f){const F=this.style._layers[P];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const q=M[F.source];(F.type==="custom"||q.length)&&this.renderLayer(this,_[F.source],F,q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[f[this.currentLayer]],F=_[P.source],q=T[P.source];this._renderTileClippingMasks(P,q),this.renderLayer(this,F,P,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const P=this.style._layers[f[this.currentLayer]],F=_[P.source];if(v&&v.renderLayer(P))continue;const q=(P.type==="symbol"?z:M)[P.source];this._renderTileClippingMasks(P,T[P.source]),this.renderLayer(this,F,P,q)}if(this.options.showTileBoundaries){let P,F;Object.values(this.style._layers).forEach(q=>{q.source&&!q.isHidden(this.transform.zoom)&&(q.source!==(F&&F.id)&&(F=this.style.sourceCaches[q.source]),(!P||P.getSource().maxzoom<F.getSource().maxzoom)&&(P=F))}),P&&ea.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const F=P.transform.padding;cs(P,P.transform.height-(F.top||0),3,Ra),cs(P,F.bottom||0,3,pr),$s(P,F.left||0,3,Ul),$s(P,P.transform.width-(F.right||0),3,Ao);const q=P.transform.centerPoint;(function(W,le,se,ae){Ms(W,le-1,se-10,2,20,ae),Ms(W,le-10,se-1,20,2,ae)})(P,q.x,P.transform.height-q.y,Gl)}(this),this.context.setDefault()}renderLayer(t,l,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(_||[]).length)&&(this.id=f.id,this.gpuTimingStart(f),ea[f.type](t,l,f,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),f.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const l={};for(const f in t){const _=t[f],v=this.context.extTimerQuery,T=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[f]=T}return l}translatePosMatrix(t,l,f,_,v){if(!f[0]&&!f[1])return t;const T=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const P=Math.sin(T),F=Math.cos(T);f=[f[0]*F-f[1]*P,f[0]*P+f[1]*F]}const M=[v?f[0]:rn(l,f[0],this.transform.zoom),v?f[1]:rn(l,f[1],this.transform.zoom),0],z=new Float32Array(16);return o.translate(z,t,M),z}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!l||!f}useProgram(t,l){this.cache=this.cache||{};const f=t+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Il(this.context,t,qs[t],l,po[t],this._showOverdrawInspector,this.style.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new U(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Oa{constructor(t,l){this.points=t,this.planes=l}static fromInvProjectionMatrix(t,l,f){const _=Math.pow(2,f),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const z=1/(M=o.transformMat4([],M,t))[3]/l*_;return o.mul$1(M,M,[z,z,1/M[3],z])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const z=o.sub([],v[M[0]],v[M[1]]),P=o.sub([],v[M[2]],v[M[1]]),F=o.normalize([],o.cross([],z,P)),q=-o.dot(F,v[M[1]]);return F.concat(q)});return new Oa(v,T)}}class ta{constructor(t,l){this.min=t,this.max=l,this.center=o.scale$1([],o.add([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],f=o.clone$2(this.min),_=o.clone$2(this.max);for(let v=0;v<l.length;v++)f[v]=l[v]?this.min[v]:this.center[v],_[v]=l[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new ta(f,_)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let _=0;_<t.planes.length;_++){const v=t.planes[_];let T=0;for(let M=0;M<l.length;M++)o.dot$1(v,l[M])>=0&&T++;if(T===0)return 0;T!==l.length&&(f=!1)}if(f)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let M=0;M<t.points.length;M++){const z=t.points[M][_]-this.min[_];v=Math.min(v,z),T=Math.max(T,z)}if(T<0||v>this.max[_]-this.min[_])return 0}return 1}}class zs{constructor(t=0,l=0,f=0,_=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=f,this.right=_}interpolate(t,l,f){return l.top!=null&&t.top!=null&&(this.top=o.number(t.top,l.top,f)),l.bottom!=null&&t.bottom!=null&&(this.bottom=o.number(t.bottom,l.bottom,f)),l.left!=null&&t.left!=null&&(this.left=o.number(t.left,l.left,f)),l.right!=null&&t.right!=null&&(this.right=o.number(t.right,l.right,f)),this}getCenter(t,l){const f=o.clamp((this.left+t-this.right)/2,0,t),_=o.clamp((this.top+l-this.bottom)/2,0,l);return new o.pointGeometry(f,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ia{constructor(t,l,f,_,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zs,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const l=-o.wrap(t,-180,180)*Math.PI/180;var f;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(f=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(_,v,T){var M=v[0],z=v[1],P=v[2],F=v[3],q=Math.sin(T),W=Math.cos(T);_[0]=M*W+P*q,_[1]=z*W+F*q,_[2]=M*-q+P*W,_[3]=z*-q+F*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,f){this._unmodified=!1,this._edgeInsets.interpolate(t,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new o.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const f=this.pointCoordinate(new o.pointGeometry(0,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,0)),v=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new o.pointGeometry(0,this.height)),M=Math.floor(Math.min(f.x,_.x,v.x,T.x)),z=Math.floor(Math.max(f.x,_.x,v.x,T.x)),P=1;for(let F=M-P;F<=z+P;F++)F!==0&&l.push(new o.UnwrappedTileID(F,t))}return l}coveringTiles(t){var l,f;let _=this.coveringZoomLevel(t);const v=_;if(t.minzoom!==void 0&&_<t.minzoom)return[];t.maxzoom!==void 0&&_>t.maxzoom&&(_=t.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),M=o.MercatorCoordinate.fromLngLat(this.center),z=Math.pow(2,_),P=[z*T.x,z*T.y,0],F=[z*M.x,z*M.y,0],q=Oa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let W=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(W=_);const le=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,se=de=>({aabb:new ta([de*z,0,0],[(de+1)*z,z,0]),zoom:0,x:0,y:0,wrap:de,fullyVisible:!1}),ae=[],Te=[],Ce=_,Re=t.reparseOverscaled?v:_;if(this._renderWorldCopies)for(let de=1;de<=3;de++)ae.push(se(-de)),ae.push(se(de));for(ae.push(se(0));ae.length>0;){const de=ae.pop(),Ue=de.x,Oe=de.y;let Je=de.fullyVisible;if(!Je){const Pt=de.aabb.intersects(q);if(Pt===0)continue;Je=Pt===2}const $e=t.terrain?P:F,pt=de.aabb.distanceX($e),He=de.aabb.distanceY($e),Dt=Math.max(Math.abs(pt),Math.abs(He)),kt=le+(1<<Ce-de.zoom)-2;if(de.zoom===Ce||Dt>kt&&de.zoom>=W){const Pt=Ce-de.zoom,ui=P[0]-.5-(Ue<<Pt),yi=P[1]-.5-(Oe<<Pt);Te.push({tileID:new o.OverscaledTileID(de.zoom===Ce?Re:de.zoom,de.wrap,de.zoom,Ue,Oe),distanceSq:o.sqrLen([F[0]-.5-Ue,F[1]-.5-Oe]),tileDistanceToCamera:Math.sqrt(ui*ui+yi*yi)})}else for(let Pt=0;Pt<4;Pt++){const ui=(Ue<<1)+Pt%2,yi=(Oe<<1)+(Pt>>1),Yt=de.zoom+1;let Ri=de.aabb.quadrant(Pt);if(t.terrain){const Fi=new o.OverscaledTileID(Yt,de.wrap,Yt,ui,yi),Ai=t.terrain.getMinMaxElevation(Fi),Mi=(l=Ai.minElevation)!==null&&l!==void 0?l:this.elevation,Oi=(f=Ai.maxElevation)!==null&&f!==void 0?f:this.elevation;Ri=new ta([Ri.min[0],Ri.min[1],Mi],[Ri.max[0],Ri.max[1],Oi])}ae.push({aabb:Ri,zoom:Yt,x:ui,y:yi,wrap:de.wrap,fullyVisible:Je})}}return Te.sort((de,Ue)=>de.distanceSq-Ue.distanceSq).map(de=>de.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const l=o.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.pointGeometry(o.mercatorXfromLng(t.lng)*this.worldSize,o.mercatorYfromLat(l)*this.worldSize)}unproject(t){return new o.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,l){const f=o.MercatorCoordinate.fromLngLat(t),_=(1<<this.tileZoom)*o.EXTENT,v=f.x*_,T=f.y*_,M=Math.floor(v/o.EXTENT),z=Math.floor(T/o.EXTENT),P=new o.OverscaledTileID(this.tileZoom,0,this.tileZoom,M,z);return l.getElevation(P,v%o.EXTENT,T%o.EXTENT,o.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const l=this.pointLocation(this.centerPoint,t),f=this.getElevation(l,t);if(!(this.elevation-f))return;const _=this.getCameraPosition(),v=o.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),T=o.MercatorCoordinate.fromLngLat(l,f),M=v.x-T.x,z=v.y-T.y,P=v.z-T.z,F=Math.sqrt(M*M+z*z+P*P),q=this.scaleZoom(this.cameraToCenterDistance/F/this.tileSize);this._elevation=f,this._center=l,this.zoom=q}setLocationAtPoint(t,l){const f=this.pointCoordinate(l),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(t),T=new o.MercatorCoordinate(v.x-(f.x-_.x),v.y-(f.y-_.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,l){return l?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,l),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,l){return this.coordinateLocation(this.pointCoordinate(t,l))}locationCoordinate(t){return o.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,l){if(l){const W=l.pointCoordinate(t);if(W!=null)return W}const f=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.transformMat4(f,f,this.pixelMatrixInverse),o.transformMat4(_,_,this.pixelMatrixInverse);const v=f[3],T=_[3],M=f[1]/v,z=_[1]/T,P=f[2]/v,F=_[2]/T,q=P===F?0:(0-P)/(F-P);return new o.MercatorCoordinate(o.number(f[0]/v,_[0]/T,q)/this.worldSize,o.number(M,z,q)/this.worldSize)}coordinatePoint(t,l=0,f=this.pixelMatrix){const _=[t.x*this.worldSize,t.y*this.worldSize,l,1];return o.transformMat4(_,_,f),new o.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new o.LngLatBounds().extend(this.pointLocation(new o.pointGeometry(0,t))).extend(this.pointLocation(new o.pointGeometry(this.width,t))).extend(this.pointLocation(new o.pointGeometry(this.width,this.height))).extend(this.pointLocation(new o.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,l=!1){const f=t.key,_=l?this._alignedPosMatrixCache:this._posMatrixCache;if(_[f])return _[f];const v=t.canonical,T=this.worldSize/this.zoomScale(v.z),M=v.x+Math.pow(2,v.z)*t.wrap,z=o.identity(new Float64Array(16));return o.translate(z,z,[M*T,v.y*T,0]),o.scale(z,z,[T/o.EXTENT,T/o.EXTENT,1]),o.multiply(z,l?this.alignedProjMatrix:this.projMatrix,z),_[f]=new Float32Array(z),_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,l,f,_,v=-90,T=90,M=-180,z=180;const P=this.size,F=this._unmodified;if(this.latRange){const le=this.latRange;v=o.mercatorYfromLat(le[1])*this.worldSize,T=o.mercatorYfromLat(le[0])*this.worldSize,t=T-v<P.y?P.y/(T-v):0}if(this.lngRange){const le=this.lngRange;M=o.wrap(o.mercatorXfromLng(le[0])*this.worldSize,0,this.worldSize),z=o.wrap(o.mercatorXfromLng(le[1])*this.worldSize,0,this.worldSize),z<M&&(z+=this.worldSize),l=z-M<P.x?P.x/(z-M):0}const q=this.point,W=Math.max(l||0,t||0);if(W)return this.center=this.unproject(new o.pointGeometry(l?(z+M)/2:q.x,t?(T+v)/2:q.y)),this.zoom+=this.scaleZoom(W),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const le=q.y,se=P.y/2;le-se<v&&(_=v+se),le+se>T&&(_=T-se)}if(this.lngRange){const le=(M+z)/2,se=o.wrap(q.x,le-this.worldSize/2,le+this.worldSize/2),ae=P.x/2;se-ae<M&&(f=M+ae),se+ae>z&&(f=z-ae)}f===void 0&&_===void 0||(this.center=this.unproject(new o.pointGeometry(f!==void 0?f:q.x,_!==void 0?_:q.y)).wrap()),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,l=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=o.identity(new Float64Array(16));o.scale(_,_,[this.width/2,-this.height/2,1]),o.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=o.identity(new Float64Array(16)),o.scale(_,_,[1,-1,1]),o.translate(_,_,[-1,-1,0]),o.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,T=this._fov*(.5+t.y/this.height),M=Math.sin(T)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-v-T,.01,Math.PI-.01)),z=this.getHorizon(),P=2*Math.atan(z/this.cameraToCenterDistance)*(.5+t.y/(2*z)),F=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(o.clamp(Math.PI-v-P,.01,Math.PI-.01)),q=Math.cos(Math.PI/2-this._pitch)*M+this.cameraToSeaLevelDistance,W=Math.cos(Math.PI/2-this._pitch)*F+this.cameraToSeaLevelDistance,le=1.01*Math.min(q,W),se=this.height/50;_=new Float64Array(16),o.perspective(_,this._fov,this.width/this.height,se,le),_[8]=2*-t.x/this.width,_[9]=2*t.y/this.height,o.scale(_,_,[1,-1,1]),o.translate(_,_,[0,0,-this.cameraToCenterDistance]),o.rotateX(_,_,this._pitch),o.rotateZ(_,_,this.angle),o.translate(_,_,[-l,-f,0]),this.mercatorMatrix=o.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),o.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,_),o.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=o.invert([],_),this.pixelMatrix3D=o.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ae=this.width%2/2,Te=this.height%2/2,Ce=Math.cos(this.angle),Re=Math.sin(this.angle),de=l-Math.round(l)+Ce*ae+Re*Te,Ue=f-Math.round(f)+Ce*Te+Re*ae,Oe=new Float64Array(_);if(o.translate(Oe,Oe,[de>.5?de-1:de,Ue>.5?Ue-1:Ue,0]),this.alignedProjMatrix=Oe,_=o.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new o.pointGeometry(0,0)),l=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.transformMat4(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,t))}getCameraQueryGeometry(t){const l=this.getCameraPoint();if(t.length===1)return[t[0],l];{let f=l.x,_=l.y,v=l.x,T=l.y;for(const M of t)f=Math.min(f,M.x),_=Math.min(_,M.y),v=Math.max(v,M.x),T=Math.max(T,M.y);return[new o.pointGeometry(f,_),new o.pointGeometry(v,_),new o.pointGeometry(v,T),new o.pointGeometry(f,T),new o.pointGeometry(f,_)]}}}class Zl{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(l,f){let _=!1,v=null;const T=()=>{v=null,_&&(l(),v=setTimeout(T,300),_=!1)};return()=>(_=!0,v||T(),v)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),T=Math.round(l.lng*v)/v,M=Math.round(l.lat*v)/v,z=this._map.getBearing(),P=this._map.getPitch();let F="";if(F+=t?`/${T}/${M}/${f}`:`${f}/${M}/${T}`,(z||P)&&(F+="/"+Math.round(10*z)/10),P&&(F+=`/${Math.round(P)}`),this._hashName){const q=this._hashName;let W=!1;const le=window.location.hash.slice(1).split("&").map(se=>{const ae=se.split("=")[0];return ae===q?(W=!0,`${ae}=${F}`):se}).filter(se=>se);return W||le.push(`${q}=${F}`),`#${le.join("&")}`}return`#${F}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:l,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const na={linearity:.3,easing:o.bezier(0,0,.3,1)},Xl=o.extend({deceleration:2500,maxSpeed:1400},na),Wl=o.extend({deceleration:20,maxSpeed:1400},na),Hl=o.extend({deceleration:1e3,maxSpeed:360},na),Ds=o.extend({deceleration:1e3,maxSpeed:90},na);class Kl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=o.exported.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const v=sa(l.pan.mag(),f,o.extend({},Xl,t||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,ra(_,v)}if(l.zoom){const v=sa(l.zoom,f,Wl);_.zoom=this._map.transform.zoom+v.amount,ra(_,v)}if(l.bearing){const v=sa(l.bearing,f,Hl);_.bearing=this._map.transform.bearing+o.clamp(v.amount,-179,179),ra(_,v)}if(l.pitch){const v=sa(l.pitch,f,Ds);_.pitch=this._map.transform.pitch+v.amount,ra(_,v)}if(_.zoom||_.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),o.extend(_,{noMoveStart:!0})}}function ra(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function sa(p,t,l){const{maxSpeed:f,linearity:_,deceleration:v}=l,T=o.clamp(p*_/(t/1e3),-f,f),M=Math.abs(T)/(v*_);return{easing:l.easing,duration:1e3*M,amount:T*(M/2)}}class Jn extends o.Event{constructor(t,l,f,_={}){const v=E.mousePos(l.getCanvasContainer(),f),T=l.unproject(v);super(t,o.extend({point:v,lngLat:T,originalEvent:f},_)),this._defaultPrevented=!1,this.target=l}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class aa extends o.Event{constructor(t,l,f){const _=t==="touchend"?f.changedTouches:f.touches,v=E.touchPos(l.getCanvasContainer(),_),T=v.map(z=>l.unproject(z)),M=v.reduce((z,P,F,q)=>z.add(P.div(q.length)),new o.pointGeometry(0,0));super(t,{points:v,point:M,lngLats:T,lngLat:l.unproject(M),originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Qn extends o.Event{constructor(t,l,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ou{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Qn(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new Jn(t.type,this._map,t))}mouseup(t){this._map.fire(new Jn(t.type,this._map,t))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new Jn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Jn(t.type,this._map,t))}mouseover(t){this._map.fire(new Jn(t.type,this._map,t))}mouseout(t){this._map.fire(new Jn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new aa(t.type,this._map,t))}touchmove(t){this._map.fire(new aa(t.type,this._map,t))}touchend(t){this._map.fire(new aa(t.type,this._map,t))}touchcancel(t){this._map.fire(new aa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Jn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Jn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Jn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yl{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&t.button===0&&(E.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=f,this._box||(this._box=E.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(_.x,f.x),T=Math.max(_.x,f.x),M=Math.min(_.y,f.y),z=Math.max(_.y,f.y);E.setTransform(this._box,`translate(${v}px,${M}px)`),this._box.style.width=T-v+"px",this._box.style.height=z-M+"px"}mouseupWindow(t,l){if(!this._active||t.button!==0)return;const f=this._startPos,_=l;if(this.reset(),E.suppressClick(),f.x!==_.x||f.y!==_.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new o.Event(t,{originalEvent:l}))}}function Fr(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const l={};for(let f=0;f<p.length;f++)l[p[f].identifier]=t[f];return l}class oa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const v=new o.pointGeometry(0,0);for(const T of _)v._add(T);return v.div(_.length)}(l),this.touches=Fr(f,l)))}touchmove(t,l,f){if(this.aborted||!this.centroid)return;const _=Fr(f,l);for(const v in this.touches){const T=this.touches[v],M=_[v];(!M||M.dist(T)>30)&&(this.aborted=!0)}}touchend(t,l,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Mo{constructor(t){this.singleTap=new oa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,l,f){this.singleTap.touchstart(t,l,f)}touchmove(t,l,f){this.singleTap.touchmove(t,l,f)}touchend(t,l,f){const _=this.singleTap.touchend(t,l,f);if(_){const v=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(v&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class lu{constructor(){this._zoomIn=new Mo({numTouches:1,numTaps:2}),this._zoomOut=new Mo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,f){this._zoomIn.touchstart(t,l,f),this._zoomOut.touchstart(t,l,f)}touchmove(t,l,f){this._zoomIn.touchmove(t,l,f),this._zoomOut.touchmove(t,l,f)}touchend(t,l,f){const _=this._zoomIn.touchend(t,l,f),v=this._zoomOut.touchend(t,l,f);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cu={0:1,2:2};class Va{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const f=E.mouseButton(t);this._correctButton(t,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(t,l){const f=this._lastPoint;if(f){if(t.preventDefault(),function(_,v){const T=cu[v];return _.buttons===void 0||(_.buttons&T)!==T}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}}mouseupWindow(t){this._lastPoint&&E.mouseButton(t)===this._eventButton&&(this._moved&&E.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class la extends Va{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return l===0&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class Or extends Va{_correctButton(t,l){return l===0&&t.ctrlKey||l===2}_move(t,l){const f=.8*(l.x-t.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(t){t.preventDefault()}}class Vt extends Va{_correctButton(t,l){return l===0&&t.ctrlKey||l===2}_move(t,l){const f=-.5*(l.y-t.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(t){t.preventDefault()}}class Jl{constructor(t,l){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,l,f){return this._calculateTransform(t,l,f)}touchmove(t,l,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,l,f)}touchend(t,l,f){this._calculateTransform(t,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,f){f.length>0&&(this._active=!0);const _=Fr(f,l),v=new o.pointGeometry(0,0),T=new o.pointGeometry(0,0);let M=0;for(const P in _){const F=_[P],q=this._touches[P];q&&(v._add(F),T._add(F.sub(q)),M++,_[P]=F)}if(this._touches=_,M<this._minTouches||!T.mag())return;const z=T.div(M);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class us{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,l,f){return{}}touchstart(t,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,f){if(!this._firstTwoTouches)return;t.preventDefault();const[_,v]=this._firstTwoTouches,T=Qr(f,l,_),M=Qr(f,l,v);if(!T||!M)return;const z=this._aroundCenter?null:T.add(M).div(2);return this._move([T,M],z,t)}touchend(t,l,f){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,T=Qr(f,l,_),M=Qr(f,l,v);T&&M||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Qr(p,t,l){for(let f=0;f<p.length;f++)if(p[f].identifier===l)return t[f]}function zo(p,t){return Math.log(p/t)/Math.LN2}class Ct extends us{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(zo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zo(this._distance,f),pinchAround:l}}}function Na(p,t){return 180*p.angleWith(t)/Math.PI}class uu extends us{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const f=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Na(this._vector,f),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,f=Na(t,this._startVector);return Math.abs(f)<l}}function Do(p){return Math.abs(p.y)>Math.abs(p.x)}class Po extends us{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,l,f){super.touchstart(t,l,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,Do(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,v,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(t,l,f){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=t.y>0==l.y>0;return Do(t)&&Do(l)&&T}}const Ql={panStep:100,bearingStep:15,pitchStep:10};class $l{constructor(){const t=Ql;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,f=0,_=0,v=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:M=>{const z=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:hu,zoom:l?Math.round(z)+l*(t.shiftKey?2:1):z,bearing:M.getBearing()+f*this._bearingStep,pitch:M.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hu(p){return p*(2-p)}const ec=4.000244140625;class Lo{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let l=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=o.exported.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%ec==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=E.mousePos(this._el,t);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(l)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ec?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const P=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(P*z))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,f=this._startZoom,_=this._easing;let v,T=!1;if(this._type==="wheel"&&f&&_){const M=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),z=_(M);v=o.number(f,l,z),M<1?this._frameId||(this._frameId=!0):T=!0}else v=l,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:v-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=o.ease;if(this._prevEase){const f=this._prevEase,_=(o.exported.now()-f.start)/f.duration,v=f.easing(_+.01)-f.easing(_),T=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-T*T);l=o.bezier(T,M,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:l},l}reset(){this._active=!1}}class Bo{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ro{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,l){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(t.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fo{constructor(){this._tap=new Mo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,l,f){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(t,l,f))}touchmove(t,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,l,f)}touchend(t,l,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(t,l,f)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gn{constructor(t,l,f){this._el=t,this._mousePan=l,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $r{constructor(t,l,f){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tc{constructor(t,l,f,_){this._el=t,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ps=p=>p.zoom||p.drag||p.pitch||p.rotate;class Oo extends o.Event{}function ca(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ic{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kl(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l),o.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,T]of this._listeners)E.addEventListener(_,v,_===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[t,l,f]of this._listeners)E.removeEventListener(t,l,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new ou(l,t));const _=l.boxZoom=new Yl(l,t);this._add("boxZoom",_);const v=new lu,T=new Ro;l.doubleClickZoom=new Bo(T,v),this._add("tapZoom",v),this._add("clickZoom",T);const M=new Fo;this._add("tapDragZoom",M);const z=l.touchPitch=new Po(l);this._add("touchPitch",z);const P=new Or(t),F=new Vt(t);l.dragRotate=new $r(t,P,F),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const q=new la(t),W=new Jl(t,l);l.dragPan=new Gn(f,q,W),this._add("mousePan",q),this._add("touchPan",W,["touchZoom","touchRotate"]);const le=new uu,se=new Ct;l.touchZoomRotate=new tc(f,se,le,M),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]);const ae=l.scrollZoom=new Lo(l,this);this._add("scrollZoom",ae,["mousePan"]);const Te=l.keyboard=new $l;this._add("keyboard",Te),this._add("blockableMapEvent",new Jr(l));for(const Ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Ce]&&l[Ce].enable(t[Ce])}_add(t,l,f){this._handlers.push({handlerName:t,handler:l,allowed:f}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ps(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,l,f){for(const _ in t)if(_!==f&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const f of t)this._el.contains(f.target)&&l.push(f);return l}handleEvent(t,l){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=t.type==="renderFrame"?void 0:t,_={needsRenderFrame:!1},v={},T={},M=t.touches,z=M?this._getMapTouches(M):void 0,P=z?E.touchPos(this._el,z):E.mousePos(this._el,t);for(const{handlerName:W,handler:le,allowed:se}of this._handlers){if(!le.isEnabled())continue;let ae;this._blockedByActive(T,se,W)?le.reset():le[l||t.type]&&(ae=le[l||t.type](t,P,z),this.mergeHandlerResult(_,v,ae,W,f),ae&&ae.needsRenderFrame&&this._triggerRenderFrame()),(ae||le.isActive())&&(T[W]=le)}const F={};for(const W in this._previousActiveHandlers)T[W]||(F[W]=f);this._previousActiveHandlers=T,(Object.keys(F).length||ca(_))&&(this._changes.push([_,v,F]),this._triggerRenderFrame()),(Object.keys(T).length||ca(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=_;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(t,l,f,_,v){if(!f)return;o.extend(t,f);const T={handlerName:_,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(l.zoom=T),f.panDelta!==void 0&&(l.drag=T),f.pitchDelta!==void 0&&(l.pitch=T),f.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const t={},l={},f={};for(const[_,v,T]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new o.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),o.extend(l,v),o.extend(f,T);this._updateMapTransform(t,l,f),this._changes=[]}_updateMapTransform(t,l,f){const _=this._map,v=_.transform,T=_.style&&_.style.terrain;if(!(ca(t)||T&&this._drag))return this._fireEvents(l,f,!0);let{panDelta:M,zoomDelta:z,bearingDelta:P,pitchDelta:F,around:q,pinchAround:W}=t;W!==void 0&&(q=W),_._stop(!0),q=q||_.transform.centerPoint;const le=v.pointLocation(M?q.sub(M):q);P&&(v.bearing+=P),F&&(v.pitch+=F),z&&(v.zoom+=z),T?l.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(q),point:q,handlerName:l.drag.handlerName},_.fire(new o.Event("freezeElevation",{freeze:!0}))):this._drag&&f[this._drag.handlerName]?(_.fire(new o.Event("freezeElevation",{freeze:!1})),this._drag=null):l.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(M))):v.setLocationAtPoint(le,q),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,f,!0)}_fireEvents(t,l,f){const _=Ps(this._eventsInProgress),v=Ps(t),T={};for(const F in t){const{originalEvent:q}=t[F];this._eventsInProgress[F]||(T[`${F}start`]=q),this._eventsInProgress[F]=t[F]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const F in T)this._fireEvent(F,T[F]);v&&this._fireEvent("move",v.originalEvent);for(const F in t){const{originalEvent:q}=t[F];this._fireEvent(F,q)}const M={};let z;for(const F in this._eventsInProgress){const{handlerName:q,originalEvent:W}=this._eventsInProgress[F];this._handlersById[q].isActive()||(delete this._eventsInProgress[F],z=l[q]||W,M[`${F}end`]=z)}for(const F in M)this._fireEvent(F,M[F]);const P=Ps(this._eventsInProgress);if(f&&(_||v)&&!P){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;F?(q(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:z})):(this._map.fire(new o.Event("moveend",{originalEvent:z})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new o.Event(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Oo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const lr={extend:(p,...t)=>o.extend(p,...t),run(p){p()},logToElement(p,t=!1,l="log"){const f=window.document.getElementById(l);f&&(t&&(f.innerHTML=""),f.innerHTML+=`<br>${p}`)}};class Yi extends o.Evented{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,f){return t=o.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},l),f)}panTo(t,l,f){return this.easeTo(o.extend({center:t},l),f)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,f){return this.easeTo(o.extend({zoom:t},l),f)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,f){return this.easeTo(o.extend({bearing:t},l),f)}resetNorth(t,l){return this.rotateTo(0,o.extend({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){t=o.LngLatBounds.convert(t);const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,l)}_cameraForBoxAndBearing(t,l,f,_){const v={top:0,bottom:0,right:0,left:0};if(typeof(_=o.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const Oe=_.padding;_.padding={top:Oe,bottom:Oe,right:Oe,left:Oe}}_.padding=o.extend(v,_.padding);const T=this.transform,M=T.padding,z=T.project(o.LngLat.convert(t)),P=T.project(o.LngLat.convert(l)),F=z.rotate(-f*Math.PI/180),q=P.rotate(-f*Math.PI/180),W=new o.pointGeometry(Math.max(F.x,q.x),Math.max(F.y,q.y)),le=new o.pointGeometry(Math.min(F.x,q.x),Math.min(F.y,q.y)),se=W.sub(le),ae=(T.width-(M.left+M.right+_.padding.left+_.padding.right))/se.x,Te=(T.height-(M.top+M.bottom+_.padding.top+_.padding.bottom))/se.y;if(Te<0||ae<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ce=Math.min(T.scaleZoom(T.scale*Math.min(ae,Te)),_.maxZoom),Re=o.pointGeometry.convert(_.offset),de=new o.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(f*Math.PI/180),Ue=Re.add(de).mult(T.scale/T.zoomScale(Ce));return{center:T.unproject(z.add(P).div(2).sub(Ue)),zoom:Ce,bearing:f}}fitBounds(t,l,f){return this._fitInternal(this.cameraForBounds(t,l),l,f)}fitScreenCoordinates(t,l,f,_,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(t)),this.transform.pointLocation(o.pointGeometry.convert(l)),f,_),_,v)}_fitInternal(t,l,f){return t?(delete(l=o.extend(t,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(t,l){this.stop();const f=this.transform;let _=!1,v=!1,T=!1;return"zoom"in t&&f.zoom!==+t.zoom&&(_=!0,f.zoom=+t.zoom),t.center!==void 0&&(f.center=o.LngLat.convert(t.center)),"bearing"in t&&f.bearing!==+t.bearing&&(v=!0,f.bearing=+t.bearing),"pitch"in t&&f.pitch!==+t.pitch&&(T=!0,f.pitch=+t.pitch),t.padding==null||f.isPaddingEqual(t.padding)||(f.padding=t.padding),this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),_&&this.fire(new o.Event("zoomstart",l)).fire(new o.Event("zoom",l)).fire(new o.Event("zoomend",l)),v&&this.fire(new o.Event("rotatestart",l)).fire(new o.Event("rotate",l)).fire(new o.Event("rotateend",l)),T&&this.fire(new o.Event("pitchstart",l)).fire(new o.Event("pitch",l)).fire(new o.Event("pitchend",l)),this.fire(new o.Event("moveend",l))}calculateCameraOptionsFromTo(t,l,f,_=0){const v=o.MercatorCoordinate.fromLngLat(t,l),T=o.MercatorCoordinate.fromLngLat(f,_),M=T.x-v.x,z=T.y-v.y,P=T.z-v.z,F=Math.hypot(M,z,P);if(F===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(M,z),W=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),le=180*Math.atan2(M,-z)/Math.PI;let se=180*Math.acos(q/F)/Math.PI;return se=P<0?90-se:90+se,{center:T.toLngLat(),zoom:W,pitch:se,bearing:le}}easeTo(t,l){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);const f=this.transform,_=this.getZoom(),v=this.getBearing(),T=this.getPitch(),M=this.getPadding(),z="zoom"in t?+t.zoom:_,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,F="pitch"in t?+t.pitch:T,q="padding"in t?t.padding:f.padding,W=o.pointGeometry.convert(t.offset);let le=f.centerPoint.add(W);const se=f.pointLocation(le),ae=o.LngLat.convert(t.center||se);this._normalizeCenter(ae);const Te=f.project(se),Ce=f.project(ae).sub(Te),Re=f.zoomScale(z-_);let de,Ue;t.around&&(de=o.LngLat.convert(t.around),Ue=f.locationPoint(de));const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||z!==_,this._rotating=this._rotating||v!==P,this._pitching=this._pitching||F!==T,this._padding=!f.isPaddingEqual(q),this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,Oe),this._ease(Je=>{if(this._zooming&&(f.zoom=o.number(_,z,Je)),this._rotating&&(f.bearing=o.number(v,P,Je)),this._pitching&&(f.pitch=o.number(T,F,Je)),this._padding&&(f.interpolatePadding(M,q,Je),le=f.centerPoint.add(W)),de)f.setLocationAtPoint(de,Ue);else{const $e=f.zoomScale(f.zoom-_),pt=z>_?Math.min(2,Re):Math.max(.5,Re),He=Math.pow(pt,1-Je),Dt=f.unproject(Te.add(Ce.mult(Je*He)).mult($e));f.setLocationAtPoint(f.renderWorldCopies?Dt.wrap():Dt,le)}this._fireMoveEvents(l)},Je=>{this._afterEase(l,Je)},t),this}_prepareEase(t,l,f={}){this._moving=!0,this.fire(new o.Event("freezeElevation",{freeze:!0})),l||f.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!f.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new o.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.fire(new o.Event("freezeElevation",{freeze:!1}));const f=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.Event("zoomend",t)),_&&this.fire(new o.Event("rotateend",t)),v&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,l){if(!t.essential&&o.exported.prefersReducedMotion){const Yt=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Yt,l)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);const f=this.transform,_=this.getZoom(),v=this.getBearing(),T=this.getPitch(),M=this.getPadding(),z="zoom"in t?o.clamp(+t.zoom,f.minZoom,f.maxZoom):_,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,F="pitch"in t?+t.pitch:T,q="padding"in t?t.padding:f.padding,W=f.zoomScale(z-_),le=o.pointGeometry.convert(t.offset);let se=f.centerPoint.add(le);const ae=f.pointLocation(se),Te=o.LngLat.convert(t.center||ae);this._normalizeCenter(Te);const Ce=f.project(ae),Re=f.project(Te).sub(Ce);let de=t.curve;const Ue=Math.max(f.width,f.height),Oe=Ue/W,Je=Re.mag();if("minZoom"in t){const Yt=o.clamp(Math.min(t.minZoom,_,z),f.minZoom,f.maxZoom),Ri=Ue/f.zoomScale(Yt-_);de=Math.sqrt(Ri/Je*2)}const $e=de*de;function pt(Yt){const Ri=(Oe*Oe-Ue*Ue+(Yt?-1:1)*$e*$e*Je*Je)/(2*(Yt?Oe:Ue)*$e*Je);return Math.log(Math.sqrt(Ri*Ri+1)-Ri)}function He(Yt){return(Math.exp(Yt)-Math.exp(-Yt))/2}function Dt(Yt){return(Math.exp(Yt)+Math.exp(-Yt))/2}const kt=pt(0);let Pt=function(Yt){return Dt(kt)/Dt(kt+de*Yt)},ui=function(Yt){return Ue*((Dt(kt)*(He(Ri=kt+de*Yt)/Dt(Ri))-He(kt))/$e)/Je;var Ri},yi=(pt(1)-kt)/de;if(Math.abs(Je)<1e-6||!isFinite(yi)){if(Math.abs(Ue-Oe)<1e-6)return this.easeTo(t,l);const Yt=Oe<Ue?-1:1;yi=Math.abs(Math.log(Oe/Ue))/de,ui=function(){return 0},Pt=function(Ri){return Math.exp(Yt*de*Ri)}}return t.duration="duration"in t?+t.duration:1e3*yi/("screenSpeed"in t?+t.screenSpeed/de:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==P,this._pitching=F!==T,this._padding=!f.isPaddingEqual(q),this._prepareEase(l,!1),this._ease(Yt=>{const Ri=Yt*yi,Fi=1/Pt(Ri);f.zoom=Yt===1?z:_+f.scaleZoom(Fi),this._rotating&&(f.bearing=o.number(v,P,Yt)),this._pitching&&(f.pitch=o.number(T,F,Yt)),this._padding&&(f.interpolatePadding(M,q,Yt),se=f.centerPoint.add(le));const Ai=Yt===1?Te:f.unproject(Ce.add(Re.mult(ui(Ri))).mult(Fi));f.setLocationAtPoint(f.renderWorldCopies?Ai.wrap():Ai,se),this._fireMoveEvents(l)},()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,l)}if(!t){const f=this.handlers;f&&f.stop(!1)}return this}_ease(t,l,f){f.animate===!1||f.duration===0?(t(1),l()):(this._easeStart=o.exported.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=o.wrap(t,-180,180);const f=Math.abs(t-l);return Math.abs(t-360-l)<f&&(t-=360),Math.abs(t+360-l)<f&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const f=t.lng-l.center.lng;t.lng+=f>180?-360:f<-180?360:0}}class ua{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const f=this._map._getUIString(`AttributionControl.${l}`);t.title=f,t.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style.sourceCaches;for(const _ in l){const v=l[_];if(v.used||v.usedForTerrain){const T=v.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t=t.filter(_=>String(_).trim()),t.sort((_,v)=>_.length-v.length),t=t.filter((_,v)=>{for(let T=v+1;T<t.length;T++)if(t[T].indexOf(_)>=0)return!1;return!0});const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Ua{constructor(t={}){this.options=t,o.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl mapboxgl-ctrl");const l=E.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact","mapboxgl-compact"):l.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class nc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const _ of f)if(_.id===t)return void(_.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const rc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},sc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},fu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tr{constructor(t,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Or({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,f&&(this.mousePitch=new Vt({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),E.addEventListener(l,"mousedown",this.mousedown),E.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(l,"touchmove",this.touchmove),E.addEventListener(l,"touchend",this.touchend),E.addEventListener(l,"touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),E.disableDrag()}move(t,l){const f=this.map,_=this.mouseRotate.mousemoveWindow(t,l);if(_&&_.bearingDelta&&f.setBearing(f.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,l);v&&v.pitchDelta&&f.setPitch(f.getPitch()+v.pitchDelta)}}off(){const t=this.element;E.removeEventListener(t,"mousedown",this.mousedown),E.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(t,"touchmove",this.touchmove),E.removeEventListener(t,"touchend",this.touchend),E.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),E.mousePos(this.element,t)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,E.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ha(p,t,l){if(p=new o.LngLat(p.lng,p.lat),t){const f=new o.LngLat(p.lng-360,p.lat),_=new o.LngLat(p.lng+360,p.lat),v=l.locationPoint(p).distSqr(t);l.locationPoint(f).distSqr(t)<v?p=f:l.locationPoint(_).distSqr(t)<v&&(p=_)}for(;Math.abs(p.lng-l.center.lng)>180;){const f=l.locationPoint(p);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;p.lng>l.center.lng?p.lng-=360:p.lng+=360}return p}const Xt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $t(p,t,l){const f=p.classList;for(const _ in Xt)f.remove(`maplibregl-${l}-anchor-${_}`,`mapboxgl-${l}-anchor-${_}`);f.add(`maplibregl-${l}-anchor-${t}`,`mapboxgl-${l}-anchor-${t}`)}class Ls extends o.Evented{constructor(t,l){if(super(),(t instanceof HTMLElement||l)&&(t=o.extend({element:t},l)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=o.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div"),this._element.setAttribute("aria-label","Map marker");const f=E.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${v}px`),f.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const T=E.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const M=E.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const z=E.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of P){const de=E.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",Re.rx),de.setAttributeNS(null,"ry",Re.ry),z.appendChild(de)}const F=E.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const q=E.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(q);const W=E.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const le=E.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(le);const se=E.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const ae=E.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Te=E.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#000000"),Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962");const Ce=E.createNS("http://www.w3.org/2000/svg","circle");Ce.setAttributeNS(null,"fill","#FFFFFF"),Ce.setAttributeNS(null,"cx","5.5"),Ce.setAttributeNS(null,"cy","5.5"),Ce.setAttributeNS(null,"r","5.4999962"),ae.appendChild(Te),ae.appendChild(Ce),M.appendChild(z),M.appendChild(F),M.appendChild(W),M.appendChild(se),M.appendChild(ae),f.appendChild(M),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(f),this._offset=o.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),$t(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const l=t.code,f=t.charCode||t.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ha(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${Xt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${l}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=o.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Vo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let es,Sn=0,ts=!1;const Sr={maxWidth:100,unit:"metric"};function ac(p,t,l){const f=l&&l.maxWidth||100,_=p._container.clientHeight/2,v=p.unproject([0,_]),T=p.unproject([f,_]),M=v.distanceTo(T);if(l&&l.unit==="imperial"){const z=3.2808*M;z>5280?is(t,f,z/5280,p._getUIString("ScaleControl.Miles")):is(t,f,z,p._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?is(t,f,M/1852,p._getUIString("ScaleControl.NauticalMiles")):M>=1e3?is(t,f,M/1e3,p._getUIString("ScaleControl.Kilometers")):is(t,f,M,p._getUIString("ScaleControl.Meters"))}function is(p,t,l,f){const _=function(v){const T=Math.pow(10,`${Math.floor(v)}`.length-1);let M=v/T;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(z){const P=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*P)/P}(M),T*M}(l);p.style.width=t*(_/l)+"px",p.innerHTML=`${_}&nbsp;${f}`}const sn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function No(p){if(p){if(typeof p=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(p,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,p),"top-left":new o.pointGeometry(t,t),"top-right":new o.pointGeometry(-t,t),bottom:new o.pointGeometry(0,-p),"bottom-left":new o.pointGeometry(t,-t),"bottom-right":new o.pointGeometry(-t,-t),left:new o.pointGeometry(p,0),right:new o.pointGeometry(-p,0)}}if(p instanceof o.pointGeometry||Array.isArray(p)){const t=o.pointGeometry.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.pointGeometry.convert(p.center||[0,0]),top:o.pointGeometry.convert(p.top||[0,0]),"top-left":o.pointGeometry.convert(p["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(p["top-right"]||[0,0]),bottom:o.pointGeometry.convert(p.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(p["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(p["bottom-right"]||[0,0]),left:o.pointGeometry.convert(p.left||[0,0]),right:o.pointGeometry.convert(p.right||[0,0])}}return No(new o.pointGeometry(0,0))}const hs={supported:x,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Yi{constructor(p){var t;if(o.PerformanceUtils.mark(o.PerformanceMarkers.create),(p=o.extend({},sc,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ia(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new nc,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},rc,p.locale),this._clickTolerance=p.clickTolerance,this._pixelRatio=(t=p.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new B(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ic(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new Zl(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,o.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new ua({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new Ua,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.Event(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new o.Event("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=p.onAdd(this);this._controls.push(p);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,l,f){return f==null&&this.style.terrain&&(f=this.transform.getElevation(l,this.style.terrain)),super.calculateCameraOptionsFromTo(p,t,l,f)}resize(p){const t=this._containerDimensions(),l=t[0],f=t[1];this._resizeCanvas(l,f,this.getPixelRatio()),this.transform.resize(l,f),this.painter.resize(l,f,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new o.Event("movestart",p)).fire(new o.Event("move",p))),this.fire(new o.Event("resize",p)),_&&this.fire(new o.Event("moveend",p)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(p){const[t,l]=this._containerDimensions();this._pixelRatio=p,this._resizeCanvas(t,l,p),this.painter.resize(t,l,p)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(o.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(o.LngLat.convert(p),this.style&&this.style.terrain)}unproject(p){return this.transform.pointLocation(o.pointGeometry.convert(p),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(p,t,l){if(p==="mouseenter"||p==="mouseover"){let f=!1;return{layer:t,listener:l,delegates:{mousemove:v=>{const T=this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[];T.length?f||(f=!0,l.call(this,new Jn(p,this,v.originalEvent,{features:T}))):f=!1},mouseout:()=>{f=!1}}}}if(p==="mouseleave"||p==="mouseout"){let f=!1;return{layer:t,listener:l,delegates:{mousemove:T=>{(this.getLayer(t)?this.queryRenderedFeatures(T.point,{layers:[t]}):[]).length?f=!0:f&&(f=!1,l.call(this,new Jn(p,this,T.originalEvent)))},mouseout:T=>{f&&(f=!1,l.call(this,new Jn(p,this,T.originalEvent)))}}}}{const f=_=>{const v=this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[];v.length&&(_.features=v,l.call(this,_),delete _.features)};return{layer:t,listener:l,delegates:{[p]:f}}}}on(p,t,l){if(l===void 0)return super.on(p,t);const f=this._createDelegatedListener(p,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(p,t,l){if(l===void 0)return super.once(p,t);const f=this._createDelegatedListener(p,t,l);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(p,t,l){return l===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(f=>{const _=this._delegatedListeners[p];for(let v=0;v<_.length;v++){const T=_[v];if(T.layer===t&&T.listener===l){for(const M in T.delegates)this.off(M,T.delegates[M]);return _.splice(v,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let l;if(t!==void 0||p===void 0||p instanceof o.pointGeometry||Array.isArray(p)||(t=p,p=void 0),t=t||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof o.pointGeometry||typeof p[0]=="number")l=[o.pointGeometry.convert(p)];else{const f=o.pointGeometry.convert(p[0]),_=o.pointGeometry.convert(p[1]);l=[f,new o.pointGeometry(_.x,f.y),_,new o.pointGeometry(f.x,_.y),f]}return this.style.queryRenderedFeatures(l,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new Cn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Cn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const l=this._requestManager.transformRequest(p,o.ResourceType.Style);o.getJSON(l,(f,_)=>{f?this.fire(new o.ErrorEvent(f)):_&&this._updateDiff(_,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p)&&this._update(!0)}catch(l){o.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){return this.style.setTerrain(p),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const l=p[t]._tiles;for(const f in l){const _=l[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(p,t,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,l)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,{pixelRatio:l=1,sdf:f=!1,stretchX:_,stretchY:v,content:T}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||o.isImageBitmap(t)){const{width:M,height:z,data:P}=o.exported.getImageData(t);this.style.addImage(p,{data:new o.RGBAImage({width:M,height:z},P),pixelRatio:l,stretchX:_,stretchY:v,content:T,sdf:f,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:P}=t,F=t;this.style.addImage(p,{data:new o.RGBAImage({width:M,height:z},new Uint8Array(P)),pixelRatio:l,stretchX:_,stretchY:v,content:T,sdf:f,version:0,userImage:F}),F.onAdd&&F.onAdd(this,p)}}}updateImage(p,t){const l=this.style.getImage(p);if(!l)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||o.isImageBitmap(t)?o.exported.getImageData(t):t,{width:_,height:v,data:T}=f;if(_===void 0||v===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==l.data.width||v!==l.data.height)return this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(t instanceof HTMLImageElement||o.isImageBitmap(t));l.data.replace(T,M),this.style.updateImage(p,l)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){o.getImage(this._requestManager.transformRequest(p,o.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,t,l){return this.style.setLayerZoomRange(p,t,l),this._update(!0)}setFilter(p,t,l={}){return this.style.setFilter(p,t,l),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,l,f={}){return this.style.setPaintProperty(p,t,l,f),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,l,f={}){return this.style.setLayoutProperty(p,t,l,f),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=E.create("div","maplibregl-canvas-container mapboxgl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions();this._resizeCanvas(l[0],l[1],this.getPixelRatio());const f=this._controlContainer=E.create("div","maplibregl-control-container mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=E.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const p=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=E.create("div","maplibregl-cooperative-gesture-screen",p);let t="Control",l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${l}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",f=>{f.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",f=>{f.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",f=>{this._onCooperativeGesture(f,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(p,t,l){this._canvas.width=l*p,this._canvas.height=l*t,this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p=o.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);t?(this.painter=new Co(t,this.transform),o.exported$1.testSupport(t)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(p,t,l){return!t&&l<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){let t,l=0;const f=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,t),l=o.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,M=o.exported.now();this.style.zoomHistory.update(T,M);const z=new o.EvaluationParameters(T,{now:M,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=z.crossFadingFactor();P===1&&P===this._crossFadingFactor||(_=!0,this._crossFadingFactor=P),this.style.update(z)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.load),this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const T=o.exported.now()-l;f.endQueryEXT(f.TIME_ELAPSED_EXT,t),setTimeout(()=>{const M=f.getQueryObjectEXT(t,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(t),this.fire(new o.Event("gpu-timing-frame",{cpuTime:T,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(T);this.fire(new o.Event("gpu-timing-layer",{layerTimes:M}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,o.PerformanceUtils.mark(o.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._cooperativeGestures&&E.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),o.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=o.exported.frame(p=>{o.PerformanceUtils.frame(p),this._frame=null,this._render(p)}))}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,t){o.setCacheLimits(p,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(p){this.options=o.extend({},fu,p),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),E.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),E.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map.getZoom(),t=p===this._map.getMaxZoom(),l=p===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=p}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const l=E.create("button",p,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(p,t){const l=this._map._getUIString(`NavigationControl.${t}`);p.title=l,p.setAttribute("aria-label",l)}},GeolocateControl:class extends o.Evented{constructor(p){super(),this.options=o.extend({},Vo,p),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(p){var t;return this._map=p,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,es!==void 0?t(es):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{es=l.state!=="denied",t(es)}):(es=!!window.navigator.geolocation,t(es)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Sn=0,ts=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),l=p.coords;return t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",p)),this._finish()}}_updateCamera(p){const t=new o.LngLat(p.coords.longitude,p.coords.latitude),l=p.coords.accuracy,f=this._map.getBearing(),_=o.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),_,{geolocateSource:!0})}_updateMarker(p){if(p){const t=new o.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._container.clientHeight/2,t=this._map.unproject([0,p]),l=this._map.unproject([1,p]),f=t.distanceTo(l),_=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&ts)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ls(this._dotElement),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ls({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Sn--,ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Sn++,Sn>1?(p={maximumAge:6e5,timeout:0},ts=!0):(p=this.options.positionOptions,ts=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ua,LogoControl:Ua,ScaleControl:class{constructor(p){this.options=o.extend({},Sr,p),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ac(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,ac(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(p){this.options=p,o.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(p){return this._map=p,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends o.Evented{constructor(p){super(),this.options=o.extend(Object.create(sn),p),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=o.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=p;f=l.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_update(p){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=E.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ha(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!p))return;const t=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat);let l=this.options.anchor;const f=No(this.options.offset);if(!l){const v=this._container.offsetWidth,T=this._container.offsetHeight;let M;M=t.y+f.bottom.y<T?["top"]:t.y>this._map.transform.height-T?["bottom"]:[],t.x<v/2?M.push("left"):t.x>this._map.transform.width-v/2&&M.push("right"),l=M.length===0?"bottom":M.join("-")}const _=t.add(f[l]).round();E.setTransform(this._container,`${Xt[l]} translate(${_.x}px,${_.y}px)`),$t(this._container,l,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(hn);p&&p.focus()}_onClose(){this.remove()}},Marker:Ls,Style:Cn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,AJAXError:o.AJAXError,config:o.config,CanvasSource:Ie,GeoJSONSource:rt,ImageSource:qe,RasterDEMTileSource:ce,RasterTileSource:De,VectorTileSource:ze,VideoSource:Qe,prewarm:function(){nn().acquire(mi)},clearPrewarmedResources:function(){const p=li;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(mi),li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return et.workerCount},set workerCount(p){et.workerCount=p},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.clearTileCache(p)},workerUrl:"",addProtocol(p,t){o.config.REGISTERED_PROTOCOLS[p]=t},removeProtocol(p){delete o.config.REGISTERED_PROTOCOLS[p]}};return lr.extend(hs,{isSafari:o.isSafari,getPerformanceMetrics:o.PerformanceUtils.getPerformanceMetrics}),hs});var m=u;return m})})(Qp);var yx=Qp.exports;const al=I1(yx);var rr=(i,n,s)=>new Promise((c,u)=>{var d=x=>{try{o(s.next(x))}catch(w){u(w)}},m=x=>{try{o(s.throw(x))}catch(w){u(w)}},o=x=>x.done?c(x.value):Promise.resolve(x.value).then(d,m);o((s=s.apply(i,n)).next())}),wr=Uint8Array,io=Uint16Array,vx=Int32Array,eg=new wr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tg=new wr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bx=new wr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ig=function(i,n){for(var s=new io(31),c=0;c<31;++c)s[c]=n+=1<<i[c-1];for(var u=new vx(s[30]),c=1;c<30;++c)for(var d=s[c];d<s[c+1];++d)u[d]=d-s[c]<<5|c;return{b:s,r:u}},ng=ig(eg,2),rg=ng.b,xx=ng.r;rg[28]=258,xx[258]=28;var wx=ig(tg,0),Ix=wx.b,fh=new io(32768);for(qi=0;qi<32768;++qi)xs=(qi&43690)>>1|(qi&21845)<<1,xs=(xs&52428)>>2|(xs&13107)<<2,xs=(xs&61680)>>4|(xs&3855)<<4,fh[qi]=((xs&65280)>>8|(xs&255)<<8)>>1;var xs,qi,hl=function(i,n,s){for(var c=i.length,u=0,d=new io(n);u<c;++u)i[u]&&++d[i[u]-1];var m=new io(n);for(u=1;u<n;++u)m[u]=m[u-1]+d[u-1]<<1;var o;if(s){o=new io(1<<n);var x=15-n;for(u=0;u<c;++u)if(i[u])for(var w=u<<4|i[u],I=n-i[u],k=m[i[u]-1]++<<I,E=k|(1<<I)-1;k<=E;++k)o[fh[k]>>x]=w}else for(o=new io(c),u=0;u<c;++u)i[u]&&(o[u]=fh[m[i[u]-1]++]>>15-i[u]);return o},wl=new wr(288);for(qi=0;qi<144;++qi)wl[qi]=8;var qi;for(qi=144;qi<256;++qi)wl[qi]=9;var qi;for(qi=256;qi<280;++qi)wl[qi]=7;var qi;for(qi=280;qi<288;++qi)wl[qi]=8;var qi,sg=new wr(32);for(qi=0;qi<32;++qi)sg[qi]=5;var qi,kx=hl(wl,9,1),Tx=hl(sg,5,1),th=function(i){for(var n=i[0],s=1;s<i.length;++s)i[s]>n&&(n=i[s]);return n},jr=function(i,n,s){var c=n/8|0;return(i[c]|i[c+1]<<8)>>(n&7)&s},ih=function(i,n){var s=n/8|0;return(i[s]|i[s+1]<<8|i[s+2]<<16)>>(n&7)},Sx=function(i){return(i+7)/8|0},Ex=function(i,n,s){(n==null||n<0)&&(n=0),(s==null||s>i.length)&&(s=i.length);var c=new wr(s-n);return c.set(i.subarray(n,s)),c},Ax=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xr=function(i,n,s){var c=new Error(n||Ax[i]);if(c.code=i,Error.captureStackTrace&&Error.captureStackTrace(c,xr),!s)throw c;return c},Th=function(i,n,s,c){var u=i.length,d=c?c.length:0;if(!u||n.f&&!n.l)return s||new wr(0);var m=!s||n.i!=2,o=n.i;s||(s=new wr(u*3));var x=function(Fe){var bt=s.length;if(Fe>bt){var mi=new wr(Math.max(bt*2,Fe));mi.set(s),s=mi}},w=n.f||0,I=n.p||0,k=n.b||0,E=n.l,B=n.d,K=n.m,U=n.n,X=u*8;do{if(!E){w=jr(i,I,1);var Q=jr(i,I+1,3);if(I+=3,Q)if(Q==1)E=kx,B=Tx,K=9,U=5;else if(Q==2){var ne=jr(i,I,31)+257,oe=jr(i,I+10,15)+4,Ne=ne+jr(i,I+5,31)+1;I+=14;for(var he=new wr(Ne),fe=new wr(19),pe=0;pe<oe;++pe)fe[bx[pe]]=jr(i,I+pe*3,7);I+=oe*3;for(var Ee=th(fe),ve=(1<<Ee)-1,ze=hl(fe,Ee,1),pe=0;pe<Ne;){var De=ze[jr(i,I,ve)];I+=De&15;var Y=De>>4;if(Y<16)he[pe++]=Y;else{var j=0,ce=0;for(Y==16?(ce=3+jr(i,I,3),I+=2,j=he[pe-1]):Y==17?(ce=3+jr(i,I,7),I+=3):Y==18&&(ce=11+jr(i,I,127),I+=7);ce--;)he[pe++]=j}}var rt=he.subarray(0,ne),Ke=he.subarray(ne);K=th(rt),U=th(Ke),E=hl(rt,K,1),B=hl(Ke,U,1)}else xr(1);else{var Y=Sx(I)+4,re=i[Y-4]|i[Y-3]<<8,V=Y+re;if(V>u){o&&xr(0);break}m&&x(k+re),s.set(i.subarray(Y,V),k),n.b=k+=re,n.p=I=V*8,n.f=w;continue}if(I>X){o&&xr(0);break}}m&&x(k+131072);for(var qe=(1<<K)-1,Qe=(1<<U)-1,Ie=I;;Ie=I){var j=E[ih(i,I)&qe],lt=j>>4;if(I+=j&15,I>X){o&&xr(0);break}if(j||xr(2),lt<256)s[k++]=lt;else if(lt==256){Ie=I,E=null;break}else{var ot=lt-254;if(lt>264){var pe=lt-257,vt=eg[pe];ot=jr(i,I,(1<<vt)-1)+rg[pe],I+=vt}var gt=B[ih(i,I)&Qe],We=gt>>4;gt||xr(3),I+=gt&15;var Ke=Ix[We];if(We>3){var vt=tg[We];Ke+=ih(i,I)&(1<<vt)-1,I+=vt}if(I>X){o&&xr(0);break}m&&x(k+131072);var yt=k+ot;if(k<Ke){var ue=d-Ke,ke=Math.min(Ke,yt);for(ue+k<0&&xr(3);k<ke;++k)s[k]=c[ue+k]}for(;k<yt;k+=4)s[k]=s[k-Ke],s[k+1]=s[k+1-Ke],s[k+2]=s[k+2-Ke],s[k+3]=s[k+3-Ke];k=yt}}n.l=E,n.p=Ie,n.b=k,n.f=w,E&&(w=1,n.m=K,n.d=B,n.n=U)}while(!w);return k==s.length?s:Ex(s,0,k)},Cx=new wr(0),Mx=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&xr(6,"invalid gzip data");var n=i[3],s=10;n&4&&(s+=(i[10]|i[11]<<8)+2);for(var c=(n>>3&1)+(n>>4&1);c>0;c-=!i[s++]);return s+(n&2)},zx=function(i){var n=i.length;return(i[n-4]|i[n-3]<<8|i[n-2]<<16|i[n-1]<<24)>>>0},Dx=function(i,n){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&xr(6,"invalid zlib data"),(i[1]>>5&1)==+!n&&xr(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function Px(i,n){return Th(i,{i:2},n&&n.out,n&&n.dictionary)}function Lx(i,n){var s=Mx(i);return s+8>i.length&&xr(6,"invalid gzip data"),Th(i.subarray(s,-8),{i:2},n&&n.out||new wr(zx(i)),n&&n.dictionary)}function Bx(i,n){return Th(i.subarray(Dx(i,n&&n.dictionary),-4),{i:2},n&&n.out,n&&n.dictionary)}function dh(i,n){return i[0]==31&&i[1]==139&&i[2]==8?Lx(i,n):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?Px(i,n):Bx(i,n)}var Rx=typeof TextDecoder<"u"&&new TextDecoder,Fx=0;try{Rx.decode(Cx,{stream:!0}),Fx=1}catch{}var ag=(i,n)=>i*Math.pow(2,n),ol=(i,n)=>Math.floor(i/Math.pow(2,n)),Xc=(i,n)=>ag(i.getUint16(n+1,!0),8)+i.getUint8(n),og=(i,n)=>ag(i.getUint32(n+2,!0),16)+i.getUint16(n,!0),Ox=(i,n,s,c,u)=>{if(i!=c.getUint8(u))return i-c.getUint8(u);const d=Xc(c,u+1);if(n!=d)return n-d;const m=Xc(c,u+4);return s!=m?s-m:0},Vx=(i,n,s,c)=>{const u=lg(i,n|128,s,c);return u?{z:n,x:s,y:c,offset:u[0],length:u[1],is_dir:!0}:null},Gm=(i,n,s,c)=>{const u=lg(i,n,s,c);return u?{z:n,x:s,y:c,offset:u[0],length:u[1],is_dir:!1}:null},lg=(i,n,s,c)=>{let u=0,d=i.byteLength/17-1;for(;u<=d;){const m=d+u>>1,o=Ox(n,s,c,i,m*17);if(o>0)u=m+1;else if(o<0)d=m-1;else return[og(i,m*17+7),i.getUint32(m*17+13,!0)]}return null},Nx=(i,n)=>i.is_dir&&!n.is_dir?1:!i.is_dir&&n.is_dir?-1:i.z!==n.z?i.z-n.z:i.x!==n.x?i.x-n.x:i.y-n.y,cg=(i,n)=>{const s=i.getUint8(n*17);return{z:s&127,x:Xc(i,n*17+1),y:Xc(i,n*17+4),offset:og(i,n*17+7),length:i.getUint32(n*17+13,!0),is_dir:s>>7===1}},qm=i=>{const n=[],s=new DataView(i);for(let c=0;c<s.byteLength/17;c++)n.push(cg(s,c));return Ux(n)},Ux=i=>{i.sort(Nx);const n=new ArrayBuffer(17*i.length),s=new Uint8Array(n);for(let c=0;c<i.length;c++){const u=i[c];let d=u.z;u.is_dir&&(d=d|128),s[c*17]=d,s[c*17+1]=u.x&255,s[c*17+2]=u.x>>8&255,s[c*17+3]=u.x>>16&255,s[c*17+4]=u.y&255,s[c*17+5]=u.y>>8&255,s[c*17+6]=u.y>>16&255,s[c*17+7]=u.offset&255,s[c*17+8]=ol(u.offset,8)&255,s[c*17+9]=ol(u.offset,16)&255,s[c*17+10]=ol(u.offset,24)&255,s[c*17+11]=ol(u.offset,32)&255,s[c*17+12]=ol(u.offset,48)&255,s[c*17+13]=u.length&255,s[c*17+14]=u.length>>8&255,s[c*17+15]=u.length>>16&255,s[c*17+16]=u.length>>24&255}return n},Gx=(i,n)=>{if(i.byteLength<17)return null;const s=i.byteLength/17,c=cg(i,s-1);if(c.is_dir){const u=c.z,d=n.z-u,m=Math.trunc(n.x/(1<<d)),o=Math.trunc(n.y/(1<<d));return{z:u,x:m,y:o}}return null};function qx(i){return rr(this,null,function*(){const n=yield i.getBytes(0,512e3),s=new DataView(n.data),c=s.getUint32(4,!0),u=s.getUint16(8,!0),d=new TextDecoder("utf-8"),m=JSON.parse(d.decode(new DataView(n.data,10,c)));let o=0;m.compression==="gzip"&&(o=2);let x=0;"minzoom"in m&&(x=+m.minzoom);let w=0;"maxzoom"in m&&(w=+m.maxzoom);let I=0,k=0,E=0,B=-180,K=-85,U=180,X=85;if(m.bounds){const Y=m.bounds.split(",");B=+Y[0],K=+Y[1],U=+Y[2],X=+Y[3]}if(m.center){const Y=m.center.split(",");I=+Y[0],k=+Y[1],E=+Y[2]}return{specVersion:s.getUint16(2,!0),rootDirectoryOffset:10+c,rootDirectoryLength:u*17,jsonMetadataOffset:10,jsonMetadataLength:c,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:x,maxZoom:w,minLon:B,minLat:K,maxLon:U,maxLat:X,centerZoom:E,centerLon:I,centerLat:k,etag:n.etag}})}function jx(i,n,s,c,u,d,m){return rr(this,null,function*(){let o=yield s.getArrayBuffer(n,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(o=qm(o));const x=Gm(new DataView(o),c,u,d);if(x){let k=(yield n.getBytes(x.offset,x.length,m)).data;const E=new DataView(k);return E.getUint8(0)==31&&E.getUint8(1)==139&&(k=dh(new Uint8Array(k))),{data:k}}const w=Gx(new DataView(o),{z:c,x:u,y:d});if(w){const I=Vx(new DataView(o),w.z,w.x,w.y);if(I){let k=yield s.getArrayBuffer(n,I.offset,I.length,i);i.specVersion===1&&(k=qm(k));const E=Gm(new DataView(k),c,u,d);if(E){let K=(yield n.getBytes(E.offset,E.length,m)).data;const U=new DataView(K);return U.getUint8(0)==31&&U.getUint8(1)==139&&(K=dh(new Uint8Array(K))),{data:K}}}}})}var ug={getHeader:qx,getZxy:jx},Zx=class{constructor(){this.tile=(i,n)=>{if(i.type=="json"){const s=i.url.substr(10);let c=this.tiles.get(s);return c||(c=new jm(s),this.tiles.set(s,c)),c.getHeader().then(u=>{const d={tiles:[i.url+"/{z}/{x}/{y}"],minzoom:u.minZoom,maxzoom:u.maxZoom,bounds:[u.minLon,u.minLat,u.maxLon,u.maxLat]};n(null,d,null,null)}).catch(u=>{n(u,null,null,null)}),{cancel:()=>{}}}else{const s=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),c=i.url.match(s);if(!c)throw new Error("Invalid PMTiles protocol URL");const u=c[1];let d=this.tiles.get(u);d||(d=new jm(u),this.tiles.set(u,d));const m=c[2],o=c[3],x=c[4],w=new AbortController,I=w.signal;let k=()=>{w.abort()};return d.getHeader().then(E=>{d.getZxy(+m,+o,+x,I).then(B=>{B?n(null,new Uint8Array(B.data),B.cacheControl,B.expires):E.tileType==1?n(null,new Uint8Array,null,null):n(null,null,null,null)}).catch(B=>{B.name!=="AbortError"&&n(B,null,null,null)})}),{cancel:k}}},this.tiles=new Map}add(i){this.tiles.set(i.source.getKey(),i)}get(i){return this.tiles.get(i)}};function eo(i,n){return(n>>>0)*4294967296+(i>>>0)}function Xx(i,n){const s=n.buf;let c,u;if(u=s[n.pos++],c=(u&112)>>4,u<128||(u=s[n.pos++],c|=(u&127)<<3,u<128)||(u=s[n.pos++],c|=(u&127)<<10,u<128)||(u=s[n.pos++],c|=(u&127)<<17,u<128)||(u=s[n.pos++],c|=(u&127)<<24,u<128)||(u=s[n.pos++],c|=(u&1)<<31,u<128))return eo(i,c);throw new Error("Expected varint not more than 10 bytes")}function ll(i){const n=i.buf;let s,c;return c=n[i.pos++],s=c&127,c<128||(c=n[i.pos++],s|=(c&127)<<7,c<128)||(c=n[i.pos++],s|=(c&127)<<14,c<128)||(c=n[i.pos++],s|=(c&127)<<21,c<128)?s:(c=n[i.pos],s|=(c&15)<<28,Xx(s,i))}function Wx(i,n,s,c){if(c==0){s==1&&(n[0]=i-1-n[0],n[1]=i-1-n[1]);const u=n[0];n[0]=n[1],n[1]=u}}var Hx=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Kx(i,n,s){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(n>Math.pow(2,i)-1||s>Math.pow(2,i)-1)throw Error("tile x/y outside zoom level bounds");const c=Hx[i],u=Math.pow(2,i);let d=0,m=0,o=0;const x=[n,s];let w=u/2;for(;w>0;)d=(x[0]&w)>0?1:0,m=(x[1]&w)>0?1:0,o+=w*w*(3*d^m),Wx(w,x,d,m),w=w/2;return c+o}function hg(i,n){return rr(this,null,function*(){if(n===1||n===0)return i;if(n===2){if(typeof globalThis.DecompressionStream>"u")return dh(new Uint8Array(i));{let c=new Response(i).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(c).arrayBuffer()}}else throw Error("Compression method not supported")})}var Yx=127;function Jx(i,n){let s=0,c=i.length-1;for(;s<=c;){const u=c+s>>1,d=n-i[u].tileId;if(d>0)s=u+1;else if(d<0)c=u-1;else return i[u]}return c>=0&&(i[c].runLength===0||n-i[c].tileId<i[c].runLength)?i[c]:null}var Qx=class{constructor(i){this.url=i}getKey(){return this.url}getBytes(i,n,s){return rr(this,null,function*(){let c;s||(c=new AbortController,s=c.signal);let u=yield fetch(this.url,{signal:s,headers:{Range:"bytes="+i+"-"+(i+n-1)}});if(u.status===416&&i===0){const o=u.headers.get("Content-Range");if(!o||!o.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const x=+o.substr(8);u=yield fetch(this.url,{signal:s,headers:{Range:"bytes=0-"+(x-1)}})}if(u.status>=300)throw Error("Bad response code: "+u.status);const d=u.headers.get("Content-Length");if(u.status===200&&(!d||+d>n))throw c&&c.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:u.headers.get("ETag")||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};function Zr(i,n){const s=i.getUint32(n+4,!0),c=i.getUint32(n+0,!0);return s*Math.pow(2,32)+c}function $x(i,n){const s=new DataView(i),c=s.getUint8(7);if(c>3)throw Error(`Archive is spec version ${c} but this library supports up to spec version 3`);return{specVersion:c,rootDirectoryOffset:Zr(s,8),rootDirectoryLength:Zr(s,16),jsonMetadataOffset:Zr(s,24),jsonMetadataLength:Zr(s,32),leafDirectoryOffset:Zr(s,40),leafDirectoryLength:Zr(s,48),tileDataOffset:Zr(s,56),tileDataLength:Zr(s,64),numAddressedTiles:Zr(s,72),numTileEntries:Zr(s,80),numTileContents:Zr(s,88),clustered:s.getUint8(96)===1,internalCompression:s.getUint8(97),tileCompression:s.getUint8(98),tileType:s.getUint8(99),minZoom:s.getUint8(100),maxZoom:s.getUint8(101),minLon:s.getInt32(102,!0)/1e7,minLat:s.getInt32(106,!0)/1e7,maxLon:s.getInt32(110,!0)/1e7,maxLat:s.getInt32(114,!0)/1e7,centerZoom:s.getUint8(118),centerLon:s.getInt32(119,!0)/1e7,centerLat:s.getInt32(123,!0)/1e7,etag:n}}function fg(i){const n={buf:new Uint8Array(i),pos:0},s=ll(n),c=[];let u=0;for(let d=0;d<s;d++){const m=ll(n);c.push({tileId:u+m,offset:0,length:0,runLength:1}),u+=m}for(let d=0;d<s;d++)c[d].runLength=ll(n);for(let d=0;d<s;d++)c[d].length=ll(n);for(let d=0;d<s;d++){const m=ll(n);m===0&&d>0?c[d].offset=c[d-1].offset+c[d-1].length:c[d].offset=m-1}return c}function e2(i){const n=new DataView(i);return n.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):n.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var no=class extends Error{};function t2(i,n,s,c){return rr(this,null,function*(){const u=yield i.getBytes(0,16384);if(new DataView(u.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(e2(u.data)<3)return[yield ug.getHeader(i)];const m=u.data.slice(0,Yx);let o=u.etag;c&&u.etag!=c&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+i.getKey()),o=void 0);const x=$x(m,o);if(s){const w=u.data.slice(x.rootDirectoryOffset,x.rootDirectoryOffset+x.rootDirectoryLength),I=i.getKey()+"|"+(x.etag||"")+"|"+x.rootDirectoryOffset+"|"+x.rootDirectoryLength,k=fg(yield n(w,x.internalCompression));return[x,[I,k.length,k]]}return[x,void 0]})}function i2(i,n,s,c,u){return rr(this,null,function*(){const d=yield i.getBytes(s,c);if(u.etag&&u.etag!==d.etag)throw new no(d.etag);const m=yield n(d.data,u.internalCompression),o=fg(m);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var n2=class{constructor(i=100,n=!0,s=hg){this.cache=new Map,this.maxCacheEntries=i,this.counter=1,this.prefetch=n,this.decompress=s}getHeader(i,n){return rr(this,null,function*(){const s=i.getKey();if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const c=new Promise((u,d)=>{t2(i,this.decompress,this.prefetch,n).then(m=>{m[1]&&this.cache.set(m[1][0],{lastUsed:this.counter++,data:Promise.resolve(m[1][2])}),u(m[0]),this.prune()}).catch(m=>{d(m)})});return this.cache.set(s,{lastUsed:this.counter++,data:c}),c})}getDirectory(i,n,s,c){return rr(this,null,function*(){const u=i.getKey()+"|"+(c.etag||"")+"|"+n+"|"+s;if(this.cache.has(u))return this.cache.get(u).lastUsed=this.counter++,yield this.cache.get(u).data;const d=new Promise((m,o)=>{i2(i,this.decompress,n,s,c).then(x=>{m(x),this.prune()}).catch(x=>{o(x)})});return this.cache.set(u,{lastUsed:this.counter++,data:d}),d})}getArrayBuffer(i,n,s,c){return rr(this,null,function*(){const u=i.getKey()+"|"+(c.etag||"")+"|"+n+"|"+s;if(this.cache.has(u))return this.cache.get(u).lastUsed=this.counter++,yield this.cache.get(u).data;const d=new Promise((m,o)=>{i.getBytes(n,s).then(x=>{if(c.etag&&c.etag!==x.etag)throw new no(x.etag);m(x.data),this.cache.has(u),this.prune()}).catch(x=>{o(x)})});return this.cache.set(u,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,n;this.cache.forEach((s,c)=>{s.lastUsed<i&&(i=s.lastUsed,n=c)}),n&&this.cache.delete(n)}}invalidate(i,n){return rr(this,null,function*(){this.cache.delete(i.getKey()),yield this.getHeader(i,n)})}},jm=class{constructor(i,n,s){typeof i=="string"?this.source=new Qx(i):this.source=i,s?this.decompress=s:this.decompress=hg,n?this.cache=n:this.cache=new n2}getHeader(){return rr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,n,s,c){return rr(this,null,function*(){const u=Kx(i,n,s),d=yield this.cache.getHeader(this.source);if(d.specVersion<3)return ug.getZxy(d,this.source,this.cache,i,n,s,c);if(i<d.minZoom||i>d.maxZoom)return;let m=d.rootDirectoryOffset,o=d.rootDirectoryLength;for(let x=0;x<=3;x++){const w=yield this.cache.getDirectory(this.source,m,o,d),I=Jx(w,u);if(I)if(I.runLength>0){const k=yield this.source.getBytes(d.tileDataOffset+I.offset,I.length,c);if(d.etag&&d.etag!==k.etag)throw new no(k.etag);return{data:yield this.decompress(k.data,d.tileCompression),cacheControl:k.cacheControl,expires:k.expires}}else m=d.leafDirectoryOffset+I.offset,o=I.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,n,s,c){return rr(this,null,function*(){try{return yield this.getZxyAttempt(i,n,s,c)}catch(u){if(u instanceof no)return this.cache.invalidate(this.source,u.message),yield this.getZxyAttempt(i,n,s,c);throw u}})}getMetadataAttempt(){return rr(this,null,function*(){const i=yield this.cache.getHeader(this.source),n=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength);if(i.etag&&i.etag!==n.etag)throw new no(n.etag);const s=yield this.decompress(n.data,i.internalCompression),c=new TextDecoder("utf-8");return JSON.parse(c.decode(s))})}getMetadata(){return rr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof no)return this.cache.invalidate(this.source,i.message),yield this.getMetadataAttempt();throw i}})}};const{document:Zm}=f1;function Xm(i){let n;const s=i[20].default,c=gl(s,i,i[19],null);return{c(){c&&c.c()},l(u){c&&c.l(u)},m(u,d){c&&c.m(u,d),n=!0},p(u,d){c&&c.p&&(!n||d&524288)&&_l(c,s,u,u[19],n?vl(s,u[19],d,null):yl(u[19]),null)},i(u){n||(Le(c,u),n=!0)},o(u){Ze(c,u),n=!1},d(u){c&&c.d(u)}}}function r2(i){let n,s,c,u,d,m=i[3]&&Xm(i);return{c(){n=it("link"),c=Rt(),u=it("div"),m&&m.c(),this.h()},l(o){const x=h1("svelte-19mu9pj",Zm.head);n=nt(x,"LINK",{rel:!0,href:!0}),x.forEach(G),c=Ft(o),u=nt(o,"DIV",{id:!0,class:!0});var w=be(u);m&&m.l(w),w.forEach(G),this.h()},h(){A(n,"rel","stylesheet"),A(n,"href",s=i[1]?i[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),A(u,"id",i[0]),A(u,"class","map svelte-1tna482")},m(o,x){we(Zm.head,n),Be(o,c,x),Be(o,u,x),m&&m.m(u,null),i[21](u),d=!0},p(o,[x]){(!d||x&2&&s!==(s=o[1]?o[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&A(n,"href",s),o[3]?m?(m.p(o,x),x&8&&Le(m,1)):(m=Xm(o),m.c(),Le(m,1),m.m(u,null)):m&&(wi(),Ze(m,1,1,()=>{m=null}),Ii()),(!d||x&1)&&A(u,"id",o[0])},i(o){d||(Le(m),d=!0)},o(o){Ze(m),d=!1},d(o){G(n),o&&G(c),o&&G(u),m&&m.d(),i[21](null)}}}function s2(i=1e3){return new Promise(n=>setTimeout(n,i))}function a2(i,n,s){let{$$slots:c={},$$scope:u}=n;const d=oo();let{map:m}=n,{id:o="map"}=n,{location:x={lng:15,lat:45,zoom:1}}=n,{style:w={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=n,{css:I=null}=n,{pmtiles:k=!1}=n,{options:E={}}=n,{minzoom:B=0}=n,{maxzoom:K=14}=n,{controls:U=!1}=n,{tabbable:X=!1}=n,{zoom:Q=null}=n,{center:Y=null}=n,{pitch:re=null}=n,{bearing:V=null}=n,{interactive:ne=!0}=n,{attribution:oe=!0}=n,Ne,he={},fe=!1;Xr("map",{getMap:()=>m}),x.bounds?he.bounds=x.bounds:x.lng&&x.lat&&(he.center=[+x.lng,+x.lat],x.zoom&&(he.zoom=+x.zoom),x.pitch&&(he.pitch=+x.pitch),x.bearing&&(he.bearing=+x.bearing)),oe||(he.attributionControl=!1),he={...he,...E},Gs(()=>{if(k){let ve=new Zx;al.addProtocol("pmtiles",ve.tile)}s(4,m=new al.Map({container:Ne,style:w,minZoom:B,maxZoom:K,interactive:ne,...he})),U&&!Array.isArray(U)?m.addControl(new al.NavigationControl({showCompass:!1})):Array.isArray(U)&&U!=["locate"]&&m.addControl(new al.NavigationControl({showCompass:U.includes("compass"),visualizePitch:U.includes("pitch")})),Array.isArray(U)&&U.includes("locate")&&m.addControl(new al.GeolocateControl),m.on("load",ve=>{s(5,Q=m.getZoom()),s(6,Y=m.getCenter()),s(7,re=m.getPitch()),s(8,V=m.getBearing()),s(3,fe=!0),!X&&document.querySelector(`#${o} canvas`)&&(document.querySelector(`#${o} canvas`).tabIndex="-1"),d("load",{event:ve})}),m.on("moveend",()=>{s(5,Q=m.getZoom()),s(6,Y=m.getCenter()),s(7,re=m.getPitch()),s(8,V=m.getBearing())})}),yh(async()=>{await s2(250),m&&m.remove(),s(4,m=null)});function pe(ve){m&&m.setStyle(ve),d("style",{style:ve})}function Ee(ve){Et[ve?"unshift":"push"](()=>{Ne=ve,s(2,Ne)})}return i.$$set=ve=>{"map"in ve&&s(4,m=ve.map),"id"in ve&&s(0,o=ve.id),"location"in ve&&s(9,x=ve.location),"style"in ve&&s(10,w=ve.style),"css"in ve&&s(1,I=ve.css),"pmtiles"in ve&&s(11,k=ve.pmtiles),"options"in ve&&s(12,E=ve.options),"minzoom"in ve&&s(13,B=ve.minzoom),"maxzoom"in ve&&s(14,K=ve.maxzoom),"controls"in ve&&s(15,U=ve.controls),"tabbable"in ve&&s(16,X=ve.tabbable),"zoom"in ve&&s(5,Q=ve.zoom),"center"in ve&&s(6,Y=ve.center),"pitch"in ve&&s(7,re=ve.pitch),"bearing"in ve&&s(8,V=ve.bearing),"interactive"in ve&&s(17,ne=ve.interactive),"attribution"in ve&&s(18,oe=ve.attribution),"$$scope"in ve&&s(19,u=ve.$$scope)},i.$$.update=()=>{i.$$.dirty&1024&&pe(w)},[o,I,Ne,fe,m,Q,Y,re,V,x,w,k,E,B,K,U,X,ne,oe,u,c,Ee]}let o2=class extends pi{constructor(n){super(),gi(this,n,a2,r2,_i,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function Wm(i){let n;const s=i[12].default,c=gl(s,i,i[11],null);return{c(){c&&c.c()},l(u){c&&c.l(u)},m(u,d){c&&c.m(u,d),n=!0},p(u,d){c&&c.p&&(!n||d&2048)&&_l(c,s,u,u[11],n?vl(s,u[11],d,null):yl(u[11]),null)},i(u){n||(Le(c,u),n=!0)},o(u){Ze(c,u),n=!1},d(u){c&&c.d(u)}}}function l2(i){let n,s,c=i[0]&&Wm(i);return{c(){c&&c.c(),n=si()},l(u){c&&c.l(u),n=si()},m(u,d){c&&c.m(u,d),Be(u,n,d),s=!0},p(u,[d]){u[0]?c?(c.p(u,d),d&1&&Le(c,1)):(c=Wm(u),c.c(),Le(c,1),c.m(n.parentNode,n)):c&&(wi(),Ze(c,1,1,()=>{c=null}),Ii())},i(u){s||(Le(c),s=!0)},o(u){Ze(c),s=!1},d(u){c&&c.d(u),u&&G(n)}}}function c2(i=1e3){return new Promise(n=>setTimeout(n,i))}function u2(i,n,s){let{$$slots:c={},$$scope:u}=n,{id:d}=n,{type:m}=n,{url:o=null}=n,{props:x={}}=n,{data:w=null}=n,{layer:I=null}=n,{promoteId:k=null}=n,{minzoom:E=null}=n,{maxzoom:B=null}=n,{tilesize:K=256}=n,U=!1,X=o;const{getMap:Q}=xi("map"),Y=Q();Xr("source",{source:d,layer:I,promoteId:k}),Y.getSource(d)&&Y.removeSource(d);async function re(){await c2(100),Y.isSourceLoaded(d)?(s(0,U=!0),console.log(d+" map source loaded!")):(console.log("..."),re())}E&&(x.minzoom=E),B&&(x.maxzoom=B),I&&k?(x.promoteId={},x.promoteId[I]=k):k&&(x.promoteId=k);function V(){console.log(d+" map source loading...");let he;m=="geojson"?w?he={type:m,data:w,...x}:o&&(he={type:m,data:o,...x}):m=="vector"?(he={type:m,...x},o.slice(0,7)==="pmtiles"?he.url=o:he.tiles=[o]):m=="raster"?he={type:m,tiles:[o],tileSize:K,...x}:m=="raster-dem"&&(he={type:m,tiles:[o],tileSize:K,...x}),he&&(console.log(he),Y.addSource(d,he),re())}function ne(he){let fe=Y.getSource(d);fe&&fe.setData(he)}function oe(he){if(he!==X){let fe=Y.getSource(d);fe&&(he.slice(0,7)==="pmtiles"?fe.setUrl(he):fe.setTiles([he])),X=he}}function Ne(he){he!==X&&(Y.getSource(d).tiles=[he],Y.style.sourceCaches[d].clearTiles(),Y.style.sourceCaches[d].update(Y.transform),Y.triggerRepaint(),X=he)}return Gs(V),yh(async()=>{Y&&Y.getSource(d)&&(Y.getStyle().layers.filter(fe=>fe.source==d).forEach(fe=>{Y.removeLayer(fe.id)}),Y.removeSource(d))}),i.$$set=he=>{"id"in he&&s(2,d=he.id),"type"in he&&s(3,m=he.type),"url"in he&&s(4,o=he.url),"props"in he&&s(1,x=he.props),"data"in he&&s(5,w=he.data),"layer"in he&&s(6,I=he.layer),"promoteId"in he&&s(7,k=he.promoteId),"minzoom"in he&&s(8,E=he.minzoom),"maxzoom"in he&&s(9,B=he.maxzoom),"tilesize"in he&&s(10,K=he.tilesize),"$$scope"in he&&s(11,u=he.$$scope)},i.$$.update=()=>{i.$$.dirty&41&&m=="geojson"&&U&&ne(w),i.$$.dirty&25&&m=="vector"&&U&&oe(o),i.$$.dirty&25&&m=="raster"&&U&&Ne(o)},[U,x,d,m,o,w,I,k,E,B,K,u,c]}class h2 extends pi{constructor(n){super(),gi(this,n,u2,l2,_i,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const f2=i=>({hovered:i[0]&1}),Hm=i=>({hovered:i[0]});function d2(i){let n;const s=i[30].default,c=gl(s,i,i[29],Hm);return{c(){c&&c.c()},l(u){c&&c.l(u)},m(u,d){c&&c.m(u,d),n=!0},p(u,d){c&&c.p&&(!n||d[0]&536870913)&&_l(c,s,u,u[29],n?vl(s,u[29],d,f2):yl(u[29]),Hm)},i(u){n||(Le(c,u),n=!0)},o(u){Ze(c,u),n=!1},d(u){c&&c.d(u)}}}function m2(i,n,s){let c,{$$slots:u={},$$scope:d}=n;const m=oo();let{id:o}=n,{type:x}=n,{filter:w=null}=n,{layout:I={}}=n,{paint:k={}}=n,{data:E=null}=n,{colorKey:B="color"}=n,{nameKey:K=null}=n,{valueKey:U=null}=n,{idKey:X=null}=n,{select:Q=!1}=n,{clickIgnore:Y=!1}=n,{clickCenter:re=!1}=n,{selected:V=null}=n,{hover:ne=!1}=n,{hovered:oe=null}=n,{highlight:Ne=!1}=n,{highlightKey:he="highlighted"}=n,{highlighted:fe=[]}=n,{order:pe=null}=n,{maxzoom:Ee=null}=n,{minzoom:ve=null}=n,{sourceLayer:ze=null}=n,{visible:De=!0}=n;const{source:j,layer:ce,promoteId:rt}=xi("source"),{getMap:Ke}=xi("map"),qe=Ke();Xr("layer",{layer:o});const Qe=k1({id:null,feature:null,event:null});d1(i,Qe,ke=>s(32,c=ke)),Xr("hover",Qe),X=X||rt,ze=ze||ce;let Ie=null,lt=null,ot=[];I.visibility=De?"visible":"none";let vt={id:o,type:x,source:j,paint:k,layout:I};w&&(vt.filter=w),ze&&(vt["source-layer"]=ze),Ee&&(vt.maxzoom=Ee),ve&&(vt.minzoom=ve),Gs(()=>{qe.getLayer(o)&&qe.removeLayer(o),qe.addLayer(vt,pe)});function gt(ke,Fe=B){if(console.log("updating colors..."),K||U)for(const bt of ke)qe.setFeatureState({source:j,sourceLayer:ze,id:bt[X]},{color:Fe?bt[Fe]:null,name:K?bt[K]:null,value:U?bt[U]:null});else for(const bt of ke)qe.setFeatureState({source:j,sourceLayer:ze,id:bt[X]},{color:bt[Fe]})}function We(ke){qe.getLayer(o)&&qe.setFilter(o,ke)}function yt(ke){if(qe.getLayer(o))for(const Fe in ke)qe.setPaintProperty(o,Fe,ke[Fe])}function ue(ke){qe.getLayer(o)&&qe.setLayoutProperty(o,"visibility",ke?"visible":"none")}return Q&&qe.on("click",o,ke=>{if(ke.features.length>0&&!Y){let Fe=ke.features[0];if(s(2,V=Fe.id),m("select",{id:V,feature:Fe,event:ke}),Ie&&qe.setFeatureState({source:j,sourceLayer:ze,id:Ie},{selected:!1}),qe.setFeatureState({source:j,sourceLayer:ze,id:V},{selected:!0}),re){let bt=centroid(ke.features[0].toJSON().geometry);qe.flyTo({center:bt.geometry.coordinates})}s(26,Ie=V)}}),ne&&(qe.on("mousemove",o,ke=>{if(ke.features.length>0){oe&&qe.setFeatureState({source:j,sourceLayer:ze,id:oe},{hovered:!1});let Fe=ke.features[0];s(0,oe=s(27,lt=Fe.id)),Qe.set({id:oe,feature:Fe,event:ke}),m("hover",c),qe.setFeatureState({source:j,sourceLayer:ze,id:oe},{hovered:!0}),qe.getCanvas().style.cursor="pointer"}}),qe.on("mouseleave",o,ke=>{oe&&qe.setFeatureState({source:j,sourceLayer:ze,id:oe},{hovered:!1}),s(0,oe=s(27,lt=null)),Qe.set({id:null,feature:null,event:ke}),m("hover",c),qe.getCanvas().style.cursor=""})),yh(async()=>{qe&&qe.getLayer(o)&&qe.removeLayer(o)}),i.$$set=ke=>{"id"in ke&&s(6,o=ke.id),"type"in ke&&s(7,x=ke.type),"filter"in ke&&s(8,w=ke.filter),"layout"in ke&&s(4,I=ke.layout),"paint"in ke&&s(9,k=ke.paint),"data"in ke&&s(10,E=ke.data),"colorKey"in ke&&s(11,B=ke.colorKey),"nameKey"in ke&&s(12,K=ke.nameKey),"valueKey"in ke&&s(13,U=ke.valueKey),"idKey"in ke&&s(5,X=ke.idKey),"select"in ke&&s(14,Q=ke.select),"clickIgnore"in ke&&s(15,Y=ke.clickIgnore),"clickCenter"in ke&&s(16,re=ke.clickCenter),"selected"in ke&&s(2,V=ke.selected),"hover"in ke&&s(17,ne=ke.hover),"hovered"in ke&&s(0,oe=ke.hovered),"highlight"in ke&&s(18,Ne=ke.highlight),"highlightKey"in ke&&s(19,he=ke.highlightKey),"highlighted"in ke&&s(20,fe=ke.highlighted),"order"in ke&&s(21,pe=ke.order),"maxzoom"in ke&&s(22,Ee=ke.maxzoom),"minzoom"in ke&&s(23,ve=ke.minzoom),"sourceLayer"in ke&&s(3,ze=ke.sourceLayer),"visible"in ke&&s(24,De=ke.visible),"$$scope"in ke&&s(29,d=ke.$$scope)},i.$$.update=()=>{if(i.$$.dirty[0]&3072&&E&&gt(E,B),i.$$.dirty[0]&256&&We(w),i.$$.dirty[0]&512&&yt(k),i.$$.dirty[0]&16777216&&ue(De),i.$$.dirty[0]&270270472&&Ne&&fe!=ot){if(ot[0])for(const ke of ot){let Fe={};Fe[he]=!1,qe.setFeatureState({source:j,sourceLayer:ze,id:ke},Fe)}if(s(28,ot=fe),fe[0])for(const ke of fe){let Fe={};Fe[he]=!0,qe.setFeatureState({source:j,sourceLayer:ze,id:ke},Fe)}}i.$$.dirty[0]&67125260&&Q&&V!=Ie&&(Ie&&qe.setFeatureState({source:j,sourceLayer:ze,id:Ie},{selected:!1}),V&&qe.setFeatureState({source:j,sourceLayer:ze,id:V},{selected:!0}),s(26,Ie=V)),i.$$.dirty[0]&134348809&&ne&&oe!=lt&&(lt&&qe.setFeatureState({source:j,sourceLayer:ze,id:lt},{hovered:!1}),oe&&qe.setFeatureState({source:j,sourceLayer:ze,id:oe},{hovered:!0}),s(27,lt=oe))},[oe,Qe,V,ze,I,X,o,x,w,k,E,B,K,U,Q,Y,re,ne,Ne,he,fe,pe,Ee,ve,De,gt,Ie,lt,ot,d,u]}class Km extends pi{constructor(n){super(),gi(this,n,m2,d2,_i,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function Ym(i){let n,s;return n=new h2({props:{id:"geojson",type:"geojson",data:i[3],promoteId:"areacd",$$slots:{default:[p2]},$$scope:{ctx:i}}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u&8&&(d.data=c[3]),u&16777235&&(d.$$scope={dirty:u,ctx:c}),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function Jm(i){let n,s,c,u;return n=new Km({props:{id:"fill",type:"fill",data:i[4],idKey:"id",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]},hover:!0,hovered:i[1],select:!0,selected:i[0]}}),n.$on("hover",i[16]),n.$on("select",i[17]),c=new Km({props:{id:"line",type:"line",paint:{"line-color":"black"}}}),{c(){Nt(n.$$.fragment),s=Rt(),Nt(c.$$.fragment)},l(d){Kt(n.$$.fragment,d),s=Ft(d),Kt(c.$$.fragment,d)},m(d,m){Ut(n,d,m),Be(d,s,m),Ut(c,d,m),u=!0},p(d,m){const o={};m&16&&(o.data=d[4]),m&2&&(o.hovered=d[1]),m&1&&(o.selected=d[0]),n.$set(o)},i(d){u||(Le(n.$$.fragment,d),Le(c.$$.fragment,d),u=!0)},o(d){Ze(n.$$.fragment,d),Ze(c.$$.fragment,d),u=!1},d(d){Gt(n,d),d&&G(s),Gt(c,d)}}}function p2(i){let n,s,c=i[4]&&Jm(i);return{c(){c&&c.c(),n=si()},l(u){c&&c.l(u),n=si()},m(u,d){c&&c.m(u,d),Be(u,n,d),s=!0},p(u,d){u[4]?c?(c.p(u,d),d&16&&Le(c,1)):(c=Jm(u),c.c(),Le(c,1),c.m(n.parentNode,n)):c&&(wi(),Ze(c,1,1,()=>{c=null}),Ii())},i(u){s||(Le(c),s=!0)},o(u){Ze(c),s=!1},d(u){c&&c.d(u),u&&G(n)}}}function g2(i){let n,s,c=i[3]&&Ym(i);return{c(){c&&c.c(),n=si()},l(u){c&&c.l(u),n=si()},m(u,d){c&&c.m(u,d),Be(u,n,d),s=!0},p(u,d){u[3]?c?(c.p(u,d),d&8&&Le(c,1)):(c=Ym(u),c.c(),Le(c,1),c.m(n.parentNode,n)):c&&(wi(),Ze(c,1,1,()=>{c=null}),Ii())},i(u){s||(Le(c),s=!0)},o(u){Ze(c),s=!1},d(u){c&&c.d(u),u&&G(n)}}}function _2(i){let n,s,c;return s=new o2({props:{location:{bounds:i[5][i[2]]},controls:!0,style:"https://bothness.github.io/ons-basemaps/data/style-omt.json",$$slots:{default:[g2]},$$scope:{ctx:i}}}),{c(){n=it("div"),Nt(s.$$.fragment),this.h()},l(u){n=nt(u,"DIV",{class:!0});var d=be(n);Kt(s.$$.fragment,d),d.forEach(G),this.h()},h(){A(n,"class","map-container svelte-14fcb2l")},m(u,d){Be(u,n,d),Ut(s,n,null),c=!0},p(u,[d]){const m={};d&4&&(m.location={bounds:u[5][u[2]]}),d&16777243&&(m.$$scope={dirty:d,ctx:u}),s.$set(m)},i(u){c||(Le(s.$$.fragment,u),c=!0)},o(u){Ze(s.$$.fragment,u),c=!1},d(u){u&&G(n),Gt(s)}}}function y2(i,n,s){let{geoType:c="ltla"}=n,{year:u=2023}=n,{data:d=[]}=n,{idKey:m="areacd"}=n,{valueKey:o="value"}=n,{colorsInit:x=["#b2182b","#d6604d","#fddbc7","#d1e5f0","#4393c3","#2166ac"]}=n,{selected:w=null}=n,{hovered:I=null}=n,{mapRange:k="uk"}=n,{colourObj:E}=n,{useBreaks:B=!0}=n,{breaks:K}=n,{polarity:U=1}=n,X,Q,Y,re=U==-1?x.slice().reverse():x;const V={uk:[[-9,49],[2,61]],ew:[[-6,50],[2,56]]};function ne(Ee,ve,ze){if(B){for(let De=1;De<ve.length;De++)if(Ee<ve[De])return ze[De-1];return ze[ze.length-1]}else return E[Ee]}function oe(Ee,ve,ze,De){let j=Ee.map(rt=>({id:rt[ve],value:rt[ze]})),ce=j.map(rt=>rt.value).sort((rt,Ke)=>rt-Ke);return s(6,K=v1(ce)),j.forEach(rt=>rt.color=ne(rt.value,K,De)),{mapdata:j,breaks:K}}function Ne(Ee,ve,ze,De){const j=oe(Ee,ve,ze,De);s(6,K=j.breaks),s(4,Y=j.mapdata)}function he(Ee,ve){if(X){const ze=A1(X,Ee);ze.features=ze.features.filter(De=>!0),s(3,Q=ze)}}Gs(async()=>{X=await(await fetch(`${so}/data/topojson/topo.json`)).json(),he(c)});function fe(Ee){ul.call(this,i,Ee)}function pe(Ee){ul.call(this,i,Ee)}return i.$$set=Ee=>{"geoType"in Ee&&s(7,c=Ee.geoType),"year"in Ee&&s(8,u=Ee.year),"data"in Ee&&s(9,d=Ee.data),"idKey"in Ee&&s(10,m=Ee.idKey),"valueKey"in Ee&&s(11,o=Ee.valueKey),"colorsInit"in Ee&&s(12,x=Ee.colorsInit),"selected"in Ee&&s(0,w=Ee.selected),"hovered"in Ee&&s(1,I=Ee.hovered),"mapRange"in Ee&&s(2,k=Ee.mapRange),"colourObj"in Ee&&s(13,E=Ee.colourObj),"useBreaks"in Ee&&s(14,B=Ee.useBreaks),"breaks"in Ee&&s(6,K=Ee.breaks),"polarity"in Ee&&s(15,U=Ee.polarity)},i.$$.update=()=>{i.$$.dirty&3584&&Ne(d,m,o,re),i.$$.dirty&384&&he(c)},[w,I,k,Q,Y,V,K,c,u,d,m,o,x,E,B,U,fe,pe]}class v2 extends pi{constructor(n){super(),gi(this,n,y2,_2,_i,{geoType:7,year:8,data:9,idKey:10,valueKey:11,colorsInit:12,selected:0,hovered:1,mapRange:2,colourObj:13,useBreaks:14,breaks:6,polarity:15})}}function Qm(i,n,s){const c=i.slice();return c[9]=n[s],c[11]=s,c}function b2(i){let n,s=i[4]+Hr(Ir(i[9],i[1].decimalPlaces))+i[3]+"",c,u;return{c(){n=ft("text"),c=fi(s),this.h()},l(d){n=dt(d,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,stroke:!0,fill:!0,"stroke-width":!0});var m=be(n);c=di(m,s),m.forEach(G),this.h()},h(){A(n,"x",u=i[11]*(i[2]-20)/i[0].length),A(n,"y","45"),A(n,"text-anchor","middle"),A(n,"font-size","14px"),A(n,"stroke","black"),A(n,"fill","black"),A(n,"stroke-width","0.5px")},m(d,m){Be(d,n,m),we(n,c)},p(d,m){m&27&&s!==(s=d[4]+Hr(Ir(d[9],d[1].decimalPlaces))+d[3]+"")&&zi(c,s),m&5&&u!==(u=d[11]*(d[2]-20)/d[0].length)&&A(n,"x",u)},d(d){d&&G(n)}}}function $m(i){let n,s,c,u,d,m,o,x,w=i[11]>0&&b2(i);return{c(){n=ft("rect"),d=ft("line"),w&&w.c(),x=si(),this.h()},l(I){n=dt(I,"rect",{x:!0,width:!0,y:!0,height:!0,stroke:!0,fill:!0});var k=be(n);k.forEach(G),d=dt(I,"line",{x1:!0,x2:!0,y1:!0,y2:!0,"stroke-width":!0,stroke:!0}),be(d).forEach(G),w&&w.l(I),x=si(),this.h()},h(){A(n,"x",s=i[11]*(i[2]-20)/i[0].length),A(n,"width",c=(i[2]-20)/i[0].length),A(n,"y","0"),A(n,"height","20"),A(n,"stroke","none"),A(n,"fill",u=i[5][i[11]]),A(d,"x1",m=i[11]*(i[2]-20)/i[0].length),A(d,"x2",o=i[11]*(i[2]-20)/i[0].length),A(d,"y1","0"),A(d,"y2","30"),A(d,"stroke-width","2px"),A(d,"stroke","black")},m(I,k){Be(I,n,k),Be(I,d,k),w&&w.m(I,k),Be(I,x,k)},p(I,k){k&5&&s!==(s=I[11]*(I[2]-20)/I[0].length)&&A(n,"x",s),k&5&&c!==(c=(I[2]-20)/I[0].length)&&A(n,"width",c),k&32&&u!==(u=I[5][I[11]])&&A(n,"fill",u),k&5&&m!==(m=I[11]*(I[2]-20)/I[0].length)&&A(d,"x1",m),k&5&&o!==(o=I[11]*(I[2]-20)/I[0].length)&&A(d,"x2",o),I[11]>0&&w.p(I,k)},d(I){I&&G(n),I&&G(d),w&&w.d(I),I&&G(x)}}}function x2(i){let n,s,c,u,d,m,o,x=i[0],w=[];for(let I=0;I<x.length;I+=1)w[I]=$m(Qm(i,x,I));return{c(){n=it("div"),s=ft("svg"),c=ft("g");for(let I=0;I<w.length;I+=1)w[I].c();u=ft("line"),this.h()},l(I){n=nt(I,"DIV",{class:!0});var k=be(n);s=dt(k,"svg",{width:!0,height:!0});var E=be(s);c=dt(E,"g",{transform:!0});var B=be(c);for(let K=0;K<w.length;K+=1)w[K].l(B);u=dt(B,"line",{x1:!0,x2:!0,y1:!0,y2:!0,"stroke-width":!0,stroke:!0}),be(u).forEach(G),B.forEach(G),E.forEach(G),k.forEach(G),this.h()},h(){A(u,"x1",d=i[2]-20),A(u,"x2",m=i[2]-20),A(u,"y1","0"),A(u,"y2","30"),A(u,"stroke-width","2px"),A(u,"stroke","black"),A(c,"transform","translate(10,10)"),A(s,"width",i[2]),A(s,"height",i[6]),A(n,"class","svg-container"),ao(()=>i[7].call(n))},m(I,k){Be(I,n,k),we(n,s),we(s,c);for(let E=0;E<w.length;E+=1)w[E]&&w[E].m(c,null);we(c,u),o=bl(n,i[7].bind(n))},p(I,[k]){if(k&63){x=I[0];let E;for(E=0;E<x.length;E+=1){const B=Qm(I,x,E);w[E]?w[E].p(B,k):(w[E]=$m(B),w[E].c(),w[E].m(c,u))}for(;E<w.length;E+=1)w[E].d(1);w.length=x.length}k&4&&d!==(d=I[2]-20)&&A(u,"x1",d),k&4&&m!==(m=I[2]-20)&&A(u,"x2",m),k&4&&A(s,"width",I[2])},i:hi,o:hi,d(I){I&&G(n),$i(w,I),o()}}}function w2(i,n,s){let c,u,d,{breaks:m,metadata:o}=n,x=400,w=60,I=["#b2182b","#d6604d","#fddbc7","#d1e5f0","#4393c3","#2166ac"];function k(){x=this.clientWidth,s(2,x)}return i.$$set=E=>{"breaks"in E&&s(0,m=E.breaks),"metadata"in E&&s(1,o=E.metadata)},i.$$.update=()=>{i.$$.dirty&2&&s(5,c=o.polarity==-1?I.slice().reverse():I),i.$$.dirty&2&&s(4,u=o.prefix===null?"":o.prefix),i.$$.dirty&2&&s(3,d=o.suffix===null?"":o.suffix)},[m,o,x,d,u,c,w,k]}class I2 extends pi{constructor(n){super(),gi(this,n,w2,x2,_i,{breaks:0,metadata:1})}}function ep(i){let n,s,c;function u(m){i[9](m)}let d={data:i[0],idKey:"areacd",valueKey:"value",mapRange:"uk",useBreaks:!0,polarity:i[2].polarity};return i[4]!==void 0&&(d.breaks=i[4]),n=new v2({props:d}),Et.push(()=>Bt(n,"breaks",u)),{c(){Nt(n.$$.fragment)},l(m){Kt(n.$$.fragment,m)},m(m,o){Ut(n,m,o),c=!0},p(m,o){const x={};o&1&&(x.data=m[0]),o&4&&(x.polarity=m[2].polarity),!s&&o&16&&(s=!0,x.breaks=m[4],Ot(()=>s=!1)),n.$set(x)},i(m){c||(Le(n.$$.fragment,m),c=!0)},o(m){Ze(n.$$.fragment,m),c=!1},d(m){Gt(n,m)}}}function k2(i){let n,s,c,u,d,m,o,x,w,I=i[2].subtitle+" in",k,E,B=i[1].maxXDomain+"",K,U,X,Q,Y,re;function V(Ne){i[8](Ne)}let ne={name:"select-indicator-dropdown",optionsArray:i[5],width:"300px"};i[3]!==void 0&&(ne.chosenId=i[3]),d=new kh({props:ne}),Et.push(()=>Bt(d,"chosenId",V)),Q=new I2({props:{breaks:i[4],metadata:i[2]}});let oe=i[0]&&ep(i);return{c(){n=it("div"),s=it("div"),c=it("div"),u=it("div"),Nt(d.$$.fragment),o=Rt(),x=it("div"),w=it("p"),k=fi(I),E=Rt(),K=fi(B),U=Rt(),X=it("div"),Nt(Q.$$.fragment),Y=Rt(),oe&&oe.c(),this.h()},l(Ne){n=nt(Ne,"DIV",{class:!0});var he=be(n);s=nt(he,"DIV",{class:!0});var fe=be(s);c=nt(fe,"DIV",{class:!0});var pe=be(c);u=nt(pe,"DIV",{class:!0});var Ee=be(u);Kt(d.$$.fragment,Ee),Ee.forEach(G),pe.forEach(G),o=Ft(fe),x=nt(fe,"DIV",{class:!0});var ve=be(x);w=nt(ve,"P",{class:!0});var ze=be(w);k=di(ze,I),E=Ft(ze),K=di(ze,B),ze.forEach(G),ve.forEach(G),U=Ft(fe),X=nt(fe,"DIV",{class:!0});var De=be(X);Kt(Q.$$.fragment,De),De.forEach(G),fe.forEach(G),Y=Ft(he),oe&&oe.l(he),he.forEach(G),this.h()},h(){A(u,"class","dropdown-container svelte-18064lb"),A(c,"class","title-container svelte-18064lb"),A(w,"class","svelte-18064lb"),A(x,"class","subtitle-container svelte-18064lb"),A(X,"class","map-scale-container svelte-18064lb"),A(s,"class","legend-container svelte-18064lb"),A(n,"class","legend-and-map-container svelte-18064lb")},m(Ne,he){Be(Ne,n,he),we(n,s),we(s,c),we(c,u),Ut(d,u,null),we(s,o),we(s,x),we(x,w),we(w,k),we(w,E),we(w,K),we(s,U),we(s,X),Ut(Q,X,null),we(n,Y),oe&&oe.m(n,null),re=!0},p(Ne,[he]){const fe={};!m&&he&8&&(m=!0,fe.chosenId=Ne[3],Ot(()=>m=!1)),d.$set(fe),(!re||he&4)&&I!==(I=Ne[2].subtitle+" in")&&zi(k,I),(!re||he&2)&&B!==(B=Ne[1].maxXDomain+"")&&zi(K,B);const pe={};he&16&&(pe.breaks=Ne[4]),he&4&&(pe.metadata=Ne[2]),Q.$set(pe),Ne[0]?oe?(oe.p(Ne,he),he&1&&Le(oe,1)):(oe=ep(Ne),oe.c(),Le(oe,1),oe.m(n,null)):oe&&(wi(),Ze(oe,1,1,()=>{oe=null}),Ii())},i(Ne){re||(Le(d.$$.fragment,Ne),Le(Q.$$.fragment,Ne),Le(oe),re=!0)},o(Ne){Ze(d.$$.fragment,Ne),Ze(Q.$$.fragment,Ne),Ze(oe),re=!1},d(Ne){Ne&&G(n),Gt(d),Gt(Q),oe&&oe.d()}}}function T2(i,n,s){let c,u,d,m,{indicatorsList:o,combinedData:x}=n,w=xi("indicatorsMetadata"),I=xi("indicators").filter(Y=>o.includes(Y.id)),k=xi("indicatorsCalculations").filter(Y=>o.includes(Y.id));xi("periodsLookup");let B=xi("areasGeogLevel").filter(Y=>["both","lower"].includes(Y.level)).map(Y=>Y.areacd),K=I.map(Y=>Y.label),U=[];function X(Y){c=Y,s(3,c),s(5,K)}function Q(Y){U=Y,s(4,U)}return i.$$set=Y=>{"indicatorsList"in Y&&s(6,o=Y.indicatorsList),"combinedData"in Y&&s(7,x=Y.combinedData)},i.$$.update=()=>{i.$$.dirty&8&&I.find(Y=>Y.label==c).id,i.$$.dirty&8&&s(2,u=w.find(Y=>Y.label===c)),i.$$.dirty&4&&s(1,d=k.find(Y=>Y.code==u.code)),i.$$.dirty&130&&s(0,m=x.filter(Y=>B.includes(Y.areacd)&Y.xDomainNumb==d.maxXDomain&Y.id==d.id)),i.$$.dirty&1&&console.log(m)},s(3,c=K[0]),[m,d,u,c,U,K,o,x,X,Q]}class S2 extends pi{constructor(n){super(),gi(this,n,T2,k2,_i,{indicatorsList:6,combinedData:7})}}function tp(i,n,s){const c=i.slice();return c[9]=n[s],c[11]=s,c}function ip(i){let n,s=i[5],c=[];for(let u=0;u<s.length;u+=1)c[u]=np(tp(i,s,u));return{c(){for(let u=0;u<c.length;u+=1)c[u].c();n=si()},l(u){for(let d=0;d<c.length;d+=1)c[d].l(u);n=si()},m(u,d){for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(u,d);Be(u,n,d)},p(u,d){if(d&50){s=u[5];let m;for(m=0;m<s.length;m+=1){const o=tp(u,s,m);c[m]?c[m].p(o,d):(c[m]=np(o),c[m].c(),c[m].m(n.parentNode,n))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},d(u){$i(c,u),u&&G(n)}}}function np(i){let n,s,c,u,d,m=i[4].prefix+Hr(Ir(i[9],0))+i[4].suffix+"",o,x;return{c(){n=ft("g"),s=ft("line"),d=ft("text"),o=fi(m),this.h()},l(w){n=dt(w,"g",{class:!0});var I=be(n);s=dt(I,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0}),be(s).forEach(G),d=dt(I,"text",{"text-anchor":!0,x:!0,y:!0,stroke:!0,fill:!0,"font-size":!0});var k=be(d);o=di(k,m),k.forEach(G),I.forEach(G),this.h()},h(){A(s,"x1","0"),A(s,"x2","-8"),A(s,"y1",c=i[1](i[9])),A(s,"y2",u=i[1](i[9])),A(s,"stroke","black"),A(d,"text-anchor","end"),A(d,"x",-10),A(d,"y",x=i[1](i[9])+5),A(d,"stroke","none"),A(d,"fill","#333"),A(d,"font-size","14px"),A(n,"class","tick")},m(w,I){Be(w,n,I),we(n,s),we(n,d),we(d,o)},p(w,I){I&34&&c!==(c=w[1](w[9]))&&A(s,"y1",c),I&34&&u!==(u=w[1](w[9]))&&A(s,"y2",u),I&48&&m!==(m=w[4].prefix+Hr(Ir(w[9],0))+w[4].suffix+"")&&zi(o,m),I&34&&x!==(x=w[1](w[9])+5)&&A(d,"y",x)},d(w){w&&G(n)}}}function E2(i){let n,s,c,u,d,m=i[3]==0&&ip(i);return{c(){n=ft("g"),s=ft("line"),m&&m.c(),this.h()},l(o){n=dt(o,"g",{class:!0,transform:!0});var x=be(n);s=dt(x,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0}),be(s).forEach(G),m&&m.l(x),x.forEach(G),this.h()},h(){A(s,"x1","0"),A(s,"x2","0"),A(s,"y1",c=i[1](i[0][1])),A(s,"y2",u=i[1](i[0][0])),A(s,"stroke","black"),A(n,"class","yAxis"),A(n,"transform",d="translate("+-i[2]+",0)")},m(o,x){Be(o,n,x),we(n,s),m&&m.m(n,null)},p(o,[x]){x&3&&c!==(c=o[1](o[0][1]))&&A(s,"y1",c),x&3&&u!==(u=o[1](o[0][0]))&&A(s,"y2",u),o[3]==0?m?m.p(o,x):(m=ip(o),m.c(),m.m(n,null)):m&&(m.d(1),m=null),x&4&&d!==(d="translate("+-o[2]+",0)")&&A(n,"transform",d)},i:hi,o:hi,d(o){o&&G(n),m&&m.d()}}}function A2(i,n,s){let c,u,d,{yDomain:m,y:o,yAxisOffset:x=0,column:w=0,metadata:I}=n,k=[];return i.$$set=E=>{"yDomain"in E&&s(0,m=E.yDomain),"y"in E&&s(1,o=E.y),"yAxisOffset"in E&&s(2,x=E.yAxisOffset),"column"in E&&s(3,w=E.column),"metadata"in E&&s(4,I=E.metadata)},i.$$.update=()=>{if(i.$$.dirty&1&&s(8,c=Math.abs(m[1]-m[0])),i.$$.dirty&256&&s(7,u=10**Math.floor(Math.log10(c))),i.$$.dirty&384&&s(6,d=c/u<=1.5?u/5:c/u<=3?u/2:c/u<=6?u:u*2),i.$$.dirty&97){s(5,k=[]);for(let E=Math.ceil(m[0]);E<=Math.floor(m[1]);E++)E%d==0&&k.push(E)}},[m,o,x,w,I,k,d,u,c]}class C2 extends pi{constructor(n){super(),gi(this,n,A2,E2,_i,{yDomain:0,y:1,yAxisOffset:2,column:3,metadata:4})}}function rp(i,n,s){const c=i.slice();return c[8]=n[s],c[10]=s,c}function sp(i){let n,s,c,u;return{c(){n=ft("line"),this.h()},l(d){n=dt(d,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,opacity:!0}),be(n).forEach(G),this.h()},h(){A(n,"y1","0"),A(n,"y2",s=-i[3]),A(n,"x1",c=i[1](i[8])),A(n,"x2",u=i[1](i[8])),A(n,"stroke","black"),A(n,"opacity","0.1")},m(d,m){Be(d,n,m)},p(d,m){m&8&&s!==(s=-d[3])&&A(n,"y2",s),m&2&&c!==(c=d[1](d[8]))&&A(n,"x1",c),m&2&&u!==(u=d[1](d[8]))&&A(n,"x2",u)},d(d){d&&G(n)}}}function ap(i){let n,s,c,u,d,m=i[8]+"",o,x,w=i[4]&&sp(i);return{c(){n=ft("g"),s=ft("line"),d=ft("text"),o=fi(m),w&&w.c(),this.h()},l(I){n=dt(I,"g",{class:!0});var k=be(n);s=dt(k,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0}),be(s).forEach(G),d=dt(k,"text",{"text-anchor":!0,y:!0,x:!0,stroke:!0,fill:!0,"font-size":!0});var E=be(d);o=di(E,m),E.forEach(G),w&&w.l(k),k.forEach(G),this.h()},h(){A(s,"y1","0"),A(s,"y2","8"),A(s,"x1",c=i[1](i[8])),A(s,"x2",u=i[1](i[8])),A(s,"stroke","black"),A(d,"text-anchor","middle"),A(d,"y",20),A(d,"x",x=i[1](i[8])),A(d,"stroke","none"),A(d,"fill","#333"),A(d,"font-size","14px"),A(n,"class","tick")},m(I,k){Be(I,n,k),we(n,s),we(n,d),we(d,o),w&&w.m(n,null)},p(I,k){k&2&&c!==(c=I[1](I[8]))&&A(s,"x1",c),k&2&&u!==(u=I[1](I[8]))&&A(s,"x2",u),k&2&&x!==(x=I[1](I[8]))&&A(d,"x",x),I[4]?w?w.p(I,k):(w=sp(I),w.c(),w.m(n,null)):w&&(w.d(1),w=null)},d(I){I&&G(n),w&&w.d()}}}function M2(i){let n,s,c,u,d,m=i[5],o=[];for(let x=0;x<m.length;x+=1)o[x]=ap(rp(i,m,x));return{c(){n=ft("g"),s=ft("line");for(let x=0;x<o.length;x+=1)o[x].c();this.h()},l(x){n=dt(x,"g",{class:!0,transform:!0});var w=be(n);s=dt(w,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0}),be(s).forEach(G);for(let I=0;I<o.length;I+=1)o[I].l(w);w.forEach(G),this.h()},h(){A(s,"y1","0"),A(s,"y2","0"),A(s,"x1",c=i[1](i[0][0])),A(s,"x2",u=i[1](i[0][1])),A(s,"stroke","black"),A(n,"class","xAxis"),A(n,"transform",d="translate(0,"+(i[2]+i[3])+")")},m(x,w){Be(x,n,w),we(n,s);for(let I=0;I<o.length;I+=1)o[I]&&o[I].m(n,null)},p(x,[w]){if(w&3&&c!==(c=x[1](x[0][0]))&&A(s,"x1",c),w&3&&u!==(u=x[1](x[0][1]))&&A(s,"x2",u),w&58){m=x[5];let I;for(I=0;I<m.length;I+=1){const k=rp(x,m,I);o[I]?o[I].p(k,w):(o[I]=ap(k),o[I].c(),o[I].m(n,null))}for(;I<o.length;I+=1)o[I].d(1);o.length=m.length}w&12&&d!==(d="translate(0,"+(x[2]+x[3])+")")&&A(n,"transform",d)},i:hi,o:hi,d(x){x&&G(n),$i(o,x)}}}function z2(i,n,s){let{xDomain:c,x:u,xAxisOffset:d=0,chartHeight:m,gridlines:o=!1}=n,x=Math.abs(c[1]-c[0]),w=x>=15?5:x>=6?2:1,I=[];for(let k=Math.floor(c[0]);k<=Math.ceil(c[1]);k++)k%w==0&&I.push(k);return i.$$set=k=>{"xDomain"in k&&s(0,c=k.xDomain),"x"in k&&s(1,u=k.x),"xAxisOffset"in k&&s(2,d=k.xAxisOffset),"chartHeight"in k&&s(3,m=k.chartHeight),"gridlines"in k&&s(4,o=k.gridlines)},[c,u,d,m,o,I]}class D2 extends pi{constructor(n){super(),gi(this,n,z2,M2,_i,{xDomain:0,x:1,xAxisOffset:2,chartHeight:3,gridlines:4})}}function op(i,n,s){const c=i.slice();return c[12]=n[s],c[14]=s,c}function lp(i){let n,s=i[2],c=[];for(let u=0;u<s.length;u+=1)c[u]=cp(op(i,s,u));return{c(){n=ft("g");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){n=dt(u,"g",{class:!0});var d=be(n);for(let m=0;m<c.length;m+=1)c[m].l(d);d.forEach(G),this.h()},h(){A(n,"class","pointsContainer")},m(u,d){Be(u,n,d);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(n,null)},p(u,d){if(d&125){s=u[2];let m;for(m=0;m<s.length;m+=1){const o=op(u,s,m);c[m]?c[m].p(o,d):(c[m]=cp(o),c[m].c(),c[m].m(n,null))}for(;m<c.length;m+=1)c[m].d(1);c.length=s.length}},d(u){u&&G(n),$i(c,u)}}}function P2(i){let n,s;return{c(){n=ft("circle"),this.h()},l(c){n=dt(c,"circle",{r:!0,fill:!0,stroke:!0});var u=be(n);u.forEach(G),this.h()},h(){A(n,"r","3.5"),A(n,"fill",s=i[0]===i[3]?"#F39431":ni[i[6].role]),A(n,"stroke","white")},m(c,u){Be(c,n,u)},p(c,u){u&73&&s!==(s=c[0]===c[3]?"#F39431":ni[c[6].role])&&A(n,"fill",s)},d(c){c&&G(n)}}}function L2(i){let n,s,c;return{c(){n=ft("rect"),this.h()},l(u){n=dt(u,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0});var d=be(n);d.forEach(G),this.h()},h(){A(n,"transform",s=["country","uk"].includes(i[6].role)?"rotate(45)":null),A(n,"x","-3"),A(n,"y","-3"),A(n,"width","6"),A(n,"height","6"),A(n,"fill",c=i[0]===i[3]?"#F39431":ni[i[6].role]),A(n,"stroke","white")},m(u,d){Be(u,n,d)},p(u,d){d&64&&s!==(s=["country","uk"].includes(u[6].role)?"rotate(45)":null)&&A(n,"transform",s),d&73&&c!==(c=u[0]===u[3]?"#F39431":ni[u[6].role])&&A(n,"fill",c)},d(u){u&&G(n)}}}function cp(i){let n,s,c;function u(o,x){return x&64&&(s=null),s==null&&(s=!!["parent","country","uk"].includes(o[6].role)),s?L2:P2}let d=u(i,-1),m=d(i);return{c(){n=ft("g"),m.c(),this.h()},l(o){n=dt(o,"g",{transform:!0});var x=be(n);m.l(x),x.forEach(G),this.h()},h(){A(n,"transform",c="translate("+i[4](i[12].xDomainNumb)+","+i[5](i[12].value)+")")},m(o,x){Be(o,n,x),m.m(n,null)},p(o,x){d===(d=u(o,x))&&m?m.p(o,x):(m.d(1),m=d(o),m&&(m.c(),m.m(n,null))),x&52&&c!==(c="translate("+o[4](o[12].xDomainNumb)+","+o[5](o[12].value)+")")&&A(n,"transform",c)},d(o){o&&G(n),m.d()}}}function B2(i){let n,s,c,u,d,m,o=(i[0]===i[3]||i[10].includes(i[6].role))&!i[1],x,w,I,k=o&&lp(i);return{c(){n=ft("g"),s=ft("path"),k&&k.c(),this.h()},l(E){n=dt(E,"g",{class:!0,opacity:!0});var B=be(n);s=dt(B,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0,hoverid:!0}),be(s).forEach(G),k&&k.l(B),B.forEach(G),this.h()},h(){A(s,"d",c=i[7](i[2])),A(s,"fill","none"),A(s,"stroke",u=i[0]===i[3]?"#F39431":ni[i[6].role]),A(s,"stroke-width",d=i[1]?"16px":"2px"),A(s,"opacity",m=i[1]?0:i[0]===i[3]||i[10]?1:.25),A(s,"hoverid",i[3]),A(n,"class","lineContainer"),A(n,"opacity",x=i[0]===i[3]||i[0]===null?1:.25)},m(E,B){Be(E,n,B),we(n,s),k&&k.m(n,null),w||(I=[Gi(s,"mouseover",function(){Ju(i[1]?i[8]:null)&&(i[1]?i[8]:null).apply(this,arguments)}),Gi(s,"mouseleave",function(){Ju(i[1]?i[9]:null)&&(i[1]?i[9]:null).apply(this,arguments)}),Gi(s,"focus",function(){Ju(i[1]?i[8]:null)&&(i[1]?i[8]:null).apply(this,arguments)})],w=!0)},p(E,[B]){i=E,B&132&&c!==(c=i[7](i[2]))&&A(s,"d",c),B&73&&u!==(u=i[0]===i[3]?"#F39431":ni[i[6].role])&&A(s,"stroke",u),B&2&&d!==(d=i[1]?"16px":"2px")&&A(s,"stroke-width",d),B&11&&m!==(m=i[1]?0:i[0]===i[3]||i[10]?1:.25)&&A(s,"opacity",m),B&8&&A(s,"hoverid",i[3]),B&75&&(o=(i[0]===i[3]||i[10].includes(i[6].role))&!i[1]),o?k?k.p(i,B):(k=lp(i),k.c(),k.m(n,null)):k&&(k.d(1),k=null),B&9&&x!==(x=i[0]===i[3]||i[0]===null?1:.25)&&A(n,"opacity",x)},i:hi,o:hi,d(E){E&&G(n),k&&k.d(),w=!1,wa(I)}}}function R2(i,n,s){let c,{overlay:u=!1,lineData:d,i:m,hoverIndex:o,x,y:w,xDomain:I,area:k}=n;function E(U){s(0,o=parseFloat(Np(this).attr("hoverid")))}function B(U){s(0,o=null)}let K=["main","parent","country","uk","custom1","custom2","custom3","custom4"];return i.$$set=U=>{"overlay"in U&&s(1,u=U.overlay),"lineData"in U&&s(2,d=U.lineData),"i"in U&&s(3,m=U.i),"hoverIndex"in U&&s(0,o=U.hoverIndex),"x"in U&&s(4,x=U.x),"y"in U&&s(5,w=U.y),"xDomain"in U&&s(11,I=U.xDomain),"area"in U&&s(6,k=U.area)},i.$$.update=()=>{i.$$.dirty&48&&s(7,c=Ih().x(U=>x(U.xDomainNumb)).y(U=>w(U.value)))},[o,u,d,m,x,w,k,c,E,B,K,I]}class dg extends pi{constructor(n){super(),gi(this,n,R2,B2,_i,{overlay:1,lineData:2,i:3,hoverIndex:0,x:4,y:5,xDomain:11,area:6})}}function up(i,n,s){const c=i.slice();return c[3]=n[s],c}function hp(i){let n,s=i[3].datum.areanm+"",c,u,d,m=i[3].datum.areanm+"",o,x,w,I;return{c(){n=ft("text"),c=fi(s),d=ft("text"),o=fi(m),this.h()},l(k){n=dt(k,"text",{y:!0,"font-size":!0,fill:!0,stroke:!0,"stroke-width":!0});var E=be(n);c=di(E,s),E.forEach(G),d=dt(k,"text",{y:!0,"font-size":!0,fill:!0,stroke:!0,"stroke-width":!0});var B=be(d);o=di(B,m),B.forEach(G),this.h()},h(){A(n,"y",u=i[3].y+8),A(n,"font-size","16px"),A(n,"fill","white"),A(n,"stroke","white"),A(n,"stroke-width","4px"),A(d,"y",x=i[3].y+8),A(d,"font-size","16px"),A(d,"fill",w=i[2]!=null?"#F39431":ni[i[3].datum.role]),A(d,"stroke",I=i[2]!=null?"#F39431":ni[i[3].datum.role]),A(d,"stroke-width","0.5px")},m(k,E){Be(k,n,E),we(n,c),Be(k,d,E),we(d,o)},p(k,E){E&2&&s!==(s=k[3].datum.areanm+"")&&zi(c,s),E&2&&u!==(u=k[3].y+8)&&A(n,"y",u),E&2&&m!==(m=k[3].datum.areanm+"")&&zi(o,m),E&2&&x!==(x=k[3].y+8)&&A(d,"y",x),E&6&&w!==(w=k[2]!=null?"#F39431":ni[k[3].datum.role])&&A(d,"fill",w),E&6&&I!==(I=k[2]!=null?"#F39431":ni[k[3].datum.role])&&A(d,"stroke",I)},d(k){k&&G(n),k&&G(d)}}}function F2(i){let n,s,c=i[1],u=[];for(let d=0;d<c.length;d+=1)u[d]=hp(up(i,c,d));return{c(){n=ft("g");for(let d=0;d<u.length;d+=1)u[d].c();this.h()},l(d){n=dt(d,"g",{class:!0,transform:!0});var m=be(n);for(let o=0;o<u.length;o+=1)u[o].l(m);m.forEach(G),this.h()},h(){A(n,"class","labelsContainer"),A(n,"transform",s="translate("+i[0]+",0)")},m(d,m){Be(d,n,m);for(let o=0;o<u.length;o+=1)u[o]&&u[o].m(n,null)},p(d,[m]){if(m&6){c=d[1];let o;for(o=0;o<c.length;o+=1){const x=up(d,c,o);u[o]?u[o].p(x,m):(u[o]=hp(x),u[o].c(),u[o].m(n,null))}for(;o<u.length;o+=1)u[o].d(1);u.length=c.length}m&1&&s!==(s="translate("+d[0]+",0)")&&A(n,"transform",s)},i:hi,o:hi,d(d){d&&G(n),$i(u,d)}}}function O2(i,n,s){let{x:c,labelPlacements:u,hoverIndex:d}=n;return i.$$set=m=>{"x"in m&&s(0,c=m.x),"labelPlacements"in m&&s(1,u=m.labelPlacements),"hoverIndex"in m&&s(2,d=m.hoverIndex)},[c,u,d]}class V2 extends pi{constructor(n){super(),gi(this,n,O2,F2,_i,{x:0,labelPlacements:1,hoverIndex:2})}}function N2(i,n,s,c){i=i.map(d=>({targetY:s(d),y:s(d),height:c(d),datum:d})),i.sort((d,m)=>d.targetY-m.targetY);const u=[];for(const d of i){const m={data:[d]};for(fp(m,n),u.push(m);u.length>1&&u[u.length-2].hi>u[u.length-1].lo;){const o=u.pop(),x=u[u.length-1];x.data.push(...o.data),fp(x,n)}}return u.map(d=>d.data).flat()}function fp(i,n){const s=G2(i.data),c=U2(i.data,s);i.lo=c-s/2,i.lo<n[0]?i.lo=n[0]:i.lo>n[1]-s&&(i.lo=n[1]-s),i.hi=i.lo+s,mg(i.data,i.lo,(u,d)=>{u.y=d})}function U2(i,n){const s=[];return mg(i,-n/2,(c,u)=>{s.push({val:c.targetY-u,weight:1/c.height})}),q2(s)}function mg(i,n,s){let c=n;for(const u of i)c+=u.height/2,s(u,c),c+=u.height/2}function G2(i){let n=0;for(const s of i)n+=s.height;return n}function q2(i){let n=0,s=0;for(const c of i)n+=c.val*c.weight,s+=c.weight;return n/s}function j2(i){let n,s,c,u,d,m,o,x,w;function I(X){i[7](X)}function k(X){i[8](X)}function E(X){i[9](X)}function B(X){i[10](X)}function K(X){i[11](X)}let U={showAreaOptions:!0,showBaselines:!1};return i[0]!==void 0&&(U.chosenId1=i[0]),i[1]!==void 0&&(U.chosenId2=i[1]),i[4]!==void 0&&(U.globalVisibleAreasTracker=i[4]),i[2]!==void 0&&(U.chosenId4=i[2]),i[3]!==void 0&&(U.chosenId5=i[3]),c=new Jp({props:U}),Et.push(()=>Bt(c,"chosenId1",I)),Et.push(()=>Bt(c,"chosenId2",k)),Et.push(()=>Bt(c,"globalVisibleAreasTracker",E)),Et.push(()=>Bt(c,"chosenId4",B)),Et.push(()=>Bt(c,"chosenId5",K)),{c(){n=it("div"),s=it("div"),Nt(c.$$.fragment),this.h()},l(X){n=nt(X,"DIV",{class:!0});var Q=be(n);s=nt(Q,"DIV",{});var Y=be(s);Kt(c.$$.fragment,Y),Y.forEach(G),Q.forEach(G),this.h()},h(){A(n,"class","sticky svelte-11bpsmc")},m(X,Q){Be(X,n,Q),we(n,s),Ut(c,s,null),w=!0},p(X,[Q]){const Y={};!u&&Q&1&&(u=!0,Y.chosenId1=X[0],Ot(()=>u=!1)),!d&&Q&2&&(d=!0,Y.chosenId2=X[1],Ot(()=>d=!1)),!m&&Q&16&&(m=!0,Y.globalVisibleAreasTracker=X[4],Ot(()=>m=!1)),!o&&Q&4&&(o=!0,Y.chosenId4=X[2],Ot(()=>o=!1)),!x&&Q&8&&(x=!0,Y.chosenId5=X[3],Ot(()=>x=!1)),c.$set(Y)},i(X){w||(Le(c.$$.fragment,X),w=!0)},o(X){Ze(c.$$.fragment,X),w=!1},d(X){X&&G(n),Gt(c)}}}function Z2(i,n,s){let{visibleAreas:c}=n,{chosenId1:u}=n,{chosenId2:d}=n,{chosenId4:m}=n,{chosenId5:o}=n,{globalVisibleAreasTracker:x}=n,{chosenId6:w}=n;xi("selectedAndRelatedAreas"),xi("selectedArea");function I(U){u=U,s(0,u)}function k(U){d=U,s(1,d)}function E(U){x=U,s(4,x)}function B(U){m=U,s(2,m)}function K(U){o=U,s(3,o)}return i.$$set=U=>{"visibleAreas"in U&&s(5,c=U.visibleAreas),"chosenId1"in U&&s(0,u=U.chosenId1),"chosenId2"in U&&s(1,d=U.chosenId2),"chosenId4"in U&&s(2,m=U.chosenId4),"chosenId5"in U&&s(3,o=U.chosenId5),"globalVisibleAreasTracker"in U&&s(4,x=U.globalVisibleAreasTracker),"chosenId6"in U&&s(6,w=U.chosenId6)},i.$$.update=()=>{i.$$.dirty&32},[u,d,m,o,x,c,w,I,k,E,B,K]}class X2 extends pi{constructor(n){super(),gi(this,n,Z2,j2,_i,{visibleAreas:5,chosenId1:0,chosenId2:1,chosenId4:2,chosenId5:3,globalVisibleAreasTracker:4,chosenId6:6})}}function dp(i,n,s){const c=i.slice();return c[49]=n[s],c[51]=s,c}function mp(i,n,s){const c=i.slice();return c[49]=n[s],c[51]=s,c}function pp(i){let n,s;function c(...u){return i[38](i[49],...u)}return n=new dg({props:{area:i[49],lineData:i[11].filter(c),i:i[51],hoverIndex:i[10],x:i[20],y:i[12],xDomain:i[15]}}),{c(){Nt(n.$$.fragment)},l(u){Kt(n.$$.fragment,u)},m(u,d){Ut(n,u,d),s=!0},p(u,d){i=u;const m={};d[0]&8192&&(m.area=i[49]),d[0]&10240&&(m.lineData=i[11].filter(c)),d[0]&1024&&(m.hoverIndex=i[10]),d[0]&1048576&&(m.x=i[20]),d[0]&4096&&(m.y=i[12]),d[0]&32768&&(m.xDomain=i[15]),n.$set(m)},i(u){s||(Le(n.$$.fragment,u),s=!0)},o(u){Ze(n.$$.fragment,u),s=!1},d(u){Gt(n,u)}}}function gp(i){let n=i[11].filter(u).length>0,s,c;function u(...m){return i[30](i[49],...m)}let d=n&&pp(i);return{c(){d&&d.c(),s=si()},l(m){d&&d.l(m),s=si()},m(m,o){d&&d.m(m,o),Be(m,s,o),c=!0},p(m,o){i=m,o[0]&10240&&(n=i[11].filter(u).length>0),n?d?(d.p(i,o),o[0]&10240&&Le(d,1)):(d=pp(i),d.c(),Le(d,1),d.m(s.parentNode,s)):d&&(wi(),Ze(d,1,1,()=>{d=null}),Ii())},i(m){c||(Le(d),c=!0)},o(m){Ze(d),c=!1},d(m){d&&d.d(m),m&&G(s)}}}function _p(i){let n,s,c;function u(...o){return i[39](i[49],...o)}function d(o){i[40](o)}let m={overlay:"true",area:i[49],lineData:i[11].filter(u),i:i[51],x:i[20],y:i[12],xDomain:i[15]};return i[10]!==void 0&&(m.hoverIndex=i[10]),n=new dg({props:m}),Et.push(()=>Bt(n,"hoverIndex",d)),{c(){Nt(n.$$.fragment)},l(o){Kt(n.$$.fragment,o)},m(o,x){Ut(n,o,x),c=!0},p(o,x){i=o;const w={};x[0]&8192&&(w.area=i[49]),x[0]&10240&&(w.lineData=i[11].filter(u)),x[0]&1048576&&(w.x=i[20]),x[0]&4096&&(w.y=i[12]),x[0]&32768&&(w.xDomain=i[15]),!s&&x[0]&1024&&(s=!0,w.hoverIndex=i[10],Ot(()=>s=!1)),n.$set(w)},i(o){c||(Le(n.$$.fragment,o),c=!0)},o(o){Ze(n.$$.fragment,o),c=!1},d(o){Gt(n,o)}}}function yp(i){let n=i[11].filter(u).length>0,s,c;function u(...m){return i[29](i[49],...m)}let d=n&&_p(i);return{c(){d&&d.c(),s=si()},l(m){d&&d.l(m),s=si()},m(m,o){d&&d.m(m,o),Be(m,s,o),c=!0},p(m,o){i=m,o[0]&10240&&(n=i[11].filter(u).length>0),n?d?(d.p(i,o),o[0]&10240&&Le(d,1)):(d=_p(i),d.c(),Le(d,1),d.m(s.parentNode,s)):d&&(wi(),Ze(d,1,1,()=>{d=null}),Ii())},i(m){c||(Le(d),c=!0)},o(m){Ze(d),c=!1},d(m){d&&d.d(m),m&&G(s)}}}function W2(i){let n,s,c,u,d,m,o,x=i[17].subtitle+"",w,I,k,E,B,K,U,X,Q,Y,re,V,ne,oe,Ne,he,fe,pe,Ee,ve,ze,De;function j(Fe){i[31](Fe)}let ce={name:"select-indicator-dropdown",optionsArray:i[22]};i[18]!==void 0&&(ce.chosenId=i[18]),c=new kh({props:ce}),Et.push(()=>Bt(c,"chosenId",j));function rt(Fe){i[32](Fe)}function Ke(Fe){i[33](Fe)}function qe(Fe){i[34](Fe)}function Qe(Fe){i[35](Fe)}function Ie(Fe){i[36](Fe)}function lt(Fe){i[37](Fe)}let ot={visibleAreas:i[13],baselineComparisonArea:i[6]};i[0]!==void 0&&(ot.globalVisibleAreasTracker=i[0]),i[1]!==void 0&&(ot.chosenId1=i[1]),i[2]!==void 0&&(ot.chosenId2=i[2]),i[3]!==void 0&&(ot.chosenId4=i[3]),i[4]!==void 0&&(ot.chosenId5=i[4]),i[5]!==void 0&&(ot.chosenId6=i[5]),k=new X2({props:ot}),Et.push(()=>Bt(k,"globalVisibleAreasTracker",rt)),Et.push(()=>Bt(k,"chosenId1",Ke)),Et.push(()=>Bt(k,"chosenId2",qe)),Et.push(()=>Bt(k,"chosenId4",Qe)),Et.push(()=>Bt(k,"chosenId5",Ie)),Et.push(()=>Bt(k,"chosenId6",lt)),Ne=new C2({props:{yDomain:i[16],y:i[12],metadata:i[17]}}),he=new D2({props:{chartHeight:i[8],xDomain:i[15],x:i[20]}});let vt=i[13].reverse(),gt=[];for(let Fe=0;Fe<vt.length;Fe+=1)gt[Fe]=gp(mp(i,vt,Fe));const We=Fe=>Ze(gt[Fe],1,1,()=>{gt[Fe]=null});let yt=i[13],ue=[];for(let Fe=0;Fe<yt.length;Fe+=1)ue[Fe]=yp(dp(i,yt,Fe));const ke=Fe=>Ze(ue[Fe],1,1,()=>{ue[Fe]=null});return Ee=new V2({props:{x:i[20](i[15][1])+5,labelPlacements:i[19],hoverIndex:i[10]}}),{c(){n=it("div"),s=it("div"),Nt(c.$$.fragment),d=Rt(),m=it("div"),o=it("p"),w=fi(x),I=Rt(),Nt(k.$$.fragment),Y=Rt(),re=it("div"),V=ft("svg"),ne=ft("g"),oe=ft("rect"),Nt(Ne.$$.fragment),Nt(he.$$.fragment),fe=ft("g");for(let Fe=0;Fe<gt.length;Fe+=1)gt[Fe].c();pe=ft("g");for(let Fe=0;Fe<ue.length;Fe+=1)ue[Fe].c();Nt(Ee.$$.fragment),this.h()},l(Fe){n=nt(Fe,"DIV",{class:!0});var bt=be(n);s=nt(bt,"DIV",{class:!0});var mi=be(s);Kt(c.$$.fragment,mi),mi.forEach(G),bt.forEach(G),d=Ft(Fe),m=nt(Fe,"DIV",{class:!0});var et=be(m);o=nt(et,"P",{class:!0});var ht=be(o);w=di(ht,x),ht.forEach(G),et.forEach(G),I=Ft(Fe),Kt(k.$$.fragment,Fe),Y=Ft(Fe),re=nt(Fe,"DIV",{class:!0});var li=be(re);V=dt(li,"svg",{height:!0,width:!0});var nn=be(V);ne=dt(nn,"g",{class:!0,transform:!0});var ei=be(ne);oe=dt(ei,"rect",{width:!0,height:!0,fill:!0,opacity:!0,stroke:!0}),be(oe).forEach(G),Kt(Ne.$$.fragment,ei),Kt(he.$$.fragment,ei),fe=dt(ei,"g",{class:!0});var on=be(fe);for(let ct=0;ct<gt.length;ct+=1)gt[ct].l(on);on.forEach(G),pe=dt(ei,"g",{class:!0});var tt=be(pe);for(let ct=0;ct<ue.length;ct+=1)ue[ct].l(tt);tt.forEach(G),Kt(Ee.$$.fragment,ei),ei.forEach(G),nn.forEach(G),li.forEach(G),this.h()},h(){A(s,"class","dropdown-container"),A(n,"class","title-container"),A(o,"class","svelte-bq0s9r"),A(m,"class","subtitle-container svelte-bq0s9r"),A(oe,"width",i[14]),A(oe,"height",i[8]),A(oe,"fill","black"),A(oe,"opacity","0.02"),A(oe,"stroke","none"),A(fe,"class","visibleLinesGroup"),A(pe,"class","overlayLinesGroup"),A(ne,"class","chart-container"),A(ne,"transform",ve="translate("+i[9].left+","+i[9].top+")"),A(V,"height",i[21]),A(V,"width",i[7]),A(re,"class","svg-container"),ao(()=>i[41].call(re))},m(Fe,bt){Be(Fe,n,bt),we(n,s),Ut(c,s,null),Be(Fe,d,bt),Be(Fe,m,bt),we(m,o),we(o,w),Be(Fe,I,bt),Ut(k,Fe,bt),Be(Fe,Y,bt),Be(Fe,re,bt),we(re,V),we(V,ne),we(ne,oe),Ut(Ne,ne,null),Ut(he,ne,null),we(ne,fe);for(let mi=0;mi<gt.length;mi+=1)gt[mi]&&gt[mi].m(fe,null);we(ne,pe);for(let mi=0;mi<ue.length;mi+=1)ue[mi]&&ue[mi].m(pe,null);Ut(Ee,ne,null),ze=bl(re,i[41].bind(re)),De=!0},p(Fe,bt){const mi={};!u&&bt[0]&262144&&(u=!0,mi.chosenId=Fe[18],Ot(()=>u=!1)),c.$set(mi),(!De||bt[0]&131072)&&x!==(x=Fe[17].subtitle+"")&&zi(w,x);const et={};bt[0]&8192&&(et.visibleAreas=Fe[13]),bt[0]&64&&(et.baselineComparisonArea=Fe[6]),!E&&bt[0]&1&&(E=!0,et.globalVisibleAreasTracker=Fe[0],Ot(()=>E=!1)),!B&&bt[0]&2&&(B=!0,et.chosenId1=Fe[1],Ot(()=>B=!1)),!K&&bt[0]&4&&(K=!0,et.chosenId2=Fe[2],Ot(()=>K=!1)),!U&&bt[0]&8&&(U=!0,et.chosenId4=Fe[3],Ot(()=>U=!1)),!X&&bt[0]&16&&(X=!0,et.chosenId5=Fe[4],Ot(()=>X=!1)),!Q&&bt[0]&32&&(Q=!0,et.chosenId6=Fe[5],Ot(()=>Q=!1)),k.$set(et),(!De||bt[0]&16384)&&A(oe,"width",Fe[14]),(!De||bt[0]&256)&&A(oe,"height",Fe[8]);const ht={};bt[0]&65536&&(ht.yDomain=Fe[16]),bt[0]&4096&&(ht.y=Fe[12]),bt[0]&131072&&(ht.metadata=Fe[17]),Ne.$set(ht);const li={};if(bt[0]&256&&(li.chartHeight=Fe[8]),bt[0]&32768&&(li.xDomain=Fe[15]),bt[0]&1048576&&(li.x=Fe[20]),he.$set(li),bt[0]&1096704){vt=Fe[13].reverse();let ei;for(ei=0;ei<vt.length;ei+=1){const on=mp(Fe,vt,ei);gt[ei]?(gt[ei].p(on,bt),Le(gt[ei],1)):(gt[ei]=gp(on),gt[ei].c(),Le(gt[ei],1),gt[ei].m(fe,null))}for(wi(),ei=vt.length;ei<gt.length;ei+=1)We(ei);Ii()}if(bt[0]&1096704){yt=Fe[13];let ei;for(ei=0;ei<yt.length;ei+=1){const on=dp(Fe,yt,ei);ue[ei]?(ue[ei].p(on,bt),Le(ue[ei],1)):(ue[ei]=yp(on),ue[ei].c(),Le(ue[ei],1),ue[ei].m(pe,null))}for(wi(),ei=yt.length;ei<ue.length;ei+=1)ke(ei);Ii()}const nn={};bt[0]&1081344&&(nn.x=Fe[20](Fe[15][1])+5),bt[0]&524288&&(nn.labelPlacements=Fe[19]),bt[0]&1024&&(nn.hoverIndex=Fe[10]),Ee.$set(nn),(!De||bt[0]&512&&ve!==(ve="translate("+Fe[9].left+","+Fe[9].top+")"))&&A(ne,"transform",ve),(!De||bt[0]&128)&&A(V,"width",Fe[7])},i(Fe){if(!De){Le(c.$$.fragment,Fe),Le(k.$$.fragment,Fe),Le(Ne.$$.fragment,Fe),Le(he.$$.fragment,Fe);for(let bt=0;bt<vt.length;bt+=1)Le(gt[bt]);for(let bt=0;bt<yt.length;bt+=1)Le(ue[bt]);Le(Ee.$$.fragment,Fe),De=!0}},o(Fe){Ze(c.$$.fragment,Fe),Ze(k.$$.fragment,Fe),Ze(Ne.$$.fragment,Fe),Ze(he.$$.fragment,Fe),gt=gt.filter(Boolean);for(let bt=0;bt<gt.length;bt+=1)Ze(gt[bt]);ue=ue.filter(Boolean);for(let bt=0;bt<ue.length;bt+=1)Ze(ue[bt]);Ze(Ee.$$.fragment,Fe),De=!1},d(Fe){Fe&&G(n),Gt(c),Fe&&G(d),Fe&&G(m),Fe&&G(I),Gt(k,Fe),Fe&&G(Y),Fe&&G(re),Gt(Ne),Gt(he),$i(gt,Fe),$i(ue,Fe),Gt(Ee),ze()}}}function H2(i,n,s){let c,u,d,m,o,x,w,I,k,E,B,K,U,X,Q,Y;xi("areas");let{visibleAreas:re,combinedData:V,indicators:ne}=n,{globalVisibleAreasTracker:oe,baselineComparisonArea:Ne,chosenId1:he,chosenId2:fe,chosenId4:pe,chosenId5:Ee,chosenId6:ve}=n,ze=xi("indicatorsMetadata"),De=xi("indicatorsCalculations").filter(ht=>ne.map(li=>li.id).includes(ht.id)),j=ne.filter(ht=>De.find(li=>li.code===ht.code).mainMaxXDomain!=De.find(li=>li.code===ht.code).mainMinXDomain),ce=400,rt=500,Ke=170,qe=j.map(ht=>ht.label),Qe=["main","parent","country","uk","custom1","custom2","custom3","custom4"];const Ie=(ht,li)=>li.areacd==ht.areacd,lt=(ht,li)=>li.areacd==ht.areacd;function ot(ht){m=ht,s(18,m),s(22,qe)}function vt(ht){oe=ht,s(0,oe)}function gt(ht){he=ht,s(1,he)}function We(ht){fe=ht,s(2,fe)}function yt(ht){pe=ht,s(3,pe)}function ue(ht){Ee=ht,s(4,Ee)}function ke(ht){ve=ht,s(5,ve)}const Fe=(ht,li)=>li.areacd==ht.areacd,bt=(ht,li)=>li.areacd===ht.areacd;function mi(ht){X=ht,s(10,X)}function et(){ce=this.clientWidth,s(7,ce)}return i.$$set=ht=>{"visibleAreas"in ht&&s(23,re=ht.visibleAreas),"combinedData"in ht&&s(24,V=ht.combinedData),"indicators"in ht&&s(25,ne=ht.indicators),"globalVisibleAreasTracker"in ht&&s(0,oe=ht.globalVisibleAreasTracker),"baselineComparisonArea"in ht&&s(6,Ne=ht.baselineComparisonArea),"chosenId1"in ht&&s(1,he=ht.chosenId1),"chosenId2"in ht&&s(2,fe=ht.chosenId2),"chosenId4"in ht&&s(3,pe=ht.chosenId4),"chosenId5"in ht&&s(4,Ee=ht.chosenId5),"chosenId6"in ht&&s(5,ve=ht.chosenId6)},i.$$.update=()=>{i.$$.dirty[0]&640&&s(14,u=ce-c.left-c.right),i.$$.dirty[0]&512&&s(8,d=rt-c.top-c.bottom),i.$$.dirty[0]&33816576&&s(28,o=ne.find(ht=>m==ht.label)),i.$$.dirty[0]&262144&&s(17,x=ze.find(ht=>ht.label==m)),i.$$.dirty[0]&131072&&s(27,w=De.find(ht=>ht.code==x.code)),i.$$.dirty[0]&285212672&&s(11,I=V.filter(ht=>ht.id===o.id)),i.$$.dirty[0]&8390656&&s(13,k=re.filter(ht=>I.filter(li=>ht.areacd===li.areacd).length>0)),i.$$.dirty[0]&268437504&&s(16,E=[o.zeroBaseline==="TRUE"?0:Math.floor(.95*Math.min(...I.map(ht=>ht.value))),Math.ceil(Math.max(...I.map(ht=>ht.value)))]),i.$$.dirty[0]&65792&&s(12,B=Us().domain(E).range([d,0])),i.$$.dirty[0]&2048&&s(15,K=[Math.min(...I.map(ht=>ht.xDomainNumb)),Math.max(...I.map(ht=>ht.xDomainNumb))]),i.$$.dirty[0]&49152&&s(20,U=Us().domain(K).range([0,u])),i.$$.dirty[0]&134217728&&w.maxXDomain,i.$$.dirty[0]&15360&&s(26,Q=k.map(ht=>({...ht,yPosition:I.filter(li=>ht.areacd==li.areacd).length>0?B(I.filter(li=>ht.areacd==li.areacd)[I.filter(li=>ht.areacd==li.areacd).length-1].value):null})).filter((ht,li)=>X!=null?li==X:Qe.includes(ht.role))),i.$$.dirty[0]&67109632&&s(19,Y=N2(Q,[-c.top,d],ht=>ht.yPosition,ht=>ht.areanm.length>20?34:17))},s(9,c={top:10,left:80,right:Ke+5,bottom:40}),s(18,m=qe[0]),s(10,X=null),[oe,he,fe,pe,Ee,ve,Ne,ce,d,c,X,I,B,k,u,K,E,x,m,Y,U,rt,qe,re,V,ne,Q,w,o,Ie,lt,ot,vt,gt,We,yt,ue,ke,Fe,bt,mi,et]}class K2 extends pi{constructor(n){super(),gi(this,n,H2,W2,_i,{visibleAreas:23,combinedData:24,indicators:25,globalVisibleAreasTracker:0,baselineComparisonArea:6,chosenId1:1,chosenId2:2,chosenId4:3,chosenId5:4,chosenId6:5},null,[-1,-1])}}function Y2(i){let n,s;return n=new S2({props:{indicatorsList:i[6].map(vp),combinedData:i[9]}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u&64&&(d.indicatorsList=c[6].map(vp)),u&512&&(d.combinedData=c[9]),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function J2(i){let n,s,c,u,d,m,o,x;function w(X){i[13](X)}function I(X){i[14](X)}function k(X){i[15](X)}function E(X){i[16](X)}function B(X){i[17](X)}function K(X){i[18](X)}let U={combinedData:i[9],visibleAreas:i[7],indicators:i[6],baselineComparisonArea:i[8]};return i[0]!==void 0&&(U.globalVisibleAreasTracker=i[0]),i[1]!==void 0&&(U.chosenId1=i[1]),i[2]!==void 0&&(U.chosenId2=i[2]),i[3]!==void 0&&(U.chosenId4=i[3]),i[4]!==void 0&&(U.chosenId5=i[4]),i[5]!==void 0&&(U.chosenId6=i[5]),n=new K2({props:U}),Et.push(()=>Bt(n,"globalVisibleAreasTracker",w)),Et.push(()=>Bt(n,"chosenId1",I)),Et.push(()=>Bt(n,"chosenId2",k)),Et.push(()=>Bt(n,"chosenId4",E)),Et.push(()=>Bt(n,"chosenId5",B)),Et.push(()=>Bt(n,"chosenId6",K)),{c(){Nt(n.$$.fragment)},l(X){Kt(n.$$.fragment,X)},m(X,Q){Ut(n,X,Q),x=!0},p(X,Q){const Y={};Q&512&&(Y.combinedData=X[9]),Q&128&&(Y.visibleAreas=X[7]),Q&64&&(Y.indicators=X[6]),Q&256&&(Y.baselineComparisonArea=X[8]),!s&&Q&1&&(s=!0,Y.globalVisibleAreasTracker=X[0],Ot(()=>s=!1)),!c&&Q&2&&(c=!0,Y.chosenId1=X[1],Ot(()=>c=!1)),!u&&Q&4&&(u=!0,Y.chosenId2=X[2],Ot(()=>u=!1)),!d&&Q&8&&(d=!0,Y.chosenId4=X[3],Ot(()=>d=!1)),!m&&Q&16&&(m=!0,Y.chosenId5=X[4],Ot(()=>m=!1)),!o&&Q&32&&(o=!0,Y.chosenId6=X[5],Ot(()=>o=!1)),n.$set(Y)},i(X){x||(Le(n.$$.fragment,X),x=!0)},o(X){Ze(n.$$.fragment,X),x=!1},d(X){Gt(n,X)}}}function Q2(i){let n,s,c,u,d,m,o,x,w,I;function k(X){i[12](X)}let E={name:"select-row-view",optionsArray:i[11],width:$2};i[10]!==void 0&&(E.chosenId=i[10]),s=new Ep({props:E}),Et.push(()=>Bt(s,"chosenId",k));const B=[J2,Y2],K=[];function U(X,Q){return X[10]===0?0:1}return m=U(i),o=K[m]=B[m](i),w=new Kp({}),{c(){n=it("div"),Nt(s.$$.fragment),u=Rt(),d=it("div"),o.c(),x=Rt(),Nt(w.$$.fragment),this.h()},l(X){n=nt(X,"DIV",{style:!0});var Q=be(n);Kt(s.$$.fragment,Q),u=Ft(Q),d=nt(Q,"DIV",{class:!0});var Y=be(d);o.l(Y),x=Ft(Y),Kt(w.$$.fragment,Y),Y.forEach(G),Q.forEach(G),this.h()},h(){A(d,"class","main-chart-line-outer-container svelte-a4mjd6"),ii(n,"margin-top","120px")},m(X,Q){Be(X,n,Q),Ut(s,n,null),we(n,u),we(n,d),K[m].m(d,null),we(d,x),Ut(w,d,null),I=!0},p(X,[Q]){const Y={};!c&&Q&1024&&(c=!0,Y.chosenId=X[10],Ot(()=>c=!1)),s.$set(Y);let re=m;m=U(X),m===re?K[m].p(X,Q):(wi(),Ze(K[re],1,1,()=>{K[re]=null}),Ii(),o=K[m],o?o.p(X,Q):(o=K[m]=B[m](X),o.c()),Le(o,1),o.m(d,x))},i(X){I||(Le(s.$$.fragment,X),Le(o),Le(w.$$.fragment,X),I=!0)},o(X){Ze(s.$$.fragment,X),Ze(o),Ze(w.$$.fragment,X),I=!1},d(X){X&&G(n),Gt(s),K[m].d(),Gt(w)}}}let $2=1e3;const vp=i=>i.id;function ew(i,n,s){let c,{indicators:u,visibleAreas:d,globalVisibleAreasTracker:m}=n,{baselineComparisonArea:o}=n,{chosenId1:x,chosenId2:w,chosenId4:I,chosenId5:k,chosenId6:E}=n,{combinedData:B}=n,K=["Line chart","Map"];function U(oe){c=oe,s(10,c)}function X(oe){m=oe,s(0,m)}function Q(oe){x=oe,s(1,x)}function Y(oe){w=oe,s(2,w)}function re(oe){I=oe,s(3,I)}function V(oe){k=oe,s(4,k)}function ne(oe){E=oe,s(5,E)}return i.$$set=oe=>{"indicators"in oe&&s(6,u=oe.indicators),"visibleAreas"in oe&&s(7,d=oe.visibleAreas),"globalVisibleAreasTracker"in oe&&s(0,m=oe.globalVisibleAreasTracker),"baselineComparisonArea"in oe&&s(8,o=oe.baselineComparisonArea),"chosenId1"in oe&&s(1,x=oe.chosenId1),"chosenId2"in oe&&s(2,w=oe.chosenId2),"chosenId4"in oe&&s(3,I=oe.chosenId4),"chosenId5"in oe&&s(4,k=oe.chosenId5),"chosenId6"in oe&&s(5,E=oe.chosenId6),"combinedData"in oe&&s(9,B=oe.combinedData)},s(10,c=0),[m,x,w,I,k,E,u,d,o,B,c,K,U,X,Q,Y,re,V,ne]}class tw extends pi{constructor(n){super(),gi(this,n,ew,Q2,_i,{indicators:6,visibleAreas:7,globalVisibleAreasTracker:0,baselineComparisonArea:8,chosenId1:1,chosenId2:2,chosenId4:3,chosenId5:4,chosenId6:5,combinedData:9})}}function iw(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K,U,X;function Q(j){i[13](j)}function Y(j){i[14](j)}function re(j){i[15](j)}function V(j){i[16](j)}function ne(j){i[17](j)}function oe(j){i[18](j)}let Ne={topic:i[6],indicators:i[11],visibleAreas:i[7],baselineComparisonArea:i[8],chosenId11:i[9]};i[0]!==void 0&&(Ne.globalVisibleAreasTracker=i[0]),i[1]!==void 0&&(Ne.chosenId1=i[1]),i[2]!==void 0&&(Ne.chosenId2=i[2]),i[3]!==void 0&&(Ne.chosenId4=i[3]),i[4]!==void 0&&(Ne.chosenId5=i[4]),i[5]!==void 0&&(Ne.chosenId6=i[5]),n=new _x({props:Ne}),Et.push(()=>Bt(n,"globalVisibleAreasTracker",Q)),Et.push(()=>Bt(n,"chosenId1",Y)),Et.push(()=>Bt(n,"chosenId2",re)),Et.push(()=>Bt(n,"chosenId4",V)),Et.push(()=>Bt(n,"chosenId5",ne)),Et.push(()=>Bt(n,"chosenId6",oe));function he(j){i[19](j)}function fe(j){i[20](j)}function pe(j){i[21](j)}function Ee(j){i[22](j)}function ve(j){i[23](j)}function ze(j){i[24](j)}let De={indicators:i[11],visibleAreas:i[7],baselineComparisonArea:i[8],combinedData:i[10]};return i[0]!==void 0&&(De.globalVisibleAreasTracker=i[0]),i[1]!==void 0&&(De.chosenId1=i[1]),i[2]!==void 0&&(De.chosenId2=i[2]),i[3]!==void 0&&(De.chosenId4=i[3]),i[4]!==void 0&&(De.chosenId5=i[4]),i[5]!==void 0&&(De.chosenId6=i[5]),w=new tw({props:De}),Et.push(()=>Bt(w,"globalVisibleAreasTracker",he)),Et.push(()=>Bt(w,"chosenId1",fe)),Et.push(()=>Bt(w,"chosenId2",pe)),Et.push(()=>Bt(w,"chosenId4",Ee)),Et.push(()=>Bt(w,"chosenId5",ve)),Et.push(()=>Bt(w,"chosenId6",ze)),{c(){Nt(n.$$.fragment),x=Rt(),Nt(w.$$.fragment)},l(j){Kt(n.$$.fragment,j),x=Ft(j),Kt(w.$$.fragment,j)},m(j,ce){Ut(n,j,ce),Be(j,x,ce),Ut(w,j,ce),X=!0},p(j,ce){const rt={};ce&64&&(rt.topic=j[6]),ce&128&&(rt.visibleAreas=j[7]),ce&256&&(rt.baselineComparisonArea=j[8]),ce&512&&(rt.chosenId11=j[9]),!s&&ce&1&&(s=!0,rt.globalVisibleAreasTracker=j[0],Ot(()=>s=!1)),!c&&ce&2&&(c=!0,rt.chosenId1=j[1],Ot(()=>c=!1)),!u&&ce&4&&(u=!0,rt.chosenId2=j[2],Ot(()=>u=!1)),!d&&ce&8&&(d=!0,rt.chosenId4=j[3],Ot(()=>d=!1)),!m&&ce&16&&(m=!0,rt.chosenId5=j[4],Ot(()=>m=!1)),!o&&ce&32&&(o=!0,rt.chosenId6=j[5],Ot(()=>o=!1)),n.$set(rt);const Ke={};ce&128&&(Ke.visibleAreas=j[7]),ce&256&&(Ke.baselineComparisonArea=j[8]),ce&1024&&(Ke.combinedData=j[10]),!I&&ce&1&&(I=!0,Ke.globalVisibleAreasTracker=j[0],Ot(()=>I=!1)),!k&&ce&2&&(k=!0,Ke.chosenId1=j[1],Ot(()=>k=!1)),!E&&ce&4&&(E=!0,Ke.chosenId2=j[2],Ot(()=>E=!1)),!B&&ce&8&&(B=!0,Ke.chosenId4=j[3],Ot(()=>B=!1)),!K&&ce&16&&(K=!0,Ke.chosenId5=j[4],Ot(()=>K=!1)),!U&&ce&32&&(U=!0,Ke.chosenId6=j[5],Ot(()=>U=!1)),w.$set(Ke)},i(j){X||(Le(n.$$.fragment,j),Le(w.$$.fragment,j),X=!0)},o(j){Ze(n.$$.fragment,j),Ze(w.$$.fragment,j),X=!1},d(j){Gt(n,j),j&&G(x),Gt(w,j)}}}function nw(i){let n,s;return n=new Bc({props:{title:i[12],$$slots:{default:[iw]},$$scope:{ctx:i}}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,[u]){const d={};u&33556479&&(d.$$scope={dirty:u,ctx:c}),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function rw(i,n,s){let{topic:c}=n,{visibleAreas:u,globalVisibleAreasTracker:d}=n,{chosenId1:m,baselineComparisonArea:o}=n,{chosenId2:x}=n,{chosenId4:w,chosenId5:I}=n,{chosenId11:k}=n,{chosenId6:E}=n,{combinedData:B}=n,K=xi("indicators").filter(ve=>ve.topic===c.name),U=c.name[0].toUpperCase()+c.name.substring(1);function X(ve){d=ve,s(0,d)}function Q(ve){m=ve,s(1,m)}function Y(ve){x=ve,s(2,x)}function re(ve){w=ve,s(3,w)}function V(ve){I=ve,s(4,I)}function ne(ve){E=ve,s(5,E)}function oe(ve){d=ve,s(0,d)}function Ne(ve){m=ve,s(1,m)}function he(ve){x=ve,s(2,x)}function fe(ve){w=ve,s(3,w)}function pe(ve){I=ve,s(4,I)}function Ee(ve){E=ve,s(5,E)}return i.$$set=ve=>{"topic"in ve&&s(6,c=ve.topic),"visibleAreas"in ve&&s(7,u=ve.visibleAreas),"globalVisibleAreasTracker"in ve&&s(0,d=ve.globalVisibleAreasTracker),"chosenId1"in ve&&s(1,m=ve.chosenId1),"baselineComparisonArea"in ve&&s(8,o=ve.baselineComparisonArea),"chosenId2"in ve&&s(2,x=ve.chosenId2),"chosenId4"in ve&&s(3,w=ve.chosenId4),"chosenId5"in ve&&s(4,I=ve.chosenId5),"chosenId11"in ve&&s(9,k=ve.chosenId11),"chosenId6"in ve&&s(5,E=ve.chosenId6),"combinedData"in ve&&s(10,B=ve.combinedData)},[d,m,x,w,I,E,c,u,o,k,B,K,U,X,Q,Y,re,V,ne,oe,Ne,he,fe,pe,Ee]}class sw extends pi{constructor(n){super(),gi(this,n,rw,nw,_i,{topic:6,visibleAreas:7,globalVisibleAreasTracker:0,chosenId1:1,baselineComparisonArea:8,chosenId2:2,chosenId4:3,chosenId5:4,chosenId11:9,chosenId6:5,combinedData:10})}}function bp(i,n,s){const c=i.slice();return c[34]=n[s],c[36]=s,c}function aw(i){let n,s=i[12].areanm+"",c;return{c(){n=fi("Get localised data, insights and trends for "),c=fi(s)},l(u){n=di(u,"Get localised data, insights and trends for "),c=di(u,s)},m(u,d){Be(u,n,d),Be(u,c,d)},p:hi,d(u){u&&G(n),u&&G(c)}}}function ow(i){let n,s;return n=new g1({props:{$$slots:{default:[aw]},$$scope:{ctx:i}}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u[1]&64&&(d.$$scope={dirty:u,ctx:c}),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function xp(i){let n,s,c,u,d,m,o,x;function w(X){i[16](X)}function I(X){i[17](X)}function k(X){i[18](X)}function E(X){i[19](X)}function B(X){i[20](X)}function K(X){i[21](X)}let U={topic:i[34],visibleAreas:i[8],baselineComparisonArea:i[9],chosenId11:i[5],combinedData:i[0].combinedData};return i[1]!==void 0&&(U.globalVisibleAreasTracker=i[1]),i[2]!==void 0&&(U.chosenId1=i[2]),i[7]!==void 0&&(U.chosenId2=i[7]),i[3]!==void 0&&(U.chosenId4=i[3]),i[4]!==void 0&&(U.chosenId5=i[4]),i[6]!==void 0&&(U.chosenId6=i[6]),n=new sw({props:U}),Et.push(()=>Bt(n,"globalVisibleAreasTracker",w)),Et.push(()=>Bt(n,"chosenId1",I)),Et.push(()=>Bt(n,"chosenId2",k)),Et.push(()=>Bt(n,"chosenId4",E)),Et.push(()=>Bt(n,"chosenId5",B)),Et.push(()=>Bt(n,"chosenId6",K)),{c(){Nt(n.$$.fragment)},l(X){Kt(n.$$.fragment,X)},m(X,Q){Ut(n,X,Q),x=!0},p(X,Q){const Y={};Q[0]&256&&(Y.visibleAreas=X[8]),Q[0]&512&&(Y.baselineComparisonArea=X[9]),Q[0]&32&&(Y.chosenId11=X[5]),Q[0]&1&&(Y.combinedData=X[0].combinedData),!s&&Q[0]&2&&(s=!0,Y.globalVisibleAreasTracker=X[1],Ot(()=>s=!1)),!c&&Q[0]&4&&(c=!0,Y.chosenId1=X[2],Ot(()=>c=!1)),!u&&Q[0]&128&&(u=!0,Y.chosenId2=X[7],Ot(()=>u=!1)),!d&&Q[0]&8&&(d=!0,Y.chosenId4=X[3],Ot(()=>d=!1)),!m&&Q[0]&16&&(m=!0,Y.chosenId5=X[4],Ot(()=>m=!1)),!o&&Q[0]&64&&(o=!0,Y.chosenId6=X[6],Ot(()=>o=!1)),n.$set(Y)},i(X){x||(Le(n.$$.fragment,X),x=!0)},o(X){Ze(n.$$.fragment,X),x=!1},d(X){Gt(n,X)}}}function lw(i){let n;return{c(){n=fi("Find parent, child and neighbouring areas")},l(s){n=di(s,"Find parent, child and neighbouring areas")},m(s,c){Be(s,n,c)},d(s){s&&G(n)}}}function cw(i){let n,s;return n=new R1({props:{$$slots:{default:[lw]},$$scope:{ctx:i}}}),{c(){Nt(n.$$.fragment)},l(c){Kt(n.$$.fragment,c)},m(c,u){Ut(n,c,u),s=!0},p(c,u){const d={};u[1]&64&&(d.$$scope={dirty:u,ctx:c}),n.$set(d)},i(c){s||(Le(n.$$.fragment,c),s=!0)},o(c){Ze(n.$$.fragment,c),s=!1},d(c){Gt(n,c)}}}function uw(i){let n,s,c,u,d;return{c(){n=it("h2"),s=fi("Get the data"),c=Rt(),u=it("p"),d=fi("Here, you can find information and links to the data."),this.h()},l(m){n=nt(m,"H2",{class:!0});var o=be(n);s=di(o,"Get the data"),o.forEach(G),c=Ft(m),u=nt(m,"P",{});var x=be(u);d=di(x,"Here, you can find information and links to the data."),x.forEach(G),this.h()},h(){A(n,"class","ons-u-mt-xl")},m(m,o){Be(m,n,o),we(n,s),Be(m,c,o),Be(m,u,o),we(u,d)},p:hi,d(m){m&&G(n),m&&G(c),m&&G(u)}}}function hw(i){let n,s,c,u,d,m,o,x,w,I,k,E,B,K;function U(V){i[15](V)}let X={optionsArray:i[14],name:"chosenComparison",spacing:"15px"};i[5]!==void 0&&(X.chosenId=i[5]),d=new Oc({props:X}),Et.push(()=>Bt(d,"chosenId",U)),x=new j1({props:{indicators:i[13].filter(dw),chosenId11:i[5],baselineComparisonArea:i[11].find(mw),chosenId2:i[7]}});let Q=i[10],Y=[];for(let V=0;V<Q.length;V+=1)Y[V]=xp(bp(i,Q,V));const re=V=>Ze(Y[V],1,1,()=>{Y[V]=null});return k=new Bc({props:{title:"Related areas",$$slots:{default:[cw]},$$scope:{ctx:i}}}),B=new Bc({props:{title:"Get the data",$$slots:{default:[uw]},$$scope:{ctx:i}}}),{c(){n=it("div"),s=it("p"),c=fi("The following custom options affect the key indicators and rows of indicators sections. These options are for testing different possibilities for the final design, rather than options that will be available to users in the finished product."),u=Rt(),Nt(d.$$.fragment),o=Rt(),Nt(x.$$.fragment),w=Rt();for(let V=0;V<Y.length;V+=1)Y[V].c();I=Rt(),Nt(k.$$.fragment),E=Rt(),Nt(B.$$.fragment),this.h()},l(V){n=nt(V,"DIV",{class:!0});var ne=be(n);s=nt(ne,"P",{class:!0,style:!0});var oe=be(s);c=di(oe,"The following custom options affect the key indicators and rows of indicators sections. These options are for testing different possibilities for the final design, rather than options that will be available to users in the finished product."),oe.forEach(G),u=Ft(ne),Kt(d.$$.fragment,ne),ne.forEach(G),o=Ft(V),Kt(x.$$.fragment,V),w=Ft(V);for(let Ne=0;Ne<Y.length;Ne+=1)Y[Ne].l(V);I=Ft(V),Kt(k.$$.fragment,V),E=Ft(V),Kt(B.$$.fragment,V),this.h()},h(){A(s,"class","checkbox-title"),ii(s,"font-size","16px"),A(n,"class","temp-container svelte-1aszt8l")},m(V,ne){Be(V,n,ne),we(n,s),we(s,c),we(n,u),Ut(d,n,null),Be(V,o,ne),Ut(x,V,ne),Be(V,w,ne);for(let oe=0;oe<Y.length;oe+=1)Y[oe]&&Y[oe].m(V,ne);Be(V,I,ne),Ut(k,V,ne),Be(V,E,ne),Ut(B,V,ne),K=!0},p(V,ne){const oe={};!m&&ne[0]&32&&(m=!0,oe.chosenId=V[5],Ot(()=>m=!1)),d.$set(oe);const Ne={};if(ne[0]&32&&(Ne.chosenId11=V[5]),ne[0]&128&&(Ne.chosenId2=V[7]),x.$set(Ne),ne[0]&2047){Q=V[10];let pe;for(pe=0;pe<Q.length;pe+=1){const Ee=bp(V,Q,pe);Y[pe]?(Y[pe].p(Ee,ne),Le(Y[pe],1)):(Y[pe]=xp(Ee),Y[pe].c(),Le(Y[pe],1),Y[pe].m(I.parentNode,I))}for(wi(),pe=Q.length;pe<Y.length;pe+=1)re(pe);Ii()}const he={};ne[1]&64&&(he.$$scope={dirty:ne,ctx:V}),k.$set(he);const fe={};ne[1]&64&&(fe.$$scope={dirty:ne,ctx:V}),B.$set(fe)},i(V){if(!K){Le(d.$$.fragment,V),Le(x.$$.fragment,V);for(let ne=0;ne<Q.length;ne+=1)Le(Y[ne]);Le(k.$$.fragment,V),Le(B.$$.fragment,V),K=!0}},o(V){Ze(d.$$.fragment,V),Ze(x.$$.fragment,V),Y=Y.filter(Boolean);for(let ne=0;ne<Y.length;ne+=1)Ze(Y[ne]);Ze(k.$$.fragment,V),Ze(B.$$.fragment,V),K=!1},d(V){V&&G(n),Gt(d),V&&G(o),Gt(x,V),V&&G(w),$i(Y,V),V&&G(I),Gt(k,V),V&&G(E),Gt(B,V)}}}function fw(i){let n,s,c,u,d,m,o,x;return n=new m1({props:{links:[{label:"Home",href:"/"},{label:"Explore subnational statistics",href:`${so}/`},{label:"Find a local area",href:`${so}/areas`},{label:i[12].areanm}],background:"#eaeaea"}}),c=new p1({props:{title:i[12].areanm,background:"#eaeaea",$$slots:{default:[ow]},$$scope:{ctx:i}}}),d=new y1({}),o=new _1({props:{contentsLabel:"Explore this area",$$slots:{default:[hw]},$$scope:{ctx:i}}}),{c(){Nt(n.$$.fragment),s=Rt(),Nt(c.$$.fragment),u=Rt(),Nt(d.$$.fragment),m=Rt(),Nt(o.$$.fragment)},l(w){Kt(n.$$.fragment,w),s=Ft(w),Kt(c.$$.fragment,w),u=Ft(w),Kt(d.$$.fragment,w),m=Ft(w),Kt(o.$$.fragment,w)},m(w,I){Ut(n,w,I),Be(w,s,I),Ut(c,w,I),Be(w,u,I),Ut(d,w,I),Be(w,m,I),Ut(o,w,I),x=!0},p(w,I){const k={};I[1]&64&&(k.$$scope={dirty:I,ctx:w}),c.$set(k);const E={};I[0]&1023|I[1]&64&&(E.$$scope={dirty:I,ctx:w}),o.$set(E)},i(w){x||(Le(n.$$.fragment,w),Le(c.$$.fragment,w),Le(d.$$.fragment,w),Le(o.$$.fragment,w),x=!0)},o(w){Ze(n.$$.fragment,w),Ze(c.$$.fragment,w),Ze(d.$$.fragment,w),Ze(o.$$.fragment,w),x=!1},d(w){Gt(n,w),w&&G(s),Gt(c,w),w&&G(u),Gt(d,w),w&&G(m),Gt(o,w)}}}const dw=i=>["annual-personal-wellbeing-estimates-Anxiety mean score (where 10 is 'completely anxious')","female-healthy-life-expectancy","gross-disposable-household-income-per-head","employment-rate-long-Unemployment Rate","aged-16-to-64-years-level-3-or-above-qualifications"].includes(i.code),mw=i=>i.role==="country";function pw(i,n,s){let c,u,d,m,o,x,w,{data:I}=n,k=xi("areas"),E=xi("areasParentsLookup"),B=xi("areasGeogLevel"),K=xi("topics"),U=B.find(Ie=>Ie.areacd===I.areacd).level,X=B.filter(Ie=>["uk","country"].includes(U)?Ie.level===U:U==="region"?["region","country"].includes(Ie.level):U==="both"?["both","lower"].includes(Ie.level):["both",U].includes(Ie.level)).map(Ie=>Ie.areacd);Xr("selectedGeogLevel",U),Xr("areasWithSameGeog",X);let Q=["Median of all "+$f[U]],Y=[],re=k.find(Ie=>Ie.areacd===I.areacd);Xr("selectedArea",re),Y.push({...re,role:"main"});let V=E.find(Ie=>Ie.areacd===I.areacd),ne=k.find(Ie=>Ie.areacd===V.parentcd);Y.push({...ne,role:"parent"}),Q.push(ne.areanm),V.parentcd!=V.countrycd&V.countrycd!=""&&(Y.push({...k.find(Ie=>Ie.areacd===V.countrycd),role:"country"}),Q.push(V.countrynm)),V.parentcd!="K02000001"&&(Y.push({...k.find(Ie=>Ie.areacd==="K02000001"),role:"uk"}),Q.push("United Kingdom")),Xr("baselineComparisonOptions",Q),Xr("selectedAndRelatedAreas",Y);let oe=xi("indicators"),Ne=xi("indicatorsCalculations"),he=9999,fe=0;Ne.forEach(Ie=>{let lt=oe.find(vt=>Ie.id===vt.id);lt.data.filter(vt=>X.includes(vt.areacd)),Ie.calcs={},Ie.mainMinXDomain=Ie.maxXDomain,Ie.mainMaxXDomain=Ie.minXDomain;for(var ot=Ie.minXDomain;ot<=Ie.maxXDomain;ot++){let vt=lt.data.filter(We=>We.xDomainNumb==ot),gt=vt.filter(We=>X.includes(We.areacd));if(vt.length>0){if(ot==Ie.maxXDomain){lt.latestData=vt,lt.latestDataSameGeogLevel=gt;let We=Qu(gt,"value"),yt=gt.map(ke=>Math.abs(ke.value-We)),ue=Qu(yt);Ie.calcs[Ie.maxXDomain]={median:We,mad:ue}}else Ie.calcs[ot]={median:Qu(gt,"value")};Y.forEach(We=>{let yt=vt.find(ue=>We.areacd===ue.areacd);Ie.calcs[ot][We.role]=yt==null?null:yt.value,We.role==="main"&yt!=null&&(Ie.mainMinXDomain=Math.min(ot,Ie.mainMinXDomain),Ie.mainMaxXDomain=Math.max(ot,Ie.mainMaxXDomain))})}he=Math.min(he,Ie.mainMinXDomain),fe=Math.max(fe,Ie.mainMaxXDomain)}}),Xr("indicators",oe);let pe=["earliest available year","previous year",...Array.from({length:fe-he},(Ie,lt)=>he+lt).reverse()];Xr("previousTimePeriodOptions",pe);let Ee=[],ve=[],ze=["Include description text (e.g. higher/better than median, improving/increasing)","Include background colours","Include better/worse/improving/worsening (rather than higher/lower/increasing/decreasing) wording","Similar to/little change based on being within 2 MADs rather than 1","Rotate change over time axis","Use titles and subtitles directly from metadata"];function De(Ie){w=Ie,s(5,w)}function j(Ie){d=Ie,s(1,d)}function ce(Ie){c=Ie,s(2,c),s(29,Q)}function rt(Ie){o=Ie,s(7,o),s(33,pe)}function Ke(Ie){Ee=Ie,s(3,Ee)}function qe(Ie){ve=Ie,s(4,ve)}function Qe(Ie){x=Ie,s(6,x)}return i.$$set=Ie=>{"data"in Ie&&s(0,I=Ie.data)},i.$$.update=()=>{i.$$.dirty[0]&4&&s(9,u=c.substring(0,6)==="Median"?{areacd:"median",areanm:"Median of all "+$f[U],role:"median"}:k.find(Ie=>Ie.areanm===c)),i.$$.dirty[0]&2&&s(8,m=[...Y.filter(Ie=>d[Ie.role]),...d.custom==null?[]:d.custom.map((Ie,lt)=>({...Ie,role:"custom"+(lt+1)}))])},s(2,c=Q[0]),s(1,d={main:!0,parent:!1,country:!1,uk:!1,neighbour:!1,cluster:!1,custom:null}),s(7,o=pe[0]),s(6,x=[]),s(5,w=[0,1,2]),[I,d,c,Ee,ve,w,x,o,m,u,K,Y,re,oe,ze,De,j,ce,rt,Ke,qe,Qe]}class Cw extends pi{constructor(n){super(),gi(this,n,pw,fw,_i,{data:0},null,[-1,-1])}}export{Cw as component};
