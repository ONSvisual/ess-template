//js
import{S as vi,i as bi,s as xi,I as Lc,k as rt,l as at,m as ve,h as q,n as E,p as ni,b as Ze,K as Bc,L as Rc,M as Fc,g as Ye,d as ht,e as Bi,D as Ei,U as mi,q as si,a as Ut,r as oi,c as qt,C as be,u as Ci,v as Yi,f as Ji,V as Qi,y as Yt,z as Jt,A as Qt,B as $t,X as Gp,Y as br,Z as x_,F as ct,G as ut,_ as rh,$ as ah,a0 as sh,w as Mt,Q as Pt,R as Lt,o as hl,E as w_,W as Od,a1 as dl,a2 as Vd,a3 as I_,H as Hs,P as oh,T as rl,a4 as Oc,J as k_,O as Br,a5 as lh,a6 as T_,N as E_,a7 as Gu}from"../chunks/index.a4eaa56d.js";import{b as to}from"../chunks/paths.92b098c0.js";import{T as A_,H as S_,S as C_}from"../chunks/Subhead.2dde22bf.js";import{S as M_}from"../chunks/Placeholder.svelte_svelte_type_style_lang.d8a39857.js";import{a as Fr,r as dr,c as Ec,b as z_,d as ju}from"../chunks/utils.e79e846d.js";import{e as Pn,b as Dn,f as Gt,h as Xt,i as ma,m as Ac,j as Nd}from"../chunks/config.caad78aa.js";import{f as D_,e as sl,a as P_,c as L_,g as B_}from"../chunks/index.34b8e95a.js";import{S as R_}from"../chunks/Select.51d4b77f.js";import{w as F_}from"../chunks/index.a81ab247.js";function O_(n){return n}function V_(n){if(n==null)return O_;var a,o,c=n.scale[0],d=n.scale[1],g=n.translate[0],_=n.translate[1];return function(s,x){x||(a=o=0);var T=2,k=s.length,A=new Array(k);for(A[0]=(a+=s[0])*c+g,A[1]=(o+=s[1])*d+_;T<k;)A[T]=s[T],++T;return A}}function N_(n,a){for(var o,c=n.length,d=c-a;d<--c;)o=n[d],n[d++]=n[c],n[c]=o}function U_(n,a){return typeof a=="string"&&(a=n.objects[a]),a.type==="GeometryCollection"?{type:"FeatureCollection",features:a.geometries.map(function(o){return Ud(n,o)})}:Ud(n,a)}function Ud(n,a){var o=a.id,c=a.bbox,d=a.properties==null?{}:a.properties,g=q_(n,a);return o==null&&c==null?{type:"Feature",properties:d,geometry:g}:c==null?{type:"Feature",id:o,properties:d,geometry:g}:{type:"Feature",id:o,bbox:c,properties:d,geometry:g}}function q_(n,a){var o=V_(n.transform),c=n.arcs;function d(k,A){A.length&&A.pop();for(var S=c[k<0?~k:k],V=0,W=S.length;V<W;++V)A.push(o(S[V],V));k<0&&N_(A,W)}function g(k){return o(k)}function _(k){for(var A=[],S=0,V=k.length;S<V;++S)d(k[S],A);return A.length<2&&A.push(A[0]),A}function s(k){for(var A=_(k);A.length<4;)A.push(A[0]);return A}function x(k){return k.map(s)}function T(k){var A=k.type,S;switch(A){case"GeometryCollection":return{type:A,geometries:k.geometries.map(T)};case"Point":S=g(k.coordinates);break;case"MultiPoint":S=k.coordinates.map(g);break;case"LineString":S=_(k.arcs);break;case"MultiLineString":S=k.arcs.map(_);break;case"Polygon":S=x(k.arcs);break;case"MultiPolygon":S=k.arcs.map(x);break;default:return null}return{type:A,coordinates:S}}return T(a)}var wc,jp,Zp;G_({thousands:",",grouping:[3],currency:["$",""]});function G_(n){return wc=D_(n),jp=wc.format,Zp=wc.formatPrefix,wc}function j_(n){return Math.max(0,-sl(Math.abs(n)))}function Z_(n,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(sl(a)/3)))*3-sl(Math.abs(n)))}function X_(n,a){return n=Math.abs(n),a=Math.abs(a)-n,Math.max(0,sl(a)-sl(n))+1}function W_(n){let a,o=`${n[0]}px`,c=`${n[1]}px`,d;const g=n[3].default,_=Lc(g,n,n[2],null);return{c(){a=rt("div"),_&&_.c(),this.h()},l(s){a=at(s,"DIV",{class:!0});var x=ve(a);_&&_.l(x),x.forEach(q),this.h()},h(){E(a,"class","placeholder-container svelte-1mhohmc"),ni(a,"height",o),ni(a,"margin-bottom",c)},m(s,x){Ze(s,a,x),_&&_.m(a,null),d=!0},p(s,[x]){_&&_.p&&(!d||x&4)&&Bc(_,g,s,s[2],d?Fc(g,s[2],x,null):Rc(s[2]),null),x&1&&o!==(o=`${s[0]}px`)&&ni(a,"height",o),x&2&&c!==(c=`${s[1]}px`)&&ni(a,"margin-bottom",c)},i(s){d||(Ye(_,s),d=!0)},o(s){ht(_,s),d=!1},d(s){s&&q(a),_&&_.d(s)}}}function H_(n,a,o){let{$$slots:c={},$$scope:d}=a,{height:g=400}=a,{margin:_=40}=a;return n.$$set=s=>{"height"in s&&o(0,g=s.height),"margin"in s&&o(1,_=s.margin),"$$scope"in s&&o(2,d=s.$$scope)},[g,_,d,c]}class K_ extends vi{constructor(a){super(),bi(this,a,H_,W_,xi,{height:0,margin:1})}}function Y_(n){let a,o,c,d=n[0].label+"",g,_,s,x,T,k,A=n[1].prefix+Fr(dr(n[9],n[1].decimalPlaces))+n[1].suffix+"",S,V,W,Z,Y,H,Q,ae,ne,ge,se,je,ce=n[1].subText!=""&&qd(n),ee=n[2]!=null&&Gd(n);return{c(){a=rt("div"),o=rt("h3"),c=rt("a"),g=si(d),s=Ut(),x=rt("div"),T=rt("div"),k=rt("h4"),S=si(A),V=Ut(),ce&&ce.c(),W=Ut(),Z=rt("div"),Y=rt("div"),H=rt("p"),Q=si(n[7]),ne=Ut(),ge=rt("p"),se=si(n[6]),je=Ut(),ee&&ee.c(),this.h()},l(ke){a=at(ke,"DIV",{class:!0});var _e=ve(a);o=at(_e,"H3",{class:!0});var me=ve(o);c=at(me,"A",{href:!0});var Me=ve(c);g=oi(Me,d),Me.forEach(q),me.forEach(q),s=qt(_e),x=at(_e,"DIV",{class:!0});var Re=ve(x);T=at(Re,"DIV",{class:!0});var he=ve(T);k=at(he,"H4",{class:!0});var Ee=ve(k);S=oi(Ee,A),Ee.forEach(q),V=qt(he),ce&&ce.l(he),he.forEach(q),W=qt(Re),Z=at(Re,"DIV",{class:!0});var ft=ve(Z);Y=at(ft,"DIV",{class:!0,style:!0});var nt=ve(Y);H=at(nt,"P",{class:!0});var Fe=ve(H);Q=oi(Fe,n[7]),Fe.forEach(q),nt.forEach(q),ne=qt(ft),ge=at(ft,"P",{class:!0});var Se=ve(ge);se=oi(Se,n[6]),Se.forEach(q),ft.forEach(q),je=qt(Re),ee&&ee.l(Re),Re.forEach(q),_e.forEach(q),this.h()},h(){E(c,"href",_=to+"/indicators/"+n[0].code),E(o,"class","svelte-j4tg4p"),E(k,"class","svelte-j4tg4p"),E(T,"class","flexV column1 svelte-j4tg4p"),E(H,"class","from-comparison-description svelte-j4tg4p"),E(Y,"class","headlineLabel svelte-j4tg4p"),E(Y,"style",ae=+n[8]==null?null:"background-color:"+n[8]+"; box-shadow: 0 0 4px 3px "+n[8]+";"),E(ge,"class","additionalInfoText svelte-j4tg4p"),E(Z,"class","flexV column2 svelte-j4tg4p"),E(x,"class","flexH svelte-j4tg4p"),E(a,"class","panel-container svelte-j4tg4p")},m(ke,_e){Ze(ke,a,_e),be(a,o),be(o,c),be(c,g),be(a,s),be(a,x),be(x,T),be(T,k),be(k,S),be(T,V),ce&&ce.m(T,null),be(x,W),be(x,Z),be(Z,Y),be(Y,H),be(H,Q),be(Z,ne),be(Z,ge),be(ge,se),be(x,je),ee&&ee.m(x,null)},p(ke,_e){_e[0]&1&&d!==(d=ke[0].label+"")&&Ci(g,d),_e[0]&1&&_!==(_=to+"/indicators/"+ke[0].code)&&E(c,"href",_),_e[0]&2&&A!==(A=ke[1].prefix+Fr(dr(ke[9],ke[1].decimalPlaces))+ke[1].suffix+"")&&Ci(S,A),ke[1].subText!=""?ce?ce.p(ke,_e):(ce=qd(ke),ce.c(),ce.m(T,null)):ce&&(ce.d(1),ce=null),_e[0]&128&&Ci(Q,ke[7]),_e[0]&256&&ae!==(ae=+ke[8]==null?null:"background-color:"+ke[8]+"; box-shadow: 0 0 4px 3px "+ke[8]+";")&&E(Y,"style",ae),_e[0]&64&&Ci(se,ke[6]),ke[2]!=null?ee?ee.p(ke,_e):(ee=Gd(ke),ee.c(),ee.m(x,null)):ee&&(ee.d(1),ee=null)},d(ke){ke&&q(a),ce&&ce.d(),ee&&ee.d()}}}function qd(n){let a,o=n[1].subText+"",c;return{c(){a=rt("p"),c=si(o),this.h()},l(d){a=at(d,"P",{class:!0});var g=ve(a);c=oi(g,o),g.forEach(q),this.h()},h(){E(a,"class","subText svelte-j4tg4p")},m(d,g){Ze(d,a,g),be(a,c)},p(d,g){g[0]&2&&o!==(o=d[1].subText+"")&&Ci(c,o)},d(d){d&&q(a)}}}function Gd(n){let a,o,c,d,g,_,s,x;return{c(){a=rt("div"),o=rt("div"),c=rt("p"),d=si(n[4]),_=Ut(),s=rt("p"),x=si(n[3]),this.h()},l(T){a=at(T,"DIV",{class:!0});var k=ve(a);o=at(k,"DIV",{class:!0,style:!0});var A=ve(o);c=at(A,"P",{class:!0});var S=ve(c);d=oi(S,n[4]),S.forEach(q),A.forEach(q),_=qt(k),s=at(k,"P",{class:!0});var V=ve(s);x=oi(V,n[3]),V.forEach(q),k.forEach(q),this.h()},h(){E(c,"class","from-comparison-description svelte-j4tg4p"),E(o,"class","headlineLabel svelte-j4tg4p"),E(o,"style",g=+n[8]==null?null:"background-color:"+n[5]+"; box-shadow: 0 0 4px 3px "+n[5]+";"),E(s,"class","additionalInfoText svelte-j4tg4p"),E(a,"class","flexV column3 svelte-j4tg4p")},m(T,k){Ze(T,a,k),be(a,o),be(o,c),be(c,d),be(a,_),be(a,s),be(s,x)},p(T,k){k[0]&16&&Ci(d,T[4]),k[0]&288&&g!==(g=+T[8]==null?null:"background-color:"+T[5]+"; box-shadow: 0 0 4px 3px "+T[5]+";")&&E(o,"style",g),k[0]&8&&Ci(x,T[3])},d(T){T&&q(a)}}}function J_(n){let a,o=n[9]!=null&&Y_(n);return{c(){o&&o.c(),a=Bi()},l(c){o&&o.l(c),a=Bi()},m(c,d){o&&o.m(c,d),Ze(c,a,d)},p(c,d){c[9]!=null&&o.p(c,d)},i:Ei,o:Ei,d(c){o&&o.d(c),c&&q(a)}}}function Q_(n,a,o){let c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge,se,je,ce,ee,ke,_e,me,Me,Re,he,Ee,ft,{indicator:nt,calculations:Fe,metadata:Se,chosenId11:de,baselineComparisonArea:Qe,chosenId2:Je}=a,yt=mi("selectedArea"),mt=Fe.calcs[Fe.maxXDomain].main,Xe=mi("selectedAndRelatedAreas"),gt=Fe.calcs[Fe.maxXDomain].mad;return n.$$set=ze=>{"indicator"in ze&&o(0,nt=ze.indicator),"calculations"in ze&&o(10,Fe=ze.calculations),"metadata"in ze&&o(1,Se=ze.metadata),"chosenId11"in ze&&o(11,de=ze.chosenId11),"baselineComparisonArea"in ze&&o(12,Qe=ze.baselineComparisonArea),"chosenId2"in ze&&o(13,Je=ze.chosenId2)},n.$$.update=()=>{n.$$.dirty[0]&9216&&o(14,c=Je==="earliest available year"?Fe.mainMinXDomain:Je==="previous year"?Fe.maxXDomain-1:Je),n.$$.dirty[0]&5120&&o(26,d=Fe.calcs[Fe.maxXDomain][(Qe.areacd==="median"?Qe:Xe.find(ze=>Qe.areacd===ze.areacd)).role]),n.$$.dirty[0]&67108864&&o(27,g=mt==null|d==null|gt==null?null:(mt-d)/gt),n.$$.dirty[0]&2048&&o(37,_=de.includes(1)),n.$$.dirty[0]&2&&o(36,s=Se.polarity==0?null:Se.polarity==-1?"better":"worse"),n.$$.dirty[0]&2&&o(35,x=Se.polarity==0?null:"similar"),n.$$.dirty[0]&2&&o(34,T=Se.polarity==0?null:Se.polarity==1?"better":"worse"),n.$$.dirty[0]&2048&&o(31,k=de.includes(3)?2:1),n.$$.dirty[0]&134217730|n.$$.dirty[1]&121&&o(8,A=!_|g==null|Se.polarity==0?null:g<-k?Pn[s]:g<=k?Pn[x]:Pn[T]),n.$$.dirty[0]&4096&&o(28,S=Qe.areacd==="median"?"median":Qe.areanm),n.$$.dirty[0]&2048&&o(33,V=de.includes(2)),n.$$.dirty[0]&2|n.$$.dirty[1]&4&&o(32,W=Se.polarity==0|!V?"Lower than":Se.polarity==-1?"Better than":"Worse than"),n.$$.dirty[0]&2|n.$$.dirty[1]&4&&o(29,Y=Se.polarity==0|!V?"Higher than":Se.polarity==1?"Better than":"Worse than"),n.$$.dirty[0]&2080374784|n.$$.dirty[1]&3&&o(7,H=mt==null?"No "+yt.areanm+" data":d==null?"No "+S+" data":(g<-k?W:g<=k?Z:Y)+" "+S),n.$$.dirty[0]&201330690&&o(6,Q=(g==0?"Equal":g>0?g>3?"Far above":"Above":g<-3?"Far below":"Below")+" "+(Qe.areacd==="median"?"median":Qe.areanm+"-wide average")+(g==0?".":" ("+Se.prefix+Fr(dr(d,Se.decimalPlaces))+Se.suffix+").")),n.$$.dirty[0]&17408&&o(2,ae=c in Fe.calcs?Fe.calcs[c].main:null),n.$$.dirty[0]&4&&o(15,ne=mt==null|ae==null|gt==null?null:(mt-ae)/gt),n.$$.dirty[0]&2048&&o(25,ge=de.includes(1)),n.$$.dirty[0]&2&&o(24,se=Se.polarity==0?null:Se.polarity==-1?"better":"worse"),n.$$.dirty[0]&2&&o(23,je=Se.polarity==0?null:"similar"),n.$$.dirty[0]&2&&o(22,ce=Se.polarity==0?null:Se.polarity==1?"better":"worse"),n.$$.dirty[0]&2048&&o(19,ee=de.includes(3)?2:1),n.$$.dirty[0]&63489026&&o(5,ke=!ge|ne==null|Se.polarity==0|c==Fe.maxXDomain?null:ne<-ee?Pn[se]:ne<=ee?Pn[je]:Pn[ce]),n.$$.dirty[0]&2048&&o(21,_e=de.includes(2)),n.$$.dirty[0]&2097154&&o(20,me=Se.polarity==0|!_e?"Decreased":Se.polarity==-1?"Improved":"Worsened"),n.$$.dirty[0]&2097154&&o(17,Re=Se.polarity==0|!_e?"Increased":Se.polarity==1?"Improved":"Worsened"),n.$$.dirty[0]&2016260&&o(4,he=c==Fe.maxXDomain?"No historical data":mt==null?"No data in "+Fe.maxXDomain:ae==null?"No data in "+c:(ne<-ee?me:ne<=ee?Me:Re)+" since "+c),n.$$.dirty[0]&4&&o(16,Ee=Math.round(100*(mt-ae)/ae)),n.$$.dirty[0]&115712&&o(3,ft=ne===0?"No change from ":Math.abs(Ee)+"% "+(ne>0?"increase":"descrease")+" from "+c+" to "+Fe.maxXDomain+".")},o(30,Z="Similar to"),o(18,Me="Little change"),[nt,Se,ae,ft,he,ke,Q,H,A,mt,Fe,de,Qe,Je,c,ne,Ee,Re,Me,ee,me,_e,ce,je,se,ge,d,g,S,Y,Z,k,W,V,T,x,s,_]}class $_ extends vi{constructor(a){super(),bi(this,a,Q_,J_,xi,{indicator:0,calculations:10,metadata:1,chosenId11:11,baselineComparisonArea:12,chosenId2:13},null,[-1,-1])}}function jd(n,a,o){const c=n.slice();return c[8]=a[o],c}function Zd(n){let a,o;function c(...g){return n[6](n[8],...g)}function d(...g){return n[7](n[8],...g)}return a=new $_({props:{indicator:n[8],metadata:n[4].find(c),calculations:n[5].find(d),chosenId11:n[1],baselineComparisonArea:n[2],chosenId2:n[3]}}),{c(){Yt(a.$$.fragment)},l(g){Jt(a.$$.fragment,g)},m(g,_){Qt(a,g,_),o=!0},p(g,_){n=g;const s={};_&1&&(s.indicator=n[8]),_&1&&(s.metadata=n[4].find(c)),_&1&&(s.calculations=n[5].find(d)),_&2&&(s.chosenId11=n[1]),_&4&&(s.baselineComparisonArea=n[2]),_&8&&(s.chosenId2=n[3]),a.$set(s)},i(g){o||(Ye(a.$$.fragment,g),o=!0)},o(g){ht(a.$$.fragment,g),o=!1},d(g){$t(a,g)}}}function ey(n){let a,o,c,d,g,_,s=n[0],x=[];for(let k=0;k<s.length;k+=1)x[k]=Zd(jd(n,s,k));const T=k=>ht(x[k],1,1,()=>{x[k]=null});return{c(){a=rt("section"),o=rt("h1"),c=si("Key indicators"),d=Ut(),g=rt("div");for(let k=0;k<x.length;k+=1)x[k].c();this.h()},l(k){a=at(k,"SECTION",{title:!0,class:!0});var A=ve(a);o=at(A,"H1",{class:!0});var S=ve(o);c=oi(S,"Key indicators"),S.forEach(q),d=qt(A),g=at(A,"DIV",{class:!0});var V=ve(g);for(let W=0;W<x.length;W+=1)x[W].l(V);V.forEach(q),A.forEach(q),this.h()},h(){E(o,"class","svelte-vwe7i6"),E(g,"class","rowsContainer"),E(a,"title","Key indicators"),E(a,"class","svelte-vwe7i6")},m(k,A){Ze(k,a,A),be(a,o),be(o,c),be(a,d),be(a,g);for(let S=0;S<x.length;S+=1)x[S]&&x[S].m(g,null);_=!0},p(k,[A]){if(A&63){s=k[0];let S;for(S=0;S<s.length;S+=1){const V=jd(k,s,S);x[S]?(x[S].p(V,A),Ye(x[S],1)):(x[S]=Zd(V),x[S].c(),Ye(x[S],1),x[S].m(g,null))}for(Yi(),S=s.length;S<x.length;S+=1)T(S);Ji()}},i(k){if(!_){for(let A=0;A<s.length;A+=1)Ye(x[A]);_=!0}},o(k){x=x.filter(Boolean);for(let A=0;A<x.length;A+=1)ht(x[A]);_=!1},d(k){k&&q(a),Qi(x,k)}}}function ty(n,a,o){let{indicators:c,chosenId11:d,baselineComparisonArea:g,chosenId2:_}=a,s=mi("indicatorsMetadata"),x=mi("indicatorsCalculations");const T=(A,S)=>S.code===A.code,k=(A,S)=>S.id===A.id;return n.$$set=A=>{"indicators"in A&&o(0,c=A.indicators),"chosenId11"in A&&o(1,d=A.chosenId11),"baselineComparisonArea"in A&&o(2,g=A.baselineComparisonArea),"chosenId2"in A&&o(3,_=A.chosenId2)},n.$$.update=()=>{n.$$.dirty&1&&console.log(c)},[c,d,g,_,s,x,T,k]}class iy extends vi{constructor(a){super(),bi(this,a,ty,ey,xi,{indicators:0,chosenId11:1,baselineComparisonArea:2,chosenId2:3})}}function Xd(n,a,o){const c=n.slice();return c[6]=a[o],c[8]=o,c}function Wd(n){let a,o,c,d,g=n[6]+"",_,s,x,T,k;return x=Gp(n[5][0]),{c(){a=rt("label"),o=rt("input"),c=Ut(),d=rt("p"),_=si(g),s=Ut(),this.h()},l(A){a=at(A,"LABEL",{style:!0,class:!0});var S=ve(a);o=at(S,"INPUT",{type:!0,name:!0}),c=qt(S),d=at(S,"P",{class:!0});var V=ve(d);_=oi(V,g),V.forEach(q),s=qt(S),S.forEach(q),this.h()},h(){E(o,"type","checkbox"),o.__value=n[8],o.value=o.__value,E(o,"name",n[2]),E(d,"class","svelte-8oxv8t"),ni(a,"margin-bottom",n[3]==null?null:n[3]),E(a,"class","svelte-8oxv8t"),x.p(o)},m(A,S){Ze(A,a,S),be(a,o),o.checked=~(n[0]||[]).indexOf(o.__value),be(a,c),be(a,d),be(d,_),be(a,s),T||(k=br(o,"change",n[4]),T=!0)},p(A,S){S&4&&E(o,"name",A[2]),S&3&&(o.checked=~(A[0]||[]).indexOf(o.__value)),S&2&&g!==(g=A[6]+"")&&Ci(_,g),S&8&&ni(a,"margin-bottom",A[3]==null?null:A[3])},d(A){A&&q(a),x.r(),T=!1,k()}}}function ny(n){let a,o=n[1],c=[];for(let d=0;d<o.length;d+=1)c[d]=Wd(Xd(n,o,d));return{c(){a=rt("div");for(let d=0;d<c.length;d+=1)c[d].c();this.h()},l(d){a=at(d,"DIV",{class:!0});var g=ve(a);for(let _=0;_<c.length;_+=1)c[_].l(g);g.forEach(q),this.h()},h(){E(a,"class","radio-container svelte-8oxv8t")},m(d,g){Ze(d,a,g);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(a,null)},p(d,[g]){if(g&15){o=d[1];let _;for(_=0;_<o.length;_+=1){const s=Xd(d,o,_);c[_]?c[_].p(s,g):(c[_]=Wd(s),c[_].c(),c[_].m(a,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},i:Ei,o:Ei,d(d){d&&q(a),Qi(c,d)}}}function ry(n,a,o){let{optionsArray:c,chosenId:d,name:g,spacing:_=null}=a;const s=[[]];function x(){d=x_(s[0],this.__value,this.checked),o(0,d)}return n.$$set=T=>{"optionsArray"in T&&o(1,c=T.optionsArray),"chosenId"in T&&o(0,d=T.chosenId),"name"in T&&o(2,g=T.name),"spacing"in T&&o(3,_=T.spacing)},[d,c,g,_,x,s]}class ol extends vi{constructor(a){super(),bi(this,a,ry,ny,xi,{optionsArray:1,chosenId:0,name:2,spacing:3})}}function Hd(n,a,o){const c=n.slice();return c[8]=a[o],c[10]=o,c}function Kd(n){let a,o,c,d,g,_=n[8]+"",s,x,T,k,A;return T=Gp(n[7][0]),{c(){a=rt("label"),o=rt("input"),c=Ut(),d=rt("div"),g=rt("p"),s=si(_),x=Ut(),this.h()},l(S){a=at(S,"LABEL",{style:!0,class:!0});var V=ve(a);o=at(V,"INPUT",{style:!0,type:!0,name:!0}),c=qt(V),d=at(V,"DIV",{class:!0,style:!0});var W=ve(d);g=at(W,"P",{style:!0,class:!0});var Z=ve(g);s=oi(Z,_),Z.forEach(q),W.forEach(q),x=qt(V),V.forEach(q),this.h()},h(){ni(o,"display","none"),E(o,"type","radio"),o.__value=n[10],o.value=o.__value,E(o,"name",n[2]),ni(g,"font-size",n[4]),E(g,"class","svelte-1o62d9i"),E(d,"class","optionLabel svelte-1o62d9i"),ni(d,"background-color",n[0]===n[10]?"white":"#e3e3e3"),ni(a,"margin-bottom",n[3]),ni(a,"max-width","500px"),E(a,"class","svelte-1o62d9i"),T.p(o)},m(S,V){Ze(S,a,V),be(a,o),o.checked=o.__value===n[0],be(a,c),be(a,d),be(d,g),be(g,s),be(a,x),k||(A=br(o,"change",n[6]),k=!0)},p(S,V){V&4&&E(o,"name",S[2]),V&3&&(o.checked=o.__value===S[0]),V&2&&_!==(_=S[8]+"")&&Ci(s,_),V&16&&ni(g,"font-size",S[4]),V&1&&ni(d,"background-color",S[0]===S[10]?"white":"#e3e3e3"),V&8&&ni(a,"margin-bottom",S[3])},d(S){S&&q(a),T.r(),k=!1,A()}}}function ay(n){let a,o=n[1],c=[];for(let d=0;d<o.length;d+=1)c[d]=Kd(Hd(n,o,d));return{c(){a=rt("div");for(let d=0;d<c.length;d+=1)c[d].c();this.h()},l(d){a=at(d,"DIV",{class:!0});var g=ve(a);for(let _=0;_<c.length;_+=1)c[_].l(g);g.forEach(q),this.h()},h(){E(a,"class","radio-container svelte-1o62d9i")},m(d,g){Ze(d,a,g);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(a,null)},p(d,[g]){if(g&31){o=d[1];let _;for(_=0;_<o.length;_+=1){const s=Hd(d,o,_);c[_]?c[_].p(s,g):(c[_]=Kd(s),c[_].c(),c[_].m(a,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},i:Ei,o:Ei,d(d){d&&q(a),Qi(c,d)}}}function sy(n,a,o){let{optionsArray:c,chosenId:d,name:g,marginBottom:_=null,fontSize:s=null,width:x}=a;const T=[[]];function k(){d=this.__value,o(0,d)}return n.$$set=A=>{"optionsArray"in A&&o(1,c=A.optionsArray),"chosenId"in A&&o(0,d=A.chosenId),"name"in A&&o(2,g=A.name),"marginBottom"in A&&o(3,_=A.marginBottom),"fontSize"in A&&o(4,s=A.fontSize),"width"in A&&o(5,x=A.width)},[d,c,g,_,s,x,k,T]}class Xp extends vi{constructor(a){super(),bi(this,a,sy,ay,xi,{optionsArray:1,chosenId:0,name:2,marginBottom:3,fontSize:4,width:5})}}function Yd(n,a,o){const c=n.slice();return c[2]=a[o],c[4]=o,c}function Jd(n){let a,o,c;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(d){a=ut(d,"g",{transform:!0});var g=ve(a);o=ut(g,"circle",{r:!0,stroke:!0,"stroke-width":!0,fill:!0,opacity:!0,"pointer-events":!0}),ve(o).forEach(q),g.forEach(q),this.h()},h(){E(o,"r","7"),E(o,"stroke","white"),E(o,"stroke-width","2px"),E(o,"fill","#F39431"),E(o,"opacity","1"),E(o,"pointer-events","none"),E(a,"transform",c="translate("+n[2].x+","+n[1](n[2].y)+")")},m(d,g){Ze(d,a,g),be(a,o)},p(d,g){g&3&&c!==(c="translate("+d[2].x+","+d[1](d[2].y)+")")&&E(a,"transform",c)},d(d){d&&q(a)}}}function oy(n){let a,o=n[0],c=[];for(let d=0;d<o.length;d+=1)c[d]=Jd(Yd(n,o,d));return{c(){a=ct("g");for(let d=0;d<c.length;d+=1)c[d].c();this.h()},l(d){a=ut(d,"g",{class:!0});var g=ve(a);for(let _=0;_<c.length;_+=1)c[_].l(g);g.forEach(q),this.h()},h(){E(a,"class","hoverCirclesGroup")},m(d,g){Ze(d,a,g);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(a,null)},p(d,[g]){if(g&3){o=d[0];let _;for(_=0;_<o.length;_+=1){const s=Yd(d,o,_);c[_]?c[_].p(s,g):(c[_]=Jd(s),c[_].c(),c[_].m(a,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},i:Ei,o:Ei,d(d){d&&q(a),Qi(c,d)}}}function ly(n,a,o){let{backgroundCirclesStep2:c,y:d}=a;return n.$$set=g=>{"backgroundCirclesStep2"in g&&o(0,c=g.backgroundCirclesStep2),"y"in g&&o(1,d=g.y)},[c,d]}class cy extends vi{constructor(a){super(),bi(this,a,ly,oy,xi,{backgroundCirclesStep2:0,y:1})}}class Wp{constructor(a,o,c){this.items=a,this.diameter=o*2,this.diameterSq=this.diameter*this.diameter,this.xFun=c,this.tieBreakFn=d=>d,this._oneSided=!1}withTiesBrokenRandomly(){return this.tieBreakFn=this._sfc32(2654435769,608135816,3084996962,1),this}oneSided(){return this._oneSided=!0,this}calculateYPositions(){let a=this.items.map((d,g)=>({datum:d,originalIndex:g,x:this.xFun(d),y:null,placed:!1,minPositiveY:0,maxNegativeY:0,score:0,bestPosition:0,heapPos:-1})).sort((d,g)=>d.x-g.x);a.forEach(function(d,g){d.index=g});let o=this.tieBreakFn;a.forEach(function(d){d.tieBreaker=o(d.x)});let c=new uy;for(c.push(...a);!c.isEmpty();){let d=c.pop();d.placed=!0,d.y=d.bestPosition,this._updateYBounds(d,a,c)}return a.sort((d,g)=>d.originalIndex-g.originalIndex),a.map(d=>({datum:d.datum,x:d.x,y:d.y}))}_sfc32(a,o,c,d){let g=function(){a>>>=0,o>>>=0,c>>>=0,d>>>=0;var _=a+o|0;return a=o^o>>>9,o=c+(c<<3)|0,c=c<<21|c>>>11,d=d+1|0,_=_+d|0,c=c+_|0,(_>>>0)/4294967296};for(let _=0;_<10;_++)g();return g}_updateYBounds(a,o,c){for(let d of[-1,1]){let g;for(let _=a.index+d;_>=0&&_<o.length&&(g=Math.abs(a.x-o[_].x))<this.diameter;_+=d){let s=o[_];if(s.placed)continue;let x=Math.sqrt(this.diameterSq-g*g);s.minPositiveY=Math.max(s.minPositiveY,a.y+x);let T=s.score;s.score=s.minPositiveY,s.bestPosition=s.minPositiveY,this._oneSided||(s.maxNegativeY=Math.min(s.maxNegativeY,a.y-x),-s.maxNegativeY<s.score&&(s.score=-s.maxNegativeY,s.bestPosition=s.maxNegativeY)),s.score>T&&c.deprioritise(s)}}}}class uy{parent(a){return(a+1>>>1)-1}left(a){return(a<<1)+1}right(a){return a+1<<1}constructor(){this.TOP=0,this._heap=[]}size(){return this._heap.length}isEmpty(){return this.size()==0}peek(){return this._heap[this.TOP]}push(...a){return a.forEach(o=>{o.heapPos=this.size(),this._heap.push(o),this._siftUp()}),this.size()}pop(){const a=this.peek(),o=this.size()-1;return o>this.TOP&&this._swap(this.TOP,o),this._heap.pop(),this._siftDown(),a}deprioritise(a){this._siftDown(a.heapPos)}_greater(a,o){let c=this._heap[a],d=this._heap[o];return c.score<d.score?!0:c.score>d.score?!1:c.tieBreaker<d.tieBreaker}_swap(a,o){let c=this._heap[a];this._heap[a]=this._heap[o],this._heap[o]=c,this._heap[a].heapPos=a,this._heap[o].heapPos=o}_siftUp(){let a=this.size()-1;for(;a>this.TOP&&this._greater(a,this.parent(a));)this._swap(a,this.parent(a)),a=this.parent(a)}_siftDown(a=this.TOP){let o,c,d=this.size();for(;o=this.left(a),c=this.right(a),o<d&&this._greater(o,a)||c<d&&this._greater(c,a);){let g=c<d&&this._greater(c,o)?c:o;this._swap(a,g),a=g}}}var Ku="http://www.w3.org/1999/xhtml";const Qd={svg:"http://www.w3.org/2000/svg",xhtml:Ku,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Hp(n){var a=n+="",o=a.indexOf(":");return o>=0&&(a=n.slice(0,o))!=="xmlns"&&(n=n.slice(o+1)),Qd.hasOwnProperty(a)?{space:Qd[a],local:n}:n}function hy(n){return function(){var a=this.ownerDocument,o=this.namespaceURI;return o===Ku&&a.documentElement.namespaceURI===Ku?a.createElement(n):a.createElementNS(o,n)}}function dy(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Kp(n){var a=Hp(n);return(a.local?dy:hy)(a)}function fy(){}function Yp(n){return n==null?fy:function(){return this.querySelector(n)}}function py(n){typeof n!="function"&&(n=Yp(n));for(var a=this._groups,o=a.length,c=new Array(o),d=0;d<o;++d)for(var g=a[d],_=g.length,s=c[d]=new Array(_),x,T,k=0;k<_;++k)(x=g[k])&&(T=n.call(x,x.__data__,k,g))&&("__data__"in x&&(T.__data__=x.__data__),s[k]=T);return new xr(c,this._parents)}function my(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function gy(){return[]}function _y(n){return n==null?gy:function(){return this.querySelectorAll(n)}}function yy(n){return function(){return my(n.apply(this,arguments))}}function vy(n){typeof n=="function"?n=yy(n):n=_y(n);for(var a=this._groups,o=a.length,c=[],d=[],g=0;g<o;++g)for(var _=a[g],s=_.length,x,T=0;T<s;++T)(x=_[T])&&(c.push(n.call(x,x.__data__,T,_)),d.push(x));return new xr(c,d)}function by(n){return function(){return this.matches(n)}}function Jp(n){return function(a){return a.matches(n)}}var xy=Array.prototype.find;function wy(n){return function(){return xy.call(this.children,n)}}function Iy(){return this.firstElementChild}function ky(n){return this.select(n==null?Iy:wy(typeof n=="function"?n:Jp(n)))}var Ty=Array.prototype.filter;function Ey(){return Array.from(this.children)}function Ay(n){return function(){return Ty.call(this.children,n)}}function Sy(n){return this.selectAll(n==null?Ey:Ay(typeof n=="function"?n:Jp(n)))}function Cy(n){typeof n!="function"&&(n=by(n));for(var a=this._groups,o=a.length,c=new Array(o),d=0;d<o;++d)for(var g=a[d],_=g.length,s=c[d]=[],x,T=0;T<_;++T)(x=g[T])&&n.call(x,x.__data__,T,g)&&s.push(x);return new xr(c,this._parents)}function Qp(n){return new Array(n.length)}function My(){return new xr(this._enter||this._groups.map(Qp),this._parents)}function Sc(n,a){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=a}Sc.prototype={constructor:Sc,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,a){return this._parent.insertBefore(n,a)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function zy(n){return function(){return n}}function Dy(n,a,o,c,d,g){for(var _=0,s,x=a.length,T=g.length;_<T;++_)(s=a[_])?(s.__data__=g[_],c[_]=s):o[_]=new Sc(n,g[_]);for(;_<x;++_)(s=a[_])&&(d[_]=s)}function Py(n,a,o,c,d,g,_){var s,x,T=new Map,k=a.length,A=g.length,S=new Array(k),V;for(s=0;s<k;++s)(x=a[s])&&(S[s]=V=_.call(x,x.__data__,s,a)+"",T.has(V)?d[s]=x:T.set(V,x));for(s=0;s<A;++s)V=_.call(n,g[s],s,g)+"",(x=T.get(V))?(c[s]=x,x.__data__=g[s],T.delete(V)):o[s]=new Sc(n,g[s]);for(s=0;s<k;++s)(x=a[s])&&T.get(S[s])===x&&(d[s]=x)}function Ly(n){return n.__data__}function By(n,a){if(!arguments.length)return Array.from(this,Ly);var o=a?Py:Dy,c=this._parents,d=this._groups;typeof n!="function"&&(n=zy(n));for(var g=d.length,_=new Array(g),s=new Array(g),x=new Array(g),T=0;T<g;++T){var k=c[T],A=d[T],S=A.length,V=Ry(n.call(k,k&&k.__data__,T,c)),W=V.length,Z=s[T]=new Array(W),Y=_[T]=new Array(W),H=x[T]=new Array(S);o(k,A,Z,Y,H,V,a);for(var Q=0,ae=0,ne,ge;Q<W;++Q)if(ne=Z[Q]){for(Q>=ae&&(ae=Q+1);!(ge=Y[ae])&&++ae<W;);ne._next=ge||null}}return _=new xr(_,c),_._enter=s,_._exit=x,_}function Ry(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function Fy(){return new xr(this._exit||this._groups.map(Qp),this._parents)}function Oy(n,a,o){var c=this.enter(),d=this,g=this.exit();return typeof n=="function"?(c=n(c),c&&(c=c.selection())):c=c.append(n+""),a!=null&&(d=a(d),d&&(d=d.selection())),o==null?g.remove():o(g),c&&d?c.merge(d).order():d}function Vy(n){for(var a=n.selection?n.selection():n,o=this._groups,c=a._groups,d=o.length,g=c.length,_=Math.min(d,g),s=new Array(d),x=0;x<_;++x)for(var T=o[x],k=c[x],A=T.length,S=s[x]=new Array(A),V,W=0;W<A;++W)(V=T[W]||k[W])&&(S[W]=V);for(;x<d;++x)s[x]=o[x];return new xr(s,this._parents)}function Ny(){for(var n=this._groups,a=-1,o=n.length;++a<o;)for(var c=n[a],d=c.length-1,g=c[d],_;--d>=0;)(_=c[d])&&(g&&_.compareDocumentPosition(g)^4&&g.parentNode.insertBefore(_,g),g=_);return this}function Uy(n){n||(n=qy);function a(A,S){return A&&S?n(A.__data__,S.__data__):!A-!S}for(var o=this._groups,c=o.length,d=new Array(c),g=0;g<c;++g){for(var _=o[g],s=_.length,x=d[g]=new Array(s),T,k=0;k<s;++k)(T=_[k])&&(x[k]=T);x.sort(a)}return new xr(d,this._parents).order()}function qy(n,a){return n<a?-1:n>a?1:n>=a?0:NaN}function Gy(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function jy(){return Array.from(this)}function Zy(){for(var n=this._groups,a=0,o=n.length;a<o;++a)for(var c=n[a],d=0,g=c.length;d<g;++d){var _=c[d];if(_)return _}return null}function Xy(){let n=0;for(const a of this)++n;return n}function Wy(){return!this.node()}function Hy(n){for(var a=this._groups,o=0,c=a.length;o<c;++o)for(var d=a[o],g=0,_=d.length,s;g<_;++g)(s=d[g])&&n.call(s,s.__data__,g,d);return this}function Ky(n){return function(){this.removeAttribute(n)}}function Yy(n){return function(){this.removeAttributeNS(n.space,n.local)}}function Jy(n,a){return function(){this.setAttribute(n,a)}}function Qy(n,a){return function(){this.setAttributeNS(n.space,n.local,a)}}function $y(n,a){return function(){var o=a.apply(this,arguments);o==null?this.removeAttribute(n):this.setAttribute(n,o)}}function e0(n,a){return function(){var o=a.apply(this,arguments);o==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,o)}}function t0(n,a){var o=Hp(n);if(arguments.length<2){var c=this.node();return o.local?c.getAttributeNS(o.space,o.local):c.getAttribute(o)}return this.each((a==null?o.local?Yy:Ky:typeof a=="function"?o.local?e0:$y:o.local?Qy:Jy)(o,a))}function $p(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function i0(n){return function(){this.style.removeProperty(n)}}function n0(n,a,o){return function(){this.style.setProperty(n,a,o)}}function r0(n,a,o){return function(){var c=a.apply(this,arguments);c==null?this.style.removeProperty(n):this.style.setProperty(n,c,o)}}function a0(n,a,o){return arguments.length>1?this.each((a==null?i0:typeof a=="function"?r0:n0)(n,a,o??"")):s0(this.node(),n)}function s0(n,a){return n.style.getPropertyValue(a)||$p(n).getComputedStyle(n,null).getPropertyValue(a)}function o0(n){return function(){delete this[n]}}function l0(n,a){return function(){this[n]=a}}function c0(n,a){return function(){var o=a.apply(this,arguments);o==null?delete this[n]:this[n]=o}}function u0(n,a){return arguments.length>1?this.each((a==null?o0:typeof a=="function"?c0:l0)(n,a)):this.node()[n]}function em(n){return n.trim().split(/^|\s+/)}function ch(n){return n.classList||new tm(n)}function tm(n){this._node=n,this._names=em(n.getAttribute("class")||"")}tm.prototype={add:function(n){var a=this._names.indexOf(n);a<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var a=this._names.indexOf(n);a>=0&&(this._names.splice(a,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function im(n,a){for(var o=ch(n),c=-1,d=a.length;++c<d;)o.add(a[c])}function nm(n,a){for(var o=ch(n),c=-1,d=a.length;++c<d;)o.remove(a[c])}function h0(n){return function(){im(this,n)}}function d0(n){return function(){nm(this,n)}}function f0(n,a){return function(){(a.apply(this,arguments)?im:nm)(this,n)}}function p0(n,a){var o=em(n+"");if(arguments.length<2){for(var c=ch(this.node()),d=-1,g=o.length;++d<g;)if(!c.contains(o[d]))return!1;return!0}return this.each((typeof a=="function"?f0:a?h0:d0)(o,a))}function m0(){this.textContent=""}function g0(n){return function(){this.textContent=n}}function _0(n){return function(){var a=n.apply(this,arguments);this.textContent=a??""}}function y0(n){return arguments.length?this.each(n==null?m0:(typeof n=="function"?_0:g0)(n)):this.node().textContent}function v0(){this.innerHTML=""}function b0(n){return function(){this.innerHTML=n}}function x0(n){return function(){var a=n.apply(this,arguments);this.innerHTML=a??""}}function w0(n){return arguments.length?this.each(n==null?v0:(typeof n=="function"?x0:b0)(n)):this.node().innerHTML}function I0(){this.nextSibling&&this.parentNode.appendChild(this)}function k0(){return this.each(I0)}function T0(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function E0(){return this.each(T0)}function A0(n){var a=typeof n=="function"?n:Kp(n);return this.select(function(){return this.appendChild(a.apply(this,arguments))})}function S0(){return null}function C0(n,a){var o=typeof n=="function"?n:Kp(n),c=a==null?S0:typeof a=="function"?a:Yp(a);return this.select(function(){return this.insertBefore(o.apply(this,arguments),c.apply(this,arguments)||null)})}function M0(){var n=this.parentNode;n&&n.removeChild(this)}function z0(){return this.each(M0)}function D0(){var n=this.cloneNode(!1),a=this.parentNode;return a?a.insertBefore(n,this.nextSibling):n}function P0(){var n=this.cloneNode(!0),a=this.parentNode;return a?a.insertBefore(n,this.nextSibling):n}function L0(n){return this.select(n?P0:D0)}function B0(n){return arguments.length?this.property("__data__",n):this.node().__data__}function R0(n){return function(a){n.call(this,a,this.__data__)}}function F0(n){return n.trim().split(/^|\s+/).map(function(a){var o="",c=a.indexOf(".");return c>=0&&(o=a.slice(c+1),a=a.slice(0,c)),{type:a,name:o}})}function O0(n){return function(){var a=this.__on;if(a){for(var o=0,c=-1,d=a.length,g;o<d;++o)g=a[o],(!n.type||g.type===n.type)&&g.name===n.name?this.removeEventListener(g.type,g.listener,g.options):a[++c]=g;++c?a.length=c:delete this.__on}}}function V0(n,a,o){return function(){var c=this.__on,d,g=R0(a);if(c){for(var _=0,s=c.length;_<s;++_)if((d=c[_]).type===n.type&&d.name===n.name){this.removeEventListener(d.type,d.listener,d.options),this.addEventListener(d.type,d.listener=g,d.options=o),d.value=a;return}}this.addEventListener(n.type,g,o),d={type:n.type,name:n.name,value:a,listener:g,options:o},c?c.push(d):this.__on=[d]}}function N0(n,a,o){var c=F0(n+""),d,g=c.length,_;if(arguments.length<2){var s=this.node().__on;if(s){for(var x=0,T=s.length,k;x<T;++x)for(d=0,k=s[x];d<g;++d)if((_=c[d]).type===k.type&&_.name===k.name)return k.value}return}for(s=a?V0:O0,d=0;d<g;++d)this.each(s(c[d],a,o));return this}function rm(n,a,o){var c=$p(n),d=c.CustomEvent;typeof d=="function"?d=new d(a,o):(d=c.document.createEvent("Event"),o?(d.initEvent(a,o.bubbles,o.cancelable),d.detail=o.detail):d.initEvent(a,!1,!1)),n.dispatchEvent(d)}function U0(n,a){return function(){return rm(this,n,a)}}function q0(n,a){return function(){return rm(this,n,a.apply(this,arguments))}}function G0(n,a){return this.each((typeof a=="function"?q0:U0)(n,a))}function*j0(){for(var n=this._groups,a=0,o=n.length;a<o;++a)for(var c=n[a],d=0,g=c.length,_;d<g;++d)(_=c[d])&&(yield _)}var Z0=[null];function xr(n,a){this._groups=n,this._parents=a}function X0(){return this}xr.prototype={constructor:xr,select:py,selectAll:vy,selectChild:ky,selectChildren:Sy,filter:Cy,data:By,enter:My,exit:Fy,join:Oy,merge:Vy,selection:X0,order:Ny,sort:Uy,call:Gy,nodes:jy,node:Zy,size:Xy,empty:Wy,each:Hy,attr:t0,style:a0,property:u0,classed:p0,text:y0,html:w0,raise:k0,lower:E0,append:A0,insert:C0,remove:z0,clone:L0,datum:B0,on:N0,dispatch:G0,[Symbol.iterator]:j0};function am(n){return typeof n=="string"?new xr([[document.querySelector(n)]],[document.documentElement]):new xr([[n]],Z0)}function $d(n,a,o){const c=n.slice();return c[17]=a[o],c[19]=o,c}function ef(n,a,o){const c=n.slice();return c[17]=a[o],c[19]=o,c}function tf(n){let a,o,c,d;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(g){a=ut(g,"g",{transform:!0});var _=ve(a);o=ut(_,"circle",{r:!0,stroke:!0,fill:!0,opacity:!0}),ve(o).forEach(q),_.forEach(q),this.h()},h(){E(o,"r",c=Dn.background[n[1]===0?"split":"full"]+1),E(o,"stroke","none"),E(o,"fill","white"),E(o,"opacity","1"),E(a,"transform",d="translate("+n[17].x+","+n[2](n[17].y)+")")},m(g,_){Ze(g,a,_),be(a,o)},p(g,_){_&2&&c!==(c=Dn.background[g[1]===0?"split":"full"]+1)&&E(o,"r",c),_&12&&d!==(d="translate("+g[17].x+","+g[2](g[17].y)+")")&&E(a,"transform",d)},d(g){g&&q(a)}}}function nf(n){let a,o,c,d,g,_,s;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(x){a=ut(x,"g",{transform:!0});var T=ve(a);o=ut(T,"circle",{hoverid:!0,r:!0,stroke:!0,fill:!0,opacity:!0}),ve(o).forEach(q),T.forEach(q),this.h()},h(){E(o,"hoverid",c=n[17].datum.areacd),E(o,"r",d=Dn.background[n[1]===0?"split":"full"]),E(o,"stroke","none"),E(o,"fill","#cccccc"),E(o,"opacity","0.5"),E(a,"transform",g="translate("+n[17].x+","+n[2](n[17].y)+")")},m(x,T){Ze(x,a,T),be(a,o),_||(s=[br(o,"mouseover",n[4]),br(o,"mouseleave",n[5]),br(o,"focus",n[4])],_=!0)},p(x,T){T&8&&c!==(c=x[17].datum.areacd)&&E(o,"hoverid",c),T&2&&d!==(d=Dn.background[x[1]===0?"split":"full"])&&E(o,"r",d),T&12&&g!==(g="translate("+x[17].x+","+x[2](x[17].y)+")")&&E(a,"transform",g)},d(x){x&&q(a),_=!1,rh(s)}}}function W0(n){let a,o,c,d,g,_,s,x=n[3],T=[];for(let S=0;S<x.length;S+=1)T[S]=tf(ef(n,x,S));let k=n[3],A=[];for(let S=0;S<k.length;S+=1)A[S]=nf($d(n,k,S));return _=new cy({props:{backgroundCirclesStep2:n[3].filter(n[16]),y:n[2]}}),{c(){a=ct("g");for(let S=0;S<T.length;S+=1)T[S].c();o=Ut(),c=ct("g");for(let S=0;S<A.length;S+=1)A[S].c();g=Ut(),Yt(_.$$.fragment),this.h()},l(S){a=ut(S,"g",{class:!0});var V=ve(a);for(let Z=0;Z<T.length;Z+=1)T[Z].l(V);V.forEach(q),o=qt(S),c=ut(S,"g",{class:!0,opacity:!0});var W=ve(c);for(let Z=0;Z<A.length;Z+=1)A[Z].l(W);W.forEach(q),g=qt(S),Jt(_.$$.fragment,S),this.h()},h(){E(a,"class","backgroundCirclesGroup"),E(c,"class","backgroundCirclesGroup"),E(c,"opacity",d=n[0]===null?1:.3)},m(S,V){Ze(S,a,V);for(let W=0;W<T.length;W+=1)T[W]&&T[W].m(a,null);Ze(S,o,V),Ze(S,c,V);for(let W=0;W<A.length;W+=1)A[W]&&A[W].m(c,null);Ze(S,g,V),Qt(_,S,V),s=!0},p(S,[V]){if(V&14){x=S[3];let Z;for(Z=0;Z<x.length;Z+=1){const Y=ef(S,x,Z);T[Z]?T[Z].p(Y,V):(T[Z]=tf(Y),T[Z].c(),T[Z].m(a,null))}for(;Z<T.length;Z+=1)T[Z].d(1);T.length=x.length}if(V&62){k=S[3];let Z;for(Z=0;Z<k.length;Z+=1){const Y=$d(S,k,Z);A[Z]?A[Z].p(Y,V):(A[Z]=nf(Y),A[Z].c(),A[Z].m(c,null))}for(;Z<A.length;Z+=1)A[Z].d(1);A.length=k.length}(!s||V&1&&d!==(d=S[0]===null?1:.3))&&E(c,"opacity",d);const W={};V&9&&(W.backgroundCirclesStep2=S[3].filter(S[16])),V&4&&(W.y=S[2]),_.$set(W)},i(S){s||(Ye(_.$$.fragment,S),s=!0)},o(S){ht(_.$$.fragment,S),s=!1},d(S){S&&q(a),Qi(T,S),S&&q(o),S&&q(c),Qi(A,S),S&&q(g),$t(_,S)}}}function H0(n,a,o){let c,d,{chosenId3:g}=a,{visibleAreas:_,backgroundLatestData:s}=a,{x,y:T,yDomainGlobal:k}=a,{scaleWidth:A}=a,{medianValue:S,medianAbsoluteDeviation:V}=a,{chartIndex:W,hoverIndex:Z,hoverChartIndex:Y}=a;function H(ne){let ge=am(this).attr("hoverid");!_.map(se=>se.areacd).includes(Z)&g!=0&&(o(0,Z=ge),o(7,Y=W))}function Q(ne){o(0,Z=null),o(7,Y=null)}const ae=(ne,ge)=>ne.datum.areacd===Z;return n.$$set=ne=>{"chosenId3"in ne&&o(1,g=ne.chosenId3),"visibleAreas"in ne&&o(8,_=ne.visibleAreas),"backgroundLatestData"in ne&&o(9,s=ne.backgroundLatestData),"x"in ne&&o(10,x=ne.x),"y"in ne&&o(2,T=ne.y),"yDomainGlobal"in ne&&o(6,k=ne.yDomainGlobal),"scaleWidth"in ne&&o(11,A=ne.scaleWidth),"medianValue"in ne&&o(12,S=ne.medianValue),"medianAbsoluteDeviation"in ne&&o(13,V=ne.medianAbsoluteDeviation),"chartIndex"in ne&&o(14,W=ne.chartIndex),"hoverIndex"in ne&&o(0,Z=ne.hoverIndex),"hoverChartIndex"in ne&&o(7,Y=ne.hoverChartIndex)},n.$$.update=()=>{n.$$.dirty&12800&&o(15,c=s.map(ne=>({...ne,zScore:(ne.value-S)/V}))),n.$$.dirty&35842&&o(3,d=new Wp(c,Dn.background[g===0?"split":"full"],ne=>x(ne.zScore)>A?A+Gt.areaSpaceBeyondXScale[g===0?"split":"full"]/2:x(ne.zScore)<0?-Gt.areaSpaceBeyondXScale[g===0?"split":"full"]/2:x(ne.zScore)).calculateYPositions()),n.$$.dirty&72&&o(6,k[0]=d!=null?Math.min(...d.map(ne=>ne.y),k[0]):k[0],k),n.$$.dirty&72&&o(6,k[1]=d!=null?Math.max(...d.map(ne=>ne.y),k[1]):k[1],k)},[Z,g,T,d,H,Q,k,Y,_,s,x,A,S,V,W,c,ae]}class K0 extends vi{constructor(a){super(),bi(this,a,H0,W0,xi,{chosenId3:1,visibleAreas:8,backgroundLatestData:9,x:10,y:2,yDomainGlobal:6,scaleWidth:11,medianValue:12,medianAbsoluteDeviation:13,chartIndex:14,hoverIndex:0,hoverChartIndex:7})}}function rf(n,a,o){const c=n.slice();return c[9]=a[o],c[10]=a,c[11]=o,c}function af(n){let a,o=n[3],c=[];for(let d=0;d<o.length;d+=1)c[d]=sf(rf(n,o,d));return{c(){for(let d=0;d<c.length;d+=1)c[d].c();a=Bi()},l(d){for(let g=0;g<c.length;g+=1)c[g].l(d);a=Bi()},m(d,g){for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(d,g);Ze(d,a,g)},p(d,g){if(g&61){o=d[3];let _;for(_=0;_<o.length;_+=1){const s=rf(d,o,_);c[_]?c[_].p(s,g):(c[_]=sf(s),c[_].c(),c[_].m(a.parentNode,a))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(d){Qi(c,d),d&&q(a)}}}function sf(n){let a,o,c,d,g,_,s=n[2].prefix+Fr(dr(n[9].datum.value,n[2].decimalPlaces))+n[2].suffix+"",x,T,k,A,S,V,W;function Z(){n[8].call(_,n[11])}return{c(){a=ct("g"),o=ct("rect"),_=ct("text"),x=si(s),this.h()},l(Y){a=ut(Y,"g",{class:!0,transform:!0});var H=ve(a);o=ut(H,"rect",{labelid:!0,transform:!0,x:!0,y:!0,width:!0,height:!0,rx:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(o).forEach(q),_=ut(H,"text",{labelid:!0,transform:!0,x:!0,y:!0,"text-anchor":!0,"stroke-width":!0,stroke:!0,fill:!0,"font-size":!0});var Q=ve(_);x=oi(Q,s),Q.forEach(q),H.forEach(q),this.h()},h(){E(o,"labelid",n[11]),E(o,"transform","translate(0,0)"),E(o,"x","0"),E(o,"y","0"),E(o,"width",c=n[5].length>n[11]?n[5][n[11]].width+6:0),E(o,"height",d=n[9].datum.role!="main"?21:24),E(o,"rx","3px"),E(o,"stroke",g=Xt[n[9].datum.role]),E(o,"fill","white"),E(o,"stroke-width","1.5px"),E(_,"labelid",n[11]),E(_,"transform","translate(0,0)"),E(_,"x","3"),E(_,"y",T=n[9].datum.role!="main"?16:18),E(_,"text-anchor","start"),E(_,"stroke-width","0.25px"),E(_,"stroke",k=Xt[n[9].datum.role]),E(_,"fill",A=Xt[n[9].datum.role]),E(_,"font-size",S=n[9].datum.role!="main"?"16px":"18px"),E(a,"class","value-label-group"),E(a,"transform",W="translate("+Math.min(n[0]+Gt.right.split+Gt.areaSpaceBeyondXScale.split-(n[5][n[11]]==null?0:n[5][n[11]].width+6),Math.max(-Gt.left.split-Gt.areaSpaceBeyondXScale.split,n[9].x-(n[5][n[11]]==null?0:n[3][n[11]].x<n[3][n[11]===0?n[3].length-1:0].x?n[5][n[11]].width+6:0)))+","+(n[4](0)+12)+")")},m(Y,H){Ze(Y,a,H),be(a,o),be(a,_),be(_,x),V=ah.observe(_,Z.bind(_))},p(Y,H){n=Y,H&32&&c!==(c=n[5].length>n[11]?n[5][n[11]].width+6:0)&&E(o,"width",c),H&8&&d!==(d=n[9].datum.role!="main"?21:24)&&E(o,"height",d),H&8&&g!==(g=Xt[n[9].datum.role])&&E(o,"stroke",g),H&12&&s!==(s=n[2].prefix+Fr(dr(n[9].datum.value,n[2].decimalPlaces))+n[2].suffix+"")&&Ci(x,s),H&8&&T!==(T=n[9].datum.role!="main"?16:18)&&E(_,"y",T),H&8&&k!==(k=Xt[n[9].datum.role])&&E(_,"stroke",k),H&8&&A!==(A=Xt[n[9].datum.role])&&E(_,"fill",A),H&8&&S!==(S=n[9].datum.role!="main"?"16px":"18px")&&E(_,"font-size",S),H&57&&W!==(W="translate("+Math.min(n[0]+Gt.right.split+Gt.areaSpaceBeyondXScale.split-(n[5][n[11]]==null?0:n[5][n[11]].width+6),Math.max(-Gt.left.split-Gt.areaSpaceBeyondXScale.split,n[9].x-(n[5][n[11]]==null?0:n[3][n[11]].x<n[3][n[11]===0?n[3].length-1:0].x?n[5][n[11]].width+6:0)))+","+(n[4](0)+12)+")")&&E(a,"transform",W)},d(Y){Y&&q(a),V()}}}function Y0(n){let a,o=n[1]===0&&af(n);return{c(){a=ct("g"),o&&o.c(),this.h()},l(c){a=ut(c,"g",{class:!0});var d=ve(a);o&&o.l(d),d.forEach(q),this.h()},h(){E(a,"class","labels-group")},m(c,d){Ze(c,a,d),o&&o.m(a,null)},p(c,[d]){c[1]===0?o?o.p(c,d):(o=af(c),o.c(),o.m(a,null)):o&&(o.d(1),o=null)},i:Ei,o:Ei,d(c){c&&q(a),o&&o.d()}}}function J0(n,a,o){let c,{scaleWidth:d}=a,{chosenId3:g}=a,{metadata:_}=a,{primaryCirclesStep2:s}=a,{y:x}=a,{hoverIndex:T,hoverChartIndex:k}=a;function A(S){var V;c[S]=(V=sh.entries.get(this))==null?void 0:V.contentRect,o(5,c)}return n.$$set=S=>{"scaleWidth"in S&&o(0,d=S.scaleWidth),"chosenId3"in S&&o(1,g=S.chosenId3),"metadata"in S&&o(2,_=S.metadata),"primaryCirclesStep2"in S&&o(3,s=S.primaryCirclesStep2),"y"in S&&o(4,x=S.y),"hoverIndex"in S&&o(6,T=S.hoverIndex),"hoverChartIndex"in S&&o(7,k=S.hoverChartIndex)},o(5,c=[]),[d,g,_,s,x,c,T,k,A]}class Q0 extends vi{constructor(a){super(),bi(this,a,J0,Y0,xi,{scaleWidth:0,chosenId3:1,metadata:2,primaryCirclesStep2:3,y:4,hoverIndex:6,hoverChartIndex:7})}}function of(n,a,o){const c=n.slice();return c[22]=a[o],c[24]=o,c}function lf(n){let a,o,c,d,g,_,s;return{c(){a=ct("line"),d=ct("line"),this.h()},l(x){a=ut(x,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(a).forEach(q),d=ut(x,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,fill:!0,opacity:!0,"stroke-width":!0}),ve(d).forEach(q),this.h()},h(){E(a,"x1",o=Math.max(-n[22].x+Gt.areaSpaceBeyondXScale[n[1]===0?"split":"full"]/2,-25)),E(a,"x2",c=Math.min(n[3]-n[22].x+Gt.areaSpaceBeyondXScale[n[1]===0?"split":"full"]/2,25)),E(a,"y1","0"),E(a,"y2","0"),E(a,"stroke","white"),E(a,"fill","none"),E(a,"stroke-width","4px"),E(d,"x1",g=Math.max(-n[22].x+Gt.areaSpaceBeyondXScale[n[1]===0?"split":"full"]/2,-25)),E(d,"x2",_=Math.min(n[3]-n[22].x+Gt.areaSpaceBeyondXScale[n[1]===0?"split":"full"]/2,25)),E(d,"y1","0"),E(d,"y2","0"),E(d,"stroke",s=Xt[n[22].datum.role]),E(d,"fill","none"),E(d,"opacity","0.5"),E(d,"stroke-width","4px")},m(x,T){Ze(x,a,T),Ze(x,d,T)},p(x,T){T&66&&o!==(o=Math.max(-x[22].x+Gt.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,-25))&&E(a,"x1",o),T&74&&c!==(c=Math.min(x[3]-x[22].x+Gt.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,25))&&E(a,"x2",c),T&66&&g!==(g=Math.max(-x[22].x+Gt.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,-25))&&E(d,"x1",g),T&74&&_!==(_=Math.min(x[3]-x[22].x+Gt.areaSpaceBeyondXScale[x[1]===0?"split":"full"]/2,25))&&E(d,"x2",_),T&64&&s!==(s=Xt[x[22].datum.role])&&E(d,"stroke",s)},d(x){x&&q(a),x&&q(d)}}}function $0(n){let a,o,c;return{c(){a=ct("circle"),this.h()},l(d){a=ut(d,"circle",{"pointer-events":!0,r:!0,stroke:!0,"stroke-width":!0,fill:!0,opacity:!0}),ve(a).forEach(q),this.h()},h(){E(a,"pointer-events","none"),E(a,"r",o=Dn.primary[n[1]===0?"split":"full"]),E(a,"stroke","white"),E(a,"stroke-width","1px"),E(a,"fill",c=Xt[n[22].datum.role]),E(a,"opacity","1")},m(d,g){Ze(d,a,g)},p(d,g){g&2&&o!==(o=Dn.primary[d[1]===0?"split":"full"])&&E(a,"r",o),g&64&&c!==(c=Xt[d[22].datum.role])&&E(a,"fill",c)},d(d){d&&q(a)}}}function e1(n){let a,o,c,d,g,_,s;return{c(){a=ct("rect"),this.h()},l(x){a=ut(x,"rect",{"pointer-events":!0,transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0});var T=ve(a);T.forEach(q),this.h()},h(){E(a,"pointer-events","none"),E(a,"transform",o=["country","uk"].includes(n[22].datum.role)?"rotate(45)":null),E(a,"x",c=-Dn.primary[n[1]===0?"split":"full"]+.5),E(a,"y",d=-Dn.primary[n[1]===0?"split":"full"]+.5),E(a,"width",g=Dn.primary[n[1]===0?"split":"full"]*2-1),E(a,"height",_=Dn.primary[n[1]===0?"split":"full"]*2-1),E(a,"fill",s=Xt[n[22].datum.role]),E(a,"stroke","white"),E(a,"stroke-width","1px"),E(a,"opacity","1")},m(x,T){Ze(x,a,T)},p(x,T){T&64&&o!==(o=["country","uk"].includes(x[22].datum.role)?"rotate(45)":null)&&E(a,"transform",o),T&2&&c!==(c=-Dn.primary[x[1]===0?"split":"full"]+.5)&&E(a,"x",c),T&2&&d!==(d=-Dn.primary[x[1]===0?"split":"full"]+.5)&&E(a,"y",d),T&2&&g!==(g=Dn.primary[x[1]===0?"split":"full"]*2-1)&&E(a,"width",g),T&2&&_!==(_=Dn.primary[x[1]===0?"split":"full"]*2-1)&&E(a,"height",_),T&64&&s!==(s=Xt[x[22].datum.role])&&E(a,"fill",s)},d(x){x&&q(a)}}}function cf(n){let a,o=n[0].includes(0),c,d,g,_,s=o&&lf(n);function x(A,S){return S&64&&(d=null),d==null&&(d=!!["parent","country","uk"].includes(A[22].datum.role)),d?e1:$0}let T=x(n,-1),k=T(n);return{c(){a=ct("g"),s&&s.c(),c=ct("g"),k.c(),this.h()},l(A){a=ut(A,"g",{transform:!0});var S=ve(a);s&&s.l(S),c=ut(S,"g",{transform:!0});var V=ve(c);k.l(V),V.forEach(q),S.forEach(q),this.h()},h(){E(c,"transform",g="scale("+(n[1]===0&n[24]===0&n[7].length===2?.75:1)+")"),E(a,"transform",_="translate("+n[22].x+","+(n[0].includes(0)?-7.5+15*n[24]:n[22].y+n[8])+")")},m(A,S){Ze(A,a,S),s&&s.m(a,null),be(a,c),k.m(c,null)},p(A,S){S&1&&(o=A[0].includes(0)),o?s?s.p(A,S):(s=lf(A),s.c(),s.m(a,c)):s&&(s.d(1),s=null),T===(T=x(A,S))&&k?k.p(A,S):(k.d(1),k=T(A),k&&(k.c(),k.m(c,null))),S&130&&g!==(g="scale("+(A[1]===0&A[24]===0&A[7].length===2?.75:1)+")")&&E(c,"transform",g),S&321&&_!==(_="translate("+A[22].x+","+(A[0].includes(0)?-7.5+15*A[24]:A[22].y+A[8])+")")&&E(a,"transform",_)},d(A){A&&q(a),s&&s.d(),k.d()}}}function uf(n){let a,o;return a=new Q0({props:{scaleWidth:n[3],chosenId3:n[1],metadata:n[2],primaryCirclesStep2:n[6],y:n[4],hoverIndex:n[5]}}),{c(){Yt(a.$$.fragment)},l(c){Jt(a.$$.fragment,c)},m(c,d){Qt(a,c,d),o=!0},p(c,d){const g={};d&8&&(g.scaleWidth=c[3]),d&2&&(g.chosenId3=c[1]),d&4&&(g.metadata=c[2]),d&64&&(g.primaryCirclesStep2=c[6]),d&16&&(g.y=c[4]),d&32&&(g.hoverIndex=c[5]),a.$set(g)},i(c){o||(Ye(a.$$.fragment,c),o=!0)},o(c){ht(a.$$.fragment,c),o=!1},d(c){$t(a,c)}}}function t1(n){let a,o,c,d,g=!n[0].includes(0),_,s,x=n[6],T=[];for(let A=0;A<x.length;A+=1)T[A]=cf(of(n,x,A));let k=g&&uf(n);return{c(){a=ct("g");for(let A=0;A<T.length;A+=1)T[A].c();d=Ut(),k&&k.c(),_=Bi(),this.h()},l(A){a=ut(A,"g",{class:!0,transform:!0,opacity:!0});var S=ve(a);for(let V=0;V<T.length;V+=1)T[V].l(S);S.forEach(q),d=qt(A),k&&k.l(A),_=Bi(),this.h()},h(){E(a,"class","primaryCirclesGroup"),E(a,"transform",o="translate(0,"+n[4](0)+")"),E(a,"opacity",c=n[5]===null?1:.2)},m(A,S){Ze(A,a,S);for(let V=0;V<T.length;V+=1)T[V]&&T[V].m(a,null);Ze(A,d,S),k&&k.m(A,S),Ze(A,_,S),s=!0},p(A,[S]){if(S&459){x=A[6];let V;for(V=0;V<x.length;V+=1){const W=of(A,x,V);T[V]?T[V].p(W,S):(T[V]=cf(W),T[V].c(),T[V].m(a,null))}for(;V<T.length;V+=1)T[V].d(1);T.length=x.length}(!s||S&16&&o!==(o="translate(0,"+A[4](0)+")"))&&E(a,"transform",o),(!s||S&32&&c!==(c=A[5]===null?1:.2))&&E(a,"opacity",c),S&1&&(g=!A[0].includes(0)),g?k?(k.p(A,S),S&1&&Ye(k,1)):(k=uf(A),k.c(),Ye(k,1),k.m(_.parentNode,_)):k&&(Yi(),ht(k,1,1,()=>{k=null}),Ji())},i(A){s||(Ye(k),s=!0)},o(A){ht(k),s=!1},d(A){A&&q(a),Qi(T,A),A&&q(d),k&&k.d(A),A&&q(_)}}}function i1(n,a,o){let c,d,g,_,s,{mainLatestValue:x}=a,{comparisonLatestValue:T}=a,{baselineComparisonArea:k}=a,{baselineComparisonName:A}=a,{chosenId6:S}=a,{chosenId3:V}=a,{visibleAreas:W,data:Z}=a,{metadata:Y}=a,{scaleWidth:H}=a,{y:Q,x:ae}=a,{medianValue:ne,medianAbsoluteDeviation:ge}=a,{hoverIndex:se}=a,je=mi("selectedArea"),ce=mi("selectedAndRelatedAreas");return n.$$set=ee=>{"mainLatestValue"in ee&&o(9,x=ee.mainLatestValue),"comparisonLatestValue"in ee&&o(10,T=ee.comparisonLatestValue),"baselineComparisonArea"in ee&&o(11,k=ee.baselineComparisonArea),"baselineComparisonName"in ee&&o(12,A=ee.baselineComparisonName),"chosenId6"in ee&&o(0,S=ee.chosenId6),"chosenId3"in ee&&o(1,V=ee.chosenId3),"visibleAreas"in ee&&o(13,W=ee.visibleAreas),"data"in ee&&o(14,Z=ee.data),"metadata"in ee&&o(2,Y=ee.metadata),"scaleWidth"in ee&&o(3,H=ee.scaleWidth),"y"in ee&&o(4,Q=ee.y),"x"in ee&&o(15,ae=ee.x),"medianValue"in ee&&o(16,ne=ee.medianValue),"medianAbsoluteDeviation"in ee&&o(17,ge=ee.medianAbsoluteDeviation),"hoverIndex"in ee&&o(5,se=ee.hoverIndex)},n.$$.update=()=>{n.$$.dirty&7680&&o(7,c=[{areacd:k.areacd,areanm:A,value:T},{areacd:je.areacd,areanm:je.areanm,value:x}].filter(ee=>ee.value!=null)),n.$$.dirty&221314&&o(19,d=(V===0?c:Z.filter(ee=>W.map(ke=>ke.areacd).includes(ee.areacd))).map(ee=>({...ee,role:ee.areacd==="median"?"median":[...ce,...W].find(ke=>ee.areacd===ke.areacd).role,zScore:(ee.value-ne)/ge}))),n.$$.dirty&557066&&o(6,g=new Wp(d,V===0?Dn.primary.split*.6:Dn.primary.full+1.5,ee=>ae(ee.zScore)>H?H+Gt.areaSpaceBeyondXScale[V===0?"split":"full"]/2:ae(ee.zScore)<0?-Gt.areaSpaceBeyondXScale[V===0?"split":"full"]/2:ae(ee.zScore)).calculateYPositions()),n.$$.dirty&64&&o(18,_=[Math.min(...g.map(ee=>ee.y)),Math.max(...g.map(ee=>ee.y))]),n.$$.dirty&262144&&o(8,s=-(_[0]+_[1])/2)},[S,V,Y,H,Q,se,g,c,s,x,T,k,A,W,Z,ae,ne,ge,_,d]}class n1 extends vi{constructor(a){super(),bi(this,a,i1,t1,xi,{mainLatestValue:9,comparisonLatestValue:10,baselineComparisonArea:11,baselineComparisonName:12,chosenId6:0,chosenId3:1,visibleAreas:13,data:14,metadata:2,scaleWidth:3,y:4,x:15,medianValue:16,medianAbsoluteDeviation:17,hoverIndex:5})}}function hf(n){let a,o;return{c(){a=rt("p"),o=si(n[18]),this.h()},l(c){a=at(c,"P",{class:!0});var d=ve(a);o=oi(d,n[18]),d.forEach(q),this.h()},h(){E(a,"class","from-comparison-description svelte-hff5ty")},m(c,d){Ze(c,a,d),be(a,o)},p(c,d){d[0]&262144&&Ci(o,c[18])},d(c){c&&q(a)}}}function df(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W;function Z(ae){n[36](ae)}function Y(ae){n[37](ae)}function H(ae){n[38](ae)}let Q={chosenId3:n[8],visibleAreas:n[9],backgroundLatestData:n[3].latestDataSameGeogLevel,scaleWidth:n[11],x:n[12],y:n[13],medianValue:n[20],medianAbsoluteDeviation:n[21],chartIndex:n[5]*100+n[4]};return n[0]!==void 0&&(Q.yDomainGlobal=n[0]),n[1]!==void 0&&(Q.hoverIndex=n[1]),n[2]!==void 0&&(Q.hoverChartIndex=n[2]),d=new K0({props:Q}),Mt.push(()=>Pt(d,"yDomainGlobal",Z)),Mt.push(()=>Pt(d,"hoverIndex",Y)),Mt.push(()=>Pt(d,"hoverChartIndex",H)),T=new n1({props:{mainLatestValue:n[22],comparisonLatestValue:n[17],baselineComparisonArea:n[10],baselineComparisonName:n[16],metadata:n[6],chosenId3:n[8],visibleAreas:n[9],data:n[3].latestData,scaleWidth:n[11],y:n[13],x:n[12],medianValue:n[20],medianAbsoluteDeviation:n[21],hoverIndex:n[1],chosenId6:n[15]}}),{c(){a=ct("svg"),o=ct("g"),c=ct("g"),Yt(d.$$.fragment),Yt(T.$$.fragment),this.h()},l(ae){a=ut(ae,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var ne=ve(a);o=ut(ne,"g",{class:!0,transform:!0});var ge=ve(o);c=ut(ge,"g",{opacity:!0});var se=ve(c);Jt(d.$$.fragment,se),se.forEach(q),Jt(T.$$.fragment,ge),ge.forEach(q),ne.forEach(q),this.h()},h(){E(c,"opacity",x=n[15].includes(0)?0:1),E(o,"class","chart-container"),E(o,"transform",k="translate("+(Gt.left[n[8]===0?"split":"full"]+Gt.areaSpaceBeyondXScale[n[8]===0?"split":"full"])+","+Gt.top[n[8]===0?"split":"full"]+")"),E(a,"class",A="beeswarm-row-svg beeswarm-row-svg-"+(n[5]*100+n[4])+" svelte-hff5ty"),E(a,"viewBox",S="0 0 "+n[7]+" "+ma[n[8]===0?"split":"full"]),E(a,"width","100%"),E(a,"height",V=ma[n[8]===0?"split":"full"])},m(ae,ne){Ze(ae,a,ne),be(a,o),be(o,c),Qt(d,c,null),Qt(T,o,null),W=!0},p(ae,ne){const ge={};ne[0]&256&&(ge.chosenId3=ae[8]),ne[0]&512&&(ge.visibleAreas=ae[9]),ne[0]&8&&(ge.backgroundLatestData=ae[3].latestDataSameGeogLevel),ne[0]&2048&&(ge.scaleWidth=ae[11]),ne[0]&4096&&(ge.x=ae[12]),ne[0]&8192&&(ge.y=ae[13]),ne[0]&48&&(ge.chartIndex=ae[5]*100+ae[4]),!g&&ne[0]&1&&(g=!0,ge.yDomainGlobal=ae[0],Lt(()=>g=!1)),!_&&ne[0]&2&&(_=!0,ge.hoverIndex=ae[1],Lt(()=>_=!1)),!s&&ne[0]&4&&(s=!0,ge.hoverChartIndex=ae[2],Lt(()=>s=!1)),d.$set(ge),(!W||ne[0]&32768&&x!==(x=ae[15].includes(0)?0:1))&&E(c,"opacity",x);const se={};ne[0]&131072&&(se.comparisonLatestValue=ae[17]),ne[0]&1024&&(se.baselineComparisonArea=ae[10]),ne[0]&65536&&(se.baselineComparisonName=ae[16]),ne[0]&64&&(se.metadata=ae[6]),ne[0]&256&&(se.chosenId3=ae[8]),ne[0]&512&&(se.visibleAreas=ae[9]),ne[0]&8&&(se.data=ae[3].latestData),ne[0]&2048&&(se.scaleWidth=ae[11]),ne[0]&8192&&(se.y=ae[13]),ne[0]&4096&&(se.x=ae[12]),ne[0]&2&&(se.hoverIndex=ae[1]),ne[0]&32768&&(se.chosenId6=ae[15]),T.$set(se),(!W||ne[0]&256&&k!==(k="translate("+(Gt.left[ae[8]===0?"split":"full"]+Gt.areaSpaceBeyondXScale[ae[8]===0?"split":"full"])+","+Gt.top[ae[8]===0?"split":"full"]+")"))&&E(o,"transform",k),(!W||ne[0]&48&&A!==(A="beeswarm-row-svg beeswarm-row-svg-"+(ae[5]*100+ae[4])+" svelte-hff5ty"))&&E(a,"class",A),(!W||ne[0]&384&&S!==(S="0 0 "+ae[7]+" "+ma[ae[8]===0?"split":"full"]))&&E(a,"viewBox",S),(!W||ne[0]&256&&V!==(V=ma[ae[8]===0?"split":"full"]))&&E(a,"height",V)},i(ae){W||(Ye(d.$$.fragment,ae),Ye(T.$$.fragment,ae),W=!0)},o(ae){ht(d.$$.fragment,ae),ht(T.$$.fragment,ae),W=!1},d(ae){ae&&q(a),$t(d),$t(T)}}}function r1(n){let a,o=n[14].includes(0)&n[8]===0,c,d,g,_=o&&hf(n),s=n[8]===0&&df(n);return{c(){a=rt("div"),_&&_.c(),c=Ut(),s&&s.c(),this.h()},l(x){a=at(x,"DIV",{class:!0,style:!0});var T=ve(a);_&&_.l(T),c=qt(T),s&&s.l(T),T.forEach(q),this.h()},h(){E(a,"class","area-comparison-cell-container svelte-hff5ty"),E(a,"style",d=n[8]!=0|n[19]==null?null:"background-color:"+n[19]+"; box-shadow: 0 0 4px 3px "+n[19]+";")},m(x,T){Ze(x,a,T),_&&_.m(a,null),be(a,c),s&&s.m(a,null),g=!0},p(x,T){T[0]&16640&&(o=x[14].includes(0)&x[8]===0),o?_?_.p(x,T):(_=hf(x),_.c(),_.m(a,c)):_&&(_.d(1),_=null),x[8]===0?s?(s.p(x,T),T[0]&256&&Ye(s,1)):(s=df(x),s.c(),Ye(s,1),s.m(a,null)):s&&(Yi(),ht(s,1,1,()=>{s=null}),Ji()),(!g||T[0]&524544&&d!==(d=x[8]!=0|x[19]==null?null:"background-color:"+x[19]+"; box-shadow: 0 0 4px 3px "+x[19]+";"))&&E(a,"style",d)},i(x){g||(Ye(s),g=!0)},o(x){ht(s),g=!1},d(x){x&&q(a),_&&_.d(),s&&s.d()}}}function a1(n,a,o){let c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,{indicator:H}=a,{rowNumb:Q,topicNumb:ae}=a,{metadata:ne,calculations:ge}=a,{col2Width:se}=a,{chosenId3:je}=a,{visibleAreas:ce}=a,{baselineComparisonArea:ee}=a,{scaleHeight:ke,scaleWidth:_e}=a,{x:me,xDomain:Me,yDomainGlobal:Re,y:he}=a,{hoverIndex:Ee,hoverChartIndex:ft}=a,{chosenId11:nt}=a,{chosenId6:Fe}=a,Se=mi("selectedAndRelatedAreas"),de=mi("selectedArea"),Qe=ge.calcs[ge.maxXDomain].median,Je=ge.calcs[ge.maxXDomain].mad,yt=ge.calcs[ge.maxXDomain].main;function mt(ze){Re=ze,o(0,Re)}function Xe(ze){Ee=ze,o(1,Ee)}function gt(ze){ft=ze,o(2,ft)}return n.$$set=ze=>{"indicator"in ze&&o(3,H=ze.indicator),"rowNumb"in ze&&o(4,Q=ze.rowNumb),"topicNumb"in ze&&o(5,ae=ze.topicNumb),"metadata"in ze&&o(6,ne=ze.metadata),"calculations"in ze&&o(23,ge=ze.calculations),"col2Width"in ze&&o(7,se=ze.col2Width),"chosenId3"in ze&&o(8,je=ze.chosenId3),"visibleAreas"in ze&&o(9,ce=ze.visibleAreas),"baselineComparisonArea"in ze&&o(10,ee=ze.baselineComparisonArea),"scaleHeight"in ze&&o(24,ke=ze.scaleHeight),"scaleWidth"in ze&&o(11,_e=ze.scaleWidth),"x"in ze&&o(12,me=ze.x),"xDomain"in ze&&o(25,Me=ze.xDomain),"yDomainGlobal"in ze&&o(0,Re=ze.yDomainGlobal),"y"in ze&&o(13,he=ze.y),"hoverIndex"in ze&&o(1,Ee=ze.hoverIndex),"hoverChartIndex"in ze&&o(2,ft=ze.hoverChartIndex),"chosenId11"in ze&&o(14,nt=ze.chosenId11),"chosenId6"in ze&&o(15,Fe=ze.chosenId6)},n.$$.update=()=>{n.$$.dirty[0]&8389632&&o(17,c=ge.calcs[ge.maxXDomain][(ee.areacd==="median"?ee:Se.find(ze=>ee.areacd===ze.areacd)).role]),n.$$.dirty[0]&131072&&o(29,d=yt==null|c==null|Je==null?null:(yt-c)/Je),n.$$.dirty[0]&16384&&o(35,g=nt.includes(1)),n.$$.dirty[0]&64&&o(34,_=ne.polarity==0?null:ne.polarity==-1?"better":"worse"),n.$$.dirty[0]&64&&o(33,s=ne.polarity==0?null:"similar"),n.$$.dirty[0]&64&&o(32,x=ne.polarity==0?null:ne.polarity==1?"better":"worse"),n.$$.dirty[0]&16384&&o(28,T=nt.includes(3)?2:1),n.$$.dirty[0]&805306432|n.$$.dirty[1]&30&&o(19,k=!g|d==null|ne.polarity==0?null:d<-T?Pn[_]:d<=T?Pn[s]:Pn[x]),n.$$.dirty[0]&1024&&o(16,A=ee.areacd==="median"?"median":ee.areanm),n.$$.dirty[0]&16384&&o(31,S=nt.includes(2)),n.$$.dirty[0]&64|n.$$.dirty[1]&1&&o(30,V=ne.polarity==0|!S?"Lower than":ne.polarity==-1?"Better than":"Worse than"),n.$$.dirty[0]&64|n.$$.dirty[1]&1&&o(26,Z=ne.polarity==0|!S?"Higher than":ne.polarity==1?"Better than":"Worse than"),n.$$.dirty[0]&208896e4&&o(18,Y=(yt==null?"No "+de.areanm+" data":c==null?"No "+A+" data":(d<-T?V:d<=T?W:Z)+" "+A)+" in "+ge.maxXDomain)},o(27,W="Similar to"),[Re,Ee,ft,H,Q,ae,ne,se,je,ce,ee,_e,me,he,nt,Fe,A,c,Y,k,Qe,Je,yt,ge,ke,Me,Z,W,T,d,V,S,x,s,_,g,mt,Xe,gt]}class s1 extends vi{constructor(a){super(),bi(this,a,a1,r1,xi,{indicator:3,rowNumb:4,topicNumb:5,metadata:6,calculations:23,col2Width:7,chosenId3:8,visibleAreas:9,baselineComparisonArea:10,scaleHeight:24,scaleWidth:11,x:12,xDomain:25,yDomainGlobal:0,y:13,hoverIndex:1,hoverChartIndex:2,chosenId11:14,chosenId6:15},null,[-1,-1])}}function ff(n){let a,o,c,d,g,_,s,x,T;return{c(){a=ct("g"),o=ct("g"),c=ct("rect"),g=ct("text"),_=si(n[4]),this.h()},l(k){a=ut(k,"g",{class:!0,transform:!0});var A=ve(a);o=ut(A,"g",{transform:!0});var S=ve(o);c=ut(S,"rect",{labelid:!0,transform:!0,x:!0,y:!0,width:!0,height:!0,rx:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(c).forEach(q),g=ut(S,"text",{labelid:!0,transform:!0,x:!0,y:!0,"text-anchor":!0,"stroke-width":!0,stroke:!0,fill:!0,"font-size":!0});var V=ve(g);_=oi(V,n[4]),V.forEach(q),S.forEach(q),A.forEach(q),this.h()},h(){E(c,"labelid",0),E(c,"transform","translate(0,0)"),E(c,"x","0"),E(c,"y","0"),E(c,"width",d=n[5].length>0?n[5][0].width+6:0),E(c,"height",22),E(c,"rx","3px"),E(c,"stroke",Xt.main),E(c,"fill","white"),E(c,"stroke-width","1.5px"),E(g,"labelid",0),E(g,"transform","translate(0,0)"),E(g,"x",3),E(g,"y",16),E(g,"text-anchor","start"),E(g,"stroke-width","0.25px"),E(g,"stroke",Xt.main),E(g,"fill",Xt.main),E(g,"font-size","16px"),E(o,"transform",x="translate("+(n[0]>n[1]+Gt.right.split+Gt.areaSpaceBeyondXScale.split-(n[5].length>0?n[5][0].width/2:0)?0:n[5].length>0?n[5][0].width/2:0)+",0)"),E(a,"class","value-label-group"),E(a,"transform",T="translate("+Math.min(n[1]+Gt.right.split+Gt.areaSpaceBeyondXScale.split-(n[5][0]==null?0:n[5][0].width+6),Math.max(-Gt.left.split-Gt.areaSpaceBeyondXScale.split,n[0]-(n[5][0]==null?0:n[5][0].width+6)))+","+(n[3]+9)+")")},m(k,A){Ze(k,a,A),be(a,o),be(o,c),be(o,g),be(g,_),s=ah.observe(g,n[9].bind(g))},p(k,A){A&32&&d!==(d=k[5].length>0?k[5][0].width+6:0)&&E(c,"width",d),A&16&&Ci(_,k[4]),A&35&&x!==(x="translate("+(k[0]>k[1]+Gt.right.split+Gt.areaSpaceBeyondXScale.split-(k[5].length>0?k[5][0].width/2:0)?0:k[5].length>0?k[5][0].width/2:0)+",0)")&&E(o,"transform",x),A&43&&T!==(T="translate("+Math.min(k[1]+Gt.right.split+Gt.areaSpaceBeyondXScale.split-(k[5][0]==null?0:k[5][0].width+6),Math.max(-Gt.left.split-Gt.areaSpaceBeyondXScale.split,k[0]-(k[5][0]==null?0:k[5][0].width+6)))+","+(k[3]+9)+")")&&E(a,"transform",T)},d(k){k&&q(a),s()}}}function o1(n){let a,o=n[2]===0&&ff(n);return{c(){a=ct("g"),o&&o.c(),this.h()},l(c){a=ut(c,"g",{class:!0});var d=ve(a);o&&o.l(d),d.forEach(q),this.h()},h(){E(a,"class","labels-group")},m(c,d){Ze(c,a,d),o&&o.m(a,null)},p(c,[d]){c[2]===0?o?o.p(c,d):(o=ff(c),o.c(),o.m(a,null)):o&&(o.d(1),o=null)},i:Ei,o:Ei,d(c){c&&q(a),o&&o.d()}}}function l1(n,a,o){let c,d,{xPosition:g,metadata:_,mainLatestValue:s,mainPreviousValue:x,scaleWidth:T,chosenId3:k,scaleHeight:A}=a;function S(){var V;c[0]=(V=sh.entries.get(this))==null?void 0:V.contentRect,o(5,c)}return n.$$set=V=>{"xPosition"in V&&o(0,g=V.xPosition),"metadata"in V&&o(6,_=V.metadata),"mainLatestValue"in V&&o(7,s=V.mainLatestValue),"mainPreviousValue"in V&&o(8,x=V.mainPreviousValue),"scaleWidth"in V&&o(1,T=V.scaleWidth),"chosenId3"in V&&o(2,k=V.chosenId3),"scaleHeight"in V&&o(3,A=V.scaleHeight)},n.$$.update=()=>{n.$$.dirty&448&&o(4,d=["pp","abs"].includes(_.howToMeasureChange)?(s-x>0?"+":"")+(_.howToMeasureChange=="pp"?"":_.prefix)+Fr(dr(s-x,_.decimalPlaces))+(_.howToMeasureChange=="pp"?" pp":""):(s-x>0?"+":"")+dr((s-x)/x,1)+"%")},o(5,c=[]),[g,T,k,A,d,c,_,s,x,S]}class c1 extends vi{constructor(a){super(),bi(this,a,l1,o1,xi,{xPosition:0,metadata:6,mainLatestValue:7,mainPreviousValue:8,scaleWidth:1,chosenId3:2,scaleHeight:3})}}function Tc(n,a){return n==null||a==null?NaN:n<a?-1:n>a?1:n>=a?0:NaN}function u1(n,a){return n==null||a==null?NaN:a<n?-1:a>n?1:a>=n?0:NaN}function sm(n){let a,o,c;n.length!==2?(a=Tc,o=(s,x)=>Tc(n(s),x),c=(s,x)=>n(s)-x):(a=n===Tc||n===u1?n:h1,o=n,c=n);function d(s,x,T=0,k=s.length){if(T<k){if(a(x,x)!==0)return k;do{const A=T+k>>>1;o(s[A],x)<0?T=A+1:k=A}while(T<k)}return T}function g(s,x,T=0,k=s.length){if(T<k){if(a(x,x)!==0)return k;do{const A=T+k>>>1;o(s[A],x)<=0?T=A+1:k=A}while(T<k)}return T}function _(s,x,T=0,k=s.length){const A=d(s,x,T,k-1);return A>T&&c(s[A-1],x)>-c(s[A],x)?A-1:A}return{left:d,center:_,right:g}}function h1(){return 0}function d1(n){return n===null?NaN:+n}const f1=sm(Tc),p1=f1.right;sm(d1).center;const m1=p1,g1=Math.sqrt(50),_1=Math.sqrt(10),y1=Math.sqrt(2);function Cc(n,a,o){const c=(a-n)/Math.max(0,o),d=Math.floor(Math.log10(c)),g=c/Math.pow(10,d),_=g>=g1?10:g>=_1?5:g>=y1?2:1;let s,x,T;return d<0?(T=Math.pow(10,-d)/_,s=Math.round(n*T),x=Math.round(a*T),s/T<n&&++s,x/T>a&&--x,T=-T):(T=Math.pow(10,d)*_,s=Math.round(n/T),x=Math.round(a/T),s*T<n&&++s,x*T>a&&--x),x<s&&.5<=o&&o<2?Cc(n,a,o*2):[s,x,T]}function v1(n,a,o){if(a=+a,n=+n,o=+o,!(o>0))return[];if(n===a)return[n];const c=a<n,[d,g,_]=c?Cc(a,n,o):Cc(n,a,o);if(!(g>=d))return[];const s=g-d+1,x=new Array(s);if(c)if(_<0)for(let T=0;T<s;++T)x[T]=(g-T)/-_;else for(let T=0;T<s;++T)x[T]=(g-T)*_;else if(_<0)for(let T=0;T<s;++T)x[T]=(d+T)/-_;else for(let T=0;T<s;++T)x[T]=(d+T)*_;return x}function Yu(n,a,o){return a=+a,n=+n,o=+o,Cc(n,a,o)[2]}function b1(n,a,o){a=+a,n=+n,o=+o;const c=a<n,d=c?Yu(a,n,o):Yu(n,a,o);return(c?-1:1)*(d<0?1/-d:d)}function x1(n,a){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(a).domain(n);break}return this}function uh(n,a,o){n.prototype=a.prototype=o,o.constructor=n}function om(n,a){var o=Object.create(n.prototype);for(var c in a)o[c]=a[c];return o}function fl(){}var ll=.7,Mc=1/ll,eo="\\s*([+-]?\\d+)\\s*",cl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Kr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",w1=/^#([0-9a-f]{3,8})$/,I1=new RegExp(`^rgb\\(${eo},${eo},${eo}\\)$`),k1=new RegExp(`^rgb\\(${Kr},${Kr},${Kr}\\)$`),T1=new RegExp(`^rgba\\(${eo},${eo},${eo},${cl}\\)$`),E1=new RegExp(`^rgba\\(${Kr},${Kr},${Kr},${cl}\\)$`),A1=new RegExp(`^hsl\\(${cl},${Kr},${Kr}\\)$`),S1=new RegExp(`^hsla\\(${cl},${Kr},${Kr},${cl}\\)$`),pf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};uh(fl,ul,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:mf,formatHex:mf,formatHex8:C1,formatHsl:M1,formatRgb:gf,toString:gf});function mf(){return this.rgb().formatHex()}function C1(){return this.rgb().formatHex8()}function M1(){return lm(this).formatHsl()}function gf(){return this.rgb().formatRgb()}function ul(n){var a,o;return n=(n+"").trim().toLowerCase(),(a=w1.exec(n))?(o=a[1].length,a=parseInt(a[1],16),o===6?_f(a):o===3?new ir(a>>8&15|a>>4&240,a>>4&15|a&240,(a&15)<<4|a&15,1):o===8?Ic(a>>24&255,a>>16&255,a>>8&255,(a&255)/255):o===4?Ic(a>>12&15|a>>8&240,a>>8&15|a>>4&240,a>>4&15|a&240,((a&15)<<4|a&15)/255):null):(a=I1.exec(n))?new ir(a[1],a[2],a[3],1):(a=k1.exec(n))?new ir(a[1]*255/100,a[2]*255/100,a[3]*255/100,1):(a=T1.exec(n))?Ic(a[1],a[2],a[3],a[4]):(a=E1.exec(n))?Ic(a[1]*255/100,a[2]*255/100,a[3]*255/100,a[4]):(a=A1.exec(n))?bf(a[1],a[2]/100,a[3]/100,1):(a=S1.exec(n))?bf(a[1],a[2]/100,a[3]/100,a[4]):pf.hasOwnProperty(n)?_f(pf[n]):n==="transparent"?new ir(NaN,NaN,NaN,0):null}function _f(n){return new ir(n>>16&255,n>>8&255,n&255,1)}function Ic(n,a,o,c){return c<=0&&(n=a=o=NaN),new ir(n,a,o,c)}function z1(n){return n instanceof fl||(n=ul(n)),n?(n=n.rgb(),new ir(n.r,n.g,n.b,n.opacity)):new ir}function Ju(n,a,o,c){return arguments.length===1?z1(n):new ir(n,a,o,c??1)}function ir(n,a,o,c){this.r=+n,this.g=+a,this.b=+o,this.opacity=+c}uh(ir,Ju,om(fl,{brighter(n){return n=n==null?Mc:Math.pow(Mc,n),new ir(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?ll:Math.pow(ll,n),new ir(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new ir(_s(this.r),_s(this.g),_s(this.b),zc(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yf,formatHex:yf,formatHex8:D1,formatRgb:vf,toString:vf}));function yf(){return`#${gs(this.r)}${gs(this.g)}${gs(this.b)}`}function D1(){return`#${gs(this.r)}${gs(this.g)}${gs(this.b)}${gs((isNaN(this.opacity)?1:this.opacity)*255)}`}function vf(){const n=zc(this.opacity);return`${n===1?"rgb(":"rgba("}${_s(this.r)}, ${_s(this.g)}, ${_s(this.b)}${n===1?")":`, ${n})`}`}function zc(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function _s(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function gs(n){return n=_s(n),(n<16?"0":"")+n.toString(16)}function bf(n,a,o,c){return c<=0?n=a=o=NaN:o<=0||o>=1?n=a=NaN:a<=0&&(n=NaN),new Rr(n,a,o,c)}function lm(n){if(n instanceof Rr)return new Rr(n.h,n.s,n.l,n.opacity);if(n instanceof fl||(n=ul(n)),!n)return new Rr;if(n instanceof Rr)return n;n=n.rgb();var a=n.r/255,o=n.g/255,c=n.b/255,d=Math.min(a,o,c),g=Math.max(a,o,c),_=NaN,s=g-d,x=(g+d)/2;return s?(a===g?_=(o-c)/s+(o<c)*6:o===g?_=(c-a)/s+2:_=(a-o)/s+4,s/=x<.5?g+d:2-g-d,_*=60):s=x>0&&x<1?0:_,new Rr(_,s,x,n.opacity)}function P1(n,a,o,c){return arguments.length===1?lm(n):new Rr(n,a,o,c??1)}function Rr(n,a,o,c){this.h=+n,this.s=+a,this.l=+o,this.opacity=+c}uh(Rr,P1,om(fl,{brighter(n){return n=n==null?Mc:Math.pow(Mc,n),new Rr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?ll:Math.pow(ll,n),new Rr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,a=isNaN(n)||isNaN(this.s)?0:this.s,o=this.l,c=o+(o<.5?o:1-o)*a,d=2*o-c;return new ir(Zu(n>=240?n-240:n+120,d,c),Zu(n,d,c),Zu(n<120?n+240:n-120,d,c),this.opacity)},clamp(){return new Rr(xf(this.h),kc(this.s),kc(this.l),zc(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=zc(this.opacity);return`${n===1?"hsl(":"hsla("}${xf(this.h)}, ${kc(this.s)*100}%, ${kc(this.l)*100}%${n===1?")":`, ${n})`}`}}));function xf(n){return n=(n||0)%360,n<0?n+360:n}function kc(n){return Math.max(0,Math.min(1,n||0))}function Zu(n,a,o){return(n<60?a+(o-a)*n/60:n<180?o:n<240?a+(o-a)*(240-n)/60:a)*255}const hh=n=>()=>n;function L1(n,a){return function(o){return n+o*a}}function B1(n,a,o){return n=Math.pow(n,o),a=Math.pow(a,o)-n,o=1/o,function(c){return Math.pow(n+c*a,o)}}function R1(n){return(n=+n)==1?cm:function(a,o){return o-a?B1(a,o,n):hh(isNaN(a)?o:a)}}function cm(n,a){var o=a-n;return o?L1(n,o):hh(isNaN(n)?a:n)}const wf=function n(a){var o=R1(a);function c(d,g){var _=o((d=Ju(d)).r,(g=Ju(g)).r),s=o(d.g,g.g),x=o(d.b,g.b),T=cm(d.opacity,g.opacity);return function(k){return d.r=_(k),d.g=s(k),d.b=x(k),d.opacity=T(k),d+""}}return c.gamma=n,c}(1);function F1(n,a){a||(a=[]);var o=n?Math.min(a.length,n.length):0,c=a.slice(),d;return function(g){for(d=0;d<o;++d)c[d]=n[d]*(1-g)+a[d]*g;return c}}function O1(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function V1(n,a){var o=a?a.length:0,c=n?Math.min(o,n.length):0,d=new Array(c),g=new Array(o),_;for(_=0;_<c;++_)d[_]=dh(n[_],a[_]);for(;_<o;++_)g[_]=a[_];return function(s){for(_=0;_<c;++_)g[_]=d[_](s);return g}}function N1(n,a){var o=new Date;return n=+n,a=+a,function(c){return o.setTime(n*(1-c)+a*c),o}}function Dc(n,a){return n=+n,a=+a,function(o){return n*(1-o)+a*o}}function U1(n,a){var o={},c={},d;(n===null||typeof n!="object")&&(n={}),(a===null||typeof a!="object")&&(a={});for(d in a)d in n?o[d]=dh(n[d],a[d]):c[d]=a[d];return function(g){for(d in o)c[d]=o[d](g);return c}}var Qu=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Xu=new RegExp(Qu.source,"g");function q1(n){return function(){return n}}function G1(n){return function(a){return n(a)+""}}function j1(n,a){var o=Qu.lastIndex=Xu.lastIndex=0,c,d,g,_=-1,s=[],x=[];for(n=n+"",a=a+"";(c=Qu.exec(n))&&(d=Xu.exec(a));)(g=d.index)>o&&(g=a.slice(o,g),s[_]?s[_]+=g:s[++_]=g),(c=c[0])===(d=d[0])?s[_]?s[_]+=d:s[++_]=d:(s[++_]=null,x.push({i:_,x:Dc(c,d)})),o=Xu.lastIndex;return o<a.length&&(g=a.slice(o),s[_]?s[_]+=g:s[++_]=g),s.length<2?x[0]?G1(x[0].x):q1(a):(a=x.length,function(T){for(var k=0,A;k<a;++k)s[(A=x[k]).i]=A.x(T);return s.join("")})}function dh(n,a){var o=typeof a,c;return a==null||o==="boolean"?hh(a):(o==="number"?Dc:o==="string"?(c=ul(a))?(a=c,wf):j1:a instanceof ul?wf:a instanceof Date?N1:O1(a)?F1:Array.isArray(a)?V1:typeof a.valueOf!="function"&&typeof a.toString!="function"||isNaN(a)?U1:Dc)(n,a)}function Z1(n,a){return n=+n,a=+a,function(o){return Math.round(n*(1-o)+a*o)}}function X1(n){return function(){return n}}function W1(n){return+n}var If=[0,1];function Js(n){return n}function $u(n,a){return(a-=n=+n)?function(o){return(o-n)/a}:X1(isNaN(a)?NaN:.5)}function H1(n,a){var o;return n>a&&(o=n,n=a,a=o),function(c){return Math.max(n,Math.min(a,c))}}function K1(n,a,o){var c=n[0],d=n[1],g=a[0],_=a[1];return d<c?(c=$u(d,c),g=o(_,g)):(c=$u(c,d),g=o(g,_)),function(s){return g(c(s))}}function Y1(n,a,o){var c=Math.min(n.length,a.length)-1,d=new Array(c),g=new Array(c),_=-1;for(n[c]<n[0]&&(n=n.slice().reverse(),a=a.slice().reverse());++_<c;)d[_]=$u(n[_],n[_+1]),g[_]=o(a[_],a[_+1]);return function(s){var x=m1(n,s,1,c)-1;return g[x](d[x](s))}}function J1(n,a){return a.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Q1(){var n=If,a=If,o=dh,c,d,g,_=Js,s,x,T;function k(){var S=Math.min(n.length,a.length);return _!==Js&&(_=H1(n[0],n[S-1])),s=S>2?Y1:K1,x=T=null,A}function A(S){return S==null||isNaN(S=+S)?g:(x||(x=s(n.map(c),a,o)))(c(_(S)))}return A.invert=function(S){return _(d((T||(T=s(a,n.map(c),Dc)))(S)))},A.domain=function(S){return arguments.length?(n=Array.from(S,W1),k()):n.slice()},A.range=function(S){return arguments.length?(a=Array.from(S),k()):a.slice()},A.rangeRound=function(S){return a=Array.from(S),o=Z1,k()},A.clamp=function(S){return arguments.length?(_=S?!0:Js,k()):_!==Js},A.interpolate=function(S){return arguments.length?(o=S,k()):o},A.unknown=function(S){return arguments.length?(g=S,A):g},function(S,V){return c=S,d=V,k()}}function $1(){return Q1()(Js,Js)}function ev(n,a,o,c){var d=b1(n,a,o),g;switch(c=P_(c??",f"),c.type){case"s":{var _=Math.max(Math.abs(n),Math.abs(a));return c.precision==null&&!isNaN(g=Z_(d,_))&&(c.precision=g),Zp(c,_)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(g=X_(d,Math.max(Math.abs(n),Math.abs(a))))&&(c.precision=g-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(g=j_(d))&&(c.precision=g-(c.type==="%")*2);break}}return jp(c)}function tv(n){var a=n.domain;return n.ticks=function(o){var c=a();return v1(c[0],c[c.length-1],o??10)},n.tickFormat=function(o,c){var d=a();return ev(d[0],d[d.length-1],o??10,c)},n.nice=function(o){o==null&&(o=10);var c=a(),d=0,g=c.length-1,_=c[d],s=c[g],x,T,k=10;for(s<_&&(T=_,_=s,s=T,T=d,d=g,g=T);k-- >0;){if(T=Yu(_,s,o),T===x)return c[d]=_,c[g]=s,a(c);if(T>0)_=Math.floor(_/T)*T,s=Math.ceil(s/T)*T;else if(T<0)_=Math.ceil(_*T)/T,s=Math.floor(s*T)/T;else break;x=T}return n},n}function Oa(){var n=$1();return n.copy=function(){return J1(n,Oa())},x1.apply(n,arguments),tv(n)}function Ks(n){return function(){return n}}const eh=Math.PI,th=2*eh,ms=1e-6,iv=th-ms;function um(n){this._+=n[0];for(let a=1,o=n.length;a<o;++a)this._+=arguments[a]+n[a]}function nv(n){let a=Math.floor(n);if(!(a>=0))throw new Error(`invalid digits: ${n}`);if(a>15)return um;const o=10**a;return function(c){this._+=c[0];for(let d=1,g=c.length;d<g;++d)this._+=Math.round(arguments[d]*o)/o+c[d]}}class rv{constructor(a){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=a==null?um:nv(a)}moveTo(a,o){this._append`M${this._x0=this._x1=+a},${this._y0=this._y1=+o}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(a,o){this._append`L${this._x1=+a},${this._y1=+o}`}quadraticCurveTo(a,o,c,d){this._append`Q${+a},${+o},${this._x1=+c},${this._y1=+d}`}bezierCurveTo(a,o,c,d,g,_){this._append`C${+a},${+o},${+c},${+d},${this._x1=+g},${this._y1=+_}`}arcTo(a,o,c,d,g){if(a=+a,o=+o,c=+c,d=+d,g=+g,g<0)throw new Error(`negative radius: ${g}`);let _=this._x1,s=this._y1,x=c-a,T=d-o,k=_-a,A=s-o,S=k*k+A*A;if(this._x1===null)this._append`M${this._x1=a},${this._y1=o}`;else if(S>ms)if(!(Math.abs(A*x-T*k)>ms)||!g)this._append`L${this._x1=a},${this._y1=o}`;else{let V=c-_,W=d-s,Z=x*x+T*T,Y=V*V+W*W,H=Math.sqrt(Z),Q=Math.sqrt(S),ae=g*Math.tan((eh-Math.acos((Z+S-Y)/(2*H*Q)))/2),ne=ae/Q,ge=ae/H;Math.abs(ne-1)>ms&&this._append`L${a+ne*k},${o+ne*A}`,this._append`A${g},${g},0,0,${+(A*V>k*W)},${this._x1=a+ge*x},${this._y1=o+ge*T}`}}arc(a,o,c,d,g,_){if(a=+a,o=+o,c=+c,_=!!_,c<0)throw new Error(`negative radius: ${c}`);let s=c*Math.cos(d),x=c*Math.sin(d),T=a+s,k=o+x,A=1^_,S=_?d-g:g-d;this._x1===null?this._append`M${T},${k}`:(Math.abs(this._x1-T)>ms||Math.abs(this._y1-k)>ms)&&this._append`L${T},${k}`,c&&(S<0&&(S=S%th+th),S>iv?this._append`A${c},${c},0,1,${A},${a-s},${o-x}A${c},${c},0,1,${A},${this._x1=T},${this._y1=k}`:S>ms&&this._append`A${c},${c},0,${+(S>=eh)},${A},${this._x1=a+c*Math.cos(g)},${this._y1=o+c*Math.sin(g)}`)}rect(a,o,c,d){this._append`M${this._x0=this._x1=+a},${this._y0=this._y1=+o}h${c=+c}v${+d}h${-c}Z`}toString(){return this._}}function av(n){let a=3;return n.digits=function(o){if(!arguments.length)return a;if(o==null)a=null;else{const c=Math.floor(o);if(!(c>=0))throw new RangeError(`invalid digits: ${o}`);a=c}return n},()=>new rv(a)}function sv(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function hm(n){this._context=n}hm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,a){switch(n=+n,a=+a,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,a):this._context.moveTo(n,a);break;case 1:this._point=2;default:this._context.lineTo(n,a);break}}};function ov(n){return new hm(n)}function lv(n){return n[0]}function cv(n){return n[1]}function fh(n,a){var o=Ks(!0),c=null,d=ov,g=null,_=av(s);n=typeof n=="function"?n:n===void 0?lv:Ks(n),a=typeof a=="function"?a:a===void 0?cv:Ks(a);function s(x){var T,k=(x=sv(x)).length,A,S=!1,V;for(c==null&&(g=d(V=_())),T=0;T<=k;++T)!(T<k&&o(A=x[T],T,x))===S&&((S=!S)?g.lineStart():g.lineEnd()),S&&g.point(+n(A,T,x),+a(A,T,x));if(V)return g=null,V+""||null}return s.x=function(x){return arguments.length?(n=typeof x=="function"?x:Ks(+x),s):n},s.y=function(x){return arguments.length?(a=typeof x=="function"?x:Ks(+x),s):a},s.defined=function(x){return arguments.length?(o=typeof x=="function"?x:Ks(!!x),s):o},s.curve=function(x){return arguments.length?(d=x,c!=null&&(g=d(c)),s):d},s.context=function(x){return arguments.length?(x==null?c=g=null:g=d(c=x),s):c},s}function kf(n,a,o){n._context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+a)/6,(n._y0+4*n._y1+o)/6)}function dm(n){this._context=n}dm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:kf(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,a){switch(n=+n,a=+a,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,a):this._context.moveTo(n,a);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:kf(this,n,a);break}this._x0=this._x1,this._x1=n,this._y0=this._y1,this._y1=a}};function fm(n){return new dm(n)}function Tf(n,a,o){const c=n.slice();return c[47]=a[o],c[49]=o,c}function Ef(n,a,o){const c=n.slice();return c[47]=a[o],c[49]=o,c}function Af(n){let a,o;return{c(){a=rt("p"),o=si(n[17]),this.h()},l(c){a=at(c,"P",{class:!0});var d=ve(a);o=oi(d,n[17]),d.forEach(q),this.h()},h(){E(a,"class","from-comparison-description svelte-2j0wow")},m(c,d){Ze(c,a,d),be(a,o)},p(c,d){d[0]&131072&&Ci(o,c[17])},d(c){c&&q(a)}}}function Sf(n){let a,o,c=n[13].length>1&&Cf(n);return{c(){c&&c.c(),a=Bi()},l(d){c&&c.l(d),a=Bi()},m(d,g){c&&c.m(d,g),Ze(d,a,g),o=!0},p(d,g){d[13].length>1?c?(c.p(d,g),g[0]&8192&&Ye(c,1)):(c=Cf(d),c.c(),Ye(c,1),c.m(a.parentNode,a)):c&&(Yi(),ht(c,1,1,()=>{c=null}),Ji())},i(d){o||(Ye(c),o=!0)},o(d){ht(c),o=!1},d(d){c&&c.d(d),d&&q(a)}}}function Cf(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W=n[3].maxXDomain+"",Z,Y,H,Q,ae,ne,ge,se,je=n[9].includes(0),ce,ee,ke=n[9].includes(0),_e,me,Me=n[23]!=null&n[14]!=null&!n[9].includes(0),Re,he,Ee,ft,nt,Fe=je&&Mf(n),Se=ke&&zf(n),de=n[12],Qe=[];for(let Xe=0;Xe<de.length;Xe+=1)Qe[Xe]=Df(Ef(n,de,Xe));let Je=n[13],yt=[];for(let Xe=0;Xe<Je.length;Xe+=1)yt[Xe]=Pf(Tf(n,Je,Xe));let mt=Me&&Lf(n);return{c(){a=ct("svg"),o=ct("g"),c=ct("line"),_=ct("text"),s=si(n[11]),k=ct("line"),V=ct("text"),Z=si(W),ae=ct("g"),ne=ct("path"),Fe&&Fe.c(),ce=ct("path"),Se&&Se.c(),_e=ct("g");for(let Xe=0;Xe<Qe.length;Xe+=1)Qe[Xe].c();for(let Xe=0;Xe<yt.length;Xe+=1)yt[Xe].c();me=Bi(),mt&&mt.c(),this.h()},l(Xe){a=ut(Xe,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var gt=ve(a);o=ut(gt,"g",{class:!0,transform:!0});var ze=ve(o);c=ut(ze,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),ve(c).forEach(q),_=ut(ze,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var Pe=ve(_);s=oi(Pe,n[11]),Pe.forEach(q),k=ut(ze,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0}),ve(k).forEach(q),V=ut(ze,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var Ve=ve(V);Z=oi(Ve,W),Ve.forEach(q),ae=ut(ze,"g",{opacity:!0});var vt=ve(ae);ne=ut(vt,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(ne).forEach(q),Fe&&Fe.l(vt),vt.forEach(q),ce=ut(ze,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(ce).forEach(q),Se&&Se.l(ze),_e=ut(ze,"g",{opacity:!0});var fi=ve(_e);for(let tt=0;tt<Qe.length;tt+=1)Qe[tt].l(fi);fi.forEach(q);for(let tt=0;tt<yt.length;tt+=1)yt[tt].l(ze);me=Bi(),mt&&mt.l(ze),ze.forEach(q),gt.forEach(q),this.h()},h(){E(c,"x1",d=n[19]<30|n[20]<30?0:25),E(c,"x2",g=n[19]<30|n[20]<30?n[7]-25:n[7]),E(c,"y1","0"),E(c,"y2","0"),E(c,"stroke","rgb(200,200,200)"),E(c,"stroke-width","1.5px"),E(_,"text-anchor",x=n[19]<30|n[20]<30?"start":"end"),E(_,"font-size","14px"),E(_,"x",T=n[19]<30|n[20]<30?n[7]-20:20),E(_,"y","5"),E(_,"stroke","rgb(175,175,175)"),E(_,"fill","rgb(175,175,175)"),E(_,"stroke-width","0.5px"),E(k,"x1",A=n[19]<30|n[20]<30?0:25),E(k,"x2",S=n[19]<30|n[20]<30?n[7]-25:n[7]),E(k,"y1",n[6]),E(k,"y2",n[6]),E(k,"stroke","rgb(200,200,200)"),E(k,"stroke-width","1.5px"),E(V,"text-anchor",Y=n[19]<30|n[20]<30?"start":"end"),E(V,"font-size","14px"),E(V,"x",H=n[19]<30|n[20]<30?n[7]-20:20),E(V,"y",Q=n[6]+5),E(V,"stroke","rgb(175,175,175)"),E(V,"fill","rgb(175,175,175)"),E(V,"stroke-width","0.5px"),E(ne,"d",ge=n[18](n[12])),E(ne,"stroke",se=Xt[n[15]]),E(ne,"fill","none"),E(ne,"stroke-width","2px"),E(ae,"opacity","0.75"),E(ce,"d",ee=n[18](n[13])),E(ce,"stroke",Xt.main),E(ce,"fill","none"),E(ce,"stroke-width","2px"),E(_e,"opacity","0.75"),E(o,"class","chart-container"),E(o,"transform",Re="translate("+(Gt.left[n[5]===0?"split":"full"]+Gt.areaSpaceBeyondXScale[n[5]===0?"split":"full"])+","+Gt.top[n[5]===0?"split":"full"]+")"),E(a,"class",he="line-row-svg line-row-svg-"+(n[1]*100+n[0])+" svelte-2j0wow"),E(a,"viewBox",Ee="0 0 "+n[4]+" "+ma[n[5]===0?"split":"full"]),E(a,"width","100%"),E(a,"height",ft=20+ma[n[5]===0?"split":"full"])},m(Xe,gt){Ze(Xe,a,gt),be(a,o),be(o,c),be(o,_),be(_,s),be(o,k),be(o,V),be(V,Z),be(o,ae),be(ae,ne),Fe&&Fe.m(ae,null),be(o,ce),Se&&Se.m(o,null),be(o,_e);for(let ze=0;ze<Qe.length;ze+=1)Qe[ze]&&Qe[ze].m(_e,null);for(let ze=0;ze<yt.length;ze+=1)yt[ze]&&yt[ze].m(o,null);be(o,me),mt&&mt.m(o,null),nt=!0},p(Xe,gt){if((!nt||gt[0]&1572864&&d!==(d=Xe[19]<30|Xe[20]<30?0:25))&&E(c,"x1",d),(!nt||gt[0]&1572992&&g!==(g=Xe[19]<30|Xe[20]<30?Xe[7]-25:Xe[7]))&&E(c,"x2",g),(!nt||gt[0]&2048)&&Ci(s,Xe[11]),(!nt||gt[0]&1572864&&x!==(x=Xe[19]<30|Xe[20]<30?"start":"end"))&&E(_,"text-anchor",x),(!nt||gt[0]&1572992&&T!==(T=Xe[19]<30|Xe[20]<30?Xe[7]-20:20))&&E(_,"x",T),(!nt||gt[0]&1572864&&A!==(A=Xe[19]<30|Xe[20]<30?0:25))&&E(k,"x1",A),(!nt||gt[0]&1572992&&S!==(S=Xe[19]<30|Xe[20]<30?Xe[7]-25:Xe[7]))&&E(k,"x2",S),(!nt||gt[0]&64)&&E(k,"y1",Xe[6]),(!nt||gt[0]&64)&&E(k,"y2",Xe[6]),(!nt||gt[0]&8)&&W!==(W=Xe[3].maxXDomain+"")&&Ci(Z,W),(!nt||gt[0]&1572864&&Y!==(Y=Xe[19]<30|Xe[20]<30?"start":"end"))&&E(V,"text-anchor",Y),(!nt||gt[0]&1572992&&H!==(H=Xe[19]<30|Xe[20]<30?Xe[7]-20:20))&&E(V,"x",H),(!nt||gt[0]&64&&Q!==(Q=Xe[6]+5))&&E(V,"y",Q),(!nt||gt[0]&266240&&ge!==(ge=Xe[18](Xe[12])))&&E(ne,"d",ge),(!nt||gt[0]&32768&&se!==(se=Xt[Xe[15]]))&&E(ne,"stroke",se),gt[0]&512&&(je=Xe[9].includes(0)),je?Fe?Fe.p(Xe,gt):(Fe=Mf(Xe),Fe.c(),Fe.m(ae,null)):Fe&&(Fe.d(1),Fe=null),(!nt||gt[0]&270336&&ee!==(ee=Xe[18](Xe[13])))&&E(ce,"d",ee),gt[0]&512&&(ke=Xe[9].includes(0)),ke?Se?Se.p(Xe,gt):(Se=zf(Xe),Se.c(),Se.m(o,_e)):Se&&(Se.d(1),Se=null),gt[0]&39944){de=Xe[12];let ze;for(ze=0;ze<de.length;ze+=1){const Pe=Ef(Xe,de,ze);Qe[ze]?Qe[ze].p(Pe,gt):(Qe[ze]=Df(Pe),Qe[ze].c(),Qe[ze].m(_e,null))}for(;ze<Qe.length;ze+=1)Qe[ze].d(1);Qe.length=de.length}if(gt[0]&11272){Je=Xe[13];let ze;for(ze=0;ze<Je.length;ze+=1){const Pe=Tf(Xe,Je,ze);yt[ze]?yt[ze].p(Pe,gt):(yt[ze]=Pf(Pe),yt[ze].c(),yt[ze].m(o,me))}for(;ze<yt.length;ze+=1)yt[ze].d(1);yt.length=Je.length}gt[0]&16896&&(Me=Xe[23]!=null&Xe[14]!=null&!Xe[9].includes(0)),Me?mt?(mt.p(Xe,gt),gt[0]&16896&&Ye(mt,1)):(mt=Lf(Xe),mt.c(),Ye(mt,1),mt.m(o,null)):mt&&(Yi(),ht(mt,1,1,()=>{mt=null}),Ji()),(!nt||gt[0]&32&&Re!==(Re="translate("+(Gt.left[Xe[5]===0?"split":"full"]+Gt.areaSpaceBeyondXScale[Xe[5]===0?"split":"full"])+","+Gt.top[Xe[5]===0?"split":"full"]+")"))&&E(o,"transform",Re),(!nt||gt[0]&3&&he!==(he="line-row-svg line-row-svg-"+(Xe[1]*100+Xe[0])+" svelte-2j0wow"))&&E(a,"class",he),(!nt||gt[0]&48&&Ee!==(Ee="0 0 "+Xe[4]+" "+ma[Xe[5]===0?"split":"full"]))&&E(a,"viewBox",Ee),(!nt||gt[0]&32&&ft!==(ft=20+ma[Xe[5]===0?"split":"full"]))&&E(a,"height",ft)},i(Xe){nt||(Ye(mt),nt=!0)},o(Xe){ht(mt),nt=!1},d(Xe){Xe&&q(a),Fe&&Fe.d(),Se&&Se.d(),Qi(Qe,Xe),Qi(yt,Xe),mt&&mt.d()}}}function Mf(n){let a,o,c;return{c(){a=ct("path"),this.h()},l(d){a=ut(d,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),ve(a).forEach(q),this.h()},h(){E(a,"d",o=n[18](n[21])),E(a,"fill",c=Xt[n[15]]),E(a,"stroke","none"),E(a,"stroke-width","2px"),E(a,"opacity","0.25")},m(d,g){Ze(d,a,g)},p(d,g){g[0]&2359296&&o!==(o=d[18](d[21]))&&E(a,"d",o),g[0]&32768&&c!==(c=Xt[d[15]])&&E(a,"fill",c)},d(d){d&&q(a)}}}function zf(n){let a,o;return{c(){a=ct("path"),this.h()},l(c){a=ut(c,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),ve(a).forEach(q),this.h()},h(){E(a,"d",o=n[18](n[22])),E(a,"fill",Xt.main),E(a,"stroke","none"),E(a,"stroke-width","2px"),E(a,"opacity","0.25")},m(c,d){Ze(c,a,d)},p(c,d){d[0]&4456448&&o!==(o=c[18](c[22]))&&E(a,"d",o)},d(c){c&&q(a)}}}function Df(n){let a,o,c,d,g;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(_){a=ut(_,"g",{transform:!0});var s=ve(a);o=ut(s,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),ve(o).forEach(q),s.forEach(q),this.h()},h(){E(o,"r",c=n[47].xDomainNumb==n[11]?4:n[47].xDomainNumb==n[3].maxXDomain?5:0),E(o,"fill",d=Xt[n[15]]),E(o,"stroke-width","1px"),E(o,"stroke","white"),E(a,"transform",g="translate("+n[47].zScore+","+n[10](n[47].xDomainNumb)+")")},m(_,s){Ze(_,a,s),be(a,o)},p(_,s){s[0]&6152&&c!==(c=_[47].xDomainNumb==_[11]?4:_[47].xDomainNumb==_[3].maxXDomain?5:0)&&E(o,"r",c),s[0]&32768&&d!==(d=Xt[_[15]])&&E(o,"fill",d),s[0]&5120&&g!==(g="translate("+_[47].zScore+","+_[10](_[47].xDomainNumb)+")")&&E(a,"transform",g)},d(_){_&&q(a)}}}function Pf(n){let a,o,c,d;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(g){a=ut(g,"g",{transform:!0});var _=ve(a);o=ut(_,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),ve(o).forEach(q),_.forEach(q),this.h()},h(){E(o,"r",c=n[47].xDomainNumb==n[11]?4:n[47].xDomainNumb==n[3].maxXDomain?5:0),E(o,"fill",Xt.main),E(o,"stroke-width","1px"),E(o,"stroke","white"),E(a,"transform",d="translate("+n[47].zScore+","+n[10](n[47].xDomainNumb)+")")},m(g,_){Ze(g,a,_),be(a,o)},p(g,_){_[0]&10248&&c!==(c=g[47].xDomainNumb==g[11]?4:g[47].xDomainNumb==g[3].maxXDomain?5:0)&&E(o,"r",c),_[0]&9216&&d!==(d="translate("+g[47].zScore+","+g[10](g[47].xDomainNumb)+")")&&E(a,"transform",d)},d(g){g&&q(a)}}}function Lf(n){let a,o;return a=new c1({props:{xPosition:n[13].length>1?Math.abs(n[13][n[13].length-1].zScore-n[13][0].zScore)/2+Math.min(n[13][n[13].length-1].zScore,n[13][0].zScore):n[13][0].zScore,metadata:n[2],mainLatestValue:n[23],mainPreviousValue:n[14],scaleWidth:n[7],scaleHeight:n[6],chosenId3:n[5]}}),{c(){Yt(a.$$.fragment)},l(c){Jt(a.$$.fragment,c)},m(c,d){Qt(a,c,d),o=!0},p(c,d){const g={};d[0]&8192&&(g.xPosition=c[13].length>1?Math.abs(c[13][c[13].length-1].zScore-c[13][0].zScore)/2+Math.min(c[13][c[13].length-1].zScore,c[13][0].zScore):c[13][0].zScore),d[0]&4&&(g.metadata=c[2]),d[0]&16384&&(g.mainPreviousValue=c[14]),d[0]&128&&(g.scaleWidth=c[7]),d[0]&64&&(g.scaleHeight=c[6]),d[0]&32&&(g.chosenId3=c[5]),a.$set(g)},i(c){o||(Ye(a.$$.fragment,c),o=!0)},o(c){ht(a.$$.fragment,c),o=!1},d(c){$t(a,c)}}}function uv(n){let a,o=n[8].includes(0)&n[5]===0,c,d,g,_=o&&Af(n),s=n[5]===0&&Sf(n);return{c(){a=rt("div"),_&&_.c(),c=Ut(),s&&s.c(),this.h()},l(x){a=at(x,"DIV",{class:!0,style:!0});var T=ve(a);_&&_.l(T),c=qt(T),s&&s.l(T),T.forEach(q),this.h()},h(){E(a,"class","time-comparison-cell-container svelte-2j0wow"),E(a,"style",d=n[5]!=0|n[16]==null?null:"background-color:"+n[16]+"; box-shadow: 0 0 4px 3px "+n[16]+";")},m(x,T){Ze(x,a,T),_&&_.m(a,null),be(a,c),s&&s.m(a,null),g=!0},p(x,T){T[0]&288&&(o=x[8].includes(0)&x[5]===0),o?_?_.p(x,T):(_=Af(x),_.c(),_.m(a,c)):_&&(_.d(1),_=null),x[5]===0?s?(s.p(x,T),T[0]&32&&Ye(s,1)):(s=Sf(x),s.c(),Ye(s,1),s.m(a,null)):s&&(Yi(),ht(s,1,1,()=>{s=null}),Ji()),(!g||T[0]&65568&&d!==(d=x[5]!=0|x[16]==null?null:"background-color:"+x[16]+"; box-shadow: 0 0 4px 3px "+x[16]+";"))&&E(a,"style",d)},i(x){g||(Ye(s),g=!0)},o(x){ht(s),g=!1},d(x){x&&q(a),_&&_.d(),s&&s.d()}}}function hv(n,a,o){let c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge,se,je,ce,ee,ke,_e,{indicator:me}=a,{rowNumb:Me,topicNumb:Re}=a,{metadata:he,calculations:Ee}=a,{col4Width:ft}=a,{chosenId2:nt}=a,{chosenId3:Fe}=a,{baselineComparisonArea:Se}=a,{visibleAreas:de}=a,{scaleHeight:Qe,scaleWidth:Je}=a,{x:yt,xDomain:mt}=a,{chosenId11:Xe}=a,{chosenId6:gt}=a,ze=Ee.calcs[Ee.maxXDomain].median,Pe=Ee.calcs[Ee.maxXDomain].mad,Ve=Ee.calcs[Ee.maxXDomain].main,vt=Pn.better,fi="Improved since 2012";return n.$$set=tt=>{"indicator"in tt&&o(24,me=tt.indicator),"rowNumb"in tt&&o(0,Me=tt.rowNumb),"topicNumb"in tt&&o(1,Re=tt.topicNumb),"metadata"in tt&&o(2,he=tt.metadata),"calculations"in tt&&o(3,Ee=tt.calculations),"col4Width"in tt&&o(4,ft=tt.col4Width),"chosenId2"in tt&&o(25,nt=tt.chosenId2),"chosenId3"in tt&&o(5,Fe=tt.chosenId3),"baselineComparisonArea"in tt&&o(26,Se=tt.baselineComparisonArea),"visibleAreas"in tt&&o(27,de=tt.visibleAreas),"scaleHeight"in tt&&o(6,Qe=tt.scaleHeight),"scaleWidth"in tt&&o(7,Je=tt.scaleWidth),"x"in tt&&o(28,yt=tt.x),"xDomain"in tt&&o(29,mt=tt.xDomain),"chosenId11"in tt&&o(8,Xe=tt.chosenId11),"chosenId6"in tt&&o(9,gt=tt.chosenId6)},n.$$.update=()=>{n.$$.dirty[0]&33554440&&o(30,c=nt==="earliest available year"?Ee.mainMinXDomain:nt==="previous year"?Ee.maxXDomain-1:nt),n.$$.dirty[0]&1073741832&&o(43,g=Array.from({length:Ee.maxXDomain-c+1},(tt,lt)=>c+lt).map(tt=>({xDomainNumb:tt,value:Ee.calcs[tt]==null?void 0:"main"in Ee.calcs[tt]?Ee.calcs[tt].main:void 0})).filter(tt=>tt.value!=null&!isNaN(tt.value))),n.$$.dirty[0]&268435616|n.$$.dirty[1]&4096&&o(13,_=g.map(tt=>({...tt,zScore:Ec(Gt,Fe,Je,yt,tt.value,ze,Pe)}))),n.$$.dirty[0]&8192&&o(22,s=[..._.map(tt=>({...tt,zScore:tt.zScore-15})),..._.reverse().map(tt=>({...tt,zScore:tt.zScore+15}))]),n.$$.dirty[0]&67108864|n.$$.dirty[1]&2048&&o(15,x=(Se.areacd==="median"?Se:d.find(tt=>Se.areacd===tt.areacd)).role),n.$$.dirty[0]&1073774600&&o(41,T=Array.from({length:Ee.maxXDomain-c+1},(tt,lt)=>c+lt).map(tt=>({xDomainNumb:tt,value:Ee.calcs[tt]==null?void 0:x in Ee.calcs[tt]?Ee.calcs[tt][x]:void 0})).filter(tt=>tt.value!=null&!isNaN(tt.value))),n.$$.dirty[0]&268435616|n.$$.dirty[1]&1024&&o(12,k=T.map(tt=>({...tt,zScore:Ec(Gt,Fe,Je,yt,tt.value,ze,Pe)}))),n.$$.dirty[0]&4096&&o(21,A=[...k.map(tt=>({...tt,zScore:tt.zScore-5})),...k.reverse().map(tt=>({...tt,zScore:tt.zScore+5}))]),n.$$.dirty[0]&1073741832&&o(14,S=c in Ee.calcs?Ee.calcs[c].main:null),n.$$.dirty[0]&16384&&o(34,V=Ve==null|S==null|Pe==null?null:(Ve-S)/Pe),n.$$.dirty[0]&256&&o(40,W=Xe.includes(1)),n.$$.dirty[0]&4&&o(39,Z=he.polarity==0?null:he.polarity==-1?"better":"worse"),n.$$.dirty[0]&4&&o(38,Y=he.polarity==0?null:"similar"),n.$$.dirty[0]&4&&o(37,H=he.polarity==0?null:he.polarity==1?"better":"worse"),n.$$.dirty[0]&256&&o(33,Q=Xe.includes(3)?2:1),n.$$.dirty[0]&1073741836|n.$$.dirty[1]&972&&o(16,vt=!W|V==null|he.polarity==0|c==Ee.maxXDomain?null:V<-Q?Pn[Z]:V<=Q?Pn[Y]:Pn[H]),n.$$.dirty[0]&67108864&&(Se.areacd==="median"||Se.areanm),n.$$.dirty[0]&256&&o(36,ae=Xe.includes(2)),n.$$.dirty[0]&4|n.$$.dirty[1]&32&&o(35,ne=he.polarity==0|!ae?"Decreased":he.polarity==-1?"Improved":"Worsened"),n.$$.dirty[0]&4|n.$$.dirty[1]&32&&o(31,se=he.polarity==0|!ae?"Increased":he.polarity==1?"Improved":"Worsened"),n.$$.dirty[0]&1073758216|n.$$.dirty[1]&31&&o(17,fi=c==Ee.maxXDomain?"No historical data":Ve==null?"No data in "+Ee.maxXDomain:S==null?"No data in "+c:(V<-Q?ne:V<=Q?ge:se)+" since "+c),n.$$.dirty[0]&12288&&o(11,je=Math.min(...[..._,...k].map(tt=>tt.xDomainNumb))),n.$$.dirty[0]&12288&&o(20,ce=Math.min(...[..._,...k].map(tt=>tt.zScore))),n.$$.dirty[0]&12288&&o(19,ee=Math.min(...[..._,...k].map(tt=>tt.zScore))),n.$$.dirty[0]&2120&&o(10,ke=Oa().domain([je,Ee.maxXDomain]).range([0,Qe])),n.$$.dirty[0]&1024&&o(18,_e=fh().curve(fm).x(tt=>tt.zScore).y(tt=>ke(tt.xDomainNumb)))},o(42,d=mi("selectedAndRelatedAreas")),o(32,ge="Little change"),[Me,Re,he,Ee,ft,Fe,Qe,Je,Xe,gt,ke,je,k,_,S,x,vt,fi,_e,ee,ce,A,s,Ve,me,nt,Se,de,yt,mt,c,se,ge,Q,V,ne,ae,H,Y,Z,W,T,d,g]}let dv=class extends vi{constructor(a){super(),bi(this,a,hv,uv,xi,{indicator:24,rowNumb:0,topicNumb:1,metadata:2,calculations:3,col4Width:4,chosenId2:25,chosenId3:5,baselineComparisonArea:26,visibleAreas:27,scaleHeight:6,scaleWidth:7,x:28,xDomain:29,chosenId11:8,chosenId6:9},null,[-1,-1])}};function fv(n){let a,o,c;return{c(){a=rt("div"),o=ct("svg"),c=ct("path"),this.h()},l(d){a=at(d,"DIV",{class:!0});var g=ve(a);o=ut(g,"svg",{width:!0,height:!0,class:!0,viewBox:!0,style:!0});var _=ve(o);c=ut(_,"path",{d:!0}),ve(c).forEach(q),_.forEach(q),g.forEach(q),this.h()},h(){E(c,"d","M24.15 34q.65 0 1.075-.425.425-.425.425-1.075v-9.05q0-.6-.45-1.025Q24.75 22 24.15 22q-.65 0-1.075.425-.425.425-.425 1.075v9.05q0 .6.45 1.025.45.425 1.05.425ZM24 18.3q.7 0 1.175-.45.475-.45.475-1.15t-.475-1.2Q24.7 15 24 15q-.7 0-1.175.5-.475.5-.475 1.2t.475 1.15q.475.45 1.175.45ZM24 44q-4.25 0-7.9-1.525-3.65-1.525-6.35-4.225-2.7-2.7-4.225-6.35Q4 28.25 4 24q0-4.2 1.525-7.85Q7.05 12.5 9.75 9.8q2.7-2.7 6.35-4.25Q19.75 4 24 4q4.2 0 7.85 1.55Q35.5 7.1 38.2 9.8q2.7 2.7 4.25 6.35Q44 19.8 44 24q0 4.25-1.55 7.9-1.55 3.65-4.25 6.35-2.7 2.7-6.35 4.225Q28.2 44 24 44Zm0-20Zm0 17q7 0 12-5t5-12q0-7-5-12T24 7q-7 0-12 5T7 24q0 7 5 12t12 5Z"),E(o,"width","20"),E(o,"height","20"),E(o,"class","c h-16 w-16 inline svelte-nloqxl svelte-1fiksfe"),E(o,"viewBox","0 0 48 48"),ni(o,"transform","rotate(0deg)"),E(a,"class","infoCell svelte-1fiksfe")},m(d,g){Ze(d,a,g),be(a,o),be(o,c)},p:Ei,i:Ei,o:Ei,d(d){d&&q(a)}}}class pv extends vi{constructor(a){super(),bi(this,a,null,fv,xi,{})}}function Bf(n,a,o){const c=n.slice();return c[54]=a[o],c[56]=o,c}function Rf(n,a,o){const c=n.slice();return c[54]=a[o],c[56]=o,c}function Ff(n){let a,o;return{c(){a=rt("p"),o=si(n[18]),this.h()},l(c){a=at(c,"P",{class:!0});var d=ve(a);o=oi(d,n[18]),d.forEach(q),this.h()},h(){E(a,"class","from-comparison-description svelte-2j0wow")},m(c,d){Ze(c,a,d),be(a,o)},p(c,d){d[0]&262144&&Ci(o,c[18])},d(c){c&&q(a)}}}function Of(n){let a,o=n[8].length>1&&Vf(n);return{c(){o&&o.c(),a=Bi()},l(c){o&&o.l(c),a=Bi()},m(c,d){o&&o.m(c,d),Ze(c,a,d)},p(c,d){c[8].length>1?o?o.p(c,d):(o=Vf(c),o.c(),o.m(a.parentNode,a)):o&&(o.d(1),o=null)},d(c){o&&o.d(c),c&&q(a)}}}function Vf(n){let a,o,c,d,g,_,s,x,T,k,A=n[3].maxXDomain+"",S,V,W=n[26]!=null&n[9]!=null&!n[7].includes(0),Z,Y,H,Q,ae=n[7].includes(0),ne,ge,se=n[7].includes(0),je,ce,ee=n[26]!=null&n[9]!=null&!n[7].includes(0),ke,_e,me,Me=W&&Nf(n),Re=ae&&Uf(n),he=se&&qf(n),Ee=n[13],ft=[];for(let de=0;de<Ee.length;de+=1)ft[de]=Gf(Rf(n,Ee,de));let nt=n[8],Fe=[];for(let de=0;de<nt.length;de+=1)Fe[de]=jf(Bf(n,nt,de));let Se=ee&&Zf(n);return{c(){a=ct("svg"),o=ct("g"),c=ct("line"),g=ct("line"),s=ct("text"),x=si(n[12]),k=ct("text"),S=si(A),Me&&Me.c(),Z=ct("g"),Y=ct("path"),Re&&Re.c(),ne=ct("path"),he&&he.c(),je=ct("g");for(let de=0;de<ft.length;de+=1)ft[de].c();for(let de=0;de<Fe.length;de+=1)Fe[de].c();ce=Bi(),Se&&Se.c(),this.h()},l(de){a=ut(de,"svg",{class:!0,viewBox:!0,width:!0,height:!0});var Qe=ve(a);o=ut(Qe,"g",{class:!0,transform:!0});var Je=ve(o);c=ut(Je,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0}),ve(c).forEach(q),g=ut(Je,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0}),ve(g).forEach(q),s=ut(Je,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var yt=ve(s);x=oi(yt,n[12]),yt.forEach(q),k=ut(Je,"text",{"text-anchor":!0,"font-size":!0,x:!0,y:!0,stroke:!0,fill:!0,"stroke-width":!0});var mt=ve(k);S=oi(mt,A),mt.forEach(q),Me&&Me.l(Je),Z=ut(Je,"g",{opacity:!0});var Xe=ve(Z);Y=ut(Xe,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(Y).forEach(q),Re&&Re.l(Xe),Xe.forEach(q),ne=ut(Je,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(ne).forEach(q),he&&he.l(Je),je=ut(Je,"g",{opacity:!0});var gt=ve(je);for(let ze=0;ze<ft.length;ze+=1)ft[ze].l(gt);gt.forEach(q);for(let ze=0;ze<Fe.length;ze+=1)Fe[ze].l(Je);ce=Bi(),Se&&Se.l(Je),Je.forEach(q),Qe.forEach(q),this.h()},h(){E(c,"y1",d=n[10]+Gt.areaSpaceBeyondXScale.split),E(c,"y2",n[22]),E(c,"x1","0"),E(c,"x2","0"),E(c,"stroke","rgb(200,200,200)"),E(c,"stroke-width","1.5px"),E(c,"stroke-dasharray","4 2"),E(g,"y1",_=n[10]+Gt.areaSpaceBeyondXScale.split),E(g,"y2",n[21]),E(g,"x1",n[11]),E(g,"x2",n[11]),E(g,"stroke","rgb(200,200,200)"),E(g,"stroke-width","1.5px"),E(g,"stroke-dasharray","4 2"),E(s,"text-anchor","middle"),E(s,"font-size","14px"),E(s,"x",0),E(s,"y",T=n[10]+15+Gt.areaSpaceBeyondXScale.split),E(s,"stroke","rgb(175,175,175)"),E(s,"fill","rgb(175,175,175)"),E(s,"stroke-width","0.5px"),E(k,"text-anchor","middle"),E(k,"font-size","14px"),E(k,"x",n[11]),E(k,"y",V=n[10]+15+Gt.areaSpaceBeyondXScale.split),E(k,"stroke","rgb(175,175,175)"),E(k,"fill","rgb(175,175,175)"),E(k,"stroke-width","0.5px"),E(Y,"d",H=n[20](n[13])),E(Y,"stroke",Q=Xt[n[14]]),E(Y,"fill","none"),E(Y,"stroke-width","2px"),E(Z,"opacity","0.75"),E(ne,"d",ge=n[20](n[8])),E(ne,"stroke",Xt.main),E(ne,"fill","none"),E(ne,"stroke-width","2px"),E(je,"opacity","0.75"),E(o,"class","chart-container"),E(o,"transform",ke="translate("+n[15].left+","+(n[15].top+Gt.areaSpaceBeyondXScale.split)+")"),E(a,"class",_e="line-row-svg line-row-svg-"+(n[2]*100+n[1])+" svelte-2j0wow"),E(a,"viewBox",me="0 0 "+n[4]+" "+n[16]),E(a,"width","100%"),E(a,"height",n[16])},m(de,Qe){Ze(de,a,Qe),be(a,o),be(o,c),be(o,g),be(o,s),be(s,x),be(o,k),be(k,S),Me&&Me.m(o,null),be(o,Z),be(Z,Y),Re&&Re.m(Z,null),be(o,ne),he&&he.m(o,null),be(o,je);for(let Je=0;Je<ft.length;Je+=1)ft[Je]&&ft[Je].m(je,null);for(let Je=0;Je<Fe.length;Je+=1)Fe[Je]&&Fe[Je].m(o,null);be(o,ce),Se&&Se.m(o,null)},p(de,Qe){if(Qe[0]&1024&&d!==(d=de[10]+Gt.areaSpaceBeyondXScale.split)&&E(c,"y1",d),Qe[0]&4194304&&E(c,"y2",de[22]),Qe[0]&1024&&_!==(_=de[10]+Gt.areaSpaceBeyondXScale.split)&&E(g,"y1",_),Qe[0]&2097152&&E(g,"y2",de[21]),Qe[0]&2048&&E(g,"x1",de[11]),Qe[0]&2048&&E(g,"x2",de[11]),Qe[0]&4096&&Ci(x,de[12]),Qe[0]&1024&&T!==(T=de[10]+15+Gt.areaSpaceBeyondXScale.split)&&E(s,"y",T),Qe[0]&8&&A!==(A=de[3].maxXDomain+"")&&Ci(S,A),Qe[0]&2048&&E(k,"x",de[11]),Qe[0]&1024&&V!==(V=de[10]+15+Gt.areaSpaceBeyondXScale.split)&&E(k,"y",V),Qe[0]&640&&(W=de[26]!=null&de[9]!=null&!de[7].includes(0)),W?Me?Me.p(de,Qe):(Me=Nf(de),Me.c(),Me.m(o,Z)):Me&&(Me.d(1),Me=null),Qe[0]&1056768&&H!==(H=de[20](de[13]))&&E(Y,"d",H),Qe[0]&16384&&Q!==(Q=Xt[de[14]])&&E(Y,"stroke",Q),Qe[0]&128&&(ae=de[7].includes(0)),ae?Re?Re.p(de,Qe):(Re=Uf(de),Re.c(),Re.m(Z,null)):Re&&(Re.d(1),Re=null),Qe[0]&1048832&&ge!==(ge=de[20](de[8]))&&E(ne,"d",ge),Qe[0]&128&&(se=de[7].includes(0)),se?he?he.p(de,Qe):(he=qf(de),he.c(),he.m(o,je)):he&&(he.d(1),he=null),Qe[0]&28681){Ee=de[13];let Je;for(Je=0;Je<Ee.length;Je+=1){const yt=Rf(de,Ee,Je);ft[Je]?ft[Je].p(yt,Qe):(ft[Je]=Gf(yt),ft[Je].c(),ft[Je].m(je,null))}for(;Je<ft.length;Je+=1)ft[Je].d(1);ft.length=Ee.length}if(Qe[0]&4361){nt=de[8];let Je;for(Je=0;Je<nt.length;Je+=1){const yt=Bf(de,nt,Je);Fe[Je]?Fe[Je].p(yt,Qe):(Fe[Je]=jf(yt),Fe[Je].c(),Fe[Je].m(o,ce))}for(;Je<Fe.length;Je+=1)Fe[Je].d(1);Fe.length=nt.length}Qe[0]&640&&(ee=de[26]!=null&de[9]!=null&!de[7].includes(0)),ee?Se?Se.p(de,Qe):(Se=Zf(de),Se.c(),Se.m(o,null)):Se&&(Se.d(1),Se=null),Qe[0]&32768&&ke!==(ke="translate("+de[15].left+","+(de[15].top+Gt.areaSpaceBeyondXScale.split)+")")&&E(o,"transform",ke),Qe[0]&6&&_e!==(_e="line-row-svg line-row-svg-"+(de[2]*100+de[1])+" svelte-2j0wow")&&E(a,"class",_e),Qe[0]&65552&&me!==(me="0 0 "+de[4]+" "+de[16])&&E(a,"viewBox",me),Qe[0]&65536&&E(a,"height",de[16])},d(de){de&&q(a),Me&&Me.d(),Re&&Re.d(),he&&he.d(),Qi(ft,de),Qi(Fe,de),Se&&Se.d()}}}function Nf(n){let a,o,c,d,g,_,s,x,T;return{c(){a=ct("line"),_=ct("g"),s=ct("path"),this.h()},l(k){a=ut(k,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0,"stroke-width":!0,fill:!0}),ve(a).forEach(q),_=ut(k,"g",{transform:!0});var A=ve(_);s=ut(A,"path",{transform:!0,d:!0,stroke:!0,"stroke-width":!0,fill:!0}),ve(s).forEach(q),A.forEach(q),this.h()},h(){E(a,"x1",o=n[11]+12),E(a,"x2",c=n[11]+12),E(a,"y1",d=n[8][0].zScore),E(a,"y2",g=n[8][n[8].length-1].zScore),E(a,"stroke",Xt.main),E(a,"stroke-width","1.5px"),E(a,"fill","none"),E(s,"transform",x=n[8][0].zScore<n[8][n[8].length-1].zScore?"rotate(180)":null),E(s,"d","M0 0 l-3 3 l6 0 z"),E(s,"stroke",Xt.main),E(s,"stroke-width","1.5px"),E(s,"fill",Xt.main),E(_,"transform",T="translate("+(n[11]+12)+","+n[8][n[8].length-1].zScore+")")},m(k,A){Ze(k,a,A),Ze(k,_,A),be(_,s)},p(k,A){A[0]&2048&&o!==(o=k[11]+12)&&E(a,"x1",o),A[0]&2048&&c!==(c=k[11]+12)&&E(a,"x2",c),A[0]&256&&d!==(d=k[8][0].zScore)&&E(a,"y1",d),A[0]&256&&g!==(g=k[8][k[8].length-1].zScore)&&E(a,"y2",g),A[0]&256&&x!==(x=k[8][0].zScore<k[8][k[8].length-1].zScore?"rotate(180)":null)&&E(s,"transform",x),A[0]&2304&&T!==(T="translate("+(k[11]+12)+","+k[8][k[8].length-1].zScore+")")&&E(_,"transform",T)},d(k){k&&q(a),k&&q(_)}}}function Uf(n){let a,o,c;return{c(){a=ct("path"),this.h()},l(d){a=ut(d,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),ve(a).forEach(q),this.h()},h(){E(a,"d",o=n[20](n[23])),E(a,"fill",c=Xt[n[14]]),E(a,"stroke","none"),E(a,"stroke-width","2px"),E(a,"opacity","0.25")},m(d,g){Ze(d,a,g)},p(d,g){g[0]&9437184&&o!==(o=d[20](d[23]))&&E(a,"d",o),g[0]&16384&&c!==(c=Xt[d[14]])&&E(a,"fill",c)},d(d){d&&q(a)}}}function qf(n){let a,o;return{c(){a=ct("path"),this.h()},l(c){a=ut(c,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0}),ve(a).forEach(q),this.h()},h(){E(a,"d",o=n[20](n[24])),E(a,"fill",Xt.main),E(a,"stroke","none"),E(a,"stroke-width","2px"),E(a,"opacity","0.25")},m(c,d){Ze(c,a,d)},p(c,d){d[0]&17825792&&o!==(o=c[20](c[24]))&&E(a,"d",o)},d(c){c&&q(a)}}}function Gf(n){let a,o,c,d,g;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(_){a=ut(_,"g",{transform:!0});var s=ve(a);o=ut(s,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),ve(o).forEach(q),s.forEach(q),this.h()},h(){E(o,"r",c=n[54].xDomainNumb==n[12]?4:n[54].xDomainNumb==n[3].maxXDomain?5:0),E(o,"fill",d=Xt[n[14]]),E(o,"stroke-width","1px"),E(o,"stroke","white"),E(a,"transform",g="translate("+n[0](n[54].xDomainNumb)+","+n[54].zScore+")")},m(_,s){Ze(_,a,s),be(a,o)},p(_,s){s[0]&12296&&c!==(c=_[54].xDomainNumb==_[12]?4:_[54].xDomainNumb==_[3].maxXDomain?5:0)&&E(o,"r",c),s[0]&16384&&d!==(d=Xt[_[14]])&&E(o,"fill",d),s[0]&8193&&g!==(g="translate("+_[0](_[54].xDomainNumb)+","+_[54].zScore+")")&&E(a,"transform",g)},d(_){_&&q(a)}}}function jf(n){let a,o,c,d;return{c(){a=ct("g"),o=ct("circle"),this.h()},l(g){a=ut(g,"g",{transform:!0});var _=ve(a);o=ut(_,"circle",{r:!0,fill:!0,"stroke-width":!0,stroke:!0}),ve(o).forEach(q),_.forEach(q),this.h()},h(){E(o,"r",c=n[54].xDomainNumb==n[12]?4:n[54].xDomainNumb==n[3].maxXDomain?5:0),E(o,"fill",Xt.main),E(o,"stroke-width","1px"),E(o,"stroke","white"),E(a,"transform",d="translate("+n[0](n[54].xDomainNumb)+","+n[54].zScore+")")},m(g,_){Ze(g,a,_),be(a,o)},p(g,_){_[0]&4360&&c!==(c=g[54].xDomainNumb==g[12]?4:g[54].xDomainNumb==g[3].maxXDomain?5:0)&&E(o,"r",c),_[0]&257&&d!==(d="translate("+g[0](g[54].xDomainNumb)+","+g[54].zScore+")")&&E(a,"transform",d)},d(g){g&&q(a)}}}function Zf(n){let a,o,c,d,g,_,s,x;return{c(){a=ct("g"),o=ct("g"),c=ct("rect"),g=ct("text"),_=si(n[19]),this.h()},l(T){a=ut(T,"g",{class:!0,transform:!0});var k=ve(a);o=ut(k,"g",{});var A=ve(o);c=ut(A,"rect",{labelid:!0,transform:!0,x:!0,y:!0,width:!0,height:!0,rx:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(c).forEach(q),g=ut(A,"text",{labelid:!0,transform:!0,x:!0,y:!0,"text-anchor":!0,"stroke-width":!0,stroke:!0,fill:!0,"font-size":!0});var S=ve(g);_=oi(S,n[19]),S.forEach(q),A.forEach(q),k.forEach(q),this.h()},h(){E(c,"labelid",0),E(c,"transform","translate(0,0)"),E(c,"x","0"),E(c,"y","0"),E(c,"width",d=n[25].length>0?n[25][0].width+6:0),E(c,"height",22),E(c,"rx","3px"),E(c,"stroke",Xt.main),E(c,"fill","white"),E(c,"stroke-width","1.5px"),E(g,"labelid",0),E(g,"transform","translate(0,0)"),E(g,"x",3),E(g,"y",16),E(g,"text-anchor","start"),E(g,"stroke-width","0.25px"),E(g,"stroke",Xt.main),E(g,"fill",Xt.main),E(g,"font-size","16px"),E(a,"class","value-label-group"),E(a,"transform",x="translate("+(n[11]+20)+","+(n[8][n[8].length-1].zScore-11)+")")},m(T,k){Ze(T,a,k),be(a,o),be(o,c),be(o,g),be(g,_),s=ah.observe(g,n[47].bind(g))},p(T,k){k[0]&33554432&&d!==(d=T[25].length>0?T[25][0].width+6:0)&&E(c,"width",d),k[0]&524288&&Ci(_,T[19]),k[0]&2304&&x!==(x="translate("+(T[11]+20)+","+(T[8][T[8].length-1].zScore-11)+")")&&E(a,"transform",x)},d(T){T&&q(a),s()}}}function mv(n){let a,o=n[6].includes(0)&n[5]===0,c,d,g=o&&Ff(n),_=n[5]===0&&Of(n);return{c(){a=rt("div"),g&&g.c(),c=Ut(),_&&_.c(),this.h()},l(s){a=at(s,"DIV",{class:!0,style:!0});var x=ve(a);g&&g.l(x),c=qt(x),_&&_.l(x),x.forEach(q),this.h()},h(){E(a,"class","time-comparison-cell-container svelte-2j0wow"),E(a,"style",d=n[5]!=0|n[17]==null?null:"background-color:"+n[17]+"; box-shadow: 0 0 4px 3px "+n[17]+";")},m(s,x){Ze(s,a,x),g&&g.m(a,null),be(a,c),_&&_.m(a,null)},p(s,x){x[0]&96&&(o=s[6].includes(0)&s[5]===0),o?g?g.p(s,x):(g=Ff(s),g.c(),g.m(a,c)):g&&(g.d(1),g=null),s[5]===0?_?_.p(s,x):(_=Of(s),_.c(),_.m(a,null)):_&&(_.d(1),_=null),x[0]&131104&&d!==(d=s[5]!=0|s[17]==null?null:"background-color:"+s[17]+"; box-shadow: 0 0 4px 3px "+s[17]+";")&&E(a,"style",d)},i:Ei,o:Ei,d(s){s&&q(a),g&&g.d(),_&&_.d()}}}function gv(n,a,o){let c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge,se,je,ce,ee,ke,_e,me,Me,Re,he,Ee,{indicator:ft}=a,{rowNumb:nt,topicNumb:Fe}=a,{metadata:Se,calculations:de}=a,{col4Width:Qe}=a,{chosenId2:Je}=a,{chosenId3:yt}=a,{baselineComparisonArea:mt}=a,{visibleAreas:Xe}=a,{x:gt,xDomain:ze}=a,{chosenId11:Pe}=a,{chosenId6:Ve}=a,vt=mi("selectedAndRelatedAreas"),fi=de.calcs[de.maxXDomain].median,tt=de.calcs[de.maxXDomain].mad,lt=de.calcs[de.maxXDomain].main,li=[-Ac,Ac],ln=Pn.better,ei="Improved since 2012";function dn(){var $e;c[0]=($e=sh.entries.get(this))==null?void 0:$e.contentRect,o(25,c)}return n.$$set=$e=>{"indicator"in $e&&o(27,ft=$e.indicator),"rowNumb"in $e&&o(1,nt=$e.rowNumb),"topicNumb"in $e&&o(2,Fe=$e.topicNumb),"metadata"in $e&&o(28,Se=$e.metadata),"calculations"in $e&&o(3,de=$e.calculations),"col4Width"in $e&&o(4,Qe=$e.col4Width),"chosenId2"in $e&&o(29,Je=$e.chosenId2),"chosenId3"in $e&&o(5,yt=$e.chosenId3),"baselineComparisonArea"in $e&&o(30,mt=$e.baselineComparisonArea),"visibleAreas"in $e&&o(31,Xe=$e.visibleAreas),"x"in $e&&o(0,gt=$e.x),"xDomain"in $e&&o(32,ze=$e.xDomain),"chosenId11"in $e&&o(6,Pe=$e.chosenId11),"chosenId6"in $e&&o(7,Ve=$e.chosenId6)},n.$$.update=()=>{n.$$.dirty[0]&144&&o(11,d=Qe-(Ve.includes(0)?50:110)),n.$$.dirty[0]&98304&&o(10,s=g-_.top-_.bottom-Gt.areaSpaceBeyondXScale.split*2),n.$$.dirty[0]&536870920&&o(34,x=Je==="earliest available year"?de.mainMinXDomain:Je==="previous year"?de.maxXDomain-1:Je),n.$$.dirty[0]&8|n.$$.dirty[1]&8&&o(46,T=Array.from({length:de.maxXDomain-x+1},($e,ot)=>x+ot).map($e=>({xDomainNumb:$e,value:de.calcs[$e]==null?void 0:"main"in de.calcs[$e]?de.calcs[$e].main:void 0})).filter($e=>$e.value!=null&!isNaN($e.value))),n.$$.dirty[0]&1024&&o(33,Re=Oa().domain(li).range([s,0])),n.$$.dirty[0]&2080|n.$$.dirty[1]&32772&&o(8,k=T.map($e=>({...$e,zScore:Ec(Gt,yt,d,Re,$e.value,fi,tt)}))),n.$$.dirty[0]&256&&o(24,A=[...k.map($e=>({...$e,zScore:$e.zScore-10})),...k.reverse().map($e=>({...$e,zScore:$e.zScore+10}))]),n.$$.dirty[0]&1073741824&&o(14,S=(mt.areacd==="median"?mt:vt.find($e=>mt.areacd===$e.areacd)).role),n.$$.dirty[0]&16392|n.$$.dirty[1]&8&&o(45,V=Array.from({length:de.maxXDomain-x+1},($e,ot)=>x+ot).map($e=>({xDomainNumb:$e,value:de.calcs[$e]==null?void 0:S in de.calcs[$e]?de.calcs[$e][S]:void 0})).filter($e=>$e.value!=null&!isNaN($e.value))),n.$$.dirty[0]&2080|n.$$.dirty[1]&16388&&o(13,W=V.map($e=>({...$e,zScore:Ec(Gt,yt,d,Re,$e.value,fi,tt)}))),n.$$.dirty[0]&8192&&o(23,Z=[...W.map($e=>({...$e,zScore:$e.zScore-5})),...W.reverse().map($e=>({...$e,zScore:$e.zScore+5}))]),n.$$.dirty[0]&8|n.$$.dirty[1]&8&&o(9,Y=x in de.calcs?de.calcs[x].main:null),n.$$.dirty[0]&512&&o(38,H=lt==null|Y==null|tt==null?null:(lt-Y)/tt),n.$$.dirty[0]&64&&o(44,Q=Pe.includes(1)),n.$$.dirty[0]&268435456&&o(43,ae=Se.polarity==0?null:Se.polarity==-1?"better":"worse"),n.$$.dirty[0]&268435456&&o(42,ne=Se.polarity==0?null:"similar"),n.$$.dirty[0]&268435456&&o(41,ge=Se.polarity==0?null:Se.polarity==1?"better":"worse"),n.$$.dirty[0]&64&&o(37,se=Pe.includes(3)?2:1),n.$$.dirty[0]&268435464|n.$$.dirty[1]&15560&&o(17,ln=!Q|H==null|Se.polarity==0|x==de.maxXDomain?null:H<-se?Pn[ae]:H<=se?Pn[ne]:Pn[ge]),n.$$.dirty[0]&1073741824&&(mt.areacd==="median"||mt.areanm),n.$$.dirty[0]&64&&o(40,je=Pe.includes(2)),n.$$.dirty[0]&268435456|n.$$.dirty[1]&512&&o(39,ce=Se.polarity==0|!je?"Decreased":Se.polarity==-1?"Improved":"Worsened"),n.$$.dirty[0]&268435456|n.$$.dirty[1]&512&&o(35,ke=Se.polarity==0|!je?"Increased":Se.polarity==1?"Improved":"Worsened"),n.$$.dirty[0]&520|n.$$.dirty[1]&504&&o(18,ei=x==de.maxXDomain?"No historical data":lt==null?"No data in "+de.maxXDomain:Y==null?"No data in "+x:(H<-se?ce:H<=se?ee:ke)+" since "+x),n.$$.dirty[0]&8448&&o(12,_e=Math.min(...[...k,...W].map($e=>$e.xDomainNumb))),n.$$.dirty[0]&12544&&o(22,me=Math.max(...[...k,...W].filter($e=>$e.xDomainNumb==_e).map($e=>$e.zScore))),n.$$.dirty[0]&8456&&o(21,Me=Math.max(...[...k,...W].filter($e=>$e.xDomainNumb==de.maxXDomain).map($e=>$e.zScore))),n.$$.dirty[0]&6152&&o(0,gt=Oa().domain([_e,de.maxXDomain]).range([0,d])),n.$$.dirty[0]&1&&o(20,he=fh().curve(fm).y($e=>$e.zScore).x($e=>gt($e.xDomainNumb))),n.$$.dirty[0]&268435968&&o(19,Ee=["pp","abs"].includes(Se.howToMeasureChange)?(lt-Y>0?"+":"")+(Se.howToMeasureChange=="pp"?"":Se.prefix)+Fr(dr(lt-Y,Se.decimalPlaces))+(Se.howToMeasureChange=="pp"?" pp":""):(lt-Y>0?"+":"")+dr((lt-Y)/Y,1)+"%"),n.$$.dirty[0]&256&&(k.length>1?Math.abs(k[k.length-1].zScore-k[0].zScore)/2+Math.min(k[k.length-1].zScore,k[0].zScore):k[0].zScore)},o(25,c=[]),o(16,g=80),o(15,_={top:5,left:25,right:0,bottom:25}),o(36,ee="Little change"),[gt,nt,Fe,de,Qe,yt,Pe,Ve,k,Y,s,d,_e,W,S,_,g,ln,ei,Ee,he,Me,me,Z,A,c,lt,ft,Se,Je,mt,Xe,ze,Re,x,ke,ee,se,H,ce,je,ge,ne,ae,Q,V,T,dn]}class _v extends vi{constructor(a){super(),bi(this,a,gv,mv,xi,{indicator:27,rowNumb:1,topicNumb:2,metadata:28,calculations:3,col4Width:4,chosenId2:29,chosenId3:5,baselineComparisonArea:30,visibleAreas:31,x:0,xDomain:32,chosenId11:6,chosenId6:7},null,[-1,-1])}}function Xf(n){let a,o,c,d=(n[22].includes(5)?n[6].originalTitle:n[5].label)+"",g,_,s,x,T,k,A,S,V,W,Z;_=new pv({});function Y(ge,se){return se&4194304&&(x=null),x==null&&(x=!!ge[22].includes(5)),x?vv:yv}let H=Y(n,-1),Q=H(n),ae=n[13]!=2&&Wf(n),ne=n[13]!=1&&Hf(n);return{c(){a=rt("div"),o=rt("p"),c=rt("a"),g=si(d),Yt(_.$$.fragment),s=Ut(),Q.c(),T=Ut(),k=rt("div"),ae&&ae.c(),A=Ut(),S=rt("div"),V=Ut(),W=rt("div"),ne&&ne.c(),this.h()},l(ge){a=at(ge,"DIV",{class:!0});var se=ve(a);o=at(se,"P",{class:!0});var je=ve(o);c=at(je,"A",{href:!0});var ce=ve(c);g=oi(ce,d),ce.forEach(q),Jt(_.$$.fragment,je),je.forEach(q),s=qt(se),Q.l(se),se.forEach(q),T=qt(ge),k=at(ge,"DIV",{class:!0});var ee=ve(k);ae&&ae.l(ee),ee.forEach(q),A=qt(ge),S=at(ge,"DIV",{class:!0}),ve(S).forEach(q),V=qt(ge),W=at(ge,"DIV",{class:!0});var ke=ve(W);ne&&ne.l(ke),ke.forEach(q),this.h()},h(){E(c,"href","https://www.ons.gov.uk/"),E(o,"class","indicator-label svelte-ghjv81"),E(a,"class","col1 svelte-ghjv81"),E(k,"class","col2 svelte-ghjv81"),E(S,"class","col3"),E(W,"class","col4 svelte-ghjv81")},m(ge,se){Ze(ge,a,se),be(a,o),be(o,c),be(c,g),Qt(_,o,null),be(a,s),Q.m(a,null),Ze(ge,T,se),Ze(ge,k,se),ae&&ae.m(k,null),Ze(ge,A,se),Ze(ge,S,se),Ze(ge,V,se),Ze(ge,W,se),ne&&ne.m(W,null),Z=!0},p(ge,se){(!Z||se&4194400)&&d!==(d=(ge[22].includes(5)?ge[6].originalTitle:ge[5].label)+"")&&Ci(g,d),H===(H=Y(ge,se))&&Q?Q.p(ge,se):(Q.d(1),Q=H(ge),Q&&(Q.c(),Q.m(a,null))),ge[13]!=2?ae?(ae.p(ge,se),se&8192&&Ye(ae,1)):(ae=Wf(ge),ae.c(),Ye(ae,1),ae.m(k,null)):ae&&(Yi(),ht(ae,1,1,()=>{ae=null}),Ji()),ge[13]!=1?ne?(ne.p(ge,se),se&8192&&Ye(ne,1)):(ne=Hf(ge),ne.c(),Ye(ne,1),ne.m(W,null)):ne&&(Yi(),ht(ne,1,1,()=>{ne=null}),Ji())},i(ge){Z||(Ye(_.$$.fragment,ge),Ye(ae),Ye(ne),Z=!0)},o(ge){ht(_.$$.fragment,ge),ht(ae),ht(ne),Z=!1},d(ge){ge&&q(a),$t(_),Q.d(),ge&&q(T),ge&&q(k),ae&&ae.d(),ge&&q(A),ge&&q(S),ge&&q(V),ge&&q(W),ne&&ne.d()}}}function yv(n){let a,o=n[6].subtitle+"",c,d=n[13]===1?" in "+n[7].maxXDomain:"",g;return{c(){a=rt("p"),c=si(o),g=si(d),this.h()},l(_){a=at(_,"P",{class:!0});var s=ve(a);c=oi(s,o),g=oi(s,d),s.forEach(q),this.h()},h(){E(a,"class","indicator-detail svelte-ghjv81")},m(_,s){Ze(_,a,s),be(a,c),be(a,g)},p(_,s){s&64&&o!==(o=_[6].subtitle+"")&&Ci(c,o),s&8320&&d!==(d=_[13]===1?" in "+_[7].maxXDomain:"")&&Ci(g,d)},d(_){_&&q(a)}}}function vv(n){let a,o=n[6].originalSubtitle+"",c;return{c(){a=rt("p"),c=si(o),this.h()},l(d){a=at(d,"P",{class:!0});var g=ve(a);c=oi(g,o),g.forEach(q),this.h()},h(){E(a,"class","indicator-detail svelte-ghjv81")},m(d,g){Ze(d,a,g),be(a,c)},p(d,g){g&64&&o!==(o=d[6].originalSubtitle+"")&&Ci(c,o)},d(d){d&&q(a)}}}function Wf(n){let a,o,c,d,g;function _(k){n[25](k)}function s(k){n[26](k)}function x(k){n[27](k)}let T={indicator:n[5],rowNumb:n[3],topicNumb:n[4],metadata:n[6],calculations:n[7],col2Width:n[9],chosenId3:n[13],baselineComparisonArea:n[15],visibleAreas:n[14],scaleHeight:n[16],scaleWidth:n[17],x:n[20],xDomain:n[19],y:n[21],chosenId11:n[22],chosenId6:n[23]};return n[0]!==void 0&&(T.yDomainGlobal=n[0]),n[1]!==void 0&&(T.hoverIndex=n[1]),n[2]!==void 0&&(T.hoverChartIndex=n[2]),a=new s1({props:T}),Mt.push(()=>Pt(a,"yDomainGlobal",_)),Mt.push(()=>Pt(a,"hoverIndex",s)),Mt.push(()=>Pt(a,"hoverChartIndex",x)),{c(){Yt(a.$$.fragment)},l(k){Jt(a.$$.fragment,k)},m(k,A){Qt(a,k,A),g=!0},p(k,A){const S={};A&32&&(S.indicator=k[5]),A&8&&(S.rowNumb=k[3]),A&16&&(S.topicNumb=k[4]),A&64&&(S.metadata=k[6]),A&128&&(S.calculations=k[7]),A&512&&(S.col2Width=k[9]),A&8192&&(S.chosenId3=k[13]),A&32768&&(S.baselineComparisonArea=k[15]),A&16384&&(S.visibleAreas=k[14]),A&65536&&(S.scaleHeight=k[16]),A&131072&&(S.scaleWidth=k[17]),A&1048576&&(S.x=k[20]),A&524288&&(S.xDomain=k[19]),A&2097152&&(S.y=k[21]),A&4194304&&(S.chosenId11=k[22]),A&8388608&&(S.chosenId6=k[23]),!o&&A&1&&(o=!0,S.yDomainGlobal=k[0],Lt(()=>o=!1)),!c&&A&2&&(c=!0,S.hoverIndex=k[1],Lt(()=>c=!1)),!d&&A&4&&(d=!0,S.hoverChartIndex=k[2],Lt(()=>d=!1)),a.$set(S)},i(k){g||(Ye(a.$$.fragment,k),g=!0)},o(k){ht(a.$$.fragment,k),g=!1},d(k){$t(a,k)}}}function Hf(n){let a,o,c,d,g;const _=[xv,bv],s=[];function x(T,k){return k&4194304&&(a=null),a==null&&(a=!!T[22].includes(4)),a?0:1}return o=x(n,-1),c=s[o]=_[o](n),{c(){c.c(),d=Bi()},l(T){c.l(T),d=Bi()},m(T,k){s[o].m(T,k),Ze(T,d,k),g=!0},p(T,k){let A=o;o=x(T,k),o===A?s[o].p(T,k):(Yi(),ht(s[A],1,1,()=>{s[A]=null}),Ji(),c=s[o],c?c.p(T,k):(c=s[o]=_[o](T),c.c()),Ye(c,1),c.m(d.parentNode,d))},i(T){g||(Ye(c),g=!0)},o(T){ht(c),g=!1},d(T){s[o].d(T),T&&q(d)}}}function bv(n){let a,o;return a=new dv({props:{indicator:n[5],rowNumb:n[3],topicNumb:n[4],metadata:n[6],calculations:n[7],col4Width:n[11],chosenId2:n[12],chosenId3:n[13],baselineComparisonArea:n[15],visibleAreas:n[14],scaleHeight:n[16],scaleWidth:n[18],x:n[20],xDomain:n[19],chosenId11:n[22],chosenId6:n[23]}}),{c(){Yt(a.$$.fragment)},l(c){Jt(a.$$.fragment,c)},m(c,d){Qt(a,c,d),o=!0},p(c,d){const g={};d&32&&(g.indicator=c[5]),d&8&&(g.rowNumb=c[3]),d&16&&(g.topicNumb=c[4]),d&64&&(g.metadata=c[6]),d&128&&(g.calculations=c[7]),d&2048&&(g.col4Width=c[11]),d&4096&&(g.chosenId2=c[12]),d&8192&&(g.chosenId3=c[13]),d&32768&&(g.baselineComparisonArea=c[15]),d&16384&&(g.visibleAreas=c[14]),d&65536&&(g.scaleHeight=c[16]),d&262144&&(g.scaleWidth=c[18]),d&1048576&&(g.x=c[20]),d&524288&&(g.xDomain=c[19]),d&4194304&&(g.chosenId11=c[22]),d&8388608&&(g.chosenId6=c[23]),a.$set(g)},i(c){o||(Ye(a.$$.fragment,c),o=!0)},o(c){ht(a.$$.fragment,c),o=!1},d(c){$t(a,c)}}}function xv(n){let a,o;return a=new _v({props:{indicator:n[5],rowNumb:n[3],topicNumb:n[4],metadata:n[6],calculations:n[7],col4Width:n[11],chosenId2:n[12],chosenId3:n[13],baselineComparisonArea:n[15],visibleAreas:n[14],scaleHeight:n[16],scaleWidth:n[18],x:n[20],xDomain:n[19],chosenId11:n[22],chosenId6:n[23]}}),{c(){Yt(a.$$.fragment)},l(c){Jt(a.$$.fragment,c)},m(c,d){Qt(a,c,d),o=!0},p(c,d){const g={};d&32&&(g.indicator=c[5]),d&8&&(g.rowNumb=c[3]),d&16&&(g.topicNumb=c[4]),d&64&&(g.metadata=c[6]),d&128&&(g.calculations=c[7]),d&2048&&(g.col4Width=c[11]),d&4096&&(g.chosenId2=c[12]),d&8192&&(g.chosenId3=c[13]),d&32768&&(g.baselineComparisonArea=c[15]),d&16384&&(g.visibleAreas=c[14]),d&65536&&(g.scaleHeight=c[16]),d&262144&&(g.scaleWidth=c[18]),d&1048576&&(g.x=c[20]),d&524288&&(g.xDomain=c[19]),d&4194304&&(g.chosenId11=c[22]),d&8388608&&(g.chosenId6=c[23]),a.$set(g)},i(c){o||(Ye(a.$$.fragment,c),o=!0)},o(c){ht(a.$$.fragment,c),o=!1},d(c){$t(a,c)}}}function wv(n){let a,o,c,d=n[24]&&Xf(n);return{c(){a=rt("div"),o=rt("div"),d&&d.c(),this.h()},l(g){a=at(g,"DIV",{class:!0,style:!0});var _=ve(a);o=at(_,"DIV",{class:!0,style:!0});var s=ve(o);d&&d.l(s),s.forEach(q),_.forEach(q),this.h()},h(){E(o,"class","row-content-container svelte-ghjv81"),ni(o,"grid-template-columns","[line1] "+n[8]+"px [line2] "+n[9]+"px [line3] "+n[10]+"px [line4] "+n[11]+"px [end]"),E(a,"class","row-container svelte-ghjv81"),ni(a,"background-color",n[3]%2===0?"#fafafa":"#ffffff")},m(g,_){Ze(g,a,_),be(a,o),d&&d.m(o,null),c=!0},p(g,[_]){g[24]?d?(d.p(g,_),_&16777216&&Ye(d,1)):(d=Xf(g),d.c(),Ye(d,1),d.m(o,null)):d&&(Yi(),ht(d,1,1,()=>{d=null}),Ji()),(!c||_&3840)&&ni(o,"grid-template-columns","[line1] "+g[8]+"px [line2] "+g[9]+"px [line3] "+g[10]+"px [line4] "+g[11]+"px [end]"),(!c||_&8)&&ni(a,"background-color",g[3]%2===0?"#fafafa":"#ffffff")},i(g){c||(Ye(d),c=!0)},o(g){ht(d),c=!1},d(g){g&&q(a),d&&d.d()}}}function Iv(n,a,o){let{rowNumb:c,topicNumb:d}=a,{indicator:g}=a,{metadata:_,calculations:s}=a,{col1Width:x,col2Width:T,col3Width:k,col4Width:A}=a,{chosenId2:S}=a,{chosenId3:V}=a,{visibleAreas:W}=a,{baselineComparisonArea:Z}=a,{scaleHeight:Y,scaleWidthArea:H,scaleWidthTime:Q}=a,{xDomain:ae,x:ne,yDomainGlobal:ge,y:se}=a,{hoverIndex:je,hoverChartIndex:ce}=a,{chosenId11:ee}=a,{chosenId6:ke}=a,_e=!1;hl(()=>{o(24,_e=!0)});function me(he){ge=he,o(0,ge)}function Me(he){je=he,o(1,je)}function Re(he){ce=he,o(2,ce)}return n.$$set=he=>{"rowNumb"in he&&o(3,c=he.rowNumb),"topicNumb"in he&&o(4,d=he.topicNumb),"indicator"in he&&o(5,g=he.indicator),"metadata"in he&&o(6,_=he.metadata),"calculations"in he&&o(7,s=he.calculations),"col1Width"in he&&o(8,x=he.col1Width),"col2Width"in he&&o(9,T=he.col2Width),"col3Width"in he&&o(10,k=he.col3Width),"col4Width"in he&&o(11,A=he.col4Width),"chosenId2"in he&&o(12,S=he.chosenId2),"chosenId3"in he&&o(13,V=he.chosenId3),"visibleAreas"in he&&o(14,W=he.visibleAreas),"baselineComparisonArea"in he&&o(15,Z=he.baselineComparisonArea),"scaleHeight"in he&&o(16,Y=he.scaleHeight),"scaleWidthArea"in he&&o(17,H=he.scaleWidthArea),"scaleWidthTime"in he&&o(18,Q=he.scaleWidthTime),"xDomain"in he&&o(19,ae=he.xDomain),"x"in he&&o(20,ne=he.x),"yDomainGlobal"in he&&o(0,ge=he.yDomainGlobal),"y"in he&&o(21,se=he.y),"hoverIndex"in he&&o(1,je=he.hoverIndex),"hoverChartIndex"in he&&o(2,ce=he.hoverChartIndex),"chosenId11"in he&&o(22,ee=he.chosenId11),"chosenId6"in he&&o(23,ke=he.chosenId6)},[ge,je,ce,c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,se,ee,ke,_e,me,Me,Re]}class kv extends vi{constructor(a){super(),bi(this,a,Iv,wv,xi,{rowNumb:3,topicNumb:4,indicator:5,metadata:6,calculations:7,col1Width:8,col2Width:9,col3Width:10,col4Width:11,chosenId2:12,chosenId3:13,visibleAreas:14,baselineComparisonArea:15,scaleHeight:16,scaleWidthArea:17,scaleWidthTime:18,xDomain:19,x:20,yDomainGlobal:0,y:21,hoverIndex:1,hoverChartIndex:2,chosenId11:22,chosenId6:23})}}function Tv(n){let a,o,c;return{c(){a=rt("div"),o=rt("img"),this.h()},l(d){a=at(d,"DIV",{class:!0});var g=ve(a);o=at(g,"IMG",{style:!0,width:!0,src:!0,alt:!0}),g.forEach(q),this.h()},h(){ni(o,"padding-top","10px"),E(o,"width","80%"),w_(o.src,c=`${to}/img/shareOptionsPlaceholder.png`)||E(o,"src",c),E(o,"alt","download buttons"),E(a,"class","svelte-1yu9en2")},m(d,g){Ze(d,a,g),be(a,o)},p:Ei,i:Ei,o:Ei,d(d){d&&q(a)}}}class pm extends vi{constructor(a){super(),bi(this,a,null,Tv,xi,{})}}function Kf(n,a,o){const c=n.slice();return c[6]=a[o],c[8]=o,c}function Yf(n){let a,o=n[6]+"",c,d;return{c(){a=rt("option"),c=si(o),this.h()},l(g){a=at(g,"OPTION",{});var _=ve(a);c=oi(_,o),_.forEach(q),this.h()},h(){a.__value=d=n[6],a.value=a.__value},m(g,_){Ze(g,a,_),be(a,c)},p(g,_){_&4&&o!==(o=g[6]+"")&&Ci(c,o),_&4&&d!==(d=g[6])&&(a.__value=d,a.value=a.__value)},d(g){g&&q(a)}}}function Ev(n){let a,o,c,d,g,_=n[2],s=[];for(let x=0;x<_.length;x+=1)s[x]=Yf(Kf(n,_,x));return{c(){a=rt("div"),o=rt("select");for(let x=0;x<s.length;x+=1)s[x].c();this.h()},l(x){a=at(x,"DIV",{class:!0,style:!0});var T=ve(a);o=at(T,"SELECT",{style:!0,id:!0,name:!0,class:!0});var k=ve(o);for(let A=0;A<s.length;A+=1)s[A].l(k);k.forEach(q),T.forEach(q),this.h()},h(){ni(o,"text-wrap","balance"),E(o,"id",n[1]),E(o,"name",n[1]),E(o,"class",c=Od("ons-input ons-input--select"+(n[4]?" low-height":""))+" svelte-9zngwk"),n[0]===void 0&&dl(()=>n[5].call(o)),E(a,"class","ons-field"),ni(a,"width",n[3])},m(x,T){Ze(x,a,T),be(a,o);for(let k=0;k<s.length;k+=1)s[k]&&s[k].m(o,null);Vd(o,n[0],!0),d||(g=br(o,"change",n[5]),d=!0)},p(x,[T]){if(T&4){_=x[2];let k;for(k=0;k<_.length;k+=1){const A=Kf(x,_,k);s[k]?s[k].p(A,T):(s[k]=Yf(A),s[k].c(),s[k].m(o,null))}for(;k<s.length;k+=1)s[k].d(1);s.length=_.length}T&2&&E(o,"id",x[1]),T&2&&E(o,"name",x[1]),T&16&&c!==(c=Od("ons-input ons-input--select"+(x[4]?" low-height":""))+" svelte-9zngwk")&&E(o,"class",c),T&5&&Vd(o,x[0]),T&8&&ni(a,"width",x[3])},i:Ei,o:Ei,d(x){x&&q(a),Qi(s,x),d=!1,g()}}}function Av(n,a,o){let{chosenId:c,name:d="",optionsArray:g,width:_=null,lowHeight:s=!1}=a;function x(){c=I_(this),o(0,c),o(2,g)}return n.$$set=T=>{"chosenId"in T&&o(0,c=T.chosenId),"name"in T&&o(1,d=T.name),"optionsArray"in T&&o(2,g=T.optionsArray),"width"in T&&o(3,_=T.width),"lowHeight"in T&&o(4,s=T.lowHeight)},[c,d,g,_,s,x]}class ph extends vi{constructor(a){super(),bi(this,a,Av,Ev,xi,{chosenId:0,name:1,optionsArray:2,width:3,lowHeight:4})}}function Sv(n){let a,o,c,d,g,_,s;function x(k){n[5](k)}let T={name:n[2],width:Math.min(n[4]-20,n[0].toString().length*20)+"px",optionsArray:n[1],lowHeight:!0};return n[0]!==void 0&&(T.chosenId=n[0]),g=new ph({props:T}),Mt.push(()=>Pt(g,"chosenId",x)),{c(){a=rt("div"),o=rt("p"),c=Ut(),d=rt("div"),Yt(g.$$.fragment),this.h()},l(k){a=at(k,"DIV",{class:!0});var A=ve(a);o=at(A,"P",{class:!0});var S=ve(o);S.forEach(q),c=qt(A),d=at(A,"DIV",{class:!0});var V=ve(d);Jt(g.$$.fragment,V),V.forEach(q),A.forEach(q),this.h()},h(){E(o,"class","svelte-1dn4t0j"),E(d,"class","dropdown-container svelte-1dn4t0j"),E(a,"class","paragraph-container svelte-1dn4t0j")},m(k,A){Ze(k,a,A),be(a,o),o.innerHTML=n[3],be(a,c),be(a,d),Qt(g,d,null),s=!0},p(k,[A]){(!s||A&8)&&(o.innerHTML=k[3]);const S={};A&4&&(S.name=k[2]),A&17&&(S.width=Math.min(k[4]-20,k[0].toString().length*20)+"px"),A&2&&(S.optionsArray=k[1]),!_&&A&1&&(_=!0,S.chosenId=k[0],Lt(()=>_=!1)),g.$set(S)},i(k){s||(Ye(g.$$.fragment,k),s=!0)},o(k){ht(g.$$.fragment,k),s=!1},d(k){k&&q(a),$t(g)}}}function Cv(n,a,o){mi("selectedArea");let{chosenId:c,optionsArray:d,name:g,text:_,width:s}=a;function x(T){c=T,o(0,c)}return n.$$set=T=>{"chosenId"in T&&o(0,c=T.chosenId),"optionsArray"in T&&o(1,d=T.optionsArray),"name"in T&&o(2,g=T.name),"text"in T&&o(3,_=T.text),"width"in T&&o(4,s=T.width)},[c,d,g,_,s,x]}class Jf extends vi{constructor(a){super(),bi(this,a,Cv,Sv,xi,{chosenId:0,optionsArray:1,name:2,text:3,width:4})}}function Mv(n){let a,o;return{c(){a=ct("path"),this.h()},l(c){a=ut(c,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(a).forEach(q),this.h()},h(){E(a,"d","M5 0 L15 10 L5 20"),E(a,"stroke",o=n[1]?"#222":"#206095"),E(a,"fill","none"),E(a,"stroke-width","3px")},m(c,d){Ze(c,a,d)},p(c,d){d&2&&o!==(o=c[1]?"#222":"#206095")&&E(a,"stroke",o)},d(c){c&&q(a)}}}function zv(n){let a;return{c(){a=ct("path"),this.h()},l(o){a=ut(o,"path",{d:!0,stroke:!0,fill:!0,"stroke-width":!0}),ve(a).forEach(q),this.h()},h(){E(a,"d","M0 5 L10 15 L20 5"),E(a,"stroke","#222"),E(a,"fill","none"),E(a,"stroke-width","3px")},m(o,c){Ze(o,a,c)},p:Ei,d(o){o&&q(a)}}}function Dv(n){let a,o;function c(_,s){return _[0]?zv:Mv}let d=c(n),g=d(n);return{c(){a=rt("div"),o=ct("svg"),g.c(),this.h()},l(_){a=at(_,"DIV",{class:!0});var s=ve(a);o=ut(s,"svg",{width:!0,height:!0,viewBox:!0,class:!0});var x=ve(o);g.l(x),x.forEach(q),s.forEach(q),this.h()},h(){E(o,"width","20"),E(o,"height","20"),E(o,"viewBox","0 0 20 20"),E(o,"class","svelte-13774mx"),E(a,"class","infoCell svelte-13774mx")},m(_,s){Ze(_,a,s),be(a,o),g.m(o,null)},p(_,[s]){d===(d=c(_))&&g?g.p(_,s):(g.d(1),g=d(_),g&&(g.c(),g.m(o,null)))},i:Ei,o:Ei,d(_){_&&q(a),g.d()}}}function Pv(n,a,o){let{twistyOpen:c,hover:d}=a;return n.$$set=g=>{"twistyOpen"in g&&o(0,c=g.twistyOpen),"hover"in g&&o(1,d=g.hover)},[c,d]}class Lv extends vi{constructor(a){super(),bi(this,a,Pv,Dv,xi,{twistyOpen:0,hover:1})}}function Bv(n){let a,o,c,d,g,_,s,x,T;function k(H){n[39](H)}function A(H){n[40](H)}function S(H){n[41](H)}function V(H){n[42](H)}function W(H){n[43](H)}function Z(H){n[44](H)}let Y={id:n[2],container:n[3],items:n[4],placeholder:n[5],isMulti:n[10],isSearchable:n[6],groupBy:n[22],loadOptions:n[9],getSelectionLabel:n[12],getOptionLabel:n[21],itemFilter:n[19],ariaValues:n[25],ariaListOpen:n[26],ariaFocused:n[27],noOptionsMessage:n[20],indicatorSvg:n[23],containerStyles:n[24],optionIdentifier:n[8],showIndicator:!0,isClearable:n[7]?!n[10]:!1};return n[15]!==void 0&&(Y.isFocused=n[15]),n[0]!==void 0&&(Y.value=n[0]),n[16]!==void 0&&(Y.listOpen=n[16]),n[1]!==void 0&&(Y.filterText=n[1]),n[13]!==void 0&&(Y.isWaiting=n[13]),n[17]!==void 0&&(Y.handleClear=n[17]),o=new R_({props:Y}),Mt.push(()=>Pt(o,"isFocused",k)),Mt.push(()=>Pt(o,"value",A)),Mt.push(()=>Pt(o,"listOpen",S)),Mt.push(()=>Pt(o,"filterText",V)),Mt.push(()=>Pt(o,"isWaiting",W)),Mt.push(()=>Pt(o,"handleClear",Z)),o.$on("select",n[28]),o.$on("clear",n[45]),o.$on("loaded",n[46]),o.$on("error",n[47]),{c(){a=rt("div"),Yt(o.$$.fragment),this.h()},l(H){a=at(H,"DIV",{class:!0});var Q=ve(a);Jt(o.$$.fragment,Q),Q.forEach(q),this.h()},h(){E(a,"class","selectbox svelte-gskmgd"),Hs(a,"multi-selected",n[0]&&n[10]),Hs(a,"focused",n[15]),Hs(a,"selected",n[0]&&!n[16]&&!n[10]),ni(a,"--borderColor",n[11]),ni(a,"--firstItem",n[18](0)),ni(a,"--secondItem",n[18](1)),ni(a,"--thirdItem",n[18](2)),ni(a,"--fourthItem",n[18](3)),ni(a,"--fifthItem",n[18](4)),ni(a,"--sixthItem",n[18](5)),ni(a,"--seventhItem",n[18](6)),ni(a,"--eighthItem",n[18](7)),ni(a,"--ninethItem",n[18](8)),ni(a,"--tenthItem",n[18](9))},m(H,Q){Ze(H,a,Q),Qt(o,a,null),n[48](a),T=!0},p(H,Q){const ae={};Q[0]&4&&(ae.id=H[2]),Q[0]&8&&(ae.container=H[3]),Q[0]&16&&(ae.items=H[4]),Q[0]&32&&(ae.placeholder=H[5]),Q[0]&1024&&(ae.isMulti=H[10]),Q[0]&64&&(ae.isSearchable=H[6]),Q[0]&512&&(ae.loadOptions=H[9]),Q[0]&4096&&(ae.getSelectionLabel=H[12]),Q[0]&524288&&(ae.itemFilter=H[19]),Q[0]&1048576&&(ae.noOptionsMessage=H[20]),Q[0]&256&&(ae.optionIdentifier=H[8]),Q[0]&1152&&(ae.isClearable=H[7]?!H[10]:!1),!c&&Q[0]&32768&&(c=!0,ae.isFocused=H[15],Lt(()=>c=!1)),!d&&Q[0]&1&&(d=!0,ae.value=H[0],Lt(()=>d=!1)),!g&&Q[0]&65536&&(g=!0,ae.listOpen=H[16],Lt(()=>g=!1)),!_&&Q[0]&2&&(_=!0,ae.filterText=H[1],Lt(()=>_=!1)),!s&&Q[0]&8192&&(s=!0,ae.isWaiting=H[13],Lt(()=>s=!1)),!x&&Q[0]&131072&&(x=!0,ae.handleClear=H[17],Lt(()=>x=!1)),o.$set(ae),(!T||Q[0]&1025)&&Hs(a,"multi-selected",H[0]&&H[10]),(!T||Q[0]&32768)&&Hs(a,"focused",H[15]),(!T||Q[0]&66561)&&Hs(a,"selected",H[0]&&!H[16]&&!H[10]),Q[0]&2048&&ni(a,"--borderColor",H[11]),Q[0]&262144&&ni(a,"--firstItem",H[18](0)),Q[0]&262144&&ni(a,"--secondItem",H[18](1)),Q[0]&262144&&ni(a,"--thirdItem",H[18](2)),Q[0]&262144&&ni(a,"--fourthItem",H[18](3)),Q[0]&262144&&ni(a,"--fifthItem",H[18](4)),Q[0]&262144&&ni(a,"--sixthItem",H[18](5)),Q[0]&262144&&ni(a,"--seventhItem",H[18](6)),Q[0]&262144&&ni(a,"--eighthItem",H[18](7)),Q[0]&262144&&ni(a,"--ninethItem",H[18](8)),Q[0]&262144&&ni(a,"--tenthItem",H[18](9))},i(H){T||(Ye(o.$$.fragment,H),T=!0)},o(H){ht(o.$$.fragment,H),T=!1},d(H){H&&q(a),$t(o),n[48](null)}}}function Rv(n,a,o){let c,d,g;const _='<svg viewBox="0 0 20 20" fill-rule="evenodd"><path d="M0,8a8,8,0,1,0,16,0a8,8,0,1,0,-16,0ZM3,8a5,5,0,1,0,10,0a5,5,0,1,0,-10,0Z"/><path d="M18,20L20,18L14,12L12,14Z"/></svg>',s='<svg viewBox="0 0 20 20"><path d="M1,6L19,6L10,15Z"/></svg>',x=oh();let{id:T=""}=a,{container:k=void 0}=a,{mode:A="default"}=a,{items:S}=a,{placeholder:V="Select one..."}=a,{value:W=null}=a,{filterText:Z=""}=a,{isSearchable:Y=!0}=a,{isClearable:H=!0}=a,{autoClear:Q=!1}=a,{idKey:ae="value"}=a,{labelKey:ne="label"}=a,{groupKey:ge=null}=a,{groupItems:se=!1}=a,{loadOptions:je=void 0}=a,{fontSize:ce="1em"}=a,{height:ee=42}=a,{isMulti:ke=!1}=a,{maxSelected:_e=4}=a,{colors:me=["#206095","#a8bd3a","#871a5b","#27a0cc"]}=a,{darkMode:Me=!1}=a,{borderColor:Re=Me?"white":"#206095"}=a;const he=ge&&!se?ot=>`${ot[ne]} <span class="group">${ot[ge]}</span>`:ot=>ot[ne];let{getSelectionLabel:Ee=ot=>ot?he(ot):null}=a;const ft=se&&ge?ot=>ot[ge]:void 0,nt=A=="search"?_:s,Fe=`--inputFontSize: ${ce}; --groupTitleFontSize: ${ce}; --height: ${ee}px; font-size: ${ce};`,Se=ot=>`${ot}, selected.`,de=(ot,tn)=>`You are currently focused on ${ot}. There are ${tn} results available.`,Qe=()=>"Select is focused, type to refine list, press down to open the menu.";let Je,yt,mt,Xe,gt;const ze=ot=>new Promise(tn=>setTimeout(tn,ot));async function Pe(ot){if(x("select",ot.detail),Q)gt();else if(H){await ze(10);let tn=Je.getElementsByClassName("clearSelect")[0];tn&&(tn.tabIndex=0,tn.onkeypress=Vn=>{Vn.key=="Enter"&&gt()},tn.removeAttribute("aria-hidden"),tn.setAttribute("aria-label","Clear selection"))}}function Ve(ot){yt=ot,o(15,yt)}function vt(ot){W=ot,o(0,W)}function fi(ot){mt=ot,o(16,mt)}function tt(ot){Z=ot,o(1,Z)}function lt(ot){Xe=ot,o(13,Xe)}function li(ot){gt=ot,o(17,gt)}function ln(ot){rl.call(this,n,ot)}function ei(ot){rl.call(this,n,ot)}function dn(ot){rl.call(this,n,ot)}function $e(ot){Mt[ot?"unshift":"push"](()=>{Je=ot,o(14,Je)})}return n.$$set=ot=>{"id"in ot&&o(2,T=ot.id),"container"in ot&&o(3,k=ot.container),"mode"in ot&&o(29,A=ot.mode),"items"in ot&&o(4,S=ot.items),"placeholder"in ot&&o(5,V=ot.placeholder),"value"in ot&&o(0,W=ot.value),"filterText"in ot&&o(1,Z=ot.filterText),"isSearchable"in ot&&o(6,Y=ot.isSearchable),"isClearable"in ot&&o(7,H=ot.isClearable),"autoClear"in ot&&o(30,Q=ot.autoClear),"idKey"in ot&&o(8,ae=ot.idKey),"labelKey"in ot&&o(31,ne=ot.labelKey),"groupKey"in ot&&o(32,ge=ot.groupKey),"groupItems"in ot&&o(33,se=ot.groupItems),"loadOptions"in ot&&o(9,je=ot.loadOptions),"fontSize"in ot&&o(34,ce=ot.fontSize),"height"in ot&&o(35,ee=ot.height),"isMulti"in ot&&o(10,ke=ot.isMulti),"maxSelected"in ot&&o(36,_e=ot.maxSelected),"colors"in ot&&o(37,me=ot.colors),"darkMode"in ot&&o(38,Me=ot.darkMode),"borderColor"in ot&&o(11,Re=ot.borderColor),"getSelectionLabel"in ot&&o(12,Ee=ot.getSelectionLabel)},n.$$.update=()=>{n.$$.dirty[0]&536879106&&o(20,c=Xe?"Loading...":A=="search"&&Z.length<3?"Enter 3 or more characters for suggestions":`No results match ${Z}`),n.$$.dirty[0]&536870915|n.$$.dirty[1]&33&&o(19,d=Array.isArray(W)&&W.length>=_e||A=="search"&&Z.length<3?(ot,tn,Vn)=>!1:(ot,tn,Vn)=>`${Vn[ne]}`.match(new RegExp(`\\b${tn}`,"i"))),n.$$.dirty[1]&64&&o(18,g=ot=>me[ot%me.length])},[W,Z,T,k,S,V,Y,H,ae,je,ke,Re,Ee,Xe,Je,yt,mt,gt,g,d,c,he,ft,nt,Fe,Se,de,Qe,Pe,A,Q,ne,ge,se,ce,ee,_e,me,Me,Ve,vt,fi,tt,lt,li,ln,ei,dn,$e]}class Fv extends vi{constructor(a){super(),bi(this,a,Rv,Bv,xi,{id:2,container:3,mode:29,items:4,placeholder:5,value:0,filterText:1,isSearchable:6,isClearable:7,autoClear:30,idKey:8,labelKey:31,groupKey:32,groupItems:33,loadOptions:9,fontSize:34,height:35,isMulti:10,maxSelected:36,colors:37,darkMode:38,borderColor:11,getSelectionLabel:12},null,[-1,-1])}}function Ov(n){let a,o,c,d;function g(s){n[3](s)}let _={id:"multi",idKey:"areacd",labelKey:"areanm",groupKey:"parentnm",items:n[1],isMulti:!0,maxSelected:4,placeholder:"Add additional comparison areas"};return n[0].custom!==void 0&&(_.value=n[0].custom),o=new Fv({props:_}),Mt.push(()=>Pt(o,"value",g)),o.$on("select",n[2]),{c(){a=rt("form"),Yt(o.$$.fragment),this.h()},l(s){a=at(s,"FORM",{class:!0});var x=ve(a);Jt(o.$$.fragment,x),x.forEach(q),this.h()},h(){E(a,"class","svelte-sfo7xy")},m(s,x){Ze(s,a,x),Qt(o,a,null),d=!0},p(s,[x]){const T={};!c&&x&1&&(c=!0,T.value=s[0].custom,Lt(()=>c=!1)),o.$set(T)},i(s){d||(Ye(o.$$.fragment,s),d=!0)},o(s){ht(o.$$.fragment,s),d=!1},d(s){s&&q(a),$t(o)}}}function Vv(n,a,o){let{globalVisibleAreasTracker:c}=a,d=mi("areasParentsLookup"),g=mi("areas"),_=mi("selectedAndRelatedAreas"),s=d.filter(k=>!_.map(A=>A.areacd).includes(k.areacd));s.forEach(k=>{k.areanm=g.find(A=>A.areacd===k.areacd).areanm,k.parentnm=g.find(A=>k.parentcd===A.areacd)===void 0?"":g.find(A=>k.parentcd===A.areacd).areanm});function x(k){k.detail&&k.detail}function T(k){n.$$.not_equal(c.custom,k)&&(c.custom=k,o(0,c))}return n.$$set=k=>{"globalVisibleAreasTracker"in k&&o(0,c=k.globalVisibleAreasTracker)},[c,s,x,T]}class Nv extends vi{constructor(a){super(),bi(this,a,Vv,Ov,xi,{globalVisibleAreasTracker:0})}}function Qf(n){let a,o,c,d=n[6]&&$f(n),g=n[5]&&ep(n);return{c(){d&&d.c(),a=Ut(),g&&g.c(),o=Bi()},l(_){d&&d.l(_),a=qt(_),g&&g.l(_),o=Bi()},m(_,s){d&&d.m(_,s),Ze(_,a,s),g&&g.m(_,s),Ze(_,o,s),c=!0},p(_,s){_[6]?d?(d.p(_,s),s&64&&Ye(d,1)):(d=$f(_),d.c(),Ye(d,1),d.m(a.parentNode,a)):d&&(Yi(),ht(d,1,1,()=>{d=null}),Ji()),_[5]?g?(g.p(_,s),s&32&&Ye(g,1)):(g=ep(_),g.c(),Ye(g,1),g.m(o.parentNode,o)):g&&(Yi(),ht(g,1,1,()=>{g=null}),Ji())},i(_){c||(Ye(d),Ye(g),c=!0)},o(_){ht(d),ht(g),c=!1},d(_){d&&d.d(_),_&&q(a),g&&g.d(_),_&&q(o)}}}function $f(n){let a,o,c,d,g,_,s,x,T,k,A,S;function V(H){n[17](H)}let W={optionsArray:n[12],width:n[9]/2-20,name:"select-baseline-area",text:"Comparing "+n[11].areanm+" to:"};n[2]!==void 0&&(W.chosenId=n[2]),c=new Jf({props:W}),Mt.push(()=>Pt(c,"chosenId",V));function Z(H){n[18](H)}let Y={optionsArray:n[13],width:n[9]/2-20,name:"select-previous-time period",text:"Comparing most recent time period to:"};return n[3]!==void 0&&(Y.chosenId=n[3]),T=new Jf({props:Y}),Mt.push(()=>Pt(T,"chosenId",Z)),{c(){a=rt("div"),o=rt("div"),Yt(c.$$.fragment),g=Ut(),_=rt("div"),s=Ut(),x=rt("div"),Yt(T.$$.fragment),this.h()},l(H){a=at(H,"DIV",{class:!0});var Q=ve(a);o=at(Q,"DIV",{class:!0});var ae=ve(o);Jt(c.$$.fragment,ae),ae.forEach(q),g=qt(Q),_=at(Q,"DIV",{class:!0}),ve(_).forEach(q),s=qt(Q),x=at(Q,"DIV",{class:!0});var ne=ve(x);Jt(T.$$.fragment,ne),ne.forEach(q),Q.forEach(q),this.h()},h(){E(o,"class","col1 svelte-1ql21zt"),E(_,"class","divider svelte-1ql21zt"),E(x,"class","col2 svelte-1ql21zt"),E(a,"class","row-container svelte-1ql21zt"),dl(()=>n[19].call(a))},m(H,Q){Ze(H,a,Q),be(a,o),Qt(c,o,null),be(a,g),be(a,_),be(a,s),be(a,x),Qt(T,x,null),A=Oc(a,n[19].bind(a)),S=!0},p(H,Q){const ae={};Q&512&&(ae.width=H[9]/2-20),!d&&Q&4&&(d=!0,ae.chosenId=H[2],Lt(()=>d=!1)),c.$set(ae);const ne={};Q&512&&(ne.width=H[9]/2-20),!k&&Q&8&&(k=!0,ne.chosenId=H[3],Lt(()=>k=!1)),T.$set(ne)},i(H){S||(Ye(c.$$.fragment,H),Ye(T.$$.fragment,H),S=!0)},o(H){ht(c.$$.fragment,H),ht(T.$$.fragment,H),S=!1},d(H){H&&q(a),$t(c),$t(T),A()}}}function ep(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge,se,je;function ce(Re){n[20](Re)}let ee={optionsArray:n[10].filter(qv).map(Gv),name:"chosenComparison",spacing:"5px"};n[0]!==void 0&&(ee.chosenId=n[0]),_=new ol({props:ee}),Mt.push(()=>Pt(_,"chosenId",ce));function ke(Re){n[21](Re)}let _e={optionsArray:["Other areas in "+n[10].find(jv).areanm,"Statistically similar areas"],name:"chosenComparison",spacing:"5px"};n[1]!==void 0&&(_e.chosenId=n[1]),Z=new ol({props:_e}),Mt.push(()=>Pt(Z,"chosenId",ke));function me(Re){n[22](Re)}let Me={};return n[4]!==void 0&&(Me.globalVisibleAreasTracker=n[4]),ge=new Nv({props:Me}),Mt.push(()=>Pt(ge,"globalVisibleAreasTracker",me)),{c(){a=rt("div"),o=rt("div"),c=rt("p"),d=si("Parent areas:"),g=Ut(),Yt(_.$$.fragment),x=Ut(),T=rt("div"),k=Ut(),A=rt("div"),S=rt("p"),V=si("Related areas:"),W=Ut(),Yt(Z.$$.fragment),H=Ut(),Q=rt("div"),ae=Ut(),ne=rt("div"),Yt(ge.$$.fragment),this.h()},l(Re){a=at(Re,"DIV",{class:!0});var he=ve(a);o=at(he,"DIV",{class:!0});var Ee=ve(o);c=at(Ee,"P",{class:!0});var ft=ve(c);d=oi(ft,"Parent areas:"),ft.forEach(q),g=qt(Ee),Jt(_.$$.fragment,Ee),Ee.forEach(q),x=qt(he),T=at(he,"DIV",{class:!0}),ve(T).forEach(q),k=qt(he),A=at(he,"DIV",{class:!0});var nt=ve(A);S=at(nt,"P",{class:!0});var Fe=ve(S);V=oi(Fe,"Related areas:"),Fe.forEach(q),W=qt(nt),Jt(Z.$$.fragment,nt),nt.forEach(q),he.forEach(q),H=qt(Re),Q=at(Re,"DIV",{class:!0}),ve(Q).forEach(q),ae=qt(Re),ne=at(Re,"DIV",{class:!0});var Se=ve(ne);Jt(ge.$$.fragment,Se),Se.forEach(q),this.h()},h(){E(c,"class","checkbox-title svelte-1ql21zt"),E(o,"class","col1 svelte-1ql21zt"),E(T,"class","divider svelte-1ql21zt"),E(S,"class","checkbox-title svelte-1ql21zt"),E(A,"class","col2 svelte-1ql21zt"),E(a,"class","row-container svelte-1ql21zt"),E(Q,"class","divider-horizontal svelte-1ql21zt"),E(ne,"class","row-container svelte-1ql21zt")},m(Re,he){Ze(Re,a,he),be(a,o),be(o,c),be(c,d),be(o,g),Qt(_,o,null),be(a,x),be(a,T),be(a,k),be(a,A),be(A,S),be(S,V),be(A,W),Qt(Z,A,null),Ze(Re,H,he),Ze(Re,Q,he),Ze(Re,ae,he),Ze(Re,ne,he),Qt(ge,ne,null),je=!0},p(Re,he){const Ee={};!s&&he&1&&(s=!0,Ee.chosenId=Re[0],Lt(()=>s=!1)),_.$set(Ee);const ft={};!Y&&he&2&&(Y=!0,ft.chosenId=Re[1],Lt(()=>Y=!1)),Z.$set(ft);const nt={};!se&&he&16&&(se=!0,nt.globalVisibleAreasTracker=Re[4],Lt(()=>se=!1)),ge.$set(nt)},i(Re){je||(Ye(_.$$.fragment,Re),Ye(Z.$$.fragment,Re),Ye(ge.$$.fragment,Re),je=!0)},o(Re){ht(_.$$.fragment,Re),ht(Z.$$.fragment,Re),ht(ge.$$.fragment,Re),je=!1},d(Re){Re&&q(a),$t(_),$t(Z),Re&&q(H),Re&&q(Q),Re&&q(ae),Re&&q(ne),$t(ge)}}}function Uv(n){let a,o,c,d=n[5]&n[6]?"Select comparison areas and previous time period":n[5]?"Select areas to compare "+n[11].areanm+" to":"Select comparison area and previous time period",g,_,s,x,T,k;c=new Lv({props:{twistyOpen:n[7],hover:n[8]}});let A=n[7]&&Qf(n);return{c(){a=rt("div"),o=rt("p"),Yt(c.$$.fragment),g=si(d),s=Ut(),A&&A.c(),this.h()},l(S){a=at(S,"DIV",{class:!0});var V=ve(a);o=at(V,"P",{class:!0});var W=ve(o);Jt(c.$$.fragment,W),g=oi(W,d),W.forEach(q),s=qt(V),A&&A.l(V),V.forEach(q),this.h()},h(){E(o,"class",_="twisty-label "+(n[7]?"twisty-label-open":"")+" svelte-1ql21zt"),E(a,"class","twisty-container svelte-1ql21zt")},m(S,V){Ze(S,a,V),be(a,o),Qt(c,o,null),be(o,g),be(a,s),A&&A.m(a,null),x=!0,T||(k=[br(o,"mouseover",n[15]),br(o,"mouseleave",n[16]),br(o,"click",n[14])],T=!0)},p(S,[V]){const W={};V&128&&(W.twistyOpen=S[7]),V&256&&(W.hover=S[8]),c.$set(W),(!x||V&96)&&d!==(d=S[5]&S[6]?"Select comparison areas and previous time period":S[5]?"Select areas to compare "+S[11].areanm+" to":"Select comparison area and previous time period")&&Ci(g,d),(!x||V&128&&_!==(_="twisty-label "+(S[7]?"twisty-label-open":"")+" svelte-1ql21zt"))&&E(o,"class",_),S[7]?A?(A.p(S,V),V&128&&Ye(A,1)):(A=Qf(S),A.c(),Ye(A,1),A.m(a,null)):A&&(Yi(),ht(A,1,1,()=>{A=null}),Ji())},i(S){x||(Ye(c.$$.fragment,S),Ye(A),x=!0)},o(S){ht(c.$$.fragment,S),ht(A),x=!1},d(S){S&&q(a),$t(c),A&&A.d(),T=!1,rh(k)}}}const qv=n=>n.role!="main",Gv=n=>n.areanm,jv=n=>n.role==="parent";function Zv(n,a,o){let{chosenId1:c}=a,{chosenId2:d}=a,{chosenId4:g}=a,{chosenId5:_}=a,{globalVisibleAreasTracker:s}=a,{showAreaOptions:x,showBaselines:T}=a,k=mi("selectedAndRelatedAreas"),A=mi("selectedArea"),S=mi("baselineComparisonOptions"),V=mi("previousTimePeriodOptions"),W=!1,Z=!1;const Y=()=>{o(7,W=!W)},H=()=>{o(8,Z=!0)},Q=()=>{o(8,Z=!1)};let ae=1e3;function ne(ke){c=ke,o(2,c)}function ge(ke){d=ke,o(3,d)}function se(){ae=this.offsetWidth,o(9,ae)}function je(ke){g=ke,o(0,g)}function ce(ke){_=ke,o(1,_)}function ee(ke){s=ke,o(4,s),o(1,_),o(0,g),o(10,k)}return n.$$set=ke=>{"chosenId1"in ke&&o(2,c=ke.chosenId1),"chosenId2"in ke&&o(3,d=ke.chosenId2),"chosenId4"in ke&&o(0,g=ke.chosenId4),"chosenId5"in ke&&o(1,_=ke.chosenId5),"globalVisibleAreasTracker"in ke&&o(4,s=ke.globalVisibleAreasTracker),"showAreaOptions"in ke&&o(5,x=ke.showAreaOptions),"showBaselines"in ke&&o(6,T=ke.showBaselines)},n.$$.update=()=>{n.$$.dirty&2&&(o(4,s.neighbour=_.includes(0),s),o(4,s.cluster=_.includes(1),s)),n.$$.dirty&1&&(o(4,s.parent=!1,s),o(4,s.country=!1,s),o(4,s.uk=!1,s),g.forEach(ke=>{o(4,s[k.find(_e=>k[ke+1].areanm===_e.areanm).role]=!0,s)}))},[g,_,c,d,s,x,T,W,Z,ae,k,A,S,V,Y,H,Q,ne,ge,se,je,ce,ee]}class mm extends vi{constructor(a){super(),bi(this,a,Zv,Uv,xi,{chosenId1:2,chosenId2:3,chosenId4:0,chosenId5:1,globalVisibleAreasTracker:4,showAreaOptions:5,showBaselines:6})}}function tp(n,a,o){const c=n.slice();return c[20]=a[o],c[22]=o,c}function Xv(n){let a,o;return{c(){a=ct("circle"),this.h()},l(c){a=ut(c,"circle",{r:!0,fill:!0,stroke:!0});var d=ve(a);d.forEach(q),this.h()},h(){E(a,"r",6),E(a,"fill",o=Xt[n[20].role]),E(a,"stroke","white")},m(c,d){Ze(c,a,d)},p(c,d){d&128&&o!==(o=Xt[c[20].role])&&E(a,"fill",o)},d(c){c&&q(a)}}}function Wv(n){let a,o,c;return{c(){a=ct("rect"),this.h()},l(d){a=ut(d,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0});var g=ve(a);g.forEach(q),this.h()},h(){E(a,"transform",o=["country","uk"].includes(n[20].role)?"rotate(45)":null),E(a,"x",-6),E(a,"y",-6),E(a,"width",2*6),E(a,"height",2*6),E(a,"fill",c=Xt[n[20].role]),E(a,"stroke","white")},m(d,g){Ze(d,a,g)},p(d,g){g&128&&o!==(o=["country","uk"].includes(d[20].role)?"rotate(45)":null)&&E(a,"transform",o),g&128&&c!==(c=Xt[d[20].role])&&E(a,"fill",c)},d(d){d&&q(a)}}}function ip(n){let a,o,c,d,g,_,s=n[20].areanm+"",x,T;function k(V,W){return W&128&&(d=null),d==null&&(d=!!["parent","country","uk"].includes(V[20].role)),d?Wv:Xv}let A=k(n,-1),S=A(n);return{c(){a=rt("div"),o=ct("svg"),c=ct("g"),S.c(),g=Ut(),_=rt("p"),x=si(s),T=Ut(),this.h()},l(V){a=at(V,"DIV",{class:!0});var W=ve(a);o=ut(W,"svg",{width:!0,height:!0});var Z=ve(o);c=ut(Z,"g",{transform:!0});var Y=ve(c);S.l(Y),Y.forEach(q),Z.forEach(q),g=qt(W),_=at(W,"P",{style:!0,class:!0});var H=ve(_);x=oi(H,s),H.forEach(q),T=qt(W),W.forEach(q),this.h()},h(){E(c,"transform","translate(10,12)"),E(o,"width","20"),E(o,"height","24"),ni(_,"color",Xt[n[20].role]),E(_,"class","svelte-1f6uc8m"),E(a,"class","area-container svelte-1f6uc8m")},m(V,W){Ze(V,a,W),be(a,o),be(o,c),S.m(c,null),be(a,g),be(a,_),be(_,x),be(a,T)},p(V,W){A===(A=k(V,W))&&S?S.p(V,W):(S.d(1),S=A(V),S&&(S.c(),S.m(c,null))),W&128&&s!==(s=V[20].areanm+"")&&Ci(x,s),W&128&&ni(_,"color",Xt[V[20].role])},d(V){V&&q(a),S.d()}}}function Hv(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W;function Z(ee){n[12](ee)}function Y(ee){n[13](ee)}function H(ee){n[14](ee)}function Q(ee){n[15](ee)}function ae(ee){n[16](ee)}let ne={showAreaOptions:n[6]!=0,showBaselines:n[6]!=1};n[0]!==void 0&&(ne.chosenId1=n[0]),n[1]!==void 0&&(ne.chosenId2=n[1]),n[4]!==void 0&&(ne.globalVisibleAreasTracker=n[4]),n[2]!==void 0&&(ne.chosenId4=n[2]),n[3]!==void 0&&(ne.chosenId5=n[3]),c=new mm({props:ne}),Mt.push(()=>Pt(c,"chosenId1",Z)),Mt.push(()=>Pt(c,"chosenId2",Y)),Mt.push(()=>Pt(c,"globalVisibleAreasTracker",H)),Mt.push(()=>Pt(c,"chosenId4",Q)),Mt.push(()=>Pt(c,"chosenId5",ae));function ge(ee){n[17](ee)}let se={optionsArray:["Include 90% confidence intervals"],name:"chosenComparison"};n[5]!==void 0&&(se.chosenId=n[5]),k=new ol({props:se}),Mt.push(()=>Pt(k,"chosenId",ge));let je=n[7],ce=[];for(let ee=0;ee<je.length;ee+=1)ce[ee]=ip(tp(n,je,ee));return{c(){a=rt("div"),o=rt("div"),Yt(c.$$.fragment),T=Ut(),Yt(k.$$.fragment),S=Ut(),V=rt("div");for(let ee=0;ee<ce.length;ee+=1)ce[ee].c();this.h()},l(ee){a=at(ee,"DIV",{class:!0});var ke=ve(a);o=at(ke,"DIV",{});var _e=ve(o);Jt(c.$$.fragment,_e),_e.forEach(q),T=qt(ke),Jt(k.$$.fragment,ke),S=qt(ke),V=at(ke,"DIV",{class:!0});var me=ve(V);for(let Me=0;Me<ce.length;Me+=1)ce[Me].l(me);me.forEach(q),ke.forEach(q),this.h()},h(){E(V,"class","key-container svelte-1f6uc8m"),E(a,"class","sticky svelte-1f6uc8m")},m(ee,ke){Ze(ee,a,ke),be(a,o),Qt(c,o,null),be(a,T),Qt(k,a,null),be(a,S),be(a,V);for(let _e=0;_e<ce.length;_e+=1)ce[_e]&&ce[_e].m(V,null);W=!0},p(ee,[ke]){const _e={};ke&64&&(_e.showAreaOptions=ee[6]!=0),ke&64&&(_e.showBaselines=ee[6]!=1),!d&&ke&1&&(d=!0,_e.chosenId1=ee[0],Lt(()=>d=!1)),!g&&ke&2&&(g=!0,_e.chosenId2=ee[1],Lt(()=>g=!1)),!_&&ke&16&&(_=!0,_e.globalVisibleAreasTracker=ee[4],Lt(()=>_=!1)),!s&&ke&4&&(s=!0,_e.chosenId4=ee[2],Lt(()=>s=!1)),!x&&ke&8&&(x=!0,_e.chosenId5=ee[3],Lt(()=>x=!1)),c.$set(_e);const me={};if(!A&&ke&32&&(A=!0,me.chosenId=ee[5],Lt(()=>A=!1)),k.$set(me),ke&128){je=ee[7];let Me;for(Me=0;Me<je.length;Me+=1){const Re=tp(ee,je,Me);ce[Me]?ce[Me].p(Re,ke):(ce[Me]=ip(Re),ce[Me].c(),ce[Me].m(V,null))}for(;Me<ce.length;Me+=1)ce[Me].d(1);ce.length=je.length}},i(ee){W||(Ye(c.$$.fragment,ee),Ye(k.$$.fragment,ee),W=!0)},o(ee){ht(c.$$.fragment,ee),ht(k.$$.fragment,ee),W=!1},d(ee){ee&&q(a),$t(c),$t(k),Qi(ce,ee)}}}function Kv(n,a,o){let c,{baselineComparisonArea:d}=a,{chosenId3:g}=a,{visibleAreas:_}=a,{chosenId1:s}=a,{chosenId2:x}=a,{chosenId4:T}=a,{chosenId5:k}=a,{globalVisibleAreasTracker:A}=a,{showAreaOptions:S,showBaselines:V}=a,{chosenId6:W}=a,Z=mi("selectedAndRelatedAreas");mi("selectedArea");function Y(se){s=se,o(0,s)}function H(se){x=se,o(1,x)}function Q(se){A=se,o(4,A)}function ae(se){T=se,o(2,T)}function ne(se){k=se,o(3,k)}function ge(se){W=se,o(5,W)}return n.$$set=se=>{"baselineComparisonArea"in se&&o(8,d=se.baselineComparisonArea),"chosenId3"in se&&o(6,g=se.chosenId3),"visibleAreas"in se&&o(9,_=se.visibleAreas),"chosenId1"in se&&o(0,s=se.chosenId1),"chosenId2"in se&&o(1,x=se.chosenId2),"chosenId4"in se&&o(2,T=se.chosenId4),"chosenId5"in se&&o(3,k=se.chosenId5),"globalVisibleAreasTracker"in se&&o(4,A=se.globalVisibleAreasTracker),"showAreaOptions"in se&&o(10,S=se.showAreaOptions),"showBaselines"in se&&o(11,V=se.showBaselines),"chosenId6"in se&&o(5,W=se.chosenId6)},n.$$.update=()=>{n.$$.dirty&832&&o(7,c=g===0?[Z[0],d.areacd==="median"?d:Z.find(se=>d.areacd===se.areacd)]:_)},[s,x,T,k,A,W,g,c,d,_,S,V,Y,H,Q,ae,ne,ge]}class Yv extends vi{constructor(a){super(),bi(this,a,Kv,Hv,xi,{baselineComparisonArea:8,chosenId3:6,visibleAreas:9,chosenId1:0,chosenId2:1,chosenId4:2,chosenId5:3,globalVisibleAreasTracker:4,showAreaOptions:10,showBaselines:11,chosenId6:5})}}function np(n,a,o){const c=n.slice();return c[43]=a[o],c[45]=o,c}function rp(n,a,o){const c=n.slice();return c[46]=a[o],c[48]=o,c}function ap(n){let a,o,c,d,g,_,s;function x(...W){return n[36](n[46],...W)}function T(...W){return n[37](n[46],...W)}function k(W){n[38](W)}function A(W){n[39](W)}function S(W){n[40](W)}let V={rowNumb:n[48],topicNumb:n[45],indicator:n[46],metadata:n[24].find(x),calculations:n[25].find(T),col1Width:nl,col2Width:n[17],col3Width:n[18],col4Width:n[16],chosenId2:n[2],chosenId3:n[11],visibleAreas:n[8],baselineComparisonArea:n[9],scaleHeight:n[14],scaleWidthArea:n[15],scaleWidthTime:n[23],xDomain:n[27],x:n[22],y:n[21],chosenId11:n[10],chosenId6:n[5]};return n[13]!==void 0&&(V.yDomainGlobal=n[13]),n[19]!==void 0&&(V.hoverIndex=n[19]),n[20]!==void 0&&(V.hoverChartIndex=n[20]),c=new kv({props:V}),Mt.push(()=>Pt(c,"yDomainGlobal",k)),Mt.push(()=>Pt(c,"hoverIndex",A)),Mt.push(()=>Pt(c,"hoverChartIndex",S)),{c(){a=rt("div"),o=Ut(),Yt(c.$$.fragment),this.h()},l(W){a=at(W,"DIV",{class:!0}),ve(a).forEach(q),o=qt(W),Jt(c.$$.fragment,W),this.h()},h(){E(a,"class","divider svelte-1km6wui")},m(W,Z){Ze(W,a,Z),Ze(W,o,Z),Qt(c,W,Z),s=!0},p(W,Z){n=W;const Y={};Z[0]&192&&(Y.indicator=n[46]),Z[0]&192&&(Y.metadata=n[24].find(x)),Z[0]&192&&(Y.calculations=n[25].find(T)),Z[0]&131072&&(Y.col2Width=n[17]),Z[0]&262144&&(Y.col3Width=n[18]),Z[0]&65536&&(Y.col4Width=n[16]),Z[0]&4&&(Y.chosenId2=n[2]),Z[0]&2048&&(Y.chosenId3=n[11]),Z[0]&256&&(Y.visibleAreas=n[8]),Z[0]&512&&(Y.baselineComparisonArea=n[9]),Z[0]&16384&&(Y.scaleHeight=n[14]),Z[0]&32768&&(Y.scaleWidthArea=n[15]),Z[0]&8388608&&(Y.scaleWidthTime=n[23]),Z[0]&4194304&&(Y.x=n[22]),Z[0]&2097152&&(Y.y=n[21]),Z[0]&1024&&(Y.chosenId11=n[10]),Z[0]&32&&(Y.chosenId6=n[5]),!d&&Z[0]&8192&&(d=!0,Y.yDomainGlobal=n[13],Lt(()=>d=!1)),!g&&Z[0]&524288&&(g=!0,Y.hoverIndex=n[19],Lt(()=>g=!1)),!_&&Z[0]&1048576&&(_=!0,Y.hoverChartIndex=n[20],Lt(()=>_=!1)),c.$set(Y)},i(W){s||(Ye(c.$$.fragment,W),s=!0)},o(W){ht(c.$$.fragment,W),s=!1},d(W){W&&q(a),W&&q(o),$t(c,W)}}}function sp(n){let a,o,c=n[43][0].toUpperCase()+n[43].substring(1)+"",d,g,_,s,x,T,k;function A(...Z){return n[35](n[43],...Z)}let S=n[7].filter(A),V=[];for(let Z=0;Z<S.length;Z+=1)V[Z]=ap(rp(n,S,Z));const W=Z=>ht(V[Z],1,1,()=>{V[Z]=null});return{c(){a=rt("div"),o=rt("h4"),d=si(c),g=Ut(),_=rt("div");for(let Z=0;Z<V.length;Z+=1)V[Z].c();s=Ut(),x=rt("div"),T=Ut(),this.h()},l(Z){a=at(Z,"DIV",{class:!0});var Y=ve(a);o=at(Y,"H4",{class:!0});var H=ve(o);d=oi(H,c),H.forEach(q),g=qt(Y),_=at(Y,"DIV",{class:!0});var Q=ve(_);for(let ae=0;ae<V.length;ae+=1)V[ae].l(Q);Q.forEach(q),s=qt(Y),x=at(Y,"DIV",{class:!0}),ve(x).forEach(q),T=qt(Y),Y.forEach(q),this.h()},h(){E(o,"class","sub-topic-header svelte-1km6wui"),E(_,"class","sub-topic-rows-container svelte-1km6wui"),E(x,"class","divider svelte-1km6wui"),E(a,"class","sub-topic-container svelte-1km6wui")},m(Z,Y){Ze(Z,a,Y),be(a,o),be(o,d),be(a,g),be(a,_);for(let H=0;H<V.length;H+=1)V[H]&&V[H].m(_,null);be(a,s),be(a,x),be(a,T),k=!0},p(Z,Y){if(n=Z,(!k||Y[0]&64)&&c!==(c=n[43][0].toUpperCase()+n[43].substring(1)+"")&&Ci(d,c),Y[0]&201322468){S=n[7].filter(A);let H;for(H=0;H<S.length;H+=1){const Q=rp(n,S,H);V[H]?(V[H].p(Q,Y),Ye(V[H],1)):(V[H]=ap(Q),V[H].c(),Ye(V[H],1),V[H].m(_,null))}for(Yi(),H=S.length;H<V.length;H+=1)W(H);Ji()}},i(Z){if(!k){for(let Y=0;Y<S.length;Y+=1)Ye(V[Y]);k=!0}},o(Z){V=V.filter(Boolean);for(let Y=0;Y<V.length;Y+=1)ht(V[Y]);k=!1},d(Z){Z&&q(a),Qi(V,Z)}}}function Jv(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q;function ae(he){n[28](he)}let ne={name:"select-row-view",optionsArray:n[26],width:n[12]};n[11]!==void 0&&(ne.chosenId=n[11]),a=new Xp({props:ne}),Mt.push(()=>Pt(a,"chosenId",ae));function ge(he){n[29](he)}function se(he){n[30](he)}function je(he){n[31](he)}function ce(he){n[32](he)}function ee(he){n[33](he)}function ke(he){n[34](he)}let _e={baselineComparisonArea:n[9],chosenId3:n[11],visibleAreas:n[8],showAreaOptions:n[11]!=0,showBaselines:n[11]!=1};n[1]!==void 0&&(_e.chosenId1=n[1]),n[2]!==void 0&&(_e.chosenId2=n[2]),n[0]!==void 0&&(_e.globalVisibleAreasTracker=n[0]),n[3]!==void 0&&(_e.chosenId4=n[3]),n[4]!==void 0&&(_e.chosenId5=n[4]),n[5]!==void 0&&(_e.chosenId6=n[5]),s=new Yv({props:_e}),Mt.push(()=>Pt(s,"chosenId1",ge)),Mt.push(()=>Pt(s,"chosenId2",se)),Mt.push(()=>Pt(s,"globalVisibleAreasTracker",je)),Mt.push(()=>Pt(s,"chosenId4",ce)),Mt.push(()=>Pt(s,"chosenId5",ee)),Mt.push(()=>Pt(s,"chosenId6",ke));let me=n[6].subTopicsList,Me=[];for(let he=0;he<me.length;he+=1)Me[he]=sp(np(n,me,he));const Re=he=>ht(Me[he],1,1,()=>{Me[he]=null});return Y=new pm({}),{c(){Yt(a.$$.fragment),c=Ut(),d=rt("div"),g=rt("div"),_=rt("div"),Yt(s.$$.fragment),W=Ut();for(let he=0;he<Me.length;he+=1)Me[he].c();Z=Ut(),Yt(Y.$$.fragment),this.h()},l(he){Jt(a.$$.fragment,he),c=qt(he),d=at(he,"DIV",{class:!0});var Ee=ve(d);g=at(Ee,"DIV",{class:!0});var ft=ve(g);_=at(ft,"DIV",{class:!0});var nt=ve(_);Jt(s.$$.fragment,nt),W=qt(nt);for(let Fe=0;Fe<Me.length;Fe+=1)Me[Fe].l(nt);nt.forEach(q),Z=qt(ft),Jt(Y.$$.fragment,ft),ft.forEach(q),Ee.forEach(q),this.h()},h(){E(_,"class","key-and-rows-container"),E(g,"class","digest-beeswarm-line-inner-container svelte-1km6wui"),dl(()=>n[41].call(g)),E(d,"class","digest-beeswarm-line-outer-container svelte-1km6wui")},m(he,Ee){Qt(a,he,Ee),Ze(he,c,Ee),Ze(he,d,Ee),be(d,g),be(g,_),Qt(s,_,null),be(_,W);for(let ft=0;ft<Me.length;ft+=1)Me[ft]&&Me[ft].m(_,null);be(g,Z),Qt(Y,g,null),H=Oc(g,n[41].bind(g)),Q=!0},p(he,Ee){const ft={};Ee[0]&4096&&(ft.width=he[12]),!o&&Ee[0]&2048&&(o=!0,ft.chosenId=he[11],Lt(()=>o=!1)),a.$set(ft);const nt={};if(Ee[0]&512&&(nt.baselineComparisonArea=he[9]),Ee[0]&2048&&(nt.chosenId3=he[11]),Ee[0]&256&&(nt.visibleAreas=he[8]),Ee[0]&2048&&(nt.showAreaOptions=he[11]!=0),Ee[0]&2048&&(nt.showBaselines=he[11]!=1),!x&&Ee[0]&2&&(x=!0,nt.chosenId1=he[1],Lt(()=>x=!1)),!T&&Ee[0]&4&&(T=!0,nt.chosenId2=he[2],Lt(()=>T=!1)),!k&&Ee[0]&1&&(k=!0,nt.globalVisibleAreasTracker=he[0],Lt(()=>k=!1)),!A&&Ee[0]&8&&(A=!0,nt.chosenId4=he[3],Lt(()=>A=!1)),!S&&Ee[0]&16&&(S=!0,nt.chosenId5=he[4],Lt(()=>S=!1)),!V&&Ee[0]&32&&(V=!0,nt.chosenId6=he[5],Lt(()=>V=!1)),s.$set(nt),Ee[0]&201322468){me=he[6].subTopicsList;let Fe;for(Fe=0;Fe<me.length;Fe+=1){const Se=np(he,me,Fe);Me[Fe]?(Me[Fe].p(Se,Ee),Ye(Me[Fe],1)):(Me[Fe]=sp(Se),Me[Fe].c(),Ye(Me[Fe],1),Me[Fe].m(_,null))}for(Yi(),Fe=me.length;Fe<Me.length;Fe+=1)Re(Fe);Ji()}},i(he){if(!Q){Ye(a.$$.fragment,he),Ye(s.$$.fragment,he);for(let Ee=0;Ee<me.length;Ee+=1)Ye(Me[Ee]);Ye(Y.$$.fragment,he),Q=!0}},o(he){ht(a.$$.fragment,he),ht(s.$$.fragment,he),Me=Me.filter(Boolean);for(let Ee=0;Ee<Me.length;Ee+=1)ht(Me[Ee]);ht(Y.$$.fragment,he),Q=!1},d(he){$t(a,he),he&&q(c),he&&q(d),$t(s),Qi(Me,he),$t(Y),H()}}}let nl=240;function Qv(n,a,o){let c,d,g,_,s,x,T,k,{topic:A}=a,{indicators:S}=a,{visibleAreas:V,globalVisibleAreasTracker:W}=a,{chosenId1:Z,baselineComparisonArea:Y}=a,{chosenId2:H}=a,{chosenId4:Q,chosenId5:ae}=a,{chosenId11:ne}=a,{chosenId6:ge}=a,se=mi("indicatorsMetadata"),je=mi("indicatorsCalculations");mi("selectedArea");let ce=0,ee=["Summary","Compared to other areas","Change over time"],ke=1e3,_e=[-Ac,Ac],me=[-1,1],Me=null,Re=null;function he(Pe){ce=Pe,o(11,ce)}function Ee(Pe){Z=Pe,o(1,Z)}function ft(Pe){H=Pe,o(2,H)}function nt(Pe){W=Pe,o(0,W)}function Fe(Pe){Q=Pe,o(3,Q)}function Se(Pe){ae=Pe,o(4,ae)}function de(Pe){ge=Pe,o(5,ge)}const Qe=(Pe,Ve)=>Ve.subTopic===Pe,Je=(Pe,Ve)=>Ve.code===Pe.code,yt=(Pe,Ve)=>Ve.id===Pe.id;function mt(Pe){me=Pe,o(13,me)}function Xe(Pe){Me=Pe,o(19,Me)}function gt(Pe){Re=Pe,o(20,Re)}function ze(){ke=this.offsetWidth,o(12,ke)}return n.$$set=Pe=>{"topic"in Pe&&o(6,A=Pe.topic),"indicators"in Pe&&o(7,S=Pe.indicators),"visibleAreas"in Pe&&o(8,V=Pe.visibleAreas),"globalVisibleAreasTracker"in Pe&&o(0,W=Pe.globalVisibleAreasTracker),"chosenId1"in Pe&&o(1,Z=Pe.chosenId1),"baselineComparisonArea"in Pe&&o(9,Y=Pe.baselineComparisonArea),"chosenId2"in Pe&&o(2,H=Pe.chosenId2),"chosenId4"in Pe&&o(3,Q=Pe.chosenId4),"chosenId5"in Pe&&o(4,ae=Pe.chosenId5),"chosenId11"in Pe&&o(10,ne=Pe.chosenId11),"chosenId6"in Pe&&o(5,ge=Pe.chosenId6)},n.$$.update=()=>{n.$$.dirty[0]&2048&&o(18,c=ce===0?20:0),n.$$.dirty[0]&268288&&o(17,d=ce===0?(ke-nl-c-5)/2:ce===1?ke-nl-c:0),n.$$.dirty[0]&268288&&o(16,g=ce===0?(ke-nl-c-5)/2:ce===1?0:ke-nl-c),n.$$.dirty[0]&2048&&o(14,_=ma[ce===0?"split":"full"]-Gt.bottom[ce===0?"split":"full"]-Gt.top[ce===0?"split":"full"]),n.$$.dirty[0]&133120&&o(15,s=d-Gt.left[ce===0?"split":"full"]-Gt.right[ce===0?"split":"full"]-Gt.areaSpaceBeyondXScale[ce===0?"split":"full"]*2),n.$$.dirty[0]&67584&&o(23,x=g-Gt.left[ce===0?"split":"full"]-Gt.right[ce===0?"split":"full"]-Gt.areaSpaceBeyondXScale[ce===0?"split":"full"]*2),n.$$.dirty[0]&32768&&o(22,T=Oa().domain(_e).range([0,s])),n.$$.dirty[0]&24576&&o(21,k=Oa().domain(me).range([0,_]))},[W,Z,H,Q,ae,ge,A,S,V,Y,ne,ce,ke,me,_,s,g,d,c,Me,Re,k,T,x,se,je,ee,_e,he,Ee,ft,nt,Fe,Se,de,Qe,Je,yt,mt,Xe,gt,ze]}class $v extends vi{constructor(a){super(),bi(this,a,Qv,Jv,xi,{topic:6,indicators:7,visibleAreas:8,globalVisibleAreasTracker:0,chosenId1:1,baselineComparisonArea:9,chosenId2:2,chosenId4:3,chosenId5:4,chosenId11:10,chosenId6:5},null,[-1,-1])}}var gm={exports:{}};(function(n,a){(function(o,c){n.exports=c()})(L_,function(){var o,c,d;function g(s,x){if(!o)o=x;else if(!c)c=x;else{var T="var sharedChunk = {}; ("+o+")(sharedChunk); ("+c+")(sharedChunk);",k={};o(k),d=x(k),typeof window<"u"&&(d.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}g(["exports"],function(s){var x=T;function T(i,e,r,u){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=u}function k(i,e,r,u){const p=new x(i,e,r,u);return function(y){return p.solve(y)}}T.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,u=0;u<8;u++){var p=this.sampleCurveX(r)-i;if(Math.abs(p)<e)return r;var y=this.sampleCurveDerivativeX(r);if(Math.abs(y)<1e-6)break;r-=p/y}var b=0,I=1;for(r=i,u=0;u<20&&(p=this.sampleCurveX(r),!(Math.abs(p-i)<e));u++)i>p?b=r:I=r,r=.5*(I-b)+b;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};const A=k(.25,.1,.25,1);function S(i,e,r){return Math.min(r,Math.max(e,i))}function V(i,e,r){const u=r-e,p=((i-e)%u+u)%u+e;return p===e?r:p}function W(i,...e){for(const r of e)for(const u in r)i[u]=r[u];return i}let Z=1;function Y(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function H(i,e,r){const u={};for(const p in i)u[p]=e.call(r||this,i[p],p,i);return u}function Q(i,e,r){const u={};for(const p in i)e.call(r||this,i[p],p,i)&&(u[p]=i[p]);return u}function ae(i){return Array.isArray(i)?i.map(ae):typeof i=="object"&&i?H(i,ae):i}const ne={};function ge(i){ne[i]||(typeof console<"u"&&console.warn(i),ne[i]=!0)}function se(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function je(i){let e=0;for(let r,u,p=0,y=i.length,b=y-1;p<y;b=p++)r=i[p],u=i[b],e+=(u.x-r.x)*(r.y+u.y);return e}function ce(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ee(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,u,p,y)=>{const b=p||y;return e[u]=!b||b.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ke,_e,me=null;function Me(i){if(me==null){const e=i.navigator?i.navigator.userAgent:null;me=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return me}function Re(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const he={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const r=window.document.createElement("canvas"),u=r.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return r.width=i.width,r.height=i.height,u.drawImage(i,0,0,i.width,i.height),u.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(ke||(ke=document.createElement("a")),ke.href=i,ke.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(_e==null&&(_e=matchMedia("(prefers-reduced-motion: reduce)")),_e.matches)}};var Ee=ft;function ft(i,e){this.x=i,this.y=e}ft.prototype={clone:function(){return new ft(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),u=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=u,this},_rotateAround:function(i,e){var r=Math.cos(i),u=Math.sin(i),p=e.y+u*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-u*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ft.convert=function(i){return i instanceof ft?i:Array.isArray(i)?new ft(i[0],i[1]):i};const nt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Fe="mapbox-tiles";let Se,de,Qe=500,Je=50;function yt(){typeof caches>"u"||Se||(Se=caches.open(Fe))}let mt=1/0;const Xe={supported:!1,testSupport:function(i){!Pe&&ze&&(Ve?vt(i):gt=i)}};let gt,ze,Pe=!1,Ve=!1;function vt(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,ze),i.isContextLost())return;Xe.supported=!0}catch{}i.deleteTexture(e),Pe=!0}typeof document<"u"&&(ze=document.createElement("img"),ze.onload=function(){gt&&vt(gt),gt=null,Ve=!0},ze.onerror=function(){Pe=!0,gt=null},ze.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const fi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(fi);class tt extends Error{constructor(e,r,u,p){super(`AJAXError: ${r} (${e}): ${u}`),this.status=e,this.statusText=r,this.url=u,this.body=p}}const lt=ce()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function li(i,e){const r=new AbortController,u=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:lt(),signal:r.signal});let p=!1,y=!1;return i.type==="json"&&u.headers.set("Accept","application/json"),((b,I,C)=>{if(y)return;const D=Date.now();fetch(u).then(B=>B.ok?((F,U,j)=>{(i.type==="arrayBuffer"?F.arrayBuffer():i.type==="json"?F.json():F.text()).then(X=>{y||(U&&j&&function(ue,le,Ce){if(yt(),!Se)return;const Ne={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Be,it)=>Ne.headers.set(it,Be));const Ae=ee(le.headers.get("Cache-Control")||"");Ae["no-store"]||(Ae["max-age"]&&Ne.headers.set("Expires",new Date(Ce+1e3*Ae["max-age"]).toUTCString()),new Date(Ne.headers.get("Expires")).getTime()-Ce<42e4||function(Be,it){if(de===void 0)try{new Response(new ReadableStream),de=!0}catch{de=!1}de?it(Be.body):Be.blob().then(it)}(le,Be=>{const it=new Response(Be,Ne);yt(),Se&&Se.then(et=>et.put(function(Dt){const Ft=Dt.indexOf("?");return Ft<0?Dt:Dt.slice(0,Ft)}(ue.url),it)).catch(et=>ge(et.message))}))}(u,U,j),p=!0,e(null,X,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(X=>{y||e(new Error(X.message))})})(B,null,D):B.blob().then(F=>e(new tt(B.status,B.statusText,i.url,F)))).catch(B=>{B.code!==20&&e(new Error(B.message))})})(),{cancel:()=>{y=!0,p||r.abort()}}}const ln=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(ce()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!ce()){const u=i.url.substring(0,i.url.indexOf("://"));return(nt.REGISTERED_PROTOCOLS[u]||li)(i,e)}}if(!(/^file:/.test(r=i.url)||/^file:/.test(lt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return li(i,e);if(ce()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(u,p){const y=new XMLHttpRequest;y.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const b in u.headers)y.setRequestHeader(b,u.headers[b]);return u.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=u.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let b=y.response;if(u.type==="json")try{b=JSON.parse(y.response)}catch(I){return p(I)}p(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const b=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});p(new tt(y.status,y.statusText,u.url,b))}},y.send(u.body),{cancel:()=>y.abort()}}(i,e)},ei=function(i,e){return ln(W(i,{type:"arrayBuffer"}),e)};function dn(i){const e=window.document.createElement("a");return e.href=i,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const $e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ot,tn;ot=[],tn=0;const Vn=function(i,e){if(Xe.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),tn>=nt.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ot.push(y),y}tn++;let r=!1;const u=()=>{if(!r)for(r=!0,tn--;ot.length&&tn<nt.MAX_PARALLEL_IMAGE_REQUESTS;){const y=ot.shift(),{requestParameters:b,callback:I,cancelled:C}=y;C||(y.cancel=Vn(b,I).cancel)}},p=ei(i,(y,b,I,C)=>{u(),y?e(y):b&&function(D,B){typeof createImageBitmap=="function"?function(F,U){const j=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(j).then(X=>{U(null,X)}).catch(X=>{U(new Error(`Could not load image because of ${X.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(D,B):function(F,U){const j=new Image;j.onload=()=>{U(null,j),URL.revokeObjectURL(j.src),j.onload=null,window.requestAnimationFrame(()=>{j.src=$e})},j.onerror=()=>U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new Blob([new Uint8Array(F)],{type:"image/png"});j.src=F.byteLength?URL.createObjectURL(X):$e}(D,B)}(b,(D,B)=>{D!=null?e(D):B!=null&&e(null,B,{cacheControl:I,expires:C})})});return{cancel:()=>{p.cancel(),u()}}};function Va(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function wr(i,e,r){if(r&&r[i]){const u=r[i].indexOf(e);u!==-1&&r[i].splice(u,1)}}class Ir{constructor(e,r={}){W(this,r),this.type=e}}class ga extends Ir{constructor(e,r={}){super("error",W({error:e},r))}}class kr{on(e,r){return this._listeners=this._listeners||{},Va(e,r,this._listeners),this}off(e,r){return wr(e,r,this._listeners),wr(e,r,this._oneTimeListeners),this}once(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Va(e,r,this._oneTimeListeners),this}fire(e,r){typeof e=="string"&&(e=new Ir(e,r||{}));const u=e.type;if(this.listens(u)){e.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const I of p)I.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const I of y)wr(u,I,this._oneTimeListeners),I.call(this,e);const b=this._eventedParent;b&&(W(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(e))}else e instanceof ga&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class It{constructor(e,r,u,p){this.message=(e?`${e}: `:"")+u,p&&(this.identifier=p),r!=null&&r.__line__&&(this.line=r.__line__)}}function Yr(i){const e=i.value;return e?[new It(i.key,e,"constants have been deprecated as of v8")]:[]}function nr(i,...e){for(const r of e)for(const u in r)i[u]=r[u];return i}function wi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Jn(i){if(Array.isArray(i))return i.map(Jn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Jn(i[r]);return e}return wi(i)}class Nn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Un{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[u,p]of r)this.bindings[u]=p}concat(e){return new Un(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Or={kind:"null"},bt={kind:"number"},ci={kind:"string"},ri={kind:"boolean"},bn={kind:"color"},Vr={kind:"object"},ii={kind:"value"},Tr={kind:"collator"},fn={kind:"formatted"},_a={kind:"padding"},rn={kind:"resolvedImage"};function Sn(i,e){return{kind:"array",itemType:i,N:e}}function Pi(i){if(i.kind==="array"){const e=Pi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const ya=[Or,bt,ci,ri,bn,fn,Vr,Sn(ii),_a,rn];function fr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!fr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of ya)if(!fr(r,e))return null}}return`Expected ${Pi(i)} but found ${Pi(e)} instead.`}function Jr(i,e){return e.some(r=>r.kind===i.kind)}function Qr(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}var va,$r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function $(i){return(i=Math.round(i))<0?0:i>255?255:i}function L(i){return $(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function O(i){return(e=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:e>1?1:e;var e}function K(i,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?i+(e-i)*r*6:2*r<1?e:3*r<2?i+(e-i)*(2/3-r)*6:i}try{va={}.parseCSSColor=function(i){var e,r=i.replace(/ /g,"").toLowerCase();if(r in $r)return $r[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=r.indexOf("("),p=r.indexOf(")");if(u!==-1&&p+1===r.length){var y=r.substr(0,u),b=r.substr(u+1,p-(u+1)).split(","),I=1;switch(y){case"rgba":if(b.length!==4)return null;I=O(b.pop());case"rgb":return b.length!==3?null:[L(b[0]),L(b[1]),L(b[2]),I];case"hsla":if(b.length!==4)return null;I=O(b.pop());case"hsl":if(b.length!==3)return null;var C=(parseFloat(b[0])%360+360)%360/360,D=O(b[1]),B=O(b[2]),F=B<=.5?B*(D+1):B+D-B*D,U=2*B-F;return[$(255*K(U,F,C+1/3)),$(255*K(U,F,C)),$(255*K(U,F,C-1/3)),I];default:return null}}return null}}catch{}class J{constructor(e,r,u,p=1){this.r=e,this.g=r,this.b=u,this.a=p}static parse(e){if(!e)return;if(e instanceof J)return e;if(typeof e!="string")return;const r=va(e);return r?new J(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,u,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(u)},${p})`}toArray(){const{r:e,g:r,b:u,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*r/p,255*u/p,p]}}J.black=new J(0,0,0,1),J.white=new J(1,1,1,1),J.transparent=new J(0,0,0,0),J.red=new J(1,0,0,1);class fe{constructor(e,r,u){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class we{constructor(e,r,u,p,y){this.text=e,this.image=r,this.scale=u,this.fontStack=p,this.textColor=y}}class ye{constructor(e){this.sections=e}static fromString(e){return new ye([new we(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ye?e:ye.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class pe{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof pe)return e;if(typeof e=="number")return new pe([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new pe(e)}}toString(){return JSON.stringify(this.values)}}class Ie{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ie({name:e,available:!1}):null}}function qe(i,e,r,u){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,e,r,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,e,r,u]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function st(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof J||i instanceof fe||i instanceof ye||i instanceof pe||i instanceof Ie)return!0;if(Array.isArray(i)){for(const e of i)if(!st(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!st(i[e]))return!1;return!0}return!1}function Ue(i){if(i===null)return Or;if(typeof i=="string")return ci;if(typeof i=="boolean")return ri;if(typeof i=="number")return bt;if(i instanceof J)return bn;if(i instanceof fe)return Tr;if(i instanceof ye)return fn;if(i instanceof pe)return _a;if(i instanceof Ie)return rn;if(Array.isArray(i)){const e=i.length;let r;for(const u of i){const p=Ue(u);if(r){if(r===p)continue;r=ii;break}r=p}return Sn(r||ii,e)}return Vr}function Rt(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof J||i instanceof ye||i instanceof pe||i instanceof Ie?i.toString():JSON.stringify(i)}class Ot{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!st(e[1]))return r.error("invalid value");const u=e[1];let p=Ue(u);const y=r.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Ot(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class St{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Wt={string:ci,number:bt,boolean:ri,object:Vr};class Kt{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let u,p=1;const y=e[0];if(y==="array"){let I,C;if(e.length>2){const D=e[1];if(typeof D!="string"||!(D in Wt)||D==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);I=Wt[D],p++}else I=ii;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);C=e[2],p++}u=Sn(I,C)}else{if(!Wt[y])throw new Error(`Types doesn't contain name = ${y}`);u=Wt[y]}const b=[];for(;p<e.length;p++){const I=r.parse(e[p],p,ii);if(!I)return null;b.push(I)}return new Kt(u,b)}evaluate(e){for(let r=0;r<this.args.length;r++){const u=this.args[r].evaluate(e);if(!fr(this.type,Ue(u)))return u;if(r===this.args.length-1)throw new St(`Expected value to be of type ${Pi(this.type)}, but found ${Pi(Ue(u))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ii={"to-boolean":ri,"to-color":bn,"to-number":bt,"to-string":ci};class ti{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const u=e[0];if(!Ii[u])throw new Error(`Can't parse ${u} as it is not part of the known types`);if((u==="to-boolean"||u==="to-string")&&e.length!==2)return r.error("Expected one argument.");const p=Ii[u],y=[];for(let b=1;b<e.length;b++){const I=r.parse(e[b],b,ii);if(!I)return null;y.push(I)}return new ti(p,y)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,u;for(const p of this.args){if(r=p.evaluate(e),u=null,r instanceof J)return r;if(typeof r=="string"){const y=e.parseColor(r);if(y)return y}else if(Array.isArray(r)&&(u=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:qe(r[0],r[1],r[2],r[3]),!u))return new J(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new St(u||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const u of this.args){r=u.evaluate(e);const p=pe.parse(r);if(p)return p}throw new St(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const u of this.args){if(r=u.evaluate(e),r===null)return 0;const p=Number(r);if(!isNaN(p))return p}throw new St(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?ye.fromString(Rt(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ie.fromString(Rt(this.args[0].evaluate(e))):Rt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ui=["Unknown","Point","LineString","Polygon"];class ki{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ui[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=J.parse(e)),r}}class Ri{constructor(e,r,u,p){this.name=e,this.type=r,this._evaluate=u,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const u=e[0],p=Ri.definitions[u];if(!p)return r.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,I=b.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let C=null;for(const[D,B]of I){C=new wa(r.registry,r.path,null,r.scope);const F=[];let U=!1;for(let j=1;j<e.length;j++){const X=e[j],ue=Array.isArray(D)?D[j-1]:D.type,le=C.parse(X,1+F.length,ue);if(!le){U=!0;break}F.push(le)}if(!U)if(Array.isArray(D)&&D.length!==F.length)C.error(`Expected ${D.length} arguments, but found ${F.length} instead.`);else{for(let j=0;j<F.length;j++){const X=Array.isArray(D)?D[j]:D.type,ue=F[j];C.concat(j+1).checkSubtype(X,ue.type)}if(C.errors.length===0)return new Ri(u,y,B,F)}}if(I.length===1)r.errors.push(...C.errors);else{const D=(I.length?I:b).map(([F])=>{return U=F,Array.isArray(U)?`(${U.map(Pi).join(", ")})`:`(${Pi(U.type)}...)`;var U}).join(" | "),B=[];for(let F=1;F<e.length;F++){const U=r.parse(e[F],1+B.length);if(!U)return null;B.push(Pi(U.type))}r.error(`Expected arguments of type ${D}, but found (${B.join(", ")}) instead.`)}return null}static register(e,r){Ri.definitions=r;for(const u in r)e[u]=Ri}}class pn{constructor(e,r,u){this.type=Tr,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return r.error("Collator options argument must be an object.");const p=r.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,ri);if(!p)return null;const y=r.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,ri);if(!y)return null;let b=null;return u.locale&&(b=r.parse(u.locale,1,ci),!b)?null:new pn(p,y,b)}evaluate(e){return new fe(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Gi=8192;function In(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ba(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Na(i,e){const r=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(r*p*Gi),Math.round(u*p*Gi)]}function Fi(i,e,r){const u=i[0]-e[0],p=i[1]-e[1],y=i[0]-r[0],b=i[1]-r[1];return u*b-y*p==0&&u*y<=0&&p*b<=0}function io(i,e){let r=!1;for(let b=0,I=e.length;b<I;b++){const C=e[b];for(let D=0,B=C.length;D<B-1;D++){if(Fi(i,C[D],C[D+1]))return!1;(p=C[D])[1]>(u=i)[1]!=(y=C[D+1])[1]>u[1]&&u[0]<(y[0]-p[0])*(u[1]-p[1])/(y[1]-p[1])+p[0]&&(r=!r)}}var u,p,y;return r}function no(i,e){for(let r=0;r<e.length;r++)if(io(i,e[r]))return!0;return!1}function ml(i,e,r,u){const p=u[0]-r[0],y=u[1]-r[1],b=(i[0]-r[0])*y-p*(i[1]-r[1]),I=(e[0]-r[0])*y-p*(e[1]-r[1]);return b>0&&I<0||b<0&&I>0}function gl(i,e,r){for(const D of r)for(let B=0;B<D.length-1;++B)if((I=[(b=D[B+1])[0]-(y=D[B])[0],b[1]-y[1]])[0]*(C=[(p=e)[0]-(u=i)[0],p[1]-u[1]])[1]-I[1]*C[0]!=0&&ml(u,p,y,b)&&ml(y,b,u,p))return!0;var u,p,y,b,I,C;return!1}function ro(i,e){for(let r=0;r<i.length;++r)if(!io(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(gl(i[r],i[r+1],e))return!1;return!0}function Vc(i,e){for(let r=0;r<e.length;r++)if(ro(i,e[r]))return!0;return!1}function ys(i,e,r){const u=[];for(let p=0;p<i.length;p++){const y=[];for(let b=0;b<i[p].length;b++){const I=Na(i[p][b],r);In(e,I),y.push(I)}u.push(y)}return u}function ao(i,e,r){const u=[];for(let p=0;p<i.length;p++){const y=ys(i[p],e,r);u.push(y)}return u}function _l(i,e,r,u){if(i[0]<r[0]||i[0]>r[2]){const p=.5*u;let y=i[0]-r[0]>p?-u:r[0]-i[0]>p?u:0;y===0&&(y=i[0]-r[2]>p?-u:r[2]-i[0]>p?u:0),i[0]+=y}In(e,i)}function yl(i,e,r,u){const p=Math.pow(2,u.z)*Gi,y=[u.x*Gi,u.y*Gi],b=[];for(const I of i)for(const C of I){const D=[C.x+y[0],C.y+y[1]];_l(D,e,r,p),b.push(D)}return b}function vl(i,e,r,u){const p=Math.pow(2,u.z)*Gi,y=[u.x*Gi,u.y*Gi],b=[];for(const C of i){const D=[];for(const B of C){const F=[B.x+y[0],B.y+y[1]];In(e,F),D.push(F)}b.push(D)}if(e[2]-e[0]<=p/2){(I=e)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const C of b)for(const D of C)_l(D,e,r,p)}var I;return b}class ea{constructor(e,r){this.type=ri,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(st(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let p=0;p<u.features.length;++p){const y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ea(u,u.features[p].geometry)}else if(u.type==="Feature"){const p=u.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ea(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ea(u,u)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=r.canonicalID();if(u.type==="Polygon"){const I=ys(u.coordinates,y,b),C=yl(r.geometry(),p,y,b);if(!ba(p,y))return!1;for(const D of C)if(!io(D,I))return!1}if(u.type==="MultiPolygon"){const I=ao(u.coordinates,y,b),C=yl(r.geometry(),p,y,b);if(!ba(p,y))return!1;for(const D of C)if(!no(D,I))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=r.canonicalID();if(u.type==="Polygon"){const I=ys(u.coordinates,y,b),C=vl(r.geometry(),p,y,b);if(!ba(p,y))return!1;for(const D of C)if(!ro(D,I))return!1}if(u.type==="MultiPolygon"){const I=ao(u.coordinates,y,b),C=vl(r.geometry(),p,y,b);if(!ba(p,y))return!1;for(const D of C)if(!Vc(D,I))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Ua(i){if(i instanceof Ri&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ea)return!1;let e=!0;return i.eachChild(r=>{e&&!Ua(r)&&(e=!1)}),e}function xa(i){if(i instanceof Ri&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!xa(r)&&(e=!1)}),e}function vs(i,e){if(i instanceof Ri&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(u=>{r&&!vs(u,e)&&(r=!1)}),r}class bs{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const u=e[1];return r.scope.has(u)?new bs(u,r.scope.get(u)):r.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class wa{constructor(e,r=[],u,p=new Un,y=[]){this.registry=e,this.path=r,this.key=r.map(b=>`[${b}]`).join(""),this.scope=p,this.errors=y,this.expectedType=u}parse(e,r,u,p,y={}){return r?this.concat(r,u,p)._parse(e,y):this._parse(e,y)}_parse(e,r){function u(p,y,b){return b==="assert"?new Kt(y,[p]):b==="coerce"?new ti(y,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let b=y.parse(e,this);if(!b)return null;if(this.expectedType){const I=this.expectedType,C=b.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||C.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(I.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array"){if(this.checkSubtype(I,C))return null}else b=u(b,I,r.typeAnnotation||"coerce");else b=u(b,I,r.typeAnnotation||"coerce");else b=u(b,I,r.typeAnnotation||"assert")}if(!(b instanceof Ot)&&b.type.kind!=="resolvedImage"&&so(b)){const I=new ki;try{b=new Ot(b.type,b.evaluate(I))}catch(C){return this.error(C.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,u){const p=typeof e=="number"?this.path.concat(e):this.path,y=u?this.scope.concat(u):this.scope;return new wa(this.registry,p,r||null,y,this.errors)}error(e,...r){const u=`${this.key}${r.map(p=>`[${p}]`).join("")}`;this.errors.push(new Nn(u,e))}checkSubtype(e,r){const u=fr(e,r);return u&&this.error(u),u}}function so(i){if(i instanceof bs)return so(i.boundExpression);if(i instanceof Ri&&i.name==="error"||i instanceof pn||i instanceof ea)return!1;const e=i instanceof ti||i instanceof Kt;let r=!0;return i.eachChild(u=>{r=e?r&&so(u):r&&u instanceof Ot}),!!r&&Ua(i)&&vs(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function xs(i,e){const r=i.length-1;let u,p,y=0,b=r,I=0;for(;y<=b;)if(I=Math.floor((y+b)/2),u=i[I],p=i[I+1],u<=e){if(I===r||e<p)return I;y=I+1}else{if(!(u>e))throw new St("Input is not a number.");b=I-1}return 0}class qa{constructor(e,r,u){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[p,y]of u)this.labels.push(p),this.outputs.push(y)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const u=r.parse(e[1],1,bt);if(!u)return null;const p=[];let y=null;r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let b=1;b<e.length;b+=2){const I=b===1?-1/0:e[b],C=e[b+1],D=b,B=b+1;if(typeof I!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=I)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const F=r.parse(C,B,y);if(!F)return null;y=y||F.type,p.push([I,F])}return new qa(y,u,p)}evaluate(e){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return u[0].evaluate(e);const y=r.length;return p>=r[y-1]?u[y-1].evaluate(e):u[xs(r,p)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function ji(i,e,r){return i*(1-r)+e*r}var Ga=Object.freeze({__proto__:null,number:ji,color:function(i,e,r){return new J(ji(i.r,e.r,r),ji(i.g,e.g,r),ji(i.b,e.b,r),ji(i.a,e.a,r))},array:function(i,e,r){return i.map((u,p)=>ji(u,e[p],r))},padding:function(i,e,r){const u=i.values,p=e.values;return new pe([ji(u[0],p[0],r),ji(u[1],p[1],r),ji(u[2],p[2],r),ji(u[3],p[3],r)])}});const bl=.95047,xl=1.08883,oo=4/29,ws=6/29,wl=3*ws*ws,Nc=Math.PI/180,Uc=180/Math.PI;function lo(i){return i>.008856451679035631?Math.pow(i,1/3):i/wl+oo}function co(i){return i>ws?i*i*i:wl*(i-oo)}function uo(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ho(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ai(i){const e=ho(i.r),r=ho(i.g),u=ho(i.b),p=lo((.4124564*e+.3575761*r+.1804375*u)/bl),y=lo((.2126729*e+.7151522*r+.072175*u)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-lo((.0193339*e+.119192*r+.9503041*u)/xl)),alpha:i.a}}function Il(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,u=isNaN(i.b)?e:e-i.b/200;return e=1*co(e),r=bl*co(r),u=xl*co(u),new J(uo(3.2404542*r-1.5371385*e-.4985314*u),uo(-.969266*r+1.8760108*e+.041556*u),uo(.0556434*r-.2040259*e+1.0572252*u),i.alpha)}function qc(i,e,r){const u=e-i;return i+r*(u>180||u<-180?u-360*Math.round(u/360):u)}const ja={forward:Ai,reverse:Il,interpolate:function(i,e,r){return{l:ji(i.l,e.l,r),a:ji(i.a,e.a,r),b:ji(i.b,e.b,r),alpha:ji(i.alpha,e.alpha,r)}}},Za={forward:function(i){const{l:e,a:r,b:u}=Ai(i),p=Math.atan2(u,r)*Uc;return{h:p<0?p+360:p,c:Math.sqrt(r*r+u*u),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Nc,r=i.c;return Il({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:qc(i.h,e.h,r),c:ji(i.c,e.c,r),l:ji(i.l,e.l,r),alpha:ji(i.alpha,e.alpha,r)}}};var kl=Object.freeze({__proto__:null,lab:ja,hcl:Za});class qn{constructor(e,r,u,p,y){this.type=e,this.operator=r,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[b,I]of y)this.labels.push(b),this.outputs.push(I)}static interpolationFactor(e,r,u,p){let y=0;if(e.name==="exponential")y=fo(r,e.base,u,p);else if(e.name==="linear")y=fo(r,1,u,p);else if(e.name==="cubic-bezier"){const b=e.controlPoints;y=new x(b[0],b[1],b[2],b[3]).solve(fo(r,1,u,p))}return y}static parse(e,r){let[u,p,y,...b]=e;if(!Array.isArray(p)||p.length===0)return r.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const D=p[1];if(typeof D!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:D}}else{if(p[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const D=p.slice(1);if(D.length!==4||D.some(B=>typeof B!="number"||B<0||B>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(y=r.parse(y,2,bt),!y)return null;const I=[];let C=null;u==="interpolate-hcl"||u==="interpolate-lab"?C=bn:r.expectedType&&r.expectedType.kind!=="value"&&(C=r.expectedType);for(let D=0;D<b.length;D+=2){const B=b[D],F=b[D+1],U=D+3,j=D+4;if(typeof B!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(I.length&&I[I.length-1][0]>=B)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const X=r.parse(F,j,C);if(!X)return null;C=C||X.type,I.push([B,X])}return C.kind==="number"||C.kind==="color"||C.kind==="padding"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new qn(C,u,p,y,I):r.error(`Type ${Pi(C)} is not interpolatable.`)}evaluate(e){const r=this.labels,u=this.outputs;if(r.length===1)return u[0].evaluate(e);const p=this.input.evaluate(e);if(p<=r[0])return u[0].evaluate(e);const y=r.length;if(p>=r[y-1])return u[y-1].evaluate(e);const b=xs(r,p),I=qn.interpolationFactor(this.interpolation,p,r[b],r[b+1]),C=u[b].evaluate(e),D=u[b+1].evaluate(e);return this.operator==="interpolate"?Ga[this.type.kind.toLowerCase()](C,D,I):this.operator==="interpolate-hcl"?Za.reverse(Za.interpolate(Za.forward(C),Za.forward(D),I)):ja.reverse(ja.interpolate(ja.forward(C),ja.forward(D),I))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function fo(i,e,r,u){const p=u-r,y=i-r;return p===0?0:e===1?y/p:(Math.pow(e,y)-1)/(Math.pow(e,p)-1)}class Is{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let u=null;const p=r.expectedType;p&&p.kind!=="value"&&(u=p);const y=[];for(const I of e.slice(1)){const C=r.parse(I,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!C)return null;u=u||C.type,y.push(C)}if(!u)throw new Error("No output type");const b=p&&y.some(I=>fr(p,I.type));return new Is(b?ii:u,y)}evaluate(e){let r,u=null,p=0;for(const y of this.args)if(p++,u=y.evaluate(e),u&&u instanceof Ie&&!u.available&&(r||(r=u.name),u=null,p===this.args.length&&(u=r)),u!==null)break;return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class ks{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let y=1;y<e.length-1;y+=2){const b=e[y];if(typeof b!="string")return r.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return r.error("Variable names must contain only alphanumeric characters or '_'.",y);const I=r.parse(e[y+1],y+1);if(!I)return null;u.push([b,I])}const p=r.parse(e[e.length-1],e.length-1,r.expectedType,u);return p?new ks(u,p):null}outputDefined(){return this.result.outputDefined()}}class po{constructor(e,r,u){this.type=e,this.index=r,this.input=u}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=r.parse(e[1],1,bt),p=r.parse(e[2],2,Sn(r.expectedType||ii));return u&&p?new po(p.type.itemType,u,p):null}evaluate(e){const r=this.index.evaluate(e),u=this.input.evaluate(e);if(r<0)throw new St(`Array index out of bounds: ${r} < 0.`);if(r>=u.length)throw new St(`Array index out of bounds: ${r} > ${u.length-1}.`);if(r!==Math.floor(r))throw new St(`Array index must be an integer, but found ${r} instead.`);return u[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class mo{constructor(e,r){this.type=ri,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=r.parse(e[1],1,ii),p=r.parse(e[2],2,ii);return u&&p?Jr(u.type,[ri,ci,bt,Or,ii])?new mo(u,p):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(u.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!u)return!1;if(!Qr(r,["boolean","string","number","null"]))throw new St(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(Ue(r))} instead.`);if(!Qr(u,["string","array"]))throw new St(`Expected second argument to be of type array or string, but found ${Pi(Ue(u))} instead.`);return u.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ts{constructor(e,r,u){this.type=bt,this.needle=e,this.haystack=r,this.fromIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=r.parse(e[1],1,ii),p=r.parse(e[2],2,ii);if(!u||!p)return null;if(!Jr(u.type,[ri,ci,bt,Or,ii]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(u.type)} instead`);if(e.length===4){const y=r.parse(e[3],3,bt);return y?new Ts(u,p,y):null}return new Ts(u,p)}evaluate(e){const r=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Qr(r,["boolean","string","number","null"]))throw new St(`Expected first argument to be of type boolean, string, number or null, but found ${Pi(Ue(r))} instead.`);if(!Qr(u,["string","array"]))throw new St(`Expected second argument to be of type array or string, but found ${Pi(Ue(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return u.indexOf(r,p)}return u.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class go{constructor(e,r,u,p,y,b){this.inputType=e,this.type=r,this.input=u,this.cases=p,this.outputs=y,this.otherwise=b}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let u,p;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);const y={},b=[];for(let D=2;D<e.length-1;D+=2){let B=e[D];const F=e[D+1];Array.isArray(B)||(B=[B]);const U=r.concat(D);if(B.length===0)return U.error("Expected at least one branch label.");for(const X of B){if(typeof X!="number"&&typeof X!="string")return U.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return U.error("Numeric branch labels must be integer values.");if(u){if(U.checkSubtype(u,Ue(X)))return null}else u=Ue(X);if(y[String(X)]!==void 0)return U.error("Branch labels must be unique.");y[String(X)]=b.length}const j=r.parse(F,D,p);if(!j)return null;p=p||j.type,b.push(j)}const I=r.parse(e[1],1,ii);if(!I)return null;const C=r.parse(e[e.length-1],e.length-1,p);return C?I.type.kind!=="value"&&r.concat(1).checkSubtype(u,I.type)?null:new go(u,p,I,y,b,C):null}evaluate(e){const r=this.input.evaluate(e);return(Ue(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class _o{constructor(e,r,u){this.type=e,this.branches=r,this.otherwise=u}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const p=[];for(let b=1;b<e.length-1;b+=2){const I=r.parse(e[b],b,ri);if(!I)return null;const C=r.parse(e[b+1],b+1,u);if(!C)return null;p.push([I,C]),u=u||C.type}const y=r.parse(e[e.length-1],e.length-1,u);if(!y)return null;if(!u)throw new Error("Can't infer output type");return new _o(u,p,y)}evaluate(e){for(const[r,u]of this.branches)if(r.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,u]of this.branches)e(r),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class Es{constructor(e,r,u,p){this.type=e,this.input=r,this.beginIndex=u,this.endIndex=p}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=r.parse(e[1],1,ii),p=r.parse(e[2],2,bt);if(!u||!p)return null;if(!Jr(u.type,[Sn(ii),ci,ii]))return r.error(`Expected first argument to be of type array or string, but found ${Pi(u.type)} instead`);if(e.length===4){const y=r.parse(e[3],3,bt);return y?new Es(u.type,u,p,y):null}return new Es(u.type,u,p)}evaluate(e){const r=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Qr(r,["string","array"]))throw new St(`Expected first argument to be of type array or string, but found ${Pi(Ue(r))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return r.slice(u,p)}return r.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Tl(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function El(i,e,r,u){return u.compare(e,r)===0}function Ia(i,e,r){const u=i!=="=="&&i!=="!=";return class _m{constructor(y,b,I){this.type=ri,this.lhs=y,this.rhs=b,this.collator=I,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}static parse(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");const I=y[0];let C=b.parse(y[1],1,ii);if(!C)return null;if(!Tl(I,C.type))return b.concat(1).error(`"${I}" comparisons are not supported for type '${Pi(C.type)}'.`);let D=b.parse(y[2],2,ii);if(!D)return null;if(!Tl(I,D.type))return b.concat(2).error(`"${I}" comparisons are not supported for type '${Pi(D.type)}'.`);if(C.type.kind!==D.type.kind&&C.type.kind!=="value"&&D.type.kind!=="value")return b.error(`Cannot compare types '${Pi(C.type)}' and '${Pi(D.type)}'.`);u&&(C.type.kind==="value"&&D.type.kind!=="value"?C=new Kt(D.type,[C]):C.type.kind!=="value"&&D.type.kind==="value"&&(D=new Kt(C.type,[D])));let B=null;if(y.length===4){if(C.type.kind!=="string"&&D.type.kind!=="string"&&C.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(B=b.parse(y[3],3,Tr),!B)return null}return new _m(C,D,B)}evaluate(y){const b=this.lhs.evaluate(y),I=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const C=Ue(b),D=Ue(I);if(C.kind!==D.kind||C.kind!=="string"&&C.kind!=="number")throw new St(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const C=Ue(b),D=Ue(I);if(C.kind!=="string"||D.kind!=="string")return e(y,b,I)}return this.collator?r(y,b,I,this.collator.evaluate(y)):e(y,b,I)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Gc=Ia("==",function(i,e,r){return e===r},El),jc=Ia("!=",function(i,e,r){return e!==r},function(i,e,r,u){return!El(0,e,r,u)}),Zc=Ia("<",function(i,e,r){return e<r},function(i,e,r,u){return u.compare(e,r)<0}),Xc=Ia(">",function(i,e,r){return e>r},function(i,e,r,u){return u.compare(e,r)>0}),Wc=Ia("<=",function(i,e,r){return e<=r},function(i,e,r,u){return u.compare(e,r)<=0}),Hc=Ia(">=",function(i,e,r){return e>=r},function(i,e,r,u){return u.compare(e,r)>=0});class yo{constructor(e,r,u,p,y){this.type=ci,this.number=e,this.locale=r,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const u=r.parse(e[1],1,bt);if(!u)return null;const p=e[2];if(typeof p!="object"||Array.isArray(p))return r.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=r.parse(p.locale,1,ci),!y))return null;let b=null;if(p.currency&&(b=r.parse(p.currency,1,ci),!b))return null;let I=null;if(p["min-fraction-digits"]&&(I=r.parse(p["min-fraction-digits"],1,bt),!I))return null;let C=null;return p["max-fraction-digits"]&&(C=r.parse(p["max-fraction-digits"],1,bt),!C)?null:new yo(u,y,b,I,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class As{constructor(e){this.type=fn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return r.error("First argument must be an image or text section.");const p=[];let y=!1;for(let b=1;b<=e.length-1;++b){const I=e[b];if(y&&typeof I=="object"&&!Array.isArray(I)){y=!1;let C=null;if(I["font-scale"]&&(C=r.parse(I["font-scale"],1,bt),!C))return null;let D=null;if(I["text-font"]&&(D=r.parse(I["text-font"],1,Sn(ci)),!D))return null;let B=null;if(I["text-color"]&&(B=r.parse(I["text-color"],1,bn),!B))return null;const F=p[p.length-1];F.scale=C,F.font=D,F.textColor=B}else{const C=r.parse(e[b],1,ii);if(!C)return null;const D=C.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new As(p)}evaluate(e){return new ye(this.sections.map(r=>{const u=r.content.evaluate(e);return Ue(u)===rn?new we("",u,null,null,null):new we(Rt(u),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class vo{constructor(e){this.type=rn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const u=r.parse(e[1],1,ci);return u?new vo(u):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),u=Ie.fromString(r);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(r)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}}class bo{constructor(e){this.type=bt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=r.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Pi(u.type)} instead.`):new bo(u):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new St(`Expected value to be of type string or array, but found ${Pi(Ue(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const ka={"==":Gc,"!=":jc,">":Xc,"<":Zc,">=":Hc,"<=":Wc,array:Kt,at:po,boolean:Kt,case:_o,coalesce:Is,collator:pn,format:As,image:vo,in:mo,"index-of":Ts,interpolate:qn,"interpolate-hcl":qn,"interpolate-lab":qn,length:bo,let:ks,literal:Ot,match:go,number:Kt,"number-format":yo,object:Kt,slice:Es,step:qa,string:Kt,"to-boolean":ti,"to-color":ti,"to-number":ti,"to-string":ti,var:bs,within:ea};function Al(i,[e,r,u,p]){e=e.evaluate(i),r=r.evaluate(i),u=u.evaluate(i);const y=p?p.evaluate(i):1,b=qe(e,r,u,y);if(b)throw new St(b);return new J(e/255*y,r/255*y,u/255*y,y)}function Sl(i,e){return i in e}function Ss(i,e){const r=e[i];return r===void 0?null:r}function ta(i){return{type:i}}function Cl(i){return{result:"success",value:i}}function Ta(i){return{result:"error",value:i}}function Ui(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ml(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function _i(i){return!!i.expression&&i.expression.interpolated}function Si(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ni(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Zi(i){return i}function Xa(i,e){const r=e.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",p=u||!(u||i.property!==void 0),y=i.type||(_i(e)?"exponential":"interval");if(r||e.type==="padding"){const D=r?J.parse:pe.parse;(i=nr({},i)).stops&&(i.stops=i.stops.map(B=>[B[0],D(B[1])])),i.default=D(i.default?i.default:e.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!kl[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let b,I,C;if(y==="exponential")b=zl;else if(y==="interval")b=Yc;else if(y==="categorical"){b=Kc,I=Object.create(null);for(const D of i.stops)I[D[0]]=D[1];C=typeof i.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=Jc}if(u){const D={},B=[];for(let j=0;j<i.stops.length;j++){const X=i.stops[j],ue=X[0].zoom;D[ue]===void 0&&(D[ue]={zoom:ue,type:i.type,property:i.property,default:i.default,stops:[]},B.push(ue)),D[ue].stops.push([X[0].value,X[1]])}const F=[];for(const j of B)F.push([D[j].zoom,Xa(D[j],e)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:qn.interpolationFactor.bind(void 0,U),zoomStops:F.map(j=>j[0]),evaluate:({zoom:j},X)=>zl({stops:F,base:i.base},e,j).evaluate(j,X)}}if(p){const D=y==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:qn.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(B=>B[0]),evaluate:({zoom:B})=>b(i,e,B,I,C)}}return{kind:"source",evaluate(D,B){const F=B&&B.properties?B.properties[i.property]:void 0;return F===void 0?Ea(i.default,e.default):b(i,e,F,I,C)}}}function Ea(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Kc(i,e,r,u,p){return Ea(typeof r===p?u[r]:void 0,i.default,e.default)}function Yc(i,e,r){if(Si(r)!=="number")return Ea(i.default,e.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const p=xs(i.stops.map(y=>y[0]),r);return i.stops[p][1]}function zl(i,e,r){const u=i.base!==void 0?i.base:1;if(Si(r)!=="number")return Ea(i.default,e.default);const p=i.stops.length;if(p===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[p-1][0])return i.stops[p-1][1];const y=xs(i.stops.map(B=>B[0]),r),b=function(B,F,U,j){const X=j-U,ue=B-U;return X===0?0:F===1?ue/X:(Math.pow(F,ue)-1)/(Math.pow(F,X)-1)}(r,u,i.stops[y][0],i.stops[y+1][0]),I=i.stops[y][1],C=i.stops[y+1][1];let D=Ga[e.type]||Zi;if(i.colorSpace&&i.colorSpace!=="rgb"){const B=kl[i.colorSpace];D=(F,U)=>B.reverse(B.interpolate(B.forward(F),B.forward(U),b))}return typeof I.evaluate=="function"?{evaluate(...B){const F=I.evaluate.apply(void 0,B),U=C.evaluate.apply(void 0,B);if(F!==void 0&&U!==void 0)return D(F,U,b)}}:D(I,C,b)}function Jc(i,e,r){switch(e.type){case"color":r=J.parse(r);break;case"formatted":r=ye.fromString(r.toString());break;case"resolvedImage":r=Ie.fromString(r.toString());break;case"padding":r=pe.parse(r);break;default:Si(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Ea(r,i.default,e.default)}Ri.register(ka,{error:[{kind:"error"},[ci],(i,[e])=>{throw new St(e.evaluate(i))}],typeof:[ci,[ii],(i,[e])=>Pi(Ue(e.evaluate(i)))],"to-rgba":[Sn(bt,4),[bn],(i,[e])=>e.evaluate(i).toArray()],rgb:[bn,[bt,bt,bt],Al],rgba:[bn,[bt,bt,bt,bt],Al],has:{type:ri,overloads:[[[ci],(i,[e])=>Sl(e.evaluate(i),i.properties())],[[ci,Vr],(i,[e,r])=>Sl(e.evaluate(i),r.evaluate(i))]]},get:{type:ii,overloads:[[[ci],(i,[e])=>Ss(e.evaluate(i),i.properties())],[[ci,Vr],(i,[e,r])=>Ss(e.evaluate(i),r.evaluate(i))]]},"feature-state":[ii,[ci],(i,[e])=>Ss(e.evaluate(i),i.featureState||{})],properties:[Vr,[],i=>i.properties()],"geometry-type":[ci,[],i=>i.geometryType()],id:[ii,[],i=>i.id()],zoom:[bt,[],i=>i.globals.zoom],"heatmap-density":[bt,[],i=>i.globals.heatmapDensity||0],"line-progress":[bt,[],i=>i.globals.lineProgress||0],accumulated:[ii,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[bt,ta(bt),(i,e)=>{let r=0;for(const u of e)r+=u.evaluate(i);return r}],"*":[bt,ta(bt),(i,e)=>{let r=1;for(const u of e)r*=u.evaluate(i);return r}],"-":{type:bt,overloads:[[[bt,bt],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[bt],(i,[e])=>-e.evaluate(i)]]},"/":[bt,[bt,bt],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[bt,[bt,bt],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[bt,[bt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[bt,[bt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[bt,[bt],(i,[e])=>Math.log(e.evaluate(i))],log2:[bt,[bt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[bt,[bt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[bt,[bt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[bt,[bt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[bt,[bt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[bt,[bt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[bt,[bt],(i,[e])=>Math.atan(e.evaluate(i))],min:[bt,ta(bt),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[bt,ta(bt),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[bt,[bt],(i,[e])=>Math.abs(e.evaluate(i))],round:[bt,[bt],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[bt,[bt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[bt,[bt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ri,[ci,ii],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[ri,[ii],(i,[e])=>i.id()===e.value],"filter-type-==":[ri,[ci],(i,[e])=>i.geometryType()===e.value],"filter-<":[ri,[ci,ii],(i,[e,r])=>{const u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u<p}],"filter-id-<":[ri,[ii],(i,[e])=>{const r=i.id(),u=e.value;return typeof r==typeof u&&r<u}],"filter->":[ri,[ci,ii],(i,[e,r])=>{const u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u>p}],"filter-id->":[ri,[ii],(i,[e])=>{const r=i.id(),u=e.value;return typeof r==typeof u&&r>u}],"filter-<=":[ri,[ci,ii],(i,[e,r])=>{const u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[ri,[ii],(i,[e])=>{const r=i.id(),u=e.value;return typeof r==typeof u&&r<=u}],"filter->=":[ri,[ci,ii],(i,[e,r])=>{const u=i.properties()[e.value],p=r.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[ri,[ii],(i,[e])=>{const r=i.id(),u=e.value;return typeof r==typeof u&&r>=u}],"filter-has":[ri,[ii],(i,[e])=>e.value in i.properties()],"filter-has-id":[ri,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ri,[Sn(ci)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ri,[Sn(ii)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ri,[ci,Sn(ii)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ri,[ci,Sn(ii)],(i,[e,r])=>function(u,p,y,b){for(;y<=b;){const I=y+b>>1;if(p[I]===u)return!0;p[I]>u?b=I-1:y=I+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:ri,overloads:[[[ri,ri],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[ta(ri),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:ri,overloads:[[[ri,ri],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[ta(ri),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[ri,[ri],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ri,[ci],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ci,[ci],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ci,[ci],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ci,ta(ii),(i,e)=>e.map(r=>Rt(r.evaluate(i))).join("")],"resolved-locale":[ci,[Tr],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Cs{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new ki,this._defaultValue=r?function(u){return u.type==="color"&&Ni(u.default)?new J(0,0,0,0):u.type==="color"?J.parse(u.default)||null:u.type==="padding"?pe.parse(u.default)||null:u.default===void 0?null:u.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,u,p,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(e,r,u,p,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new St(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Wa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ka}function Ha(i,e){const r=new wa(ka,[],e?function(p){const y={color:bn,string:ci,number:bt,enum:ci,boolean:ri,formatted:fn,padding:_a,resolvedImage:rn};return p.type==="array"?Sn(y[p.value]||ii,p.length):y[p.type]}(e):void 0),u=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Cl(new Cs(u,e)):Ta(r.errors)}class Ka{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!xa(r.expression)}evaluateWithoutErrorHandling(e,r,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(e,r,u,p,y,b)}evaluate(e,r,u,p,y,b){return this._styleExpression.evaluate(e,r,u,p,y,b)}}class xo{constructor(e,r,u,p){this.kind=e,this.zoomStops=u,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!xa(r.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,r,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(e,r,u,p,y,b)}evaluate(e,r,u,p,y,b){return this._styleExpression.evaluate(e,r,u,p,y,b)}interpolationFactor(e,r,u){return this.interpolationType?qn.interpolationFactor(this.interpolationType,e,r,u):0}}function Dl(i,e){const r=Ha(i,e);if(r.result==="error")return r;const u=r.value.expression,p=Ua(u);if(!p&&!Ui(e))return Ta([new Nn("","data expressions not supported")]);const y=vs(u,["zoom"]);if(!y&&!Ml(e))return Ta([new Nn("","zoom expressions not supported")]);const b=zs(u);return b||y?b instanceof Nn?Ta([b]):b instanceof qn&&!_i(e)?Ta([new Nn("",'"interpolate" expressions cannot be used with this property')]):Cl(b?new xo(p?"camera":"composite",r.value,b.labels,b instanceof qn?b.interpolation:void 0):new Ka(p?"constant":"source",r.value)):Ta([new Nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ms{constructor(e,r){this._parameters=e,this._specification=r,nr(this,Xa(this._parameters,this._specification))}static deserialize(e){return new Ms(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zs(i){let e=null;if(i instanceof ks)e=zs(i.result);else if(i instanceof Is){for(const r of i.args)if(e=zs(r),e)break}else(i instanceof qa||i instanceof qn)&&i.input instanceof Ri&&i.input.name==="zoom"&&(e=i);return e instanceof Nn||i.eachChild(r=>{const u=zs(r);u instanceof Nn?e=u:!e&&u?e=new Nn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new Nn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function rr(i){const e=i.key,r=i.value,u=i.valueSpec||{},p=i.objectElementValidators||{},y=i.style,b=i.styleSpec;let I=[];const C=Si(r);if(C!=="object")return[new It(e,r,`object expected, ${C} found`)];for(const D in r){const B=D.split(".")[0],F=u[B]||u["*"];let U;if(p[B])U=p[B];else if(u[B])U=jn;else if(p["*"])U=p["*"];else{if(!u["*"]){I.push(new It(e,r[D],`unknown property "${D}"`));continue}U=jn}I=I.concat(U({key:(e&&`${e}.`)+D,value:r[D],valueSpec:F,style:y,styleSpec:b,object:r,objectKey:D},r))}for(const D in u)p[D]||u[D].required&&u[D].default===void 0&&r[D]===void 0&&I.push(new It(e,r,`missing required property "${D}"`));return I}function Pl(i){const e=i.value,r=i.valueSpec,u=i.style,p=i.styleSpec,y=i.key,b=i.arrayElementValidator||jn;if(Si(e)!=="array")return[new It(y,e,`array expected, ${Si(e)} found`)];if(r.length&&e.length!==r.length)return[new It(y,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new It(y,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let I={type:r.value,values:r.values};p.$version<7&&(I.function=r.function),Si(r.value)==="object"&&(I=r.value);let C=[];for(let D=0;D<e.length;D++)C=C.concat(b({array:e,arrayIndex:D,value:e[D],valueSpec:I,style:u,styleSpec:p,key:`${y}[${D}]`}));return C}function wo(i){const e=i.key,r=i.value,u=i.valueSpec;let p=Si(r);return p==="number"&&r!=r&&(p="NaN"),p!=="number"?[new It(e,r,`number expected, ${p} found`)]:"minimum"in u&&r<u.minimum?[new It(e,r,`${r} is less than the minimum value ${u.minimum}`)]:"maximum"in u&&r>u.maximum?[new It(e,r,`${r} is greater than the maximum value ${u.maximum}`)]:[]}function Ll(i){const e=i.valueSpec,r=wi(i.value.type);let u,p,y,b={};const I=r!=="categorical"&&i.value.property===void 0,C=!I,D=Si(i.value.stops)==="array"&&Si(i.value.stops[0])==="array"&&Si(i.value.stops[0][0])==="object",B=rr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(j){if(r==="identity")return[new It(j.key,j.value,'identity function may not have a "stops" property')];let X=[];const ue=j.value;return X=X.concat(Pl({key:j.key,value:ue,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),Si(ue)==="array"&&ue.length===0&&X.push(new It(j.key,ue,"array must have at least one stop")),X},default:function(j){return jn({key:j.key,value:j.value,valueSpec:e,style:j.style,styleSpec:j.styleSpec})}}});return r==="identity"&&I&&B.push(new It(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||B.push(new It(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!_i(i.valueSpec)&&B.push(new It(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!Ui(i.valueSpec)?B.push(new It(i.key,i.value,"property functions not supported")):I&&!Ml(i.valueSpec)&&B.push(new It(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!D||i.value.property!==void 0||B.push(new It(i.key,i.value,'"property" property is required')),B;function F(j){let X=[];const ue=j.value,le=j.key;if(Si(ue)!=="array")return[new It(le,ue,`array expected, ${Si(ue)} found`)];if(ue.length!==2)return[new It(le,ue,`array length 2 expected, length ${ue.length} found`)];if(D){if(Si(ue[0])!=="object")return[new It(le,ue,`object expected, ${Si(ue[0])} found`)];if(ue[0].zoom===void 0)return[new It(le,ue,"object stop key must have zoom")];if(ue[0].value===void 0)return[new It(le,ue,"object stop key must have value")];if(y&&y>wi(ue[0].zoom))return[new It(le,ue[0].zoom,"stop zoom values must appear in ascending order")];wi(ue[0].zoom)!==y&&(y=wi(ue[0].zoom),p=void 0,b={}),X=X.concat(rr({key:`${le}[0]`,value:ue[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:wo,value:U}}))}else X=X.concat(U({key:`${le}[0]`,value:ue[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},ue));return Wa(Jn(ue[1]))?X.concat([new It(`${le}[1]`,ue[1],"expressions are not allowed in function stops.")]):X.concat(jn({key:`${le}[1]`,value:ue[1],valueSpec:e,style:j.style,styleSpec:j.styleSpec}))}function U(j,X){const ue=Si(j.value),le=wi(j.value),Ce=j.value!==null?j.value:X;if(u){if(ue!==u)return[new It(j.key,Ce,`${ue} stop domain type must match previous stop domain type ${u}`)]}else u=ue;if(ue!=="number"&&ue!=="string"&&ue!=="boolean")return[new It(j.key,Ce,"stop domain value must be a number, string, or boolean")];if(ue!=="number"&&r!=="categorical"){let Ne=`number expected, ${ue} found`;return Ui(e)&&r===void 0&&(Ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(j.key,Ce,Ne)]}return r!=="categorical"||ue!=="number"||isFinite(le)&&Math.floor(le)===le?r!=="categorical"&&ue==="number"&&p!==void 0&&le<p?[new It(j.key,Ce,"stop domain values must appear in ascending order")]:(p=le,r==="categorical"&&le in b?[new It(j.key,Ce,"stop domain values must be unique")]:(b[le]=!0,[])):[new It(j.key,Ce,`integer expected, found ${le}`)]}}function ia(i){const e=(i.expressionContext==="property"?Dl:Ha)(Jn(i.value),i.valueSpec);if(e.result==="error")return e.value.map(u=>new It(`${i.key}${u.key}`,i.value,u.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new It(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!xa(r))return[new It(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!xa(r))return[new It(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!vs(r,["zoom","feature-state"]))return[new It(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ua(r))return[new It(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ya(i){const e=i.key,r=i.value,u=i.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(wi(r))===-1&&p.push(new It(e,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(wi(r))===-1&&p.push(new It(e,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Aa(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Aa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Qc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ds(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Aa(i)||(i=Ja(i));const e=Ha(i,Qc);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,u,p)=>e.value.evaluate(r,u,{},p),needGeometry:Rl(i)}}function Bl(i,e){return i<e?-1:i>e?1:0}function Rl(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Rl(i[e]))return!0;return!1}function Ja(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Io(i[1],i[2],"=="):e==="!="?Sa(Io(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Io(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Ja))):e==="all"?["all"].concat(i.slice(1).map(Ja)):e==="none"?["all"].concat(i.slice(1).map(Ja).map(Sa)):e==="in"?Ps(i[1],i.slice(2)):e==="!in"?Sa(Ps(i[1],i.slice(2))):e==="has"?Qa(i[1]):e==="!has"?Sa(Qa(i[1])):e!=="within"||i;var r}function Io(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Ps(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Bl)]]:["filter-in-small",i,["literal",e]]}}function Qa(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Sa(i){return["!",i]}function $a(i){return Aa(Jn(i.value))?ia(nr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fl(i)}function Fl(i){const e=i.value,r=i.key;if(Si(e)!=="array")return[new It(r,e,`array expected, ${Si(e)} found`)];const u=i.styleSpec;let p,y=[];if(e.length<1)return[new It(r,e,"filter array must have at least 1 element")];switch(y=y.concat(Ya({key:`${r}[0]`,value:e[0],valueSpec:u.filter_operator,style:i.style,styleSpec:i.styleSpec})),wi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&wi(e[1])==="$type"&&y.push(new It(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&y.push(new It(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Si(e[1]),p!=="string"&&y.push(new It(`${r}[1]`,e[1],`string expected, ${p} found`)));for(let b=2;b<e.length;b++)p=Si(e[b]),wi(e[1])==="$type"?y=y.concat(Ya({key:`${r}[${b}]`,value:e[b],valueSpec:u.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new It(`${r}[${b}]`,e[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<e.length;b++)y=y.concat(Fl({key:`${r}[${b}]`,value:e[b],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Si(e[1]),e.length!==2?y.push(new It(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new It(`${r}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Si(e[1]),e.length!==2?y.push(new It(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):p!=="object"&&y.push(new It(`${r}[1]`,e[1],`object expected, ${p} found`))}return y}function es(i,e){const r=i.key,u=i.style,p=i.styleSpec,y=i.value,b=i.objectKey,I=p[`${e}_${i.layerType}`];if(!I)return[];const C=b.match(/^(.*)-transition$/);if(e==="paint"&&C&&I[C[1]]&&I[C[1]].transition)return jn({key:r,value:y,valueSpec:p.transition,style:u,styleSpec:p});const D=i.valueSpec||I[b];if(!D)return[new It(r,y,`unknown property "${b}"`)];let B;if(Si(y)==="string"&&Ui(D)&&!D.tokens&&(B=/^{([^}]+)}$/.exec(y)))return[new It(r,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(b==="text-field"&&u&&!u.glyphs&&F.push(new It(r,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Ni(Jn(y))&&wi(y.type)==="identity"&&F.push(new It(r,y,'"text-font" does not support identity functions'))),F.concat(jn({key:i.key,value:y,valueSpec:D,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:b}))}function Ol(i){return es(i,"paint")}function Vl(i){return es(i,"layout")}function Nl(i){let e=[];const r=i.value,u=i.key,p=i.style,y=i.styleSpec;r.type||r.ref||e.push(new It(u,r,'either "type" or "ref" is required'));let b=wi(r.type);const I=wi(r.ref);if(r.id){const C=wi(r.id);for(let D=0;D<i.arrayIndex;D++){const B=p.layers[D];wi(B.id)===C&&e.push(new It(u,r.id,`duplicate layer id "${r.id}", previously used at line ${B.id.__line__}`))}}if("ref"in r){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in r&&e.push(new It(u,r[D],`"${D}" is prohibited for ref layers`))}),p.layers.forEach(D=>{wi(D.id)===I&&(C=D)}),C?C.ref?e.push(new It(u,r.ref,"ref cannot reference another ref layer")):b=wi(C.type):e.push(new It(u,r.ref,`ref layer "${I}" not found`))}else if(b!=="background")if(r.source){const C=p.sources&&p.sources[r.source],D=C&&wi(C.type);C?D==="vector"&&b==="raster"?e.push(new It(u,r.source,`layer "${r.id}" requires a raster source`)):D==="raster"&&b!=="raster"?e.push(new It(u,r.source,`layer "${r.id}" requires a vector source`)):D!=="vector"||r["source-layer"]?D==="raster-dem"&&b!=="hillshade"?e.push(new It(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!r.paint||!r.paint["line-gradient"]||D==="geojson"&&C.lineMetrics||e.push(new It(u,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new It(u,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new It(u,r.source,`source "${r.source}" not found`))}else e.push(new It(u,r,'missing required property "source"'));return e=e.concat(rr({key:u,value:r,valueSpec:y.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>jn({key:`${u}.type`,value:r.type,valueSpec:y.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:$a,layout:C=>rr({layer:r,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Vl(nr({layerType:b},D))}}),paint:C=>rr({layer:r,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Ol(nr({layerType:b},D))}})}})),e}function Ca(i){const e=i.value,r=i.key,u=Si(e);return u!=="string"?[new It(r,e,`string expected, ${u} found`)]:[]}const Ul={promoteId:function({key:i,value:e}){if(Si(e)==="string")return Ca({key:i,value:e});{const r=[];for(const u in e)r.push(...Ca({key:`${i}.${u}`,value:e[u]}));return r}}};function ts(i){const e=i.value,r=i.key,u=i.styleSpec,p=i.style;if(!e.type)return[new It(r,e,'"type" is required')];const y=wi(e.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=rr({key:r,value:e,valueSpec:u[`source_${y.replace("-","_")}`],style:i.style,styleSpec:u,objectElementValidators:Ul}),b;case"geojson":if(b=rr({key:r,value:e,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Ul}),e.cluster)for(const I in e.clusterProperties){const[C,D]=e.clusterProperties[I],B=typeof C=="string"?[C,["accumulated"],["get",I]]:C;b.push(...ia({key:`${r}.${I}.map`,value:D,expressionContext:"cluster-map"})),b.push(...ia({key:`${r}.${I}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return b;case"video":return rr({key:r,value:e,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return rr({key:r,value:e,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new It(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ya({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:u})}}function is(i){const e=i.value,r=i.styleSpec,u=r.light,p=i.style;let y=[];const b=Si(e);if(e===void 0)return y;if(b!=="object")return y=y.concat([new It("light",e,`object expected, ${b} found`)]),y;for(const I in e){const C=I.match(/^(.*)-transition$/);y=y.concat(C&&u[C[1]]&&u[C[1]].transition?jn({key:I,value:e[I],valueSpec:r.transition,style:p,styleSpec:r}):u[I]?jn({key:I,value:e[I],valueSpec:u[I],style:p,styleSpec:r}):[new It(I,e[I],`unknown property "${I}"`)])}return y}function Gn(i){const e=i.value,r=i.styleSpec,u=r.terrain,p=i.style;let y=[];const b=Si(e);if(e===void 0)return y;if(b!=="object")return y=y.concat([new It("terrain",e,`object expected, ${b} found`)]),y;for(const I in e)y=y.concat(u[I]?jn({key:I,value:e[I],valueSpec:u[I],style:p,styleSpec:r}):[new It(I,e[I],`unknown property "${I}"`)]);return y}const ns={"*":()=>[],array:Pl,boolean:function(i){const e=i.value,r=i.key,u=Si(e);return u!=="boolean"?[new It(r,e,`boolean expected, ${u} found`)]:[]},number:wo,color:function(i){const e=i.key,r=i.value,u=Si(r);return u!=="string"?[new It(e,r,`color expected, ${u} found`)]:va(r)===null?[new It(e,r,`color expected, "${r}" found`)]:[]},constants:Yr,enum:Ya,filter:$a,function:Ll,layer:Nl,object:rr,source:ts,light:is,terrain:Gn,string:Ca,formatted:function(i){return Ca(i).length===0?[]:ia(i)},resolvedImage:function(i){return Ca(i).length===0?[]:ia(i)},padding:function(i){const e=i.key,r=i.value;if(Si(r)==="array"){if(r.length<1||r.length>4)return[new It(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const u={type:"number"};let p=[];for(let y=0;y<r.length;y++)p=p.concat(jn({key:`${e}[${y}]`,value:r[y],valueSpec:u}));return p}return wo({key:e,value:r,valueSpec:{}})}};function jn(i){const e=i.value,r=i.valueSpec,u=i.styleSpec;return r.expression&&Ni(wi(e))?Ll(i):r.expression&&Wa(Jn(e))?ia(i):r.type&&ns[r.type]?ns[r.type](i):rr(nr({},i,{valueSpec:r.type?u[r.type]:r}))}function $c(i){const e=i.value,r=i.key,u=Ca(i);return u.length||(e.indexOf("{fontstack}")===-1&&u.push(new It(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&u.push(new It(r,e,'"glyphs" url must include a "{range}" token'))),u}function Nr(i,e=Ke){let r=[];return r=r.concat(jn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:$c,"*":()=>[]}})),i.constants&&(r=r.concat(Yr({key:"constants",value:i.constants,style:i,styleSpec:e}))),ql(r)}function ql(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function Er(i){return function(...e){return ql(i.apply(this,e))}}Nr.source=Er(ts),Nr.light=Er(is),Nr.terrain=Er(Gn),Nr.layer=Er(Nl),Nr.filter=Er($a),Nr.paintProperty=Er(Ol),Nr.layoutProperty=Er(Vl);const rs=Nr,ko=rs.light,eu=rs.paintProperty,tu=rs.layoutProperty;function Ls(i,e){let r=!1;if(e&&e.length)for(const u of e)i.fire(new ga(new Error(u.message))),r=!0;return r}class as{constructor(e,r,u){const p=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const b=new Int32Array(this.arrayBuffer);e=b[0],this.d=(r=b[1])+2*(u=b[2]);for(let C=0;C<this.d*this.d;C++){const D=b[3+C],B=b[3+C+1];p.push(D===B?null:b.subarray(D,B))}const I=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],I),this.bboxes=b.subarray(I),this.insert=this._insertReadonly}else{this.d=r+2*u;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=u,this.scale=r/e,this.uid=0;const y=u/r*e;this.min=-y,this.max=e+y}insert(e,r,u,p,y){this._forEachCell(r,u,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,u,p,y,b){this.cells[y].push(b)}query(e,r,u,p,y){const b=this.min,I=this.max;if(e<=b&&r<=b&&I<=u&&I<=p&&!y)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(e,r,u,p,this._queryCell,C,{},y),C}}_queryCell(e,r,u,p,y,b,I,C){const D=this.cells[y];if(D!==null){const B=this.keys,F=this.bboxes;for(let U=0;U<D.length;U++){const j=D[U];if(I[j]===void 0){const X=4*j;(C?C(F[X+0],F[X+1],F[X+2],F[X+3]):e<=F[X+2]&&r<=F[X+3]&&u>=F[X+0]&&p>=F[X+1])?(I[j]=!0,b.push(B[j])):I[j]=!1}}}}_forEachCell(e,r,u,p,y,b,I,C){const D=this._convertToCellCoord(e),B=this._convertToCellCoord(r),F=this._convertToCellCoord(u),U=this._convertToCellCoord(p);for(let j=D;j<=F;j++)for(let X=B;X<=U;X++){const ue=this.d*X+j;if((!C||C(this._convertFromCellCoord(j),this._convertFromCellCoord(X),this._convertFromCellCoord(j+1),this._convertFromCellCoord(X+1)))&&y.call(this,e,r,u,p,ue,b,I,C))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let u=0;for(let b=0;b<this.cells.length;b++)u+=this.cells[b].length;const p=new Int32Array(r+u+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=r;for(let b=0;b<e.length;b++){const I=e[b];p[3+b]=y,p.set(I,y),y+=I.length}return p[3+e.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+e.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(e,r){const u=e.toArrayBuffer();return r&&r.push(u),{buffer:u}}static deserialize(e){return new as(e.buffer)}}const Ar={};function Bt(i,e,r={}){if(Ar[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ar[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Bt("Object",Object),Bt("TransferableGridIndex",as),Bt("Color",J),Bt("Error",Error),Bt("AJAXError",tt),Bt("ResolvedImage",Ie),Bt("StylePropertyFunction",Ms),Bt("StyleExpression",Cs,{omit:["_evaluator"]}),Bt("ZoomDependentExpression",xo),Bt("ZoomConstantExpression",Ka),Bt("CompoundExpression",Ri,{omit:["_evaluate"]});for(const i in ka)ka[i]._classRegistryKey||Bt(`Expression_${i}`,ka[i]);function Gl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function na(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Gl(i)||Re(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const u of i)r.push(na(u,e));return r}if(typeof i=="object"){const r=i.constructor,u=r._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");if(!Ar[u])throw new Error(`${u} is not registered.`);const p=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&p===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in i){if(!i.hasOwnProperty(y)||Ar[u].omit.indexOf(y)>=0)continue;const b=i[y];p[y]=Ar[u].shallow.indexOf(y)>=0?b:na(b,e)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof i)}function Ur(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Gl(i)||Re(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Ur);if(typeof i=="object"){const e=i.$name||"Object";if(!Ar[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=Ar[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const u=Object.create(r.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const y=i[p];u[p]=Ar[e].shallow.indexOf(p)>=0?y:Ur(y)}return u}throw new Error("can't deserialize object of type "+typeof i)}class To{constructor(){this.first=!0}update(e,r){const u=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=u,!0))}}const Tt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Bs(i){for(const e of i)if(Ao(e.charCodeAt(0)))return!0;return!1}function iu(i){for(const e of i)if(!Eo(e.charCodeAt(0)))return!1;return!0}function Eo(i){return!(Tt.Arabic(i)||Tt["Arabic Supplement"](i)||Tt["Arabic Extended-A"](i)||Tt["Arabic Presentation Forms-A"](i)||Tt["Arabic Presentation Forms-B"](i))}function Ao(i){return!(i!==746&&i!==747&&(i<4352||!(Tt["Bopomofo Extended"](i)||Tt.Bopomofo(i)||Tt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Tt["CJK Compatibility Ideographs"](i)||Tt["CJK Compatibility"](i)||Tt["CJK Radicals Supplement"](i)||Tt["CJK Strokes"](i)||!(!Tt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Tt["CJK Unified Ideographs Extension A"](i)||Tt["CJK Unified Ideographs"](i)||Tt["Enclosed CJK Letters and Months"](i)||Tt["Hangul Compatibility Jamo"](i)||Tt["Hangul Jamo Extended-A"](i)||Tt["Hangul Jamo Extended-B"](i)||Tt["Hangul Jamo"](i)||Tt["Hangul Syllables"](i)||Tt.Hiragana(i)||Tt["Ideographic Description Characters"](i)||Tt.Kanbun(i)||Tt["Kangxi Radicals"](i)||Tt["Katakana Phonetic Extensions"](i)||Tt.Katakana(i)&&i!==12540||!(!Tt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Tt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Tt["Unified Canadian Aboriginal Syllabics"](i)||Tt["Unified Canadian Aboriginal Syllabics Extended"](i)||Tt["Vertical Forms"](i)||Tt["Yijing Hexagram Symbols"](i)||Tt["Yi Syllables"](i)||Tt["Yi Radicals"](i))))}function jl(i){return!(Ao(i)||function(e){return!!(Tt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Tt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Tt["Letterlike Symbols"](e)||Tt["Number Forms"](e)||Tt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Tt["Control Pictures"](e)&&e!==9251||Tt["Optical Character Recognition"](e)||Tt["Enclosed Alphanumerics"](e)||Tt["Geometric Shapes"](e)||Tt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Tt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Tt["CJK Symbols and Punctuation"](e)||Tt.Katakana(e)||Tt["Private Use Area"](e)||Tt["CJK Compatibility Forms"](e)||Tt["Small Form Variants"](e)||Tt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Zl(i){return i>=1424&&i<=2303||Tt["Arabic Presentation Forms-A"](i)||Tt["Arabic Presentation Forms-B"](i)}function nu(i,e){return!(!e&&Zl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Tt.Khmer(i))}function Xl(i){for(const e of i)if(Zl(e.charCodeAt(0)))return!0;return!1}const So="deferred",Co="loading",Mo="loaded";let zo=null,Ln="unavailable",qr=null;const Wl=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Ln="error"),zo&&zo(i)};function Ma(){Do.fire(new Ir("pluginStateChange",{pluginStatus:Ln,pluginURL:qr}))}const Do=new kr,ss=function(){return Ln},Hl=function(){if(Ln!==So||!qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ln=Co,Ma(),qr&&ei({url:qr},i=>{i?Wl(i):(Ln=Mo,Ma())})},Qn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ln===Mo||Qn.applyArabicShaping!=null,isLoading:()=>Ln===Co,setState(i){if(!ce())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Ln=i.pluginStatus,qr=i.pluginURL},isParsed(){if(!ce())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Qn.applyArabicShaping!=null&&Qn.processBidirectionalText!=null&&Qn.processStyledBidirectionalText!=null},getPluginURL(){if(!ce())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return qr}};class Xi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new To,this.transition={})}isSupportedScript(e){return function(r,u){for(const p of r)if(!nu(p.charCodeAt(0),u))return!1;return!0}(e,Qn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),u=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*r}}}class os{constructor(e,r){this.property=e,this.value=r,this.expression=function(u,p){if(Ni(u))return new Ms(u,p);if(Wa(u)){const y=Dl(u,p);if(y.result==="error")throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=u;return p.type==="color"&&typeof u=="string"?y=J.parse(u):p.type!=="padding"||typeof u!="number"&&!Array.isArray(u)||(y=pe.parse(u)),{kind:"constant",evaluate:()=>y}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,u){return this.property.possiblyEvaluate(this,e,r,u)}}class Rs{constructor(e){this.property=e,this.value=new os(e,void 0)}transitioned(e,r){return new Yl(this.property,this.value,r,W({},e.transition,this.transition),e.now)}untransitioned(){return new Yl(this.property,this.value,null,{},0)}}class Kl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ae(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rs(this._values[e].property)),this._values[e].value=new os(this._values[e].property,r===null?void 0:ae(r))}getTransition(e){return ae(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Rs(this._values[e].property)),this._values[e].transition=ae(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(e[r]=u);const p=this.getTransition(r);p!==void 0&&(e[`${r}-transition`]=p)}return e}transitioned(e,r){const u=new Jl(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(e,r._values[p]);return u}untransitioned(){const e=new Jl(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Yl{constructor(e,r,u,p,y){this.property=e,this.value=r,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,e.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(e,r,u){const p=e.now||0,y=this.value.possiblyEvaluate(e,r,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(e,r,u);{const I=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(e,r,u),y,function(C){if(C<=0)return 0;if(C>=1)return 1;const D=C*C,B=D*C;return 4*(C<.5?B:3*(C-D)+B-.75)}(I))}}return y}}class Jl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,u){const p=new ls(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,r,u);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ru{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ae(this._values[e].value)}setValue(e,r){this._values[e]=new os(this._values[e].property,r===null?void 0:ae(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const u=this.getValue(r);u!==void 0&&(e[r]=u)}return e}possiblyEvaluate(e,r,u){const p=new ls(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,r,u);return p}}class pr{constructor(e,r,u){this.property=e,this.value=r,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,u,p){return this.property.evaluate(this.value,this.parameters,e,r,u,p)}}class ls{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Vt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,u){const p=Ga[this.specification.type];return p?p(e,r,u):e}}class Ht{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,u,p){return new pr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},u,p)}:e.expression,r)}interpolate(e,r,u){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new pr(this,{kind:"constant",value:void 0},e.parameters);const p=Ga[this.specification.type];return p?new pr(this,{kind:"constant",value:p(e.value.value,r.value.value,u)},e.parameters):e}evaluate(e,r,u,p,y,b){return e.kind==="constant"?e.value:e.evaluate(r,u,p,y,b)}}class za extends Ht{possiblyEvaluate(e,r,u,p){if(e.value===void 0)return new pr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const y=e.expression.evaluate(r,null,{},u,p),b=e.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,I=this._calculate(b,b,b,r);return new pr(this,{kind:"constant",value:I},r)}if(e.expression.kind==="camera"){const y=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new pr(this,{kind:"constant",value:y},r)}return new pr(this,e.expression,r)}evaluate(e,r,u,p,y,b){if(e.kind==="source"){const I=e.evaluate(r,u,p,y,b);return this._calculate(I,I,I,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},u,p),e.evaluate({zoom:Math.floor(r.zoom)},u,p),e.evaluate({zoom:Math.floor(r.zoom)+1},u,p),r):e.value}_calculate(e,r,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:u,to:r}}interpolate(e){return e}}class Po{constructor(e){this.specification=e}possiblyEvaluate(e,r,u,p){if(e.value!==void 0){if(e.expression.kind==="constant"){const y=e.expression.evaluate(r,null,{},u,p);return this._calculate(y,y,y,r)}return this._calculate(e.expression.evaluate(new Xi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Xi(Math.floor(r.zoom),r)),e.expression.evaluate(new Xi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:u,to:r}}interpolate(e){return e}}class Gr{constructor(e){this.specification=e}possiblyEvaluate(e,r,u,p){return!!e.expression.evaluate(r,null,{},u,p)}interpolate(){return!1}}class xn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const u=e[r];u.specification.overridable&&this.overridableProperties.push(r);const p=this.defaultPropertyValues[r]=new os(u,void 0),y=this.defaultTransitionablePropertyValues[r]=new Rs(u);this.defaultTransitioningPropertyValues[r]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=p.possiblyEvaluate({})}}}Bt("DataDrivenProperty",Ht),Bt("DataConstantProperty",Vt),Bt("CrossFadedDataDrivenProperty",za),Bt("CrossFadedProperty",Po),Bt("ColorRampProperty",Gr);const jr="-transition";class mr extends kr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ru(r.layout)),r.paint)){this._transitionablePaint=new Kl(r.paint);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ls(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,u={}){r!=null&&this._validate(tu,`layers.${this.id}.layout.${e}`,e,r,u)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(jr)?this._transitionablePaint.getTransition(e.slice(0,-jr.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,u={}){if(r!=null&&this._validate(eu,`layers.${this.id}.paint.${e}`,e,r,u))return!1;if(e.endsWith(jr))return this._transitionablePaint.setTransition(e.slice(0,-jr.length),r||void 0),!1;{const p=this._transitionablePaint._values[e],y=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),I=p.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const C=this._transitionablePaint._values[e].value;return C.isDataDriven()||b||y||this._handleOverridablePaintPropertyUpdate(e,I,C)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Q(e,(r,u)=>!(r===void 0||u==="layout"&&!Object.keys(r).length||u==="paint"&&!Object.keys(r).length))}_validate(e,r,u,p,y={}){return(!y||y.validate!==!1)&&Ls(this,e.call(rs,{key:r,layerType:this.type,objectKey:u,value:p,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof pr&&Ui(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Ql={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zr{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $i{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function an(i,e=1){let r=0,u=0;return{members:i.map(p=>{const y=Ql[p.type].BYTES_PER_ELEMENT,b=r=Lo(r,Math.max(e,y)),I=p.components||1;return u=Math.max(u,y),r+=y*I,{name:p.name,type:p.type,components:I,offset:b}}),size:Lo(r,Math.max(u,e)),alignment:e}}function Lo(i,e){return Math.ceil(i/e)*e}class ra extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const u=this.length;return this.resize(u+1),this.emplace(u,e,r)}emplace(e,r,u){const p=2*e;return this.int16[p+0]=r,this.int16[p+1]=u,e}}ra.prototype.bytesPerElement=4,Bt("StructArrayLayout2i4",ra);class f extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,u,p)}emplace(e,r,u,p,y){const b=4*e;return this.int16[b+0]=r,this.int16[b+1]=u,this.int16[b+2]=p,this.int16[b+3]=y,e}}f.prototype.bytesPerElement=8,Bt("StructArrayLayout4i8",f);class t extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,u,p,y,b)}emplace(e,r,u,p,y,b,I){const C=6*e;return this.int16[C+0]=r,this.int16[C+1]=u,this.int16[C+2]=p,this.int16[C+3]=y,this.int16[C+4]=b,this.int16[C+5]=I,e}}t.prototype.bytesPerElement=12,Bt("StructArrayLayout2i4i12",t);class l extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,u,p,y,b)}emplace(e,r,u,p,y,b,I){const C=4*e,D=8*e;return this.int16[C+0]=r,this.int16[C+1]=u,this.uint8[D+4]=p,this.uint8[D+5]=y,this.uint8[D+6]=b,this.uint8[D+7]=I,e}}l.prototype.bytesPerElement=8,Bt("StructArrayLayout2i4ub8",l);class h extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const u=this.length;return this.resize(u+1),this.emplace(u,e,r)}emplace(e,r,u){const p=2*e;return this.float32[p+0]=r,this.float32[p+1]=u,e}}h.prototype.bytesPerElement=8,Bt("StructArrayLayout2f8",h);class m extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b,I,C,D,B){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,u,p,y,b,I,C,D,B)}emplace(e,r,u,p,y,b,I,C,D,B,F){const U=10*e;return this.uint16[U+0]=r,this.uint16[U+1]=u,this.uint16[U+2]=p,this.uint16[U+3]=y,this.uint16[U+4]=b,this.uint16[U+5]=I,this.uint16[U+6]=C,this.uint16[U+7]=D,this.uint16[U+8]=B,this.uint16[U+9]=F,e}}m.prototype.bytesPerElement=20,Bt("StructArrayLayout10ui20",m);class v extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b,I,C,D,B,F,U){const j=this.length;return this.resize(j+1),this.emplace(j,e,r,u,p,y,b,I,C,D,B,F,U)}emplace(e,r,u,p,y,b,I,C,D,B,F,U,j){const X=12*e;return this.int16[X+0]=r,this.int16[X+1]=u,this.int16[X+2]=p,this.int16[X+3]=y,this.uint16[X+4]=b,this.uint16[X+5]=I,this.uint16[X+6]=C,this.uint16[X+7]=D,this.int16[X+8]=B,this.int16[X+9]=F,this.int16[X+10]=U,this.int16[X+11]=j,e}}v.prototype.bytesPerElement=24,Bt("StructArrayLayout4i4ui4i24",v);class w extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){const y=3*e;return this.float32[y+0]=r,this.float32[y+1]=u,this.float32[y+2]=p,e}}w.prototype.bytesPerElement=12,Bt("StructArrayLayout3f12",w);class M extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}M.prototype.bytesPerElement=4,Bt("StructArrayLayout1ul4",M);class z extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b,I,C,D){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,u,p,y,b,I,C,D)}emplace(e,r,u,p,y,b,I,C,D,B){const F=10*e,U=5*e;return this.int16[F+0]=r,this.int16[F+1]=u,this.int16[F+2]=p,this.int16[F+3]=y,this.int16[F+4]=b,this.int16[F+5]=I,this.uint32[U+3]=C,this.uint16[F+8]=D,this.uint16[F+9]=B,e}}z.prototype.bytesPerElement=20,Bt("StructArrayLayout6i1ul2ui20",z);class P extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,u,p,y,b)}emplace(e,r,u,p,y,b,I){const C=6*e;return this.int16[C+0]=r,this.int16[C+1]=u,this.int16[C+2]=p,this.int16[C+3]=y,this.int16[C+4]=b,this.int16[C+5]=I,e}}P.prototype.bytesPerElement=12,Bt("StructArrayLayout2i2i2i12",P);class R extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,u,p,y)}emplace(e,r,u,p,y,b){const I=4*e,C=8*e;return this.float32[I+0]=r,this.float32[I+1]=u,this.float32[I+2]=p,this.int16[C+6]=y,this.int16[C+7]=b,e}}R.prototype.bytesPerElement=16,Bt("StructArrayLayout2f1f2i16",R);class N extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,u,p)}emplace(e,r,u,p,y){const b=12*e,I=3*e;return this.uint8[b+0]=r,this.uint8[b+1]=u,this.float32[I+1]=p,this.float32[I+2]=y,e}}N.prototype.bytesPerElement=12,Bt("StructArrayLayout2ub2f12",N);class G extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){const y=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=u,this.uint16[y+2]=p,e}}G.prototype.bytesPerElement=6,Bt("StructArrayLayout3ui6",G);class re extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue,le,Ce){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue,le,Ce)}emplace(e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue,le,Ce,Ne){const Ae=24*e,Be=12*e,it=48*e;return this.int16[Ae+0]=r,this.int16[Ae+1]=u,this.uint16[Ae+2]=p,this.uint16[Ae+3]=y,this.uint32[Be+2]=b,this.uint32[Be+3]=I,this.uint32[Be+4]=C,this.uint16[Ae+10]=D,this.uint16[Ae+11]=B,this.uint16[Ae+12]=F,this.float32[Be+7]=U,this.float32[Be+8]=j,this.uint8[it+36]=X,this.uint8[it+37]=ue,this.uint8[it+38]=le,this.uint32[Be+10]=Ce,this.int16[Ae+22]=Ne,e}}re.prototype.bytesPerElement=48,Bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",re);class te extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue,le,Ce,Ne,Ae,Be,it,et,Dt,Ft,Et,wt,_t,At){const kt=this.length;return this.resize(kt+1),this.emplace(kt,e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue,le,Ce,Ne,Ae,Be,it,et,Dt,Ft,Et,wt,_t,At)}emplace(e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue,le,Ce,Ne,Ae,Be,it,et,Dt,Ft,Et,wt,_t,At,kt){const pt=34*e,Zt=17*e;return this.int16[pt+0]=r,this.int16[pt+1]=u,this.int16[pt+2]=p,this.int16[pt+3]=y,this.int16[pt+4]=b,this.int16[pt+5]=I,this.int16[pt+6]=C,this.int16[pt+7]=D,this.uint16[pt+8]=B,this.uint16[pt+9]=F,this.uint16[pt+10]=U,this.uint16[pt+11]=j,this.uint16[pt+12]=X,this.uint16[pt+13]=ue,this.uint16[pt+14]=le,this.uint16[pt+15]=Ce,this.uint16[pt+16]=Ne,this.uint16[pt+17]=Ae,this.uint16[pt+18]=Be,this.uint16[pt+19]=it,this.uint16[pt+20]=et,this.uint16[pt+21]=Dt,this.uint16[pt+22]=Ft,this.uint32[Zt+12]=Et,this.float32[Zt+13]=wt,this.float32[Zt+14]=_t,this.float32[Zt+15]=At,this.float32[Zt+16]=kt,e}}te.prototype.bytesPerElement=68,Bt("StructArrayLayout8i15ui1ul4f68",te);class ie extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ie.prototype.bytesPerElement=4,Bt("StructArrayLayout1f4",ie);class xe extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){const y=3*e;return this.int16[y+0]=r,this.int16[y+1]=u,this.int16[y+2]=p,e}}xe.prototype.bytesPerElement=6,Bt("StructArrayLayout3i6",xe);class Te extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,u)}emplace(e,r,u,p){const y=4*e;return this.uint32[2*e+0]=r,this.uint16[y+2]=u,this.uint16[y+3]=p,e}}Te.prototype.bytesPerElement=8,Bt("StructArrayLayout1ul2ui8",Te);class De extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const u=this.length;return this.resize(u+1),this.emplace(u,e,r)}emplace(e,r,u){const p=2*e;return this.uint16[p+0]=r,this.uint16[p+1]=u,e}}De.prototype.bytesPerElement=4,Bt("StructArrayLayout2ui4",De);class oe extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}oe.prototype.bytesPerElement=2,Bt("StructArrayLayout1ui2",oe);class Oe extends $i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,u,p)}emplace(e,r,u,p,y){const b=4*e;return this.float32[b+0]=r,this.float32[b+1]=u,this.float32[b+2]=p,this.float32[b+3]=y,e}}Oe.prototype.bytesPerElement=16,Bt("StructArrayLayout4f16",Oe);class Le extends Zr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ee(this.anchorPointX,this.anchorPointY)}}Le.prototype.size=20;class We extends z{get(e){return new Le(this,e)}}Bt("CollisionBoxArray",We);class He extends Zr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}He.prototype.size=48;class dt extends re{get(e){return new He(this,e)}}Bt("PlacedSymbolArray",dt);class Ge extends Zr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ge.prototype.size=68;class Ct extends te{get(e){return new Ge(this,e)}}Bt("SymbolInstanceArray",Ct);class xt extends ie{getoffsetX(e){return this.float32[1*e+0]}}Bt("GlyphOffsetArray",xt);class zt extends xe{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Bt("SymbolLineVertexArray",zt);class ai extends Zr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ai.prototype.size=8;class hi extends Te{get(e){return new ai(this,e)}}Bt("FeatureIndexArray",hi);class jt extends ra{}class zi extends ra{}class Di extends ra{}class yi extends t{}class Ti extends l{}class Li extends h{}class mn extends m{}class gr extends v{}class ar extends w{}class _r extends M{}class Xr extends P{}class $n extends N{}class Bn extends G{}class Sr extends De{}const Fs=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:cn}=Fs;class pi{constructor(e=[]){this.segments=e}prepareSegment(e,r,u,p){let y=this.segments[this.segments.length-1];return e>pi.MAX_VERTEX_ARRAY_LENGTH&&ge(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>pi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:r.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,u,p){return new pi([{vertexOffset:e,primitiveOffset:r,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}function Mi(i,e){return 256*(i=S(Math.floor(i),0,255))+S(Math.floor(e),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt("SegmentVector",pi);const gn=an([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var _n={exports:{}},Wi={exports:{}};Wi.exports=function(i,e){var r,u,p,y,b,I,C,D;for(u=i.length-(r=3&i.length),p=e,b=3432918353,I=461845907,D=0;D<u;)C=255&i.charCodeAt(D)|(255&i.charCodeAt(++D))<<8|(255&i.charCodeAt(++D))<<16|(255&i.charCodeAt(++D))<<24,++D,p=27492+(65535&(y=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*I+(((C>>>16)*I&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(C=0,r){case 3:C^=(255&i.charCodeAt(D+2))<<16;case 2:C^=(255&i.charCodeAt(D+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(D)))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<15|C>>>17))*I+(((C>>>16)*I&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var er={exports:{}};er.exports=function(i,e){for(var r,u=i.length,p=e^u,y=0;u>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(r>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var aa=Wi.exports,Bo=er.exports;_n.exports=aa,_n.exports.murmur3=aa,_n.exports.murmur2=Bo;class Da{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,u,p){this.ids.push($l(e)),this.positions.push(r,u,p)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=$l(e);let u=0,p=this.ids.length-1;for(;u<p;){const b=u+p>>1;this.ids[b]>=r?p=b:u=b+1}const y=[];for(;this.ids[u]===r;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(e,r){const u=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Ro(u,p,0,u.length-1),r&&r.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(e){const r=new Da;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function $l(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:_n.exports(String(i))}function Ro(i,e,r,u){for(;r<u;){const p=i[r+u>>1];let y=r-1,b=u+1;for(;;){do y++;while(i[y]<p);do b--;while(i[b]>p);if(y>=b)break;Wr(i,y,b),Wr(e,3*y,3*b),Wr(e,3*y+1,3*b+1),Wr(e,3*y+2,3*b+2)}b-r<u-b?(Ro(i,e,r,b),r=b+1):(Ro(i,e,b+1,u),u=b)}}function Wr(i,e,r){const u=i[e];i[e]=i[r],i[r]=u}Bt("FeaturePositionMap",Da);class sa{constructor(e,r){this.gl=e.gl,this.location=r}}class oa extends sa{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Os extends sa{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class gh extends sa{constructor(e,r){super(e,r),this.current=J.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Pm=new Float32Array(16);function au(i){return[Mi(255*i.r,255*i.g),Mi(255*i.b,255*i.a)]}class Fo{constructor(e,r,u){this.value=e,this.uniformNames=r.map(p=>`u_${p}`),this.type=u}setUniform(e,r,u){e.set(u.constantOr(this.value))}getBinding(e,r,u){return this.type==="color"?new gh(e,r):new oa(e,r)}}class Vs{constructor(e,r){this.uniformNames=r.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,u,p){const y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&e.set(y)}getBinding(e,r,u){return u.substr(0,9)==="u_pattern"?new Os(e,r):new oa(e,r)}}class la{constructor(e,r,u,p){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,u,p,y){const b=this.paintVertexArray.length,I=this.expression.evaluate(new Xi(0),r,{},p,[],y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,I)}updatePaintArray(e,r,u,p){const y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(e,r,y)}_setPaintValue(e,r,u){if(this.type==="color"){const p=au(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cr{constructor(e,r,u,p,y,b){this.expression=e,this.uniformNames=r.map(I=>`u_${I}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=r.map(I=>({name:`a_${I}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(e,r,u,p,y){const b=this.expression.evaluate(new Xi(this.zoom),r,{},p,[],y),I=this.expression.evaluate(new Xi(this.zoom+1),r,{},p,[],y),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,b,I)}updatePaintArray(e,r,u,p){const y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(e,r,y,b)}_setPaintValue(e,r,u,p){if(this.type==="color"){const y=au(u),b=au(p);for(let I=e;I<r;I++)this.paintVertexArray.emplace(I,y[0],y[1],b[0],b[1])}else{for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const u=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=S(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);e.set(p)}getBinding(e,r,u){return new oa(e,r)}}class Pa{constructor(e,r,u,p,y,b){this.expression=e,this.type=r,this.useIntegerZoom=u,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(e,r,u){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(p,e,r.patterns&&r.patterns[this.layerId],u)}updatePaintArray(e,r,u,p,y){this._setPaintValues(e,r,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(e,r,u,p){if(!p||!u)return;const{min:y,mid:b,max:I}=u,C=p[y],D=p[b],B=p[I];if(C&&D&&B)for(let F=e;F<r;F++)this.zoomInPaintVertexArray.emplace(F,D.tl[0],D.tl[1],D.br[0],D.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],D.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,D.tl[0],D.tl[1],D.br[0],D.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],D.pixelRatio,B.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,gn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,gn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _h{constructor(e,r,u){this.binders={},this._buffers=[];const p=[];for(const y in e.paint._values){if(!u(y))continue;const b=e.paint.get(y);if(!(b instanceof pr&&Ui(b.property.specification)))continue;const I=Lm(y,e.type),C=b.value,D=b.property.specification.type,B=b.property.useIntegerZoom,F=b.property.specification["property-type"],U=F==="cross-faded"||F==="cross-faded-data-driven";if(C.kind==="constant")this.binders[y]=U?new Vs(C.value,I):new Fo(C.value,I,D),p.push(`/u_${y}`);else if(C.kind==="source"||U){const j=yh(y,D,"source");this.binders[y]=U?new Pa(C,D,B,r,j,e.id):new la(C,I,D,j),p.push(`/a_${y}`)}else{const j=yh(y,D,"composite");this.binders[y]=new Cr(C,I,D,B,r,j),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof la||r instanceof Cr?r.maxValue:0}populatePaintArrays(e,r,u,p,y){for(const b in this.binders){const I=this.binders[b];(I instanceof la||I instanceof Cr||I instanceof Pa)&&I.populatePaintArray(e,r,u,p,y)}}setConstantPatternPositions(e,r){for(const u in this.binders){const p=this.binders[u];p instanceof Vs&&p.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,u,p,y){let b=!1;for(const I in e){const C=r.getPositions(I);for(const D of C){const B=u.feature(D.index);for(const F in this.binders){const U=this.binders[F];if((U instanceof la||U instanceof Cr||U instanceof Pa)&&U.expression.isStateDependent===!0){const j=p.paint.get(F);U.expression=j.value,U.updatePaintArray(D.start,D.end,B,e[I],y),b=!0}}}}return b}defines(){const e=[];for(const r in this.binders){const u=this.binders[r];(u instanceof Fo||u instanceof Vs)&&e.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof la||u instanceof Cr)for(let p=0;p<u.paintVertexAttributes.length;p++)e.push(u.paintVertexAttributes[p].name);else if(u instanceof Pa)for(let p=0;p<gn.members.length;p++)e.push(gn.members[p].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const u=this.binders[r];if(u instanceof Fo||u instanceof Vs||u instanceof Cr)for(const p of u.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const u=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof Fo||y instanceof Vs||y instanceof Cr){for(const b of y.uniformNames)if(r[b]){const I=y.getBinding(e,r[b],b);u.push({name:b,property:p,binding:I})}}}return u}setUniforms(e,r,u,p){for(const{name:y,property:b,binding:I}of r)this.binders[b].setUniform(I,p,u.get(b),y)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const u=this.binders[r];if(e&&u instanceof Pa){const p=e.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof la||u instanceof Cr)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(e){for(const r in this.binders){const u=this.binders[r];(u instanceof la||u instanceof Cr||u instanceof Pa)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof la||r instanceof Cr||r instanceof Pa)&&r.destroy()}}}class cs{constructor(e,r,u=()=>!0){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new _h(p,r,u);this.needsUpload=!1,this._featureMap=new Da,this._bufferOffset=0}populatePaintArrays(e,r,u,p,y,b){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,r,p,y,b);r.id!==void 0&&this._featureMap.add(r.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,u,p){for(const y of u)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,r,y,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Lm(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function yh(i,e,r){const u={color:{source:h,composite:Oe},number:{source:ie,composite:h}},p=function(y){return{"line-pattern":{source:mn,composite:mn},"fill-pattern":{source:mn,composite:mn},"fill-extrusion-pattern":{source:mn,composite:mn}}[y]}(i);return p&&p[r]||u[e][r]}Bt("ConstantBinder",Fo),Bt("CrossFadedConstantBinder",Vs),Bt("SourceExpressionBinder",la),Bt("CrossFadedCompositeBinder",Pa),Bt("CompositeExpressionBinder",Cr),Bt("ProgramConfiguration",_h,{omit:["_buffers"]}),Bt("ProgramConfigurationSet",cs);var un=8192;const su=Math.pow(2,14)-1,vh=-su-1;function us(i){const e=un/i.extent,r=i.loadGeometry();for(let u=0;u<r.length;u++){const p=r[u];for(let y=0;y<p.length;y++){const b=p[y],I=Math.round(b.x*e),C=Math.round(b.y*e);b.x=S(I,vh,su),b.y=S(C,vh,su),(I<b.x||I>b.x+1||C<b.y||C>b.y+1)&&ge("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function hs(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?us(i):[]}}function ec(i,e,r,u,p){i.emplaceBack(2*e+(u+1)/2,2*r+(p+1)/2)}class ou{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new zi,this.indexArray=new Bn,this.segments=new pi,this.programConfigurations=new cs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,u){const p=this.layers[0],y=[];let b=null,I=!1;p.type==="circle"&&(b=p.layout.get("circle-sort-key"),I=!b.isConstant());for(const{feature:C,id:D,index:B,sourceLayerIndex:F}of e){const U=this.layers[0]._featureFilter.needGeometry,j=hs(C,U);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),j,u))continue;const X=I?b.evaluate(j,{},u):void 0,ue={id:D,properties:C.properties,type:C.type,sourceLayerIndex:F,index:B,geometry:U?j.geometry:us(C),patterns:{},sortKey:X};y.push(ue)}I&&y.sort((C,D)=>C.sortKey-D.sortKey);for(const C of y){const{geometry:D,index:B,sourceLayerIndex:F}=C,U=e[B].feature;this.addFeature(C,D,B,u),r.featureIndex.insert(U,D,B,F,this.index)}}update(e,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,u,p){for(const y of r)for(const b of y){const I=b.x,C=b.y;if(I<0||I>=un||C<0||C>=un)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=D.vertexLength;ec(this.layoutVertexArray,I,C,-1,-1),ec(this.layoutVertexArray,I,C,1,-1),ec(this.layoutVertexArray,I,C,1,1),ec(this.layoutVertexArray,I,C,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+3,B+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},p)}}function bh(i,e){for(let r=0;r<i.length;r++)if(Ns(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ns(i,e[r]))return!0;return!!lu(i,e)}function Bm(i,e,r){return!!Ns(i,e)||!!cu(e,i,r)}function xh(i,e){if(i.length===1)return Ih(e,i[0]);for(let r=0;r<e.length;r++){const u=e[r];for(let p=0;p<u.length;p++)if(Ns(i,u[p]))return!0}for(let r=0;r<i.length;r++)if(Ih(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(lu(i,e[r]))return!0;return!1}function Rm(i,e,r){if(i.length>1){if(lu(i,e))return!0;for(let u=0;u<e.length;u++)if(cu(e[u],i,r))return!0}for(let u=0;u<i.length;u++)if(cu(i[u],e,r))return!0;return!1}function lu(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const u=i[r],p=i[r+1];for(let y=0;y<e.length-1;y++)if(Fm(u,p,e[y],e[y+1]))return!0}return!1}function Fm(i,e,r,u){return se(i,r,u)!==se(e,r,u)&&se(i,e,r)!==se(i,e,u)}function cu(i,e,r){const u=r*r;if(e.length===1)return i.distSqr(e[0])<u;for(let p=1;p<e.length;p++)if(wh(i,e[p-1],e[p])<u)return!0;return!1}function wh(i,e,r){const u=e.distSqr(r);if(u===0)return i.distSqr(e);const p=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/u;return i.distSqr(p<0?e:p>1?r:r.sub(e)._mult(p)._add(e))}function Ih(i,e){let r,u,p,y=!1;for(let b=0;b<i.length;b++){r=i[b];for(let I=0,C=r.length-1;I<r.length;C=I++)u=r[I],p=r[C],u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(y=!y)}return y}function Ns(i,e){let r=!1;for(let u=0,p=i.length-1;u<i.length;p=u++){const y=i[u],b=i[p];y.y>e.y!=b.y>e.y&&e.x<(b.x-y.x)*(e.y-y.y)/(b.y-y.y)+y.x&&(r=!r)}return r}function Om(i,e,r){const u=r[0],p=r[2];if(i.x<u.x&&e.x<u.x||i.x>p.x&&e.x>p.x||i.y<u.y&&e.y<u.y||i.y>p.y&&e.y>p.y)return!1;const y=se(i,e,r[0]);return y!==se(i,e,r[1])||y!==se(i,e,r[2])||y!==se(i,e,r[3])}function Oo(i,e,r){const u=e.paint.get(i).value;return u.kind==="constant"?u.value:r.programConfigurations.get(e.id).getMaxValue(i)}function tc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ic(i,e,r,u,p){if(!e[0]&&!e[1])return i;const y=Ee.convert(e)._mult(p);r==="viewport"&&y._rotate(-u);const b=[];for(let I=0;I<i.length;I++)b.push(i[I].sub(y));return b}Bt("CircleBucket",ou,{omit:["layers"]});const Vm=new xn({"circle-sort-key":new Ht(Ke.layout_circle["circle-sort-key"])});var Nm={paint:new xn({"circle-radius":new Ht(Ke.paint_circle["circle-radius"]),"circle-color":new Ht(Ke.paint_circle["circle-color"]),"circle-blur":new Ht(Ke.paint_circle["circle-blur"]),"circle-opacity":new Ht(Ke.paint_circle["circle-opacity"]),"circle-translate":new Vt(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht(Ke.paint_circle["circle-stroke-opacity"])}),layout:Vm},Rn=1e-6,Fn=typeof Float32Array<"u"?Float32Array:Array;function kh(){var i=new Fn(9);return Fn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function uu(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Th(i,e,r){var u=e[0],p=e[1],y=e[2],b=e[3],I=e[4],C=e[5],D=e[6],B=e[7],F=e[8],U=e[9],j=e[10],X=e[11],ue=e[12],le=e[13],Ce=e[14],Ne=e[15],Ae=r[0],Be=r[1],it=r[2],et=r[3];return i[0]=Ae*u+Be*I+it*F+et*ue,i[1]=Ae*p+Be*C+it*U+et*le,i[2]=Ae*y+Be*D+it*j+et*Ce,i[3]=Ae*b+Be*B+it*X+et*Ne,i[4]=(Ae=r[4])*u+(Be=r[5])*I+(it=r[6])*F+(et=r[7])*ue,i[5]=Ae*p+Be*C+it*U+et*le,i[6]=Ae*y+Be*D+it*j+et*Ce,i[7]=Ae*b+Be*B+it*X+et*Ne,i[8]=(Ae=r[8])*u+(Be=r[9])*I+(it=r[10])*F+(et=r[11])*ue,i[9]=Ae*p+Be*C+it*U+et*le,i[10]=Ae*y+Be*D+it*j+et*Ce,i[11]=Ae*b+Be*B+it*X+et*Ne,i[12]=(Ae=r[12])*u+(Be=r[13])*I+(it=r[14])*F+(et=r[15])*ue,i[13]=Ae*p+Be*C+it*U+et*le,i[14]=Ae*y+Be*D+it*j+et*Ce,i[15]=Ae*b+Be*B+it*X+et*Ne,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Vo,Um=Th;function Eh(){var i=new Fn(3);return Fn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Ah(i,e,r){var u=new Fn(3);return u[0]=i,u[1]=e,u[2]=r,u}function nc(i,e,r){var u=e[0],p=e[1],y=e[2],b=e[3];return i[0]=r[0]*u+r[4]*p+r[8]*y+r[12]*b,i[1]=r[1]*u+r[5]*p+r[9]*y+r[13]*b,i[2]=r[2]*u+r[6]*p+r[10]*y+r[14]*b,i[3]=r[3]*u+r[7]*p+r[11]*y+r[15]*b,i}function Sh(){var i=new Fn(4);return Fn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ch(i,e){const r=nc([],[i.x,i.y,0,1],e);return new Ee(r[0]/r[3],r[1]/r[3])}Eh(),Vo=new Fn(4),Fn!=Float32Array&&(Vo[0]=0,Vo[1]=0,Vo[2]=0,Vo[3]=0),Eh(),Ah(1,0,0),Ah(0,1,0),Sh(),Sh(),kh(),function(){var i;i=new Fn(2),Fn!=Float32Array&&(i[0]=0,i[1]=0)}();class Mh extends ou{}Bt("HeatmapBucket",Mh,{omit:["layers"]});var qm={paint:new xn({"heatmap-radius":new Ht(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gr(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(Ke.paint_heatmap["heatmap-opacity"])})};function hu(i,{width:e,height:r},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*r*u)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${e*r*u}`)}else p=new Uint8Array(e*r*u);return i.width=e,i.height=r,i.data=p,i}function zh(i,{width:e,height:r},u){if(e===i.width&&r===i.height)return;const p=hu({},{width:e,height:r},u);du(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},u),i.width=e,i.height=r,i.data=p.data}function du(i,e,r,u,p,y){if(p.width===0||p.height===0)return e;if(p.width>i.width||p.height>i.height||r.x>i.width-p.width||r.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||u.x>e.width-p.width||u.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=i.data,I=e.data;if(b===I)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<p.height;C++){const D=((r.y+C)*i.width+r.x)*y,B=((u.y+C)*e.width+u.x)*y;for(let F=0;F<p.width*y;F++)I[B+F]=b[D+F]}return e}class No{constructor(e,r){hu(this,e,1,r)}resize(e){zh(this,e,1)}clone(){return new No({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,u,p,y){du(e,r,u,p,y,1)}}class sr{constructor(e,r){hu(this,e,4,r)}resize(e){zh(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new sr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,u,p,y){du(e,r,u,p,y,4)}}function Dh(i){const e={},r=i.resolution||256,u=i.clips?i.clips.length:1,p=i.image||new sr({width:r,height:u});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const y=(b,I,C)=>{e[i.evaluationKey]=C;const D=i.expression.evaluate(e);p.data[b+I+0]=Math.floor(255*D.r/D.a),p.data[b+I+1]=Math.floor(255*D.g/D.a),p.data[b+I+2]=Math.floor(255*D.b/D.a),p.data[b+I+3]=Math.floor(255*D.a)};if(i.clips)for(let b=0,I=0;b<u;++b,I+=4*r)for(let C=0,D=0;C<r;C++,D+=4){const B=C/(r-1),{start:F,end:U}=i.clips[b];y(I,D,F*(1-B)+U*B)}else for(let b=0,I=0;b<r;b++,I+=4)y(0,I,b/(r-1));return p}Bt("AlphaImage",No),Bt("RGBAImage",sr);var Gm={paint:new xn({"hillshade-illumination-direction":new Vt(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(Ke.paint_hillshade["hillshade-accent-color"])})};const jm=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zm}=jm;var rc={exports:{}};function ac(i,e,r){r=r||2;var u,p,y,b,I,C,D,B=e&&e.length,F=B?e[0]*r:i.length,U=Ph(i,0,F,r,!0),j=[];if(!U||U.next===U.prev)return j;if(B&&(U=function(ue,le,Ce,Ne){var Ae,Be,it,et=[];for(Ae=0,Be=le.length;Ae<Be;Ae++)(it=Ph(ue,le[Ae]*Ne,Ae<Be-1?le[Ae+1]*Ne:ue.length,Ne,!1))===it.next&&(it.steiner=!0),et.push($m(it));for(et.sort(Ym),Ae=0;Ae<et.length;Ae++)Ce=Jm(et[Ae],Ce);return Ce}(i,e,U,r)),i.length>80*r){u=y=i[0],p=b=i[1];for(var X=r;X<F;X+=r)(I=i[X])<u&&(u=I),(C=i[X+1])<p&&(p=C),I>y&&(y=I),C>b&&(b=C);D=(D=Math.max(y-u,b-p))!==0?32767/D:0}return Uo(U,j,r,u,p,D,0),j}function Ph(i,e,r,u,p){var y,b;if(p===mu(i,e,r,u)>0)for(y=e;y<r;y+=u)b=Rh(y,i[y],i[y+1],b);else for(y=r-u;y>=e;y-=u)b=Rh(y,i[y],i[y+1],b);return b&&sc(b,b.next)&&(Go(b),b=b.next),b}function ds(i,e){if(!i)return i;e||(e=i);var r,u=i;do if(r=!1,u.steiner||!sc(u,u.next)&&nn(u.prev,u,u.next)!==0)u=u.next;else{if(Go(u),(u=e=u.prev)===u.next)break;r=!0}while(r||u!==e);return e}function Uo(i,e,r,u,p,y,b){if(i){!b&&y&&function(B,F,U,j){var X=B;do X.z===0&&(X.z=fu(X.x,X.y,F,U,j)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==B);X.prevZ.nextZ=null,X.prevZ=null,function(ue){var le,Ce,Ne,Ae,Be,it,et,Dt,Ft=1;do{for(Ce=ue,ue=null,Be=null,it=0;Ce;){for(it++,Ne=Ce,et=0,le=0;le<Ft&&(et++,Ne=Ne.nextZ);le++);for(Dt=Ft;et>0||Dt>0&&Ne;)et!==0&&(Dt===0||!Ne||Ce.z<=Ne.z)?(Ae=Ce,Ce=Ce.nextZ,et--):(Ae=Ne,Ne=Ne.nextZ,Dt--),Be?Be.nextZ=Ae:ue=Ae,Ae.prevZ=Be,Be=Ae;Ce=Ne}Be.nextZ=null,Ft*=2}while(it>1)}(X)}(i,u,p,y);for(var I,C,D=i;i.prev!==i.next;)if(I=i.prev,C=i.next,y?Wm(i,u,p,y):Xm(i))e.push(I.i/r|0),e.push(i.i/r|0),e.push(C.i/r|0),Go(i),i=C.next,D=C.next;else if((i=C)===D){b?b===1?Uo(i=Hm(ds(i),e,r),e,r,u,p,y,2):b===2&&Km(i,e,r,u,p,y):Uo(ds(i),e,r,u,p,y,1);break}}}function Xm(i){var e=i.prev,r=i,u=i.next;if(nn(e,r,u)>=0)return!1;for(var p=e.x,y=r.x,b=u.x,I=e.y,C=r.y,D=u.y,B=p<y?p<b?p:b:y<b?y:b,F=I<C?I<D?I:D:C<D?C:D,U=p>y?p>b?p:b:y>b?y:b,j=I>C?I>D?I:D:C>D?C:D,X=u.next;X!==e;){if(X.x>=B&&X.x<=U&&X.y>=F&&X.y<=j&&Us(p,I,y,C,b,D,X.x,X.y)&&nn(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Wm(i,e,r,u){var p=i.prev,y=i,b=i.next;if(nn(p,y,b)>=0)return!1;for(var I=p.x,C=y.x,D=b.x,B=p.y,F=y.y,U=b.y,j=I<C?I<D?I:D:C<D?C:D,X=B<F?B<U?B:U:F<U?F:U,ue=I>C?I>D?I:D:C>D?C:D,le=B>F?B>U?B:U:F>U?F:U,Ce=fu(j,X,e,r,u),Ne=fu(ue,le,e,r,u),Ae=i.prevZ,Be=i.nextZ;Ae&&Ae.z>=Ce&&Be&&Be.z<=Ne;){if(Ae.x>=j&&Ae.x<=ue&&Ae.y>=X&&Ae.y<=le&&Ae!==p&&Ae!==b&&Us(I,B,C,F,D,U,Ae.x,Ae.y)&&nn(Ae.prev,Ae,Ae.next)>=0||(Ae=Ae.prevZ,Be.x>=j&&Be.x<=ue&&Be.y>=X&&Be.y<=le&&Be!==p&&Be!==b&&Us(I,B,C,F,D,U,Be.x,Be.y)&&nn(Be.prev,Be,Be.next)>=0))return!1;Be=Be.nextZ}for(;Ae&&Ae.z>=Ce;){if(Ae.x>=j&&Ae.x<=ue&&Ae.y>=X&&Ae.y<=le&&Ae!==p&&Ae!==b&&Us(I,B,C,F,D,U,Ae.x,Ae.y)&&nn(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.prevZ}for(;Be&&Be.z<=Ne;){if(Be.x>=j&&Be.x<=ue&&Be.y>=X&&Be.y<=le&&Be!==p&&Be!==b&&Us(I,B,C,F,D,U,Be.x,Be.y)&&nn(Be.prev,Be,Be.next)>=0)return!1;Be=Be.nextZ}return!0}function Hm(i,e,r){var u=i;do{var p=u.prev,y=u.next.next;!sc(p,y)&&Lh(p,u,u.next,y)&&qo(p,y)&&qo(y,p)&&(e.push(p.i/r|0),e.push(u.i/r|0),e.push(y.i/r|0),Go(u),Go(u.next),u=i=y),u=u.next}while(u!==i);return ds(u)}function Km(i,e,r,u,p,y){var b=i;do{for(var I=b.next.next;I!==b.prev;){if(b.i!==I.i&&eg(b,I)){var C=Bh(b,I);return b=ds(b,b.next),C=ds(C,C.next),Uo(b,e,r,u,p,y,0),void Uo(C,e,r,u,p,y,0)}I=I.next}b=b.next}while(b!==i)}function Ym(i,e){return i.x-e.x}function Jm(i,e){var r=function(p,y){var b,I=y,C=p.x,D=p.y,B=-1/0;do{if(D<=I.y&&D>=I.next.y&&I.next.y!==I.y){var F=I.x+(D-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(F<=C&&F>B&&(B=F,b=I.x<I.next.x?I:I.next,F===C))return b}I=I.next}while(I!==y);if(!b)return null;var U,j=b,X=b.x,ue=b.y,le=1/0;I=b;do C>=I.x&&I.x>=X&&C!==I.x&&Us(D<ue?C:B,D,X,ue,D<ue?B:C,D,I.x,I.y)&&(U=Math.abs(D-I.y)/(C-I.x),qo(I,p)&&(U<le||U===le&&(I.x>b.x||I.x===b.x&&Qm(b,I)))&&(b=I,le=U)),I=I.next;while(I!==j);return b}(i,e);if(!r)return e;var u=Bh(r,i);return ds(u,u.next),ds(r,r.next)}function Qm(i,e){return nn(i.prev,i,e.prev)<0&&nn(e.next,i,i.next)<0}function fu(i,e,r,u,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $m(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Us(i,e,r,u,p,y,b,I){return(p-b)*(e-I)>=(i-b)*(y-I)&&(i-b)*(u-I)>=(r-b)*(e-I)&&(r-b)*(y-I)>=(p-b)*(u-I)}function eg(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,u){var p=r;do{if(p.i!==r.i&&p.next.i!==r.i&&p.i!==u.i&&p.next.i!==u.i&&Lh(p,p.next,r,u))return!0;p=p.next}while(p!==r);return!1}(i,e)&&(qo(i,e)&&qo(e,i)&&function(r,u){var p=r,y=!1,b=(r.x+u.x)/2,I=(r.y+u.y)/2;do p.y>I!=p.next.y>I&&p.next.y!==p.y&&b<(p.next.x-p.x)*(I-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==r);return y}(i,e)&&(nn(i.prev,i,e.prev)||nn(i,e.prev,e))||sc(i,e)&&nn(i.prev,i,i.next)>0&&nn(e.prev,e,e.next)>0)}function nn(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function sc(i,e){return i.x===e.x&&i.y===e.y}function Lh(i,e,r,u){var p=lc(nn(i,e,r)),y=lc(nn(i,e,u)),b=lc(nn(r,u,i)),I=lc(nn(r,u,e));return p!==y&&b!==I||!(p!==0||!oc(i,r,e))||!(y!==0||!oc(i,u,e))||!(b!==0||!oc(r,i,u))||!(I!==0||!oc(r,e,u))}function oc(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function lc(i){return i>0?1:i<0?-1:0}function qo(i,e){return nn(i.prev,i,i.next)<0?nn(i,e,i.next)>=0&&nn(i,i.prev,e)>=0:nn(i,e,i.prev)<0||nn(i,i.next,e)<0}function Bh(i,e){var r=new pu(i.i,i.x,i.y),u=new pu(e.i,e.x,e.y),p=i.next,y=e.prev;return i.next=e,e.prev=i,r.next=p,p.prev=r,u.next=r,r.prev=u,y.next=u,u.prev=y,u}function Rh(i,e,r,u){var p=new pu(i,e,r);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function Go(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function pu(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mu(i,e,r,u){for(var p=0,y=e,b=r-u;y<r;y+=u)p+=(i[b]-i[y])*(i[y+1]+i[b+1]),b=y;return p}function tg(i,e,r,u,p){Fh(i,e,r||0,u||i.length-1,p||ig)}function Fh(i,e,r,u,p){for(;u>r;){if(u-r>600){var y=u-r+1,b=e-r+1,I=Math.log(y),C=.5*Math.exp(2*I/3),D=.5*Math.sqrt(I*C*(y-C)/y)*(b-y/2<0?-1:1);Fh(i,e,Math.max(r,Math.floor(e-b*C/y+D)),Math.min(u,Math.floor(e+(y-b)*C/y+D)),p)}var B=i[e],F=r,U=u;for(jo(i,r,e),p(i[u],B)>0&&jo(i,r,u);F<U;){for(jo(i,F,U),F++,U--;p(i[F],B)<0;)F++;for(;p(i[U],B)>0;)U--}p(i[r],B)===0?jo(i,r,U):jo(i,++U,u),U<=e&&(r=U+1),e<=U&&(u=U-1)}}function jo(i,e,r){var u=i[e];i[e]=i[r],i[r]=u}function ig(i,e){return i<e?-1:i>e?1:0}function gu(i,e){const r=i.length;if(r<=1)return[i];const u=[];let p,y;for(let b=0;b<r;b++){const I=je(i[b]);I!==0&&(i[b].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(p&&u.push(p),p=[i[b]]):p.push(i[b]))}if(p&&u.push(p),e>1)for(let b=0;b<u.length;b++)u[b].length<=e||(tg(u[b],e,1,u[b].length-1,ng),u[b]=u[b].slice(0,e));return u}function ng(i,e){return e.area-i.area}function _u(i,e,r){const u=r.patternDependencies;let p=!1;for(const y of e){const b=y.paint.get(`${i}-pattern`);b.isConstant()||(p=!0);const I=b.constantOr(null);I&&(p=!0,u[I.to]=!0,u[I.from]=!0)}return p}function yu(i,e,r,u,p){const y=p.patternDependencies;for(const b of e){const I=b.paint.get(`${i}-pattern`).value;if(I.kind!=="constant"){let C=I.evaluate({zoom:u-1},r,{},p.availableImages),D=I.evaluate({zoom:u},r,{},p.availableImages),B=I.evaluate({zoom:u+1},r,{},p.availableImages);C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,B=B&&B.name?B.name:B,y[C]=!0,y[D]=!0,y[B]=!0,r.patterns[b.id]={min:C,mid:D,max:B}}}return r}rc.exports=ac,rc.exports.default=ac,ac.deviation=function(i,e,r,u){var p=e&&e.length,y=Math.abs(mu(i,0,p?e[0]*r:i.length,r));if(p)for(var b=0,I=e.length;b<I;b++)y-=Math.abs(mu(i,e[b]*r,b<I-1?e[b+1]*r:i.length,r));var C=0;for(b=0;b<u.length;b+=3){var D=u[b]*r,B=u[b+1]*r,F=u[b+2]*r;C+=Math.abs((i[D]-i[F])*(i[B+1]-i[D+1])-(i[D]-i[B])*(i[F+1]-i[D+1]))}return y===0&&C===0?0:Math.abs((C-y)/y)},ac.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},u=0,p=0;p<i.length;p++){for(var y=0;y<i[p].length;y++)for(var b=0;b<e;b++)r.vertices.push(i[p][y][b]);p>0&&r.holes.push(u+=i[p-1].length)}return r};class vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Di,this.indexArray=new Bn,this.indexArray2=new Sr,this.programConfigurations=new cs(e.layers,e.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,u){this.hasPattern=_u("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),b=[];for(const{feature:I,id:C,index:D,sourceLayerIndex:B}of e){const F=this.layers[0]._featureFilter.needGeometry,U=hs(I,F);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),U,u))continue;const j=y?p.evaluate(U,{},u,r.availableImages):void 0,X={id:C,properties:I.properties,type:I.type,sourceLayerIndex:B,index:D,geometry:F?U.geometry:us(I),patterns:{},sortKey:j};b.push(X)}y&&b.sort((I,C)=>I.sortKey-C.sortKey);for(const I of b){const{geometry:C,index:D,sourceLayerIndex:B}=I;if(this.hasPattern){const F=yu("fill",this.layers,I,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(I,C,D,u,{});r.featureIndex.insert(e[D].feature,C,D,B,this.index)}}update(e,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u)}addFeatures(e,r,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,u,p,y){for(const b of gu(r,500)){let I=0;for(const j of b)I+=j.length;const C=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),D=C.vertexLength,B=[],F=[];for(const j of b){if(j.length===0)continue;j!==b[0]&&F.push(B.length/2);const X=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),ue=X.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(ue+j.length-1,ue),B.push(j[0].x),B.push(j[0].y);for(let le=1;le<j.length;le++)this.layoutVertexArray.emplaceBack(j[le].x,j[le].y),this.indexArray2.emplaceBack(ue+le-1,ue+le),B.push(j[le].x),B.push(j[le].y);X.vertexLength+=j.length,X.primitiveLength+=j.length}const U=rc.exports(B,F);for(let j=0;j<U.length;j+=3)this.indexArray.emplaceBack(D+U[j],D+U[j+1],D+U[j+2]);C.vertexLength+=I,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,p)}}Bt("FillBucket",vu,{omit:["layers","patternFeatures"]});const rg=new xn({"fill-sort-key":new Ht(Ke.layout_fill["fill-sort-key"])});var ag={paint:new xn({"fill-antialias":new Vt(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Ht(Ke.paint_fill["fill-opacity"]),"fill-color":new Ht(Ke.paint_fill["fill-color"]),"fill-outline-color":new Ht(Ke.paint_fill["fill-outline-color"]),"fill-translate":new Vt(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new za(Ke.paint_fill["fill-pattern"])}),layout:rg};const sg=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),og=an([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lg}=sg;var La={},cg=Ee,Oh=qs;function qs(i,e,r,u,p){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=p,i.readFields(ug,this,e)}function ug(i,e,r){i==1?e.id=r.readVarint():i==2?function(u,p){for(var y=u.readVarint()+u.pos;u.pos<y;){var b=p._keys[u.readVarint()],I=p._values[u.readVarint()];p.properties[b]=I}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function hg(i){for(var e,r,u=0,p=0,y=i.length,b=y-1;p<y;b=p++)u+=((r=i[b]).x-(e=i[p]).x)*(e.y+r.y);return u}qs.types=["Unknown","Point","LineString","Polygon"],qs.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,u=1,p=0,y=0,b=0,I=[];i.pos<r;){if(p<=0){var C=i.readVarint();u=7&C,p=C>>3}if(p--,u===1||u===2)y+=i.readSVarint(),b+=i.readSVarint(),u===1&&(e&&I.push(e),e=[]),e.push(new cg(y,b));else{if(u!==7)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&I.push(e),I},qs.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,u=0,p=0,y=0,b=1/0,I=-1/0,C=1/0,D=-1/0;i.pos<e;){if(u<=0){var B=i.readVarint();r=7&B,u=B>>3}if(u--,r===1||r===2)(p+=i.readSVarint())<b&&(b=p),p>I&&(I=p),(y+=i.readSVarint())<C&&(C=y),y>D&&(D=y);else if(r!==7)throw new Error("unknown command "+r)}return[b,C,I,D]},qs.prototype.toGeoJSON=function(i,e,r){var u,p,y=this.extent*Math.pow(2,r),b=this.extent*i,I=this.extent*e,C=this.loadGeometry(),D=qs.types[this.type];function B(j){for(var X=0;X<j.length;X++){var ue=j[X];j[X]=[360*(ue.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ue.y+I)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(u=0;u<C.length;u++)F[u]=C[u][0];B(C=F);break;case 2:for(u=0;u<C.length;u++)B(C[u]);break;case 3:for(C=function(j){var X=j.length;if(X<=1)return[j];for(var ue,le,Ce=[],Ne=0;Ne<X;Ne++){var Ae=hg(j[Ne]);Ae!==0&&(le===void 0&&(le=Ae<0),le===Ae<0?(ue&&Ce.push(ue),ue=[j[Ne]]):ue.push(j[Ne]))}return ue&&Ce.push(ue),Ce}(C),u=0;u<C.length;u++)for(p=0;p<C[u].length;p++)B(C[u][p])}C.length===1?C=C[0]:D="Multi"+D;var U={type:"Feature",geometry:{type:D,coordinates:C},properties:this.properties};return"id"in this&&(U.id=this.id),U};var dg=Oh,Vh=Nh;function Nh(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(fg,this,e),this.length=this._features.length}function fg(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(u){for(var p=null,y=u.readVarint()+u.pos;u.pos<y;){var b=u.readVarint()>>3;p=b===1?u.readString():b===2?u.readFloat():b===3?u.readDouble():b===4?u.readVarint64():b===5?u.readVarint():b===6?u.readSVarint():b===7?u.readBoolean():null}return p}(r))}Nh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new dg(this._pbf,e,this.extent,this._keys,this._values)};var pg=Vh;function mg(i,e,r){if(i===3){var u=new pg(r,r.readVarint()+r.pos);u.length&&(e[u.name]=u)}}La.VectorTile=function(i,e){this.layers=i.readFields(mg,{},e)},La.VectorTileFeature=Oh,La.VectorTileLayer=Vh;const gg=La.VectorTileFeature.types,bu=Math.pow(2,13);function Zo(i,e,r,u,p,y,b,I){i.emplaceBack(e,r,2*Math.floor(u*bu)+b,p*bu*2,y*bu*2,Math.round(I))}class xu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new yi,this.centroidVertexArray=new jt,this.indexArray=new Bn,this.programConfigurations=new cs(e.layers,e.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,u){this.features=[],this.hasPattern=_u("fill-extrusion",this.layers,r);for(const{feature:p,id:y,index:b,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,D=hs(p,C);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),D,u))continue;const B={id:y,sourceLayerIndex:I,index:b,geometry:C?D.geometry:us(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(yu("fill-extrusion",this.layers,B,this.zoom,r)):this.addFeature(B,B.geometry,b,u,{}),r.featureIndex.insert(p,B.geometry,b,I,this.index,!0)}}addFeatures(e,r,u){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,r,u)}}update(e,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lg),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,og.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,u,p,y){const b={x:0,y:0,vertexCount:0};for(const I of gu(r,500)){let C=0;for(const X of I)C+=X.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const X of I){if(X.length===0||yg(X))continue;let ue=0;for(let le=0;le<X.length;le++){const Ce=X[le];if(le>=1){const Ne=X[le-1];if(!_g(Ce,Ne)){D.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ae=Ce.sub(Ne)._perp()._unit(),Be=Ne.dist(Ce);ue+Be>32768&&(ue=0),Zo(this.layoutVertexArray,Ce.x,Ce.y,Ae.x,Ae.y,0,0,ue),Zo(this.layoutVertexArray,Ce.x,Ce.y,Ae.x,Ae.y,0,1,ue),b.x+=2*Ce.x,b.y+=2*Ce.y,b.vertexCount+=2,ue+=Be,Zo(this.layoutVertexArray,Ne.x,Ne.y,Ae.x,Ae.y,0,0,ue),Zo(this.layoutVertexArray,Ne.x,Ne.y,Ae.x,Ae.y,0,1,ue),b.x+=2*Ne.x,b.y+=2*Ne.y,b.vertexCount+=2;const it=D.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+C>pi.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),gg[e.type]!=="Polygon")continue;const B=[],F=[],U=D.vertexLength;for(const X of I)if(X.length!==0){X!==I[0]&&F.push(B.length/2);for(let ue=0;ue<X.length;ue++){const le=X[ue];Zo(this.layoutVertexArray,le.x,le.y,0,0,1,1,0),b.x+=le.x,b.y+=le.y,b.vertexCount+=1,B.push(le.x),B.push(le.y)}}const j=rc.exports(B,F);for(let X=0;X<j.length;X+=3)this.indexArray.emplaceBack(U+j[X],U+j[X+2],U+j[X+1]);D.primitiveLength+=j.length/3,D.vertexLength+=C}for(let I=0;I<b.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,p)}}function _g(i,e){return i.x===e.x&&(i.x<0||i.x>un)||i.y===e.y&&(i.y<0||i.y>un)}function yg(i){return i.every(e=>e.x<0)||i.every(e=>e.x>un)||i.every(e=>e.y<0)||i.every(e=>e.y>un)}Bt("FillExtrusionBucket",xu,{omit:["layers","features"]});var vg={paint:new xn({"fill-extrusion-opacity":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new za(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ht(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Xo(i,e){return i.x*e.x+i.y*e.y}function Uh(i,e){if(i.length===1){let r=0;const u=e[r++];let p;for(;!p||u.equals(p);)if(p=e[r++],!p)return 1/0;for(;r<e.length;r++){const y=e[r],b=i[0],I=p.sub(u),C=y.sub(u),D=b.sub(u),B=Xo(I,I),F=Xo(I,C),U=Xo(C,C),j=Xo(D,I),X=Xo(D,C),ue=B*U-F*F,le=(U*j-F*X)/ue,Ce=(B*X-F*j)/ue,Ne=u.z*(1-le-Ce)+p.z*le+y.z*Ce;if(isFinite(Ne))return Ne}return 1/0}{let r=1/0;for(const u of e)r=Math.min(r,u.z);return r}}const bg=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:xg}=bg,wg=an([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ig}=wg,kg=La.VectorTileFeature.types,Tg=Math.cos(Math.PI/180*37.5),qh=Math.pow(2,14)/.5;class wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ti,this.layoutVertexArray2=new Li,this.indexArray=new Bn,this.programConfigurations=new cs(e.layers,e.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,u){this.hasPattern=_u("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),b=[];for(const{feature:I,id:C,index:D,sourceLayerIndex:B}of e){const F=this.layers[0]._featureFilter.needGeometry,U=hs(I,F);if(!this.layers[0]._featureFilter.filter(new Xi(this.zoom),U,u))continue;const j=y?p.evaluate(U,{},u):void 0,X={id:C,properties:I.properties,type:I.type,sourceLayerIndex:B,index:D,geometry:F?U.geometry:us(I),patterns:{},sortKey:j};b.push(X)}y&&b.sort((I,C)=>I.sortKey-C.sortKey);for(const I of b){const{geometry:C,index:D,sourceLayerIndex:B}=I;if(this.hasPattern){const F=yu("line",this.layers,I,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(I,C,D,u,{});r.featureIndex.insert(e[D].feature,C,D,B,this.index)}}update(e,r,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,u)}addFeatures(e,r,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ig)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,u,p,y){const b=this.layers[0].layout,I=b.get("line-join").evaluate(e,{}),C=b.get("line-cap"),D=b.get("line-miter-limit"),B=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const F of r)this.addLine(F,e,I,C,D,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,p)}addLine(e,r,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<e.length-1;Ce++)this.totalDistance+=e[Ce].dist(e[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=kg[r.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let D=0;for(;D<C-1&&e[D].equals(e[D+1]);)D++;if(C<(I?3:2))return;u==="bevel"&&(y=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,j,X,ue,le;this.e1=this.e2=-1,I&&(U=e[C-2],le=e[D].sub(U)._unit()._perp());for(let Ce=D;Ce<C;Ce++){if(X=Ce===C-1?I?e[D+1]:void 0:e[Ce+1],X&&e[Ce].equals(X))continue;le&&(ue=le),U&&(j=U),U=e[Ce],le=X?X.sub(U)._unit()._perp():ue,ue=ue||le;let Ne=ue.add(le);Ne.x===0&&Ne.y===0||Ne._unit();const Ae=ue.x*le.x+ue.y*le.y,Be=Ne.x*le.x+Ne.y*le.y,it=Be!==0?1/Be:1/0,et=2*Math.sqrt(2-2*Be),Dt=Be<Tg&&j&&X,Ft=ue.x*le.y-ue.y*le.x>0;if(Dt&&Ce>D){const _t=U.dist(j);if(_t>2*B){const At=U.sub(U.sub(j)._mult(B/_t)._round());this.updateDistance(j,At),this.addCurrentVertex(At,ue,0,0,F),j=At}}const Et=j&&X;let wt=Et?u:I?"butt":p;if(Et&&wt==="round"&&(it<b?wt="miter":it<=2&&(wt="fakeround")),wt==="miter"&&it>y&&(wt="bevel"),wt==="bevel"&&(it>2&&(wt="flipbevel"),it<y&&(wt="miter")),j&&this.updateDistance(j,U),wt==="miter")Ne._mult(it),this.addCurrentVertex(U,Ne,0,0,F);else if(wt==="flipbevel"){if(it>100)Ne=le.mult(-1);else{const _t=it*ue.add(le).mag()/ue.sub(le).mag();Ne._perp()._mult(_t*(Ft?-1:1))}this.addCurrentVertex(U,Ne,0,0,F),this.addCurrentVertex(U,Ne.mult(-1),0,0,F)}else if(wt==="bevel"||wt==="fakeround"){const _t=-Math.sqrt(it*it-1),At=Ft?_t:0,kt=Ft?0:_t;if(j&&this.addCurrentVertex(U,ue,At,kt,F),wt==="fakeround"){const pt=Math.round(180*et/Math.PI/20);for(let Zt=1;Zt<pt;Zt++){let Nt=Zt/pt;if(Nt!==.5){const qi=Nt-.5;Nt+=Nt*qi*(Nt-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*qi*qi+(.848013+Ae*(.215638*Ae-1.06021)))}const di=le.sub(ue)._mult(Nt)._add(ue)._unit()._mult(Ft?-1:1);this.addHalfVertex(U,di.x,di.y,!1,Ft,0,F)}}X&&this.addCurrentVertex(U,le,-At,-kt,F)}else if(wt==="butt")this.addCurrentVertex(U,Ne,0,0,F);else if(wt==="square"){const _t=j?1:-1;this.addCurrentVertex(U,Ne,_t,_t,F)}else wt==="round"&&(j&&(this.addCurrentVertex(U,ue,0,0,F),this.addCurrentVertex(U,ue,1,1,F,!0)),X&&(this.addCurrentVertex(U,le,-1,-1,F,!0),this.addCurrentVertex(U,le,0,0,F)));if(Dt&&Ce<C-1){const _t=U.dist(X);if(_t>2*B){const At=U.add(X.sub(U)._mult(B/_t)._round());this.updateDistance(U,At),this.addCurrentVertex(At,le,0,0,F),U=At}}}}addCurrentVertex(e,r,u,p,y,b=!1){const I=r.y*p-r.x,C=-r.y-r.x*p;this.addHalfVertex(e,r.x+r.y*u,r.y-r.x*u,b,!1,u,y),this.addHalfVertex(e,I,C,b,!0,-p,y),this.distance>qh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,u,p,y,b))}addHalfVertex({x:e,y:r},u,p,y,b,I,C){const D=.5*(this.lineClips?this.scaledDistance*(qh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(r<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const B=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),C.primitiveLength++),b?this.e2=B:this.e1=B}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Bt("LineBucket",wu,{omit:["layers","patternFeatures"]});const Eg=new xn({"line-cap":new Vt(Ke.layout_line["line-cap"]),"line-join":new Ht(Ke.layout_line["line-join"]),"line-miter-limit":new Vt(Ke.layout_line["line-miter-limit"]),"line-round-limit":new Vt(Ke.layout_line["line-round-limit"]),"line-sort-key":new Ht(Ke.layout_line["line-sort-key"])});var Gh={paint:new xn({"line-opacity":new Ht(Ke.paint_line["line-opacity"]),"line-color":new Ht(Ke.paint_line["line-color"]),"line-translate":new Vt(Ke.paint_line["line-translate"]),"line-translate-anchor":new Vt(Ke.paint_line["line-translate-anchor"]),"line-width":new Ht(Ke.paint_line["line-width"]),"line-gap-width":new Ht(Ke.paint_line["line-gap-width"]),"line-offset":new Ht(Ke.paint_line["line-offset"]),"line-blur":new Ht(Ke.paint_line["line-blur"]),"line-dasharray":new Po(Ke.paint_line["line-dasharray"]),"line-pattern":new za(Ke.paint_line["line-pattern"]),"line-gradient":new Gr(Ke.paint_line["line-gradient"])}),layout:Eg};const jh=new class extends Ht{possiblyEvaluate(i,e){return e=new Xi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,u){return e=W({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,u)}}(Gh.paint.properties["line-width"].specification);function Zh(i,e){return e>0?e+2*i:i}jh.useIntegerZoom=!0;const Ag=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sg=an([{name:"a_projected_pos",components:3,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Cg=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);an([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Xh=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mg=an([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zg(i,e,r){return i.sections.forEach(u=>{u.text=function(p,y,b){const I=y.layout.get("text-transform").evaluate(b,{});return I==="uppercase"?p=p.toLocaleUpperCase():I==="lowercase"&&(p=p.toLocaleLowerCase()),Qn.applyArabicShaping&&(p=Qn.applyArabicShaping(p)),p}(u.text,e,r)}),i}an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Wo={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var wn=24,Iu=Oi,Wh=function(i,e,r,u,p){var y,b,I=8*p-u-1,C=(1<<I)-1,D=C>>1,B=-7,F=r?p-1:0,U=r?-1:1,j=i[e+F];for(F+=U,y=j&(1<<-B)-1,j>>=-B,B+=I;B>0;y=256*y+i[e+F],F+=U,B-=8);for(b=y&(1<<-B)-1,y>>=-B,B+=u;B>0;b=256*b+i[e+F],F+=U,B-=8);if(y===0)y=1-D;else{if(y===C)return b?NaN:1/0*(j?-1:1);b+=Math.pow(2,u),y-=D}return(j?-1:1)*b*Math.pow(2,y-u)},Hh=function(i,e,r,u,p,y){var b,I,C,D=8*y-p-1,B=(1<<D)-1,F=B>>1,U=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=u?0:y-1,X=u?1:-1,ue=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(I=isNaN(e)?1:0,b=B):(b=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-b))<1&&(b--,C*=2),(e+=b+F>=1?U/C:U*Math.pow(2,1-F))*C>=2&&(b++,C/=2),b+F>=B?(I=0,b=B):b+F>=1?(I=(e*C-1)*Math.pow(2,p),b+=F):(I=e*Math.pow(2,F-1)*Math.pow(2,p),b=0));p>=8;i[r+j]=255&I,j+=X,I/=256,p-=8);for(b=b<<p|I,D+=p;D>0;i[r+j]=255&b,j+=X,b/=256,D-=8);i[r+j-X]|=128*ue};function Oi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Oi.Varint=0,Oi.Fixed64=1,Oi.Bytes=2,Oi.Fixed32=5;var Ba,ku=4294967296,Kh=1/ku,Yh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ca(i){return i.type===Oi.Bytes?i.readVarint()+i.pos:i.pos+1}function Gs(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Jh(i,e,r){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(u);for(var p=r.pos-1;p>=i;p--)r.buf[p+u]=r.buf[p]}function Dg(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Pg(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function Lg(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function Bg(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function Rg(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function Fg(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function Og(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Vg(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function Ng(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function cc(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function js(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Qh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Ug(i,e,r){i===1&&r.readMessage(qg,e)}function qg(i,e,r){if(i===3){const{id:u,bitmap:p,width:y,height:b,left:I,top:C,advance:D}=r.readMessage(Gg,{});e.push({id:u,bitmap:new No({width:y+6,height:b+6},p),metrics:{width:y,height:b,left:I,top:C,advance:D}})}}function Gg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function $h(i){let e=0,r=0;for(const b of i)e+=b.w*b.h,r=Math.max(r,b.w);i.sort((b,I)=>I.h-b.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let p=0,y=0;for(const b of i)for(let I=u.length-1;I>=0;I--){const C=u[I];if(!(b.w>C.w||b.h>C.h)){if(b.x=C.x,b.y=C.y,y=Math.max(y,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===C.w&&b.h===C.h){const D=u.pop();I<u.length&&(u[I]=D)}else b.h===C.h?(C.x+=b.w,C.w-=b.w):b.w===C.w?(C.y+=b.h,C.h-=b.h):(u.push({x:C.x+b.w,y:C.y,w:C.w-b.w,h:b.h}),C.y+=b.h,C.h-=b.h);break}}return{w:p,h:y,fill:e/(p*y)||0}}Oi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var u=this.readVarint(),p=u>>3,y=this.pos;this.type=7&u,i(p,e,this),this.pos===y&&this.skip(u)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=cc(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Qh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=cc(this.buf,this.pos)+cc(this.buf,this.pos+4)*ku;return this.pos+=8,i},readSFixed64:function(){var i=cc(this.buf,this.pos)+Qh(this.buf,this.pos+4)*ku;return this.pos+=8,i},readFloat:function(){var i=Wh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Wh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,u=this.buf;return e=127&(r=u[this.pos++]),r<128?e:(e|=(127&(r=u[this.pos++]))<<7,r<128?e:(e|=(127&(r=u[this.pos++]))<<14,r<128?e:(e|=(127&(r=u[this.pos++]))<<21,r<128?e:function(p,y,b){var I,C,D=b.buf;if(I=(112&(C=D[b.pos++]))>>4,C<128||(I|=(127&(C=D[b.pos++]))<<3,C<128)||(I|=(127&(C=D[b.pos++]))<<10,C<128)||(I|=(127&(C=D[b.pos++]))<<17,C<128)||(I|=(127&(C=D[b.pos++]))<<24,C<128)||(I|=(1&(C=D[b.pos++]))<<31,C<128))return Gs(p,I,y);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Yh?function(r,u,p){return Yh.decode(r.subarray(u,p))}(this.buf,e,i):function(r,u,p){for(var y="",b=u;b<p;){var I,C,D,B=r[b],F=null,U=B>239?4:B>223?3:B>191?2:1;if(b+U>p)break;U===1?B<128&&(F=B):U===2?(192&(I=r[b+1]))==128&&(F=(31&B)<<6|63&I)<=127&&(F=null):U===3?(C=r[b+2],(192&(I=r[b+1]))==128&&(192&C)==128&&((F=(15&B)<<12|(63&I)<<6|63&C)<=2047||F>=55296&&F<=57343)&&(F=null)):U===4&&(C=r[b+2],D=r[b+3],(192&(I=r[b+1]))==128&&(192&C)==128&&(192&D)==128&&((F=(15&B)<<18|(63&I)<<12|(63&C)<<6|63&D)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,U=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),b+=U}return y}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Oi.Bytes)return i.push(this.readVarint(e));var r=ca(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Oi.Bytes)return i.push(this.readSVarint());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Oi.Bytes)return i.push(this.readBoolean());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Oi.Bytes)return i.push(this.readFloat());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Oi.Bytes)return i.push(this.readDouble());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Oi.Bytes)return i.push(this.readFixed32());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Oi.Bytes)return i.push(this.readSFixed32());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Oi.Bytes)return i.push(this.readFixed64());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Oi.Bytes)return i.push(this.readSFixed64());var e=ca(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Oi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Oi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Oi.Fixed32)this.pos+=4;else{if(e!==Oi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),js(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),js(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),js(this.buf,-1&i,this.pos),js(this.buf,Math.floor(i*Kh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),js(this.buf,-1&i,this.pos),js(this.buf,Math.floor(i*Kh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var u,p;if(e>=0?(u=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,p=p+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,b,I){I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,I.buf[I.pos]=127&(y>>>=7)}(u,0,r),function(y,b){var I=(7&y)<<4;b.buf[b.pos++]|=I|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(p,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(u,p,y){for(var b,I,C=0;C<p.length;C++){if((b=p.charCodeAt(C))>55295&&b<57344){if(!I){b>56319||C+1===p.length?(u[y++]=239,u[y++]=191,u[y++]=189):I=b;continue}if(b<56320){u[y++]=239,u[y++]=191,u[y++]=189,I=b;continue}b=I-55296<<10|b-56320|65536,I=null}else I&&(u[y++]=239,u[y++]=191,u[y++]=189,I=null);b<128?u[y++]=b:(b<2048?u[y++]=b>>6|192:(b<65536?u[y++]=b>>12|224:(u[y++]=b>>18|240,u[y++]=b>>12&63|128),u[y++]=b>>6&63|128),u[y++]=63&b|128)}return y}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Jh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Hh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Hh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var u=this.pos-r;u>=128&&Jh(r,u,this),this.pos=r-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,e,r){this.writeTag(i,Oi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Dg,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Pg,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Rg,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Lg,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Bg,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Fg,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Og,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Vg,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Ng,e)},writeBytesField:function(i,e){this.writeTag(i,Oi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Oi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Oi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Oi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Oi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Oi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Oi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Oi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Oi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Oi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};class Tu{constructor(e,{pixelRatio:r,version:u,stretchX:p,stretchY:y,content:b}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=p,this.stretchY=y,this.content=b,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ed{constructor(e,r){const u={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,u,y),this.addImages(r,p,y);const{w:b,h:I}=$h(y),C=new sr({width:b||1,height:I||1});for(const D in e){const B=e[D],F=u[D].paddedRect;sr.copy(B.data,C,{x:0,y:0},{x:F.x+1,y:F.y+1},B.data)}for(const D in r){const B=r[D],F=p[D].paddedRect,U=F.x+1,j=F.y+1,X=B.data.width,ue=B.data.height;sr.copy(B.data,C,{x:0,y:0},{x:U,y:j},B.data),sr.copy(B.data,C,{x:0,y:ue-1},{x:U,y:j-1},{width:X,height:1}),sr.copy(B.data,C,{x:0,y:0},{x:U,y:j+ue},{width:X,height:1}),sr.copy(B.data,C,{x:X-1,y:0},{x:U-1,y:j},{width:1,height:ue}),sr.copy(B.data,C,{x:0,y:0},{x:U+X,y:j},{width:1,height:ue})}this.image=C,this.iconPositions=u,this.patternPositions=p}addImages(e,r,u){for(const p in e){const y=e[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),r[p]=new Tu(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),r),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),r)}patchUpdatedImage(e,r,u){if(!e||!r||e.version===r.version)return;e.version=r.version;const[p,y]=e.tl;u.update(r.data,void 0,{x:p,y})}}Bt("ImagePosition",Tu),Bt("ImageAtlas",ed),s.WritingMode=void 0,(Ba=s.WritingMode||(s.WritingMode={}))[Ba.none=0]="none",Ba[Ba.horizontal=1]="horizontal",Ba[Ba.vertical=2]="vertical",Ba[Ba.horizontalOnly=3]="horizontalOnly";const uc=-17;class Ho{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const u=new Ho;return u.scale=e||1,u.fontStack=r,u}static forImage(e){const r=new Ho;return r.imageName=e,r}}class Zs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const u=new Zs;for(let p=0;p<e.sections.length;p++){const y=e.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let u=0;u<e.length;u++){const p=e.charCodeAt(u+1)||null,y=e.charCodeAt(u-1)||null;r+=p&&jl(p)&&!Wo[e[u+1]]||y&&jl(y)&&!Wo[e[u-1]]||!Wo[e[u]]?e[u]:Wo[e[u]]}return r}(this.text)}trim(){let e=0;for(let u=0;u<this.text.length&&dc[this.text.charCodeAt(u)];u++)e++;let r=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&dc[this.text.charCodeAt(u)];u--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const u=new Zs;return u.text=this.text.substring(e,r),u.sectionIndex=this.sectionIndex.slice(e,r),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Ho.forText(e.scale,e.fontStack||r));const u=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(u)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void ge("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Ho.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ge("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hc(i,e,r,u,p,y,b,I,C,D,B,F,U,j,X,ue){const le=Zs.fromFeature(i,p);let Ce;F===s.WritingMode.vertical&&le.verticalizePunctuation();const{processBidirectionalText:Ne,processStyledBidirectionalText:Ae}=Qn;if(Ne&&le.sections.length===1){Ce=[];const et=Ne(le.toString(),Eu(le,D,y,e,u,j,X));for(const Dt of et){const Ft=new Zs;Ft.text=Dt,Ft.sections=le.sections;for(let Et=0;Et<Dt.length;Et++)Ft.sectionIndex.push(0);Ce.push(Ft)}}else if(Ae){Ce=[];const et=Ae(le.text,le.sectionIndex,Eu(le,D,y,e,u,j,X));for(const Dt of et){const Ft=new Zs;Ft.text=Dt[0],Ft.sectionIndex=Dt[1],Ft.sections=le.sections,Ce.push(Ft)}}else Ce=function(et,Dt){const Ft=[],Et=et.text;let wt=0;for(const _t of Dt)Ft.push(et.substring(wt,_t)),wt=_t;return wt<Et.length&&Ft.push(et.substring(wt,Et.length)),Ft}(le,Eu(le,D,y,e,u,j,X));const Be=[],it={positionedLines:Be,text:le.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(et,Dt,Ft,Et,wt,_t,At,kt,pt,Zt,Nt,di){let qi=0,Hi=uc,hn=0,lr=0;const kn=kt==="right"?1:kt==="left"?0:.5;let sn=0;for(const on of wt){on.trim();const En=on.getMaxScale(),Mn=(En-1)*wn,On={positionedGlyphs:[],lineOffset:0};et.positionedLines[sn]=On;const Xn=On.positionedGlyphs;let Wn=0;if(!on.length()){Hi+=_t,++sn;continue}for(let vn=0;vn<on.length();vn++){const gi=on.getSection(vn),tr=on.getSectionIndex(vn),An=on.getCharCode(vn);let zn=0,yr=null,Mr=null,zr=null,ha=wn;const vr=!(pt===s.WritingMode.horizontal||!Nt&&!Ao(An)||Nt&&(dc[An]||(yn=An,Tt.Arabic(yn)||Tt["Arabic Supplement"](yn)||Tt["Arabic Extended-A"](yn)||Tt["Arabic Presentation Forms-A"](yn)||Tt["Arabic Presentation Forms-B"](yn))));if(gi.imageName){const cr=Et[gi.imageName];if(!cr)continue;zr=gi.imageName,et.iconsInText=et.iconsInText||!0,Mr=cr.paddedRect;const Hn=cr.displaySize;gi.scale=gi.scale*wn/di,yr={width:Hn[0],height:Hn[1],left:1,top:-3,advance:vr?Hn[1]:Hn[0]},zn=Mn+(wn-Hn[1]*gi.scale),ha=yr.advance;const da=vr?Hn[0]*gi.scale-wn*En:Hn[1]*gi.scale-wn*En;da>0&&da>Wn&&(Wn=da)}else{const cr=Ft[gi.fontStack],Hn=cr&&cr[An];if(Hn&&Hn.rect)Mr=Hn.rect,yr=Hn.metrics;else{const da=Dt[gi.fontStack],Jo=da&&da[An];if(!Jo)continue;yr=Jo.metrics}zn=(En-gi.scale)*wn}vr?(et.verticalizable=!0,Xn.push({glyph:An,imageName:zr,x:qi,y:Hi+zn,vertical:vr,scale:gi.scale,fontStack:gi.fontStack,sectionIndex:tr,metrics:yr,rect:Mr}),qi+=ha*gi.scale+Zt):(Xn.push({glyph:An,imageName:zr,x:qi,y:Hi+zn,vertical:vr,scale:gi.scale,fontStack:gi.fontStack,sectionIndex:tr,metrics:yr,rect:Mr}),qi+=yr.advance*gi.scale+Zt)}Xn.length!==0&&(hn=Math.max(qi-Zt,hn),Xg(Xn,0,Xn.length-1,kn,Wn)),qi=0;const Ki=_t*En+Wn;On.lineOffset=Math.max(Wn,Mn),Hi+=Ki,lr=Math.max(Ki,lr),++sn}var yn;const Tn=Hi-uc,{horizontalAlign:Cn,verticalAlign:Zn}=Au(At);(function(on,En,Mn,On,Xn,Wn,Ki,vn,gi){const tr=(En-Mn)*Xn;let An=0;An=Wn!==Ki?-vn*On-uc:(-On*gi+.5)*Ki;for(const zn of on)for(const yr of zn.positionedGlyphs)yr.x+=tr,yr.y+=An})(et.positionedLines,kn,Cn,Zn,hn,lr,_t,Tn,wt.length),et.top+=-Zn*Tn,et.bottom=et.top+Tn,et.left+=-Cn*hn,et.right=et.left+hn}(it,e,r,u,Ce,b,I,C,F,D,U,ue),!function(et){for(const Dt of et)if(Dt.positionedGlyphs.length!==0)return!1;return!0}(Be)&&it}const dc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function td(i,e,r,u,p,y){if(e.imageName){const b=u[e.imageName];return b?b.displaySize[0]*e.scale*wn/y+p:0}{const b=r[e.fontStack],I=b&&b[i];return I?I.metrics.advance*e.scale+p:0}}function id(i,e,r,u){const p=Math.pow(i-e,2);return u?i<e?p/2:2*p:p+Math.abs(r)*r}function Zg(i,e,r){let u=0;return i===10&&(u-=1e4),r&&(u+=150),i!==40&&i!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function nd(i,e,r,u,p,y){let b=null,I=id(e,r,p,y);for(const C of u){const D=id(e-C.x,r,p,y)+C.badness;D<=I&&(b=C,I=D)}return{index:i,x:e,priorBreak:b,badness:I}}function rd(i){return i?rd(i.priorBreak).concat(i.index):[]}function Eu(i,e,r,u,p,y,b){if(y!=="point")return[];if(!i)return[];const I=[],C=function(U,j,X,ue,le,Ce){let Ne=0;for(let Ae=0;Ae<U.length();Ae++){const Be=U.getSection(Ae);Ne+=td(U.getCharCode(Ae),Be,ue,le,j,Ce)}return Ne/Math.max(1,Math.ceil(Ne/X))}(i,e,r,u,p,b),D=i.text.indexOf("​")>=0;let B=0;for(let U=0;U<i.length();U++){const j=i.getSection(U),X=i.getCharCode(U);if(dc[X]||(B+=td(X,j,u,p,e,b)),U<i.length()-1){const ue=!((F=X)<11904||!(Tt["Bopomofo Extended"](F)||Tt.Bopomofo(F)||Tt["CJK Compatibility Forms"](F)||Tt["CJK Compatibility Ideographs"](F)||Tt["CJK Compatibility"](F)||Tt["CJK Radicals Supplement"](F)||Tt["CJK Strokes"](F)||Tt["CJK Symbols and Punctuation"](F)||Tt["CJK Unified Ideographs Extension A"](F)||Tt["CJK Unified Ideographs"](F)||Tt["Enclosed CJK Letters and Months"](F)||Tt["Halfwidth and Fullwidth Forms"](F)||Tt.Hiragana(F)||Tt["Ideographic Description Characters"](F)||Tt["Kangxi Radicals"](F)||Tt["Katakana Phonetic Extensions"](F)||Tt.Katakana(F)||Tt["Vertical Forms"](F)||Tt["Yi Radicals"](F)||Tt["Yi Syllables"](F)));(jg[X]||ue||j.imageName)&&I.push(nd(U+1,B,C,I,Zg(X,i.getCharCode(U+1),ue&&D),!1))}}var F;return rd(nd(i.length(),B,C,I,0,!0))}function Au(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Xg(i,e,r,u,p){if(!u&&!p)return;const y=i[r],b=(i[r].x+y.metrics.advance*y.scale)*u;for(let I=e;I<=r;I++)i[I].x-=b,i[I].y+=p}function Wg(i,e,r){const{horizontalAlign:u,verticalAlign:p}=Au(r),y=e[0]-i.displaySize[0]*u,b=e[1]-i.displaySize[1]*p;return{image:i,top:b,bottom:b+i.displaySize[1],left:y,right:y+i.displaySize[0]}}function ad(i,e,r,u,p,y){const b=i.image;let I;if(b.content){const le=b.content,Ce=b.pixelRatio||1;I=[le[0]/Ce,le[1]/Ce,b.displaySize[0]-le[2]/Ce,b.displaySize[1]-le[3]/Ce]}const C=e.left*y,D=e.right*y;let B,F,U,j;r==="width"||r==="both"?(j=p[0]+C-u[3],F=p[0]+D+u[1]):(j=p[0]+(C+D-b.displaySize[0])/2,F=j+b.displaySize[0]);const X=e.top*y,ue=e.bottom*y;return r==="height"||r==="both"?(B=p[1]+X-u[0],U=p[1]+ue+u[2]):(B=p[1]+(X+ue-b.displaySize[1])/2,U=B+b.displaySize[1]),{image:b,top:B,right:F,bottom:U,left:j,collisionPadding:I}}const ua=128;function sd(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Xi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=r;let y=0;for(;y<u.length&&u[y]<=i;)y++;y=Math.max(0,y-1);let b=y;for(;b<u.length&&u[b]<i+1;)b++;b=Math.min(u.length-1,b);const I=u[y],C=u[b];return r.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:I,maxZoom:C,minSize:r.evaluate(new Xi(I)),maxSize:r.evaluate(new Xi(C)),interpolationType:p}}}class Ra extends Ee{constructor(e,r,u,p){super(e,r),this.angle=u,p!==void 0&&(this.segment=p)}clone(){return new Ra(this.x,this.y,this.angle,this.segment)}}function od(i,e,r,u,p){if(e.segment===void 0)return!0;let y=e,b=e.segment+1,I=0;for(;I>-r/2;){if(b--,b<0)return!1;I-=i[b].dist(y),y=i[b]}I+=i[b].dist(i[b+1]),b++;const C=[];let D=0;for(;I<r/2;){const B=i[b],F=i[b+1];if(!F)return!1;let U=i[b-1].angleTo(B)-B.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:I,angleDelta:U}),D+=U;I-C[0].distance>u;)D-=C.shift().angleDelta;if(D>p)return!1;b++,I+=B.dist(F)}return!0}function ld(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function cd(i,e,r){return i?.6*e*r:0}function ud(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Hg(i,e,r,u,p,y){const b=cd(r,p,y),I=ud(r,u)*y;let C=0;const D=ld(i)/2;for(let B=0;B<i.length-1;B++){const F=i[B],U=i[B+1],j=F.dist(U);if(C+j>D){const X=(D-C)/j,ue=ji(F.x,U.x,X),le=ji(F.y,U.y,X),Ce=new Ra(ue,le,U.angleTo(F),B);return Ce._round(),!b||od(i,Ce,I,b,e)?Ce:void 0}C+=j}}function Kg(i,e,r,u,p,y,b,I,C){const D=cd(u,y,b),B=ud(u,p),F=B*b,U=i[0].x===0||i[0].x===C||i[0].y===0||i[0].y===C;return e-F<e/4&&(e=F+e/4),hd(i,U?e/2*I%e:(B/2+2*y)*b*I%e,e,D,r,F,U,!1,C)}function hd(i,e,r,u,p,y,b,I,C){const D=y/2,B=ld(i);let F=0,U=e-r,j=[];for(let X=0;X<i.length-1;X++){const ue=i[X],le=i[X+1],Ce=ue.dist(le),Ne=le.angleTo(ue);for(;U+r<F+Ce;){U+=r;const Ae=(U-F)/Ce,Be=ji(ue.x,le.x,Ae),it=ji(ue.y,le.y,Ae);if(Be>=0&&Be<C&&it>=0&&it<C&&U-D>=0&&U+D<=B){const et=new Ra(Be,it,Ne,X);et._round(),u&&!od(i,et,y,u,p)||j.push(et)}}F+=Ce}return I||j.length||b||(j=hd(i,F/2,r,u,p,y,b,!0,C)),j}function dd(i,e,r,u,p){const y=[];for(let b=0;b<i.length;b++){const I=i[b];let C;for(let D=0;D<I.length-1;D++){let B=I[D],F=I[D+1];B.x<e&&F.x<e||(B.x<e?B=new Ee(e,B.y+(e-B.x)/(F.x-B.x)*(F.y-B.y))._round():F.x<e&&(F=new Ee(e,B.y+(e-B.x)/(F.x-B.x)*(F.y-B.y))._round()),B.y<r&&F.y<r||(B.y<r?B=new Ee(B.x+(r-B.y)/(F.y-B.y)*(F.x-B.x),r)._round():F.y<r&&(F=new Ee(B.x+(r-B.y)/(F.y-B.y)*(F.x-B.x),r)._round()),B.x>=u&&F.x>=u||(B.x>=u?B=new Ee(u,B.y+(u-B.x)/(F.x-B.x)*(F.y-B.y))._round():F.x>=u&&(F=new Ee(u,B.y+(u-B.x)/(F.x-B.x)*(F.y-B.y))._round()),B.y>=p&&F.y>=p||(B.y>=p?B=new Ee(B.x+(p-B.y)/(F.y-B.y)*(F.x-B.x),p)._round():F.y>=p&&(F=new Ee(B.x+(p-B.y)/(F.y-B.y)*(F.x-B.x),p)._round()),C&&B.equals(C[C.length-1])||(C=[B],y.push(C)),C.push(F)))))}}return y}function fd(i,e,r,u){const p=[],y=i.image,b=y.pixelRatio,I=y.paddedRect.w-2,C=y.paddedRect.h-2,D=i.right-i.left,B=i.bottom-i.top,F=y.stretchX||[[0,I]],U=y.stretchY||[[0,C]],j=(_t,At)=>_t+At[1]-At[0],X=F.reduce(j,0),ue=U.reduce(j,0),le=I-X,Ce=C-ue;let Ne=0,Ae=X,Be=0,it=ue,et=0,Dt=le,Ft=0,Et=Ce;if(y.content&&u){const _t=y.content;Ne=fc(F,0,_t[0]),Be=fc(U,0,_t[1]),Ae=fc(F,_t[0],_t[2]),it=fc(U,_t[1],_t[3]),et=_t[0]-Ne,Ft=_t[1]-Be,Dt=_t[2]-_t[0]-Ae,Et=_t[3]-_t[1]-it}const wt=(_t,At,kt,pt)=>{const Zt=pc(_t.stretch-Ne,Ae,D,i.left),Nt=mc(_t.fixed-et,Dt,_t.stretch,X),di=pc(At.stretch-Be,it,B,i.top),qi=mc(At.fixed-Ft,Et,At.stretch,ue),Hi=pc(kt.stretch-Ne,Ae,D,i.left),hn=mc(kt.fixed-et,Dt,kt.stretch,X),lr=pc(pt.stretch-Be,it,B,i.top),kn=mc(pt.fixed-Ft,Et,pt.stretch,ue),sn=new Ee(Zt,di),yn=new Ee(Hi,di),Tn=new Ee(Hi,lr),Cn=new Ee(Zt,lr),Zn=new Ee(Nt/b,qi/b),on=new Ee(hn/b,kn/b),En=e*Math.PI/180;if(En){const Xn=Math.sin(En),Wn=Math.cos(En),Ki=[Wn,-Xn,Xn,Wn];sn._matMult(Ki),yn._matMult(Ki),Cn._matMult(Ki),Tn._matMult(Ki)}const Mn=_t.stretch+_t.fixed,On=At.stretch+At.fixed;return{tl:sn,tr:yn,bl:Cn,br:Tn,tex:{x:y.paddedRect.x+1+Mn,y:y.paddedRect.y+1+On,w:kt.stretch+kt.fixed-Mn,h:pt.stretch+pt.fixed-On},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zn,pixelOffsetBR:on,minFontScaleX:Dt/b/D,minFontScaleY:Et/b/B,isSDF:r}};if(u&&(y.stretchX||y.stretchY)){const _t=pd(F,le,X),At=pd(U,Ce,ue);for(let kt=0;kt<_t.length-1;kt++){const pt=_t[kt],Zt=_t[kt+1];for(let Nt=0;Nt<At.length-1;Nt++)p.push(wt(pt,At[Nt],Zt,At[Nt+1]))}}else p.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:C+1}));return p}function fc(i,e,r){let u=0;for(const p of i)u+=Math.max(e,Math.min(r,p[1]))-Math.max(e,Math.min(r,p[0]));return u}function pd(i,e,r){const u=[{fixed:-1,stretch:0}];for(const[p,y]of i){const b=u[u.length-1];u.push({fixed:p-b.stretch,stretch:b.stretch}),u.push({fixed:p-b.stretch,stretch:b.stretch+(y-p)})}return u.push({fixed:e+1,stretch:r}),u}function pc(i,e,r,u){return i/e*r+u}function mc(i,e,r,u){return i-e*r/u}Bt("Anchor",Ra);class gc{constructor(e,r,u,p,y,b,I,C,D,B){if(this.boxStartIndex=e.length,D){let F=b.top,U=b.bottom;const j=b.collisionPadding;j&&(F-=j[1],U+=j[3]);let X=U-F;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{let F=b.top*I-C[0],U=b.bottom*I+C[2],j=b.left*I-C[3],X=b.right*I+C[1];const ue=b.collisionPadding;if(ue&&(j-=ue[0]*I,F-=ue[1]*I,X+=ue[2]*I,U+=ue[3]*I),B){const le=new Ee(j,F),Ce=new Ee(X,F),Ne=new Ee(j,U),Ae=new Ee(X,U),Be=B*Math.PI/180;le._rotate(Be),Ce._rotate(Be),Ne._rotate(Be),Ae._rotate(Be),j=Math.min(le.x,Ce.x,Ne.x,Ae.x),X=Math.max(le.x,Ce.x,Ne.x,Ae.x),F=Math.min(le.y,Ce.y,Ne.y,Ae.y),U=Math.max(le.y,Ce.y,Ne.y,Ae.y)}e.emplaceBack(r.x,r.y,j,F,X,U,u,p,y)}this.boxEndIndex=e.length}}class Yg{constructor(e=[],r=Jg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:u}=this,p=r[e];for(;e>0;){const y=e-1>>1,b=r[y];if(u(p,b)>=0)break;r[e]=b,e=y}r[e]=p}_down(e){const{data:r,compare:u}=this,p=this.length>>1,y=r[e];for(;e<p;){let b=1+(e<<1),I=r[b];const C=b+1;if(C<this.length&&u(r[C],I)<0&&(b=C,I=r[C]),u(I,y)>=0)break;r[e]=I,e=b}r[e]=y}}function Jg(i,e){return i<e?-1:i>e?1:0}function Qg(i,e=1,r=!1){let u=1/0,p=1/0,y=-1/0,b=-1/0;const I=i[0];for(let j=0;j<I.length;j++){const X=I[j];(!j||X.x<u)&&(u=X.x),(!j||X.y<p)&&(p=X.y),(!j||X.x>y)&&(y=X.x),(!j||X.y>b)&&(b=X.y)}const C=Math.min(y-u,b-p);let D=C/2;const B=new Yg([],$g);if(C===0)return new Ee(u,p);for(let j=u;j<y;j+=C)for(let X=p;X<b;X+=C)B.push(new Xs(j+D,X+D,D,i));let F=function(j){let X=0,ue=0,le=0;const Ce=j[0];for(let Ne=0,Ae=Ce.length,Be=Ae-1;Ne<Ae;Be=Ne++){const it=Ce[Ne],et=Ce[Be],Dt=it.x*et.y-et.x*it.y;ue+=(it.x+et.x)*Dt,le+=(it.y+et.y)*Dt,X+=3*Dt}return new Xs(ue/X,le/X,0,j)}(i),U=B.length;for(;B.length;){const j=B.pop();(j.d>F.d||!F.d)&&(F=j,r&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,U)),j.max-F.d<=e||(D=j.h/2,B.push(new Xs(j.p.x-D,j.p.y-D,D,i)),B.push(new Xs(j.p.x+D,j.p.y-D,D,i)),B.push(new Xs(j.p.x-D,j.p.y+D,D,i)),B.push(new Xs(j.p.x+D,j.p.y+D,D,i)),U+=4)}return r&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function $g(i,e){return e.max-i.max}function Xs(i,e,r,u){this.p=new Ee(i,e),this.h=r,this.d=function(p,y){let b=!1,I=1/0;for(let C=0;C<y.length;C++){const D=y[C];for(let B=0,F=D.length,U=F-1;B<F;U=B++){const j=D[B],X=D[U];j.y>p.y!=X.y>p.y&&p.x<(X.x-j.x)*(p.y-j.y)/(X.y-j.y)+j.x&&(b=!b),I=Math.min(I,wh(p,j,X))}}return(b?1:-1)*Math.sqrt(I)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Su=Number.POSITIVE_INFINITY;function md(i,e){return e[1]!==Su?function(r,u,p){let y=0,b=0;switch(u=Math.abs(u),p=Math.abs(p),r){case"top-right":case"top-left":case"top":b=p-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-p}switch(r){case"top-right":case"bottom-right":case"right":y=-u;break;case"top-left":case"bottom-left":case"left":y=u}return[y,b]}(i,e[0],e[1]):function(r,u){let p=0,y=0;u<0&&(u=0);const b=u/Math.sqrt(2);switch(r){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-u;break;case"top":y=u-7}switch(r){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=u;break;case"right":p=-u}return[p,y]}(i,e[0])}function Cu(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e_(i,e,r,u,p,y,b,I,C,D,B){let F=y.textMaxSize.evaluate(e,{});F===void 0&&(F=b);const U=i.layers[0].layout,j=U.get("icon-offset").evaluate(e,{},B),X=_d(r.horizontal),ue=b/24,le=i.tilePixelRatio*ue,Ce=i.tilePixelRatio*F/24,Ne=i.tilePixelRatio*I,Ae=i.tilePixelRatio*U.get("symbol-spacing"),Be=U.get("text-padding")*i.tilePixelRatio,it=function(pt,Zt,Nt,di=1){const qi=pt.get("icon-padding").evaluate(Zt,{},Nt),Hi=qi&&qi.values;return[Hi[0]*di,Hi[1]*di,Hi[2]*di,Hi[3]*di]}(U,e,B,i.tilePixelRatio),et=U.get("text-max-angle")/180*Math.PI,Dt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Ft=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Et=U.get("symbol-placement"),wt=Ae/2,_t=U.get("icon-text-fit");let At;u&&_t!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(At=ad(u,r.vertical,_t,U.get("icon-text-fit-padding"),j,ue)),X&&(u=ad(u,X,_t,U.get("icon-text-fit-padding"),j,ue)));const kt=(pt,Zt)=>{Zt.x<0||Zt.x>=un||Zt.y<0||Zt.y>=un||function(Nt,di,qi,Hi,hn,lr,kn,sn,yn,Tn,Cn,Zn,on,En,Mn,On,Xn,Wn,Ki,vn,gi,tr,An,zn,yr){const Mr=Nt.addToLineVertexArray(di,qi);let zr,ha,vr,cr,Hn=0,da=0,Jo=0,Pd=0,Vu=-1,Nu=-1;const fa={};let Ld=_n.exports(""),Uu=0,qu=0;if(sn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Uu,qu]=sn.layout.get("text-offset").evaluate(gi,{},zn).map(Kn=>Kn*wn):(Uu=sn.layout.get("text-radial-offset").evaluate(gi,{},zn)*wn,qu=Su),Nt.allowVerticalPlacement&&Hi.vertical){const Kn=sn.layout.get("text-rotate").evaluate(gi,{},zn)+90;vr=new gc(yn,di,Tn,Cn,Zn,Hi.vertical,on,En,Mn,Kn),kn&&(cr=new gc(yn,di,Tn,Cn,Zn,kn,Xn,Wn,Mn,Kn))}if(hn){const Kn=sn.layout.get("icon-rotate").evaluate(gi,{}),Hr=sn.layout.get("icon-text-fit")!=="none",Qo=fd(hn,Kn,An,Hr),$o=kn?fd(kn,Kn,An,Hr):void 0;ha=new gc(yn,di,Tn,Cn,Zn,hn,Xn,Wn,!1,Kn),Hn=4*Qo.length;const Fd=Nt.iconSizeData;let ps=null;Fd.kind==="source"?(ps=[ua*sn.layout.get("icon-size").evaluate(gi,{})],ps[0]>Fa&&ge(`${Nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Fd.kind==="composite"&&(ps=[ua*tr.compositeIconSizes[0].evaluate(gi,{},zn),ua*tr.compositeIconSizes[1].evaluate(gi,{},zn)],(ps[0]>Fa||ps[1]>Fa)&&ge(`${Nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Nt.addSymbols(Nt.icon,Qo,ps,vn,Ki,gi,s.WritingMode.none,di,Mr.lineStartIndex,Mr.lineLength,-1,zn),Vu=Nt.icon.placedSymbolArray.length-1,$o&&(da=4*$o.length,Nt.addSymbols(Nt.icon,$o,ps,vn,Ki,gi,s.WritingMode.vertical,di,Mr.lineStartIndex,Mr.lineLength,-1,zn),Nu=Nt.icon.placedSymbolArray.length-1)}const Bd=Object.keys(Hi.horizontal);for(const Kn of Bd){const Hr=Hi.horizontal[Kn];if(!zr){Ld=_n.exports(Hr.text);const $o=sn.layout.get("text-rotate").evaluate(gi,{},zn);zr=new gc(yn,di,Tn,Cn,Zn,Hr,on,En,Mn,$o)}const Qo=Hr.positionedLines.length===1;if(Jo+=gd(Nt,di,Hr,lr,sn,Mn,gi,On,Mr,Hi.vertical?s.WritingMode.horizontal:s.WritingMode.horizontalOnly,Qo?Bd:[Kn],fa,Vu,tr,zn),Qo)break}Hi.vertical&&(Pd+=gd(Nt,di,Hi.vertical,lr,sn,Mn,gi,On,Mr,s.WritingMode.vertical,["vertical"],fa,Nu,tr,zn));const f_=zr?zr.boxStartIndex:Nt.collisionBoxArray.length,p_=zr?zr.boxEndIndex:Nt.collisionBoxArray.length,m_=vr?vr.boxStartIndex:Nt.collisionBoxArray.length,g_=vr?vr.boxEndIndex:Nt.collisionBoxArray.length,__=ha?ha.boxStartIndex:Nt.collisionBoxArray.length,y_=ha?ha.boxEndIndex:Nt.collisionBoxArray.length,v_=cr?cr.boxStartIndex:Nt.collisionBoxArray.length,b_=cr?cr.boxEndIndex:Nt.collisionBoxArray.length;let Dr=-1;const xc=(Kn,Hr)=>Kn&&Kn.circleDiameter?Math.max(Kn.circleDiameter,Hr):Hr;Dr=xc(zr,Dr),Dr=xc(vr,Dr),Dr=xc(ha,Dr),Dr=xc(cr,Dr);const Rd=Dr>-1?1:0;Rd&&(Dr*=yr/wn),Nt.glyphOffsetArray.length>=Ws.MAX_GLYPHS&&ge("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gi.sortKey!==void 0&&Nt.addToSortKeyRanges(Nt.symbolInstances.length,gi.sortKey),Nt.symbolInstances.emplaceBack(di.x,di.y,fa.right>=0?fa.right:-1,fa.center>=0?fa.center:-1,fa.left>=0?fa.left:-1,fa.vertical||-1,Vu,Nu,Ld,f_,p_,m_,g_,__,y_,v_,b_,Tn,Jo,Pd,Hn,da,Rd,0,on,Uu,qu,Dr)}(i,Zt,pt,r,u,p,At,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,le,[Be,Be,Be,Be],Dt,C,Ne,it,Ft,j,e,y,D,B,b)};if(Et==="line")for(const pt of dd(e.geometry,0,0,un,un)){const Zt=Kg(pt,Ae,et,r.vertical||X,u,24,Ce,i.overscaling,un);for(const Nt of Zt){const di=X;di&&t_(i,di.text,wt,Nt)||kt(pt,Nt)}}else if(Et==="line-center"){for(const pt of e.geometry)if(pt.length>1){const Zt=Hg(pt,et,r.vertical||X,u,24,Ce);Zt&&kt(pt,Zt)}}else if(e.type==="Polygon")for(const pt of gu(e.geometry,0)){const Zt=Qg(pt,16);kt(pt[0],new Ra(Zt.x,Zt.y,0))}else if(e.type==="LineString")for(const pt of e.geometry)kt(pt,new Ra(pt[0].x,pt[0].y,0));else if(e.type==="Point")for(const pt of e.geometry)for(const Zt of pt)kt([Zt],new Ra(Zt.x,Zt.y,0))}const Fa=32640;function gd(i,e,r,u,p,y,b,I,C,D,B,F,U,j,X){const ue=function(Ne,Ae,Be,it,et,Dt,Ft,Et){const wt=it.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,_t=[];for(const At of Ae.positionedLines)for(const kt of At.positionedGlyphs){if(!kt.rect)continue;const pt=kt.rect||{};let Zt=4,Nt=!0,di=1,qi=0;const Hi=(et||Et)&&kt.vertical,hn=kt.metrics.advance*kt.scale/2;if(Et&&Ae.verticalizable){const Ki=(kt.scale-1)*wn,vn=(wn-kt.metrics.width*kt.scale)/2;qi=At.lineOffset/2-(kt.imageName?-vn:Ki)}if(kt.imageName){const Ki=Ft[kt.imageName];Nt=Ki.sdf,di=Ki.pixelRatio,Zt=1/di}const lr=et?[kt.x+hn,kt.y]:[0,0];let kn=et?[0,0]:[kt.x+hn+Be[0],kt.y+Be[1]-qi],sn=[0,0];Hi&&(sn=kn,kn=[0,0]);const yn=(kt.metrics.left-Zt)*kt.scale-hn+kn[0],Tn=(-kt.metrics.top-Zt)*kt.scale+kn[1],Cn=yn+pt.w*kt.scale/di,Zn=Tn+pt.h*kt.scale/di,on=new Ee(yn,Tn),En=new Ee(Cn,Tn),Mn=new Ee(yn,Zn),On=new Ee(Cn,Zn);if(Hi){const Ki=new Ee(-hn,hn-uc),vn=-Math.PI/2,gi=12-hn,tr=new Ee(22-gi,-(kt.imageName?gi:0)),An=new Ee(...sn);on._rotateAround(vn,Ki)._add(tr)._add(An),En._rotateAround(vn,Ki)._add(tr)._add(An),Mn._rotateAround(vn,Ki)._add(tr)._add(An),On._rotateAround(vn,Ki)._add(tr)._add(An)}if(wt){const Ki=Math.sin(wt),vn=Math.cos(wt),gi=[vn,-Ki,Ki,vn];on._matMult(gi),En._matMult(gi),Mn._matMult(gi),On._matMult(gi)}const Xn=new Ee(0,0),Wn=new Ee(0,0);_t.push({tl:on,tr:En,bl:Mn,br:On,tex:pt,writingMode:Ae.writingMode,glyphOffset:lr,sectionIndex:kt.sectionIndex,isSDF:Nt,pixelOffsetTL:Xn,pixelOffsetBR:Wn,minFontScaleX:0,minFontScaleY:0})}return _t}(0,r,I,p,y,b,u,i.allowVerticalPlacement),le=i.textSizeData;let Ce=null;le.kind==="source"?(Ce=[ua*p.layout.get("text-size").evaluate(b,{})],Ce[0]>Fa&&ge(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):le.kind==="composite"&&(Ce=[ua*j.compositeTextSizes[0].evaluate(b,{},X),ua*j.compositeTextSizes[1].evaluate(b,{},X)],(Ce[0]>Fa||Ce[1]>Fa)&&ge(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ue,Ce,I,y,b,D,e,C.lineStartIndex,C.lineLength,U,X);for(const Ne of B)F[Ne]=i.text.placedSymbolArray.length-1;return 4*ue.length}function _d(i){for(const e in i)return i[e];return null}function t_(i,e,r,u){const p=i.compareText;if(e in p){const y=p[e];for(let b=y.length-1;b>=0;b--)if(u.dist(y[b])<r)return!0}else p[e]=[];return p[e].push(u),!1}const i_=La.VectorTileFeature.types,n_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _c(i,e,r,u,p,y,b,I,C,D,B,F,U){const j=I?Math.min(Fa,Math.round(I[0])):0,X=I?Math.min(Fa,Math.round(I[1])):0;i.emplaceBack(e,r,Math.round(32*u),Math.round(32*p),y,b,(j<<1)+(C?1:0),X,16*D,16*B,256*F,256*U)}function Mu(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function r_(i){for(const e of i.sections)if(Xl(e.text))return!0;return!1}class zu{constructor(e){this.layoutVertexArray=new gr,this.indexArray=new Bn,this.programConfigurations=e,this.segments=new pi,this.dynamicLayoutVertexArray=new ar,this.opacityVertexArray=new _r,this.placedSymbolArray=new dt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ag.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Sg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,n_,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Bt("SymbolBuffers",zu);class Du{constructor(e,r,u){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new u,this.segments=new pi,this.collisionVertexArray=new $n}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Cg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Bt("CollisionBuffers",Du);class Ws{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(b=>b.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=uu([]),this.placementViewportMatrix=uu([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sd(this.zoom,r["text-size"]),this.iconSizeData=sd(this.zoom,r["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=Lu(u,"text-overlap","text-allow-overlap")!=="never"||Lu(u,"icon-overlap","icon-allow-overlap")!=="never"||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(b=>s.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=e.sourceID}createArrays(){this.text=new zu(new cs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new zu(new cs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new xt,this.lineVertexArray=new zt,this.symbolInstances=new Ct}calculateGlyphDependencies(e,r,u,p,y){for(let b=0;b<e.length;b++)if(r[e.charCodeAt(b)]=!0,(u||p)&&y){const I=Wo[e.charAt(b)];I&&(r[I.charCodeAt(0)]=!0)}}populate(e,r,u){const p=this.layers[0],y=p.layout,b=y.get("text-font"),I=y.get("text-field"),C=y.get("icon-image"),D=(I.value.kind!=="constant"||I.value.value instanceof ye&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,F=y.get("symbol-sort-key");if(this.features=[],!D&&!B)return;const U=r.iconDependencies,j=r.glyphDependencies,X=r.availableImages,ue=new Xi(this.zoom);for(const{feature:le,id:Ce,index:Ne,sourceLayerIndex:Ae}of e){const Be=p._featureFilter.needGeometry,it=hs(le,Be);if(!p._featureFilter.filter(ue,it,u))continue;let et,Dt;if(Be||(it.geometry=us(le)),D){const Et=p.getValueAndResolveTokens("text-field",it,u,X),wt=ye.factory(Et);r_(wt)&&(this.hasRTLText=!0),(!this.hasRTLText||ss()==="unavailable"||this.hasRTLText&&Qn.isParsed())&&(et=zg(wt,p,it))}if(B){const Et=p.getValueAndResolveTokens("icon-image",it,u,X);Dt=Et instanceof Ie?Et:Ie.fromString(Et)}if(!et&&!Dt)continue;const Ft=this.sortFeaturesByKey?F.evaluate(it,{},u):void 0;if(this.features.push({id:Ce,text:et,icon:Dt,index:Ne,sourceLayerIndex:Ae,geometry:it.geometry,properties:le.properties,type:i_[le.type],sortKey:Ft}),Dt&&(U[Dt.name]=!0),et){const Et=b.evaluate(it,{},u).join(","),wt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.WritingMode.vertical)>=0;for(const _t of et.sections)if(_t.image)U[_t.image.name]=!0;else{const At=Bs(et.toString()),kt=_t.fontStack||Et,pt=j[kt]=j[kt]||{};this.calculateGlyphDependencies(_t.text,pt,wt,this.allowVerticalPlacement,At)}}}y.get("symbol-placement")==="line"&&(this.features=function(le){const Ce={},Ne={},Ae=[];let Be=0;function it(Et){Ae.push(le[Et]),Be++}function et(Et,wt,_t){const At=Ne[Et];return delete Ne[Et],Ne[wt]=At,Ae[At].geometry[0].pop(),Ae[At].geometry[0]=Ae[At].geometry[0].concat(_t[0]),At}function Dt(Et,wt,_t){const At=Ce[wt];return delete Ce[wt],Ce[Et]=At,Ae[At].geometry[0].shift(),Ae[At].geometry[0]=_t[0].concat(Ae[At].geometry[0]),At}function Ft(Et,wt,_t){const At=_t?wt[0][wt[0].length-1]:wt[0][0];return`${Et}:${At.x}:${At.y}`}for(let Et=0;Et<le.length;Et++){const wt=le[Et],_t=wt.geometry,At=wt.text?wt.text.toString():null;if(!At){it(Et);continue}const kt=Ft(At,_t),pt=Ft(At,_t,!0);if(kt in Ne&&pt in Ce&&Ne[kt]!==Ce[pt]){const Zt=Dt(kt,pt,_t),Nt=et(kt,pt,Ae[Zt].geometry);delete Ce[kt],delete Ne[pt],Ne[Ft(At,Ae[Nt].geometry,!0)]=Nt,Ae[Zt].geometry=null}else kt in Ne?et(kt,pt,_t):pt in Ce?Dt(kt,pt,_t):(it(Et),Ce[kt]=Be-1,Ne[pt]=Be-1)}return Ae.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,Ce)=>le.sortKey-Ce.sortKey)}update(e,r,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,u),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const u=this.lineVertexArray.length;if(e.segment!==void 0){let p=e.dist(r[e.segment+1]),y=e.dist(r[e.segment]);const b={};for(let I=e.segment+1;I<r.length;I++)b[I]={x:r[I].x,y:r[I].y,tileUnitDistanceFromAnchor:p},I<r.length-1&&(p+=r[I+1].dist(r[I]));for(let I=e.segment||0;I>=0;I--)b[I]={x:r[I].x,y:r[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=r[I-1].dist(r[I]));for(let I=0;I<r.length;I++){const C=b[I];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,r,u,p,y,b,I,C,D,B,F,U){const j=e.indexArray,X=e.layoutVertexArray,ue=e.segments.prepareSegment(4*r.length,X,j,this.canOverlap?b.sortKey:void 0),le=this.glyphOffsetArray.length,Ce=ue.vertexLength,Ne=this.allowVerticalPlacement&&I===s.WritingMode.vertical?Math.PI/2:0,Ae=b.text&&b.text.sections;for(let Be=0;Be<r.length;Be++){const{tl:it,tr:et,bl:Dt,br:Ft,tex:Et,pixelOffsetTL:wt,pixelOffsetBR:_t,minFontScaleX:At,minFontScaleY:kt,glyphOffset:pt,isSDF:Zt,sectionIndex:Nt}=r[Be],di=ue.vertexLength,qi=pt[1];_c(X,C.x,C.y,it.x,qi+it.y,Et.x,Et.y,u,Zt,wt.x,wt.y,At,kt),_c(X,C.x,C.y,et.x,qi+et.y,Et.x+Et.w,Et.y,u,Zt,_t.x,wt.y,At,kt),_c(X,C.x,C.y,Dt.x,qi+Dt.y,Et.x,Et.y+Et.h,u,Zt,wt.x,_t.y,At,kt),_c(X,C.x,C.y,Ft.x,qi+Ft.y,Et.x+Et.w,Et.y+Et.h,u,Zt,_t.x,_t.y,At,kt),Mu(e.dynamicLayoutVertexArray,C,Ne),j.emplaceBack(di,di+1,di+2),j.emplaceBack(di+1,di+2,di+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Be!==r.length-1&&Nt===r[Be+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,b,b.index,{},U,Ae&&Ae[Nt])}e.placedSymbolArray.emplaceBack(C.x,C.y,le,this.glyphOffsetArray.length-le,Ce,D,B,C.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],I,0,!1,0,F)}_addCollisionDebugVertex(e,r,u,p,y,b){return r.emplaceBack(0,0),e.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(e,r,u,p,y,b,I){const C=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=C.vertexLength,B=y.layoutVertexArray,F=y.collisionVertexArray,U=I.anchorX,j=I.anchorY;this._addCollisionDebugVertex(B,F,b,U,j,new Ee(e,r)),this._addCollisionDebugVertex(B,F,b,U,j,new Ee(u,r)),this._addCollisionDebugVertex(B,F,b,U,j,new Ee(u,p)),this._addCollisionDebugVertex(B,F,b,U,j,new Ee(e,p)),C.vertexLength+=4;const X=y.indexArray;X.emplaceBack(D,D+1),X.emplaceBack(D+1,D+2),X.emplaceBack(D+2,D+3),X.emplaceBack(D+3,D),C.primitiveLength+=4}addDebugCollisionBoxes(e,r,u,p){for(let y=e;y<r;y++){const b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Du(Xr,Xh.members,Sr),this.iconCollisionBox=new Du(Xr,Xh.members,Sr);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,u,p,y,b,I,C,D){const B={};for(let F=r;F<u;F++){const U=e.get(F);B.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.textFeatureIndex=U.featureIndex;break}for(let F=p;F<y;F++){const U=e.get(F);B.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.verticalTextFeatureIndex=U.featureIndex;break}for(let F=b;F<I;F++){const U=e.get(F);B.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.iconFeatureIndex=U.featureIndex;break}for(let F=C;F<D;F++){const U=e.get(F);B.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.verticalIconFeatureIndex=U.featureIndex;break}return B}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const u=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const u=e.placedSymbolArray.get(r),p=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<p;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),u=Math.cos(e),p=[],y=[],b=[];for(let I=0;I<this.symbolInstances.length;++I){b.push(I);const C=this.symbolInstances.get(I);p.push(0|Math.round(r*C.anchorX+u*C.anchorY)),y.push(C.featureIndex)}return b.sort((I,C)=>p[I]-p[C]||y[C]-y[I]),b}addToSortKeyRanges(e,r){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===r?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const u=this.symbolInstances.get(r);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((p,y,b)=>{p>=0&&b.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt("SymbolBucket",Ws,{omit:["layers","collisionBoxArray","features","compareText"]}),Ws.MAX_GLYPHS=65535,Ws.addDynamicAttributes=Mu;const a_=new xn({"symbol-placement":new Vt(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(Ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Vt(Ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Vt(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht(Ke.layout_symbol["icon-size"]),"icon-text-fit":new Vt(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht(Ke.layout_symbol["icon-image"]),"icon-rotate":new Ht(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Ht(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Ht(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Ht(Ke.layout_symbol["text-field"]),"text-font":new Ht(Ke.layout_symbol["text-font"]),"text-size":new Ht(Ke.layout_symbol["text-size"]),"text-max-width":new Ht(Ke.layout_symbol["text-max-width"]),"text-line-height":new Vt(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Ht(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Ht(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Ht(Ke.layout_symbol["text-anchor"]),"text-max-angle":new Vt(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Ht(Ke.layout_symbol["text-rotate"]),"text-padding":new Vt(Ke.layout_symbol["text-padding"]),"text-keep-upright":new Vt(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Ht(Ke.layout_symbol["text-transform"]),"text-offset":new Ht(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(Ke.layout_symbol["text-allow-overlap"]),"text-overlap":new Vt(Ke.layout_symbol["text-overlap"]),"text-ignore-placement":new Vt(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(Ke.layout_symbol["text-optional"])});var Pu={paint:new xn({"icon-opacity":new Ht(Ke.paint_symbol["icon-opacity"]),"icon-color":new Ht(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Ht(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ht(Ke.paint_symbol["text-opacity"]),"text-color":new Ht(Ke.paint_symbol["text-color"],{runtimeType:bn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ht(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Ht(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht(Ke.paint_symbol["text-halo-blur"]),"text-translate":new Vt(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(Ke.paint_symbol["text-translate-anchor"])}),layout:a_};class yd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Or,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt("FormatSectionOverride",yd,{omit:["defaultValue"]});class yc extends mr{constructor(e){super(e,Pu)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const y of u)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,u,p){const y=this.layout.get(e).evaluate(r,{},u,p),b=this._unevaluatedLayout._values[e];return b.isDataDriven()||Wa(b.value)||!y?y:function(I,C){return C.replace(/{([^{}]+)}/g,(D,B)=>B in I?String(I[B]):"")}(r.properties,y)}createBucket(e){return new Ws(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Pu.paint.overridableProperties){if(!yc.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),u=new yd(r),p=new Cs(u,r.property.specification);let y=null;y=r.value.kind==="constant"||r.value.kind==="source"?new Ka("source",p):new xo("composite",p,r.value.zoomStops),this.paint._values[e]=new pr(r.property,y,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,u){return!(!this.layout||r.isDataDriven()||u.isDataDriven())&&yc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const u=e.get("text-field"),p=Pu.paint.properties[r];let y=!1;const b=I=>{for(const C of I)if(p.overrides&&p.overrides.hasOverride(C))return void(y=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ye)b(u.value.value.sections);else if(u.value.kind==="source"){const I=D=>{y||(D instanceof Ot&&Ue(D.value)===fn?b(D.value.sections):D instanceof As?b(D.sections):D.eachChild(I))},C=u.value;C._styleExpression&&I(C._styleExpression.expression)}return y}}function Lu(i,e,r){let u="never";const p=i.get(e);return p?u=p:i.get(r)&&(u="always"),u}var s_={paint:new xn({"background-color":new Vt(Ke.paint_background["background-color"]),"background-pattern":new Po(Ke.paint_background["background-pattern"]),"background-opacity":new Vt(Ke.paint_background["background-opacity"])})},o_={paint:new xn({"raster-opacity":new Vt(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(Ke.paint_raster["raster-saturation"]),"raster-contrast":new Vt(Ke.paint_raster["raster-contrast"]),"raster-resampling":new Vt(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(Ke.paint_raster["raster-fade-duration"])})};class l_ extends mr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const c_={circle:class extends mr{constructor(i){super(i,Nm)}createBucket(i){return new ou(i)}queryRadius(i){const e=i;return Oo("circle-radius",this,e)+Oo("circle-stroke-width",this,e)+tc(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,u,p,y,b,I){const C=ic(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),D=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),B=this.paint.get("circle-pitch-alignment")==="map",F=B?C:function(j,X){return j.map(ue=>Ch(ue,X))}(C,I),U=B?D*b:D;for(const j of u)for(const X of j){const ue=B?X:Ch(X,I);let le=U;const Ce=nc([],[X.x,X.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=Ce[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=y.cameraToCenterDistance/Ce[3]),Bm(F,ue,le))return!0}return!1}},heatmap:class extends mr{constructor(i){super(i,qm),this._updateColorRamp()}createBucket(i){return new Mh(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends mr{constructor(i){super(i,Gm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends mr{constructor(i){super(i,ag)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new vu(i)}queryRadius(){return tc(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,u,p,y,b){return xh(ic(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),u)}isTileClipped(){return!0}},"fill-extrusion":class extends mr{constructor(i){super(i,vg)}createBucket(i){return new xu(i)}queryRadius(){return tc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,e,r,u,p,y,b,I){const C=ic(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),D=this.paint.get("fill-extrusion-height").evaluate(e,r),B=this.paint.get("fill-extrusion-base").evaluate(e,r),F=function(j,X,ue,le){const Ce=[];for(const Ne of j){const Ae=[Ne.x,Ne.y,0,1];nc(Ae,Ae,X),Ce.push(new Ee(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return Ce}(C,I),U=function(j,X,ue,le){const Ce=[],Ne=[],Ae=le[8]*X,Be=le[9]*X,it=le[10]*X,et=le[11]*X,Dt=le[8]*ue,Ft=le[9]*ue,Et=le[10]*ue,wt=le[11]*ue;for(const _t of j){const At=[],kt=[];for(const pt of _t){const Zt=pt.x,Nt=pt.y,di=le[0]*Zt+le[4]*Nt+le[12],qi=le[1]*Zt+le[5]*Nt+le[13],Hi=le[2]*Zt+le[6]*Nt+le[14],hn=le[3]*Zt+le[7]*Nt+le[15],lr=Hi+it,kn=hn+et,sn=di+Dt,yn=qi+Ft,Tn=Hi+Et,Cn=hn+wt,Zn=new Ee((di+Ae)/kn,(qi+Be)/kn);Zn.z=lr/kn,At.push(Zn);const on=new Ee(sn/Cn,yn/Cn);on.z=Tn/Cn,kt.push(on)}Ce.push(At),Ne.push(kt)}return[Ce,Ne]}(u,B,D,I);return function(j,X,ue){let le=1/0;xh(ue,X)&&(le=Uh(ue,X[0]));for(let Ce=0;Ce<X.length;Ce++){const Ne=X[Ce],Ae=j[Ce];for(let Be=0;Be<Ne.length-1;Be++){const it=Ne[Be],et=[it,Ne[Be+1],Ae[Be+1],Ae[Be],it];bh(ue,et)&&(le=Math.min(le,Uh(ue,et)))}}return le!==1/0&&le}(U[0],U[1],F)}},line:class extends mr{constructor(i){super(i,Gh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof qa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=jh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new wu(i)}queryRadius(i){const e=i,r=Zh(Oo("line-width",this,e),Oo("line-gap-width",this,e)),u=Oo("line-offset",this,e);return r/2+Math.abs(u)+tc(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,u,p,y,b){const I=ic(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),C=b/2*Zh(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),D=this.paint.get("line-offset").evaluate(e,r);return D&&(u=function(B,F){const U=[];for(let j=0;j<B.length;j++){const X=B[j],ue=[];for(let le=0;le<X.length;le++){const Ce=X[le-1],Ne=X[le],Ae=X[le+1],Be=le===0?new Ee(0,0):Ne.sub(Ce)._unit()._perp(),it=le===X.length-1?new Ee(0,0):Ae.sub(Ne)._unit()._perp(),et=Be._add(it)._unit(),Dt=et.x*it.x+et.y*it.y;Dt!==0&&et._mult(1/Dt),ue.push(et._mult(F)._add(Ne))}U.push(ue)}return U}(u,D*b)),function(B,F,U){for(let j=0;j<F.length;j++){const X=F[j];if(B.length>=3){for(let ue=0;ue<X.length;ue++)if(Ns(B,X[ue]))return!0}if(Rm(B,X,U))return!0}return!1}(I,u,C)}isTileClipped(){return!0}},symbol:yc,background:class extends mr{constructor(i){super(i,s_)}},raster:class extends mr{constructor(i){super(i,o_)}}};class u_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const vd=63710088e-1;class en{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new en(V(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,u=this.lat*r,p=e.lat*r,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((e.lng-this.lng)*r);return vd*Math.acos(Math.min(y,1))}toBounds(e=0){const r=360*e/40075017,u=r/Math.cos(Math.PI/180*this.lat);return new fs(new en(this.lng-u,this.lat-r),new en(this.lng+u,this.lat+r))}static convert(e){if(e instanceof en)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new en(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new en(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class fs{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof en?new en(e.lng,e.lat):en.convert(e),this}setSouthWest(e){return this._sw=e instanceof en?new en(e.lng,e.lat):en.convert(e),this}extend(e){const r=this._sw,u=this._ne;let p,y;if(e instanceof en)p=e,y=e;else{if(!(e instanceof fs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fs.convert(e)):this.extend(en.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return r||u?(r.lng=Math.min(p.lng,r.lng),r.lat=Math.min(p.lat,r.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new en(p.lng,p.lat),this._ne=new en(y.lng,y.lat)),this}getCenter(){return new en((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new en(this.getWest(),this.getNorth())}getSouthEast(){return new en(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:u}=en.convert(e);let p=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(e){return e instanceof fs?e:e&&new fs(e)}}const bd=2*Math.PI*vd;function xd(i){return bd*Math.cos(i*Math.PI/180)}function wd(i){return(180+i)/360}function Id(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function kd(i,e){return i/xd(e)}function Bu(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class vc{constructor(e,r,u=0){this.x=+e,this.y=+r,this.z=+u}static fromLngLat(e,r=0){const u=en.convert(e);return new vc(wd(u.lng),Id(u.lat),kd(r,u.lat))}toLngLat(){return new en(360*this.x-180,Bu(this.y))}toAltitude(){return this.z*xd(Bu(this.y))}meterInMercatorCoordinateUnits(){return 1/bd*(e=Bu(this.y),1/Math.cos(e*Math.PI/180));var e}}function Td(i,e,r){var u=2*Math.PI*6378137/256/Math.pow(2,r);return[i*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class Ru{constructor(e,r,u){if(e<0||e>25||u<0||u>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${u}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=u,this.key=Ko(0,e,e,r,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,u){const p=(b=this.y,I=this.z,C=Td(256*(y=this.x),256*(b=Math.pow(2,I)-b-1),I),D=Td(256*(y+1),256*(b+1),I),C[0]+","+C[1]+","+D[0]+","+D[1]);var y,b,I,C,D;const B=function(F,U,j){let X,ue="";for(let le=F;le>0;le--)X=1<<le-1,ue+=(U&X?1:0)+(j&X?2:0);return ue}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,B).replace(/{bbox-epsg-3857}/g,p)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new Ee((e.x*r-this.x)*un,(e.y*r-this.y)*un)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ed{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ko(e,r.z,r.z,r.x,r.y)}}class or{constructor(e,r,u,p,y){if(e<u)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${u}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Ru(u,+p,+y),this.key=Ko(r,e,u,p,y)}clone(){return new or(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new or(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new or(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-e;return e>this.canonical.z?Ko(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ko(this.wrap*+r,e,e,this.canonical.x>>u,this.canonical.y>>u)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new or(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new or(r,this.wrap,r,u,p),new or(r,this.wrap,r,u+1,p),new or(r,this.wrap,r,u,p+1),new or(r,this.wrap,r,u+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new or(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new or(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ed(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new vc(e.x-this.wrap,e.y))}}function Ko(i,e,r,u,p){(i*=2)<0&&(i=-1*i-1);const y=1<<r;return(y*y*i+y*p+u).toString(36)+r.toString(36)+e.toString(36)}Bt("CanonicalTileID",Ru),Bt("OverscaledTileID",or,{omit:["posMatrix"]});class Ad{constructor(e,r,u){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void ge(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=u||"mapbox";for(let y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<p;y++)for(let b=0;b<p;b++){const I=this.get(y,b);I>this.max&&(this.max=I),I<this.min&&(this.min=I)}}get(e,r){const u=new Uint8Array(this.data.buffer),p=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,u){return(256*e*256+256*r+u)/10-1e4}_unpackTerrarium(e,r,u){return 256*e+r+u/256-32768}getPixels(){return new sr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=r*this.dim,y=r*this.dim+this.dim,b=u*this.dim,I=u*this.dim+this.dim;switch(r){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=I-1;break;case 1:I=b+1}const C=-r*this.dim,D=-u*this.dim;for(let B=b;B<I;B++)for(let F=p;F<y;F++)this.data[this._idx(F,B)]=e.data[this._idx(F+C,B+D)]}}Bt("DEMData",Ad);class Sd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const u=e[r];this._stringToNumber[u]=r,this._numberToString[r]=u}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Cd{constructor(e,r,u,p,y){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=u,e._y=p,this.properties=e.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Md{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new as(un,16,0),this.grid3D=new as(un,16,0),this.featureIndexArray=new hi,this.promoteId=r}insert(e,r,u,p,y,b){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);const C=b?this.grid3D:this.grid;for(let D=0;D<r.length;D++){const B=r[D],F=[1/0,1/0,-1/0,-1/0];for(let U=0;U<B.length;U++){const j=B[U];F[0]=Math.min(F[0],j.x),F[1]=Math.min(F[1],j.y),F[2]=Math.max(F[2],j.x),F[3]=Math.max(F[3],j.y)}F[0]<un&&F[1]<un&&F[2]>=0&&F[3]>=0&&C.insert(I,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new La.VectorTile(new Iu(this.rawTileData)).layers,this.sourceLayerCoder=new Sd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,u,p){this.loadVTLayers();const y=e.params||{},b=un/e.tileSize/e.scale,I=Ds(y.filter),C=e.queryGeometry,D=e.queryPadding*b,B=Dd(C),F=this.grid.query(B.minX-D,B.minY-D,B.maxX+D,B.maxY+D),U=Dd(e.cameraQueryGeometry),j=this.grid3D.query(U.minX-D,U.minY-D,U.maxX+D,U.maxY+D,(le,Ce,Ne,Ae)=>function(Be,it,et,Dt,Ft){for(const wt of Be)if(it<=wt.x&&et<=wt.y&&Dt>=wt.x&&Ft>=wt.y)return!0;const Et=[new Ee(it,et),new Ee(it,Ft),new Ee(Dt,Ft),new Ee(Dt,et)];if(Be.length>2){for(const wt of Et)if(Ns(Be,wt))return!0}for(let wt=0;wt<Be.length-1;wt++)if(Om(Be[wt],Be[wt+1],Et))return!0;return!1}(e.cameraQueryGeometry,le-D,Ce-D,Ne+D,Ae+D));for(const le of j)F.push(le);F.sort(h_);const X={};let ue;for(let le=0;le<F.length;le++){const Ce=F[le];if(Ce===ue)continue;ue=Ce;const Ne=this.featureIndexArray.get(Ce);let Ae=null;this.loadMatchingFeature(X,Ne.bucketIndex,Ne.sourceLayerIndex,Ne.featureIndex,I,y.layers,y.availableImages,r,u,p,(Be,it,et)=>(Ae||(Ae=us(Be)),it.queryIntersectsFeature(C,Be,et,Ae,this.z,e.transform,b,e.pixelPosMatrix)))}return X}loadMatchingFeature(e,r,u,p,y,b,I,C,D,B,F){const U=this.bucketLayerIDs[r];if(b&&!function(le,Ce){for(let Ne=0;Ne<le.length;Ne++)if(Ce.indexOf(le[Ne])>=0)return!0;return!1}(b,U))return;const j=this.sourceLayerCoder.decode(u),X=this.vtLayers[j].feature(p);if(y.needGeometry){const le=hs(X,!0);if(!y.filter(new Xi(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!y.filter(new Xi(this.tileID.overscaledZ),X))return;const ue=this.getId(X,j);for(let le=0;le<U.length;le++){const Ce=U[le];if(b&&b.indexOf(Ce)<0)continue;const Ne=C[Ce];if(!Ne)continue;let Ae={};ue&&B&&(Ae=B.getState(Ne.sourceLayer||"_geojsonTileLayer",ue));const Be=W({},D[Ce]);Be.paint=zd(Be.paint,Ne.paint,X,Ae,I),Be.layout=zd(Be.layout,Ne.layout,X,Ae,I);const it=!F||F(X,Ne,Ae);if(!it)continue;const et=new Cd(X,this.z,this.x,this.y,ue);et.layer=Be;let Dt=e[Ce];Dt===void 0&&(Dt=e[Ce]=[]),Dt.push({featureIndex:p,feature:et,intersectionZ:it})}}lookupSymbolFeatures(e,r,u,p,y,b,I,C){const D={};this.loadVTLayers();const B=Ds(y);for(const F of e)this.loadMatchingFeature(D,u,p,F,B,b,I,C,r);return D}hasLayer(e){for(const r of this.bucketLayerIDs)for(const u of r)if(e===u)return!0;return!1}getId(e,r){let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof u=="boolean"&&(u=Number(u))),u}}function zd(i,e,r,u,p){return H(i,(y,b)=>{const I=e instanceof ls?e.get(b):null;return I&&I.evaluate?I.evaluate(r,u,p):I})}function Dd(i){let e=1/0,r=1/0,u=-1/0,p=-1/0;for(const y of i)e=Math.min(e,y.x),r=Math.min(r,y.y),u=Math.max(u,y.x),p=Math.max(p,y.y);return{minX:e,minY:r,maxX:u,maxY:p}}function h_(i,e){return e-i}var Fu;Bt("FeatureIndex",Md,{omit:["rawTileData","sourceLayerCoder"]}),s.PerformanceMarkers=void 0,(Fu=s.PerformanceMarkers||(s.PerformanceMarkers={})).create="create",Fu.load="load",Fu.fullLoad="fullLoad";let bc=null,Yo=[];const Ou=1e3/30,d_={mark(i){performance.mark(i)},frame(i){const e=i;bc!=null&&Yo.push(e-bc),bc=e},clearMetrics(){bc=null,Yo=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in s.PerformanceMarkers)performance.clearMarks(s.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",s.PerformanceMarkers.create,s.PerformanceMarkers.load),performance.measure("fullLoadTime",s.PerformanceMarkers.create,s.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,r=Yo.length,u=1/(Yo.reduce((y,b)=>y+b,0)/r/1e3),p=Yo.filter(y=>y>Ou).reduce((y,b)=>y+(b-Ou)/Ou,0);return{loadTime:i,fullLoadTime:e,fps:u,percentDroppedFrames:p/(r+p)*100}}};s.AJAXError=tt,s.ARRAY_TYPE=Fn,s.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Y(["receive","process"],this),this.invoker=new u_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ce()?i:window}send(i,e,r,u,p=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[y]=r);const b=Me(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!r,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:na(e,b)},b),{cancel:()=>{r&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[r];const u=this.cancelCallbacks[r];delete this.cancelCallbacks[r],u&&u()}else ce()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(Ur(e.error)):r(null,Ur(e.data)))}else{let r=!1;const u=Me(this.globalScope)?void 0:[],p=e.hasCallback?(I,C)=>{r=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:I?na(I):null,data:na(C,u)},u)}:I=>{r=!0};let y=null;const b=Ur(e.data);if(this.parent[e.type])y=this.parent[e.type](e.sourceMapId,b,p);else if(this.parent.getWorkerSource){const I=e.type.split(".");y=this.parent.getWorkerSource(e.sourceMapId,I[0],b.source)[I[1]](b,p)}else p(new Error(`Could not find function ${e.type}`));!r&&y&&y.cancel&&(this.cancelCallbacks[i]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.AlphaImage=No,s.CanonicalTileID=Ru,s.CollisionBoxArray=We,s.CollisionCircleLayoutArray=class extends R{},s.Color=J,s.DEMData=Ad,s.DataConstantProperty=Vt,s.DictionaryCoder=Sd,s.EXTENT=un,s.ErrorEvent=ga,s.EvaluationParameters=Xi,s.Event=Ir,s.Evented=kr,s.FeatureIndex=Md,s.FillBucket=vu,s.FillExtrusionBucket=xu,s.GeoJSONFeature=Cd,s.ImageAtlas=ed,s.ImagePosition=Tu,s.LineBucket=wu,s.LineStripIndexArray=class extends oe{},s.LngLat=en,s.LngLatBounds=fs,s.MercatorCoordinate=vc,s.ONE_EM=wn,s.OverscaledTileID=or,s.PerformanceUtils=d_,s.PosArray=jt,s.Properties=xn,s.QuadTriangleArray=class extends G{},s.RGBAImage=sr,s.RasterBoundsArray=class extends f{},s.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.ResourceType=fi,s.SegmentVector=pi,s.SymbolBucket=Ws,s.Transitionable=Kl,s.TriangleIndexArray=Bn,s.Uniform1f=oa,s.Uniform1i=class extends sa{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends sa{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.Uniform3f=class extends sa{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.Uniform4f=Os,s.UniformColor=gh,s.UniformMatrix4f=class extends sa{constructor(i,e){super(i,e),this.current=Pm}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.UnwrappedTileID=Ed,s.ValidationError=It,s.ZoomHistory=To,s.add=function(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i},s.addDynamicAttributes=Mu,s.asyncAll=function(i,e,r){if(!i.length)return r(null,[]);let u=i.length;const p=new Array(i.length);let y=null;i.forEach((b,I)=>{e(b,(C,D)=>{C&&(y=C),p[I]=D,--u==0&&r(y,p)})})},s.bezier=k,s.bindAll=Y,s.cacheEntryPossiblyAdded=function(i){mt++,mt>Je&&(i.getActor().send("enforceCacheSizeLimit",Qe),mt=0)},s.clamp=S,s.clearTileCache=function(i){const e=caches.delete(Fe);i&&e.catch(i).then(()=>i())},s.clipLine=dd,s.clone=function(i){var e=new Fn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=ae,s.clone$2=function(i){var e=new Fn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},s.collisionCircleLayout=Mg,s.config=nt,s.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.create=function(){var i=new Fn(16);return Fn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=kh,s.createExpression=Ha,s.createFilter=Ds,s.createLayout=an,s.createStyleLayer=function(i){return i.type==="custom"?new l_(i):new c_[i.type](i)},s.cross=function(i,e,r){var u=e[0],p=e[1],y=e[2],b=r[0],I=r[1],C=r[2];return i[0]=p*C-y*I,i[1]=y*b-u*C,i[2]=u*I-p*b,i},s.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},s.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.ease=A,s.emitValidationErrors=Ls,s.enforceCacheSizeLimit=function(i){yt(),Se&&Se.then(e=>{e.keys().then(r=>{for(let u=0;u<r.length-i;u++)e.delete(r[u])})})},s.equals=function(i,e){var r=i[0],u=i[1],p=i[2],y=i[3],b=i[4],I=i[5],C=i[6],D=i[7],B=i[8],F=i[9],U=i[10],j=i[11],X=i[12],ue=i[13],le=i[14],Ce=i[15],Ne=e[0],Ae=e[1],Be=e[2],it=e[3],et=e[4],Dt=e[5],Ft=e[6],Et=e[7],wt=e[8],_t=e[9],At=e[10],kt=e[11],pt=e[12],Zt=e[13],Nt=e[14],di=e[15];return Math.abs(r-Ne)<=Rn*Math.max(1,Math.abs(r),Math.abs(Ne))&&Math.abs(u-Ae)<=Rn*Math.max(1,Math.abs(u),Math.abs(Ae))&&Math.abs(p-Be)<=Rn*Math.max(1,Math.abs(p),Math.abs(Be))&&Math.abs(y-it)<=Rn*Math.max(1,Math.abs(y),Math.abs(it))&&Math.abs(b-et)<=Rn*Math.max(1,Math.abs(b),Math.abs(et))&&Math.abs(I-Dt)<=Rn*Math.max(1,Math.abs(I),Math.abs(Dt))&&Math.abs(C-Ft)<=Rn*Math.max(1,Math.abs(C),Math.abs(Ft))&&Math.abs(D-Et)<=Rn*Math.max(1,Math.abs(D),Math.abs(Et))&&Math.abs(B-wt)<=Rn*Math.max(1,Math.abs(B),Math.abs(wt))&&Math.abs(F-_t)<=Rn*Math.max(1,Math.abs(F),Math.abs(_t))&&Math.abs(U-At)<=Rn*Math.max(1,Math.abs(U),Math.abs(At))&&Math.abs(j-kt)<=Rn*Math.max(1,Math.abs(j),Math.abs(kt))&&Math.abs(X-pt)<=Rn*Math.max(1,Math.abs(X),Math.abs(pt))&&Math.abs(ue-Zt)<=Rn*Math.max(1,Math.abs(ue),Math.abs(Zt))&&Math.abs(le-Nt)<=Rn*Math.max(1,Math.abs(le),Math.abs(Nt))&&Math.abs(Ce-di)<=Rn*Math.max(1,Math.abs(Ce),Math.abs(di))},s.evaluateSizeForFeature=function(i,{uSize:e,uSizeT:r},{lowerSize:u,upperSize:p}){return i.kind==="source"?u/ua:i.kind==="composite"?ji(u/ua,p/ua,r):e},s.evaluateSizeForZoom=function(i,e){let r=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:b}=i,I=p?S(qn.interpolationFactor(p,e,y,b),0,1):0;i.kind==="camera"?u=ji(i.minSize,i.maxSize,I):r=I}return{uSizeT:r,uSize:u}},s.evaluateVariableOffset=md,s.evented=Do,s.exported=he,s.exported$1=Xe,s.extend=W,s.filterObject=Q,s.fromRotation=function(i,e){var r=Math.sin(e),u=Math.cos(e);return i[0]=u,i[1]=r,i[2]=0,i[3]=-r,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.getAnchorAlignment=Au,s.getAnchorJustification=Cu,s.getArrayBuffer=ei,s.getImage=Vn,s.getJSON=function(i,e){return ln(W(i,{type:"json"}),e)},s.getOverlapMode=Lu,s.getRTLTextPluginStatus=ss,s.getReferrer=lt,s.getVideo=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let u=0;u<i.length;u++){const p=window.document.createElement("source");dn(i[u])||(r.crossOrigin="Anonymous"),p.src=i[u],r.appendChild(p)}return{cancel:()=>{}}},s.identity=uu,s.invert=function(i,e){var r=e[0],u=e[1],p=e[2],y=e[3],b=e[4],I=e[5],C=e[6],D=e[7],B=e[8],F=e[9],U=e[10],j=e[11],X=e[12],ue=e[13],le=e[14],Ce=e[15],Ne=r*I-u*b,Ae=r*C-p*b,Be=r*D-y*b,it=u*C-p*I,et=u*D-y*I,Dt=p*D-y*C,Ft=B*ue-F*X,Et=B*le-U*X,wt=B*Ce-j*X,_t=F*le-U*ue,At=F*Ce-j*ue,kt=U*Ce-j*le,pt=Ne*kt-Ae*At+Be*_t+it*wt-et*Et+Dt*Ft;return pt?(i[0]=(I*kt-C*At+D*_t)*(pt=1/pt),i[1]=(p*At-u*kt-y*_t)*pt,i[2]=(ue*Dt-le*et+Ce*it)*pt,i[3]=(U*et-F*Dt-j*it)*pt,i[4]=(C*wt-b*kt-D*Et)*pt,i[5]=(r*kt-p*wt+y*Et)*pt,i[6]=(le*Be-X*Dt-Ce*Ae)*pt,i[7]=(B*Dt-U*Be+j*Ae)*pt,i[8]=(b*At-I*wt+D*Ft)*pt,i[9]=(u*wt-r*At-y*Ft)*pt,i[10]=(X*et-ue*Be+Ce*Ne)*pt,i[11]=(F*Be-B*et-j*Ne)*pt,i[12]=(I*Et-b*_t-C*Ft)*pt,i[13]=(r*_t-u*Et+p*Ft)*pt,i[14]=(ue*Ae-X*it-le*Ne)*pt,i[15]=(B*it-F*Ae+U*Ne)*pt,i):null},s.isImageBitmap=Re,s.isSafari=Me,s.isWorker=ce,s.keysDifference=function(i,e){const r=[];for(const u in i)u in e||r.push(u);return r},s.lazyLoadRTLTextPlugin=function(){Qn.isLoading()||Qn.isLoaded()||ss()!=="deferred"||Hl()},s.makeRequest=ln,s.mapObject=H,s.mercatorXfromLng=wd,s.mercatorYfromLat=Id,s.mercatorZfromAltitude=kd,s.mul=Um,s.mul$1=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},s.multiply=Th,s.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.normalize=function(i,e){var r=e[0],u=e[1],p=e[2],y=r*r+u*u+p*p;return y>0&&(y=1/Math.sqrt(y)),i[0]=e[0]*y,i[1]=e[1]*y,i[2]=e[2]*y,i},s.number=ji,s.ortho=function(i,e,r,u,p,y,b){var I=1/(e-r),C=1/(u-p),D=1/(y-b);return i[0]=-2*I,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*D,i[11]=0,i[12]=(e+r)*I,i[13]=(p+u)*C,i[14]=(b+y)*D,i[15]=1,i},s.parseCacheControl=ee,s.parseGlyphPbf=function(i){return new Iu(i).readFields(Ug,[])},s.pbf=Iu,s.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=un/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0].layout,r=i.bucket.layers[0]._unevaluatedLayout._values,u={layoutIconSize:r["icon-size"].possiblyEvaluate(new Xi(i.bucket.zoom+1),i.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Xi(i.bucket.zoom+1),i.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Xi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:C,maxZoom:D}=i.bucket.textSizeData;u.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Xi(C),i.canonical),r["text-size"].possiblyEvaluate(new Xi(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:C,maxZoom:D}=i.bucket.iconSizeData;u.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Xi(C),i.canonical),r["icon-size"].possiblyEvaluate(new Xi(D),i.canonical)]}const p=e.get("text-line-height")*wn,y=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",b=e.get("text-keep-upright"),I=e.get("text-size");for(const C of i.bucket.features){const D=e.get("text-font").evaluate(C,{},i.canonical).join(","),B=I.evaluate(C,{},i.canonical),F=u.layoutTextSize.evaluate(C,{},i.canonical),U=u.layoutIconSize.evaluate(C,{},i.canonical),j={horizontal:{},vertical:void 0},X=C.text;let ue,le=[0,0];if(X){const Ae=X.toString(),Be=e.get("text-letter-spacing").evaluate(C,{},i.canonical)*wn,it=iu(Ae)?Be:0,et=e.get("text-anchor").evaluate(C,{},i.canonical),Dt=e.get("text-variable-anchor");if(!Dt){const At=e.get("text-radial-offset").evaluate(C,{},i.canonical);le=At?md(et,[At*wn,Su]):e.get("text-offset").evaluate(C,{},i.canonical).map(kt=>kt*wn)}let Ft=y?"center":e.get("text-justify").evaluate(C,{},i.canonical);const Et=e.get("symbol-placement"),wt=Et==="point"?e.get("text-max-width").evaluate(C,{},i.canonical)*wn:0,_t=()=>{i.bucket.allowVerticalPlacement&&Bs(Ae)&&(j.vertical=hc(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,wt,p,et,"left",it,le,s.WritingMode.vertical,!0,Et,F,B))};if(!y&&Dt){const At=Ft==="auto"?Dt.map(pt=>Cu(pt)):[Ft];let kt=!1;for(let pt=0;pt<At.length;pt++){const Zt=At[pt];if(!j.horizontal[Zt])if(kt)j.horizontal[Zt]=j.horizontal[0];else{const Nt=hc(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,wt,p,"center",Zt,it,le,s.WritingMode.horizontal,!1,Et,F,B);Nt&&(j.horizontal[Zt]=Nt,kt=Nt.positionedLines.length===1)}}_t()}else{Ft==="auto"&&(Ft=Cu(et));const At=hc(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,wt,p,et,Ft,it,le,s.WritingMode.horizontal,!1,Et,F,B);At&&(j.horizontal[Ft]=At),_t(),Bs(Ae)&&y&&b&&(j.vertical=hc(X,i.glyphMap,i.glyphPositions,i.imagePositions,D,wt,p,et,Ft,it,le,s.WritingMode.vertical,!1,Et,F,B))}}let Ce=!1;if(C.icon&&C.icon.name){const Ae=i.imageMap[C.icon.name];Ae&&(ue=Wg(i.imagePositions[C.icon.name],e.get("icon-offset").evaluate(C,{},i.canonical),e.get("icon-anchor").evaluate(C,{},i.canonical)),Ce=!!Ae.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Ce:i.bucket.sdfIcons!==Ce&&ge("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==i.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const Ne=_d(j.horizontal)||j.vertical;i.bucket.iconsInText=!!Ne&&Ne.iconsInText,(Ne||ue)&&e_(i.bucket,C,j,ue,i.imageMap,u,F,U,le,Ce,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.perspective=function(i,e,r,u,p){var y,b=1/Math.tan(e/2);return i[0]=b/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+u)*(y=1/(u-p)),i[14]=2*p*u*y):(i[10]=-1,i[14]=-2*u),i},s.pick=function(i,e){const r={};for(let u=0;u<e.length;u++){const p=e[u];p in i&&(r[p]=i[p])}return r},s.plugin=Qn,s.pointGeometry=Ee,s.polygonIntersectsPolygon=bh,s.potpack=$h,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.register=Bt,s.registerForPluginStateChange=function(i){return i({pluginStatus:Ln,pluginURL:qr}),Do.on("pluginStateChange",i),i},s.renderColorRamp=Dh,s.rotateX=function(i,e,r){var u=Math.sin(r),p=Math.cos(r),y=e[4],b=e[5],I=e[6],C=e[7],D=e[8],B=e[9],F=e[10],U=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=y*p+D*u,i[5]=b*p+B*u,i[6]=I*p+F*u,i[7]=C*p+U*u,i[8]=D*p-y*u,i[9]=B*p-b*u,i[10]=F*p-I*u,i[11]=U*p-C*u,i},s.rotateZ=function(i,e,r){var u=Math.sin(r),p=Math.cos(r),y=e[0],b=e[1],I=e[2],C=e[3],D=e[4],B=e[5],F=e[6],U=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=y*p+D*u,i[1]=b*p+B*u,i[2]=I*p+F*u,i[3]=C*p+U*u,i[4]=D*p-y*u,i[5]=B*p-b*u,i[6]=F*p-I*u,i[7]=U*p-C*u,i},s.scale=function(i,e,r){var u=r[0],p=r[1],y=r[2];return i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i[3]=e[3]*u,i[4]=e[4]*p,i[5]=e[5]*p,i[6]=e[6]*p,i[7]=e[7]*p,i[8]=e[8]*y,i[9]=e[9]*y,i[10]=e[10]*y,i[11]=e[11]*y,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},s.setCacheLimits=function(i,e){Qe=i,Je=e},s.setRTLTextPlugin=function(i,e,r=!1){if(Ln===So||Ln===Co||Ln===Mo)throw new Error("setRTLTextPlugin cannot be called multiple times.");qr=he.resolveURL(i),Ln=So,zo=e,Ma(),r||Hl()},s.spec=Ke,s.sphericalToCartesian=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}},s.sqrLen=function(i){var e=i[0],r=i[1];return e*e+r*r},s.sub=function(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i},s.toEvaluationFeature=hs,s.transformMat3=function(i,e,r){var u=e[0],p=e[1],y=e[2];return i[0]=u*r[0]+p*r[3]+y*r[6],i[1]=u*r[1]+p*r[4]+y*r[7],i[2]=u*r[2]+p*r[5]+y*r[8],i},s.transformMat4=nc,s.transformMat4$1=function(i,e,r){var u=e[0],p=e[1];return i[0]=r[0]*u+r[4]*p+r[12],i[1]=r[1]*u+r[5]*p+r[13],i},s.translate=function(i,e,r){var u,p,y,b,I,C,D,B,F,U,j,X,ue=r[0],le=r[1],Ce=r[2];return e===i?(i[12]=e[0]*ue+e[4]*le+e[8]*Ce+e[12],i[13]=e[1]*ue+e[5]*le+e[9]*Ce+e[13],i[14]=e[2]*ue+e[6]*le+e[10]*Ce+e[14],i[15]=e[3]*ue+e[7]*le+e[11]*Ce+e[15]):(p=e[1],y=e[2],b=e[3],I=e[4],C=e[5],D=e[6],B=e[7],F=e[8],U=e[9],j=e[10],X=e[11],i[0]=u=e[0],i[1]=p,i[2]=y,i[3]=b,i[4]=I,i[5]=C,i[6]=D,i[7]=B,i[8]=F,i[9]=U,i[10]=j,i[11]=X,i[12]=u*ue+I*le+F*Ce+e[12],i[13]=p*ue+C*le+U*Ce+e[13],i[14]=y*ue+D*le+j*Ce+e[14],i[15]=b*ue+B*le+X*Ce+e[15]),i},s.triggerPluginCompletionEvent=Wl,s.unicodeBlockLookup=Tt,s.uniqueId=function(){return Z++},s.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateLight=ko,s.validateStyle=rs,s.vectorTile=La,s.warnOnce=ge,s.wrap=V}),g(["./shared"],function(s){function x($){const L=typeof $;if(L==="number"||L==="boolean"||L==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){let J="[";for(const fe of $)J+=`${x(fe)},`;return`${J}]`}const O=Object.keys($).sort();let K="{";for(let J=0;J<O.length;J++)K+=`${JSON.stringify(O[J])}:${x($[O[J]])},`;return`${K}}`}function T($){let L="";for(const O of s.refProperties)L+=`/${x($[O])}`;return L}class k{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,O){for(const J of L){this._layerConfigs[J.id]=J;const fe=this._layers[J.id]=s.createStyleLayer(J);fe._featureFilter=s.createFilter(fe.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of O)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const K=function(J,fe){const we={};for(let pe=0;pe<J.length;pe++){const Ie=fe&&fe[J[pe].id]||T(J[pe]);fe&&(fe[J[pe].id]=Ie);let qe=we[Ie];qe||(qe=we[Ie]=[]),qe.push(J[pe])}const ye=[];for(const pe in we)ye.push(we[pe]);return ye}(Object.values(this._layerConfigs),this.keyCache);for(const J of K){const fe=J.map(st=>this._layers[st.id]),we=fe[0];if(we.visibility==="none")continue;const ye=we.source||"";let pe=this.familiesBySource[ye];pe||(pe=this.familiesBySource[ye]={});const Ie=we.sourceLayer||"_geojsonTileLayer";let qe=pe[Ie];qe||(qe=pe[Ie]=[]),qe.push(fe)}}}class A{constructor(L){const O={},K=[];for(const ye in L){const pe=L[ye],Ie=O[ye]={};for(const qe in pe){const st=pe[+qe];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const Ue={x:0,y:0,w:st.bitmap.width+2,h:st.bitmap.height+2};K.push(Ue),Ie[qe]={rect:Ue,metrics:st.metrics}}}const{w:J,h:fe}=s.potpack(K),we=new s.AlphaImage({width:J||1,height:fe||1});for(const ye in L){const pe=L[ye];for(const Ie in pe){const qe=pe[+Ie];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const st=O[ye][Ie].rect;s.AlphaImage.copy(qe.bitmap,we,{x:0,y:0},{x:st.x+1,y:st.y+1},qe.bitmap)}}this.image=we,this.positions=O}}s.register("GlyphAtlas",A);class S{constructor(L){this.tileID=new s.OverscaledTileID(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId}parse(L,O,K,J,fe){this.status="parsing",this.data=L,this.collisionBoxArray=new s.CollisionBoxArray;const we=new s.DictionaryCoder(Object.keys(L.layers).sort()),ye=new s.FeatureIndex(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const pe={},Ie={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},qe=O.familiesBySource[this.source];for(const ti in qe){const ui=L.layers[ti];if(!ui)continue;ui.version===1&&s.warnOnce(`Vector tile source "${this.source}" layer "${ti}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ki=we.encode(ti),Ri=[];for(let pn=0;pn<ui.length;pn++){const Gi=ui.feature(pn),In=ye.getId(Gi,ti);Ri.push({feature:Gi,id:In,index:pn,sourceLayerIndex:ki})}for(const pn of qe[ti]){const Gi=pn[0];Gi.source!==this.source&&s.warnOnce(`layer.source = ${Gi.source} does not equal this.source = ${this.source}`),Gi.minzoom&&this.zoom<Math.floor(Gi.minzoom)||Gi.maxzoom&&this.zoom>=Gi.maxzoom||Gi.visibility!=="none"&&(V(pn,this.zoom,K),(pe[Gi.id]=Gi.createBucket({index:ye.bucketLayerIDs.length,layers:pn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ki,sourceID:this.source})).populate(Ri,Ie,this.tileID.canonical),ye.bucketLayerIDs.push(pn.map(In=>In.id)))}}let st,Ue,Rt,Ot;const St=s.mapObject(Ie.glyphDependencies,ti=>Object.keys(ti).map(Number));Object.keys(St).length?J.send("getGlyphs",{uid:this.uid,stacks:St},(ti,ui)=>{st||(st=ti,Ue=ui,Ii.call(this))}):Ue={};const Wt=Object.keys(Ie.iconDependencies);Wt.length?J.send("getImages",{icons:Wt,source:this.source,tileID:this.tileID,type:"icons"},(ti,ui)=>{st||(st=ti,Rt=ui,Ii.call(this))}):Rt={};const Kt=Object.keys(Ie.patternDependencies);function Ii(){if(st)return fe(st);if(Ue&&Rt&&Ot){const ti=new A(Ue),ui=new s.ImageAtlas(Rt,Ot);for(const ki in pe){const Ri=pe[ki];Ri instanceof s.SymbolBucket?(V(Ri.layers,this.zoom,K),s.performSymbolLayout({bucket:Ri,glyphMap:Ue,glyphPositions:ti.positions,imageMap:Rt,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ri.hasPattern&&(Ri instanceof s.LineBucket||Ri instanceof s.FillBucket||Ri instanceof s.FillExtrusionBucket)&&(V(Ri.layers,this.zoom,K),Ri.addFeatures(Ie,this.tileID.canonical,ui.patternPositions))}this.status="done",fe(null,{buckets:Object.values(pe).filter(ki=>!ki.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ti.image,imageAtlas:ui,glyphMap:this.returnDependencies?Ue:null,iconMap:this.returnDependencies?Rt:null,glyphPositions:this.returnDependencies?ti.positions:null})}}Kt.length?J.send("getImages",{icons:Kt,source:this.source,tileID:this.tileID,type:"patterns"},(ti,ui)=>{st||(st=ti,Ot=ui,Ii.call(this))}):Ot={},Ii.call(this)}}function V($,L,O){const K=new s.EvaluationParameters(L);for(const J of $)J.recalculate(K,O)}function W($,L){const O=s.getArrayBuffer($.request,(K,J,fe,we)=>{K?L(K):J&&L(null,{vectorTile:new s.vectorTile.VectorTile(new s.pbf(J)),rawData:J,cacheControl:fe,expires:we})});return()=>{O.cancel(),L()}}class Z{constructor(L,O,K,J){this.actor=L,this.layerIndex=O,this.availableImages=K,this.loadVectorData=J||W,this.loading={},this.loaded={}}loadTile(L,O){const K=L.uid;this.loading||(this.loading={});const J=!!(L&&L.request&&L.request.collectResourceTiming)&&new s.RequestPerformance(L.request),fe=this.loading[K]=new S(L);fe.abort=this.loadVectorData(L,(we,ye)=>{if(delete this.loading[K],we||!ye)return fe.status="done",this.loaded[K]=fe,O(we);const pe=ye.rawData,Ie={};ye.expires&&(Ie.expires=ye.expires),ye.cacheControl&&(Ie.cacheControl=ye.cacheControl);const qe={};if(J){const st=J.finish();st&&(qe.resourceTiming=JSON.parse(JSON.stringify(st)))}fe.vectorTile=ye.vectorTile,fe.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,(st,Ue)=>{if(st||!Ue)return O(st);O(null,s.extend({rawTileData:pe.slice(0)},Ue,Ie,qe))}),this.loaded=this.loaded||{},this.loaded[K]=fe})}reloadTile(L,O){const K=this.loaded,J=L.uid,fe=this;if(K&&K[J]){const we=K[J];we.showCollisionBoxes=L.showCollisionBoxes;const ye=(pe,Ie)=>{const qe=we.reloadCallback;qe&&(delete we.reloadCallback,we.parse(we.vectorTile,fe.layerIndex,this.availableImages,fe.actor,qe)),O(pe,Ie)};we.status==="parsing"?we.reloadCallback=ye:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,ye):ye())}}abortTile(L,O){const K=this.loading,J=L.uid;K&&K[J]&&K[J].abort&&(K[J].abort(),delete K[J]),O()}removeTile(L,O){const K=this.loaded,J=L.uid;K&&K[J]&&delete K[J],O()}}class Y{constructor(){this.loaded={}}loadTile(L,O){const{uid:K,encoding:J,rawImageData:fe}=L,we=s.isImageBitmap(fe)?this.getImageData(fe):fe,ye=new s.DEMData(K,we,J);this.loaded=this.loaded||{},this.loaded[K]=ye,O(null,ye)}getImageData(L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const O=this.offscreenCanvasContext.getImageData(-1,-1,L.width+2,L.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:O.width,height:O.height},O.data)}removeTile(L){const O=this.loaded,K=L.uid;O&&O[K]&&delete O[K]}}var H=function $(L,O){var K,J=L&&L.type;if(J==="FeatureCollection")for(K=0;K<L.features.length;K++)$(L.features[K],O);else if(J==="GeometryCollection")for(K=0;K<L.geometries.length;K++)$(L.geometries[K],O);else if(J==="Feature")$(L.geometry,O);else if(J==="Polygon")Q(L.coordinates,O);else if(J==="MultiPolygon")for(K=0;K<L.coordinates.length;K++)Q(L.coordinates[K],O);return L};function Q($,L){if($.length!==0){ae($[0],L);for(var O=1;O<$.length;O++)ae($[O],!L)}}function ae($,L){for(var O=0,K=0,J=0,fe=$.length,we=fe-1;J<fe;we=J++){var ye=($[J][0]-$[we][0])*($[we][1]+$[J][1]),pe=O+ye;K+=Math.abs(O)>=Math.abs(ye)?O-pe+ye:ye-pe+O,O=pe}O+K>=0!=!!L&&$.reverse()}const ne=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(L){this._feature=L,this.extent=s.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const O of this._feature.geometry)L.push([new s.pointGeometry(O[0],O[1])]);return L}{const L=[];for(const O of this._feature.geometry){const K=[];for(const J of O)K.push(new s.pointGeometry(J[0],J[1]));L.push(K)}return L}}toGeoJSON(L,O,K){return ne.call(this,L,O,K)}}class se{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=L.length,this._features=L}feature(L){return new ge(this._features[L])}}var je={exports:{}},ce=s.pointGeometry,ee=s.vectorTile.VectorTileFeature,ke=_e;function _e($,L){this.options=L||{},this.features=$,this.length=$.length}function me($,L){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=L||4096}_e.prototype.feature=function($){return new me(this.features[$],this.options.extent)},me.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var L=0;L<$.length;L++){for(var O=$[L],K=[],J=0;J<O.length;J++)K.push(new ce(O[J][0],O[J][1]));this.geometry.push(K)}return this.geometry},me.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,L=1/0,O=-1/0,K=1/0,J=-1/0,fe=0;fe<$.length;fe++)for(var we=$[fe],ye=0;ye<we.length;ye++){var pe=we[ye];L=Math.min(L,pe.x),O=Math.max(O,pe.x),K=Math.min(K,pe.y),J=Math.max(J,pe.y)}return[L,K,O,J]},me.prototype.toGeoJSON=ee.prototype.toGeoJSON;var Me=s.pbf,Re=ke;function he($){var L=new Me;return function(O,K){for(var J in O.layers)K.writeMessage(3,Ee,O.layers[J])}($,L),L.finish()}function Ee($,L){var O;L.writeVarintField(15,$.version||1),L.writeStringField(1,$.name||""),L.writeVarintField(5,$.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<$.length;O++)K.feature=$.feature(O),L.writeMessage(2,ft,K);var J=K.keys;for(O=0;O<J.length;O++)L.writeStringField(3,J[O]);var fe=K.values;for(O=0;O<fe.length;O++)L.writeMessage(4,Qe,fe[O])}function ft($,L){var O=$.feature;O.id!==void 0&&L.writeVarintField(1,O.id),L.writeMessage(2,nt,$),L.writeVarintField(3,O.type),L.writeMessage(4,de,O)}function nt($,L){var O=$.feature,K=$.keys,J=$.values,fe=$.keycache,we=$.valuecache;for(var ye in O.properties){var pe=O.properties[ye],Ie=fe[ye];if(pe!==null){Ie===void 0&&(K.push(ye),fe[ye]=Ie=K.length-1),L.writeVarint(Ie);var qe=typeof pe;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(pe=JSON.stringify(pe));var st=qe+":"+pe,Ue=we[st];Ue===void 0&&(J.push(pe),we[st]=Ue=J.length-1),L.writeVarint(Ue)}}}function Fe($,L){return(L<<3)+(7&$)}function Se($){return $<<1^$>>31}function de($,L){for(var O=$.loadGeometry(),K=$.type,J=0,fe=0,we=O.length,ye=0;ye<we;ye++){var pe=O[ye],Ie=1;K===1&&(Ie=pe.length),L.writeVarint(Fe(1,Ie));for(var qe=K===3?pe.length-1:pe.length,st=0;st<qe;st++){st===1&&K!==1&&L.writeVarint(Fe(2,qe-1));var Ue=pe[st].x-J,Rt=pe[st].y-fe;L.writeVarint(Se(Ue)),L.writeVarint(Se(Rt)),J+=Ue,fe+=Rt}K===3&&L.writeVarint(Fe(7,1))}}function Qe($,L){var O=typeof $;O==="string"?L.writeStringField(1,$):O==="boolean"?L.writeBooleanField(7,$):O==="number"&&($%1!=0?L.writeDoubleField(3,$):$<0?L.writeSVarintField(6,$):L.writeVarintField(5,$))}function Je($,L,O,K,J,fe){if(J-K<=O)return;const we=K+J>>1;yt($,L,we,K,J,fe%2),Je($,L,O,K,we-1,fe+1),Je($,L,O,we+1,J,fe+1)}function yt($,L,O,K,J,fe){for(;J>K;){if(J-K>600){const Ie=J-K+1,qe=O-K+1,st=Math.log(Ie),Ue=.5*Math.exp(2*st/3),Rt=.5*Math.sqrt(st*Ue*(Ie-Ue)/Ie)*(qe-Ie/2<0?-1:1);yt($,L,O,Math.max(K,Math.floor(O-qe*Ue/Ie+Rt)),Math.min(J,Math.floor(O+(Ie-qe)*Ue/Ie+Rt)),fe)}const we=L[2*O+fe];let ye=K,pe=J;for(mt($,L,K,O),L[2*J+fe]>we&&mt($,L,K,J);ye<pe;){for(mt($,L,ye,pe),ye++,pe--;L[2*ye+fe]<we;)ye++;for(;L[2*pe+fe]>we;)pe--}L[2*K+fe]===we?mt($,L,K,pe):(pe++,mt($,L,pe,J)),pe<=O&&(K=pe+1),O<=pe&&(J=pe-1)}}function mt($,L,O,K){Xe($,O,K),Xe(L,2*O,2*K),Xe(L,2*O+1,2*K+1)}function Xe($,L,O){const K=$[L];$[L]=$[O],$[O]=K}function gt($,L,O,K){const J=$-O,fe=L-K;return J*J+fe*fe}je.exports=he,je.exports.fromVectorTileJs=he,je.exports.fromGeojsonVt=function($,L){L=L||{};var O={};for(var K in $)O[K]=new Re($[K].features,L),O[K].name=K,O[K].version=L.version,O[K].extent=L.extent;return he({layers:O})},je.exports.GeoJSONWrapper=Re;const ze=$=>$[0],Pe=$=>$[1];class Ve{constructor(L,O=ze,K=Pe,J=64,fe=Float64Array){this.nodeSize=J,this.points=L;const we=L.length<65536?Uint16Array:Uint32Array,ye=this.ids=new we(L.length),pe=this.coords=new fe(2*L.length);for(let Ie=0;Ie<L.length;Ie++)ye[Ie]=Ie,pe[2*Ie]=O(L[Ie]),pe[2*Ie+1]=K(L[Ie]);Je(ye,pe,J,0,ye.length-1,0)}range(L,O,K,J){return function(fe,we,ye,pe,Ie,qe,st){const Ue=[0,fe.length-1,0],Rt=[];let Ot,St;for(;Ue.length;){const Wt=Ue.pop(),Kt=Ue.pop(),Ii=Ue.pop();if(Kt-Ii<=st){for(let ki=Ii;ki<=Kt;ki++)Ot=we[2*ki],St=we[2*ki+1],Ot>=ye&&Ot<=Ie&&St>=pe&&St<=qe&&Rt.push(fe[ki]);continue}const ti=Math.floor((Ii+Kt)/2);Ot=we[2*ti],St=we[2*ti+1],Ot>=ye&&Ot<=Ie&&St>=pe&&St<=qe&&Rt.push(fe[ti]);const ui=(Wt+1)%2;(Wt===0?ye<=Ot:pe<=St)&&(Ue.push(Ii),Ue.push(ti-1),Ue.push(ui)),(Wt===0?Ie>=Ot:qe>=St)&&(Ue.push(ti+1),Ue.push(Kt),Ue.push(ui))}return Rt}(this.ids,this.coords,L,O,K,J,this.nodeSize)}within(L,O,K){return function(J,fe,we,ye,pe,Ie){const qe=[0,J.length-1,0],st=[],Ue=pe*pe;for(;qe.length;){const Rt=qe.pop(),Ot=qe.pop(),St=qe.pop();if(Ot-St<=Ie){for(let ui=St;ui<=Ot;ui++)gt(fe[2*ui],fe[2*ui+1],we,ye)<=Ue&&st.push(J[ui]);continue}const Wt=Math.floor((St+Ot)/2),Kt=fe[2*Wt],Ii=fe[2*Wt+1];gt(Kt,Ii,we,ye)<=Ue&&st.push(J[Wt]);const ti=(Rt+1)%2;(Rt===0?we-pe<=Kt:ye-pe<=Ii)&&(qe.push(St),qe.push(Wt-1),qe.push(ti)),(Rt===0?we+pe>=Kt:ye+pe>=Ii)&&(qe.push(Wt+1),qe.push(Ot),qe.push(ti))}return st}(this.ids,this.coords,L,O,K,this.nodeSize)}}const vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},fi=Math.fround||(tt=new Float32Array(1),$=>(tt[0]=+$,tt[0]));var tt;class lt{constructor(L){this.options=Vn(Object.create(vt),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:O,minZoom:K,maxZoom:J,nodeSize:fe}=this.options;O&&console.time("total time");const we=`prepare ${L.length} points`;O&&console.time(we),this.points=L;let ye=[];for(let pe=0;pe<L.length;pe++)L[pe].geometry&&ye.push(ln(L[pe],pe));this.trees[J+1]=new Ve(ye,Va,wr,fe,Float32Array),O&&console.timeEnd(we);for(let pe=J;pe>=K;pe--){const Ie=+Date.now();ye=this._cluster(ye,pe),this.trees[pe]=new Ve(ye,Va,wr,fe,Float32Array),O&&console.log("z%d: %d clusters in %dms",pe,ye.length,+Date.now()-Ie)}return O&&console.timeEnd("total time"),this}getClusters(L,O){let K=((L[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,L[1]));let fe=L[2]===180?180:((L[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)K=-180,fe=180;else if(K>fe){const qe=this.getClusters([K,J,180,we],O),st=this.getClusters([-180,J,fe,we],O);return qe.concat(st)}const ye=this.trees[this._limitZoom(O)],pe=ye.range($e(K),ot(we),$e(fe),ot(J)),Ie=[];for(const qe of pe){const st=ye.points[qe];Ie.push(st.numPoints?ei(st):this.points[st.index])}return Ie}getChildren(L){const O=this._getOriginId(L),K=this._getOriginZoom(L),J="No cluster with the specified id.",fe=this.trees[K];if(!fe)throw new Error(J);const we=fe.points[O];if(!we)throw new Error(J);const ye=this.options.radius/(this.options.extent*Math.pow(2,K-1)),pe=fe.within(we.x,we.y,ye),Ie=[];for(const qe of pe){const st=fe.points[qe];st.parentId===L&&Ie.push(st.numPoints?ei(st):this.points[st.index])}if(Ie.length===0)throw new Error(J);return Ie}getLeaves(L,O,K){const J=[];return this._appendLeaves(J,L,O=O||10,K=K||0,0),J}getTile(L,O,K){const J=this.trees[this._limitZoom(L)],fe=Math.pow(2,L),{extent:we,radius:ye}=this.options,pe=ye/we,Ie=(K-pe)/fe,qe=(K+1+pe)/fe,st={features:[]};return this._addTileFeatures(J.range((O-pe)/fe,Ie,(O+1+pe)/fe,qe),J.points,O,K,fe,st),O===0&&this._addTileFeatures(J.range(1-pe/fe,Ie,1,qe),J.points,fe,K,fe,st),O===fe-1&&this._addTileFeatures(J.range(0,Ie,pe/fe,qe),J.points,-1,K,fe,st),st.features.length?st:null}getClusterExpansionZoom(L){let O=this._getOriginZoom(L)-1;for(;O<=this.options.maxZoom;){const K=this.getChildren(L);if(O++,K.length!==1)break;L=K[0].properties.cluster_id}return O}_appendLeaves(L,O,K,J,fe){const we=this.getChildren(O);for(const ye of we){const pe=ye.properties;if(pe&&pe.cluster?fe+pe.point_count<=J?fe+=pe.point_count:fe=this._appendLeaves(L,pe.cluster_id,K,J,fe):fe<J?fe++:L.push(ye),L.length===K)break}return fe}_addTileFeatures(L,O,K,J,fe,we){for(const ye of L){const pe=O[ye],Ie=pe.numPoints;let qe,st,Ue;if(Ie)qe=dn(pe),st=pe.x,Ue=pe.y;else{const St=this.points[pe.index];qe=St.properties,st=$e(St.geometry.coordinates[0]),Ue=ot(St.geometry.coordinates[1])}const Rt={type:1,geometry:[[Math.round(this.options.extent*(st*fe-K)),Math.round(this.options.extent*(Ue*fe-J))]],tags:qe};let Ot;Ie?Ot=pe.id:this.options.generateId?Ot=pe.index:this.points[pe.index].id&&(Ot=this.points[pe.index].id),Ot!==void 0&&(Rt.id=Ot),we.features.push(Rt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,O){const K=[],{radius:J,extent:fe,reduce:we,minPoints:ye}=this.options,pe=J/(fe*Math.pow(2,O));for(let Ie=0;Ie<L.length;Ie++){const qe=L[Ie];if(qe.zoom<=O)continue;qe.zoom=O;const st=this.trees[O+1],Ue=st.within(qe.x,qe.y,pe),Rt=qe.numPoints||1;let Ot=Rt;for(const St of Ue){const Wt=st.points[St];Wt.zoom>O&&(Ot+=Wt.numPoints||1)}if(Ot>Rt&&Ot>=ye){let St=qe.x*Rt,Wt=qe.y*Rt,Kt=we&&Rt>1?this._map(qe,!0):null;const Ii=(Ie<<5)+(O+1)+this.points.length;for(const ti of Ue){const ui=st.points[ti];if(ui.zoom<=O)continue;ui.zoom=O;const ki=ui.numPoints||1;St+=ui.x*ki,Wt+=ui.y*ki,ui.parentId=Ii,we&&(Kt||(Kt=this._map(qe,!0)),we(Kt,this._map(ui)))}qe.parentId=Ii,K.push(li(St/Ot,Wt/Ot,Ii,Ot,Kt))}else if(K.push(qe),Ot>1)for(const St of Ue){const Wt=st.points[St];Wt.zoom<=O||(Wt.zoom=O,K.push(Wt))}}return K}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,O){if(L.numPoints)return O?Vn({},L.properties):L.properties;const K=this.points[L.index].properties,J=this.options.map(K);return O&&J===K?Vn({},J):J}}function li($,L,O,K,J){return{x:fi($),y:fi(L),zoom:1/0,id:O,parentId:-1,numPoints:K,properties:J}}function ln($,L){const[O,K]=$.geometry.coordinates;return{x:fi($e(O)),y:fi(ot(K)),zoom:1/0,index:L,parentId:-1}}function ei($){return{type:"Feature",id:$.id,properties:dn($),geometry:{type:"Point",coordinates:[(L=$.x,360*(L-.5)),tn($.y)]}};var L}function dn($){const L=$.numPoints,O=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return Vn(Vn({},$.properties),{cluster:!0,cluster_id:$.id,point_count:L,point_count_abbreviated:O})}function $e($){return $/360+.5}function ot($){const L=Math.sin($*Math.PI/180),O=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return O<0?0:O>1?1:O}function tn($){const L=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Vn($,L){for(const O in L)$[O]=L[O];return $}function Va($){return $.x}function wr($){return $.y}function Ir($,L,O,K){for(var J,fe=K,we=O-L>>1,ye=O-L,pe=$[L],Ie=$[L+1],qe=$[O],st=$[O+1],Ue=L+3;Ue<O;Ue+=3){var Rt=ga($[Ue],$[Ue+1],pe,Ie,qe,st);if(Rt>fe)J=Ue,fe=Rt;else if(Rt===fe){var Ot=Math.abs(Ue-we);Ot<ye&&(J=Ue,ye=Ot)}}fe>K&&(J-L>3&&Ir($,L,J,K),$[J+2]=fe,O-J>3&&Ir($,J,O,K))}function ga($,L,O,K,J,fe){var we=J-O,ye=fe-K;if(we!==0||ye!==0){var pe=(($-O)*we+(L-K)*ye)/(we*we+ye*ye);pe>1?(O=J,K=fe):pe>0&&(O+=we*pe,K+=ye*pe)}return(we=$-O)*we+(ye=L-K)*ye}function kr($,L,O,K){var J={id:$===void 0?null:$,type:L,geometry:O,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var we=fe.geometry,ye=fe.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Ke(fe,we);else if(ye==="Polygon"||ye==="MultiLineString")for(var pe=0;pe<we.length;pe++)Ke(fe,we[pe]);else if(ye==="MultiPolygon")for(pe=0;pe<we.length;pe++)for(var Ie=0;Ie<we[pe].length;Ie++)Ke(fe,we[pe][Ie])}(J),J}function Ke($,L){for(var O=0;O<L.length;O+=3)$.minX=Math.min($.minX,L[O]),$.minY=Math.min($.minY,L[O+1]),$.maxX=Math.max($.maxX,L[O]),$.maxY=Math.max($.maxY,L[O+1])}function It($,L,O,K){if(L.geometry){var J=L.geometry.coordinates,fe=L.geometry.type,we=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),ye=[],pe=L.id;if(O.promoteId?pe=L.properties[O.promoteId]:O.generateId&&(pe=K||0),fe==="Point")Yr(J,ye);else if(fe==="MultiPoint")for(var Ie=0;Ie<J.length;Ie++)Yr(J[Ie],ye);else if(fe==="LineString")nr(J,ye,we,!1);else if(fe==="MultiLineString"){if(O.lineMetrics){for(Ie=0;Ie<J.length;Ie++)nr(J[Ie],ye=[],we,!1),$.push(kr(pe,"LineString",ye,L.properties));return}wi(J,ye,we,!1)}else if(fe==="Polygon")wi(J,ye,we,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(Ie=0;Ie<L.geometry.geometries.length;Ie++)It($,{id:pe,geometry:L.geometry.geometries[Ie],properties:L.properties},O,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ie=0;Ie<J.length;Ie++){var qe=[];wi(J[Ie],qe,we,!0),ye.push(qe)}}$.push(kr(pe,fe,ye,L.properties))}}function Yr($,L){L.push(Jn($[0])),L.push(Nn($[1])),L.push(0)}function nr($,L,O,K){for(var J,fe,we=0,ye=0;ye<$.length;ye++){var pe=Jn($[ye][0]),Ie=Nn($[ye][1]);L.push(pe),L.push(Ie),L.push(0),ye>0&&(we+=K?(J*Ie-pe*fe)/2:Math.sqrt(Math.pow(pe-J,2)+Math.pow(Ie-fe,2))),J=pe,fe=Ie}var qe=L.length-3;L[2]=1,Ir(L,0,qe,O),L[qe+2]=1,L.size=Math.abs(we),L.start=0,L.end=L.size}function wi($,L,O,K){for(var J=0;J<$.length;J++){var fe=[];nr($[J],fe,O,K),L.push(fe)}}function Jn($){return $/360+.5}function Nn($){var L=Math.sin($*Math.PI/180),O=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return O<0?0:O>1?1:O}function Un($,L,O,K,J,fe,we,ye){if(K/=L,fe>=(O/=L)&&we<K)return $;if(we<O||fe>=K)return null;for(var pe=[],Ie=0;Ie<$.length;Ie++){var qe=$[Ie],st=qe.geometry,Ue=qe.type,Rt=J===0?qe.minX:qe.minY,Ot=J===0?qe.maxX:qe.maxY;if(Rt>=O&&Ot<K)pe.push(qe);else if(!(Ot<O||Rt>=K)){var St=[];if(Ue==="Point"||Ue==="MultiPoint")Or(st,St,O,K,J);else if(Ue==="LineString")bt(st,St,O,K,J,!1,ye.lineMetrics);else if(Ue==="MultiLineString")ri(st,St,O,K,J,!1);else if(Ue==="Polygon")ri(st,St,O,K,J,!0);else if(Ue==="MultiPolygon")for(var Wt=0;Wt<st.length;Wt++){var Kt=[];ri(st[Wt],Kt,O,K,J,!0),Kt.length&&St.push(Kt)}if(St.length){if(ye.lineMetrics&&Ue==="LineString"){for(Wt=0;Wt<St.length;Wt++)pe.push(kr(qe.id,Ue,St[Wt],qe.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(St.length===1?(Ue="LineString",St=St[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=St.length===3?"Point":"MultiPoint"),pe.push(kr(qe.id,Ue,St,qe.tags))}}}return pe.length?pe:null}function Or($,L,O,K,J){for(var fe=0;fe<$.length;fe+=3){var we=$[fe+J];we>=O&&we<=K&&(L.push($[fe]),L.push($[fe+1]),L.push($[fe+2]))}}function bt($,L,O,K,J,fe,we){for(var ye,pe,Ie=ci($),qe=J===0?Vr:ii,st=$.start,Ue=0;Ue<$.length-3;Ue+=3){var Rt=$[Ue],Ot=$[Ue+1],St=$[Ue+2],Wt=$[Ue+3],Kt=$[Ue+4],Ii=J===0?Rt:Ot,ti=J===0?Wt:Kt,ui=!1;we&&(ye=Math.sqrt(Math.pow(Rt-Wt,2)+Math.pow(Ot-Kt,2))),Ii<O?ti>O&&(pe=qe(Ie,Rt,Ot,Wt,Kt,O),we&&(Ie.start=st+ye*pe)):Ii>K?ti<K&&(pe=qe(Ie,Rt,Ot,Wt,Kt,K),we&&(Ie.start=st+ye*pe)):bn(Ie,Rt,Ot,St),ti<O&&Ii>=O&&(pe=qe(Ie,Rt,Ot,Wt,Kt,O),ui=!0),ti>K&&Ii<=K&&(pe=qe(Ie,Rt,Ot,Wt,Kt,K),ui=!0),!fe&&ui&&(we&&(Ie.end=st+ye*pe),L.push(Ie),Ie=ci($)),we&&(st+=ye)}var ki=$.length-3;Rt=$[ki],Ot=$[ki+1],St=$[ki+2],(Ii=J===0?Rt:Ot)>=O&&Ii<=K&&bn(Ie,Rt,Ot,St),ki=Ie.length-3,fe&&ki>=3&&(Ie[ki]!==Ie[0]||Ie[ki+1]!==Ie[1])&&bn(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&L.push(Ie)}function ci($){var L=[];return L.size=$.size,L.start=$.start,L.end=$.end,L}function ri($,L,O,K,J,fe){for(var we=0;we<$.length;we++)bt($[we],L,O,K,J,fe,!1)}function bn($,L,O,K){$.push(L),$.push(O),$.push(K)}function Vr($,L,O,K,J,fe){var we=(fe-L)/(K-L);return $.push(fe),$.push(O+(J-O)*we),$.push(1),we}function ii($,L,O,K,J,fe){var we=(fe-O)/(J-O);return $.push(L+(K-L)*we),$.push(fe),$.push(1),we}function Tr($,L){for(var O=[],K=0;K<$.length;K++){var J,fe=$[K],we=fe.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")J=fn(fe.geometry,L);else if(we==="MultiLineString"||we==="Polygon"){J=[];for(var ye=0;ye<fe.geometry.length;ye++)J.push(fn(fe.geometry[ye],L))}else if(we==="MultiPolygon")for(J=[],ye=0;ye<fe.geometry.length;ye++){for(var pe=[],Ie=0;Ie<fe.geometry[ye].length;Ie++)pe.push(fn(fe.geometry[ye][Ie],L));J.push(pe)}O.push(kr(fe.id,we,J,fe.tags))}return O}function fn($,L){var O=[];O.size=$.size,$.start!==void 0&&(O.start=$.start,O.end=$.end);for(var K=0;K<$.length;K+=3)O.push($[K]+L,$[K+1],$[K+2]);return O}function _a($,L){if($.transformed)return $;var O,K,J,fe=1<<$.z,we=$.x,ye=$.y;for(O=0;O<$.features.length;O++){var pe=$.features[O],Ie=pe.geometry,qe=pe.type;if(pe.geometry=[],qe===1)for(K=0;K<Ie.length;K+=2)pe.geometry.push(rn(Ie[K],Ie[K+1],L,fe,we,ye));else for(K=0;K<Ie.length;K++){var st=[];for(J=0;J<Ie[K].length;J+=2)st.push(rn(Ie[K][J],Ie[K][J+1],L,fe,we,ye));pe.geometry.push(st)}}return $.transformed=!0,$}function rn($,L,O,K,J,fe){return[Math.round(O*($*K-J)),Math.round(O*(L*K-fe))]}function Sn($,L,O,K,J){for(var fe=L===J.maxZoom?0:J.tolerance/((1<<L)*J.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:K,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ye=0;ye<$.length;ye++){we.numFeatures++,Pi(we,$[ye],fe,J);var pe=$[ye].minX,Ie=$[ye].minY,qe=$[ye].maxX,st=$[ye].maxY;pe<we.minX&&(we.minX=pe),Ie<we.minY&&(we.minY=Ie),qe>we.maxX&&(we.maxX=qe),st>we.maxY&&(we.maxY=st)}return we}function Pi($,L,O,K){var J=L.geometry,fe=L.type,we=[];if(fe==="Point"||fe==="MultiPoint")for(var ye=0;ye<J.length;ye+=3)we.push(J[ye]),we.push(J[ye+1]),$.numPoints++,$.numSimplified++;else if(fe==="LineString")ya(we,J,$,O,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(ye=0;ye<J.length;ye++)ya(we,J[ye],$,O,fe==="Polygon",ye===0);else if(fe==="MultiPolygon")for(var pe=0;pe<J.length;pe++){var Ie=J[pe];for(ye=0;ye<Ie.length;ye++)ya(we,Ie[ye],$,O,!0,ye===0)}if(we.length){var qe=L.tags||null;if(fe==="LineString"&&K.lineMetrics){for(var st in qe={},L.tags)qe[st]=L.tags[st];qe.mapbox_clip_start=J.start/J.size,qe.mapbox_clip_end=J.end/J.size}var Ue={geometry:we,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:qe};L.id!==null&&(Ue.id=L.id),$.features.push(Ue)}}function ya($,L,O,K,J,fe){var we=K*K;if(K>0&&L.size<(J?we:K))O.numPoints+=L.length/3;else{for(var ye=[],pe=0;pe<L.length;pe+=3)(K===0||L[pe+2]>we)&&(O.numSimplified++,ye.push(L[pe]),ye.push(L[pe+1])),O.numPoints++;J&&function(Ie,qe){for(var st=0,Ue=0,Rt=Ie.length,Ot=Rt-2;Ue<Rt;Ot=Ue,Ue+=2)st+=(Ie[Ue]-Ie[Ot])*(Ie[Ue+1]+Ie[Ot+1]);if(st>0===qe)for(Ue=0,Rt=Ie.length;Ue<Rt/2;Ue+=2){var St=Ie[Ue],Wt=Ie[Ue+1];Ie[Ue]=Ie[Rt-2-Ue],Ie[Ue+1]=Ie[Rt-1-Ue],Ie[Rt-2-Ue]=St,Ie[Rt-1-Ue]=Wt}}(ye,fe),$.push(ye)}}function fr($,L){var O=(L=this.options=function(J,fe){for(var we in fe)J[we]=fe[we];return J}(Object.create(this.options),L)).debug;if(O&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(J,fe){var we=[];if(J.type==="FeatureCollection")for(var ye=0;ye<J.features.length;ye++)It(we,J.features[ye],fe,ye);else It(we,J.type==="Feature"?J:{geometry:J},fe);return we}($,L);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(J,fe){var we=fe.buffer/fe.extent,ye=J,pe=Un(J,1,-1-we,we,0,-1,2,fe),Ie=Un(J,1,1-we,2+we,0,-1,2,fe);return(pe||Ie)&&(ye=Un(J,1,-we,1+we,0,-1,2,fe)||[],pe&&(ye=Tr(pe,1).concat(ye)),Ie&&(ye=ye.concat(Tr(Ie,-1)))),ye}(K,L),K.length&&this.splitTile(K,0,0,0),O&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Jr($,L,O){return 32*((1<<$)*O+L)+$}function Qr($,L){const O=$.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const K=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!K)return L(null,null);const J=new se(K.features);let fe=je.exports(J);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),L(null,{vectorTile:J,rawData:fe.buffer})}fr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fr.prototype.splitTile=function($,L,O,K,J,fe,we){for(var ye=[$,L,O,K],pe=this.options,Ie=pe.debug;ye.length;){K=ye.pop(),O=ye.pop(),L=ye.pop(),$=ye.pop();var qe=1<<L,st=Jr(L,O,K),Ue=this.tiles[st];if(!Ue&&(Ie>1&&console.time("creation"),Ue=this.tiles[st]=Sn($,L,O,K,pe),this.tileCoords.push({z:L,x:O,y:K}),Ie)){Ie>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,O,K,Ue.numFeatures,Ue.numPoints,Ue.numSimplified),console.timeEnd("creation"));var Rt="z"+L;this.stats[Rt]=(this.stats[Rt]||0)+1,this.total++}if(Ue.source=$,J){if(L===pe.maxZoom||L===J)continue;var Ot=1<<J-L;if(O!==Math.floor(fe/Ot)||K!==Math.floor(we/Ot))continue}else if(L===pe.indexMaxZoom||Ue.numPoints<=pe.indexMaxPoints)continue;if(Ue.source=null,$.length!==0){Ie>1&&console.time("clipping");var St,Wt,Kt,Ii,ti,ui,ki=.5*pe.buffer/pe.extent,Ri=.5-ki,pn=.5+ki,Gi=1+ki;St=Wt=Kt=Ii=null,ti=Un($,qe,O-ki,O+pn,0,Ue.minX,Ue.maxX,pe),ui=Un($,qe,O+Ri,O+Gi,0,Ue.minX,Ue.maxX,pe),$=null,ti&&(St=Un(ti,qe,K-ki,K+pn,1,Ue.minY,Ue.maxY,pe),Wt=Un(ti,qe,K+Ri,K+Gi,1,Ue.minY,Ue.maxY,pe),ti=null),ui&&(Kt=Un(ui,qe,K-ki,K+pn,1,Ue.minY,Ue.maxY,pe),Ii=Un(ui,qe,K+Ri,K+Gi,1,Ue.minY,Ue.maxY,pe),ui=null),Ie>1&&console.timeEnd("clipping"),ye.push(St||[],L+1,2*O,2*K),ye.push(Wt||[],L+1,2*O,2*K+1),ye.push(Kt||[],L+1,2*O+1,2*K),ye.push(Ii||[],L+1,2*O+1,2*K+1)}}},fr.prototype.getTile=function($,L,O){var K=this.options,J=K.extent,fe=K.debug;if($<0||$>24)return null;var we=1<<$,ye=Jr($,L=(L%we+we)%we,O);if(this.tiles[ye])return _a(this.tiles[ye],J);fe>1&&console.log("drilling down to z%d-%d-%d",$,L,O);for(var pe,Ie=$,qe=L,st=O;!pe&&Ie>0;)Ie--,qe=Math.floor(qe/2),st=Math.floor(st/2),pe=this.tiles[Jr(Ie,qe,st)];return pe&&pe.source?(fe>1&&console.log("found parent tile z%d-%d-%d",Ie,qe,st),fe>1&&console.time("drilling down"),this.splitTile(pe.source,Ie,qe,st,$,L,O),fe>1&&console.timeEnd("drilling down"),this.tiles[ye]?_a(this.tiles[ye],J):null):null};class va extends Z{constructor(L,O,K,J){super(L,O,K,Qr),J&&(this.loadGeoJSON=J)}loadData(L,O){var K;(K=this._pendingRequest)===null||K===void 0||K.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const J=!!(L&&L.request&&L.request.collectResourceTiming)&&new s.RequestPerformance(L.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(L,(fe,we)=>{if(delete this._pendingCallback,delete this._pendingRequest,fe||!we)return O(fe);if(typeof we!="object")return O(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{H(we,!0);try{if(L.filter){const pe=s.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(qe=>pe.value.evaluate({zoom:0},qe))}}this._geoJSONIndex=L.cluster?new lt(function({superclusterOptions:pe,clusterProperties:Ie}){if(!Ie||!pe)return pe;const qe={},st={},Ue={accumulated:null,zoom:0},Rt={properties:null},Ot=Object.keys(Ie);for(const St of Ot){const[Wt,Kt]=Ie[St],Ii=s.createExpression(Kt),ti=s.createExpression(typeof Wt=="string"?[Wt,["accumulated"],["get",St]]:Wt);qe[St]=Ii.value,st[St]=ti.value}return pe.map=St=>{Rt.properties=St;const Wt={};for(const Kt of Ot)Wt[Kt]=qe[Kt].evaluate(Ue,Rt);return Wt},pe.reduce=(St,Wt)=>{Rt.properties=Wt;for(const Kt of Ot)Ue.accumulated=St[Kt],St[Kt]=st[Kt].evaluate(Ue,Rt)},pe}(L)).load(we.features):function(pe,Ie){return new fr(pe,Ie)}(we,L.geojsonVtOptions)}catch(pe){return O(pe)}this.loaded={};const ye={};if(J){const pe=J.finish();pe&&(ye.resourceTiming={},ye.resourceTiming[L.source]=JSON.parse(JSON.stringify(pe)))}O(null,ye)}})}reloadTile(L,O){const K=this.loaded;return K&&K[L.uid]?super.reloadTile(L,O):this.loadTile(L,O)}loadGeoJSON(L,O){if(L.request)return s.getJSON(L.request,O);if(typeof L.data=="string")try{O(null,JSON.parse(L.data))}catch{O(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}else O(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(L,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(L,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(K){O(K)}}getClusterChildren(L,O){try{O(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(K){O(K)}}getClusterLeaves(L,O){try{O(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(K){O(K)}}}class $r{constructor(L){this.self=L,this.actor=new s.Actor(L,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Z,geojson:va},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,K)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=K},this.self.registerRTLTextPlugin=O=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=O.applyArabicShaping,s.plugin.processBidirectionalText=O.processBidirectionalText,s.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(L,O){this.referrer=O}setImages(L,O,K){this.availableImages[L]=O;for(const J in this.workerSources[L]){const fe=this.workerSources[L][J];for(const we in fe)fe[we].availableImages=O}K()}setLayers(L,O,K){this.getLayerIndex(L).replace(O),K()}updateLayers(L,O,K){this.getLayerIndex(L).update(O.layers,O.removedIds),K()}loadTile(L,O,K){this.getWorkerSource(L,O.type,O.source).loadTile(O,K)}loadDEMTile(L,O,K){this.getDEMWorkerSource(L,O.source).loadTile(O,K)}reloadTile(L,O,K){this.getWorkerSource(L,O.type,O.source).reloadTile(O,K)}abortTile(L,O,K){this.getWorkerSource(L,O.type,O.source).abortTile(O,K)}removeTile(L,O,K){this.getWorkerSource(L,O.type,O.source).removeTile(O,K)}removeDEMTile(L,O){this.getDEMWorkerSource(L,O.source).removeTile(O)}removeSource(L,O,K){if(!this.workerSources[L]||!this.workerSources[L][O.type]||!this.workerSources[L][O.type][O.source])return;const J=this.workerSources[L][O.type][O.source];delete this.workerSources[L][O.type][O.source],J.removeSource!==void 0?J.removeSource(O,K):K()}loadWorkerSource(L,O,K){try{this.self.importScripts(O.url),K()}catch(J){K(J.toString())}}syncRTLPluginState(L,O,K){try{s.plugin.setState(O);const J=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&J!=null){this.self.importScripts(J);const fe=s.plugin.isParsed();K(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),fe)}}catch(J){K(J.toString())}}getAvailableImages(L){let O=this.availableImages[L];return O||(O=[]),O}getLayerIndex(L){let O=this.layerIndexes[L];return O||(O=this.layerIndexes[L]=new k),O}getWorkerSource(L,O,K){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][O]||(this.workerSources[L][O]={}),!this.workerSources[L][O][K]){const J={send:(fe,we,ye)=>{this.actor.send(fe,we,ye,L)}};this.workerSources[L][O][K]=new this.workerSourceTypes[O](J,this.getLayerIndex(L),this.getAvailableImages(L))}return this.workerSources[L][O][K]}getDEMWorkerSource(L,O){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][O]||(this.demWorkerSources[L][O]=new Y),this.demWorkerSources[L][O]}enforceCacheSizeLimit(L,O){s.enforceCacheSizeLimit(O)}}return s.isWorker()&&(self.worker=new $r(self)),$r}),g(["./shared"],function(s){var x=T;function T(f){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{m=new Worker(w),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(w),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var v=m.getImageData(0,0,1,1);return v&&v.width===h.width}()?(k[l=t&&t.failIfMajorPerformanceCaveat]===void 0&&(k[l]=function(h){var m,v=function(w){var M=document.createElement("canvas"),z=Object.create(T.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=w,M.getContext("webgl",z)||M.getContext("experimental-webgl",z)}(h);if(!v)return!1;try{m=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!m||v.isContextLost())&&(v.shaderSource(m,"void main() {}"),v.compileShader(m),v.getShaderParameter(m,v.COMPILE_STATUS)===!0)}(l)),k[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(f)}var k={};function A(f,t){if(Array.isArray(f)){if(!Array.isArray(t)||f.length!==t.length)return!1;for(let l=0;l<f.length;l++)if(!A(f[l],t[l]))return!1;return!0}if(typeof f=="object"&&f!==null&&t!==null){if(typeof t!="object"||Object.keys(f).length!==Object.keys(t).length)return!1;for(const l in f)if(!A(f[l],t[l]))return!1;return!0}return f===t}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class S{static testProp(t){if(!S.docStyle)return t[0];for(let l=0;l<t.length;l++)if(t[l]in S.docStyle)return t[l];return t[0]}static create(t,l,h){const m=window.document.createElement(t);return l!==void 0&&(m.className=l),h&&h.appendChild(m),m}static createNS(t,l){return window.document.createElementNS(t,l)}static disableDrag(){S.docStyle&&S.selectProp&&(S.userSelect=S.docStyle[S.selectProp],S.docStyle[S.selectProp]="none")}static enableDrag(){S.docStyle&&S.selectProp&&(S.docStyle[S.selectProp]=S.userSelect)}static setTransform(t,l){t.style[S.transformProp]=l}static addEventListener(t,l,h,m={}){t.addEventListener(l,h,"passive"in m?m:m.capture)}static removeEventListener(t,l,h,m={}){t.removeEventListener(l,h,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",S.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",S.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",S.suppressClickInternal,!0)},0)}static mousePos(t,l){const h=t.getBoundingClientRect();return new s.pointGeometry(l.clientX-h.left-t.clientLeft,l.clientY-h.top-t.clientTop)}static touchPos(t,l){const h=t.getBoundingClientRect(),m=[];for(let v=0;v<l.length;v++)m.push(new s.pointGeometry(l[v].clientX-h.left-t.clientLeft,l[v].clientY-h.top-t.clientTop));return m}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}S.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,S.selectProp=S.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),S.transformProp=S.testProp(["transform","WebkitTransform"]);class V{constructor(t){this._transformRequestFn=t}transformRequest(t,l){return this._transformRequestFn&&this._transformRequestFn(t,l)||{url:t}}normalizeSpriteURL(t,l,h){const m=function(v){const w=v.match(W);if(!w)throw new Error(`Unable to parse URL "${v}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(t);return m.path+=`${l}${h}`,function(v){const w=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${w}`}(m)}setTransformRequest(t){this._transformRequestFn=t}}const W=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class Z{constructor(t,l,h,m){this.context=t,this.format=h,this.texture=t.gl.createTexture(),this.update(l,m)}update(t,l,h){const{width:m,height:v}=t,w=!(this.size&&this.size[0]===m&&this.size[1]===v||h),{context:M}=this,{gl:z}=M;if(this.useMipmap=!!(l&&l.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!l||l.premultiply!==!1)),w)this.size=[m,v],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.isImageBitmap(t)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,t):z.texImage2D(z.TEXTURE_2D,0,this.format,m,v,0,this.format,z.UNSIGNED_BYTE,t.data);else{const{x:P,y:R}=h||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.isImageBitmap(t)?z.texSubImage2D(z.TEXTURE_2D,0,P,R,z.RGBA,z.UNSIGNED_BYTE,t):z.texSubImage2D(z.TEXTURE_2D,0,P,R,m,v,z.RGBA,z.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(t,l,h){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),h!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=v.LINEAR),t!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,t),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,h||t),this.filter=t),l!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,l),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Y(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class H extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,callback:h}of this.requestors)this._notify(l,h);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,l){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let h=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(l.content,l)||(this.fire(new s.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,l){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||l<m[1])return!1;h=m[1]}return!0}_validateContent(t,l){return!(t&&(t.length!==4||t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,l){const h=this.images[t];if(h.data.width!==l.data.width||h.data.height!==l.data.height)throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=h.version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,l){let h=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(t,l):this.requestors.push({ids:t,callback:l})}_notify(t,l){const h={};for(const m of t){this.images[m]||this.fire(new s.Event("styleimagemissing",{id:m}));const v=this.images[m];v?h[m]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,h)}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],h=this.getImage(t);if(!h)return null;if(l&&l.position.version===h.version)return l.position;if(l)l.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},v=new s.ImagePosition(m,h);this.patterns[t]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Z(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:l,h}=s.potpack(t),m=this.atlasImage;m.resize({width:l||1,height:h||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],M=w.x+1,z=w.y+1,P=this.images[v].data,R=P.width,N=P.height;s.RGBAImage.copy(P,m,{x:0,y:0},{x:M,y:z},{width:R,height:N}),s.RGBAImage.copy(P,m,{x:0,y:N-1},{x:M,y:z-1},{width:R,height:1}),s.RGBAImage.copy(P,m,{x:0,y:0},{x:M,y:z+N},{width:R,height:1}),s.RGBAImage.copy(P,m,{x:R-1,y:0},{x:M-1,y:z},{width:1,height:N}),s.RGBAImage.copy(P,m,{x:0,y:0},{x:M+R,y:z},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const h=this.images[l];h||s.warnOnce(`Image with ID: "${l}" was not found`),Y(h)&&this.updateImage(l,h)}}}const Q=1e20;function ae(f,t,l,h,m,v,w,M,z){for(let P=t;P<t+h;P++)ne(f,l*v+P,v,m,w,M,z);for(let P=l;P<l+m;P++)ne(f,P*v+t,1,h,w,M,z)}function ne(f,t,l,h,m,v,w){v[0]=0,w[0]=-Q,w[1]=Q,m[0]=f[t];for(let M=1,z=0,P=0;M<h;M++){m[M]=f[t+M*l];const R=M*M;do{const N=v[z];P=(m[M]-m[N]+R-N*N)/(M-N)/2}while(P<=w[z]&&--z>-1);z++,v[z]=M,w[z]=P,w[z+1]=Q}for(let M=0,z=0;M<h;M++){for(;w[z+1]<M;)z++;const P=v[z],R=M-P;f[t+M*l]=m[P]+R*R}}class ge{constructor(t,l){this.requestManager=t,this.localIdeographFontFamily=l,this.entries={}}setURL(t){this.url=t}getGlyphs(t,l){const h=[];for(const m in t)for(const v of t[m])h.push({stack:m,id:v});s.asyncAll(h,({stack:m,id:v},w)=>{let M=this.entries[m];M||(M=this.entries[m]={glyphs:{},requests:{},ranges:{}});let z=M.glyphs[v];if(z!==void 0)return void w(null,{stack:m,id:v,glyph:z});if(z=this._tinySDF(M,m,v),z)return M.glyphs[v]=z,void w(null,{stack:m,id:v,glyph:z});const P=Math.floor(v/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(M.ranges[P])return void w(null,{stack:m,id:v,glyph:z});let R=M.requests[P];R||(R=M.requests[P]=[],ge.loadGlyphRange(m,P,this.url,this.requestManager,(N,G)=>{if(G){for(const re in G)this._doesCharSupportLocalGlyph(+re)||(M.glyphs[+re]=G[+re]);M.ranges[P]=!0}for(const re of R)re(N,G);delete M.requests[P]})),R.push((N,G)=>{N?w(N):G&&w(null,{stack:m,id:v,glyph:G[v]||null})})},(m,v)=>{if(m)l(m);else if(v){const w={};for(const{stack:M,id:z,glyph:P}of v)(w[M]||(w[M]={}))[z]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};l(null,w)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.unicodeBlockLookup["CJK Unified Ideographs"](t)||s.unicodeBlockLookup["Hangul Syllables"](t)||s.unicodeBlockLookup.Hiragana(t)||s.unicodeBlockLookup.Katakana(t))}_tinySDF(t,l,h){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(h))return;let v=t.tinySDF;if(!v){let M="400";/bold/i.test(l)?M="900":/medium/i.test(l)?M="500":/light/i.test(l)&&(M="200"),v=t.tinySDF=new ge.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:m,fontWeight:M})}const w=v.draw(String.fromCharCode(h));return{id:h,bitmap:new s.AlphaImage({width:w.width||30,height:w.height||30},w.data),metrics:{width:w.glyphWidth||24,height:w.glyphHeight||24,left:w.glyphLeft||0,top:w.glyphTop-27||-8,advance:w.glyphAdvance||24}}}}ge.loadGlyphRange=function(f,t,l,h,m){const v=256*t,w=v+255,M=h.transformRequest(l.replace("{fontstack}",f).replace("{range}",`${v}-${w}`),s.ResourceType.Glyphs);s.getArrayBuffer(M,(z,P)=>{if(z)m(z);else if(P){const R={};for(const N of s.parseGlyphPbf(P))R[N.id]=N;m(null,R)}})},ge.TinySDF=class{constructor({fontSize:f=24,buffer:t=3,radius:l=8,cutoff:h=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:w="normal"}={}){this.buffer=t,this.cutoff=h,this.radius=l;const M=this.size=f+4*t,z=this._createCanvas(M),P=this.ctx=z.getContext("2d",{willReadFrequently:!0});P.font=`${w} ${v} ${f}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(f){const t=document.createElement("canvas");return t.width=t.height=f,t}draw(f){const{width:t,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(f),w=Math.ceil(l),M=Math.min(this.size-this.buffer,Math.ceil(v-m)),z=Math.min(this.size-this.buffer,w+Math.ceil(h)),P=M+2*this.buffer,R=z+2*this.buffer,N=Math.max(P*R,0),G=new Uint8ClampedArray(N),re={data:G,width:P,height:R,glyphWidth:M,glyphHeight:z,glyphTop:w,glyphLeft:0,glyphAdvance:t};if(M===0||z===0)return re;const{ctx:te,buffer:ie,gridInner:xe,gridOuter:Te}=this;te.clearRect(ie,ie,M,z),te.fillText(f,ie,ie+w);const De=te.getImageData(ie,ie,M,z);Te.fill(Q,0,N),xe.fill(0,0,N);for(let oe=0;oe<z;oe++)for(let Oe=0;Oe<M;Oe++){const Le=De.data[4*(oe*M+Oe)+3]/255;if(Le===0)continue;const We=(oe+ie)*P+Oe+ie;if(Le===1)Te[We]=0,xe[We]=Q;else{const He=.5-Le;Te[We]=He>0?He*He:0,xe[We]=He<0?He*He:0}}ae(Te,0,0,P,R,P,this.f,this.v,this.z),ae(xe,ie,ie,M,z,P,this.f,this.v,this.z);for(let oe=0;oe<N;oe++){const Oe=Math.sqrt(Te[oe])-Math.sqrt(xe[oe]);G[oe]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return re}};const se=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(f,t){return s.sphericalToCartesian(f.expression.evaluate(t))}interpolate(f,t,l){return{x:s.number(f.x,t.x,l),y:s.number(f.y,t.y,l),z:s.number(f.z,t.z,l)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),je="-transition";class ce extends s.Evented{constructor(t){super(),this._transitionable=new s.Transitionable(se),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(s.validateLight,t,l))for(const h in t){const m=t[h];h.endsWith(je)?this._transitionable.setTransition(h.slice(0,-je.length),m):this._transitionable.setValue(h,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,h){return(!h||h.validate!==!1)&&s.emitValidationErrors(this,t.call(s.validateStyle,s.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class ee{constructor(t,l){this.width=t,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,l){const h=t.join(",")+String(l);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(t,l)),this.dashEntry[h]}getDashRanges(t,l,h){const m=[];let v=t.length%2==1?-t[t.length-1]*h:0,w=t[0]*h,M=!0;m.push({left:v,right:w,isDash:M,zeroLength:t[0]===0});let z=t[0];for(let P=1;P<t.length;P++){M=!M;const R=t[P];v=z*h,z+=R,w=z*h,m.push({left:v,right:w,isDash:M,zeroLength:R===0})}return m}addRoundDash(t,l,h){const m=l/2;for(let v=-h;v<=h;v++){const w=this.width*(this.nextRow+h+v);let M=0,z=t[M];for(let P=0;P<this.width;P++){P/z.right>1&&(z=t[++M]);const R=Math.abs(P-z.left),N=Math.abs(P-z.right),G=Math.min(R,N);let re;const te=v/h*(m+1);if(z.isDash){const ie=m-Math.abs(te);re=Math.sqrt(G*G+ie*ie)}else re=m-Math.sqrt(G*G+te*te);this.data[w+P]=Math.max(0,Math.min(255,re+128))}}}addRegularDash(t){for(let M=t.length-1;M>=0;--M){const z=t[M],P=t[M+1];z.zeroLength?t.splice(M,1):P&&P.isDash===z.isDash&&(P.left=z.left,t.splice(M,1))}const l=t[0],h=t[t.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const m=this.width*this.nextRow;let v=0,w=t[v];for(let M=0;M<this.width;M++){M/w.right>1&&(w=t[++v]);const z=Math.abs(M-w.left),P=Math.abs(M-w.right),R=Math.min(z,P);this.data[m+M]=Math.max(0,Math.min(255,(w.isDash?R:-R)+128))}}addDash(t,l){const h=l?7:0,m=2*h+1;if(this.nextRow+m>this.height)return s.warnOnce("LineAtlas out of space"),null;let v=0;for(let M=0;M<t.length;M++)v+=t[M];if(v!==0){const M=this.width/v,z=this.getDashRanges(t,this.width,M);l?this.addRoundDash(z,M,h):this.addRegularDash(z)}const w={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:v};return this.nextRow+=m,this.dirty=!0,w}bind(t){const l=t.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}class ke{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const v=new ke.Actor(h[m],l,this.id);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,l,h){s.asyncAll(this.actors,(m,v)=>{m.send(t,l,v)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function _e(f,t,l){const h=function(m,v){if(m)return l(m);if(v){const w=s.pick(s.extend(v,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(w.vectorLayers=v.vector_layers,w.vectorLayerIds=w.vectorLayers.map(M=>M.id)),l(null,w)}};return f.url?s.getJSON(t.transformRequest(f.url,s.ResourceType.Source),h):s.exported.frame(()=>h(null,f))}ke.Actor=s.Actor;class me{constructor(t,l,h){this.bounds=s.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),h=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*l),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*l),w=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*l);return t.x>=h&&t.x<v&&t.y>=m&&t.y<w}}class Me extends s.Evented{constructor(t,l,h,m){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(l,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_e(this._options,this.map._requestManager,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new s.ErrorEvent(t)):l&&(s.extend(this,l),l.bounds&&(this.tileBounds=new me(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(t,l){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(h,s.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(w,M){return delete t.request,t.aborted?l(null):w&&w.status!==404?l(w):(M&&M.resourceTiming&&(t.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&t.setExpiryData(M),t.loadVectorData(M,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=l:t.request=t.actor.send("reloadTile",m,v.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",m,v.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Re extends s.Evented{constructor(t,l,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},l),s.extend(this,s.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_e(this._options,this.map._requestManager,(t,l)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.ErrorEvent(t)):l&&(s.extend(this,l),l.bounds&&(this.tileBounds=new me(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=s.getImage(this.map._requestManager.transformRequest(h,s.ResourceType.Tile),(m,v,w)=>{if(delete t.request,t.aborted)t.state="unloaded",l(null);else if(m)t.state="errored",l(m);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData(w);const M=this.map.painter.context,z=M.gl;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new Z(M,v,z.RGBA,{useMipmap:!0}),t.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),M.extTextureFilterAnisotropic&&z.texParameterf(z.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax)),t.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l()}unloadTile(t,l){t.texture&&this.map.painter.saveTileTexture(t.texture),l()}hasTransition(){return!1}}let he;class Ee extends Re{constructor(t,l,h,m){super(t,l,h,m),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,l){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function m(v,w){v&&(t.state="errored",l(v)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",l(null))}t.request=s.getImage(this.map._requestManager.transformRequest(h,s.ResourceType.Tile),(function(v,w){if(delete t.request,t.aborted)t.state="unloaded",l(null);else if(v)t.state="errored",l(v);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(w),delete w.cacheControl,delete w.expires;const M=s.isImageBitmap(w)&&(he==null&&(he=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),he)?w:s.exported.getImageData(w,1),z={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:M,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",z,m.bind(this)))}}).bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const l=t.canonical,h=Math.pow(2,l.z),m=(l.x-1+h)%h,v=l.x===0?t.wrap-1:t.wrap,w=(l.x+1+h)%h,M=l.x+1===h?t.wrap+1:t.wrap,z={};return z[new s.OverscaledTileID(t.overscaledZ,v,l.z,m,l.y).key]={backfilled:!1},z[new s.OverscaledTileID(t.overscaledZ,M,l.z,w,l.y).key]={backfilled:!1},l.y>0&&(z[new s.OverscaledTileID(t.overscaledZ,v,l.z,m,l.y-1).key]={backfilled:!1},z[new s.OverscaledTileID(t.overscaledZ,t.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},z[new s.OverscaledTileID(t.overscaledZ,M,l.z,w,l.y-1).key]={backfilled:!1}),l.y+1<h&&(z[new s.OverscaledTileID(t.overscaledZ,v,l.z,m,l.y+1).key]={backfilled:!1},z[new s.OverscaledTileID(t.overscaledZ,t.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},z[new s.OverscaledTileID(t.overscaledZ,M,l.z,w,l.y+1).key]={backfilled:!1}),z}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class ft extends s.Evented{constructor(t,l,h,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(m),this._data=l.data,this._options=s.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const v=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*v,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*v,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.EXTENT,radius:(l.clusterRadius||50)*v,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},l),this}getClusterChildren(t,l){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},l),this}getClusterLeaves(t,l,h,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:l,offset:h},m),this}_updateWorkerData(t){const l=s.extend({},this.workerOptions),h=this._data;typeof h=="string"?(l.request=this.map._requestManager.transformRequest(s.exported.resolveURL(h),s.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(h),this._pendingLoads++,this.fire(new s.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,l,(m,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new s.Event("dataabort",{dataType:"source",sourceDataType:t}));let w=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w=v.resourceTiming[this.id].slice(0)),m)return void this.fire(new s.ErrorEvent(m));const M={dataType:"source",sourceDataType:t};this._collectResourceTiming&&w&&w.length>0&&s.extend(M,{resourceTiming:w}),this.fire(new s.Event("data",M))})}loaded(){return this._pendingLoads===0}loadTile(t,l){const h=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const m={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(h,m,(v,w)=>(delete t.request,t.unloadVectorData(),t.aborted?l(null):v?l(v):(t.loadVectorData(w,this.map.painter,h==="reloadTile"),l(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var nt=s.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Fe extends s.Evented{constructor(t,l,h,m){super(),this.id=t,this.dispatcher=h,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=l}load(t,l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(h,m)=>{this._loaded=!0,h?this.fire(new s.ErrorEvent(h)):m&&(this.image=m,t&&(this.coordinates=t),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const l=t.map(s.MercatorCoordinate.fromLngLat);this.tileID=function(m){let v=1/0,w=1/0,M=-1/0,z=-1/0;for(const G of m)v=Math.min(v,G.x),w=Math.min(w,G.y),M=Math.max(M,G.x),z=Math.max(z,G.y);const P=Math.max(M-v,z-w),R=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),N=Math.pow(2,R);return new s.CanonicalTileID(R,Math.floor((v+M)/2*N),Math.floor((w+z)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z;const h=l.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new s.RasterBoundsArray,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,s.EXTENT,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,s.EXTENT),this._boundsArray.emplaceBack(h[2].x,h[2].y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,l=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Z(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,l){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},l(null)):(t.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Se extends Fe{constructor(t,l,h,m){super(t,l,h,m),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const l of t.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.ResourceType.Source).url);s.getVideo(this.urls,(l,h)=>{this._loaded=!0,l?this.fire(new s.ErrorEvent(l)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const l=this.video.seekable;t<l.start(0)||t>l.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,l=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new Z(t,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class de extends Fe{constructor(t,l,h,m){super(t,l,h,m),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Z(l,this.canvas,h.RGBA,{premultiply:!0});for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Qe={vector:Me,raster:Re,"raster-dem":Ee,geojson:ft,video:Se,image:Fe,canvas:de};function Je(f,t){const l=s.create();return s.translate(l,l,[1,1,0]),s.scale(l,l,[.5*f.width,.5*f.height,1]),s.multiply(l,l,f.calculatePosMatrix(t.toUnwrapped()))}function yt(f,t,l,h,m,v){const w=function(N,G,re){if(N)for(const te of N){const ie=G[te];if(ie&&ie.source===re&&ie.type==="fill-extrusion")return!0}else for(const te in G){const ie=G[te];if(ie.source===re&&ie.type==="fill-extrusion")return!0}return!1}(m&&m.layers,t,f.id),M=v.maxPitchScaleFactor(),z=f.tilesIn(h,M,w);z.sort(mt);const P=[];for(const N of z)P.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,l,f._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,v,M,Je(f.transform,N.tileID))});const R=function(N){const G={},re={};for(const te of N){const ie=te.queryResults,xe=te.wrappedTileID,Te=re[xe]=re[xe]||{};for(const De in ie){const oe=ie[De],Oe=Te[De]=Te[De]||{},Le=G[De]=G[De]||[];for(const We of oe)Oe[We.featureIndex]||(Oe[We.featureIndex]=!0,Le.push(We))}}return G}(P);for(const N in R)R[N].forEach(G=>{const re=G.feature,te=f.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=te});return R}function mt(f,t){const l=f.tileID,h=t.tileID;return l.overscaledZ-h.overscaledZ||l.canonical.y-h.canonical.y||l.wrap-h.wrap||l.canonical.x-h.canonical.x}class Xe{constructor(t,l){this.tileID=t,this.uid=s.uniqueId(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const l=t+this.timeAdded;l<s.exported.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(l=>t.saveTileTexture(l)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,l,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,v){const w={};if(!v)return w;for(const M of m){const z=M.layerIds.map(P=>v.getLayer(P)).filter(Boolean);if(z.length!==0){M.layers=z,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(P=>z.filter(R=>R.id===P)[0]));for(const P of z)w[P.id]=M}}return w}(t.buckets,l.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof s.SymbolBucket){if(this.hasSymbolBuckets=!0,!h)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof s.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,s.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(m).queryRadius(v))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const h in this.buckets){const m=this.buckets[h];m.uploadPending()&&m.upload(t)}const l=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Z(t,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Z(t,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,l,h,m,v,w,M,z,P,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:R,transform:z,params:M,queryPadding:this.queryPadding*P},t,l,h):{}}querySourceFeatures(t,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),v=l?l.sourceLayer:"",w=m._geojsonTileLayer||m[v];if(!w)return;const M=s.createFilter(l&&l.filter),{z,x:P,y:R}=this.tileID.canonical,N={z,x:P,y:R};for(let G=0;G<w.length;G++){const re=w.feature(G);if(M.needGeometry){const xe=s.toEvaluationFeature(re,!0);if(!M.filter(new s.EvaluationParameters(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!M.filter(new s.EvaluationParameters(this.tileID.overscaledZ),re))continue;const te=h.getId(re,v),ie=new s.GeoJSONFeature(re,z,P,R,te);ie.tile=N,t.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const l=this.expirationTime;if(t.cacheControl){const h=s.parseCacheControl(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(l)if(this.expirationTime<l)m=!0;else{const v=this.expirationTime-l;v?this.expirationTime=h+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!l.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",M=h[w],z=t[w];if(!M||!z||Object.keys(z).length===0)continue;v.update(z,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=l&&l.style&&l.style.getLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.exported.now()+t}setDependencies(t,l){const h={};for(const m of l)h[m]=!0;this.dependencies[t]=h}hasDependency(t,l){for(const h of t){const m=this.dependencies[h];if(m){for(const v of l)if(m[v])return!0}}return!1}}class gt{constructor(t,l){this.max=t,this.onRemove=l,this.reset()}reset(){for(const t in this.data)for(const l of this.data[t])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(t,l,h){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:l,timeout:void 0};if(h!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},h)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const l=this.data[t].shift();return l.timeout&&clearTimeout(l.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),l.value}getByKey(t){const l=this.data[t];return l?l[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,l){if(!this.has(t))return this;const h=t.wrapped().key,m=l===void 0?0:this.data[h].indexOf(l),v=this.data[h][m];return this.data[h].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(v.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(t){const l=[];for(const h in this.data)for(const m of this.data[h])t(m.value)||l.push(m);for(const h of l)this.remove(h.value.tileID,h)}}class ze{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,l,h){const m=String(l);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},s.extend(this.stateChanges[t][m],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==m&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const v in this.state[t][m])h[v]||(this.deletedStates[t][m][v]=null)}else for(const v in h)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][v]===null&&delete this.deletedStates[t][m][v]}removeFeatureState(t,l,h){if(this.deletedStates[t]===null)return;const m=String(l);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&l!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][h]=null);else if(l!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(h in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][h]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,l){const h=String(l),m=s.extend({},(this.state[t]||{})[h],(this.stateChanges[t]||{})[h]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const v=this.deletedStates[t][l];if(v===null)return{};for(const w in v)delete m[w]}return m}initializeTileState(t,l){t.setFeatureState(this.state,l)}coalesceChanges(t,l){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const w in this.stateChanges[m])this.state[m][w]||(this.state[m][w]={}),s.extend(this.state[m][w],this.stateChanges[m][w]),v[w]=this.state[m][w];h[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const w in this.state[m])v[w]={},this.state[m][w]={};else for(const w in this.deletedStates[m]){if(this.deletedStates[m][w]===null)this.state[m][w]={};else for(const M of Object.keys(this.deletedStates[m][w]))delete this.state[m][w][M];v[w]=this.state[m][w]}h[m]=h[m]||{},s.extend(h[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const m in t)t[m].setFeatureState(h,l)}}class Pe extends s.Evented{constructor(t,l,h){super(),this.id=t,this.dispatcher=h,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(m,v,w,M){const z=new Qe[v.type](m,v,w,M);if(z.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${z.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],z),z}(t,l,h,this),this._tiles={},this._cache=new gt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ze}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const l=this._tiles[t];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,l){return this._source.loadTile(t,l)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(t),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ve).map(t=>t.key)}getRenderableIds(t){const l=[];for(const h in this._tiles)this._isIdRenderable(h,t)&&l.push(this._tiles[h]);return t?l.sort((h,m)=>{const v=h.tileID,w=m.tileID,M=new s.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),z=new s.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-w.overscaledZ||z.y-M.y||z.x-M.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(Ve).map(h=>h.key)}hasRenderableParent(t){const l=this.findLoadedParent(t,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(t,l){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(l||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,l){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,t,l)))}_tileLoaded(t,l,h,m){if(m)return t.state="errored",void(m.status!==404?this._source.fire(new s.ErrorEvent(m,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.exported.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(l,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const l=this.getRenderableIds();for(let m=0;m<l.length;m++){const v=l[m];if(t.neighboringTiles&&t.neighboringTiles[v]){const w=this.getTileByID(v);h(t,w),h(w,t)}}function h(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let w=v.tileID.canonical.x-m.tileID.canonical.x;const M=v.tileID.canonical.y-m.tileID.canonical.y,z=Math.pow(2,m.tileID.canonical.z),P=v.tileID.key;w===0&&M===0||Math.abs(M)>1||(Math.abs(w)>1&&(Math.abs(w+z)===1?w+=z:Math.abs(w-z)===1&&(w-=z)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,w,M),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,l,h,m){for(const v in this._tiles){let w=this._tiles[v];if(m[v]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>h)continue;let M=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const P=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[P.key],w&&w.hasData()&&(M=P)}let z=M;for(;z.overscaledZ>l;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){m[M.key]=M;break}}}findLoadedParent(t,l){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=t.overscaledZ-1;h>=l;h--){const m=t.scaledTo(h),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(t){const l=this._tiles[t.key];return l&&l.hasData()?l:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const l=Math.ceil(t.width/this._source.tileSize)+1,h=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(l*h*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(t){const l=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,l){const h={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),h[v.tileID.key]=v}this._tiles=h;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(t,l){if(this.transform=t,this.terrain=l,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new s.OverscaledTileID(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(h=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l}),this._source.hasTile&&(h=h.filter(P=>this._source.hasTile(P)))):h=[];const m=t.coveringZoomLevel(this._source),v=Math.max(m-Pe.maxOverzooming,this._source.minzoom),w=Math.max(m+Pe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const R of h)if(R.canonical.z>this._source.minzoom){const N=R.scaledTo(R.canonical.z-1);P[N.key]=N;const G=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));P[G.key]=G}h=h.concat(Object.values(P))}const M=this._updateRetainedTiles(h,m);if(vt(this._source.type)){const P={},R={},N=Object.keys(M);for(const G of N){const re=M[G],te=this._tiles[G];if(!te||te.fadeEndTime&&te.fadeEndTime<=s.exported.now())continue;const ie=this.findLoadedParent(re,v);ie&&(this._addTile(ie.tileID),P[ie.tileID.key]=ie.tileID),R[G]=re}this._retainLoadedChildren(R,m,w,M);for(const G in P)M[G]||(this._coveredTiles[G]=!0,M[G]=P[G]);if(l){const G={},re={};for(const te of h)this._tiles[te.key].hasData()?G[te.key]=te:re[te.key]=te;for(const te in re){const ie=re[te].children(this._source.maxzoom);this._tiles[ie[0].key]&&this._tiles[ie[1].key]&&this._tiles[ie[2].key]&&this._tiles[ie[3].key]&&(G[ie[0].key]=M[ie[0].key]=ie[0],G[ie[1].key]=M[ie[1].key]=ie[1],G[ie[2].key]=M[ie[2].key]=ie[2],G[ie[3].key]=M[ie[3].key]=ie[3],delete re[te])}for(const te in re){const ie=this.findLoadedParent(re[te],this._source.minzoom);if(ie){G[ie.tileID.key]=M[ie.tileID.key]=ie.tileID;for(const xe in G)G[xe].isChildOf(ie.tileID)&&delete G[xe]}}for(const te in this._tiles)G[te]||(this._coveredTiles[te]=!0)}}for(const P in M)this._tiles[P].clearFadeHold();const z=s.keysDifference(this._tiles,M);for(const P of z){const R=this._tiles[P];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,l){const h={},m={},v=Math.max(l-Pe.maxOverzooming,this._source.minzoom),w=Math.max(l+Pe.maxUnderzooming,this._source.minzoom),M={};for(const z of t){const P=this._addTile(z);h[z.key]=z,P.hasData()||l<this._source.maxzoom&&(M[z.key]=z)}this._retainLoadedChildren(M,l,w,h);for(const z of t){let P=this._tiles[z.key];if(P.hasData())continue;if(l+1>this._source.maxzoom){const N=z.children(this._source.maxzoom)[0],G=this.getTile(N);if(G&&G.hasData()){h[N.key]=N;continue}}else{const N=z.children(this._source.maxzoom);if(h[N[0].key]&&h[N[1].key]&&h[N[2].key]&&h[N[3].key])continue}let R=P.wasRequested();for(let N=z.overscaledZ-1;N>=v;--N){const G=z.scaledTo(N);if(m[G.key]||(m[G.key]=!0,P=this.getTile(G),!P&&R&&(P=this._addTile(G)),P&&(h[G.key]=G,R=P.wasRequested(),P.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const l=[];let h,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}l.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(v),h)break;m=v}for(const v of l)this._loadedParentTiles[v]=h}}_addTile(t){let l=this._tiles[t.key];if(l)return l;l=this._cache.getAndRemove(t),l&&(this._setTileReloadTimer(t.key,l),l.tileID=t,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,l)));const h=l;return l||(l=new Xe(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(l,this._tileLoaded.bind(this,l,t.key,l.state))),l.uses++,this._tiles[t.key]=l,h||this._source.fire(new s.Event("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(t,l){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=l.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const l=this._tiles[t];l&&(l.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,l,h){const m=[],v=this.transform;if(!v)return m;const w=h?v.getCameraQueryGeometry(t):t,M=t.map(te=>v.pointCoordinate(te,this.terrain)),z=w.map(te=>v.pointCoordinate(te,this.terrain)),P=this.getIds();let R=1/0,N=1/0,G=-1/0,re=-1/0;for(const te of z)R=Math.min(R,te.x),N=Math.min(N,te.y),G=Math.max(G,te.x),re=Math.max(re,te.y);for(let te=0;te<P.length;te++){const ie=this._tiles[P[te]];if(ie.holdingForFade())continue;const xe=ie.tileID,Te=Math.pow(2,v.zoom-ie.tileID.overscaledZ),De=l*ie.queryPadding*s.EXTENT/ie.tileSize/Te,oe=[xe.getTilePoint(new s.MercatorCoordinate(R,N)),xe.getTilePoint(new s.MercatorCoordinate(G,re))];if(oe[0].x-De<s.EXTENT&&oe[0].y-De<s.EXTENT&&oe[1].x+De>=0&&oe[1].y+De>=0){const Oe=M.map(We=>xe.getTilePoint(We)),Le=z.map(We=>xe.getTilePoint(We));m.push({tile:ie,tileID:xe,queryGeometry:Oe,cameraQueryGeometry:Le,scale:Te})}}return m}getVisibleCoordinates(t){const l=this.getRenderableIds(t).map(h=>this._tiles[h].tileID);for(const h of l)h.posMatrix=this.transform.calculatePosMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(vt(this._source.type))for(const t in this._tiles){const l=this._tiles[t];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=s.exported.now())return!0}return!1}setFeatureState(t,l,h){this._state.updateState(t=t||"_geojsonTileLayer",l,h)}removeFeatureState(t,l,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",l,h)}getFeatureState(t,l){return this._state.getState(t=t||"_geojsonTileLayer",l)}setDependencies(t,l,h){const m=this._tiles[t];m&&m.setDependencies(l,h)}reloadTilesForDependencies(t,l){for(const h in this._tiles)this._tiles[h].hasDependency(t,l)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(t,l))}}function Ve(f,t){const l=Math.abs(2*f.wrap)-+(f.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||h-l||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function vt(f){return f==="raster"||f==="image"||f==="video"}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;const fi="mapboxgl_preloaded_worker_pool";class tt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<tt.workerCount;)this.workers.push(new Worker(ra.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fi]}numActive(){return Object.keys(this.active).length}}const lt=Math.floor(s.exported.hardwareConcurrency/2);let li;function ln(){return li||(li=new tt),li}function ei(f,t){const l={};for(const h in f)h!=="ref"&&(l[h]=f[h]);return s.refProperties.forEach(h=>{h in t&&(l[h]=t[h])}),l}function dn(f){f=f.slice();const t=Object.create(null);for(let l=0;l<f.length;l++)t[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=ei(f[l],t[f[l].ref]));return f}tt.workerCount=Math.max(Math.min(lt,6),1);const $e={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ot(f,t,l){l.push({command:$e.addSource,args:[f,t[f]]})}function tn(f,t,l){t.push({command:$e.removeSource,args:[f]}),l[f]=!0}function Vn(f,t,l,h){tn(f,l,h),ot(f,t,l)}function Va(f,t,l){let h;for(h in f[l])if(Object.prototype.hasOwnProperty.call(f[l],h)&&h!=="data"&&!A(f[l][h],t[l][h]))return!1;for(h in t[l])if(Object.prototype.hasOwnProperty.call(t[l],h)&&h!=="data"&&!A(f[l][h],t[l][h]))return!1;return!0}function wr(f,t,l,h,m,v){let w;for(w in t=t||{},f=f||{})Object.prototype.hasOwnProperty.call(f,w)&&(A(f[w],t[w])||l.push({command:v,args:[h,w,t[w],m]}));for(w in t)Object.prototype.hasOwnProperty.call(t,w)&&!Object.prototype.hasOwnProperty.call(f,w)&&(A(f[w],t[w])||l.push({command:v,args:[h,w,t[w],m]}))}function Ir(f){return f.id}function ga(f,t){return f[t.id]=t,f}class kr{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.clamp(t,0,1);let l=1,h=this._distances[l];const m=t*this.paddedLength+this.padding;for(;h<m&&l<this._distances.length;)h=this._distances[++l];const v=l-1,w=this._distances[v],M=h-w,z=M>0?(m-w)/M:0;return this.points[v].mult(1-z).add(this.points[l].mult(z))}}function Ke(f,t){let l=!0;return f==="always"||f!=="never"&&t!=="never"||(l=!1),l}class It{constructor(t,l,h){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(l/h);for(let w=0;w<this.xCellCount*this.yCellCount;w++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,h,m,v){this._forEachCell(l,h,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(t,l,h,m){this._forEachCell(l-m,h-m,l+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,l,h,m,v,w){this.boxCells[v].push(w)}_insertCircleCell(t,l,h,m,v,w){this.circleCells[v].push(w)}_query(t,l,h,m,v,w,M){if(h<0||t>this.width||m<0||l>this.height)return[];const z=[];if(t<=0&&l<=0&&this.width<=h&&this.height<=m){if(v)return[{key:null,x1:t,y1:l,x2:h,y2:m}];for(let P=0;P<this.boxKeys.length;P++)z.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const R=this.circles[3*P],N=this.circles[3*P+1],G=this.circles[3*P+2];z.push({key:this.circleKeys[P],x1:R-G,y1:N-G,x2:R+G,y2:N+G})}}else this._forEachCell(t,l,h,m,this._queryCell,z,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},M);return z}query(t,l,h,m){return this._query(t,l,h,m,!1,null)}hitTest(t,l,h,m,v,w){return this._query(t,l,h,m,!0,v,w).length>0}hitTestCircle(t,l,h,m,v){const w=t-h,M=t+h,z=l-h,P=l+h;if(M<0||w>this.width||P<0||z>this.height)return!1;const R=[];return this._forEachCell(w,z,M,P,this._queryCellCircle,R,{hitTest:!0,overlapMode:m,circle:{x:t,y:l,radius:h},seenUids:{box:{},circle:{}}},v),R.length>0}_queryCell(t,l,h,m,v,w,M,z){const{seenUids:P,hitTest:R,overlapMode:N}=M,G=this.boxCells[v];if(G!==null){const te=this.bboxes;for(const ie of G)if(!P.box[ie]){P.box[ie]=!0;const xe=4*ie,Te=this.boxKeys[ie];if(t<=te[xe+2]&&l<=te[xe+3]&&h>=te[xe+0]&&m>=te[xe+1]&&(!z||z(Te))&&(!R||!Ke(N,Te.overlapMode))&&(w.push({key:Te,x1:te[xe],y1:te[xe+1],x2:te[xe+2],y2:te[xe+3]}),R))return!0}}const re=this.circleCells[v];if(re!==null){const te=this.circles;for(const ie of re)if(!P.circle[ie]){P.circle[ie]=!0;const xe=3*ie,Te=this.circleKeys[ie];if(this._circleAndRectCollide(te[xe],te[xe+1],te[xe+2],t,l,h,m)&&(!z||z(Te))&&(!R||!Ke(N,Te.overlapMode))){const De=te[xe],oe=te[xe+1],Oe=te[xe+2];if(w.push({key:Te,x1:De-Oe,y1:oe-Oe,x2:De+Oe,y2:oe+Oe}),R)return!0}}}return!1}_queryCellCircle(t,l,h,m,v,w,M,z){const{circle:P,seenUids:R,overlapMode:N}=M,G=this.boxCells[v];if(G!==null){const te=this.bboxes;for(const ie of G)if(!R.box[ie]){R.box[ie]=!0;const xe=4*ie,Te=this.boxKeys[ie];if(this._circleAndRectCollide(P.x,P.y,P.radius,te[xe+0],te[xe+1],te[xe+2],te[xe+3])&&(!z||z(Te))&&!Ke(N,Te.overlapMode))return w.push(!0),!0}}const re=this.circleCells[v];if(re!==null){const te=this.circles;for(const ie of re)if(!R.circle[ie]){R.circle[ie]=!0;const xe=3*ie,Te=this.circleKeys[ie];if(this._circlesCollide(te[xe],te[xe+1],te[xe+2],P.x,P.y,P.radius)&&(!z||z(Te))&&!Ke(N,Te.overlapMode))return w.push(!0),!0}}}_forEachCell(t,l,h,m,v,w,M,z){const P=this._convertToXCellCoord(t),R=this._convertToYCellCoord(l),N=this._convertToXCellCoord(h),G=this._convertToYCellCoord(m);for(let re=P;re<=N;re++)for(let te=R;te<=G;te++)if(v.call(this,t,l,h,m,this.xCellCount*te+re,w,M,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,h,m,v,w){const M=m-t,z=v-l,P=h+w;return P*P>M*M+z*z}_circleAndRectCollide(t,l,h,m,v,w,M){const z=(w-m)/2,P=Math.abs(t-(m+z));if(P>z+h)return!1;const R=(M-v)/2,N=Math.abs(l-(v+R));if(N>R+h)return!1;if(P<=z||N<=R)return!0;const G=P-z,re=N-R;return G*G+re*re<=h*h}}function Yr(f,t,l,h,m){const v=s.create();return t?(s.scale(v,v,[1/m,1/m,1]),l||s.rotateZ(v,v,h.angle)):s.multiply(v,h.labelPlaneMatrix,f),v}function nr(f,t,l,h,m){if(t){const v=s.clone(f);return s.scale(v,v,[m,m,1]),l||s.rotateZ(v,v,-h.angle),v}return h.glCoordMatrix}function wi(f,t,l){let h;l?(h=[f.x,f.y,l(f.x,f.y),1],s.transformMat4(h,h,t)):(h=[f.x,f.y,0,1],Tr(h,h,t));const m=h[3];return{point:new s.pointGeometry(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function Jn(f,t){return .5+f/t*.5}function Nn(f,t){const l=f[0]/f[3],h=f[1]/f[3];return l>=-t[0]&&l<=t[0]&&h>=-t[1]&&h<=t[1]}function Un(f,t,l,h,m,v,w,M,z,P){const R=h?f.textSizeData:f.iconSizeData,N=s.evaluateSizeForZoom(R,l.transform.zoom),G=[256/l.width*2+1,256/l.height*2+1],re=h?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;re.clear();const te=f.lineVertexArray,ie=h?f.text.placedSymbolArray:f.icon.placedSymbolArray,xe=l.transform.width/l.transform.height;let Te=!1;for(let De=0;De<ie.length;De++){const oe=ie.get(De);if(oe.hidden||oe.writingMode===s.WritingMode.vertical&&!Te){ii(oe.numGlyphs,re);continue}let Oe;if(Te=!1,P?(Oe=[oe.anchorX,oe.anchorY,P(oe.anchorX,oe.anchorY),1],s.transformMat4(Oe,Oe,t)):(Oe=[oe.anchorX,oe.anchorY,0,1],Tr(Oe,Oe,t)),!Nn(Oe,G)){ii(oe.numGlyphs,re);continue}const Le=Jn(l.transform.cameraToCenterDistance,Oe[3]),We=s.evaluateSizeForFeature(R,N,oe),He=w?We/Le:We*Le,dt=new s.pointGeometry(oe.anchorX,oe.anchorY),Ge=wi(dt,m,P).point,Ct={},xt=ci(oe,He,!1,M,t,m,v,f.glyphOffsetArray,te,re,Ge,dt,Ct,xe,z,P);Te=xt.useVertical,(xt.notEnoughRoom||Te||xt.needsFlipping&&ci(oe,He,!0,M,t,m,v,f.glyphOffsetArray,te,re,Ge,dt,Ct,xe,z,P).notEnoughRoom)&&ii(oe.numGlyphs,re)}h?f.text.dynamicLayoutVertexBuffer.updateData(re):f.icon.dynamicLayoutVertexBuffer.updateData(re)}function Or(f,t,l,h,m,v,w,M,z,P,R,N,G){const re=M.glyphStartIndex+M.numGlyphs,te=M.lineStartIndex,ie=M.lineStartIndex+M.lineLength,xe=t.getoffsetX(M.glyphStartIndex),Te=t.getoffsetX(re-1),De=bn(f*xe,l,h,m,v,w,M.segment,te,ie,z,P,R,N,G);if(!De)return null;const oe=bn(f*Te,l,h,m,v,w,M.segment,te,ie,z,P,R,N,G);return oe?{first:De,last:oe}:null}function bt(f,t,l,h){return f===s.WritingMode.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*h?{useVertical:!0}:(f===s.WritingMode.vertical?t.y<l.y:t.x>l.x)?{needsFlipping:!0}:null}function ci(f,t,l,h,m,v,w,M,z,P,R,N,G,re,te,ie){const xe=t/24,Te=f.lineOffsetX*xe,De=f.lineOffsetY*xe;let oe;if(f.numGlyphs>1){const Oe=f.glyphStartIndex+f.numGlyphs,Le=f.lineStartIndex,We=f.lineStartIndex+f.lineLength,He=Or(xe,M,Te,De,l,R,N,f,z,v,G,te,ie);if(!He)return{notEnoughRoom:!0};const dt=wi(He.first.point,w,ie).point,Ge=wi(He.last.point,w,ie).point;if(h&&!l){const Ct=bt(f.writingMode,dt,Ge,re);if(Ct)return Ct}oe=[He.first];for(let Ct=f.glyphStartIndex+1;Ct<Oe-1;Ct++)oe.push(bn(xe*M.getoffsetX(Ct),Te,De,l,R,N,f.segment,Le,We,z,v,G,te,ie));oe.push(He.last)}else{if(h&&!l){const Le=wi(N,m,ie).point,We=f.lineStartIndex+f.segment+1,He=new s.pointGeometry(z.getx(We),z.gety(We)),dt=wi(He,m,ie),Ge=dt.signedDistanceFromCamera>0?dt.point:ri(N,He,Le,1,m,ie),Ct=bt(f.writingMode,Le,Ge,re);if(Ct)return Ct}const Oe=bn(xe*M.getoffsetX(f.glyphStartIndex),Te,De,l,R,N,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,z,v,G,te,ie);if(!Oe)return{notEnoughRoom:!0};oe=[Oe]}for(const Oe of oe)s.addDynamicAttributes(P,Oe.point,Oe.angle);return{}}function ri(f,t,l,h,m,v){const w=wi(f.add(f.sub(t)._unit()),m,v).point,M=l.sub(w);return l.add(M._mult(h/M.mag()))}function bn(f,t,l,h,m,v,w,M,z,P,R,N,G,re){const te=h?f-t:f+t;let ie=te>0?1:-1,xe=0;h&&(ie*=-1,xe=Math.PI),ie<0&&(xe+=Math.PI);let Te=ie>0?M+w:M+w+1,De=m,oe=m,Oe=0,Le=0;const We=Math.abs(te),He=[];for(;Oe+Le<=We;){if(Te+=ie,Te<M||Te>=z)return null;if(oe=De,He.push(De),De=N[Te],De===void 0){const zt=new s.pointGeometry(P.getx(Te),P.gety(Te)),ai=wi(zt,R,re);if(ai.signedDistanceFromCamera>0)De=N[Te]=ai.point;else{const hi=Te-ie;De=ri(Oe===0?v:new s.pointGeometry(P.getx(hi),P.gety(hi)),zt,oe,We-Oe+1,R,re)}}Oe+=Le,Le=oe.dist(De)}const dt=(We-Oe)/Le,Ge=De.sub(oe),Ct=Ge.mult(dt)._add(oe);Ct._add(Ge._unit()._perp()._mult(l*ie));const xt=xe+Math.atan2(De.y-oe.y,De.x-oe.x);return He.push(Ct),{point:Ct,angle:G?xt:0,path:He}}const Vr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ii(f,t){for(let l=0;l<f;l++){const h=t.length;t.resize(h+4),t.float32.set(Vr,3*h)}}function Tr(f,t,l){const h=t[0],m=t[1];return f[0]=l[0]*h+l[4]*m+l[12],f[1]=l[1]*h+l[5]*m+l[13],f[3]=l[3]*h+l[7]*m+l[15],f}const fn=100;class _a{constructor(t,l=new It(t.width+200,t.height+200,25),h=new It(t.width+200,t.height+200,25)){this.transform=t,this.grid=l,this.ignoredGrid=h,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+fn,this.screenBottomBoundary=t.height+fn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,l,h,m,v,w){const M=this.projectAndGetPerspectiveRatio(m,t.anchorPointX,t.anchorPointY,w),z=h*M.perspectiveRatio,P=t.x1*z+M.point.x,R=t.y1*z+M.point.y,N=t.x2*z+M.point.x,G=t.y2*z+M.point.y;return!this.isInsideGrid(P,R,N,G)||l!=="always"&&this.grid.hitTest(P,R,N,G,l,v)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[P,R,N,G],offscreen:this.isOffscreen(P,R,N,G)}}placeCollisionCircles(t,l,h,m,v,w,M,z,P,R,N,G,re,te){const ie=[],xe=new s.pointGeometry(l.anchorX,l.anchorY),Te=wi(xe,w,te),De=Jn(this.transform.cameraToCenterDistance,Te.signedDistanceFromCamera),oe=(R?v/De:v*De)/s.ONE_EM,Oe=wi(xe,M,te).point,Le=Or(oe,m,l.lineOffsetX*oe,l.lineOffsetY*oe,!1,Oe,xe,l,h,M,{},!1,te);let We=!1,He=!1,dt=!0;if(Le){const Ge=.5*G*De+re,Ct=new s.pointGeometry(-100,-100),xt=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),zt=new kr,ai=Le.first,hi=Le.last;let jt=[];for(let yi=ai.path.length-1;yi>=1;yi--)jt.push(ai.path[yi]);for(let yi=1;yi<hi.path.length;yi++)jt.push(hi.path[yi]);const zi=2.5*Ge;if(z){const yi=jt.map(Ti=>wi(Ti,z,te));jt=yi.some(Ti=>Ti.signedDistanceFromCamera<=0)?[]:yi.map(Ti=>Ti.point)}let Di=[];if(jt.length>0){const yi=jt[0].clone(),Ti=jt[0].clone();for(let Li=1;Li<jt.length;Li++)yi.x=Math.min(yi.x,jt[Li].x),yi.y=Math.min(yi.y,jt[Li].y),Ti.x=Math.max(Ti.x,jt[Li].x),Ti.y=Math.max(Ti.y,jt[Li].y);Di=yi.x>=Ct.x&&Ti.x<=xt.x&&yi.y>=Ct.y&&Ti.y<=xt.y?[jt]:Ti.x<Ct.x||yi.x>xt.x||Ti.y<Ct.y||yi.y>xt.y?[]:s.clipLine([jt],Ct.x,Ct.y,xt.x,xt.y)}for(const yi of Di){zt.reset(yi,.25*Ge);let Ti=0;Ti=zt.length<=.5*Ge?1:Math.ceil(zt.paddedLength/zi)+1;for(let Li=0;Li<Ti;Li++){const mn=Li/Math.max(Ti-1,1),gr=zt.lerp(mn),ar=gr.x+fn,_r=gr.y+fn;ie.push(ar,_r,Ge,0);const Xr=ar-Ge,$n=_r-Ge,Bn=ar+Ge,Sr=_r+Ge;if(dt=dt&&this.isOffscreen(Xr,$n,Bn,Sr),He=He||this.isInsideGrid(Xr,$n,Bn,Sr),t!=="always"&&this.grid.hitTestCircle(ar,_r,Ge,t,N)&&(We=!0,!P))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!P&&We||!He||De<this.perspectiveRatioCutoff?[]:ie,offscreen:dt,collisionDetected:We}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let h=1/0,m=1/0,v=-1/0,w=-1/0;for(const R of t){const N=new s.pointGeometry(R.x+fn,R.y+fn);h=Math.min(h,N.x),m=Math.min(m,N.y),v=Math.max(v,N.x),w=Math.max(w,N.y),l.push(N)}const M=this.grid.query(h,m,v,w).concat(this.ignoredGrid.query(h,m,v,w)),z={},P={};for(const R of M){const N=R.key;if(z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]={}),z[N.bucketInstanceId][N.featureIndex])continue;const G=[new s.pointGeometry(R.x1,R.y1),new s.pointGeometry(R.x2,R.y1),new s.pointGeometry(R.x2,R.y2),new s.pointGeometry(R.x1,R.y2)];s.polygonIntersectsPolygon(l,G)&&(z[N.bucketInstanceId][N.featureIndex]=!0,P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]=[]),P[N.bucketInstanceId].push(N.featureIndex))}return P}insertCollisionBox(t,l,h,m,v,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:w,overlapMode:l},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,h,m,v,w){const M=h?this.ignoredGrid:this.grid,z={bucketInstanceId:m,featureIndex:v,collisionGroupID:w,overlapMode:l};for(let P=0;P<t.length;P+=4)M.insertCircle(z,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,l,h,m){let v;return m?(v=[l,h,m(l,h),1],s.transformMat4(v,v,t)):(v=[l,h,0,1],Tr(v,v,t)),{point:new s.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+fn,(-v[1]/v[3]+1)/2*this.transform.height+fn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(t,l,h,m){return h<fn||t>=this.screenRightBoundary||m<fn||l>this.screenBottomBoundary}isInsideGrid(t,l,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=s.identity([]);return s.translate(t,t,[-100,-100,0]),t}}function rn(f,t,l){return t*(s.EXTENT/(f.tileSize*Math.pow(2,l-f.tileID.overscaledZ)))}class Sn{constructor(t,l,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Pi{constructor(t,l,h,m,v){this.text=new Sn(t?t.text:null,l,h,v),this.icon=new Sn(t?t.icon:null,l,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ya{constructor(t,l,h){this.text=t,this.icon=l,this.skipFade=h}}class fr{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Jr{constructor(t,l,h,m,v){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=v}}class Qr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:h=>h.collisionGroupID===l}}return this.collisionGroups[t]}}function va(f,t,l,h,m){const{horizontalAlign:v,verticalAlign:w}=s.getAnchorAlignment(f),M=-(v-.5)*t,z=-(w-.5)*l,P=s.evaluateVariableOffset(f,h);return new s.pointGeometry(M+P[0]*m,z+P[1]*m)}function $r(f,t,l,h,m,v){const{x1:w,x2:M,y1:z,y2:P,anchorPointX:R,anchorPointY:N}=f,G=new s.pointGeometry(t,l);return h&&G._rotate(m?v:-v),{x1:w+G.x,y1:z+G.y,x2:M+G.x,y2:P+G.y,anchorPointX:R,anchorPointY:N}}class ${constructor(t,l,h,m,v){this.transform=t.clone(),this.terrain=l,this.collisionIndex=new _a(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Qr(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,l,h,m){const v=h.getBucket(l),w=h.latestFeatureIndex;if(!v||!w||l.id!==v.layerIds[0])return;const M=h.collisionBoxArray,z=v.layers[0].layout,P=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),R=h.tileSize/s.EXTENT,N=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),G=z.get("text-pitch-alignment")==="map",re=z.get("text-rotation-alignment")==="map",te=rn(h,1,this.transform.zoom),ie=Yr(N,G,re,this.transform,te);let xe=null;if(G){const De=nr(N,G,re,this.transform,te);xe=s.multiply([],this.transform.labelPlaneMatrix,De)}this.retainedQueryData[v.bucketInstanceId]=new Jr(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,h.tileID);const Te={bucket:v,layout:z,posMatrix:N,textLabelPlaneMatrix:ie,labelToScreenMatrix:xe,scale:P,textPixelRatio:R,holdingForFade:h.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const De of v.sortKeyRanges){const{sortKey:oe,symbolInstanceStart:Oe,symbolInstanceEnd:Le}=De;t.push({sortKey:oe,symbolInstanceStart:Oe,symbolInstanceEnd:Le,parameters:Te})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Te})}attemptAnchorPlacement(t,l,h,m,v,w,M,z,P,R,N,G,re,te,ie,xe){const Te=[G.textOffset0,G.textOffset1],De=va(t,h,m,Te,v),oe=this.collisionIndex.placeCollisionBox($r(l,De.x,De.y,w,M,this.transform.angle),N,z,P,R.predicate,xe);if((!ie||this.collisionIndex.placeCollisionBox($r(ie,De.x,De.y,w,M,this.transform.angle),N,z,P,R.predicate,xe).box.length!==0)&&oe.box.length>0){let Oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:Te,width:h,height:m,anchor:t,textBoxScale:v,prevAnchor:Oe},this.markUsedJustification(re,t,G,te),re.allowVerticalPlacement&&(this.markUsedOrientation(re,te,G),this.placedOrientations[G.crossTileID]=te),{shift:De,placedGlyphBoxes:oe}}}placeLayerBucketPart(t,l,h){const{bucket:m,layout:v,posMatrix:w,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:P,holdingForFade:R,collisionBoxArray:N,partiallyEvaluatedTextSize:G,collisionGroup:re}=t.parameters,te=v.get("text-optional"),ie=v.get("icon-optional"),xe=s.getOverlapMode(v,"text-overlap","text-allow-overlap"),Te=xe==="always",De=s.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),oe=De==="always",Oe=v.get("text-rotation-alignment")==="map",Le=v.get("text-pitch-alignment")==="map",We=v.get("icon-text-fit")!=="none",He=v.get("symbol-z-order")==="viewport-y",dt=Te&&(oe||!m.hasIconData()||ie),Ge=oe&&(Te||!m.hasTextData()||te);!m.collisionArrays&&N&&m.deserializeCollisionBoxes(N);const Ct=(xt,zt)=>{if(l[xt.crossTileID])return;if(R)return void(this.placements[xt.crossTileID]=new ya(!1,!1,!1));let ai=!1,hi=!1,jt=!0,zi=null,Di={box:null,offscreen:null},yi={box:null,offscreen:null},Ti=null,Li=null,mn=null,gr=0,ar=0,_r=0;zt.textFeatureIndex?gr=zt.textFeatureIndex:xt.useRuntimeCollisionCircles&&(gr=xt.featureIndex),zt.verticalTextFeatureIndex&&(ar=zt.verticalTextFeatureIndex);const Xr=this.retainedQueryData[m.bucketInstanceId].tileID,$n=this.terrain?(cn,pi)=>this.terrain.getElevation(Xr,cn,pi):null;for(const cn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const pi=zt[cn];pi&&(pi.elevation=$n?$n(pi.anchorPointX,pi.anchorPointY):0)}const Bn=zt.textBox;if(Bn){const cn=Mi=>{let gn=s.WritingMode.horizontal;if(m.allowVerticalPlacement&&!Mi&&this.prevPlacement){const _n=this.prevPlacement.placedOrientations[xt.crossTileID];_n&&(this.placedOrientations[xt.crossTileID]=_n,gn=_n,this.markUsedOrientation(m,gn,xt))}return gn},pi=(Mi,gn)=>{if(m.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&zt.verticalTextBox){for(const _n of m.writingModes)if(_n===s.WritingMode.vertical?(Di=gn(),yi=Di):Di=Mi(),Di&&Di.box&&Di.box.length)break}else Di=Mi()};if(v.get("text-variable-anchor")){let Mi=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xt.crossTileID]){const Wi=this.prevPlacement.variableOffsets[xt.crossTileID];Mi.indexOf(Wi.anchor)>0&&(Mi=Mi.filter(er=>er!==Wi.anchor),Mi.unshift(Wi.anchor))}const gn=(Wi,er,aa)=>{const Bo=Wi.x2-Wi.x1,Da=Wi.y2-Wi.y1,$l=xt.textBoxScale,Ro=We&&De==="never"?er:null;let Wr={box:[],offscreen:!1};const sa=xe!=="never"?2*Mi.length:Mi.length;for(let oa=0;oa<sa;++oa){const Os=this.attemptAnchorPlacement(Mi[oa%Mi.length],Wi,Bo,Da,$l,Oe,Le,P,w,re,oa>=Mi.length?xe:"never",xt,m,aa,Ro,$n);if(Os&&(Wr=Os.placedGlyphBoxes,Wr&&Wr.box&&Wr.box.length)){ai=!0,zi=Os.shift;break}}return Wr};pi(()=>gn(Bn,zt.iconBox,s.WritingMode.horizontal),()=>{const Wi=zt.verticalTextBox;return m.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&xt.numVerticalGlyphVertices>0&&Wi?gn(Wi,zt.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),Di&&(ai=Di.box,jt=Di.offscreen);const _n=cn(Di&&Di.box);if(!ai&&this.prevPlacement){const Wi=this.prevPlacement.variableOffsets[xt.crossTileID];Wi&&(this.variableOffsets[xt.crossTileID]=Wi,this.markUsedJustification(m,Wi.anchor,xt,_n))}}else{const Mi=(gn,_n)=>{const Wi=this.collisionIndex.placeCollisionBox(gn,xe,P,w,re.predicate,$n);return Wi&&Wi.box&&Wi.box.length&&(this.markUsedOrientation(m,_n,xt),this.placedOrientations[xt.crossTileID]=_n),Wi};pi(()=>Mi(Bn,s.WritingMode.horizontal),()=>{const gn=zt.verticalTextBox;return m.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&gn?Mi(gn,s.WritingMode.vertical):{box:null,offscreen:null}}),cn(Di&&Di.box&&Di.box.length)}}if(Ti=Di,ai=Ti&&Ti.box&&Ti.box.length>0,jt=Ti&&Ti.offscreen,xt.useRuntimeCollisionCircles){const cn=m.text.placedSymbolArray.get(xt.centerJustifiedTextSymbolIndex),pi=s.evaluateSizeForFeature(m.textSizeData,G,cn),Mi=v.get("text-padding");Li=this.collisionIndex.placeCollisionCircles(xe,cn,m.lineVertexArray,m.glyphOffsetArray,pi,w,M,z,h,Le,re.predicate,xt.collisionCircleDiameter,Mi,$n),Li.circles.length&&Li.collisionDetected&&!h&&s.warnOnce("Collisions detected, but collision boxes are not shown"),ai=Te||Li.circles.length>0&&!Li.collisionDetected,jt=jt&&Li.offscreen}if(zt.iconFeatureIndex&&(_r=zt.iconFeatureIndex),zt.iconBox){const cn=pi=>{const Mi=We&&zi?$r(pi,zi.x,zi.y,Oe,Le,this.transform.angle):pi;return this.collisionIndex.placeCollisionBox(Mi,De,P,w,re.predicate,$n)};yi&&yi.box&&yi.box.length&&zt.verticalIconBox?(mn=cn(zt.verticalIconBox),hi=mn.box.length>0):(mn=cn(zt.iconBox),hi=mn.box.length>0),jt=jt&&mn.offscreen}const Sr=te||xt.numHorizontalGlyphVertices===0&&xt.numVerticalGlyphVertices===0,Fs=ie||xt.numIconVertices===0;if(Sr||Fs?Fs?Sr||(hi=hi&&ai):ai=hi&&ai:hi=ai=hi&&ai,ai&&Ti&&Ti.box&&this.collisionIndex.insertCollisionBox(Ti.box,xe,v.get("text-ignore-placement"),m.bucketInstanceId,yi&&yi.box&&ar?ar:gr,re.ID),hi&&mn&&this.collisionIndex.insertCollisionBox(mn.box,De,v.get("icon-ignore-placement"),m.bucketInstanceId,_r,re.ID),Li&&(ai&&this.collisionIndex.insertCollisionCircles(Li.circles,xe,v.get("text-ignore-placement"),m.bucketInstanceId,gr,re.ID),h)){const cn=m.bucketInstanceId;let pi=this.collisionCircleArrays[cn];pi===void 0&&(pi=this.collisionCircleArrays[cn]=new fr);for(let Mi=0;Mi<Li.circles.length;Mi+=4)pi.circles.push(Li.circles[Mi+0]),pi.circles.push(Li.circles[Mi+1]),pi.circles.push(Li.circles[Mi+2]),pi.circles.push(Li.collisionDetected?1:0)}if(xt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xt.crossTileID]=new ya(ai||dt,hi||Ge,jt||m.justReloaded),l[xt.crossTileID]=!0};if(He){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xt=m.getSortedSymbolIndexes(this.transform.angle);for(let zt=xt.length-1;zt>=0;--zt){const ai=xt[zt];Ct(m.symbolInstances.get(ai),m.collisionArrays[ai])}}else for(let xt=t.symbolInstanceStart;xt<t.symbolInstanceEnd;xt++)Ct(m.symbolInstances.get(xt),m.collisionArrays[xt]);if(h&&m.bucketInstanceId in this.collisionCircleArrays){const xt=this.collisionCircleArrays[m.bucketInstanceId];s.invert(xt.invProjMatrix,w),xt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(t,l,h,m){let v;v=m===s.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(l)];const w=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const M of w)M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=v>=0&&M!==v?0:h.crossTileID)}markUsedOrientation(t,l,h){const m=l===s.WritingMode.horizontal||l===s.WritingMode.horizontalOnly?l:0,v=l===s.WritingMode.vertical?l:0,w=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const M of w)t.text.placedSymbolArray.get(M).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let h=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const m=l?l.symbolFadeChange(t):1,v=l?l.opacities:{},w=l?l.variableOffsets:{},M=l?l.placedOrientations:{};for(const z in this.placements){const P=this.placements[z],R=v[z];R?(this.opacities[z]=new Pi(R,m,P.text,P.icon),h=h||P.text!==R.text.placed||P.icon!==R.icon.placed):(this.opacities[z]=new Pi(null,m,P.text,P.icon,P.skipFade),h=h||P.text||P.icon)}for(const z in v){const P=v[z];if(!this.opacities[z]){const R=new Pi(P,m,!1,!1);R.isHidden()||(this.opacities[z]=R,h=h||P.text.placed||P.icon.placed)}}for(const z in w)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=w[z]);for(const z in M)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=M[z]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const h={};for(const m of l){const v=m.getBucket(t);v&&m.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,h,m.collisionBoxArray)}}updateBucketOpacities(t,l,h){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,v=new Pi(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),M=m.get("icon-allow-overlap"),z=m.get("text-variable-anchor"),P=m.get("text-rotation-alignment")==="map",R=m.get("text-pitch-alignment")==="map",N=m.get("icon-text-fit")!=="none",G=new Pi(null,0,w&&(M||!t.hasIconData()||m.get("icon-optional")),M&&(w||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const re=(te,ie,xe)=>{for(let Te=0;Te<ie/4;Te++)te.opacityVertexArray.emplaceBack(xe)};for(let te=0;te<t.symbolInstances.length;te++){const ie=t.symbolInstances.get(te),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Te,crossTileID:De}=ie;let oe=this.opacities[De];l[De]?oe=v:oe||(oe=G,this.opacities[De]=oe),l[De]=!0;const Oe=ie.numIconVertices>0,Le=this.placedOrientations[ie.crossTileID],We=Le===s.WritingMode.vertical,He=Le===s.WritingMode.horizontal||Le===s.WritingMode.horizontalOnly;if(xe>0||Te>0){const dt=Ie(oe.text);re(t.text,xe,We?qe:dt),re(t.text,Te,He?qe:dt);const Ge=oe.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(zt=>{zt>=0&&(t.text.placedSymbolArray.get(zt).hidden=Ge||We?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=Ge||He?1:0);const Ct=this.variableOffsets[ie.crossTileID];Ct&&this.markUsedJustification(t,Ct.anchor,ie,Le);const xt=this.placedOrientations[ie.crossTileID];xt&&(this.markUsedJustification(t,"left",ie,xt),this.markUsedOrientation(t,xt,ie))}if(Oe){const dt=Ie(oe.icon),Ge=!(N&&ie.verticalPlacedIconSymbolIndex&&We);ie.placedIconSymbolIndex>=0&&(re(t.icon,ie.numIconVertices,Ge?dt:qe),t.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=oe.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(re(t.icon,ie.numVerticalIconVertices,Ge?qe:dt),t.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const dt=t.collisionArrays[te];if(dt){let Ge=new s.pointGeometry(0,0);if(dt.textBox||dt.verticalTextBox){let xt=!0;if(z){const zt=this.variableOffsets[De];zt?(Ge=va(zt.anchor,zt.width,zt.height,zt.textOffset,zt.textBoxScale),P&&Ge._rotate(R?this.transform.angle:-this.transform.angle)):xt=!1}dt.textBox&&L(t.textCollisionBox.collisionVertexArray,oe.text.placed,!xt||We,Ge.x,Ge.y),dt.verticalTextBox&&L(t.textCollisionBox.collisionVertexArray,oe.text.placed,!xt||He,Ge.x,Ge.y)}const Ct=!!(!He&&dt.verticalIconBox);dt.iconBox&&L(t.iconCollisionBox.collisionVertexArray,oe.icon.placed,Ct,N?Ge.x:0,N?Ge.y:0),dt.verticalIconBox&&L(t.iconCollisionBox.collisionVertexArray,oe.icon.placed,!Ct,N?Ge.x:0,N?Ge.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=te.invProjMatrix,t.placementViewportMatrix=te.viewportMatrix,t.collisionCircleArray=te.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const h=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function L(f,t,l,h,m){f.emplaceBack(t?1:0,l?1:0,h||0,m||0),f.emplaceBack(t?1:0,l?1:0,h||0,m||0),f.emplaceBack(t?1:0,l?1:0,h||0,m||0),f.emplaceBack(t?1:0,l?1:0,h||0,m||0)}const O=Math.pow(2,25),K=Math.pow(2,24),J=Math.pow(2,17),fe=Math.pow(2,16),we=Math.pow(2,9),ye=Math.pow(2,8),pe=Math.pow(2,1);function Ie(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,l=Math.floor(127*f.opacity);return l*O+t*K+l*J+t*fe+l*we+t*ye+l*pe+t}const qe=0;class st{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,h,m,v){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(w,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((M,z)=>M.sortKey-z.sortKey));this._currentPartIndex<w.length;)if(l.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,v())return!0;return!1}}class Ue{constructor(t,l,h,m,v,w,M,z){this.placement=new $(t,l,w,M,z),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(t,l,h){const m=s.exported.now(),v=()=>{const w=s.exported.now()-m;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=l[t[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=M)&&(!w.maxzoom||w.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new st(w)),this._inProgressLayer.continuePlacement(h[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Rt=512/s.EXTENT/2;class Ot{constructor(t,l,h){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<l.length;m++){const v=l.get(m),w=v.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,t)})}}getScaledCoordinates(t,l){const h=Rt/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*s.EXTENT+t.anchorX)*h),y:Math.floor((l.canonical.y*s.EXTENT+t.anchorY)*h)}}findMatches(t,l,h){const m=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<t.length;v++){const w=t.get(v);if(w.crossTileID)continue;const M=this.indexedSymbolInstances[w.key];if(!M)continue;const z=this.getScaledCoordinates(w,l);for(const P of M)if(Math.abs(P.coord.x-z.x)<=m&&Math.abs(P.coord.y-z.y)<=m&&!h[P.crossTileID]){h[P.crossTileID]=!0,w.crossTileID=P.crossTileID;break}}}}class St{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(l!==0)for(const h in this.indexes){const m=this.indexes[h],v={};for(const w in m){const M=m[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+l),v[M.tileID.key]=M}this.indexes[h]=v}this.lng=t}addBucket(t,l,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>t.overscaledZ)for(const M in w){const z=w[M];z.tileID.isChildOf(t)&&z.findMatches(l.symbolInstances,t,m)}else{const M=w[t.scaledTo(Number(v)).key];M&&M.findMatches(l.symbolInstances,t,m)}}for(let v=0;v<l.symbolInstances.length;v++){const w=l.symbolInstances.get(v);w.crossTileID||(w.crossTileID=h.generate(),m[w.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ot(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const h in l.indexedSymbolInstances)for(const m of l.indexedSymbolInstances[h])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let l=!1;for(const h in this.indexes){const m=this.indexes[h];for(const v in m)t[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[v]),delete m[v],l=!0)}return l}}class Kt{constructor(){this.layerIndexes={},this.crossTileIDs=new St,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,h){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Wt);let v=!1;const w={};m.handleWrapJump(h);for(const M of l){const z=M.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,z,this.crossTileIDs)&&(v=!0),w[z.bucketInstanceId]=!0)}return m.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(t){const l={};t.forEach(h=>{l[h]=!0});for(const h in this.layerIndexes)l[h]||delete this.layerIndexes[h]}}var Ii=s.createLayout([{name:"a_pos",type:"Int16",components:2}]);class ti extends s.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const l=this._tiles[t];l.textures.forEach(h=>h.destroy()),l.textures=[]}}update(t,l){this.sourceCache.update(t,l),this._renderableTilesKeys=[];for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l}))this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),s.ortho(h.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),this._tiles[h.key]=new Xe(h,this.tileSize))}removeOutdated(t){const l={};this.renderHistory=this.renderHistory.filter((h,m)=>this.renderHistory.indexOf(h)===m).slice(0,this.renderHistorySize);for(const h of this._renderableTilesKeys)l[h]=!0;for(const h of this.renderHistory)l[h]=!0;for(const h in this._tiles)l[h]||(this._tiles[h].clearTextures(t),delete this._tiles[h])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const l={};for(const h of this._renderableTilesKeys){const m=this._tiles[h].tileID;if(m.canonical.equals(t.canonical)){const v=t.clone();v.posMatrix=new Float64Array(16),s.ortho(v.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),l[h]=v}else if(m.canonical.isChildOf(t.canonical)){const v=t.clone();v.posMatrix=new Float64Array(16);const w=m.canonical.z-t.canonical.z,M=m.canonical.x-(m.canonical.x>>w<<w),z=m.canonical.y-(m.canonical.y>>w<<w),P=s.EXTENT>>w;s.ortho(v.posMatrix,0,P,0,P,0,1),s.translate(v.posMatrix,v.posMatrix,[-M*P,-z*P,0]),l[h]=v}else if(t.canonical.isChildOf(m.canonical)){const v=t.clone();v.posMatrix=new Float64Array(16);const w=t.canonical.z-m.canonical.z,M=t.canonical.x-(t.canonical.x>>w<<w),z=t.canonical.y-(t.canonical.y>>w<<w),P=s.EXTENT>>w;s.ortho(v.posMatrix,0,s.EXTENT,0,s.EXTENT,0,1),s.translate(v.posMatrix,v.posMatrix,[M*P,z*P,0]),s.scale(v.posMatrix,v.posMatrix,[1/2**w,1/2**w,0]),l[h]=v}}return l}getSourceTile(t,l){const h=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>h.maxzoom&&(m=h.maxzoom),m<h.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!v||!v.dem)&&l)for(;m>=h.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(t.scaledTo(m--).key);return v}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(l=>l.timeLoaded>=t)}}class ui{constructor(t,l,h){this.style=t,this.sourceCache=new ti(l),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.elevationOffset=typeof h.elevationOffset=="number"?h.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,l,h,m=s.EXTENT){if(!(l>=0&&l<m&&h>=0&&h<m))return this.elevationOffset;let v=0;const w=this.getTerrainData(t);if(w.tile&&w.tile.dem){const M=s.transformMat4$1([],[l/m*s.EXTENT,h/m*s.EXTENT],w.u_terrain_matrix),z=[M[0]*w.tile.dem.dim,M[1]*w.tile.dem.dim],P=[Math.floor(z[0]),Math.floor(z[1])],R=w.tile.dem.get(P[0],P[1]),N=w.tile.dem.get(P[0],P[1]+1),G=w.tile.dem.get(P[0]+1,P[1]),re=w.tile.dem.get(P[0]+1,P[1]+1);v=s.number(s.number(R,N,z[0]-P[0]),s.number(G,re,z[0]-P[0]),z[1]-P[1])}return v}rememberForRerender(t,l){for(const h in this.sourceCache._tiles){const m=this.sourceCache._tiles[h];(m.tileID.equals(l)||m.tileID.isChildOf(l))&&(t===this.sourceCache.sourceCache.id&&(m.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][m.tileID.key]=!0)}}needsRerender(t,l){return this._rerender[t]&&this._rerender[t][l.key]}clearRerenderCache(){this._rerender={}}getElevation(t,l,h,m=s.EXTENT){return(this.getDEMElevation(t,l,h,m)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.style.map.painter.context,v=new s.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Z(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Z(m,new s.RGBAImage({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.identity([])}const l=this.sourceCache.getSourceTile(t,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const m=this.style.map.painter.context;l.demTexture=this.style.map.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new Z(m,l.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),l.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const h=l&&l+l.tileID.key+t.key;if(h&&!this._demMatrixCache[h]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=t.canonical.z-l.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?v=t.canonical.z-m:s.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=t.canonical.x-(t.canonical.x>>v<<v),M=t.canonical.y-(t.canonical.y>>v<<v),z=s.fromScaling(new Float64Array(16),[1/(s.EXTENT<<v),1/(s.EXTENT<<v),0]);s.translate(z,z,[w*s.EXTENT,M*s.EXTENT,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const l=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(l,l,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,l,l))}return this._rttFramebuffer}getFramebuffer(t){const l=this.style.map.painter,h=l.width/devicePixelRatio,m=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Z(l.context,{width:h,height:m,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Z(l.context,{width:h,height:m,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(h,m,!0),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,h,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let M=0;M<this._coordsTextureSize;M++,w+=4)l[w+0]=255&M,l[w+1]=255&v,l[w+2]=M>>8<<4|v>>8,l[w+3]=0;const h=new s.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),m=new Z(t,h,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){const l=new Uint8Array(4),h=this.style.map.painter,m=h.context,v=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(t.x,h.height/devicePixelRatio-t.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,l),m.bindFramebuffer.set(null);const w=l[0]+(l[2]>>4<<8),M=l[1]+((15&l[2])<<8),z=this.coordsIndex[255-l[3]],P=z&&this.sourceCache.getTileByID(z);if(!P)return null;const R=this._coordsTextureSize,N=(1<<P.tileID.canonical.z)*R;return new s.MercatorCoordinate((P.tileID.canonical.x*R+w)/N,(P.tileID.canonical.y*R+M)/N,this.getElevation(P.tileID,w,M,R))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,l=new s.PosArray,h=new s.TriangleIndexArray,m=this.meshSize,v=s.EXTENT/m,w=m*m;for(let M=0;M<=m;M++)for(let z=0;z<=m;z++)l.emplaceBack(z*v,M*v);for(let M=0;M<w;M+=m+1)for(let z=0;z<m;z++)h.emplaceBack(z+M,m+z+M+1,m+z+M+2),h.emplaceBack(z+M,m+z+M+2,z+M+1);return this._mesh={indexBuffer:t.createIndexBuffer(h),vertexBuffer:t.createVertexBuffer(l,Ii.members),segments:s.SegmentVector.simpleSegment(0,0,l.length,h.length)},this._mesh}getMinMaxElevation(t){const l=this.getTerrainData(t).tile,h={minElevation:null,maxElevation:null};return l&&l.dem&&(h.minElevation=(l.dem.min+this.elevationOffset)*this.exaggeration,h.maxElevation=(l.dem.max+this.elevationOffset)*this.exaggeration),h}}const ki=(f,t)=>s.emitValidationErrors(f,t&&t.filter(l=>l.identifier!=="source.canvas")),Ri=s.pick($e,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),pn=s.pick($e,["setCenter","setZoom","setBearing","setPitch"]),Gi=function(){const f={},t=s.spec.$version;for(const l in s.spec.$root){const h=s.spec.$root[l];if(h.required){let m=null;m=l==="version"?t:h.type==="array"?[]:{},m!=null&&(f[l]=m)}}return f}();class In extends s.Evented{constructor(t,l={}){super(),this.map=t,this.dispatcher=new ke(ln(),this),this.imageManager=new H,this.imageManager.setEventedParent(this),this.glyphManager=new ge(t._requestManager,l.localIdeographFontFamily),this.lineAtlas=new ee(256,512),this.crossTileSymbolIndex=new Kt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const h=this;this._rtlTextPluginCallback=In.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(v,w)=>{if(s.triggerPluginCompletionEvent(v),w&&w.every(M=>M))for(const M in h.sourceCaches)h.sourceCaches[M].reload()})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const v=this.sourceCaches[m.sourceId];if(!v)return;const w=v.getSource();if(w&&w.vectorLayerIds)for(const M in this._layers){const z=this._layers[M];z.source===w.id&&this._validateLayer(z)}})}loadURL(t,l={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const h=typeof l.validate!="boolean"||l.validate,m=this.map._requestManager.transformRequest(t,s.ResourceType.Style);this._request=s.getJSON(m,(v,w)=>{this._request=null,v?this.fire(new s.ErrorEvent(v)):w&&this._load(w,h)})}loadJSON(t,l={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(t,l.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Gi,!1)}_load(t,l){if(l&&ki(this,s.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const h=dn(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=s.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ce(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(l,h,m,v){let w,M,z;const P=m>1?"@2x":"";let R=s.getJSON(h.transformRequest(h.normalizeSpriteURL(l,P,".json"),s.ResourceType.SpriteJSON),(re,te)=>{R=null,z||(z=re,w=te,G())}),N=s.getImage(h.transformRequest(h.normalizeSpriteURL(l,P,".png"),s.ResourceType.SpriteImage),(re,te)=>{N=null,z||(z=re,M=te,G())});function G(){if(z)v(z);else if(w&&M){const re=s.exported.getImageData(M),te={};for(const ie in w){const{width:xe,height:Te,x:De,y:oe,sdf:Oe,pixelRatio:Le,stretchX:We,stretchY:He,content:dt}=w[ie],Ge=new s.RGBAImage({width:xe,height:Te});s.RGBAImage.copy(re,Ge,{x:De,y:oe},{x:0,y:0},{width:xe,height:Te}),te[ie]={data:Ge,pixelRatio:Le,sdf:Oe,stretchX:We,stretchY:He,content:dt}}v(null,te)}}return{cancel(){R&&(R.cancel(),R=null),N&&(N.cancel(),N=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(l,h)=>{if(this._spriteRequest=null,l)this.fire(new s.ErrorEvent(l));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(t){const l=this.sourceCaches[t.source];if(!l)return;const h=t.sourceLayer;if(!h)return;const m=l.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(h)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const l=[];for(const h of t){const m=this._layers[h];m.type!=="custom"&&l.push(m.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const l=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const w in this._updatedSources){const M=this._updatedSources[w];if(M==="reload")this._reloadSource(w);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(w)}}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const h={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];h[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in h){const v=this.sourceCaches[m];h[m]!==v.used&&v.fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.z=t.zoom,l&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const l=this.sourceCaches[t.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new ui(this,l,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=h=>{h.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=h=>{h.tile&&(h.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(h.sourceId,h.tile.tileID)):h.source.type==="geojson"&&this.terrain.rememberForRerender(h.sourceId,h.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new s.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),ki(this,s.validateStyle(t)))return!1;(t=s.clone$1(t)).layers=dn(t.layers);const l=function(m,v){if(!m)return[{command:$e.setStyle,args:[v]}];let w=[];try{if(!A(m.version,v.version))return[{command:$e.setStyle,args:[v]}];A(m.center,v.center)||w.push({command:$e.setCenter,args:[v.center]}),A(m.zoom,v.zoom)||w.push({command:$e.setZoom,args:[v.zoom]}),A(m.bearing,v.bearing)||w.push({command:$e.setBearing,args:[v.bearing]}),A(m.pitch,v.pitch)||w.push({command:$e.setPitch,args:[v.pitch]}),A(m.sprite,v.sprite)||w.push({command:$e.setSprite,args:[v.sprite]}),A(m.glyphs,v.glyphs)||w.push({command:$e.setGlyphs,args:[v.glyphs]}),A(m.transition,v.transition)||w.push({command:$e.setTransition,args:[v.transition]}),A(m.light,v.light)||w.push({command:$e.setLight,args:[v.light]});const M={},z=[];(function(R,N,G,re){let te;for(te in N=N||{},R=R||{})Object.prototype.hasOwnProperty.call(R,te)&&(Object.prototype.hasOwnProperty.call(N,te)||tn(te,G,re));for(te in N)Object.prototype.hasOwnProperty.call(N,te)&&(Object.prototype.hasOwnProperty.call(R,te)?A(R[te],N[te])||(R[te].type==="geojson"&&N[te].type==="geojson"&&Va(R,N,te)?G.push({command:$e.setGeoJSONSourceData,args:[te,N[te].data]}):Vn(te,N,G,re)):ot(te,N,G))})(m.sources,v.sources,z,M);const P=[];m.layers&&m.layers.forEach(R=>{M[R.source]?w.push({command:$e.removeLayer,args:[R.id]}):P.push(R)}),w=w.concat(z),function(R,N,G){N=N||[];const re=(R=R||[]).map(Ir),te=N.map(Ir),ie=R.reduce(ga,{}),xe=N.reduce(ga,{}),Te=re.slice(),De=Object.create(null);let oe,Oe,Le,We,He,dt,Ge;for(oe=0,Oe=0;oe<re.length;oe++)Le=re[oe],Object.prototype.hasOwnProperty.call(xe,Le)?Oe++:(G.push({command:$e.removeLayer,args:[Le]}),Te.splice(Te.indexOf(Le,Oe),1));for(oe=0,Oe=0;oe<te.length;oe++)Le=te[te.length-1-oe],Te[Te.length-1-oe]!==Le&&(Object.prototype.hasOwnProperty.call(ie,Le)?(G.push({command:$e.removeLayer,args:[Le]}),Te.splice(Te.lastIndexOf(Le,Te.length-Oe),1)):Oe++,dt=Te[Te.length-oe],G.push({command:$e.addLayer,args:[xe[Le],dt]}),Te.splice(Te.length-oe,0,Le),De[Le]=!0);for(oe=0;oe<te.length;oe++)if(Le=te[oe],We=ie[Le],He=xe[Le],!De[Le]&&!A(We,He))if(A(We.source,He.source)&&A(We["source-layer"],He["source-layer"])&&A(We.type,He.type)){for(Ge in wr(We.layout,He.layout,G,Le,null,$e.setLayoutProperty),wr(We.paint,He.paint,G,Le,null,$e.setPaintProperty),A(We.filter,He.filter)||G.push({command:$e.setFilter,args:[Le,He.filter]}),A(We.minzoom,He.minzoom)&&A(We.maxzoom,He.maxzoom)||G.push({command:$e.setLayerZoomRange,args:[Le,He.minzoom,He.maxzoom]}),We)Object.prototype.hasOwnProperty.call(We,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?wr(We[Ge],He[Ge],G,Le,Ge.slice(6),$e.setPaintProperty):A(We[Ge],He[Ge])||G.push({command:$e.setLayerProperty,args:[Le,Ge,He[Ge]]}));for(Ge in He)Object.prototype.hasOwnProperty.call(He,Ge)&&!Object.prototype.hasOwnProperty.call(We,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?wr(We[Ge],He[Ge],G,Le,Ge.slice(6),$e.setPaintProperty):A(We[Ge],He[Ge])||G.push({command:$e.setLayerProperty,args:[Le,Ge,He[Ge]]}))}else G.push({command:$e.removeLayer,args:[Le]}),dt=Te[Te.lastIndexOf(Le)+1],G.push({command:$e.addLayer,args:[He,dt]})}(P,v.layers,w)}catch(M){console.warn("Unable to compute style diff:",M),w=[{command:$e.setStyle,args:[v]}]}return w}(this.serialize(),t).filter(m=>!(m.command in pn));if(l.length===0)return!1;const h=l.filter(m=>!(m.command in Ri));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return l.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,l){if(this.getImage(t))return this.fire(new s.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,l),this._afterImageUpdated(t)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,l,h={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(s.validateStyle.source,`sources.${t}`,l,null,h))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const m=this.sourceCaches[t]=new Pe(t,l,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===t)return this.fire(new s.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${h}" is using it.`)));const l=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],l.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,l){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const h=this.sourceCaches[t].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(l),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,l,h={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new s.ErrorEvent(new Error(`Layer "${m}" already exists on this map.`)));let v;if(t.type==="custom"){if(ki(this,s.validateCustomStyleLayer(t)))return;v=s.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=s.clone$1(t),t=s.extend(t,{source:m})),this._validate(s.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},h))return;v=s.createStyleLayer(t),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[v.id]=v.serialize()}const w=l?this._order.indexOf(l):this._order.length;if(l&&w===-1)this.fire(new s.ErrorEvent(new Error(`Cannot add layer "${m}" before non-existing layer "${l}".`)));else{if(this._order.splice(w,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const h=this._order.indexOf(t);this._order.splice(h,1);const m=l?this._order.indexOf(l):this._order.length;l&&m===-1?this.fire(new s.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${l}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new s.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));l.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,l,h){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===l&&m.maxzoom===h||(l!=null&&(m.minzoom=l),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new s.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,l,h={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!A(m.filter,l))return l==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(s.validateStyle.filter,`layers.${m.id}.filter`,l,null,h)||(m.filter=s.clone$1(l),this._updateLayer(m)))}else this.fire(new s.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,l,h,m={}){this._checkLoaded();const v=this.getLayer(t);v?A(v.getLayoutProperty(l),h)||(v.setLayoutProperty(l,h,m),this._updateLayer(v)):this.fire(new s.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,l){const h=this.getLayer(t);if(h)return h.getLayoutProperty(l);this.fire(new s.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,l,h,m={}){this._checkLoaded();const v=this.getLayer(t);v?A(v.getPaintProperty(l),h)||(v.setPaintProperty(l,h,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,l){return this.getLayer(t).getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const h=t.source,m=t.sourceLayer,v=this.sourceCaches[h];if(v===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&m?this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||m?(t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,t.id,l)):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,l){this._checkLoaded();const h=t.source,m=this.sourceCaches[h];if(m===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const v=m.getSource().type,w=v==="vector"?t.sourceLayer:void 0;v!=="vector"||w?l&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(w,t.id,l):this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const l=t.source,h=t.sourceLayer,m=this.sourceCaches[l];if(m!==void 0)return m.getSource().type!=="vector"||h?(t.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),m.getFeatureState(h,t.id)):void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:s.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const l=w=>this._layers[w].type==="fill-extrusion",h={},m=[];for(let w=this._order.length-1;w>=0;w--){const M=this._order[w];if(l(M)){h[M]=w;for(const z of t){const P=z[M];if(P)for(const R of P)m.push(R)}}}m.sort((w,M)=>M.intersectionZ-w.intersectionZ);const v=[];for(let w=this._order.length-1;w>=0;w--){const M=this._order[w];if(l(M))for(let z=m.length-1;z>=0;z--){const P=m[z].feature;if(h[P.layer.id]<w)break;v.push(P),m.pop()}else for(const z of t){const P=z[M];if(P)for(const R of P)v.push(R.feature)}}return v}queryRenderedFeatures(t,l,h){l&&l.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const m={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of l.layers){const M=this._layers[w];if(!M)return this.fire(new s.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];m[M.source]=!0}}const v=[];l.availableImages=this._availableImages;for(const w in this.sourceCaches)l.layers&&!m[w]||v.push(yt(this.sourceCaches[w],this._layers,this._serializedLayers,t,l,h));return this.placement&&v.push(function(w,M,z,P,R,N,G){const re={},te=N.queryRenderedSymbols(P),ie=[];for(const xe of Object.keys(te).map(Number))ie.push(G[xe]);ie.sort(mt);for(const xe of ie){const Te=xe.featureIndex.lookupSymbolFeatures(te[xe.bucketInstanceId],M,xe.bucketIndex,xe.sourceLayerIndex,R.filter,R.layers,R.availableImages,w);for(const De in Te){const oe=re[De]=re[De]||[],Oe=Te[De];Oe.sort((Le,We)=>{const He=xe.featureSortOrder;if(He){const dt=He.indexOf(Le.featureIndex);return He.indexOf(We.featureIndex)-dt}return We.featureIndex-Le.featureIndex});for(const Le of Oe)oe.push(Le)}}for(const xe in re)re[xe].forEach(Te=>{const De=Te.feature,oe=z[w[xe].source].getFeatureState(De.layer["source-layer"],De.id);De.source=De.layer.source,De.layer["source-layer"]&&(De.sourceLayer=De.layer["source-layer"]),De.state=oe});return re}(this._layers,this._serializedLayers,this.sourceCaches,t,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,l){l&&l.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const h=this.sourceCaches[t];return h?function(m,v){const w=m.getRenderableIds().map(P=>m.getTileByID(P)),M=[],z={};for(let P=0;P<w.length;P++){const R=w[P],N=R.tileID.canonical.key;z[N]||(z[N]=!0,R.querySourceFeatures(M,v))}return M}(h,l):[]}addSourceType(t,l,h){return In.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(In.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const w in t)if(!A(t[w],h[w])){m=!0;break}if(!m)return;const v={now:s.exported.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,l),this.light.updateTransitions(v)}_validate(t,l,h,m,v={}){return(!v||v.validate!==!1)&&ki(this,t.call(s.validateStyle,s.extend({key:l,style:this.serialize(),value:h,styleSpec:s.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const l=this.sourceCaches[t];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const l in this.sourceCaches)this.sourceCaches[l].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,l,h,m,v=!1){let w=!1,M=!1;const z={};for(const P of this._order){const R=this._layers[P];if(R.type!=="symbol")continue;if(!z[R.source]){const G=this.sourceCaches[R.source];z[R.source]=G.getRenderableIds(!0).map(re=>G.getTileByID(re)).sort((re,te)=>te.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(te.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(R,z[R.source],t.center.lng);w=w||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ue(t,this.terrain,this._order,v,l,h,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),M=!0),w&&this.pauseablePlacement.placement.setStale()),M||w)for(const P of this._order){const R=this._layers[P];R.type==="symbol"&&this.placement.updateLayerOpacities(R,z[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l,h){this.imageManager.getImages(l.icons,h),this._updateTilesForChangedImages();const m=this.sourceCaches[l.source];m&&m.setDependencies(l.tileID.key,l.type,l.icons)}getGlyphs(t,l,h){this.glyphManager.getGlyphs(l.stacks,h)}getResource(t,l,h){return s.makeRequest(l,h)}}In.getSourceType=function(f){return Qe[f]},In.setSourceType=function(f,t){Qe[f]=t},In.registerForPluginStateChange=s.registerForPluginStateChange;var ba="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Na={prelude:Fi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Fi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Fi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Fi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Fi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Fi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Fi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Fi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Fi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Fi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Fi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Fi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Fi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Fi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Fi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Fi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Fi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Fi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ba),terrainDepth:Fi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ba),terrainCoords:Fi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ba)};function Fi(f,t){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=t.match(/attribute ([\w]+) ([\w]+)/g),m=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(m):m,M={};return{fragmentSource:f=f.replace(l,(z,P,R,N,G)=>(M[G]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${G}
varying ${R} ${N} ${G};
#else
uniform ${R} ${N} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${R} ${N} ${G} = u_${G};
#endif
`)),vertexSource:t=t.replace(l,(z,P,R,N,G)=>{const re=N==="float"?"vec2":"vec4",te=G.match(/color/)?"color":re;return M[G]?P==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${R} ${re} a_${G};
varying ${R} ${N} ${G};
#else
uniform ${R} ${N} u_${G};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${R} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${te}(a_${G}, u_${G}_t);
#else
    ${R} ${N} ${G} = u_${G};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${R} ${re} a_${G};
#else
uniform ${R} ${N} u_${G};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${R} ${N} ${G} = a_${G};
#else
    ${R} ${N} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${R} ${N} ${G} = unpack_mix_${te}(a_${G}, u_${G}_t);
#else
    ${R} ${N} ${G} = u_${G};
#endif
`}),staticAttributes:h,staticUniforms:w}}class io{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,h,m,v,w,M,z,P){this.context=t;let R=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!R&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(R=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===h&&!R&&this.boundIndexBuffer===v&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===z&&this.boundDynamicVertexBuffer3===P?(t.bindVertexArrayOES.set(this.vao),M&&M.bind(),v&&v.dynamicDraw&&v.bind(),z&&z.bind(),P&&P.bind()):this.freshBind(l,h,m,v,w,M,z,P)}freshBind(t,l,h,m,v,w,M,z){let P;const R=t.numAttributes,N=this.context,G=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=z;else{P=N.currentNumAttributes||0;for(let re=R;re<P;re++)G.disableVertexAttribArray(re)}l.enableAttributes(G,t);for(const re of h)re.enableAttributes(G,t);w&&w.enableAttributes(G,t),M&&M.enableAttributes(G,t),z&&z.enableAttributes(G,t),l.bind(),l.setVertexAttribPointers(G,t,v);for(const re of h)re.bind(),re.setVertexAttribPointers(G,t,v);w&&(w.bind(),w.setVertexAttribPointers(G,t,v)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(G,t,v)),z&&(z.bind(),z.setVertexAttribPointers(G,t,v)),N.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function no(f){const t=[];for(let l=0;l<f.length;l++){if(f[l]===null)continue;const h=f[l].split(" ");t.push(h.pop())}return t}class ml{constructor(t,l,h,m,v,w,M){const z=t.gl;this.program=z.createProgram();const P=no(h.staticAttributes),R=m?m.getBinderAttributes():[],N=P.concat(R),G=Na.prelude.staticUniforms?no(Na.prelude.staticUniforms):[],re=h.staticUniforms?no(h.staticUniforms):[],te=m?m.getBinderUniforms():[],ie=G.concat(re).concat(te),xe=[];for(const He of ie)xe.indexOf(He)<0&&xe.push(He);const Te=m?m.defines():[];w&&Te.push("#define OVERDRAW_INSPECTOR;"),M&&Te.push("#define TERRAIN3D;");const De=Te.concat(Na.prelude.fragmentSource,h.fragmentSource).join(`
`),oe=Te.concat(Na.prelude.vertexSource,h.vertexSource).join(`
`),Oe=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Oe,De),z.compileShader(Oe),z.attachShader(this.program,Oe);const Le=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Le,oe),z.compileShader(Le),z.attachShader(this.program,Le),this.attributes={};const We={};this.numAttributes=N.length;for(let He=0;He<this.numAttributes;He++)N[He]&&(z.bindAttribLocation(this.program,He,N[He]),this.attributes[N[He]]=He);z.linkProgram(this.program),z.deleteShader(Le),z.deleteShader(Oe);for(let He=0;He<xe.length;He++){const dt=xe[He];if(dt&&!We[dt]){const Ge=z.getUniformLocation(this.program,dt);Ge&&(We[dt]=Ge)}}this.fixedUniforms=v(t,We),this.terrainUniforms=((He,dt)=>({u_depth:new s.Uniform1i(He,dt.u_depth),u_terrain:new s.Uniform1i(He,dt.u_terrain),u_terrain_dim:new s.Uniform1f(He,dt.u_terrain_dim),u_terrain_matrix:new s.UniformMatrix4f(He,dt.u_terrain_matrix),u_terrain_unpack:new s.Uniform4f(He,dt.u_terrain_unpack),u_terrain_offset:new s.Uniform1f(He,dt.u_terrain_offset),u_terrain_exaggeration:new s.Uniform1f(He,dt.u_terrain_exaggeration)}))(t,We),this.binderUniforms=m?m.getUniforms(t,We):[]}draw(t,l,h,m,v,w,M,z,P,R,N,G,re,te,ie,xe,Te,De){const oe=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(m),t.setColorMode(v),t.setCullFace(w),z){t.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,z.depthTexture),t.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,z.texture);for(const Le in this.terrainUniforms)this.terrainUniforms[Le].set(z[Le])}for(const Le in this.fixedUniforms)this.fixedUniforms[Le].set(M[Le]);ie&&ie.setUniforms(t,this.binderUniforms,re,{zoom:te});let Oe=0;switch(l){case oe.LINES:Oe=2;break;case oe.TRIANGLES:Oe=3;break;case oe.LINE_STRIP:Oe=1}for(const Le of G.get()){const We=Le.vaos||(Le.vaos={});(We[P]||(We[P]=new io)).bind(t,this,R,ie?ie.getPaintVertexBuffers():[],N,Le.vertexOffset,xe,Te,De),oe.drawElements(l,Le.primitiveLength*Oe,oe.UNSIGNED_SHORT,Le.primitiveOffset*Oe*2)}}}function gl(f,t,l){const h=1/rn(l,1,t.transform.tileZoom),m=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,t.transform.tileZoom)/m,w=v*(l.tileID.canonical.x+l.tileID.wrap*m),M=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[h,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[w>>16,M>>16],u_pixel_coord_lower:[65535&w,65535&M]}}const ro=(f,t,l,h)=>{const m=t.style.light,v=m.properties.get("position"),w=[v.x,v.y,v.z],M=s.create$1();m.properties.get("anchor")==="viewport"&&s.fromRotation(M,-t.transform.angle),s.transformMat3(w,w,M);const z=m.properties.get("color");return{u_matrix:f,u_lightpos:w,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+l,u_opacity:h}},Vc=(f,t,l,h,m,v,w)=>s.extend(ro(f,t,l,h),gl(v,t,w),{u_height_factor:-Math.pow(2,m.overscaledZ)/w.tileSize/8}),ys=f=>({u_matrix:f}),ao=(f,t,l,h)=>s.extend(ys(f),gl(l,t,h)),_l=(f,t)=>({u_matrix:f,u_world:t}),yl=(f,t,l,h,m)=>s.extend(ao(f,t,l,h),{u_world:m}),vl=(f,t,l,h)=>{const m=f.transform;let v,w;if(h.paint.get("circle-pitch-alignment")==="map"){const M=rn(l,1,m.zoom);v=!0,w=[M,M]}else v=!1,w=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(t.posMatrix,l,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w}},ea=(f,t,l)=>{const h=rn(l,1,t.zoom),m=Math.pow(2,t.zoom-l.tileID.overscaledZ),v=l.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[t.pixelsToGLUnits[0]/(h*m),t.pixelsToGLUnits[1]/(h*m)],u_overscale_factor:v}},Ua=(f,t,l=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:l}),xa=f=>({u_matrix:f}),vs=(f,t,l,h)=>({u_matrix:f,u_extrude_scale:rn(t,1,l),u_intensity:h});function bs(f,t){const l=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new s.MercatorCoordinate(0,h/l).toLngLat().lat,new s.MercatorCoordinate(0,(h+1)/l).toLngLat().lat]}const wa=(f,t,l,h)=>{const m=f.transform;return{u_matrix:Ga(f,t,l,h),u_ratio:1/rn(t,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},so=(f,t,l,h,m)=>s.extend(wa(f,t,l,m),{u_image:0,u_image_height:h}),xs=(f,t,l,h,m)=>{const v=f.transform,w=ji(t,v);return{u_matrix:Ga(f,t,l,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/rn(t,1,v.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[w,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},qa=(f,t,l,h,m,v)=>{const w=f.lineAtlas,M=ji(t,f.transform),z=l.layout.get("line-cap")==="round",P=w.getDash(h.from,z),R=w.getDash(h.to,z),N=P.width*m.fromScale,G=R.width*m.toScale;return s.extend(wa(f,t,l,v),{u_patternscale_a:[M/N,-P.height/2],u_patternscale_b:[M/G,-R.height/2],u_sdfgamma:w.width/(256*Math.min(N,G)*f.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:R.y,u_mix:m.t})};function ji(f,t){return 1/rn(f,1,t.tileZoom)}function Ga(f,t,l,h){return f.translatePosMatrix(h?h.posMatrix:t.tileID.posMatrix,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const bl=(f,t,l,h,m)=>{return{u_matrix:f,u_tl_parent:t,u_scale_parent:l,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(w=m.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:xl(m.paint.get("raster-hue-rotate"))};var v,w};function xl(f){f*=Math.PI/180;const t=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const oo=(f,t,l,h,m,v,w,M,z,P)=>{const R=m.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:R.width/R.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:M,u_is_text:+z,u_pitch_with_map:+h,u_texsize:P,u_texture:0}},ws=(f,t,l,h,m,v,w,M,z,P,R)=>{const N=m.transform;return s.extend(oo(f,t,l,h,m,v,w,M,z,P),{u_gamma_scale:h?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+R})},wl=(f,t,l,h,m,v,w,M,z,P)=>s.extend(ws(f,t,l,h,m,v,w,M,!0,z,!0),{u_texsize_icon:P,u_texture_icon:1}),Nc=(f,t,l)=>({u_matrix:f,u_opacity:t,u_color:l}),Uc=(f,t,l,h,m,v)=>s.extend(function(w,M,z,P){const R=z.imageManager.getPattern(w.from.toString()),N=z.imageManager.getPattern(w.to.toString()),{width:G,height:re}=z.imageManager.getPixelSize(),te=Math.pow(2,P.tileID.overscaledZ),ie=P.tileSize*Math.pow(2,z.transform.tileZoom)/te,xe=ie*(P.tileID.canonical.x+P.tileID.wrap*te),Te=ie*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[G,re],u_mix:M.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/rn(P,1,z.transform.tileZoom),u_pixel_coord_upper:[xe>>16,Te>>16],u_pixel_coord_lower:[65535&xe,65535&Te]}}(h,v,l,m),{u_matrix:f,u_opacity:t}),lo={fillExtrusion:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_lightpos:new s.Uniform3f(f,t.u_lightpos),u_lightintensity:new s.Uniform1f(f,t.u_lightintensity),u_lightcolor:new s.Uniform3f(f,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(f,t.u_vertical_gradient),u_opacity:new s.Uniform1f(f,t.u_opacity)}),fillExtrusionPattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_lightpos:new s.Uniform3f(f,t.u_lightpos),u_lightintensity:new s.Uniform1f(f,t.u_lightintensity),u_lightcolor:new s.Uniform3f(f,t.u_lightcolor),u_vertical_gradient:new s.Uniform1f(f,t.u_vertical_gradient),u_height_factor:new s.Uniform1f(f,t.u_height_factor),u_image:new s.Uniform1i(f,t.u_image),u_texsize:new s.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade),u_opacity:new s.Uniform1f(f,t.u_opacity)}),fill:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),fillPattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_image:new s.Uniform1i(f,t.u_image),u_texsize:new s.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade)}),fillOutline:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_world:new s.Uniform2f(f,t.u_world)}),fillOutlinePattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_world:new s.Uniform2f(f,t.u_world),u_image:new s.Uniform1i(f,t.u_image),u_texsize:new s.Uniform2f(f,t.u_texsize),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade)}),circle:(f,t)=>({u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_scale_with_map:new s.Uniform1i(f,t.u_scale_with_map),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_extrude_scale:new s.Uniform2f(f,t.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),collisionBox:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.Uniform1f(f,t.u_pixels_to_tile_units),u_extrude_scale:new s.Uniform2f(f,t.u_extrude_scale),u_overscale_factor:new s.Uniform1f(f,t.u_overscale_factor)}),collisionCircle:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_inv_matrix:new s.UniformMatrix4f(f,t.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(f,t.u_viewport_size)}),debug:(f,t)=>({u_color:new s.UniformColor(f,t.u_color),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_overlay:new s.Uniform1i(f,t.u_overlay),u_overlay_scale:new s.Uniform1f(f,t.u_overlay_scale)}),clippingMask:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),heatmap:(f,t)=>({u_extrude_scale:new s.Uniform1f(f,t.u_extrude_scale),u_intensity:new s.Uniform1f(f,t.u_intensity),u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),heatmapTexture:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_world:new s.Uniform2f(f,t.u_world),u_image:new s.Uniform1i(f,t.u_image),u_color_ramp:new s.Uniform1i(f,t.u_color_ramp),u_opacity:new s.Uniform1f(f,t.u_opacity)}),hillshade:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_image:new s.Uniform1i(f,t.u_image),u_latrange:new s.Uniform2f(f,t.u_latrange),u_light:new s.Uniform2f(f,t.u_light),u_shadow:new s.UniformColor(f,t.u_shadow),u_highlight:new s.UniformColor(f,t.u_highlight),u_accent:new s.UniformColor(f,t.u_accent)}),hillshadePrepare:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_image:new s.Uniform1i(f,t.u_image),u_dimension:new s.Uniform2f(f,t.u_dimension),u_zoom:new s.Uniform1f(f,t.u_zoom),u_unpack:new s.Uniform4f(f,t.u_unpack)}),line:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels)}),lineGradient:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels),u_image:new s.Uniform1i(f,t.u_image),u_image_height:new s.Uniform1f(f,t.u_image_height)}),linePattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_texsize:new s.Uniform2f(f,t.u_texsize),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_image:new s.Uniform1i(f,t.u_image),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels),u_scale:new s.Uniform3f(f,t.u_scale),u_fade:new s.Uniform1f(f,t.u_fade)}),lineSDF:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_ratio:new s.Uniform1f(f,t.u_ratio),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(f,t.u_units_to_pixels),u_patternscale_a:new s.Uniform2f(f,t.u_patternscale_a),u_patternscale_b:new s.Uniform2f(f,t.u_patternscale_b),u_sdfgamma:new s.Uniform1f(f,t.u_sdfgamma),u_image:new s.Uniform1i(f,t.u_image),u_tex_y_a:new s.Uniform1f(f,t.u_tex_y_a),u_tex_y_b:new s.Uniform1f(f,t.u_tex_y_b),u_mix:new s.Uniform1f(f,t.u_mix)}),raster:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_tl_parent:new s.Uniform2f(f,t.u_tl_parent),u_scale_parent:new s.Uniform1f(f,t.u_scale_parent),u_buffer_scale:new s.Uniform1f(f,t.u_buffer_scale),u_fade_t:new s.Uniform1f(f,t.u_fade_t),u_opacity:new s.Uniform1f(f,t.u_opacity),u_image0:new s.Uniform1i(f,t.u_image0),u_image1:new s.Uniform1i(f,t.u_image1),u_brightness_low:new s.Uniform1f(f,t.u_brightness_low),u_brightness_high:new s.Uniform1f(f,t.u_brightness_high),u_saturation_factor:new s.Uniform1f(f,t.u_saturation_factor),u_contrast_factor:new s.Uniform1f(f,t.u_contrast_factor),u_spin_weights:new s.Uniform3f(f,t.u_spin_weights)}),symbolIcon:(f,t)=>({u_is_size_zoom_constant:new s.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(f,t.u_size_t),u_size:new s.Uniform1f(f,t.u_size),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(f,t.u_pitch),u_rotate_symbol:new s.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(f,t.u_fade_change),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new s.Uniform1i(f,t.u_is_text),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_texsize:new s.Uniform2f(f,t.u_texsize),u_texture:new s.Uniform1i(f,t.u_texture)}),symbolSDF:(f,t)=>({u_is_size_zoom_constant:new s.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(f,t.u_size_t),u_size:new s.Uniform1f(f,t.u_size),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(f,t.u_pitch),u_rotate_symbol:new s.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(f,t.u_fade_change),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new s.Uniform1i(f,t.u_is_text),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_texsize:new s.Uniform2f(f,t.u_texsize),u_texture:new s.Uniform1i(f,t.u_texture),u_gamma_scale:new s.Uniform1f(f,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(f,t.u_is_halo)}),symbolTextAndIcon:(f,t)=>({u_is_size_zoom_constant:new s.Uniform1i(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(f,t.u_is_size_feature_constant),u_size_t:new s.Uniform1f(f,t.u_size_t),u_size:new s.Uniform1f(f,t.u_size),u_camera_to_center_distance:new s.Uniform1f(f,t.u_camera_to_center_distance),u_pitch:new s.Uniform1f(f,t.u_pitch),u_rotate_symbol:new s.Uniform1i(f,t.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(f,t.u_aspect_ratio),u_fade_change:new s.Uniform1f(f,t.u_fade_change),u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(f,t.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(f,t.u_coord_matrix),u_is_text:new s.Uniform1i(f,t.u_is_text),u_pitch_with_map:new s.Uniform1i(f,t.u_pitch_with_map),u_texsize:new s.Uniform2f(f,t.u_texsize),u_texsize_icon:new s.Uniform2f(f,t.u_texsize_icon),u_texture:new s.Uniform1i(f,t.u_texture),u_texture_icon:new s.Uniform1i(f,t.u_texture_icon),u_gamma_scale:new s.Uniform1f(f,t.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(f,t.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(f,t.u_is_halo)}),background:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_opacity:new s.Uniform1f(f,t.u_opacity),u_color:new s.UniformColor(f,t.u_color)}),backgroundPattern:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_opacity:new s.Uniform1f(f,t.u_opacity),u_image:new s.Uniform1i(f,t.u_image),u_pattern_tl_a:new s.Uniform2f(f,t.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(f,t.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(f,t.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(f,t.u_pattern_br_b),u_texsize:new s.Uniform2f(f,t.u_texsize),u_mix:new s.Uniform1f(f,t.u_mix),u_pattern_size_a:new s.Uniform2f(f,t.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(f,t.u_pattern_size_b),u_scale_a:new s.Uniform1f(f,t.u_scale_a),u_scale_b:new s.Uniform1f(f,t.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(f,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(f,t.u_tile_units_to_pixels)}),terrain:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_texture:new s.Uniform1i(f,t.u_texture)}),terrainDepth:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix)}),terrainCoords:(f,t)=>({u_matrix:new s.UniformMatrix4f(f,t.u_matrix),u_texture:new s.Uniform1i(f,t.u_texture),u_terrain_coords_id:new s.Uniform1f(f,t.u_terrain_coords_id)})};class co{constructor(t,l,h){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const uo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ho{constructor(t,l,h,m){this.length=l.length,this.attributes=h,this.itemSize=l.bytesPerElement,this.dynamicDraw=m,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let h=0;h<this.attributes.length;h++){const m=l.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,l,h){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],w=l.attributes[v.name];w!==void 0&&t.vertexAttribPointer(w,v.components,t[uo[v.type]],!1,this.itemSize,v.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ai{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Il extends Ai{getDefault(){return s.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qc extends Ai{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ja extends Ai{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Za extends Ai{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class kl extends Ai{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class qn extends Ai{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class fo extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Is extends Ai{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ks extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class po extends Ai{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class mo extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ts extends Ai{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class go extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class _o extends Ai{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Es extends Ai{getDefault(){return s.Color.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Tl extends Ai{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class El extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class Ia extends Ai{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Gc extends Ai{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class jc extends Ai{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Zc extends Ai{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Xc extends Ai{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Wc extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Hc extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yo extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class As extends Ai{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vo extends Ai{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class bo extends Ai{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class ka extends Ai{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Al extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Sl extends Ai{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ss extends Ai{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class ta extends Ss{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Cl extends Ss{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ta{constructor(t,l,h,m){this.context=t,this.width=l,this.height=h;const v=t.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new ta(t,w),m&&(this.depthAttachment=new Cl(t,w)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class Ui{constructor(t,l,h){this.blendFunction=t,this.blendColor=l,this.mask=h}}Ui.Replace=[1,0],Ui.disabled=new Ui(Ui.Replace,s.Color.transparent,[!1,!1,!1,!1]),Ui.unblended=new Ui(Ui.Replace,s.Color.transparent,[!0,!0,!0,!0]),Ui.alphaBlended=new Ui([1,771],s.Color.transparent,[!0,!0,!0,!0]);class Ml{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Il(this),this.clearDepth=new qc(this),this.clearStencil=new ja(this),this.colorMask=new Za(this),this.depthMask=new kl(this),this.stencilMask=new qn(this),this.stencilFunc=new fo(this),this.stencilOp=new Is(this),this.stencilTest=new ks(this),this.depthRange=new po(this),this.depthTest=new mo(this),this.depthFunc=new Ts(this),this.blend=new go(this),this.blendFunc=new _o(this),this.blendColor=new Es(this),this.blendEquation=new Tl(this),this.cullFace=new El(this),this.cullFaceSide=new Ia(this),this.frontFace=new Gc(this),this.program=new jc(this),this.activeTexture=new Zc(this),this.viewport=new Xc(this),this.bindFramebuffer=new Wc(this),this.bindRenderbuffer=new Hc(this),this.bindTexture=new yo(this),this.bindVertexBuffer=new As(this),this.bindElementBuffer=new vo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bo(this),this.pixelStoreUnpack=new ka(this),this.pixelStoreUnpackPremultiplyAlpha=new Al(this),this.pixelStoreUnpackFlipY=new Sl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new co(this,t,l)}createVertexBuffer(t,l,h){return new ho(this,t,l,h)}createRenderbuffer(t,l,h){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,t,l,h),this.bindRenderbuffer.set(null),v}createFramebuffer(t,l,h){return new Ta(this,t,l,h)}clear({color:t,depth:l}){const h=this.gl;let m=0;t&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),h.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){A(t.blendFunction,Ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class _i{constructor(t,l,h){this.func=t,this.mask=l,this.range=h}}_i.ReadOnly=!1,_i.ReadWrite=!0,_i.disabled=new _i(519,_i.ReadOnly,[0,1]);const Si=7680;class Ni{constructor(t,l,h,m,v,w){this.test=t,this.ref=l,this.mask=h,this.fail=m,this.depthFail=v,this.pass=w}}Ni.disabled=new Ni({func:519,mask:0},0,0,Si,Si,Si);class Zi{constructor(t,l,h){this.enable=t,this.mode=l,this.frontFace=h}}let Xa;function Ea(f,t,l,h,m,v,w){const M=f.context,z=M.gl,P=f.useProgram("collisionBox"),R=[];let N=0,G=0;for(let oe=0;oe<h.length;oe++){const Oe=h[oe],Le=t.getTile(Oe),We=Le.getBucket(l);if(!We)continue;let He=Oe.posMatrix;m[0]===0&&m[1]===0||(He=f.translatePosMatrix(Oe.posMatrix,Le,m,v));const dt=w?We.textCollisionBox:We.iconCollisionBox,Ge=We.collisionCircleArray;if(Ge.length>0){const Ct=s.create(),xt=He;s.mul(Ct,We.placementInvProjMatrix,f.transform.glCoordMatrix),s.mul(Ct,Ct,We.placementViewportMatrix),R.push({circleArray:Ge,circleOffset:G,transform:xt,invTransform:Ct,coord:Oe}),N+=Ge.length/4,G=N}dt&&P.draw(M,z.LINES,_i.disabled,Ni.disabled,f.colorModeForRenderPass(),Zi.disabled,ea(He,f.transform,Le),f.style.terrain&&f.style.terrain.getTerrainData(Oe),l.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,null,f.transform.zoom,null,null,dt.collisionVertexBuffer)}if(!w||!R.length)return;const re=f.useProgram("collisionCircle"),te=new s.CollisionCircleLayoutArray;te.resize(4*N),te._trim();let ie=0;for(const oe of R)for(let Oe=0;Oe<oe.circleArray.length/4;Oe++){const Le=4*Oe,We=oe.circleArray[Le+0],He=oe.circleArray[Le+1],dt=oe.circleArray[Le+2],Ge=oe.circleArray[Le+3];te.emplace(ie++,We,He,dt,Ge,0),te.emplace(ie++,We,He,dt,Ge,1),te.emplace(ie++,We,He,dt,Ge,2),te.emplace(ie++,We,He,dt,Ge,3)}(!Xa||Xa.length<2*N)&&(Xa=function(oe){const Oe=2*oe,Le=new s.QuadTriangleArray;Le.resize(Oe),Le._trim();for(let We=0;We<Oe;We++){const He=6*We;Le.uint16[He+0]=4*We+0,Le.uint16[He+1]=4*We+1,Le.uint16[He+2]=4*We+2,Le.uint16[He+3]=4*We+2,Le.uint16[He+4]=4*We+3,Le.uint16[He+5]=4*We+0}return Le}(N));const xe=M.createIndexBuffer(Xa,!0),Te=M.createVertexBuffer(te,s.collisionCircleLayout.members,!0);for(const oe of R){const Oe={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(De=f.transform).cameraToCenterDistance,u_viewport_size:[De.width,De.height]};re.draw(M,z.TRIANGLES,_i.disabled,Ni.disabled,f.colorModeForRenderPass(),Zi.disabled,Oe,f.style.terrain&&f.style.terrain.getTerrainData(oe.coord),l.id,Te,xe,s.SegmentVector.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,f.transform.zoom,null,null,null)}var De;Te.destroy(),xe.destroy()}Zi.disabled=new Zi(!1,1029,2305),Zi.backCCW=new Zi(!0,1029,2305);const Kc=s.identity(new Float32Array(16));function Yc(f,t,l,h,m,v){const{horizontalAlign:w,verticalAlign:M}=s.getAnchorAlignment(f),z=-(w-.5)*t,P=-(M-.5)*l,R=s.evaluateVariableOffset(f,h);return new s.pointGeometry((z/m+R[0])*v,(P/m+R[1])*v)}function zl(f,t,l,h,m,v,w,M,z,P,R){const N=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,re=f.icon.dynamicLayoutVertexArray,te={};G.clear();for(let ie=0;ie<N.length;ie++){const xe=N.get(ie),Te=f.allowVerticalPlacement&&!xe.placedOrientation,De=xe.hidden||!xe.crossTileID||Te?null:h[xe.crossTileID];if(De){const oe=new s.pointGeometry(xe.anchorX,xe.anchorY),Oe=wi(oe,l?w:v,R),Le=Jn(m.cameraToCenterDistance,Oe.signedDistanceFromCamera);let We=s.evaluateSizeForFeature(f.textSizeData,z,xe)*Le/s.ONE_EM;l&&(We*=f.tilePixelRatio/M);const{width:He,height:dt,anchor:Ge,textOffset:Ct,textBoxScale:xt}=De,zt=Yc(Ge,He,dt,Ct,xt,We),ai=l?wi(oe.add(zt),v,R).point:Oe.point.add(t?zt.rotate(-m.angle):zt),hi=f.allowVerticalPlacement&&xe.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let jt=0;jt<xe.numGlyphs;jt++)s.addDynamicAttributes(G,ai,hi);P&&xe.associatedIconIndex>=0&&(te[xe.associatedIconIndex]={shiftedAnchor:ai,angle:hi})}else ii(xe.numGlyphs,G)}if(P){re.clear();const ie=f.icon.placedSymbolArray;for(let xe=0;xe<ie.length;xe++){const Te=ie.get(xe);if(Te.hidden)ii(Te.numGlyphs,re);else{const De=te[xe];if(De)for(let oe=0;oe<Te.numGlyphs;oe++)s.addDynamicAttributes(re,De.shiftedAnchor,De.angle);else ii(Te.numGlyphs,re)}}f.icon.dynamicLayoutVertexBuffer.updateData(re)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function Jc(f,t,l){return l.iconsInText&&t?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Cs(f,t,l,h,m,v,w,M,z,P,R,N){const G=f.context,re=G.gl,te=f.transform,ie=M==="map",xe=z==="map",Te=M!=="viewport"&&l.layout.get("symbol-placement")!=="point",De=ie&&!xe&&!Te,oe=!l.layout.get("symbol-sort-key").isConstant();let Oe=!1;const Le=f.depthModeForSublayer(0,_i.ReadOnly),We=l.layout.get("text-variable-anchor"),He=[];for(const dt of h){const Ge=t.getTile(dt),Ct=Ge.getBucket(l);if(!Ct)continue;const xt=m?Ct.text:Ct.icon;if(!xt||!xt.segments.get().length)continue;const zt=xt.programConfigurations.get(l.id),ai=m||Ct.sdfIcons,hi=m?Ct.textSizeData:Ct.iconSizeData,jt=xe||te.pitch!==0,zi=f.useProgram(Jc(ai,m,Ct),zt),Di=s.evaluateSizeForZoom(hi,te.zoom),yi=f.style.terrain&&f.style.terrain.getTerrainData(dt);let Ti,Li,mn,gr,ar=[0,0],_r=null;if(m){if(Li=Ge.glyphAtlasTexture,mn=re.LINEAR,Ti=Ge.glyphAtlasTexture.size,Ct.iconsInText){ar=Ge.imageAtlasTexture.size,_r=Ge.imageAtlasTexture;const er=hi.kind==="composite"||hi.kind==="camera";gr=jt||f.options.rotating||f.options.zooming||er?re.LINEAR:re.NEAREST}}else{const er=l.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear;Li=Ge.imageAtlasTexture,mn=ai||f.options.rotating||f.options.zooming||er||jt?re.LINEAR:re.NEAREST,Ti=Ge.imageAtlasTexture.size}const Xr=rn(Ge,1,f.transform.zoom),$n=Yr(dt.posMatrix,xe,ie,f.transform,Xr),Bn=nr(dt.posMatrix,xe,ie,f.transform,Xr),Sr=We&&Ct.hasTextData(),Fs=l.layout.get("icon-text-fit")!=="none"&&Sr&&Ct.hasIconData();if(Te){const er=f.style.terrain?(Bo,Da)=>f.style.terrain.getElevation(dt,Bo,Da):null,aa=l.layout.get("text-rotation-alignment")==="map";Un(Ct,dt.posMatrix,f,m,$n,Bn,xe,P,aa,er)}const cn=f.translatePosMatrix(dt.posMatrix,Ge,v,w),pi=Te||m&&We||Fs?Kc:$n,Mi=f.translatePosMatrix(Bn,Ge,v,w,!0),gn=ai&&l.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let _n;_n=ai?Ct.iconsInText?wl(hi.kind,Di,De,xe,f,cn,pi,Mi,Ti,ar):ws(hi.kind,Di,De,xe,f,cn,pi,Mi,m,Ti,!0):oo(hi.kind,Di,De,xe,f,cn,pi,Mi,m,Ti);const Wi={program:zi,buffers:xt,uniformValues:_n,atlasTexture:Li,atlasTextureIcon:_r,atlasInterpolation:mn,atlasInterpolationIcon:gr,isSDF:ai,hasHalo:gn};if(oe&&Ct.canOverlap){Oe=!0;const er=xt.segments.get();for(const aa of er)He.push({segments:new s.SegmentVector([aa]),sortKey:aa.sortKey,state:Wi,terrainData:yi})}else He.push({segments:xt.segments,sortKey:0,state:Wi,terrainData:yi})}Oe&&He.sort((dt,Ge)=>dt.sortKey-Ge.sortKey);for(const dt of He){const Ge=dt.state;if(G.activeTexture.set(re.TEXTURE0),Ge.atlasTexture.bind(Ge.atlasInterpolation,re.CLAMP_TO_EDGE),Ge.atlasTextureIcon&&(G.activeTexture.set(re.TEXTURE1),Ge.atlasTextureIcon&&Ge.atlasTextureIcon.bind(Ge.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),Ge.isSDF){const Ct=Ge.uniformValues;Ge.hasHalo&&(Ct.u_is_halo=1,Wa(Ge.buffers,dt.segments,l,f,Ge.program,Le,R,N,Ct,dt.terrainData)),Ct.u_is_halo=0}Wa(Ge.buffers,dt.segments,l,f,Ge.program,Le,R,N,Ge.uniformValues,dt.terrainData)}}function Wa(f,t,l,h,m,v,w,M,z,P){const R=h.context;m.draw(R,R.gl.TRIANGLES,v,w,M,Zi.disabled,z,P,l.id,f.layoutVertexBuffer,f.indexBuffer,t,l.paint,h.transform.zoom,f.programConfigurations.get(l.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ha(f,t,l,h,m,v,w){const M=f.context.gl,z=l.paint.get("fill-pattern"),P=z&&z.constantOr(1),R=l.getCrossfadeParameters();let N,G,re,te,ie;w?(G=P&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=M.LINES):(G=P?"fillPattern":"fill",N=M.TRIANGLES);for(const xe of h){const Te=t.getTile(xe);if(P&&!Te.patternsLoaded())continue;const De=Te.getBucket(l);if(!De)continue;const oe=De.programConfigurations.get(l.id),Oe=f.useProgram(G,oe),Le=f.style.terrain&&f.style.terrain.getTerrainData(xe);P&&(f.context.activeTexture.set(M.TEXTURE0),Te.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),oe.updatePaintBuffers(R));const We=z.constantOr(null);if(We&&Te.imageAtlas){const Ge=Te.imageAtlas,Ct=Ge.patternPositions[We.to.toString()],xt=Ge.patternPositions[We.from.toString()];Ct&&xt&&oe.setConstantPatternPositions(Ct,xt)}const He=Le?xe:null,dt=f.translatePosMatrix(He?He.posMatrix:xe.posMatrix,Te,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(w){te=De.indexBuffer2,ie=De.segments2;const Ge=[M.drawingBufferWidth,M.drawingBufferHeight];re=G==="fillOutlinePattern"&&P?yl(dt,f,R,Te,Ge):_l(dt,Ge)}else te=De.indexBuffer,ie=De.segments,re=P?ao(dt,f,R,Te):ys(dt);Oe.draw(f.context,N,m,f.stencilModeForClipping(xe),v,Zi.disabled,re,Le,l.id,De.layoutVertexBuffer,te,ie,l.paint,f.transform.zoom,oe)}}function Ka(f,t,l,h,m,v,w){const M=f.context,z=M.gl,P=l.paint.get("fill-extrusion-pattern"),R=P.constantOr(1),N=l.getCrossfadeParameters(),G=l.paint.get("fill-extrusion-opacity");for(const re of h){const te=t.getTile(re),ie=te.getBucket(l);if(!ie)continue;const xe=f.style.terrain&&f.style.terrain.getTerrainData(re),Te=ie.programConfigurations.get(l.id),De=f.useProgram(R?"fillExtrusionPattern":"fillExtrusion",Te);R&&(f.context.activeTexture.set(z.TEXTURE0),te.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Te.updatePaintBuffers(N));const oe=P.constantOr(null);if(oe&&te.imageAtlas){const He=te.imageAtlas,dt=He.patternPositions[oe.to.toString()],Ge=He.patternPositions[oe.from.toString()];dt&&Ge&&Te.setConstantPatternPositions(dt,Ge)}const Oe=f.translatePosMatrix(re.posMatrix,te,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Le=l.paint.get("fill-extrusion-vertical-gradient"),We=R?Vc(Oe,f,Le,G,re,N,te):ro(Oe,f,Le,G);De.draw(M,M.gl.TRIANGLES,m,v,w,Zi.backCCW,We,xe,l.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,l.paint,f.transform.zoom,Te,f.style.terrain&&ie.centroidVertexBuffer)}}function xo(f,t,l,h,m,v,w){const M=f.context,z=M.gl,P=l.fbo;if(!P)return;const R=f.useProgram("hillshade"),N=f.style.terrain&&f.style.terrain.getTerrainData(t);M.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,P.colorAttachment.get()),R.draw(M,z.TRIANGLES,m,v,w,Zi.disabled,((G,re,te,ie)=>{const xe=te.paint.get("hillshade-shadow-color"),Te=te.paint.get("hillshade-highlight-color"),De=te.paint.get("hillshade-accent-color");let oe=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=G.transform.angle);const Oe=!G.options.moving;return{u_matrix:ie?ie.posMatrix:G.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:bs(0,re.tileID),u_light:[te.paint.get("hillshade-exaggeration"),oe],u_shadow:xe,u_highlight:Te,u_accent:De}})(f,l,h,N?t:null),N,h.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Dl(f,t,l,h,m,v){const w=f.context,M=w.gl,z=t.dem;if(z&&z.data){const P=z.dim,R=z.stride,N=z.getPixels();if(w.activeTexture.set(M.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(R),t.demTexture){const re=t.demTexture;re.update(N,{premultiply:!1}),re.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else t.demTexture=new Z(w,N,M.RGBA,{premultiply:!1}),t.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);w.activeTexture.set(M.TEXTURE0);let G=t.fbo;if(!G){const re=new Z(w,{width:P,height:P,data:null},M.RGBA);re.bind(M.LINEAR,M.CLAMP_TO_EDGE),G=t.fbo=w.createFramebuffer(P,P,!0),G.colorAttachment.set(re.texture)}w.bindFramebuffer.set(G.framebuffer),w.viewport.set([0,0,P,P]),f.useProgram("hillshadePrepare").draw(w,M.TRIANGLES,h,m,v,Zi.disabled,((re,te)=>{const ie=te.stride,xe=s.create();return s.ortho(xe,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(xe,xe,[0,-s.EXTENT,0]),{u_matrix:xe,u_image:1,u_dimension:[ie,ie],u_zoom:re.overscaledZ,u_unpack:te.getUnpackVector()}})(t.tileID,z),null,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ms(f,t,l,h,m,v){const w=h.paint.get("raster-fade-duration");if(!v&&w>0){const M=s.exported.now(),z=(M-f.timeAdded)/w,P=t?(M-t.timeAdded)/w:-1,R=l.getSource(),N=m.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),G=!t||Math.abs(t.tileID.overscaledZ-N)>Math.abs(f.tileID.overscaledZ-N),re=G&&f.refreshedUponExpiration?1:s.clamp(G?z:1-P,0,1);return f.refreshedUponExpiration&&z>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}const zs=new s.Color(1,0,0,1),rr=new s.Color(0,1,0,1),Pl=new s.Color(0,0,1,1),wo=new s.Color(1,0,1,1),Ll=new s.Color(0,1,1,1);function ia(f,t,l,h){Aa(f,0,t+l/2,f.transform.width,l,h)}function Ya(f,t,l,h){Aa(f,t-l/2,0,l,f.transform.height,h)}function Aa(f,t,l,h,m,v){const w=f.context,M=w.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*f.pixelRatio,l*f.pixelRatio,h*f.pixelRatio,m*f.pixelRatio),w.clear({color:v}),M.disable(M.SCISSOR_TEST)}function Qc(f,t,l){const h=f.context,m=h.gl,v=l.posMatrix,w=f.useProgram("debug"),M=_i.disabled,z=Ni.disabled,P=f.colorModeForRenderPass(),R="$debug",N=f.style.terrain&&f.style.terrain.getTerrainData(l);h.activeTexture.set(m.TEXTURE0),f.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE);const G=t.getTileByID(l.key).latestRawTileData,re=Math.floor((G&&G.byteLength||0)/1024),te=t.getTile(l).tileSize,ie=512/Math.min(te,512)*(l.overscaledZ/f.transform.zoom)*.5;let xe=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(xe+=` => ${l.overscaledZ}`),function(Te,De){Te.initDebugOverlayCanvas();const oe=Te.debugOverlayCanvas,Oe=Te.context.gl,Le=Te.debugOverlayCanvas.getContext("2d");Le.clearRect(0,0,oe.width,oe.height),Le.shadowColor="white",Le.shadowBlur=2,Le.lineWidth=1.5,Le.strokeStyle="white",Le.textBaseline="top",Le.font="bold 36px Open Sans, sans-serif",Le.fillText(De,5,5),Le.strokeText(De,5,5),Te.debugOverlayTexture.update(oe),Te.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(f,`${xe} ${re}kB`),w.draw(h,m.TRIANGLES,M,z,Ui.alphaBlended,Zi.disabled,Ua(v,s.Color.transparent,ie),null,R,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),w.draw(h,m.LINE_STRIP,M,z,P,Zi.disabled,Ua(v,s.Color.red),N,R,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Ds(f,t,l){const h=f.context,m=h.gl,v=f.colorModeForRenderPass(),w=new _i(m.LEQUAL,_i.ReadWrite,f.depthRangeFor3D),M=f.useProgram("terrain"),z=t.getTerrainMesh(),P=t.getTerrainData(l.tileID);h.bindFramebuffer.set(null),h.viewport.set([0,0,f.width,f.height]),h.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const R=f.transform.calculatePosMatrix(l.tileID.toUnwrapped());M.draw(h,m.TRIANGLES,w,Ni.disabled,v,Zi.backCCW,{u_matrix:R,u_texture:0},P,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}function Bl(f,t,l,h){const m=f.context,v=l.tileSize*t.qualityFactor;l.textures[h]||(l.textures[h]=f.getTileTexture(v)||new Z(m,{width:v,height:v,data:null},m.gl.RGBA),l.textures[h].bind(m.gl.LINEAR,m.gl.CLAMP_TO_EDGE),h===0&&t.sourceCache.renderHistory.unshift(l.tileID.key));const w=t.getRTTFramebuffer();w.colorAttachment.set(l.textures[h].texture),m.bindFramebuffer.set(w.framebuffer),m.viewport.set([0,0,v,v])}class Rl{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,l=t.terrain;for(const h in t.sourceCaches){this._coordsDescendingInv[h]={};const m=t.sourceCaches[h].getVisibleCoordinates();for(const v of m){const w=l.sourceCache.getTerrainCoords(v);for(const M in w)this._coordsDescendingInv[h][M]||(this._coordsDescendingInv[h][M]=[]),this._coordsDescendingInv[h][M].push(w[M])}}for(const h of t._order){const m=t._layers[h],v=m.source;if(this._renderToTexture[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const w in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][w]=this._coordsDescendingInv[v][w].map(M=>M.key).sort().join()}}return this._renderableTiles.forEach(h=>{for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][h.tileID.key];v&&v!==h.textureCoords[m]&&h.clearTextures(this.painter),l.needsRerender(m,h.tileID)&&h.clearTextures(this.painter)}this._rerender[h.tileID.key]=!h.textures.length}),l.clearRerenderCache(),l.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const l=t.type,h=this.painter,m=h.style._order,v=h.currentLayer,w=v+1===m.length;if(this._renderToTexture[l]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(m[v]),!w))return!0;if(this._renderToTexture[this._prevType]||l==="hillshade"||this._renderToTexture[l]&&w){this._prevType=l;const M=this._stacks.length-1,z=this._stacks[M]||[];for(const P of this._renderableTiles){if(Bl(h,h.style.terrain,P,M),this._rerender[P.tileID.key]){h.context.clear({color:s.Color.transparent});for(let R=0;R<z.length;R++){const N=h.style._layers[z[R]],G=N.source?this._coordsDescendingInv[N.source][P.tileID.key]:[P.tileID];h._renderTileClippingMasks(N,G),h.renderLayer(h,h.style.sourceCaches[N.source],N,G),N.source&&(P.textureCoords[N.source]=this._coordsDescendingInvStr[N.source][P.tileID.key])}}Ds(h,h.style.terrain,P)}if(l==="hillshade"){this._stacks.push([m[v]]);for(const P of this._renderableTiles){const R=this._coordsDescendingInv[t.source][P.tileID.key];Bl(h,h.style.terrain,P,this._stacks.length-1),h.context.clear({color:s.Color.transparent}),h._renderTileClippingMasks(t,R),h.renderLayer(h,h.style.sourceCaches[t.source],t,R),Ds(h,h.style.terrain,P)}return!0}return this._renderToTexture[l]}return!1}}const Ja={symbol:function(f,t,l,h,m){if(f.renderPass!=="translucent")return;const v=Ni.disabled,w=f.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(M,z,P,R,N,G,re){const te=z.transform,ie=N==="map",xe=G==="map";for(const Te of M){const De=R.getTile(Te),oe=De.getBucket(P);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const Oe=s.evaluateSizeForZoom(oe.textSizeData,te.zoom),Le=rn(De,1,z.transform.zoom),We=Yr(Te.posMatrix,xe,ie,z.transform,Le),He=P.layout.get("icon-text-fit")!=="none"&&oe.hasIconData();if(Oe){const dt=Math.pow(2,te.zoom-De.tileID.overscaledZ);zl(oe,ie,xe,re,te,We,Te.posMatrix,dt,Oe,He,z.style.terrain?(Ge,Ct)=>z.style.terrain.getElevation(Te,Ge,Ct):null)}}}(h,f,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),m),l.paint.get("icon-opacity").constantOr(1)!==0&&Cs(f,t,l,h,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,w),l.paint.get("text-opacity").constantOr(1)!==0&&Cs(f,t,l,h,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,w),t.map.showCollisionBoxes&&(Ea(f,t,l,h,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Ea(f,t,l,h,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,l,h){if(f.renderPass!=="translucent")return;const m=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),M=!l.layout.get("circle-sort-key").isConstant();if(m.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const z=f.context,P=z.gl,R=f.depthModeForSublayer(0,_i.ReadOnly),N=Ni.disabled,G=f.colorModeForRenderPass(),re=[];for(let te=0;te<h.length;te++){const ie=h[te],xe=t.getTile(ie),Te=xe.getBucket(l);if(!Te)continue;const De=Te.programConfigurations.get(l.id),oe=f.useProgram("circle",De),Oe=Te.layoutVertexBuffer,Le=Te.indexBuffer,We=f.style.terrain&&f.style.terrain.getTerrainData(ie),He={programConfiguration:De,program:oe,layoutVertexBuffer:Oe,indexBuffer:Le,uniformValues:vl(f,ie,xe,l),terrainData:We};if(M){const dt=Te.segments.get();for(const Ge of dt)re.push({segments:new s.SegmentVector([Ge]),sortKey:Ge.sortKey,state:He})}else re.push({segments:Te.segments,sortKey:0,state:He})}M&&re.sort((te,ie)=>te.sortKey-ie.sortKey);for(const te of re){const{programConfiguration:ie,program:xe,layoutVertexBuffer:Te,indexBuffer:De,uniformValues:oe,terrainData:Oe}=te.state;xe.draw(z,P.TRIANGLES,R,N,G,Zi.disabled,oe,Oe,l.id,Te,De,te.segments,l.paint,f.transform.zoom,ie)}},heatmap:function(f,t,l,h){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const m=f.context,v=m.gl,w=Ni.disabled,M=new Ui([v.ONE,v.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(z,P,R){const N=z.gl;z.activeTexture.set(N.TEXTURE1),z.viewport.set([0,0,P.width/4,P.height/4]);let G=R.heatmapFbo;if(G)N.bindTexture(N.TEXTURE_2D,G.colorAttachment.get()),z.bindFramebuffer.set(G.framebuffer);else{const re=N.createTexture();N.bindTexture(N.TEXTURE_2D,re),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),G=R.heatmapFbo=z.createFramebuffer(P.width/4,P.height/4,!1),function(te,ie,xe,Te){const De=te.gl;De.texImage2D(De.TEXTURE_2D,0,De.RGBA,ie.width/4,ie.height/4,0,De.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:De.UNSIGNED_BYTE,null),Te.colorAttachment.set(xe)}(z,P,re,G)}})(m,f,l),m.clear({color:s.Color.transparent});for(let z=0;z<h.length;z++){const P=h[z];if(t.hasRenderableParent(P))continue;const R=t.getTile(P),N=R.getBucket(l);if(!N)continue;const G=N.programConfigurations.get(l.id),re=f.useProgram("heatmap",G),{zoom:te}=f.transform;re.draw(m,v.TRIANGLES,_i.disabled,w,M,Zi.disabled,vs(P.posMatrix,R,te,l.paint.get("heatmap-intensity")),null,l.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,l.paint,f.transform.zoom,G)}m.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(m,v){const w=m.context,M=w.gl,z=v.heatmapFbo;if(!z)return;w.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,z.colorAttachment.get()),w.activeTexture.set(M.TEXTURE1);let P=v.colorRampTexture;P||(P=v.colorRampTexture=new Z(w,v.colorRamp,M.RGBA)),P.bind(M.LINEAR,M.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(w,M.TRIANGLES,_i.disabled,Ni.disabled,m.colorModeForRenderPass(),Zi.disabled,((R,N,G,re)=>{const te=s.create();s.ortho(te,0,R.width,R.height,0,0,1);const ie=R.context.gl;return{u_matrix:te,u_world:[ie.drawingBufferWidth,ie.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(m,v),null,v.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,v.paint,m.transform.zoom)}(f,l))},line:function(f,t,l,h){if(f.renderPass!=="translucent")return;const m=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(m.constantOr(1)===0||v.constantOr(1)===0)return;const w=f.depthModeForSublayer(0,_i.ReadOnly),M=f.colorModeForRenderPass(),z=l.paint.get("line-dasharray"),P=l.paint.get("line-pattern"),R=P.constantOr(1),N=l.paint.get("line-gradient"),G=l.getCrossfadeParameters(),re=R?"linePattern":z?"lineSDF":N?"lineGradient":"line",te=f.context,ie=te.gl;let xe=!0;for(const Te of h){const De=t.getTile(Te);if(R&&!De.patternsLoaded())continue;const oe=De.getBucket(l);if(!oe)continue;const Oe=oe.programConfigurations.get(l.id),Le=f.context.program.get(),We=f.useProgram(re,Oe),He=xe||We.program!==Le,dt=f.style.terrain&&f.style.terrain.getTerrainData(Te),Ge=P.constantOr(null);if(Ge&&De.imageAtlas){const zt=De.imageAtlas,ai=zt.patternPositions[Ge.to.toString()],hi=zt.patternPositions[Ge.from.toString()];ai&&hi&&Oe.setConstantPatternPositions(ai,hi)}const Ct=dt?Te:null,xt=R?xs(f,De,l,G,Ct):z?qa(f,De,l,z,G,Ct):N?so(f,De,l,oe.lineClipsArray.length,Ct):wa(f,De,l,Ct);if(R)te.activeTexture.set(ie.TEXTURE0),De.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Oe.updatePaintBuffers(G);else if(z&&(He||f.lineAtlas.dirty))te.activeTexture.set(ie.TEXTURE0),f.lineAtlas.bind(te);else if(N){const zt=oe.gradients[l.id];let ai=zt.texture;if(l.gradientVersion!==zt.version){let hi=256;if(l.stepInterpolant){const jt=t.getSource().maxzoom,zi=Te.canonical.z===jt?Math.ceil(1<<f.transform.maxZoom-Te.canonical.z):1;hi=s.clamp(s.nextPowerOfTwo(oe.maxLineLength/s.EXTENT*1024*zi),256,te.maxTextureSize)}zt.gradient=s.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:hi,image:zt.gradient||void 0,clips:oe.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new Z(te,zt.gradient,ie.RGBA),zt.version=l.gradientVersion,ai=zt.texture}te.activeTexture.set(ie.TEXTURE0),ai.bind(l.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}We.draw(te,ie.TRIANGLES,w,f.stencilModeForClipping(Te),M,Zi.disabled,xt,dt,l.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,l.paint,f.transform.zoom,Oe,oe.layoutVertexBuffer2),xe=!1}},fill:function(f,t,l,h){const m=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const w=f.colorModeForRenderPass(),M=l.paint.get("fill-pattern"),z=f.opaquePassEnabledForLayer()&&!M.constantOr(1)&&m.constantOr(s.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===z){const P=f.depthModeForSublayer(1,f.renderPass==="opaque"?_i.ReadWrite:_i.ReadOnly);Ha(f,t,l,h,P,w,!1)}if(f.renderPass==="translucent"&&l.paint.get("fill-antialias")){const P=f.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,_i.ReadOnly);Ha(f,t,l,h,P,w,!0)}},"fill-extrusion":function(f,t,l,h){const m=l.paint.get("fill-extrusion-opacity");if(m!==0&&f.renderPass==="translucent"){const v=new _i(f.context.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D);if(m!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Ka(f,t,l,h,v,Ni.disabled,Ui.disabled),Ka(f,t,l,h,v,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const w=f.colorModeForRenderPass();Ka(f,t,l,h,v,Ni.disabled,w)}}},hillshade:function(f,t,l,h){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const m=f.context,v=f.depthModeForSublayer(0,_i.ReadOnly),w=f.colorModeForRenderPass(),[M,z]=f.renderPass==="translucent"?f.stencilConfigForOverlap(h):[{},h];for(const P of z){const R=t.getTile(P);R.needsHillshadePrepare!==void 0&&R.needsHillshadePrepare&&f.renderPass==="offscreen"?Dl(f,R,l,v,Ni.disabled,w):f.renderPass==="translucent"&&xo(f,P,R,l,v,M[P.overscaledZ],w)}m.viewport.set([0,0,f.width,f.height])},raster:function(f,t,l,h){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!h.length)return;const m=f.context,v=m.gl,w=t.getSource(),M=f.useProgram("raster"),z=f.colorModeForRenderPass(),[P,R]=w instanceof Fe?[{},h]:f.stencilConfigForOverlap(h),N=R[R.length-1].overscaledZ,G=!f.options.moving;for(const re of R){const te=f.depthModeForSublayer(re.overscaledZ-N,l.paint.get("raster-opacity")===1?_i.ReadWrite:_i.ReadOnly,v.LESS),ie=t.getTile(re);ie.registerFadeDuration(l.paint.get("raster-fade-duration"));const xe=t.findLoadedParent(re,0),Te=Ms(ie,xe,t,l,f.transform,f.style.terrain);let De,oe;const Oe=l.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;m.activeTexture.set(v.TEXTURE0),ie.texture.bind(Oe,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),m.activeTexture.set(v.TEXTURE1),xe?(xe.texture.bind(Oe,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),De=Math.pow(2,xe.tileID.overscaledZ-ie.tileID.overscaledZ),oe=[ie.tileID.canonical.x*De%1,ie.tileID.canonical.y*De%1]):ie.texture.bind(Oe,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const Le=f.style.terrain&&f.style.terrain.getTerrainData(re),We=Le?re:null,He=We?We.posMatrix:f.transform.calculatePosMatrix(re.toUnwrapped(),G),dt=bl(He,oe||[0,0],De||1,Te,l);w instanceof Fe?M.draw(m,v.TRIANGLES,te,Ni.disabled,z,Zi.disabled,dt,Le,l.id,w.boundsBuffer,f.quadTriangleIndexBuffer,w.boundsSegments):M.draw(m,v.TRIANGLES,te,P[re.overscaledZ],z,Zi.disabled,dt,Le,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,t,l,h){const m=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;const w=f.context,M=w.gl,z=f.transform,P=z.tileSize,R=l.paint.get("background-pattern");if(f.isPatternMissing(R))return;const N=!R&&m.a===1&&v===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==N)return;const G=Ni.disabled,re=f.depthModeForSublayer(0,N==="opaque"?_i.ReadWrite:_i.ReadOnly),te=f.colorModeForRenderPass(),ie=f.useProgram(R?"backgroundPattern":"background"),xe=h||z.coveringTiles({tileSize:P,terrain:f.style.terrain});R&&(w.activeTexture.set(M.TEXTURE0),f.imageManager.bind(f.context));const Te=l.getCrossfadeParameters();for(const De of xe){const oe=h?De.posMatrix:f.transform.calculatePosMatrix(De.toUnwrapped()),Oe=R?Uc(oe,v,f,R,{tileID:De,tileSize:P},Te):Nc(oe,v,m),Le=f.style.terrain&&f.style.terrain.getTerrainData(De);ie.draw(w,M.TRIANGLES,re,G,te,Zi.disabled,Oe,Le,l.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}},debug:function(f,t,l){for(let h=0;h<l.length;h++)Qc(f,t,l[h])},custom:function(f,t,l){const h=f.context,m=l.implementation;if(f.renderPass==="offscreen"){const v=m.prerender;v&&(f.setCustomLayerDefaults(),h.setColorMode(f.colorModeForRenderPass()),v.call(m,h.gl,f.transform.customLayerMatrix()),h.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),h.setColorMode(f.colorModeForRenderPass()),h.setStencilMode(Ni.disabled);const v=m.renderingMode==="3d"?new _i(f.context.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,_i.ReadOnly);h.setDepthMode(v),m.render(h.gl,f.transform.customLayerMatrix()),h.setDirty(),f.setBaseState(),h.bindFramebuffer.set(null)}}};class Io{constructor(t,l){this.context=new Ml(t),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.create(),renderTime:0},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kt,this.gpuTimers={}}resize(t,l,h){if(this.width=t*h,this.height=l*h,this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,l=new s.PosArray;l.emplaceBack(0,0),l.emplaceBack(s.EXTENT,0),l.emplaceBack(0,s.EXTENT),l.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(l,Ii.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const h=new s.PosArray;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=t.createVertexBuffer(h,Ii.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const m=new s.RasterBoundsArray;m.emplaceBack(0,0,0,0),m.emplaceBack(s.EXTENT,0,s.EXTENT,0),m.emplaceBack(0,s.EXTENT,0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(m,nt.members),this.rasterBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const v=new s.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,Ii.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.LineStripIndexArray;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const M=new s.TriangleIndexArray;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new Z(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const z=this.context.gl;this.stencilClearMode=new Ni({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=s.create();s.ortho(h,0,this.width,this.height,0,0,1),s.scale(h,h,[l.drawingBufferWidth,l.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,l.TRIANGLES,_i.disabled,this.stencilClearMode,Ui.disabled,Zi.disabled,xa(h),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!l||!l.length)return;this.currentStencilSource=t.source;const h=this.context,m=h.gl;this.nextStencilID+l.length>256&&this.clearStencil(),h.setColorMode(Ui.disabled),h.setDepthMode(_i.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of l){const M=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,z=this.style.terrain&&this.style.terrain.getTerrainData(w);v.draw(h,m.TRIANGLES,_i.disabled,new Ni({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),Ui.disabled,Zi.disabled,xa(w.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new Ni({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){const l=this.context.gl;return new Ni({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,h=t.sort((w,M)=>M.overscaledZ-w.overscaledZ),m=h[h.length-1].overscaledZ,v=h[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let M=0;M<v;M++)w[M+m]=new Ni({func:l.GEQUAL,mask:255},M+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[w,h]}return[{[m]:Ni.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ui([t.CONSTANT_COLOR,t.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ui.unblended:Ui.alphaBlended}depthModeForSublayer(t,l,h){if(!this.opaquePassEnabledForLayer())return _i.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _i(h||this.context.gl.LEQUAL,l,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const h=this.style._order,m=this.style.sourceCaches,v=this.style.terrain&&new Rl(this);for(const P in m){const R=m[P];R.used&&R.prepare(this.context)}const w={},M={},z={};for(const P in m){const R=m[P];w[P]=R.getVisibleCoordinates(),M[P]=w[P].slice().reverse(),z[P]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<h.length;P++)if(this.style._layers[h[P]].is3D()){this.opaquePassCutoff=P;break}if(v){this.opaquePassCutoff=0;const P=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(s.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(R,N){const G=R.context,re=G.gl,te=Ui.unblended,ie=new _i(re.LEQUAL,_i.ReadWrite,[0,1]),xe=N.getTerrainMesh(),Te=N.sourceCache.getRenderableTiles(),De=R.useProgram("terrainDepth");G.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),G.viewport.set([0,0,R.width/devicePixelRatio,R.height/devicePixelRatio]),G.clear({color:s.Color.transparent,depth:1});for(const oe of Te){const Oe=N.getTerrainData(oe.tileID),Le=R.transform.calculatePosMatrix(oe.tileID.toUnwrapped());De.draw(G,re.TRIANGLES,ie,Ni.disabled,te,Zi.backCCW,{u_matrix:Le},Oe,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments)}G.bindFramebuffer.set(null),G.viewport.set([0,0,R.width,R.height])}(this,this.style.terrain),function(R,N){const G=R.context,re=G.gl,te=Ui.unblended,ie=new _i(re.LEQUAL,_i.ReadWrite,[0,1]),xe=N.getTerrainMesh(),Te=N.getCoordsTexture(),De=N.sourceCache.getRenderableTiles(),oe=R.useProgram("terrainCoords");G.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),G.viewport.set([0,0,R.width/devicePixelRatio,R.height/devicePixelRatio]),G.clear({color:s.Color.transparent,depth:1}),N.coordsIndex=[];for(const Oe of De){const Le=N.getTerrainData(Oe.tileID);G.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,Te.texture);const We=R.transform.calculatePosMatrix(Oe.tileID.toUnwrapped());oe.draw(G,re.TRIANGLES,ie,Ni.disabled,te,Zi.backCCW,{u_matrix:We,u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0},Le,"terrain",xe.vertexBuffer,xe.indexBuffer,xe.segments),N.coordsIndex.push(Oe.tileID.key)}G.bindFramebuffer.set(null),G.viewport.set([0,0,R.width,R.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const P of h){const R=this.style._layers[P];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const N=M[R.source];(R.type==="custom"||N.length)&&this.renderLayer(this,m[R.source],R,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[h[this.currentLayer]],R=m[P.source],N=w[P.source];this._renderTileClippingMasks(P,N),this.renderLayer(this,R,P,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const P=this.style._layers[h[this.currentLayer]],R=m[P.source];if(v&&v.renderLayer(P))continue;const N=(P.type==="symbol"?z:M)[P.source];this._renderTileClippingMasks(P,w[P.source]),this.renderLayer(this,R,P,N)}if(this.options.showTileBoundaries){let P,R;Object.values(this.style._layers).forEach(N=>{N.source&&!N.isHidden(this.transform.zoom)&&(N.source!==(R&&R.id)&&(R=this.style.sourceCaches[N.source]),(!P||P.getSource().maxzoom<R.getSource().maxzoom)&&(P=R))}),P&&Ja.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const R=P.transform.padding;ia(P,P.transform.height-(R.top||0),3,zs),ia(P,R.bottom||0,3,rr),Ya(P,R.left||0,3,Pl),Ya(P,P.transform.width-(R.right||0),3,wo);const N=P.transform.centerPoint;(function(G,re,te,ie){Aa(G,re-1,te-10,2,20,ie),Aa(G,re-10,te-1,20,2,ie)})(P,N.x,P.transform.height-N.y,Ll)}(this),this.context.setDefault()}renderLayer(t,l,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(m||[]).length)&&(this.id=h.id,this.gpuTimingStart(h),Ja[h.type](t,l,h,m,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let h=this.gpuTimers[t.id];h||(h=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),h.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,h.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const l={};for(const h in t){const m=t[h],v=this.context.extTimerQuery,w=v.getQueryObjectEXT(m.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(m.query),l[h]=w}return l}translatePosMatrix(t,l,h,m,v){if(!h[0]&&!h[1])return t;const w=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(w){const P=Math.sin(w),R=Math.cos(w);h=[h[0]*R-h[1]*P,h[0]*P+h[1]*R]}const M=[v?h[0]:rn(l,h[0],this.transform.zoom),v?h[1]:rn(l,h[1],this.transform.zoom),0],z=new Float32Array(16);return s.translate(z,t,M),z}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!l||!h}useProgram(t,l){this.cache=this.cache||{};const h=t+(l?l.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[h]||(this.cache[h]=new ml(this.context,t,Na[t],l,lo[t],this._showOverdrawInspector,this.style.terrain)),this.cache[h]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Z(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ps{constructor(t,l){this.points=t,this.planes=l}static fromInvProjectionMatrix(t,l,h){const m=Math.pow(2,h),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const z=1/(M=s.transformMat4([],M,t))[3]/l*m;return s.mul$1(M,M,[z,z,1/M[3],z])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const z=s.sub([],v[M[0]],v[M[1]]),P=s.sub([],v[M[2]],v[M[1]]),R=s.normalize([],s.cross([],z,P)),N=-s.dot(R,v[M[1]]);return R.concat(N)});return new Ps(v,w)}}class Qa{constructor(t,l){this.min=t,this.max=l,this.center=s.scale$1([],s.add([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],h=s.clone$2(this.min),m=s.clone$2(this.max);for(let v=0;v<l.length;v++)h[v]=l[v]?this.min[v]:this.center[v],m[v]=l[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Qa(h,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const l=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let m=0;m<t.planes.length;m++){const v=t.planes[m];let w=0;for(let M=0;M<l.length;M++)s.dot$1(v,l[M])>=0&&w++;if(w===0)return 0;w!==l.length&&(h=!1)}if(h)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let M=0;M<t.points.length;M++){const z=t.points[M][m]-this.min[m];v=Math.min(v,z),w=Math.max(w,z)}if(w<0||v>this.max[m]-this.min[m])return 0}return 1}}class Sa{constructor(t=0,l=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=h,this.right=m}interpolate(t,l,h){return l.top!=null&&t.top!=null&&(this.top=s.number(t.top,l.top,h)),l.bottom!=null&&t.bottom!=null&&(this.bottom=s.number(t.bottom,l.bottom,h)),l.left!=null&&t.left!=null&&(this.left=s.number(t.left,l.left,h)),l.right!=null&&t.right!=null&&(this.right=s.number(t.right,l.right,h)),this}getCenter(t,l){const h=s.clamp((this.left+t-this.right)/2,0,t),m=s.clamp((this.top+l-this.bottom)/2,0,l);return new s.pointGeometry(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Sa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class $a{constructor(t,l,h,m,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Sa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new $a(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const l=-s.wrap(t,-180,180)*Math.PI/180;var h;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(h=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,v,w){var M=v[0],z=v[1],P=v[2],R=v[3],N=Math.sin(w),G=Math.cos(w);m[0]=M*G+P*N,m[1]=z*G+R*N,m[2]=M*-N+P*G,m[3]=z*-N+R*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=s.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,h){this._unmodified=!1,this._edgeInsets.interpolate(t,l,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new s.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const h=this.pointCoordinate(new s.pointGeometry(0,0)),m=this.pointCoordinate(new s.pointGeometry(this.width,0)),v=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new s.pointGeometry(0,this.height)),M=Math.floor(Math.min(h.x,m.x,v.x,w.x)),z=Math.floor(Math.max(h.x,m.x,v.x,w.x)),P=1;for(let R=M-P;R<=z+P;R++)R!==0&&l.push(new s.UnwrappedTileID(R,t))}return l}coveringTiles(t){var l,h;let m=this.coveringZoomLevel(t);const v=m;if(t.minzoom!==void 0&&m<t.minzoom)return[];t.maxzoom!==void 0&&m>t.maxzoom&&(m=t.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),M=s.MercatorCoordinate.fromLngLat(this.center),z=Math.pow(2,m),P=[z*w.x,z*w.y,0],R=[z*M.x,z*M.y,0],N=Ps.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let G=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(G=m);const re=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,te=oe=>({aabb:new Qa([oe*z,0,0],[(oe+1)*z,z,0]),zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),ie=[],xe=[],Te=m,De=t.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let oe=1;oe<=3;oe++)ie.push(te(-oe)),ie.push(te(oe));for(ie.push(te(0));ie.length>0;){const oe=ie.pop(),Oe=oe.x,Le=oe.y;let We=oe.fullyVisible;if(!We){const zt=oe.aabb.intersects(N);if(zt===0)continue;We=zt===2}const He=t.terrain?P:R,dt=oe.aabb.distanceX(He),Ge=oe.aabb.distanceY(He),Ct=Math.max(Math.abs(dt),Math.abs(Ge)),xt=re+(1<<Te-oe.zoom)-2;if(oe.zoom===Te||Ct>xt&&oe.zoom>=G){const zt=Te-oe.zoom,ai=P[0]-.5-(Oe<<zt),hi=P[1]-.5-(Le<<zt);xe.push({tileID:new s.OverscaledTileID(oe.zoom===Te?De:oe.zoom,oe.wrap,oe.zoom,Oe,Le),distanceSq:s.sqrLen([R[0]-.5-Oe,R[1]-.5-Le]),tileDistanceToCamera:Math.sqrt(ai*ai+hi*hi)})}else for(let zt=0;zt<4;zt++){const ai=(Oe<<1)+zt%2,hi=(Le<<1)+(zt>>1),jt=oe.zoom+1;let zi=oe.aabb.quadrant(zt);if(t.terrain){const Di=new s.OverscaledTileID(jt,oe.wrap,jt,ai,hi),yi=t.terrain.getMinMaxElevation(Di),Ti=(l=yi.minElevation)!==null&&l!==void 0?l:this.elevation,Li=(h=yi.maxElevation)!==null&&h!==void 0?h:this.elevation;zi=new Qa([zi.min[0],zi.min[1],Ti],[zi.max[0],zi.max[1],Li])}ie.push({aabb:zi,zoom:jt,x:ai,y:hi,wrap:oe.wrap,fullyVisible:We})}}return xe.sort((oe,Oe)=>oe.distanceSq-Oe.distanceSq).map(oe=>oe.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const l=s.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.pointGeometry(s.mercatorXfromLng(t.lng)*this.worldSize,s.mercatorYfromLat(l)*this.worldSize)}unproject(t){return new s.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,l){const h=s.MercatorCoordinate.fromLngLat(t),m=(1<<this.tileZoom)*s.EXTENT,v=h.x*m,w=h.y*m,M=Math.floor(v/s.EXTENT),z=Math.floor(w/s.EXTENT),P=new s.OverscaledTileID(this.tileZoom,0,this.tileZoom,M,z);return l.getElevation(P,v%s.EXTENT,w%s.EXTENT,s.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const l=this.pointLocation(this.centerPoint,t),h=this.getElevation(l,t);if(!(this.elevation-h))return;const m=this.getCameraPosition(),v=s.MercatorCoordinate.fromLngLat(m.lngLat,m.altitude),w=s.MercatorCoordinate.fromLngLat(l,h),M=v.x-w.x,z=v.y-w.y,P=v.z-w.z,R=Math.sqrt(M*M+z*z+P*P),N=this.scaleZoom(this.cameraToCenterDistance/R/this.tileSize);this._elevation=h,this._center=l,this.zoom=N}setLocationAtPoint(t,l){const h=this.pointCoordinate(l),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(t),w=new s.MercatorCoordinate(v.x-(h.x-m.x),v.y-(h.y-m.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,l){return l?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,l),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,l){return this.coordinateLocation(this.pointCoordinate(t,l))}locationCoordinate(t){return s.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,l){if(l){const G=l.pointCoordinate(t);if(G!=null)return G}const h=[t.x,t.y,0,1],m=[t.x,t.y,1,1];s.transformMat4(h,h,this.pixelMatrixInverse),s.transformMat4(m,m,this.pixelMatrixInverse);const v=h[3],w=m[3],M=h[1]/v,z=m[1]/w,P=h[2]/v,R=m[2]/w,N=P===R?0:(0-P)/(R-P);return new s.MercatorCoordinate(s.number(h[0]/v,m[0]/w,N)/this.worldSize,s.number(M,z,N)/this.worldSize)}coordinatePoint(t,l=0,h=this.pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,l,1];return s.transformMat4(m,m,h),new s.pointGeometry(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new s.LngLatBounds().extend(this.pointLocation(new s.pointGeometry(0,t))).extend(this.pointLocation(new s.pointGeometry(this.width,t))).extend(this.pointLocation(new s.pointGeometry(this.width,this.height))).extend(this.pointLocation(new s.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new s.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,l=!1){const h=t.key,m=l?this._alignedPosMatrixCache:this._posMatrixCache;if(m[h])return m[h];const v=t.canonical,w=this.worldSize/this.zoomScale(v.z),M=v.x+Math.pow(2,v.z)*t.wrap,z=s.identity(new Float64Array(16));return s.translate(z,z,[M*w,v.y*w,0]),s.scale(z,z,[w/s.EXTENT,w/s.EXTENT,1]),s.multiply(z,l?this.alignedProjMatrix:this.projMatrix,z),m[h]=new Float32Array(z),m[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,l,h,m,v=-90,w=90,M=-180,z=180;const P=this.size,R=this._unmodified;if(this.latRange){const re=this.latRange;v=s.mercatorYfromLat(re[1])*this.worldSize,w=s.mercatorYfromLat(re[0])*this.worldSize,t=w-v<P.y?P.y/(w-v):0}if(this.lngRange){const re=this.lngRange;M=s.wrap(s.mercatorXfromLng(re[0])*this.worldSize,0,this.worldSize),z=s.wrap(s.mercatorXfromLng(re[1])*this.worldSize,0,this.worldSize),z<M&&(z+=this.worldSize),l=z-M<P.x?P.x/(z-M):0}const N=this.point,G=Math.max(l||0,t||0);if(G)return this.center=this.unproject(new s.pointGeometry(l?(z+M)/2:N.x,t?(w+v)/2:N.y)),this.zoom+=this.scaleZoom(G),this._unmodified=R,void(this._constraining=!1);if(this.latRange){const re=N.y,te=P.y/2;re-te<v&&(m=v+te),re+te>w&&(m=w-te)}if(this.lngRange){const re=(M+z)/2,te=s.wrap(N.x,re-this.worldSize/2,re+this.worldSize/2),ie=P.x/2;te-ie<M&&(h=M+ie),te+ie>z&&(h=z-ie)}h===void 0&&m===void 0||(this.center=this.unproject(new s.pointGeometry(h!==void 0?h:N.x,m!==void 0?m:N.y)).wrap()),this._unmodified=R,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,l=this.point.x,h=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let m=s.identity(new Float64Array(16));s.scale(m,m,[this.width/2,-this.height/2,1]),s.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=s.identity(new Float64Array(16)),s.scale(m,m,[1,-1,1]),s.translate(m,m,[-1,-1,0]),s.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,w=this._fov*(.5+t.y/this.height),M=Math.sin(w)*this.cameraToSeaLevelDistance/Math.sin(s.clamp(Math.PI-v-w,.01,Math.PI-.01)),z=this.getHorizon(),P=2*Math.atan(z/this.cameraToCenterDistance)*(.5+t.y/(2*z)),R=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(s.clamp(Math.PI-v-P,.01,Math.PI-.01)),N=Math.cos(Math.PI/2-this._pitch)*M+this.cameraToSeaLevelDistance,G=Math.cos(Math.PI/2-this._pitch)*R+this.cameraToSeaLevelDistance,re=1.01*Math.min(N,G),te=this.height/50;m=new Float64Array(16),s.perspective(m,this._fov,this.width/this.height,te,re),m[8]=2*-t.x/this.width,m[9]=2*t.y/this.height,s.scale(m,m,[1,-1,1]),s.translate(m,m,[0,0,-this.cameraToCenterDistance]),s.rotateX(m,m,this._pitch),s.rotateZ(m,m,this.angle),s.translate(m,m,[-l,-h,0]),this.mercatorMatrix=s.scale([],m,[this.worldSize,this.worldSize,this.worldSize]),s.scale(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,m),s.translate(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=s.invert([],m),this.pixelMatrix3D=s.multiply(new Float64Array(16),this.labelPlaneMatrix,m);const ie=this.width%2/2,xe=this.height%2/2,Te=Math.cos(this.angle),De=Math.sin(this.angle),oe=l-Math.round(l)+Te*ie+De*xe,Oe=h-Math.round(h)+Te*xe+De*ie,Le=new Float64Array(m);if(s.translate(Le,Le,[oe>.5?oe-1:oe,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=Le,m=s.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.pointGeometry(0,0)),l=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.transformMat4(l,l,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,t))}getCameraQueryGeometry(t){const l=this.getCameraPoint();if(t.length===1)return[t[0],l];{let h=l.x,m=l.y,v=l.x,w=l.y;for(const M of t)h=Math.min(h,M.x),m=Math.min(m,M.y),v=Math.max(v,M.x),w=Math.max(w,M.y);return[new s.pointGeometry(h,m),new s.pointGeometry(v,m),new s.pointGeometry(v,w),new s.pointGeometry(h,w),new s.pointGeometry(h,m)]}}}class Fl{constructor(t){this._hashName=t&&encodeURIComponent(t),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(l,h){let m=!1,v=null;const w=()=>{v=null,m&&(l(),v=setTimeout(w,300),m=!1)};return()=>(m=!0,v||w(),v)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const l=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),w=Math.round(l.lng*v)/v,M=Math.round(l.lat*v)/v,z=this._map.getBearing(),P=this._map.getPitch();let R="";if(R+=t?`/${w}/${M}/${h}`:`${h}/${M}/${w}`,(z||P)&&(R+="/"+Math.round(10*z)/10),P&&(R+=`/${Math.round(P)}`),this._hashName){const N=this._hashName;let G=!1;const re=window.location.hash.slice(1).split("&").map(te=>{const ie=te.split("=")[0];return ie===N?(G=!0,`${ie}=${R}`):te}).filter(te=>te);return G||re.push(`${N}=${R}`),`#${re.join("&")}`}return`#${R}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:l,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const es={linearity:.3,easing:s.bezier(0,0,.3,1)},Ol=s.extend({deceleration:2500,maxSpeed:1400},es),Vl=s.extend({deceleration:20,maxSpeed:1400},es),Nl=s.extend({deceleration:1e3,maxSpeed:360},es),Ca=s.extend({deceleration:1e3,maxSpeed:90},es);class Ul{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=s.exported.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(l.pan.mag()){const v=is(l.pan.mag(),h,s.extend({},Ol,t||{}));m.offset=l.pan.mult(v.amount/l.pan.mag()),m.center=this._map.transform.center,ts(m,v)}if(l.zoom){const v=is(l.zoom,h,Vl);m.zoom=this._map.transform.zoom+v.amount,ts(m,v)}if(l.bearing){const v=is(l.bearing,h,Nl);m.bearing=this._map.transform.bearing+s.clamp(v.amount,-179,179),ts(m,v)}if(l.pitch){const v=is(l.pitch,h,Ca);m.pitch=this._map.transform.pitch+v.amount,ts(m,v)}if(m.zoom||m.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),s.extend(m,{noMoveStart:!0})}}function ts(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function is(f,t,l){const{maxSpeed:h,linearity:m,deceleration:v}=l,w=s.clamp(f*m/(t/1e3),-h,h),M=Math.abs(w)/(v*m);return{easing:l.easing,duration:1e3*M,amount:w*(M/2)}}class Gn extends s.Event{constructor(t,l,h,m={}){const v=S.mousePos(l.getCanvasContainer(),h),w=l.unproject(v);super(t,s.extend({point:v,lngLat:w,originalEvent:h},m)),this._defaultPrevented=!1,this.target=l}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ns extends s.Event{constructor(t,l,h){const m=t==="touchend"?h.changedTouches:h.touches,v=S.touchPos(l.getCanvasContainer(),m),w=v.map(z=>l.unproject(z)),M=v.reduce((z,P,R,N)=>z.add(P.div(N.length)),new s.pointGeometry(0,0));super(t,{points:v,point:M,lngLats:w,lngLat:l.unproject(M),originalEvent:h}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class jn extends s.Event{constructor(t,l,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class $c{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new jn(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new Gn(t.type,this._map,t))}mouseup(t){this._map.fire(new Gn(t.type,this._map,t))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new Gn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Gn(t.type,this._map,t))}mouseover(t){this._map.fire(new Gn(t.type,this._map,t))}mouseout(t){this._map.fire(new Gn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ns(t.type,this._map,t))}touchmove(t){this._map.fire(new ns(t.type,this._map,t))}touchend(t){this._map.fire(new ns(t.type,this._map,t))}touchcancel(t){this._map.fire(new ns(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Gn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Gn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ql{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&t.button===0&&(S.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const h=l;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=S.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(m.x,h.x),w=Math.max(m.x,h.x),M=Math.min(m.y,h.y),z=Math.max(m.y,h.y);S.setTransform(this._box,`translate(${v}px,${M}px)`),this._box.style.width=w-v+"px",this._box.style.height=z-M+"px"}mouseupWindow(t,l){if(!this._active||t.button!==0)return;const h=this._startPos,m=l;if(this.reset(),S.suppressClick(),h.x!==m.x||h.y!==m.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new s.Event(t,{originalEvent:l}))}}function Er(f,t){if(f.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${t.length}`);const l={};for(let h=0;h<f.length;h++)l[f[h].identifier]=t[h];return l}class rs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,l,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const v=new s.pointGeometry(0,0);for(const w of m)v._add(w);return v.div(m.length)}(l),this.touches=Er(h,l)))}touchmove(t,l,h){if(this.aborted||!this.centroid)return;const m=Er(h,l);for(const v in this.touches){const w=this.touches[v],M=m[v];(!M||M.dist(w)>30)&&(this.aborted=!0)}}touchend(t,l,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class ko{constructor(t){this.singleTap=new rs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,l,h){this.singleTap.touchstart(t,l,h)}touchmove(t,l,h){this.singleTap.touchmove(t,l,h)}touchend(t,l,h){const m=this.singleTap.touchend(t,l,h);if(m){const v=t.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(m)<30;if(v&&w||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class eu{constructor(){this._zoomIn=new ko({numTouches:1,numTaps:2}),this._zoomOut=new ko({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,h){this._zoomIn.touchstart(t,l,h),this._zoomOut.touchstart(t,l,h)}touchmove(t,l,h){this._zoomIn.touchmove(t,l,h),this._zoomOut.touchmove(t,l,h)}touchend(t,l,h){const m=this._zoomIn.touchend(t,l,h),v=this._zoomOut.touchend(t,l,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(m)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tu={0:1,2:2};class Ls{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const h=S.mouseButton(t);this._correctButton(t,h)&&(this._lastPoint=l,this._eventButton=h)}mousemoveWindow(t,l){const h=this._lastPoint;if(h){if(t.preventDefault(),function(m,v){const w=tu[v];return m.buttons===void 0||(m.buttons&w)!==w}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(h,l)}}mouseupWindow(t){this._lastPoint&&S.mouseButton(t)===this._eventButton&&(this._moved&&S.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class as extends Ls{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return l===0&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class Ar extends Ls{_correctButton(t,l){return l===0&&t.ctrlKey||l===2}_move(t,l){const h=.8*(l.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class Bt extends Ls{_correctButton(t,l){return l===0&&t.ctrlKey||l===2}_move(t,l){const h=-.5*(l.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class Gl{constructor(t,l){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,l,h){return this._calculateTransform(t,l,h)}touchmove(t,l,h){if(this._map._cooperativeGestures&&(this._minTouches===2&&h.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,h.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(h.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,l,h)}touchend(t,l,h){this._calculateTransform(t,l,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,h){h.length>0&&(this._active=!0);const m=Er(h,l),v=new s.pointGeometry(0,0),w=new s.pointGeometry(0,0);let M=0;for(const P in m){const R=m[P],N=this._touches[P];N&&(v._add(R),w._add(R.sub(N)),M++,m[P]=R)}if(this._touches=m,M<this._minTouches||!w.mag())return;const z=w.div(M);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class na{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,l,h){return{}}touchstart(t,l,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,h){if(!this._firstTwoTouches)return;t.preventDefault();const[m,v]=this._firstTwoTouches,w=Ur(h,l,m),M=Ur(h,l,v);if(!w||!M)return;const z=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],z,t)}touchend(t,l,h){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,w=Ur(h,l,m),M=Ur(h,l,v);w&&M||(this._active&&S.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ur(f,t,l){for(let h=0;h<f.length;h++)if(f[h].identifier===l)return t[h]}function To(f,t){return Math.log(f/t)/Math.LN2}class Tt extends na{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(To(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:To(this._distance,h),pinchAround:l}}}function Bs(f,t){return 180*f.angleWith(t)/Math.PI}class iu extends na{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Bs(this._vector,h),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,h=Bs(t,this._startVector);return Math.abs(h)<l}}function Eo(f){return Math.abs(f.y)>Math.abs(f.x)}class Ao extends na{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,l,h){super.touchstart(t,l,h),this._currentTouchCount=h.length}_start(t){this._lastPoints=t,Eo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,h){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),v=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,h.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(t,l,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,v=l.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const w=t.y>0==l.y>0;return Eo(t)&&Eo(l)&&w}}const jl={panStep:100,bearingStep:15,pitchStep:10};class Zl{constructor(){const t=jl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,h=0,m=0,v=0,w=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),w=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:M=>{const z=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:nu,zoom:l?Math.round(z)+l*(t.shiftKey?2:1):z,bearing:M.getBearing()+h*this._bearingStep,pitch:M.getPitch()+m*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function nu(f){return f*(2-f)}const Xl=4.000244140625;class So{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let l=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=s.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,l!==0&&l%Xl==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=S.mousePos(this._el,t);this._around=s.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(l)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Xl?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&z!==0&&(z=1/z);const P=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(P*z))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,h=this._startZoom,m=this._easing;let v,w=!1;if(this._type==="wheel"&&h&&m){const M=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),z=m(M);v=s.number(h,l,z),M<1?this._frameId||(this._frameId=!0):w=!0}else v=l,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=s.ease;if(this._prevEase){const h=this._prevEase,m=(s.exported.now()-h.start)/h.duration,v=h.easing(m+.01)-h.easing(m),w=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-w*w);l=s.bezier(w,M,.25,1)}return this._prevEase={start:s.exported.now(),duration:t,easing:l},l}reset(){this._active=!1}}class Co{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mo{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,l){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zo{constructor(){this._tap=new ko({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,l,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=l[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,l,h))}touchmove(t,l,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=l[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,l,h)}touchend(t,l,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,l,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ln{constructor(t,l,h){this._el=t,this._mousePan=l,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qr{constructor(t,l,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wl{constructor(t,l,h,m){this._el=t,this._touchZoom=l,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ma=f=>f.zoom||f.drag||f.pitch||f.rotate;class Do extends s.Event{}function ss(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Hl{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ul(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l),s.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,w]of this._listeners)S.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[t,l,h]of this._listeners)S.removeEventListener(t,l,t===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const l=this._map,h=l.getCanvasContainer();this._add("mapEvent",new $c(l,t));const m=l.boxZoom=new ql(l,t);this._add("boxZoom",m);const v=new eu,w=new Mo;l.doubleClickZoom=new Co(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const M=new zo;this._add("tapDragZoom",M);const z=l.touchPitch=new Ao(l);this._add("touchPitch",z);const P=new Ar(t),R=new Bt(t);l.dragRotate=new qr(t,P,R),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const N=new as(t),G=new Gl(t,l);l.dragPan=new Ln(h,N,G),this._add("mousePan",N),this._add("touchPan",G,["touchZoom","touchRotate"]);const re=new iu,te=new Tt;l.touchZoomRotate=new Wl(h,te,re,M),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);const ie=l.scrollZoom=new So(l,this);this._add("scrollZoom",ie,["mousePan"]);const xe=l.keyboard=new Zl;this._add("keyboard",xe),this._add("blockableMapEvent",new Nr(l));for(const Te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Te]&&l[Te].enable(t[Te])}_add(t,l,h){this._handlers.push({handlerName:t,handler:l,allowed:h}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ma(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,l,h){for(const m in t)if(m!==h&&(!l||l.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const h of t)this._el.contains(h.target)&&l.push(h);return l}handleEvent(t,l){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const h=t.type==="renderFrame"?void 0:t,m={needsRenderFrame:!1},v={},w={},M=t.touches,z=M?this._getMapTouches(M):void 0,P=z?S.touchPos(this._el,z):S.mousePos(this._el,t);for(const{handlerName:G,handler:re,allowed:te}of this._handlers){if(!re.isEnabled())continue;let ie;this._blockedByActive(w,te,G)?re.reset():re[l||t.type]&&(ie=re[l||t.type](t,P,z),this.mergeHandlerResult(m,v,ie,G,h),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||re.isActive())&&(w[G]=re)}const R={};for(const G in this._previousActiveHandlers)w[G]||(R[G]=h);this._previousActiveHandlers=w,(Object.keys(R).length||ss(m))&&(this._changes.push([m,v,R]),this._triggerRenderFrame()),(Object.keys(w).length||ss(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=m;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(t,l,h,m,v){if(!h)return;s.extend(t,h);const w={handlerName:m,originalEvent:h.originalEvent||v};h.zoomDelta!==void 0&&(l.zoom=w),h.panDelta!==void 0&&(l.drag=w),h.pitchDelta!==void 0&&(l.pitch=w),h.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const t={},l={},h={};for(const[m,v,w]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new s.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),s.extend(l,v),s.extend(h,w);this._updateMapTransform(t,l,h),this._changes=[]}_updateMapTransform(t,l,h){const m=this._map,v=m.transform,w=m.style&&m.style.terrain;if(!(ss(t)||w&&this._drag))return this._fireEvents(l,h,!0);let{panDelta:M,zoomDelta:z,bearingDelta:P,pitchDelta:R,around:N,pinchAround:G}=t;G!==void 0&&(N=G),m._stop(!0),N=N||m.transform.centerPoint;const re=v.pointLocation(M?N.sub(M):N);P&&(v.bearing+=P),R&&(v.pitch+=R),z&&(v.zoom+=z),w?l.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(N),point:N,handlerName:l.drag.handlerName},m.fire(new s.Event("freezeElevation",{freeze:!0}))):this._drag&&h[this._drag.handlerName]?(m.fire(new s.Event("freezeElevation",{freeze:!1})),this._drag=null):l.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(M))):v.setLocationAtPoint(re,N),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,h,!0)}_fireEvents(t,l,h){const m=Ma(this._eventsInProgress),v=Ma(t),w={};for(const R in t){const{originalEvent:N}=t[R];this._eventsInProgress[R]||(w[`${R}start`]=N),this._eventsInProgress[R]=t[R]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const R in w)this._fireEvent(R,w[R]);v&&this._fireEvent("move",v.originalEvent);for(const R in t){const{originalEvent:N}=t[R];this._fireEvent(R,N)}const M={};let z;for(const R in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[R];this._handlersById[N].isActive()||(delete this._eventsInProgress[R],z=l[N]||G,M[`${R}end`]=z)}for(const R in M)this._fireEvent(R,M[R]);const P=Ma(this._eventsInProgress);if(h&&(m||v)&&!P){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;R?(N(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:z})):(this._map.fire(new s.Event("moveend",{originalEvent:z})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new s.Event(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Do("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Qn={extend:(f,...t)=>s.extend(f,...t),run(f){f()},logToElement(f,t=!1,l="log"){const h=window.document.getElementById(l);h&&(t&&(h.innerHTML=""),h.innerHTML+=`<br>${f}`)}};class Xi extends s.Evented{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,h){return t=s.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,s.extend({offset:t},l),h)}panTo(t,l,h){return this.easeTo(s.extend({center:t},l),h)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,h){return this.easeTo(s.extend({zoom:t},l),h)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,h){return this.easeTo(s.extend({bearing:t},l),h)}resetNorth(t,l){return this.rotateTo(0,s.extend({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){t=s.LngLatBounds.convert(t);const h=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,l)}_cameraForBoxAndBearing(t,l,h,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=s.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Le=m.padding;m.padding={top:Le,bottom:Le,right:Le,left:Le}}m.padding=s.extend(v,m.padding);const w=this.transform,M=w.padding,z=w.project(s.LngLat.convert(t)),P=w.project(s.LngLat.convert(l)),R=z.rotate(-h*Math.PI/180),N=P.rotate(-h*Math.PI/180),G=new s.pointGeometry(Math.max(R.x,N.x),Math.max(R.y,N.y)),re=new s.pointGeometry(Math.min(R.x,N.x),Math.min(R.y,N.y)),te=G.sub(re),ie=(w.width-(M.left+M.right+m.padding.left+m.padding.right))/te.x,xe=(w.height-(M.top+M.bottom+m.padding.top+m.padding.bottom))/te.y;if(xe<0||ie<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Te=Math.min(w.scaleZoom(w.scale*Math.min(ie,xe)),m.maxZoom),De=s.pointGeometry.convert(m.offset),oe=new s.pointGeometry((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(h*Math.PI/180),Oe=De.add(oe).mult(w.scale/w.zoomScale(Te));return{center:w.unproject(z.add(P).div(2).sub(Oe)),zoom:Te,bearing:h}}fitBounds(t,l,h){return this._fitInternal(this.cameraForBounds(t,l),l,h)}fitScreenCoordinates(t,l,h,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(t)),this.transform.pointLocation(s.pointGeometry.convert(l)),h,m),m,v)}_fitInternal(t,l,h){return t?(delete(l=s.extend(t,l)).padding,l.linear?this.easeTo(l,h):this.flyTo(l,h)):this}jumpTo(t,l){this.stop();const h=this.transform;let m=!1,v=!1,w=!1;return"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=s.LngLat.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(v=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(w=!0,h.pitch=+t.pitch),t.padding==null||h.isPaddingEqual(t.padding)||(h.padding=t.padding),this.fire(new s.Event("movestart",l)).fire(new s.Event("move",l)),m&&this.fire(new s.Event("zoomstart",l)).fire(new s.Event("zoom",l)).fire(new s.Event("zoomend",l)),v&&this.fire(new s.Event("rotatestart",l)).fire(new s.Event("rotate",l)).fire(new s.Event("rotateend",l)),w&&this.fire(new s.Event("pitchstart",l)).fire(new s.Event("pitch",l)).fire(new s.Event("pitchend",l)),this.fire(new s.Event("moveend",l))}calculateCameraOptionsFromTo(t,l,h,m=0){const v=s.MercatorCoordinate.fromLngLat(t,l),w=s.MercatorCoordinate.fromLngLat(h,m),M=w.x-v.x,z=w.y-v.y,P=w.z-v.z,R=Math.hypot(M,z,P);if(R===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(M,z),G=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),re=180*Math.atan2(M,-z)/Math.PI;let te=180*Math.acos(N/R)/Math.PI;return te=P<0?90-te:90+te,{center:w.toLngLat(),zoom:G,pitch:te,bearing:re}}easeTo(t,l){this._stop(!1,t.easeId),((t=s.extend({offset:[0,0],duration:500,easing:s.ease},t)).animate===!1||!t.essential&&s.exported.prefersReducedMotion)&&(t.duration=0);const h=this.transform,m=this.getZoom(),v=this.getBearing(),w=this.getPitch(),M=this.getPadding(),z="zoom"in t?+t.zoom:m,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,R="pitch"in t?+t.pitch:w,N="padding"in t?t.padding:h.padding,G=s.pointGeometry.convert(t.offset);let re=h.centerPoint.add(G);const te=h.pointLocation(re),ie=s.LngLat.convert(t.center||te);this._normalizeCenter(ie);const xe=h.project(te),Te=h.project(ie).sub(xe),De=h.zoomScale(z-m);let oe,Oe;t.around&&(oe=s.LngLat.convert(t.around),Oe=h.locationPoint(oe));const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||z!==m,this._rotating=this._rotating||v!==P,this._pitching=this._pitching||R!==w,this._padding=!h.isPaddingEqual(N),this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,Le),this._ease(We=>{if(this._zooming&&(h.zoom=s.number(m,z,We)),this._rotating&&(h.bearing=s.number(v,P,We)),this._pitching&&(h.pitch=s.number(w,R,We)),this._padding&&(h.interpolatePadding(M,N,We),re=h.centerPoint.add(G)),oe)h.setLocationAtPoint(oe,Oe);else{const He=h.zoomScale(h.zoom-m),dt=z>m?Math.min(2,De):Math.max(.5,De),Ge=Math.pow(dt,1-We),Ct=h.unproject(xe.add(Te.mult(We*Ge)).mult(He));h.setLocationAtPoint(h.renderWorldCopies?Ct.wrap():Ct,re)}this._fireMoveEvents(l)},We=>{this._afterEase(l,We)},t),this}_prepareEase(t,l,h={}){this._moving=!0,this.fire(new s.Event("freezeElevation",{freeze:!0})),l||h.moving||this.fire(new s.Event("movestart",t)),this._zooming&&!h.zooming&&this.fire(new s.Event("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new s.Event("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new s.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.Event("move",t)),this._zooming&&this.fire(new s.Event("zoom",t)),this._rotating&&this.fire(new s.Event("rotate",t)),this._pitching&&this.fire(new s.Event("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.fire(new s.Event("freezeElevation",{freeze:!1}));const h=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new s.Event("zoomend",t)),m&&this.fire(new s.Event("rotateend",t)),v&&this.fire(new s.Event("pitchend",t)),this.fire(new s.Event("moveend",t))}flyTo(t,l){if(!t.essential&&s.exported.prefersReducedMotion){const jt=s.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jt,l)}this.stop(),t=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},t);const h=this.transform,m=this.getZoom(),v=this.getBearing(),w=this.getPitch(),M=this.getPadding(),z="zoom"in t?s.clamp(+t.zoom,h.minZoom,h.maxZoom):m,P="bearing"in t?this._normalizeBearing(t.bearing,v):v,R="pitch"in t?+t.pitch:w,N="padding"in t?t.padding:h.padding,G=h.zoomScale(z-m),re=s.pointGeometry.convert(t.offset);let te=h.centerPoint.add(re);const ie=h.pointLocation(te),xe=s.LngLat.convert(t.center||ie);this._normalizeCenter(xe);const Te=h.project(ie),De=h.project(xe).sub(Te);let oe=t.curve;const Oe=Math.max(h.width,h.height),Le=Oe/G,We=De.mag();if("minZoom"in t){const jt=s.clamp(Math.min(t.minZoom,m,z),h.minZoom,h.maxZoom),zi=Oe/h.zoomScale(jt-m);oe=Math.sqrt(zi/We*2)}const He=oe*oe;function dt(jt){const zi=(Le*Le-Oe*Oe+(jt?-1:1)*He*He*We*We)/(2*(jt?Le:Oe)*He*We);return Math.log(Math.sqrt(zi*zi+1)-zi)}function Ge(jt){return(Math.exp(jt)-Math.exp(-jt))/2}function Ct(jt){return(Math.exp(jt)+Math.exp(-jt))/2}const xt=dt(0);let zt=function(jt){return Ct(xt)/Ct(xt+oe*jt)},ai=function(jt){return Oe*((Ct(xt)*(Ge(zi=xt+oe*jt)/Ct(zi))-Ge(xt))/He)/We;var zi},hi=(dt(1)-xt)/oe;if(Math.abs(We)<1e-6||!isFinite(hi)){if(Math.abs(Oe-Le)<1e-6)return this.easeTo(t,l);const jt=Le<Oe?-1:1;hi=Math.abs(Math.log(Le/Oe))/oe,ai=function(){return 0},zt=function(zi){return Math.exp(jt*oe*zi)}}return t.duration="duration"in t?+t.duration:1e3*hi/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==P,this._pitching=R!==w,this._padding=!h.isPaddingEqual(N),this._prepareEase(l,!1),this._ease(jt=>{const zi=jt*hi,Di=1/zt(zi);h.zoom=jt===1?z:m+h.scaleZoom(Di),this._rotating&&(h.bearing=s.number(v,P,jt)),this._pitching&&(h.pitch=s.number(w,R,jt)),this._padding&&(h.interpolatePadding(M,N,jt),te=h.centerPoint.add(re));const yi=jt===1?xe:h.unproject(Te.add(De.mult(ai(zi))).mult(Di));h.setLocationAtPoint(h.renderWorldCopies?yi.wrap():yi,te),this._fireMoveEvents(l)},()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,l)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,l,h){h.animate===!1||h.duration===0?(t(1),l()):(this._easeStart=s.exported.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=s.wrap(t,-180,180);const h=Math.abs(t-l);return Math.abs(t-360-l)<h&&(t-=360),Math.abs(t+360-l)<h&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(!l.renderWorldCopies||l.lngRange)return;const h=t.lng-l.center.lng;t.lng+=h>180?-360:h<-180?360:0}}class os{constructor(t={}){this.options=t,s.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=S.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=S.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const h=this._map._getUIString(`AttributionControl.${l}`);t.title=h,t.setAttribute("aria-label",h)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const l=this._map.style.sourceCaches;for(const m in l){const v=l[m];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&t.indexOf(w.attribution)<0&&t.push(w.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,v)=>m.length-v.length),t=t.filter((m,v)=>{for(let w=v+1;w<t.length;w++)if(t[w].indexOf(m)>=0)return!1;return!0});const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Rs{constructor(t={}){this.options=t,s.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=S.create("div","maplibregl-ctrl mapboxgl-ctrl");const l=S.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){S.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact","mapboxgl-compact"):l.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Kl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,h=l?this._queue.concat(l):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const h of l)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Yl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Jl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},ru={showCompass:!0,showZoom:!0,visualizePitch:!1};class pr{constructor(t,l,h=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Ar({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Bt({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),S.addEventListener(l,"mousedown",this.mousedown),S.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(l,"touchmove",this.touchmove),S.addEventListener(l,"touchend",this.touchend),S.addEventListener(l,"touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),S.disableDrag()}move(t,l){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,l);if(m&&m.bearingDelta&&h.setBearing(h.getBearing()+m.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,l);v&&v.pitchDelta&&h.setPitch(h.getPitch()+v.pitchDelta)}}off(){const t=this.element;S.removeEventListener(t,"mousedown",this.mousedown),S.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(t,"touchmove",this.touchmove),S.removeEventListener(t,"touchend",this.touchend),S.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){S.enableDrag(),S.removeEventListener(window,"mousemove",this.mousemove),S.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(s.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),S.mousePos(this.element,t)),S.addEventListener(window,"mousemove",this.mousemove),S.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,S.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ls(f,t,l){if(f=new s.LngLat(f.lng,f.lat),t){const h=new s.LngLat(f.lng-360,f.lat),m=new s.LngLat(f.lng+360,f.lat),v=l.locationPoint(f).distSqr(t);l.locationPoint(h).distSqr(t)<v?f=h:l.locationPoint(m).distSqr(t)<v&&(f=m)}for(;Math.abs(f.lng-l.center.lng)>180;){const h=l.locationPoint(f);if(h.x>=0&&h.y>=0&&h.x<=l.width&&h.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const Vt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ht(f,t,l){const h=f.classList;for(const m in Vt)h.remove(`maplibregl-${l}-anchor-${m}`,`mapboxgl-${l}-anchor-${m}`);h.add(`maplibregl-${l}-anchor-${t}`,`mapboxgl-${l}-anchor-${t}`)}class za extends s.Evented{constructor(t,l){if(super(),(t instanceof HTMLElement||l)&&(t=s.extend({element:t},l)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div"),this._element.setAttribute("aria-label","Map marker");const h=S.createNS("http://www.w3.org/2000/svg","svg"),m=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${m}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${m}`);const w=S.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const M=S.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const z=S.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const De of P){const oe=S.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",De.rx),oe.setAttributeNS(null,"ry",De.ry),z.appendChild(oe)}const R=S.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const N=S.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(N);const G=S.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"fill","#000000");const re=S.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),G.appendChild(re);const te=S.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ie=S.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"transform","translate(8.0, 8.0)");const xe=S.createNS("http://www.w3.org/2000/svg","circle");xe.setAttributeNS(null,"fill","#000000"),xe.setAttributeNS(null,"opacity","0.25"),xe.setAttributeNS(null,"cx","5.5"),xe.setAttributeNS(null,"cy","5.5"),xe.setAttributeNS(null,"r","5.4999962");const Te=S.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#FFFFFF"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962"),ie.appendChild(xe),ie.appendChild(Te),M.appendChild(z),M.appendChild(R),M.appendChild(G),M.appendChild(te),M.appendChild(ie),h.appendChild(M),h.setAttributeNS(null,"height",m*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=s.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Ht(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const l=t.code,h=t.charCode||t.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ls(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let l="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?l=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(l=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?h="rotateX(0deg)":this._pitchAlignment==="map"&&(h=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,`${Vt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${l}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=s.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Po={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Gr,xn=0,jr=!1;const mr={maxWidth:100,unit:"metric"};function Ql(f,t,l){const h=l&&l.maxWidth||100,m=f._container.clientHeight/2,v=f.unproject([0,m]),w=f.unproject([h,m]),M=v.distanceTo(w);if(l&&l.unit==="imperial"){const z=3.2808*M;z>5280?Zr(t,h,z/5280,f._getUIString("ScaleControl.Miles")):Zr(t,h,z,f._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Zr(t,h,M/1852,f._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Zr(t,h,M/1e3,f._getUIString("ScaleControl.Kilometers")):Zr(t,h,M,f._getUIString("ScaleControl.Meters"))}function Zr(f,t,l,h){const m=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let M=v/w;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(z){const P=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*P)/P}(M),w*M}(l);f.style.width=t*(m/l)+"px",f.innerHTML=`${m}&nbsp;${h}`}const $i={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},an=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Lo(f){if(f){if(typeof f=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(f,2)));return{center:new s.pointGeometry(0,0),top:new s.pointGeometry(0,f),"top-left":new s.pointGeometry(t,t),"top-right":new s.pointGeometry(-t,t),bottom:new s.pointGeometry(0,-f),"bottom-left":new s.pointGeometry(t,-t),"bottom-right":new s.pointGeometry(-t,-t),left:new s.pointGeometry(f,0),right:new s.pointGeometry(-f,0)}}if(f instanceof s.pointGeometry||Array.isArray(f)){const t=s.pointGeometry.convert(f);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.pointGeometry.convert(f.center||[0,0]),top:s.pointGeometry.convert(f.top||[0,0]),"top-left":s.pointGeometry.convert(f["top-left"]||[0,0]),"top-right":s.pointGeometry.convert(f["top-right"]||[0,0]),bottom:s.pointGeometry.convert(f.bottom||[0,0]),"bottom-left":s.pointGeometry.convert(f["bottom-left"]||[0,0]),"bottom-right":s.pointGeometry.convert(f["bottom-right"]||[0,0]),left:s.pointGeometry.convert(f.left||[0,0]),right:s.pointGeometry.convert(f.right||[0,0])}}return Lo(new s.pointGeometry(0,0))}const ra={supported:x,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Xi{constructor(f){var t;if(s.PerformanceUtils.mark(s.PerformanceMarkers.create),(f=s.extend({},Jl,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new $a(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Kl,this._controls=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Yl,f.locale),this._clickTolerance=f.clickTolerance,this._pixelRatio=(t=f.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new V(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Hl(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new Fl(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,s.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new os({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new Rs,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.Event(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.Event("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(l,h.firstChild):h.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,t,l,h){return h==null&&this.style.terrain&&(h=this.transform.getElevation(l,this.style.terrain)),super.calculateCameraOptionsFromTo(f,t,l,h)}resize(f){const t=this._containerDimensions(),l=t[0],h=t[1];this._resizeCanvas(l,h,this.getPixelRatio()),this.transform.resize(l,h),this.painter.resize(l,h,this.getPixelRatio());const m=!this._moving;return m&&(this.stop(),this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f))),this.fire(new s.Event("resize",f)),m&&this.fire(new s.Event("moveend",f)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(f){const[t,l]=this._containerDimensions();this._pixelRatio=f,this._resizeCanvas(t,l,f),this.painter.resize(t,l,f)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(s.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(s.LngLat.convert(f),this.style&&this.style.terrain)}unproject(f){return this.transform.pointLocation(s.pointGeometry.convert(f),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(f,t,l){if(f==="mouseenter"||f==="mouseover"){let h=!1;return{layer:t,listener:l,delegates:{mousemove:v=>{const w=this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[];w.length?h||(h=!0,l.call(this,new Gn(f,this,v.originalEvent,{features:w}))):h=!1},mouseout:()=>{h=!1}}}}if(f==="mouseleave"||f==="mouseout"){let h=!1;return{layer:t,listener:l,delegates:{mousemove:w=>{(this.getLayer(t)?this.queryRenderedFeatures(w.point,{layers:[t]}):[]).length?h=!0:h&&(h=!1,l.call(this,new Gn(f,this,w.originalEvent)))},mouseout:w=>{h&&(h=!1,l.call(this,new Gn(f,this,w.originalEvent)))}}}}{const h=m=>{const v=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];v.length&&(m.features=v,l.call(this,m),delete m.features)};return{layer:t,listener:l,delegates:{[f]:h}}}}on(f,t,l){if(l===void 0)return super.on(f,t);const h=this._createDelegatedListener(f,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(f,t,l){if(l===void 0)return super.once(f,t);const h=this._createDelegatedListener(f,t,l);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(f,t,l){return l===void 0?super.off(f,t):(this._delegatedListeners&&this._delegatedListeners[f]&&(h=>{const m=this._delegatedListeners[f];for(let v=0;v<m.length;v++){const w=m[v];if(w.layer===t&&w.listener===l){for(const M in w.delegates)this.off(M,w.delegates[M]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(f,t){if(!this.style)return[];let l;if(t!==void 0||f===void 0||f instanceof s.pointGeometry||Array.isArray(f)||(t=f,f=void 0),t=t||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof s.pointGeometry||typeof f[0]=="number")l=[s.pointGeometry.convert(f)];else{const h=s.pointGeometry.convert(f[0]),m=s.pointGeometry.convert(f[1]);l=[h,new s.pointGeometry(m.x,h.y),m,new s.pointGeometry(h.x,m.y),h]}return this.style.queryRenderedFeatures(l,t,this.transform)}querySourceFeatures(f,t){return this.style.querySourceFeatures(f,t)}setStyle(f,t){return(t=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(f,t))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new In(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new In(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,t){if(typeof f=="string"){const l=this._requestManager.transformRequest(f,s.ResourceType.Style);s.getJSON(l,(h,m)=>{h?this.fire(new s.ErrorEvent(h)):m&&this._updateDiff(m,t)})}else typeof f=="object"&&this._updateDiff(f,t)}_updateDiff(f,t){try{this.style.setState(f)&&this._update(!0)}catch(l){s.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(f,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")}addSource(f,t){return this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)}isSourceLoaded(f){const t=this.style&&this.style.sourceCaches[f];if(t!==void 0)return t.loaded();this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){return this.style.setTerrain(f),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const t in f){const l=f[t]._tiles;for(const h in l){const m=l[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(f,t,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,l)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,t,{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||s.isImageBitmap(t)){const{width:M,height:z,data:P}=s.exported.getImageData(t);this.style.addImage(f,{data:new s.RGBAImage({width:M,height:z},P),pixelRatio:l,stretchX:m,stretchY:v,content:w,sdf:h,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:P}=t,R=t;this.style.addImage(f,{data:new s.RGBAImage({width:M,height:z},new Uint8Array(P)),pixelRatio:l,stretchX:m,stretchY:v,content:w,sdf:h,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}}updateImage(f,t){const l=this.style.getImage(f);if(!l)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof HTMLImageElement||s.isImageBitmap(t)?s.exported.getImageData(t):t,{width:m,height:v,data:w}=h;if(m===void 0||v===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==l.data.width||v!==l.data.height)return this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(t instanceof HTMLImageElement||s.isImageBitmap(t));l.data.replace(w,M),this.style.updateImage(f,l)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,t){s.getImage(this._requestManager.transformRequest(f,s.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(f,t){return this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)}moveLayer(f,t){return this.style.moveLayer(f,t),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,t,l){return this.style.setLayerZoomRange(f,t,l),this._update(!0)}setFilter(f,t,l={}){return this.style.setFilter(f,t,l),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,t,l,h={}){return this.style.setPaintProperty(f,t,l,h),this._update(!0)}getPaintProperty(f,t){return this.style.getPaintProperty(f,t)}setLayoutProperty(f,t,l,h={}){return this.style.setLayoutProperty(f,t,l,h),this._update(!0)}getLayoutProperty(f,t){return this.style.getLayoutProperty(f,t)}setLight(f,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,t){return this.style.setFeatureState(f,t),this._update()}removeFeatureState(f,t){return this.style.removeFeatureState(f,t),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,t=0;return this._container&&(f=this._container.clientWidth||400,t=this._container.clientHeight||300),[f,t]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=S.create("div","maplibregl-canvas-container mapboxgl-canvas-container",f);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=S.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const l=this._containerDimensions();this._resizeCanvas(l[0],l[1],this.getPixelRatio());const h=this._controlContainer=S.create("div","maplibregl-control-container mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=S.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const f=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=S.create("div","maplibregl-cooperative-gesture-screen",f);let t="Control",l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(l=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${l}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",h=>{h.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",h=>{h.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",h=>{this._onCooperativeGesture(h,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(f,t,l){this._canvas.width=l*f,this._canvas.height=l*t,this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const f=s.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);t?(this.painter=new Io(t,this.transform),s.exported$1.testSupport(t)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(f,t,l){return!t&&l<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){let t,l=0;const h=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,t),l=s.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let m=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,M=s.exported.now();this.style.zoomHistory.update(w,M);const z=new s.EvaluationParameters(w,{now:M,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=z.crossFadingFactor();P===1&&P===this._crossFadingFactor||(m=!0,this._crossFadingFactor=P),this.style.update(z)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.PerformanceUtils.mark(s.PerformanceMarkers.load),this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const w=s.exported.now()-l;h.endQueryEXT(h.TIME_ELAPSED_EXT,t),setTimeout(()=>{const M=h.getQueryObjectEXT(t,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(t),this.fire(new s.Event("gpu-timing-frame",{cpuTime:w,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(w);this.fire(new s.Event("gpu-timing-layer",{layerTimes:M}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,s.PerformanceUtils.mark(s.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),S.remove(this._canvasContainer),S.remove(this._controlContainer),this._cooperativeGestures&&S.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),s.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.exported.frame(f=>{s.PerformanceUtils.frame(f),this._frame=null,this._render(f)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,t){s.setCacheLimits(f,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(f){this.options=s.extend({},ru,f),this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map.getZoom(),t=f===this._map.getMaxZoom(),l=f===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=f}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,t){const l=S.create("button",f,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(f,t){const l=this._map._getUIString(`NavigationControl.${t}`);f.title=l,f.setAttribute("aria-label",l)}},GeolocateControl:class extends s.Evented{constructor(f){super(),this.options=s.extend({},Po,f),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(f){var t;return this._map=f,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Gr!==void 0?t(Gr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(l=>{Gr=l.state!=="denied",t(Gr)}):(Gr=!!window.navigator.geolocation,t(Gr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xn=0,jr=!1}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),l=f.coords;return t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",f)),this._finish()}}_updateCamera(f){const t=new s.LngLat(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,h=this._map.getBearing(),m=s.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),m,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new s.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.clientHeight/2,t=this._map.unproject([0,f]),l=this._map.unproject([1,f]),h=t.distanceTo(l),m=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&jr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=S.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new za(this._dotElement),this._circleElement=S.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new za({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xn--,jr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xn++,xn>1?(f={maximumAge:6e5,timeout:0},jr=!0):(f=this.options.positionOptions,jr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:os,LogoControl:Rs,ScaleControl:class{constructor(f){this.options=s.extend({},mr,f),s.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ql(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Ql(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){S.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=S.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(f){this.options=f,s.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(f){return this._map=f,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=S.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){S.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends s.Evented{constructor(f){super(),this.options=s.extend(Object.create($i),f),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=s.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),l=document.createElement("body");let h;for(l.innerHTML=f;h=l.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=S.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_update(f){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=S.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=S.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ls(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!f))return;const t=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat);let l=this.options.anchor;const h=Lo(this.options.offset);if(!l){const v=this._container.offsetWidth,w=this._container.offsetHeight;let M;M=t.y+h.bottom.y<w?["top"]:t.y>this._map.transform.height-w?["bottom"]:[],t.x<v/2?M.push("left"):t.x>this._map.transform.width-v/2&&M.push("right"),l=M.length===0?"bottom":M.join("-")}const m=t.add(h[l]).round();S.setTransform(this._container,`${Vt[l]} translate(${m.x}px,${m.y}px)`),Ht(this._container,l,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(an);f&&f.focus()}_onClose(){this.remove()}},Marker:za,Style:In,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,Evented:s.Evented,AJAXError:s.AJAXError,config:s.config,CanvasSource:de,GeoJSONSource:ft,ImageSource:Fe,RasterDEMTileSource:Ee,RasterTileSource:Re,VectorTileSource:Me,VideoSource:Se,prewarm:function(){ln().acquire(fi)},clearPrewarmedResources:function(){const f=li;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(fi),li=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return tt.workerCount},set workerCount(f){tt.workerCount=f},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){s.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){s.clearTileCache(f)},workerUrl:"",addProtocol(f,t){s.config.REGISTERED_PROTOCOLS[f]=t},removeProtocol(f){delete s.config.REGISTERED_PROTOCOLS[f]}};return Qn.extend(ra,{isSafari:s.isSafari,getPerformanceMetrics:s.PerformanceUtils.getPerformanceMetrics}),ra});var _=d;return _})})(gm);var eb=gm.exports;const el=B_(eb);var Yn=(n,a,o)=>new Promise((c,d)=>{var g=x=>{try{s(o.next(x))}catch(T){d(T)}},_=x=>{try{s(o.throw(x))}catch(T){d(T)}},s=x=>x.done?c(x.value):Promise.resolve(x.value).then(g,_);s((o=o.apply(n,a)).next())}),hr=Uint8Array,Qs=Uint16Array,tb=Int32Array,ym=new hr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vm=new hr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ib=new hr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),bm=function(n,a){for(var o=new Qs(31),c=0;c<31;++c)o[c]=a+=1<<n[c-1];for(var d=new tb(o[30]),c=1;c<30;++c)for(var g=o[c];g<o[c+1];++g)d[g]=g-o[c]<<5|c;return{b:o,r:d}},xm=bm(ym,2),wm=xm.b,nb=xm.r;wm[28]=258,nb[258]=28;var rb=bm(vm,0),ab=rb.b,ih=new Qs(32768);for(Vi=0;Vi<32768;++Vi)pa=(Vi&43690)>>1|(Vi&21845)<<1,pa=(pa&52428)>>2|(pa&13107)<<2,pa=(pa&61680)>>4|(pa&3855)<<4,ih[Vi]=((pa&65280)>>8|(pa&255)<<8)>>1;var pa,Vi,al=function(n,a,o){for(var c=n.length,d=0,g=new Qs(a);d<c;++d)n[d]&&++g[n[d]-1];var _=new Qs(a);for(d=1;d<a;++d)_[d]=_[d-1]+g[d-1]<<1;var s;if(o){s=new Qs(1<<a);var x=15-a;for(d=0;d<c;++d)if(n[d])for(var T=d<<4|n[d],k=a-n[d],A=_[n[d]-1]++<<k,S=A|(1<<k)-1;A<=S;++A)s[ih[A]>>x]=T}else for(s=new Qs(c),d=0;d<c;++d)n[d]&&(s[d]=ih[_[n[d]-1]++]>>15-n[d]);return s},pl=new hr(288);for(Vi=0;Vi<144;++Vi)pl[Vi]=8;var Vi;for(Vi=144;Vi<256;++Vi)pl[Vi]=9;var Vi;for(Vi=256;Vi<280;++Vi)pl[Vi]=7;var Vi;for(Vi=280;Vi<288;++Vi)pl[Vi]=8;var Vi,Im=new hr(32);for(Vi=0;Vi<32;++Vi)Im[Vi]=5;var Vi,sb=al(pl,9,1),ob=al(Im,5,1),Wu=function(n){for(var a=n[0],o=1;o<n.length;++o)n[o]>a&&(a=n[o]);return a},Pr=function(n,a,o){var c=a/8|0;return(n[c]|n[c+1]<<8)>>(a&7)&o},Hu=function(n,a){var o=a/8|0;return(n[o]|n[o+1]<<8|n[o+2]<<16)>>(a&7)},lb=function(n){return(n+7)/8|0},cb=function(n,a,o){(a==null||a<0)&&(a=0),(o==null||o>n.length)&&(o=n.length);var c=new hr(o-a);return c.set(n.subarray(a,o)),c},ub=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ur=function(n,a,o){var c=new Error(a||ub[n]);if(c.code=n,Error.captureStackTrace&&Error.captureStackTrace(c,ur),!o)throw c;return c},mh=function(n,a,o,c){var d=n.length,g=c?c.length:0;if(!d||a.f&&!a.l)return o||new hr(0);var _=!o||a.i!=2,s=a.i;o||(o=new hr(d*3));var x=function(Ve){var vt=o.length;if(Ve>vt){var fi=new hr(Math.max(vt*2,Ve));fi.set(o),o=fi}},T=a.f||0,k=a.p||0,A=a.b||0,S=a.l,V=a.d,W=a.m,Z=a.n,Y=d*8;do{if(!S){T=Pr(n,k,1);var H=Pr(n,k+1,3);if(k+=3,H)if(H==1)S=sb,V=ob,W=9,Z=5;else if(H==2){var ge=Pr(n,k,31)+257,se=Pr(n,k+10,15)+4,je=ge+Pr(n,k+5,31)+1;k+=14;for(var ce=new hr(je),ee=new hr(19),ke=0;ke<se;++ke)ee[ib[ke]]=Pr(n,k+ke*3,7);k+=se*3;for(var _e=Wu(ee),me=(1<<_e)-1,Me=al(ee,_e,1),ke=0;ke<je;){var Re=Me[Pr(n,k,me)];k+=Re&15;var Q=Re>>4;if(Q<16)ce[ke++]=Q;else{var he=0,Ee=0;for(Q==16?(Ee=3+Pr(n,k,3),k+=2,he=ce[ke-1]):Q==17?(Ee=3+Pr(n,k,7),k+=3):Q==18&&(Ee=11+Pr(n,k,127),k+=7);Ee--;)ce[ke++]=he}}var ft=ce.subarray(0,ge),nt=ce.subarray(ge);W=Wu(ft),Z=Wu(nt),S=al(ft,W,1),V=al(nt,Z,1)}else ur(1);else{var Q=lb(k)+4,ae=n[Q-4]|n[Q-3]<<8,ne=Q+ae;if(ne>d){s&&ur(0);break}_&&x(A+ae),o.set(n.subarray(Q,ne),A),a.b=A+=ae,a.p=k=ne*8,a.f=T;continue}if(k>Y){s&&ur(0);break}}_&&x(A+131072);for(var Fe=(1<<W)-1,Se=(1<<Z)-1,de=k;;de=k){var he=S[Hu(n,k)&Fe],Qe=he>>4;if(k+=he&15,k>Y){s&&ur(0);break}if(he||ur(2),Qe<256)o[A++]=Qe;else if(Qe==256){de=k,S=null;break}else{var Je=Qe-254;if(Qe>264){var ke=Qe-257,yt=ym[ke];Je=Pr(n,k,(1<<yt)-1)+wm[ke],k+=yt}var mt=V[Hu(n,k)&Se],Xe=mt>>4;mt||ur(3),k+=mt&15;var nt=ab[Xe];if(Xe>3){var yt=vm[Xe];nt+=Hu(n,k)&(1<<yt)-1,k+=yt}if(k>Y){s&&ur(0);break}_&&x(A+131072);var gt=A+Je;if(A<nt){var ze=g-nt,Pe=Math.min(nt,gt);for(ze+A<0&&ur(3);A<Pe;++A)o[A]=c[ze+A]}for(;A<gt;A+=4)o[A]=o[A-nt],o[A+1]=o[A+1-nt],o[A+2]=o[A+2-nt],o[A+3]=o[A+3-nt];A=gt}}a.l=S,a.p=de,a.b=A,a.f=T,S&&(T=1,a.m=W,a.d=V,a.n=Z)}while(!T);return A==o.length?o:cb(o,0,A)},hb=new hr(0),db=function(n){(n[0]!=31||n[1]!=139||n[2]!=8)&&ur(6,"invalid gzip data");var a=n[3],o=10;a&4&&(o+=(n[10]|n[11]<<8)+2);for(var c=(a>>3&1)+(a>>4&1);c>0;c-=!n[o++]);return o+(a&2)},fb=function(n){var a=n.length;return(n[a-4]|n[a-3]<<8|n[a-2]<<16|n[a-1]<<24)>>>0},pb=function(n,a){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&ur(6,"invalid zlib data"),(n[1]>>5&1)==+!a&&ur(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function mb(n,a){return mh(n,{i:2},a&&a.out,a&&a.dictionary)}function gb(n,a){var o=db(n);return o+8>n.length&&ur(6,"invalid gzip data"),mh(n.subarray(o,-8),{i:2},a&&a.out||new hr(fb(n)),a&&a.dictionary)}function _b(n,a){return mh(n.subarray(pb(n,a&&a.dictionary),-4),{i:2},a&&a.out,a&&a.dictionary)}function nh(n,a){return n[0]==31&&n[1]==139&&n[2]==8?gb(n,a):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?mb(n,a):_b(n,a)}var yb=typeof TextDecoder<"u"&&new TextDecoder,vb=0;try{yb.decode(hb,{stream:!0}),vb=1}catch{}var km=(n,a)=>n*Math.pow(2,a),tl=(n,a)=>Math.floor(n/Math.pow(2,a)),Pc=(n,a)=>km(n.getUint16(a+1,!0),8)+n.getUint8(a),Tm=(n,a)=>km(n.getUint32(a+2,!0),16)+n.getUint16(a,!0),bb=(n,a,o,c,d)=>{if(n!=c.getUint8(d))return n-c.getUint8(d);const g=Pc(c,d+1);if(a!=g)return a-g;const _=Pc(c,d+4);return o!=_?o-_:0},xb=(n,a,o,c)=>{const d=Em(n,a|128,o,c);return d?{z:a,x:o,y:c,offset:d[0],length:d[1],is_dir:!0}:null},op=(n,a,o,c)=>{const d=Em(n,a,o,c);return d?{z:a,x:o,y:c,offset:d[0],length:d[1],is_dir:!1}:null},Em=(n,a,o,c)=>{let d=0,g=n.byteLength/17-1;for(;d<=g;){const _=g+d>>1,s=bb(a,o,c,n,_*17);if(s>0)d=_+1;else if(s<0)g=_-1;else return[Tm(n,_*17+7),n.getUint32(_*17+13,!0)]}return null},wb=(n,a)=>n.is_dir&&!a.is_dir?1:!n.is_dir&&a.is_dir?-1:n.z!==a.z?n.z-a.z:n.x!==a.x?n.x-a.x:n.y-a.y,Am=(n,a)=>{const o=n.getUint8(a*17);return{z:o&127,x:Pc(n,a*17+1),y:Pc(n,a*17+4),offset:Tm(n,a*17+7),length:n.getUint32(a*17+13,!0),is_dir:o>>7===1}},lp=n=>{const a=[],o=new DataView(n);for(let c=0;c<o.byteLength/17;c++)a.push(Am(o,c));return Ib(a)},Ib=n=>{n.sort(wb);const a=new ArrayBuffer(17*n.length),o=new Uint8Array(a);for(let c=0;c<n.length;c++){const d=n[c];let g=d.z;d.is_dir&&(g=g|128),o[c*17]=g,o[c*17+1]=d.x&255,o[c*17+2]=d.x>>8&255,o[c*17+3]=d.x>>16&255,o[c*17+4]=d.y&255,o[c*17+5]=d.y>>8&255,o[c*17+6]=d.y>>16&255,o[c*17+7]=d.offset&255,o[c*17+8]=tl(d.offset,8)&255,o[c*17+9]=tl(d.offset,16)&255,o[c*17+10]=tl(d.offset,24)&255,o[c*17+11]=tl(d.offset,32)&255,o[c*17+12]=tl(d.offset,48)&255,o[c*17+13]=d.length&255,o[c*17+14]=d.length>>8&255,o[c*17+15]=d.length>>16&255,o[c*17+16]=d.length>>24&255}return a},kb=(n,a)=>{if(n.byteLength<17)return null;const o=n.byteLength/17,c=Am(n,o-1);if(c.is_dir){const d=c.z,g=a.z-d,_=Math.trunc(a.x/(1<<g)),s=Math.trunc(a.y/(1<<g));return{z:d,x:_,y:s}}return null};function Tb(n){return Yn(this,null,function*(){const a=yield n.getBytes(0,512e3),o=new DataView(a.data),c=o.getUint32(4,!0),d=o.getUint16(8,!0),g=new TextDecoder("utf-8"),_=JSON.parse(g.decode(new DataView(a.data,10,c)));let s=0;_.compression==="gzip"&&(s=2);let x=0;"minzoom"in _&&(x=+_.minzoom);let T=0;"maxzoom"in _&&(T=+_.maxzoom);let k=0,A=0,S=0,V=-180,W=-85,Z=180,Y=85;if(_.bounds){const Q=_.bounds.split(",");V=+Q[0],W=+Q[1],Z=+Q[2],Y=+Q[3]}if(_.center){const Q=_.center.split(",");k=+Q[0],A=+Q[1],S=+Q[2]}return{specVersion:o.getUint16(2,!0),rootDirectoryOffset:10+c,rootDirectoryLength:d*17,jsonMetadataOffset:10,jsonMetadataLength:c,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:x,maxZoom:T,minLon:V,minLat:W,maxLon:Z,maxLat:Y,centerZoom:S,centerLon:k,centerLat:A,etag:a.etag}})}function Eb(n,a,o,c,d,g,_){return Yn(this,null,function*(){let s=yield o.getArrayBuffer(a,n.rootDirectoryOffset,n.rootDirectoryLength,n);n.specVersion===1&&(s=lp(s));const x=op(new DataView(s),c,d,g);if(x){let A=(yield a.getBytes(x.offset,x.length,_)).data;const S=new DataView(A);return S.getUint8(0)==31&&S.getUint8(1)==139&&(A=nh(new Uint8Array(A))),{data:A}}const T=kb(new DataView(s),{z:c,x:d,y:g});if(T){const k=xb(new DataView(s),T.z,T.x,T.y);if(k){let A=yield o.getArrayBuffer(a,k.offset,k.length,n);n.specVersion===1&&(A=lp(A));const S=op(new DataView(A),c,d,g);if(S){let W=(yield a.getBytes(S.offset,S.length,_)).data;const Z=new DataView(W);return Z.getUint8(0)==31&&Z.getUint8(1)==139&&(W=nh(new Uint8Array(W))),{data:W}}}}})}var Sm={getHeader:Tb,getZxy:Eb},Ab=class{constructor(){this.tile=(n,a)=>{if(n.type=="json"){const o=n.url.substr(10);let c=this.tiles.get(o);return c||(c=new cp(o),this.tiles.set(o,c)),c.getHeader().then(d=>{const g={tiles:[n.url+"/{z}/{x}/{y}"],minzoom:d.minZoom,maxzoom:d.maxZoom,bounds:[d.minLon,d.minLat,d.maxLon,d.maxLat]};a(null,g,null,null)}).catch(d=>{a(d,null,null,null)}),{cancel:()=>{}}}else{const o=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),c=n.url.match(o);if(!c)throw new Error("Invalid PMTiles protocol URL");const d=c[1];let g=this.tiles.get(d);g||(g=new cp(d),this.tiles.set(d,g));const _=c[2],s=c[3],x=c[4],T=new AbortController,k=T.signal;let A=()=>{T.abort()};return g.getHeader().then(S=>{g.getZxy(+_,+s,+x,k).then(V=>{V?a(null,new Uint8Array(V.data),V.cacheControl,V.expires):S.tileType==1?a(null,new Uint8Array,null,null):a(null,null,null,null)}).catch(V=>{V.name!=="AbortError"&&a(V,null,null,null)})}),{cancel:A}}},this.tiles=new Map}add(n){this.tiles.set(n.source.getKey(),n)}get(n){return this.tiles.get(n)}};function Ys(n,a){return(a>>>0)*4294967296+(n>>>0)}function Sb(n,a){const o=a.buf;let c,d;if(d=o[a.pos++],c=(d&112)>>4,d<128||(d=o[a.pos++],c|=(d&127)<<3,d<128)||(d=o[a.pos++],c|=(d&127)<<10,d<128)||(d=o[a.pos++],c|=(d&127)<<17,d<128)||(d=o[a.pos++],c|=(d&127)<<24,d<128)||(d=o[a.pos++],c|=(d&1)<<31,d<128))return Ys(n,c);throw new Error("Expected varint not more than 10 bytes")}function il(n){const a=n.buf;let o,c;return c=a[n.pos++],o=c&127,c<128||(c=a[n.pos++],o|=(c&127)<<7,c<128)||(c=a[n.pos++],o|=(c&127)<<14,c<128)||(c=a[n.pos++],o|=(c&127)<<21,c<128)?o:(c=a[n.pos],o|=(c&15)<<28,Sb(o,n))}function Cb(n,a,o,c){if(c==0){o==1&&(a[0]=n-1-a[0],a[1]=n-1-a[1]);const d=a[0];a[0]=a[1],a[1]=d}}var Mb=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function zb(n,a,o){if(n>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(a>Math.pow(2,n)-1||o>Math.pow(2,n)-1)throw Error("tile x/y outside zoom level bounds");const c=Mb[n],d=Math.pow(2,n);let g=0,_=0,s=0;const x=[a,o];let T=d/2;for(;T>0;)g=(x[0]&T)>0?1:0,_=(x[1]&T)>0?1:0,s+=T*T*(3*g^_),Cb(T,x,g,_),T=T/2;return c+s}function Cm(n,a){return Yn(this,null,function*(){if(a===1||a===0)return n;if(a===2){if(typeof globalThis.DecompressionStream>"u")return nh(new Uint8Array(n));{let c=new Response(n).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(c).arrayBuffer()}}else throw Error("Compression method not supported")})}var Db=127;function Pb(n,a){let o=0,c=n.length-1;for(;o<=c;){const d=c+o>>1,g=a-n[d].tileId;if(g>0)o=d+1;else if(g<0)c=d-1;else return n[d]}return c>=0&&(n[c].runLength===0||a-n[c].tileId<n[c].runLength)?n[c]:null}var Lb=class{constructor(n){this.url=n}getKey(){return this.url}getBytes(n,a,o){return Yn(this,null,function*(){let c;o||(c=new AbortController,o=c.signal);let d=yield fetch(this.url,{signal:o,headers:{Range:"bytes="+n+"-"+(n+a-1)}});if(d.status===416&&n===0){const s=d.headers.get("Content-Range");if(!s||!s.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const x=+s.substr(8);d=yield fetch(this.url,{signal:o,headers:{Range:"bytes=0-"+(x-1)}})}if(d.status>=300)throw Error("Bad response code: "+d.status);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>a))throw c&&c.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:d.headers.get("ETag")||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function Lr(n,a){const o=n.getUint32(a+4,!0),c=n.getUint32(a+0,!0);return o*Math.pow(2,32)+c}function Bb(n,a){const o=new DataView(n),c=o.getUint8(7);if(c>3)throw Error(`Archive is spec version ${c} but this library supports up to spec version 3`);return{specVersion:c,rootDirectoryOffset:Lr(o,8),rootDirectoryLength:Lr(o,16),jsonMetadataOffset:Lr(o,24),jsonMetadataLength:Lr(o,32),leafDirectoryOffset:Lr(o,40),leafDirectoryLength:Lr(o,48),tileDataOffset:Lr(o,56),tileDataLength:Lr(o,64),numAddressedTiles:Lr(o,72),numTileEntries:Lr(o,80),numTileContents:Lr(o,88),clustered:o.getUint8(96)===1,internalCompression:o.getUint8(97),tileCompression:o.getUint8(98),tileType:o.getUint8(99),minZoom:o.getUint8(100),maxZoom:o.getUint8(101),minLon:o.getInt32(102,!0)/1e7,minLat:o.getInt32(106,!0)/1e7,maxLon:o.getInt32(110,!0)/1e7,maxLat:o.getInt32(114,!0)/1e7,centerZoom:o.getUint8(118),centerLon:o.getInt32(119,!0)/1e7,centerLat:o.getInt32(123,!0)/1e7,etag:a}}function Mm(n){const a={buf:new Uint8Array(n),pos:0},o=il(a),c=[];let d=0;for(let g=0;g<o;g++){const _=il(a);c.push({tileId:d+_,offset:0,length:0,runLength:1}),d+=_}for(let g=0;g<o;g++)c[g].runLength=il(a);for(let g=0;g<o;g++)c[g].length=il(a);for(let g=0;g<o;g++){const _=il(a);_===0&&g>0?c[g].offset=c[g-1].offset+c[g-1].length:c[g].offset=_-1}return c}function Rb(n){const a=new DataView(n);return a.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):a.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var $s=class extends Error{};function Fb(n,a,o,c){return Yn(this,null,function*(){const d=yield n.getBytes(0,16384);if(new DataView(d.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Rb(d.data)<3)return[yield Sm.getHeader(n)];const _=d.data.slice(0,Db);let s=d.etag;c&&d.etag!=c&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+n.getKey()),s=void 0);const x=Bb(_,s);if(o){const T=d.data.slice(x.rootDirectoryOffset,x.rootDirectoryOffset+x.rootDirectoryLength),k=n.getKey()+"|"+(x.etag||"")+"|"+x.rootDirectoryOffset+"|"+x.rootDirectoryLength,A=Mm(yield a(T,x.internalCompression));return[x,[k,A.length,A]]}return[x,void 0]})}function Ob(n,a,o,c,d){return Yn(this,null,function*(){const g=yield n.getBytes(o,c);if(d.etag&&d.etag!==g.etag)throw new $s(g.etag);const _=yield a(g.data,d.internalCompression),s=Mm(_);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var Vb=class{constructor(n=100,a=!0,o=Cm){this.cache=new Map,this.maxCacheEntries=n,this.counter=1,this.prefetch=a,this.decompress=o}getHeader(n,a){return Yn(this,null,function*(){const o=n.getKey();if(this.cache.has(o))return this.cache.get(o).lastUsed=this.counter++,yield this.cache.get(o).data;const c=new Promise((d,g)=>{Fb(n,this.decompress,this.prefetch,a).then(_=>{_[1]&&this.cache.set(_[1][0],{lastUsed:this.counter++,data:Promise.resolve(_[1][2])}),d(_[0]),this.prune()}).catch(_=>{g(_)})});return this.cache.set(o,{lastUsed:this.counter++,data:c}),c})}getDirectory(n,a,o,c){return Yn(this,null,function*(){const d=n.getKey()+"|"+(c.etag||"")+"|"+a+"|"+o;if(this.cache.has(d))return this.cache.get(d).lastUsed=this.counter++,yield this.cache.get(d).data;const g=new Promise((_,s)=>{Ob(n,this.decompress,a,o,c).then(x=>{_(x),this.prune()}).catch(x=>{s(x)})});return this.cache.set(d,{lastUsed:this.counter++,data:g}),g})}getArrayBuffer(n,a,o,c){return Yn(this,null,function*(){const d=n.getKey()+"|"+(c.etag||"")+"|"+a+"|"+o;if(this.cache.has(d))return this.cache.get(d).lastUsed=this.counter++,yield this.cache.get(d).data;const g=new Promise((_,s)=>{n.getBytes(a,o).then(x=>{if(c.etag&&c.etag!==x.etag)throw new $s(x.etag);_(x.data),this.cache.has(d),this.prune()}).catch(x=>{s(x)})});return this.cache.set(d,{lastUsed:this.counter++,data:g}),g})}prune(){if(this.cache.size>=this.maxCacheEntries){let n=1/0,a;this.cache.forEach((o,c)=>{o.lastUsed<n&&(n=o.lastUsed,a=c)}),a&&this.cache.delete(a)}}invalidate(n,a){return Yn(this,null,function*(){this.cache.delete(n.getKey()),yield this.getHeader(n,a)})}},cp=class{constructor(n,a,o){typeof n=="string"?this.source=new Lb(n):this.source=n,o?this.decompress=o:this.decompress=Cm,a?this.cache=a:this.cache=new Vb}getHeader(){return Yn(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(n,a,o,c){return Yn(this,null,function*(){const d=zb(n,a,o),g=yield this.cache.getHeader(this.source);if(g.specVersion<3)return Sm.getZxy(g,this.source,this.cache,n,a,o,c);if(n<g.minZoom||n>g.maxZoom)return;let _=g.rootDirectoryOffset,s=g.rootDirectoryLength;for(let x=0;x<=3;x++){const T=yield this.cache.getDirectory(this.source,_,s,g),k=Pb(T,d);if(k)if(k.runLength>0){const A=yield this.source.getBytes(g.tileDataOffset+k.offset,k.length,c);if(g.etag&&g.etag!==A.etag)throw new $s(A.etag);return{data:yield this.decompress(A.data,g.tileCompression),cacheControl:A.cacheControl,expires:A.expires}}else _=g.leafDirectoryOffset+k.offset,s=k.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(n,a,o,c){return Yn(this,null,function*(){try{return yield this.getZxyAttempt(n,a,o,c)}catch(d){if(d instanceof $s)return this.cache.invalidate(this.source,d.message),yield this.getZxyAttempt(n,a,o,c);throw d}})}getMetadataAttempt(){return Yn(this,null,function*(){const n=yield this.cache.getHeader(this.source),a=yield this.source.getBytes(n.jsonMetadataOffset,n.jsonMetadataLength);if(n.etag&&n.etag!==a.etag)throw new $s(a.etag);const o=yield this.decompress(a.data,n.internalCompression),c=new TextDecoder("utf-8");return JSON.parse(c.decode(o))})}getMetadata(){return Yn(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(n){if(n instanceof $s)return this.cache.invalidate(this.source,n.message),yield this.getMetadataAttempt();throw n}})}};const{document:up}=T_;function hp(n){let a;const o=n[20].default,c=Lc(o,n,n[19],null);return{c(){c&&c.c()},l(d){c&&c.l(d)},m(d,g){c&&c.m(d,g),a=!0},p(d,g){c&&c.p&&(!a||g&524288)&&Bc(c,o,d,d[19],a?Fc(o,d[19],g,null):Rc(d[19]),null)},i(d){a||(Ye(c,d),a=!0)},o(d){ht(c,d),a=!1},d(d){c&&c.d(d)}}}function Nb(n){let a,o,c,d,g,_=n[3]&&hp(n);return{c(){a=rt("link"),c=Ut(),d=rt("div"),_&&_.c(),this.h()},l(s){const x=k_("svelte-19mu9pj",up.head);a=at(x,"LINK",{rel:!0,href:!0}),x.forEach(q),c=qt(s),d=at(s,"DIV",{id:!0,class:!0});var T=ve(d);_&&_.l(T),T.forEach(q),this.h()},h(){E(a,"rel","stylesheet"),E(a,"href",o=n[1]?n[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"),E(d,"id",n[0]),E(d,"class","map svelte-1tna482")},m(s,x){be(up.head,a),Ze(s,c,x),Ze(s,d,x),_&&_.m(d,null),n[21](d),g=!0},p(s,[x]){(!g||x&2&&o!==(o=s[1]?s[1]:"https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css"))&&E(a,"href",o),s[3]?_?(_.p(s,x),x&8&&Ye(_,1)):(_=hp(s),_.c(),Ye(_,1),_.m(d,null)):_&&(Yi(),ht(_,1,1,()=>{_=null}),Ji()),(!g||x&1)&&E(d,"id",s[0])},i(s){g||(Ye(_),g=!0)},o(s){ht(_),g=!1},d(s){q(a),s&&q(c),s&&q(d),_&&_.d(),n[21](null)}}}function Ub(n=1e3){return new Promise(a=>setTimeout(a,n))}function qb(n,a,o){let{$$slots:c={},$$scope:d}=a;const g=oh();let{map:_}=a,{id:s="map"}=a,{location:x={lng:15,lat:45,zoom:1}}=a,{style:T={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"lightgrey"}}]}}=a,{css:k=null}=a,{pmtiles:A=!1}=a,{options:S={}}=a,{minzoom:V=0}=a,{maxzoom:W=14}=a,{controls:Z=!1}=a,{tabbable:Y=!1}=a,{zoom:H=null}=a,{center:Q=null}=a,{pitch:ae=null}=a,{bearing:ne=null}=a,{interactive:ge=!0}=a,{attribution:se=!0}=a,je,ce={},ee=!1;Br("map",{getMap:()=>_}),x.bounds?ce.bounds=x.bounds:x.lng&&x.lat&&(ce.center=[+x.lng,+x.lat],x.zoom&&(ce.zoom=+x.zoom),x.pitch&&(ce.pitch=+x.pitch),x.bearing&&(ce.bearing=+x.bearing)),se||(ce.attributionControl=!1),ce={...ce,...S},hl(()=>{if(A){let me=new Ab;el.addProtocol("pmtiles",me.tile)}o(4,_=new el.Map({container:je,style:T,minZoom:V,maxZoom:W,interactive:ge,...ce})),Z&&!Array.isArray(Z)?_.addControl(new el.NavigationControl({showCompass:!1})):Array.isArray(Z)&&Z!=["locate"]&&_.addControl(new el.NavigationControl({showCompass:Z.includes("compass"),visualizePitch:Z.includes("pitch")})),Array.isArray(Z)&&Z.includes("locate")&&_.addControl(new el.GeolocateControl),_.on("load",me=>{o(5,H=_.getZoom()),o(6,Q=_.getCenter()),o(7,ae=_.getPitch()),o(8,ne=_.getBearing()),o(3,ee=!0),!Y&&document.querySelector(`#${s} canvas`)&&(document.querySelector(`#${s} canvas`).tabIndex="-1"),g("load",{event:me})}),_.on("moveend",()=>{o(5,H=_.getZoom()),o(6,Q=_.getCenter()),o(7,ae=_.getPitch()),o(8,ne=_.getBearing())})}),lh(async()=>{await Ub(250),_&&_.remove(),o(4,_=null)});function ke(me){_&&_.setStyle(me),g("style",{style:me})}function _e(me){Mt[me?"unshift":"push"](()=>{je=me,o(2,je)})}return n.$$set=me=>{"map"in me&&o(4,_=me.map),"id"in me&&o(0,s=me.id),"location"in me&&o(9,x=me.location),"style"in me&&o(10,T=me.style),"css"in me&&o(1,k=me.css),"pmtiles"in me&&o(11,A=me.pmtiles),"options"in me&&o(12,S=me.options),"minzoom"in me&&o(13,V=me.minzoom),"maxzoom"in me&&o(14,W=me.maxzoom),"controls"in me&&o(15,Z=me.controls),"tabbable"in me&&o(16,Y=me.tabbable),"zoom"in me&&o(5,H=me.zoom),"center"in me&&o(6,Q=me.center),"pitch"in me&&o(7,ae=me.pitch),"bearing"in me&&o(8,ne=me.bearing),"interactive"in me&&o(17,ge=me.interactive),"attribution"in me&&o(18,se=me.attribution),"$$scope"in me&&o(19,d=me.$$scope)},n.$$.update=()=>{n.$$.dirty&1024&&ke(T)},[s,k,je,ee,_,H,Q,ae,ne,x,T,A,S,V,W,Z,Y,ge,se,d,c,_e]}let Gb=class extends vi{constructor(a){super(),bi(this,a,qb,Nb,xi,{map:4,id:0,location:9,style:10,css:1,pmtiles:11,options:12,minzoom:13,maxzoom:14,controls:15,tabbable:16,zoom:5,center:6,pitch:7,bearing:8,interactive:17,attribution:18})}};function dp(n){let a;const o=n[12].default,c=Lc(o,n,n[11],null);return{c(){c&&c.c()},l(d){c&&c.l(d)},m(d,g){c&&c.m(d,g),a=!0},p(d,g){c&&c.p&&(!a||g&2048)&&Bc(c,o,d,d[11],a?Fc(o,d[11],g,null):Rc(d[11]),null)},i(d){a||(Ye(c,d),a=!0)},o(d){ht(c,d),a=!1},d(d){c&&c.d(d)}}}function jb(n){let a,o,c=n[0]&&dp(n);return{c(){c&&c.c(),a=Bi()},l(d){c&&c.l(d),a=Bi()},m(d,g){c&&c.m(d,g),Ze(d,a,g),o=!0},p(d,[g]){d[0]?c?(c.p(d,g),g&1&&Ye(c,1)):(c=dp(d),c.c(),Ye(c,1),c.m(a.parentNode,a)):c&&(Yi(),ht(c,1,1,()=>{c=null}),Ji())},i(d){o||(Ye(c),o=!0)},o(d){ht(c),o=!1},d(d){c&&c.d(d),d&&q(a)}}}function Zb(n=1e3){return new Promise(a=>setTimeout(a,n))}function Xb(n,a,o){let{$$slots:c={},$$scope:d}=a,{id:g}=a,{type:_}=a,{url:s=null}=a,{props:x={}}=a,{data:T=null}=a,{layer:k=null}=a,{promoteId:A=null}=a,{minzoom:S=null}=a,{maxzoom:V=null}=a,{tilesize:W=256}=a,Z=!1,Y=s;const{getMap:H}=mi("map"),Q=H();Br("source",{source:g,layer:k,promoteId:A}),Q.getSource(g)&&Q.removeSource(g);async function ae(){await Zb(100),Q.isSourceLoaded(g)?(o(0,Z=!0),console.log(g+" map source loaded!")):(console.log("..."),ae())}S&&(x.minzoom=S),V&&(x.maxzoom=V),k&&A?(x.promoteId={},x.promoteId[k]=A):A&&(x.promoteId=A);function ne(){console.log(g+" map source loading...");let ce;_=="geojson"?T?ce={type:_,data:T,...x}:s&&(ce={type:_,data:s,...x}):_=="vector"?(ce={type:_,...x},s.slice(0,7)==="pmtiles"?ce.url=s:ce.tiles=[s]):_=="raster"?ce={type:_,tiles:[s],tileSize:W,...x}:_=="raster-dem"&&(ce={type:_,tiles:[s],tileSize:W,...x}),ce&&(console.log(ce),Q.addSource(g,ce),ae())}function ge(ce){let ee=Q.getSource(g);ee&&ee.setData(ce)}function se(ce){if(ce!==Y){let ee=Q.getSource(g);ee&&(ce.slice(0,7)==="pmtiles"?ee.setUrl(ce):ee.setTiles([ce])),Y=ce}}function je(ce){ce!==Y&&(Q.getSource(g).tiles=[ce],Q.style.sourceCaches[g].clearTiles(),Q.style.sourceCaches[g].update(Q.transform),Q.triggerRepaint(),Y=ce)}return hl(ne),lh(async()=>{Q&&Q.getSource(g)&&(Q.getStyle().layers.filter(ee=>ee.source==g).forEach(ee=>{Q.removeLayer(ee.id)}),Q.removeSource(g))}),n.$$set=ce=>{"id"in ce&&o(2,g=ce.id),"type"in ce&&o(3,_=ce.type),"url"in ce&&o(4,s=ce.url),"props"in ce&&o(1,x=ce.props),"data"in ce&&o(5,T=ce.data),"layer"in ce&&o(6,k=ce.layer),"promoteId"in ce&&o(7,A=ce.promoteId),"minzoom"in ce&&o(8,S=ce.minzoom),"maxzoom"in ce&&o(9,V=ce.maxzoom),"tilesize"in ce&&o(10,W=ce.tilesize),"$$scope"in ce&&o(11,d=ce.$$scope)},n.$$.update=()=>{n.$$.dirty&41&&_=="geojson"&&Z&&ge(T),n.$$.dirty&25&&_=="vector"&&Z&&se(s),n.$$.dirty&25&&_=="raster"&&Z&&je(s)},[Z,x,g,_,s,T,k,A,S,V,W,d,c]}class Wb extends vi{constructor(a){super(),bi(this,a,Xb,jb,xi,{id:2,type:3,url:4,props:1,data:5,layer:6,promoteId:7,minzoom:8,maxzoom:9,tilesize:10})}}const Hb=n=>({hovered:n[0]&1}),fp=n=>({hovered:n[0]});function Kb(n){let a;const o=n[30].default,c=Lc(o,n,n[29],fp);return{c(){c&&c.c()},l(d){c&&c.l(d)},m(d,g){c&&c.m(d,g),a=!0},p(d,g){c&&c.p&&(!a||g[0]&536870913)&&Bc(c,o,d,d[29],a?Fc(o,d[29],g,Hb):Rc(d[29]),fp)},i(d){a||(Ye(c,d),a=!0)},o(d){ht(c,d),a=!1},d(d){c&&c.d(d)}}}function Yb(n,a,o){let c,{$$slots:d={},$$scope:g}=a;const _=oh();let{id:s}=a,{type:x}=a,{filter:T=null}=a,{layout:k={}}=a,{paint:A={}}=a,{data:S=null}=a,{colorKey:V="color"}=a,{nameKey:W=null}=a,{valueKey:Z=null}=a,{idKey:Y=null}=a,{select:H=!1}=a,{clickIgnore:Q=!1}=a,{clickCenter:ae=!1}=a,{selected:ne=null}=a,{hover:ge=!1}=a,{hovered:se=null}=a,{highlight:je=!1}=a,{highlightKey:ce="highlighted"}=a,{highlighted:ee=[]}=a,{order:ke=null}=a,{maxzoom:_e=null}=a,{minzoom:me=null}=a,{sourceLayer:Me=null}=a,{visible:Re=!0}=a;const{source:he,layer:Ee,promoteId:ft}=mi("source"),{getMap:nt}=mi("map"),Fe=nt();Br("layer",{layer:s});const Se=F_({id:null,feature:null,event:null});E_(n,Se,Pe=>o(32,c=Pe)),Br("hover",Se),Y=Y||ft,Me=Me||Ee;let de=null,Qe=null,Je=[];k.visibility=Re?"visible":"none";let yt={id:s,type:x,source:he,paint:A,layout:k};T&&(yt.filter=T),Me&&(yt["source-layer"]=Me),_e&&(yt.maxzoom=_e),me&&(yt.minzoom=me),hl(()=>{Fe.getLayer(s)&&Fe.removeLayer(s),Fe.addLayer(yt,ke)});function mt(Pe,Ve=V){if(console.log("updating colors..."),W||Z)for(const vt of Pe)Fe.setFeatureState({source:he,sourceLayer:Me,id:vt[Y]},{color:Ve?vt[Ve]:null,name:W?vt[W]:null,value:Z?vt[Z]:null});else for(const vt of Pe)Fe.setFeatureState({source:he,sourceLayer:Me,id:vt[Y]},{color:vt[Ve]})}function Xe(Pe){Fe.getLayer(s)&&Fe.setFilter(s,Pe)}function gt(Pe){if(Fe.getLayer(s))for(const Ve in Pe)Fe.setPaintProperty(s,Ve,Pe[Ve])}function ze(Pe){Fe.getLayer(s)&&Fe.setLayoutProperty(s,"visibility",Pe?"visible":"none")}return H&&Fe.on("click",s,Pe=>{if(Pe.features.length>0&&!Q){let Ve=Pe.features[0];if(o(2,ne=Ve.id),_("select",{id:ne,feature:Ve,event:Pe}),de&&Fe.setFeatureState({source:he,sourceLayer:Me,id:de},{selected:!1}),Fe.setFeatureState({source:he,sourceLayer:Me,id:ne},{selected:!0}),ae){let vt=centroid(Pe.features[0].toJSON().geometry);Fe.flyTo({center:vt.geometry.coordinates})}o(26,de=ne)}}),ge&&(Fe.on("mousemove",s,Pe=>{if(Pe.features.length>0){se&&Fe.setFeatureState({source:he,sourceLayer:Me,id:se},{hovered:!1});let Ve=Pe.features[0];o(0,se=o(27,Qe=Ve.id)),Se.set({id:se,feature:Ve,event:Pe}),_("hover",c),Fe.setFeatureState({source:he,sourceLayer:Me,id:se},{hovered:!0}),Fe.getCanvas().style.cursor="pointer"}}),Fe.on("mouseleave",s,Pe=>{se&&Fe.setFeatureState({source:he,sourceLayer:Me,id:se},{hovered:!1}),o(0,se=o(27,Qe=null)),Se.set({id:null,feature:null,event:Pe}),_("hover",c),Fe.getCanvas().style.cursor=""})),lh(async()=>{Fe&&Fe.getLayer(s)&&Fe.removeLayer(s)}),n.$$set=Pe=>{"id"in Pe&&o(6,s=Pe.id),"type"in Pe&&o(7,x=Pe.type),"filter"in Pe&&o(8,T=Pe.filter),"layout"in Pe&&o(4,k=Pe.layout),"paint"in Pe&&o(9,A=Pe.paint),"data"in Pe&&o(10,S=Pe.data),"colorKey"in Pe&&o(11,V=Pe.colorKey),"nameKey"in Pe&&o(12,W=Pe.nameKey),"valueKey"in Pe&&o(13,Z=Pe.valueKey),"idKey"in Pe&&o(5,Y=Pe.idKey),"select"in Pe&&o(14,H=Pe.select),"clickIgnore"in Pe&&o(15,Q=Pe.clickIgnore),"clickCenter"in Pe&&o(16,ae=Pe.clickCenter),"selected"in Pe&&o(2,ne=Pe.selected),"hover"in Pe&&o(17,ge=Pe.hover),"hovered"in Pe&&o(0,se=Pe.hovered),"highlight"in Pe&&o(18,je=Pe.highlight),"highlightKey"in Pe&&o(19,ce=Pe.highlightKey),"highlighted"in Pe&&o(20,ee=Pe.highlighted),"order"in Pe&&o(21,ke=Pe.order),"maxzoom"in Pe&&o(22,_e=Pe.maxzoom),"minzoom"in Pe&&o(23,me=Pe.minzoom),"sourceLayer"in Pe&&o(3,Me=Pe.sourceLayer),"visible"in Pe&&o(24,Re=Pe.visible),"$$scope"in Pe&&o(29,g=Pe.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&3072&&S&&mt(S,V),n.$$.dirty[0]&256&&Xe(T),n.$$.dirty[0]&512&&gt(A),n.$$.dirty[0]&16777216&&ze(Re),n.$$.dirty[0]&270270472&&je&&ee!=Je){if(Je[0])for(const Pe of Je){let Ve={};Ve[ce]=!1,Fe.setFeatureState({source:he,sourceLayer:Me,id:Pe},Ve)}if(o(28,Je=ee),ee[0])for(const Pe of ee){let Ve={};Ve[ce]=!0,Fe.setFeatureState({source:he,sourceLayer:Me,id:Pe},Ve)}}n.$$.dirty[0]&67125260&&H&&ne!=de&&(de&&Fe.setFeatureState({source:he,sourceLayer:Me,id:de},{selected:!1}),ne&&Fe.setFeatureState({source:he,sourceLayer:Me,id:ne},{selected:!0}),o(26,de=ne)),n.$$.dirty[0]&134348809&&ge&&se!=Qe&&(Qe&&Fe.setFeatureState({source:he,sourceLayer:Me,id:Qe},{hovered:!1}),se&&Fe.setFeatureState({source:he,sourceLayer:Me,id:se},{hovered:!0}),o(27,Qe=se))},[se,Se,ne,Me,k,Y,s,x,T,A,S,V,W,Z,H,Q,ae,ge,je,ce,ee,ke,_e,me,Re,mt,de,Qe,Je,g,d]}class pp extends vi{constructor(a){super(),bi(this,a,Yb,Kb,xi,{id:6,type:7,filter:8,layout:4,paint:9,data:10,colorKey:11,nameKey:12,valueKey:13,idKey:5,select:14,clickIgnore:15,clickCenter:16,selected:2,hover:17,hovered:0,highlight:18,highlightKey:19,highlighted:20,order:21,maxzoom:22,minzoom:23,sourceLayer:3,visible:24,updateColors:25},null,[-1,-1])}get updateColors(){return this.$$.ctx[25]}}function mp(n){let a,o;return a=new Wb({props:{id:"geojson",type:"geojson",data:n[3],promoteId:"areacd",$$slots:{default:[Jb]},$$scope:{ctx:n}}}),{c(){Yt(a.$$.fragment)},l(c){Jt(a.$$.fragment,c)},m(c,d){Qt(a,c,d),o=!0},p(c,d){const g={};d&8&&(g.data=c[3]),d&16777235&&(g.$$scope={dirty:d,ctx:c}),a.$set(g)},i(c){o||(Ye(a.$$.fragment,c),o=!0)},o(c){ht(a.$$.fragment,c),o=!1},d(c){$t(a,c)}}}function gp(n){let a,o,c,d;return a=new pp({props:{id:"fill",type:"fill",data:n[4],idKey:"id",paint:{"fill-color":["case",["!=",["feature-state","color"],null],["feature-state","color"],"rgba(255, 255, 255, 0)"]},hover:!0,hovered:n[1],select:!0,selected:n[0]}}),a.$on("hover",n[16]),a.$on("select",n[17]),c=new pp({props:{id:"line",type:"line",paint:{"line-color":"black"}}}),{c(){Yt(a.$$.fragment),o=Ut(),Yt(c.$$.fragment)},l(g){Jt(a.$$.fragment,g),o=qt(g),Jt(c.$$.fragment,g)},m(g,_){Qt(a,g,_),Ze(g,o,_),Qt(c,g,_),d=!0},p(g,_){const s={};_&16&&(s.data=g[4]),_&2&&(s.hovered=g[1]),_&1&&(s.selected=g[0]),a.$set(s)},i(g){d||(Ye(a.$$.fragment,g),Ye(c.$$.fragment,g),d=!0)},o(g){ht(a.$$.fragment,g),ht(c.$$.fragment,g),d=!1},d(g){$t(a,g),g&&q(o),$t(c,g)}}}function Jb(n){let a,o,c=n[4]&&gp(n);return{c(){c&&c.c(),a=Bi()},l(d){c&&c.l(d),a=Bi()},m(d,g){c&&c.m(d,g),Ze(d,a,g),o=!0},p(d,g){d[4]?c?(c.p(d,g),g&16&&Ye(c,1)):(c=gp(d),c.c(),Ye(c,1),c.m(a.parentNode,a)):c&&(Yi(),ht(c,1,1,()=>{c=null}),Ji())},i(d){o||(Ye(c),o=!0)},o(d){ht(c),o=!1},d(d){c&&c.d(d),d&&q(a)}}}function Qb(n){let a,o,c=n[3]&&mp(n);return{c(){c&&c.c(),a=Bi()},l(d){c&&c.l(d),a=Bi()},m(d,g){c&&c.m(d,g),Ze(d,a,g),o=!0},p(d,g){d[3]?c?(c.p(d,g),g&8&&Ye(c,1)):(c=mp(d),c.c(),Ye(c,1),c.m(a.parentNode,a)):c&&(Yi(),ht(c,1,1,()=>{c=null}),Ji())},i(d){o||(Ye(c),o=!0)},o(d){ht(c),o=!1},d(d){c&&c.d(d),d&&q(a)}}}function $b(n){let a,o,c;return o=new Gb({props:{location:{bounds:n[5][n[2]]},controls:!0,style:"https://bothness.github.io/ons-basemaps/data/style-omt.json",$$slots:{default:[Qb]},$$scope:{ctx:n}}}),{c(){a=rt("div"),Yt(o.$$.fragment),this.h()},l(d){a=at(d,"DIV",{class:!0});var g=ve(a);Jt(o.$$.fragment,g),g.forEach(q),this.h()},h(){E(a,"class","map-container svelte-14fcb2l")},m(d,g){Ze(d,a,g),Qt(o,a,null),c=!0},p(d,[g]){const _={};g&4&&(_.location={bounds:d[5][d[2]]}),g&16777243&&(_.$$scope={dirty:g,ctx:d}),o.$set(_)},i(d){c||(Ye(o.$$.fragment,d),c=!0)},o(d){ht(o.$$.fragment,d),c=!1},d(d){d&&q(a),$t(o)}}}function ex(n,a,o){let{geoType:c="ltla"}=a,{year:d=2023}=a,{data:g=[]}=a,{idKey:_="areacd"}=a,{valueKey:s="value"}=a,{colorsInit:x=["#b2182b","#d6604d","#fddbc7","#d1e5f0","#4393c3","#2166ac"]}=a,{selected:T=null}=a,{hovered:k=null}=a,{mapRange:A="uk"}=a,{colourObj:S}=a,{useBreaks:V=!0}=a,{breaks:W}=a,{polarity:Z=1}=a,Y,H,Q,ae=Z==-1?x.slice().reverse():x;const ne={uk:[[-9,49],[2,61]],ew:[[-6,50],[2,56]]};function ge(_e,me,Me){if(V){for(let Re=1;Re<me.length;Re++)if(_e<me[Re])return Me[Re-1];return Me[Me.length-1]}else return S[_e]}function se(_e,me,Me,Re){let he=_e.map(ft=>({id:ft[me],value:ft[Me]})),Ee=he.map(ft=>ft.value).sort((ft,nt)=>ft-nt);return o(6,W=z_(Ee)),he.forEach(ft=>ft.color=ge(ft.value,W,Re)),{mapdata:he,breaks:W}}function je(_e,me,Me,Re){const he=se(_e,me,Me,Re);o(6,W=he.breaks),o(4,Q=he.mapdata)}function ce(_e,me){if(Y){const Me=U_(Y,_e);Me.features=Me.features.filter(Re=>!0),o(3,H=Me)}}hl(async()=>{Y=await(await fetch(`${to}/data/topojson/topo.json`)).json(),ce(c)});function ee(_e){rl.call(this,n,_e)}function ke(_e){rl.call(this,n,_e)}return n.$$set=_e=>{"geoType"in _e&&o(7,c=_e.geoType),"year"in _e&&o(8,d=_e.year),"data"in _e&&o(9,g=_e.data),"idKey"in _e&&o(10,_=_e.idKey),"valueKey"in _e&&o(11,s=_e.valueKey),"colorsInit"in _e&&o(12,x=_e.colorsInit),"selected"in _e&&o(0,T=_e.selected),"hovered"in _e&&o(1,k=_e.hovered),"mapRange"in _e&&o(2,A=_e.mapRange),"colourObj"in _e&&o(13,S=_e.colourObj),"useBreaks"in _e&&o(14,V=_e.useBreaks),"breaks"in _e&&o(6,W=_e.breaks),"polarity"in _e&&o(15,Z=_e.polarity)},n.$$.update=()=>{n.$$.dirty&3584&&je(g,_,s,ae),n.$$.dirty&384&&ce(c)},[T,k,A,H,Q,ne,W,c,d,g,_,s,x,S,V,Z,ee,ke]}class tx extends vi{constructor(a){super(),bi(this,a,ex,$b,xi,{geoType:7,year:8,data:9,idKey:10,valueKey:11,colorsInit:12,selected:0,hovered:1,mapRange:2,colourObj:13,useBreaks:14,breaks:6,polarity:15})}}function _p(n,a,o){const c=n.slice();return c[9]=a[o],c[11]=o,c}function ix(n){let a,o=n[4]+Fr(dr(n[9],n[1].decimalPlaces))+n[3]+"",c,d;return{c(){a=ct("text"),c=si(o),this.h()},l(g){a=ut(g,"text",{x:!0,y:!0,"text-anchor":!0,"font-size":!0,stroke:!0,fill:!0,"stroke-width":!0});var _=ve(a);c=oi(_,o),_.forEach(q),this.h()},h(){E(a,"x",d=n[11]*(n[2]-20)/n[0].length),E(a,"y","45"),E(a,"text-anchor","middle"),E(a,"font-size","14px"),E(a,"stroke","black"),E(a,"fill","black"),E(a,"stroke-width","0.5px")},m(g,_){Ze(g,a,_),be(a,c)},p(g,_){_&27&&o!==(o=g[4]+Fr(dr(g[9],g[1].decimalPlaces))+g[3]+"")&&Ci(c,o),_&5&&d!==(d=g[11]*(g[2]-20)/g[0].length)&&E(a,"x",d)},d(g){g&&q(a)}}}function yp(n){let a,o,c,d,g,_,s,x,T=n[11]>0&&ix(n);return{c(){a=ct("rect"),g=ct("line"),T&&T.c(),x=Bi(),this.h()},l(k){a=ut(k,"rect",{x:!0,width:!0,y:!0,height:!0,stroke:!0,fill:!0});var A=ve(a);A.forEach(q),g=ut(k,"line",{x1:!0,x2:!0,y1:!0,y2:!0,"stroke-width":!0,stroke:!0}),ve(g).forEach(q),T&&T.l(k),x=Bi(),this.h()},h(){E(a,"x",o=n[11]*(n[2]-20)/n[0].length),E(a,"width",c=(n[2]-20)/n[0].length),E(a,"y","0"),E(a,"height","20"),E(a,"stroke","none"),E(a,"fill",d=n[5][n[11]]),E(g,"x1",_=n[11]*(n[2]-20)/n[0].length),E(g,"x2",s=n[11]*(n[2]-20)/n[0].length),E(g,"y1","0"),E(g,"y2","30"),E(g,"stroke-width","2px"),E(g,"stroke","black")},m(k,A){Ze(k,a,A),Ze(k,g,A),T&&T.m(k,A),Ze(k,x,A)},p(k,A){A&5&&o!==(o=k[11]*(k[2]-20)/k[0].length)&&E(a,"x",o),A&5&&c!==(c=(k[2]-20)/k[0].length)&&E(a,"width",c),A&32&&d!==(d=k[5][k[11]])&&E(a,"fill",d),A&5&&_!==(_=k[11]*(k[2]-20)/k[0].length)&&E(g,"x1",_),A&5&&s!==(s=k[11]*(k[2]-20)/k[0].length)&&E(g,"x2",s),k[11]>0&&T.p(k,A)},d(k){k&&q(a),k&&q(g),T&&T.d(k),k&&q(x)}}}function nx(n){let a,o,c,d,g,_,s,x=n[0],T=[];for(let k=0;k<x.length;k+=1)T[k]=yp(_p(n,x,k));return{c(){a=rt("div"),o=ct("svg"),c=ct("g");for(let k=0;k<T.length;k+=1)T[k].c();d=ct("line"),this.h()},l(k){a=at(k,"DIV",{class:!0});var A=ve(a);o=ut(A,"svg",{width:!0,height:!0});var S=ve(o);c=ut(S,"g",{transform:!0});var V=ve(c);for(let W=0;W<T.length;W+=1)T[W].l(V);d=ut(V,"line",{x1:!0,x2:!0,y1:!0,y2:!0,"stroke-width":!0,stroke:!0}),ve(d).forEach(q),V.forEach(q),S.forEach(q),A.forEach(q),this.h()},h(){E(d,"x1",g=n[2]-20),E(d,"x2",_=n[2]-20),E(d,"y1","0"),E(d,"y2","30"),E(d,"stroke-width","2px"),E(d,"stroke","black"),E(c,"transform","translate(10,10)"),E(o,"width",n[2]),E(o,"height",n[6]),E(a,"class","svg-container"),dl(()=>n[7].call(a))},m(k,A){Ze(k,a,A),be(a,o),be(o,c);for(let S=0;S<T.length;S+=1)T[S]&&T[S].m(c,null);be(c,d),s=Oc(a,n[7].bind(a))},p(k,[A]){if(A&63){x=k[0];let S;for(S=0;S<x.length;S+=1){const V=_p(k,x,S);T[S]?T[S].p(V,A):(T[S]=yp(V),T[S].c(),T[S].m(c,d))}for(;S<T.length;S+=1)T[S].d(1);T.length=x.length}A&4&&g!==(g=k[2]-20)&&E(d,"x1",g),A&4&&_!==(_=k[2]-20)&&E(d,"x2",_),A&4&&E(o,"width",k[2])},i:Ei,o:Ei,d(k){k&&q(a),Qi(T,k),s()}}}function rx(n,a,o){let c,d,g,{breaks:_,metadata:s}=a,x=400,T=60,k=["#b2182b","#d6604d","#fddbc7","#d1e5f0","#4393c3","#2166ac"];function A(){x=this.clientWidth,o(2,x)}return n.$$set=S=>{"breaks"in S&&o(0,_=S.breaks),"metadata"in S&&o(1,s=S.metadata)},n.$$.update=()=>{n.$$.dirty&2&&o(5,c=s.polarity==-1?k.slice().reverse():k),n.$$.dirty&2&&o(4,d=s.prefix===null?"":s.prefix),n.$$.dirty&2&&o(3,g=s.suffix===null?"":s.suffix)},[_,s,x,g,d,c,T,A]}class ax extends vi{constructor(a){super(),bi(this,a,rx,nx,xi,{breaks:0,metadata:1})}}function vp(n){let a,o,c;function d(_){n[9](_)}let g={data:n[0],idKey:"areacd",valueKey:"value",mapRange:"uk",useBreaks:!0,polarity:n[2].polarity};return n[4]!==void 0&&(g.breaks=n[4]),a=new tx({props:g}),Mt.push(()=>Pt(a,"breaks",d)),{c(){Yt(a.$$.fragment)},l(_){Jt(a.$$.fragment,_)},m(_,s){Qt(a,_,s),c=!0},p(_,s){const x={};s&1&&(x.data=_[0]),s&4&&(x.polarity=_[2].polarity),!o&&s&16&&(o=!0,x.breaks=_[4],Lt(()=>o=!1)),a.$set(x)},i(_){c||(Ye(a.$$.fragment,_),c=!0)},o(_){ht(a.$$.fragment,_),c=!1},d(_){$t(a,_)}}}function sx(n){let a,o,c,d,g,_,s,x,T,k=n[2].subtitle+" in",A,S,V=n[1].maxXDomain+"",W,Z,Y,H,Q,ae;function ne(je){n[8](je)}let ge={name:"select-indicator-dropdown",optionsArray:n[5],width:"300px"};n[3]!==void 0&&(ge.chosenId=n[3]),g=new ph({props:ge}),Mt.push(()=>Pt(g,"chosenId",ne)),H=new ax({props:{breaks:n[4],metadata:n[2]}});let se=n[0]&&vp(n);return{c(){a=rt("div"),o=rt("div"),c=rt("div"),d=rt("div"),Yt(g.$$.fragment),s=Ut(),x=rt("div"),T=rt("p"),A=si(k),S=Ut(),W=si(V),Z=Ut(),Y=rt("div"),Yt(H.$$.fragment),Q=Ut(),se&&se.c(),this.h()},l(je){a=at(je,"DIV",{class:!0});var ce=ve(a);o=at(ce,"DIV",{class:!0});var ee=ve(o);c=at(ee,"DIV",{class:!0});var ke=ve(c);d=at(ke,"DIV",{class:!0});var _e=ve(d);Jt(g.$$.fragment,_e),_e.forEach(q),ke.forEach(q),s=qt(ee),x=at(ee,"DIV",{class:!0});var me=ve(x);T=at(me,"P",{class:!0});var Me=ve(T);A=oi(Me,k),S=qt(Me),W=oi(Me,V),Me.forEach(q),me.forEach(q),Z=qt(ee),Y=at(ee,"DIV",{class:!0});var Re=ve(Y);Jt(H.$$.fragment,Re),Re.forEach(q),ee.forEach(q),Q=qt(ce),se&&se.l(ce),ce.forEach(q),this.h()},h(){E(d,"class","dropdown-container svelte-18064lb"),E(c,"class","title-container svelte-18064lb"),E(T,"class","svelte-18064lb"),E(x,"class","subtitle-container svelte-18064lb"),E(Y,"class","map-scale-container svelte-18064lb"),E(o,"class","legend-container svelte-18064lb"),E(a,"class","legend-and-map-container svelte-18064lb")},m(je,ce){Ze(je,a,ce),be(a,o),be(o,c),be(c,d),Qt(g,d,null),be(o,s),be(o,x),be(x,T),be(T,A),be(T,S),be(T,W),be(o,Z),be(o,Y),Qt(H,Y,null),be(a,Q),se&&se.m(a,null),ae=!0},p(je,[ce]){const ee={};!_&&ce&8&&(_=!0,ee.chosenId=je[3],Lt(()=>_=!1)),g.$set(ee),(!ae||ce&4)&&k!==(k=je[2].subtitle+" in")&&Ci(A,k),(!ae||ce&2)&&V!==(V=je[1].maxXDomain+"")&&Ci(W,V);const ke={};ce&16&&(ke.breaks=je[4]),ce&4&&(ke.metadata=je[2]),H.$set(ke),je[0]?se?(se.p(je,ce),ce&1&&Ye(se,1)):(se=vp(je),se.c(),Ye(se,1),se.m(a,null)):se&&(Yi(),ht(se,1,1,()=>{se=null}),Ji())},i(je){ae||(Ye(g.$$.fragment,je),Ye(H.$$.fragment,je),Ye(se),ae=!0)},o(je){ht(g.$$.fragment,je),ht(H.$$.fragment,je),ht(se),ae=!1},d(je){je&&q(a),$t(g),$t(H),se&&se.d()}}}function ox(n,a,o){let c,d,g,_,{indicatorsList:s,combinedData:x}=a,T=mi("indicatorsMetadata"),k=mi("indicators").filter(Q=>s.includes(Q.id)),A=mi("indicatorsCalculations").filter(Q=>s.includes(Q.id));mi("periodsLookup");let V=mi("areasGeogLevel").filter(Q=>["both","lower"].includes(Q.level)).map(Q=>Q.areacd),W=k.map(Q=>Q.label),Z=[];function Y(Q){c=Q,o(3,c),o(5,W)}function H(Q){Z=Q,o(4,Z)}return n.$$set=Q=>{"indicatorsList"in Q&&o(6,s=Q.indicatorsList),"combinedData"in Q&&o(7,x=Q.combinedData)},n.$$.update=()=>{n.$$.dirty&8&&k.find(Q=>Q.label==c).id,n.$$.dirty&8&&o(2,d=T.find(Q=>Q.label===c)),n.$$.dirty&4&&o(1,g=A.find(Q=>Q.code==d.code)),n.$$.dirty&130&&o(0,_=x.filter(Q=>V.includes(Q.areacd)&Q.xDomainNumb==g.maxXDomain&Q.id==g.id)),n.$$.dirty&1&&console.log(_)},o(3,c=W[0]),[_,g,d,c,Z,W,s,x,Y,H]}class lx extends vi{constructor(a){super(),bi(this,a,ox,sx,xi,{indicatorsList:6,combinedData:7})}}function bp(n,a,o){const c=n.slice();return c[9]=a[o],c[11]=o,c}function xp(n){let a,o=n[5],c=[];for(let d=0;d<o.length;d+=1)c[d]=wp(bp(n,o,d));return{c(){for(let d=0;d<c.length;d+=1)c[d].c();a=Bi()},l(d){for(let g=0;g<c.length;g+=1)c[g].l(d);a=Bi()},m(d,g){for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(d,g);Ze(d,a,g)},p(d,g){if(g&50){o=d[5];let _;for(_=0;_<o.length;_+=1){const s=bp(d,o,_);c[_]?c[_].p(s,g):(c[_]=wp(s),c[_].c(),c[_].m(a.parentNode,a))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(d){Qi(c,d),d&&q(a)}}}function wp(n){let a,o,c,d,g,_=n[4].prefix+Fr(dr(n[9],0))+n[4].suffix+"",s,x;return{c(){a=ct("g"),o=ct("line"),g=ct("text"),s=si(_),this.h()},l(T){a=ut(T,"g",{class:!0});var k=ve(a);o=ut(k,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0}),ve(o).forEach(q),g=ut(k,"text",{"text-anchor":!0,x:!0,y:!0,stroke:!0,fill:!0,"font-size":!0});var A=ve(g);s=oi(A,_),A.forEach(q),k.forEach(q),this.h()},h(){E(o,"x1","0"),E(o,"x2","-8"),E(o,"y1",c=n[1](n[9])),E(o,"y2",d=n[1](n[9])),E(o,"stroke","black"),E(g,"text-anchor","end"),E(g,"x",-10),E(g,"y",x=n[1](n[9])+5),E(g,"stroke","none"),E(g,"fill","#333"),E(g,"font-size","14px"),E(a,"class","tick")},m(T,k){Ze(T,a,k),be(a,o),be(a,g),be(g,s)},p(T,k){k&34&&c!==(c=T[1](T[9]))&&E(o,"y1",c),k&34&&d!==(d=T[1](T[9]))&&E(o,"y2",d),k&48&&_!==(_=T[4].prefix+Fr(dr(T[9],0))+T[4].suffix+"")&&Ci(s,_),k&34&&x!==(x=T[1](T[9])+5)&&E(g,"y",x)},d(T){T&&q(a)}}}function cx(n){let a,o,c,d,g,_=n[3]==0&&xp(n);return{c(){a=ct("g"),o=ct("line"),_&&_.c(),this.h()},l(s){a=ut(s,"g",{class:!0,transform:!0});var x=ve(a);o=ut(x,"line",{x1:!0,x2:!0,y1:!0,y2:!0,stroke:!0}),ve(o).forEach(q),_&&_.l(x),x.forEach(q),this.h()},h(){E(o,"x1","0"),E(o,"x2","0"),E(o,"y1",c=n[1](n[0][1])),E(o,"y2",d=n[1](n[0][0])),E(o,"stroke","black"),E(a,"class","yAxis"),E(a,"transform",g="translate("+-n[2]+",0)")},m(s,x){Ze(s,a,x),be(a,o),_&&_.m(a,null)},p(s,[x]){x&3&&c!==(c=s[1](s[0][1]))&&E(o,"y1",c),x&3&&d!==(d=s[1](s[0][0]))&&E(o,"y2",d),s[3]==0?_?_.p(s,x):(_=xp(s),_.c(),_.m(a,null)):_&&(_.d(1),_=null),x&4&&g!==(g="translate("+-s[2]+",0)")&&E(a,"transform",g)},i:Ei,o:Ei,d(s){s&&q(a),_&&_.d()}}}function ux(n,a,o){let c,d,g,{yDomain:_,y:s,yAxisOffset:x=0,column:T=0,metadata:k}=a,A=[];return n.$$set=S=>{"yDomain"in S&&o(0,_=S.yDomain),"y"in S&&o(1,s=S.y),"yAxisOffset"in S&&o(2,x=S.yAxisOffset),"column"in S&&o(3,T=S.column),"metadata"in S&&o(4,k=S.metadata)},n.$$.update=()=>{if(n.$$.dirty&1&&o(8,c=Math.abs(_[1]-_[0])),n.$$.dirty&256&&o(7,d=10**Math.floor(Math.log10(c))),n.$$.dirty&384&&o(6,g=c/d<=1.5?d/5:c/d<=3?d/2:c/d<=6?d:d*2),n.$$.dirty&97){o(5,A=[]);for(let S=Math.ceil(_[0]);S<=Math.floor(_[1]);S++)S%g==0&&A.push(S)}},[_,s,x,T,k,A,g,d,c]}class hx extends vi{constructor(a){super(),bi(this,a,ux,cx,xi,{yDomain:0,y:1,yAxisOffset:2,column:3,metadata:4})}}function Ip(n,a,o){const c=n.slice();return c[8]=a[o],c[10]=o,c}function kp(n){let a,o,c,d;return{c(){a=ct("line"),this.h()},l(g){a=ut(g,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0,opacity:!0}),ve(a).forEach(q),this.h()},h(){E(a,"y1","0"),E(a,"y2",o=-n[3]),E(a,"x1",c=n[1](n[8])),E(a,"x2",d=n[1](n[8])),E(a,"stroke","black"),E(a,"opacity","0.1")},m(g,_){Ze(g,a,_)},p(g,_){_&8&&o!==(o=-g[3])&&E(a,"y2",o),_&2&&c!==(c=g[1](g[8]))&&E(a,"x1",c),_&2&&d!==(d=g[1](g[8]))&&E(a,"x2",d)},d(g){g&&q(a)}}}function Tp(n){let a,o,c,d,g,_=n[8]+"",s,x,T=n[4]&&kp(n);return{c(){a=ct("g"),o=ct("line"),g=ct("text"),s=si(_),T&&T.c(),this.h()},l(k){a=ut(k,"g",{class:!0});var A=ve(a);o=ut(A,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0}),ve(o).forEach(q),g=ut(A,"text",{"text-anchor":!0,y:!0,x:!0,stroke:!0,fill:!0,"font-size":!0});var S=ve(g);s=oi(S,_),S.forEach(q),T&&T.l(A),A.forEach(q),this.h()},h(){E(o,"y1","0"),E(o,"y2","8"),E(o,"x1",c=n[1](n[8])),E(o,"x2",d=n[1](n[8])),E(o,"stroke","black"),E(g,"text-anchor","middle"),E(g,"y",20),E(g,"x",x=n[1](n[8])),E(g,"stroke","none"),E(g,"fill","#333"),E(g,"font-size","14px"),E(a,"class","tick")},m(k,A){Ze(k,a,A),be(a,o),be(a,g),be(g,s),T&&T.m(a,null)},p(k,A){A&2&&c!==(c=k[1](k[8]))&&E(o,"x1",c),A&2&&d!==(d=k[1](k[8]))&&E(o,"x2",d),A&2&&x!==(x=k[1](k[8]))&&E(g,"x",x),k[4]?T?T.p(k,A):(T=kp(k),T.c(),T.m(a,null)):T&&(T.d(1),T=null)},d(k){k&&q(a),T&&T.d()}}}function dx(n){let a,o,c,d,g,_=n[5],s=[];for(let x=0;x<_.length;x+=1)s[x]=Tp(Ip(n,_,x));return{c(){a=ct("g"),o=ct("line");for(let x=0;x<s.length;x+=1)s[x].c();this.h()},l(x){a=ut(x,"g",{class:!0,transform:!0});var T=ve(a);o=ut(T,"line",{y1:!0,y2:!0,x1:!0,x2:!0,stroke:!0}),ve(o).forEach(q);for(let k=0;k<s.length;k+=1)s[k].l(T);T.forEach(q),this.h()},h(){E(o,"y1","0"),E(o,"y2","0"),E(o,"x1",c=n[1](n[0][0])),E(o,"x2",d=n[1](n[0][1])),E(o,"stroke","black"),E(a,"class","xAxis"),E(a,"transform",g="translate(0,"+(n[2]+n[3])+")")},m(x,T){Ze(x,a,T),be(a,o);for(let k=0;k<s.length;k+=1)s[k]&&s[k].m(a,null)},p(x,[T]){if(T&3&&c!==(c=x[1](x[0][0]))&&E(o,"x1",c),T&3&&d!==(d=x[1](x[0][1]))&&E(o,"x2",d),T&58){_=x[5];let k;for(k=0;k<_.length;k+=1){const A=Ip(x,_,k);s[k]?s[k].p(A,T):(s[k]=Tp(A),s[k].c(),s[k].m(a,null))}for(;k<s.length;k+=1)s[k].d(1);s.length=_.length}T&12&&g!==(g="translate(0,"+(x[2]+x[3])+")")&&E(a,"transform",g)},i:Ei,o:Ei,d(x){x&&q(a),Qi(s,x)}}}function fx(n,a,o){let{xDomain:c,x:d,xAxisOffset:g=0,chartHeight:_,gridlines:s=!1}=a,x=Math.abs(c[1]-c[0]),T=x>=15?5:x>=6?2:1,k=[];for(let A=Math.floor(c[0]);A<=Math.ceil(c[1]);A++)A%T==0&&k.push(A);return n.$$set=A=>{"xDomain"in A&&o(0,c=A.xDomain),"x"in A&&o(1,d=A.x),"xAxisOffset"in A&&o(2,g=A.xAxisOffset),"chartHeight"in A&&o(3,_=A.chartHeight),"gridlines"in A&&o(4,s=A.gridlines)},[c,d,g,_,s,k]}class px extends vi{constructor(a){super(),bi(this,a,fx,dx,xi,{xDomain:0,x:1,xAxisOffset:2,chartHeight:3,gridlines:4})}}function Ep(n,a,o){const c=n.slice();return c[12]=a[o],c[14]=o,c}function Ap(n){let a,o=n[2],c=[];for(let d=0;d<o.length;d+=1)c[d]=Sp(Ep(n,o,d));return{c(){a=ct("g");for(let d=0;d<c.length;d+=1)c[d].c();this.h()},l(d){a=ut(d,"g",{class:!0});var g=ve(a);for(let _=0;_<c.length;_+=1)c[_].l(g);g.forEach(q),this.h()},h(){E(a,"class","pointsContainer")},m(d,g){Ze(d,a,g);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(a,null)},p(d,g){if(g&125){o=d[2];let _;for(_=0;_<o.length;_+=1){const s=Ep(d,o,_);c[_]?c[_].p(s,g):(c[_]=Sp(s),c[_].c(),c[_].m(a,null))}for(;_<c.length;_+=1)c[_].d(1);c.length=o.length}},d(d){d&&q(a),Qi(c,d)}}}function mx(n){let a,o;return{c(){a=ct("circle"),this.h()},l(c){a=ut(c,"circle",{r:!0,fill:!0,stroke:!0});var d=ve(a);d.forEach(q),this.h()},h(){E(a,"r","3.5"),E(a,"fill",o=n[0]===n[3]?"#F39431":Xt[n[6].role]),E(a,"stroke","white")},m(c,d){Ze(c,a,d)},p(c,d){d&73&&o!==(o=c[0]===c[3]?"#F39431":Xt[c[6].role])&&E(a,"fill",o)},d(c){c&&q(a)}}}function gx(n){let a,o,c;return{c(){a=ct("rect"),this.h()},l(d){a=ut(d,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0});var g=ve(a);g.forEach(q),this.h()},h(){E(a,"transform",o=["country","uk"].includes(n[6].role)?"rotate(45)":null),E(a,"x","-3"),E(a,"y","-3"),E(a,"width","6"),E(a,"height","6"),E(a,"fill",c=n[0]===n[3]?"#F39431":Xt[n[6].role]),E(a,"stroke","white")},m(d,g){Ze(d,a,g)},p(d,g){g&64&&o!==(o=["country","uk"].includes(d[6].role)?"rotate(45)":null)&&E(a,"transform",o),g&73&&c!==(c=d[0]===d[3]?"#F39431":Xt[d[6].role])&&E(a,"fill",c)},d(d){d&&q(a)}}}function Sp(n){let a,o,c;function d(s,x){return x&64&&(o=null),o==null&&(o=!!["parent","country","uk"].includes(s[6].role)),o?gx:mx}let g=d(n,-1),_=g(n);return{c(){a=ct("g"),_.c(),this.h()},l(s){a=ut(s,"g",{transform:!0});var x=ve(a);_.l(x),x.forEach(q),this.h()},h(){E(a,"transform",c="translate("+n[4](n[12].xDomainNumb)+","+n[5](n[12].value)+")")},m(s,x){Ze(s,a,x),_.m(a,null)},p(s,x){g===(g=d(s,x))&&_?_.p(s,x):(_.d(1),_=g(s),_&&(_.c(),_.m(a,null))),x&52&&c!==(c="translate("+s[4](s[12].xDomainNumb)+","+s[5](s[12].value)+")")&&E(a,"transform",c)},d(s){s&&q(a),_.d()}}}function _x(n){let a,o,c,d,g,_,s=(n[0]===n[3]||n[10].includes(n[6].role))&!n[1],x,T,k,A=s&&Ap(n);return{c(){a=ct("g"),o=ct("path"),A&&A.c(),this.h()},l(S){a=ut(S,"g",{class:!0,opacity:!0});var V=ve(a);o=ut(V,"path",{d:!0,fill:!0,stroke:!0,"stroke-width":!0,opacity:!0,hoverid:!0}),ve(o).forEach(q),A&&A.l(V),V.forEach(q),this.h()},h(){E(o,"d",c=n[7](n[2])),E(o,"fill","none"),E(o,"stroke",d=n[0]===n[3]?"#F39431":Xt[n[6].role]),E(o,"stroke-width",g=n[1]?"16px":"2px"),E(o,"opacity",_=n[1]?0:n[0]===n[3]||n[10]?1:.25),E(o,"hoverid",n[3]),E(a,"class","lineContainer"),E(a,"opacity",x=n[0]===n[3]||n[0]===null?1:.25)},m(S,V){Ze(S,a,V),be(a,o),A&&A.m(a,null),T||(k=[br(o,"mouseover",function(){Gu(n[1]?n[8]:null)&&(n[1]?n[8]:null).apply(this,arguments)}),br(o,"mouseleave",function(){Gu(n[1]?n[9]:null)&&(n[1]?n[9]:null).apply(this,arguments)}),br(o,"focus",function(){Gu(n[1]?n[8]:null)&&(n[1]?n[8]:null).apply(this,arguments)})],T=!0)},p(S,[V]){n=S,V&132&&c!==(c=n[7](n[2]))&&E(o,"d",c),V&73&&d!==(d=n[0]===n[3]?"#F39431":Xt[n[6].role])&&E(o,"stroke",d),V&2&&g!==(g=n[1]?"16px":"2px")&&E(o,"stroke-width",g),V&11&&_!==(_=n[1]?0:n[0]===n[3]||n[10]?1:.25)&&E(o,"opacity",_),V&8&&E(o,"hoverid",n[3]),V&75&&(s=(n[0]===n[3]||n[10].includes(n[6].role))&!n[1]),s?A?A.p(n,V):(A=Ap(n),A.c(),A.m(a,null)):A&&(A.d(1),A=null),V&9&&x!==(x=n[0]===n[3]||n[0]===null?1:.25)&&E(a,"opacity",x)},i:Ei,o:Ei,d(S){S&&q(a),A&&A.d(),T=!1,rh(k)}}}function yx(n,a,o){let c,{overlay:d=!1,lineData:g,i:_,hoverIndex:s,x,y:T,xDomain:k,area:A}=a;function S(Z){o(0,s=parseFloat(am(this).attr("hoverid")))}function V(Z){o(0,s=null)}let W=["main","parent","country","uk","custom1","custom2","custom3","custom4"];return n.$$set=Z=>{"overlay"in Z&&o(1,d=Z.overlay),"lineData"in Z&&o(2,g=Z.lineData),"i"in Z&&o(3,_=Z.i),"hoverIndex"in Z&&o(0,s=Z.hoverIndex),"x"in Z&&o(4,x=Z.x),"y"in Z&&o(5,T=Z.y),"xDomain"in Z&&o(11,k=Z.xDomain),"area"in Z&&o(6,A=Z.area)},n.$$.update=()=>{n.$$.dirty&48&&o(7,c=fh().x(Z=>x(Z.xDomainNumb)).y(Z=>T(Z.value)))},[s,d,g,_,x,T,A,c,S,V,W,k]}class zm extends vi{constructor(a){super(),bi(this,a,yx,_x,xi,{overlay:1,lineData:2,i:3,hoverIndex:0,x:4,y:5,xDomain:11,area:6})}}function Cp(n,a,o){const c=n.slice();return c[3]=a[o],c}function Mp(n){let a,o=n[3].datum.areanm+"",c,d,g,_=n[3].datum.areanm+"",s,x,T,k;return{c(){a=ct("text"),c=si(o),g=ct("text"),s=si(_),this.h()},l(A){a=ut(A,"text",{y:!0,"font-size":!0,fill:!0,stroke:!0,"stroke-width":!0});var S=ve(a);c=oi(S,o),S.forEach(q),g=ut(A,"text",{y:!0,"font-size":!0,fill:!0,stroke:!0,"stroke-width":!0});var V=ve(g);s=oi(V,_),V.forEach(q),this.h()},h(){E(a,"y",d=n[3].y+8),E(a,"font-size","16px"),E(a,"fill","white"),E(a,"stroke","white"),E(a,"stroke-width","4px"),E(g,"y",x=n[3].y+8),E(g,"font-size","16px"),E(g,"fill",T=n[2]!=null?"#F39431":Xt[n[3].datum.role]),E(g,"stroke",k=n[2]!=null?"#F39431":Xt[n[3].datum.role]),E(g,"stroke-width","0.5px")},m(A,S){Ze(A,a,S),be(a,c),Ze(A,g,S),be(g,s)},p(A,S){S&2&&o!==(o=A[3].datum.areanm+"")&&Ci(c,o),S&2&&d!==(d=A[3].y+8)&&E(a,"y",d),S&2&&_!==(_=A[3].datum.areanm+"")&&Ci(s,_),S&2&&x!==(x=A[3].y+8)&&E(g,"y",x),S&6&&T!==(T=A[2]!=null?"#F39431":Xt[A[3].datum.role])&&E(g,"fill",T),S&6&&k!==(k=A[2]!=null?"#F39431":Xt[A[3].datum.role])&&E(g,"stroke",k)},d(A){A&&q(a),A&&q(g)}}}function vx(n){let a,o,c=n[1],d=[];for(let g=0;g<c.length;g+=1)d[g]=Mp(Cp(n,c,g));return{c(){a=ct("g");for(let g=0;g<d.length;g+=1)d[g].c();this.h()},l(g){a=ut(g,"g",{class:!0,transform:!0});var _=ve(a);for(let s=0;s<d.length;s+=1)d[s].l(_);_.forEach(q),this.h()},h(){E(a,"class","labelsContainer"),E(a,"transform",o="translate("+n[0]+",0)")},m(g,_){Ze(g,a,_);for(let s=0;s<d.length;s+=1)d[s]&&d[s].m(a,null)},p(g,[_]){if(_&6){c=g[1];let s;for(s=0;s<c.length;s+=1){const x=Cp(g,c,s);d[s]?d[s].p(x,_):(d[s]=Mp(x),d[s].c(),d[s].m(a,null))}for(;s<d.length;s+=1)d[s].d(1);d.length=c.length}_&1&&o!==(o="translate("+g[0]+",0)")&&E(a,"transform",o)},i:Ei,o:Ei,d(g){g&&q(a),Qi(d,g)}}}function bx(n,a,o){let{x:c,labelPlacements:d,hoverIndex:g}=a;return n.$$set=_=>{"x"in _&&o(0,c=_.x),"labelPlacements"in _&&o(1,d=_.labelPlacements),"hoverIndex"in _&&o(2,g=_.hoverIndex)},[c,d,g]}class xx extends vi{constructor(a){super(),bi(this,a,bx,vx,xi,{x:0,labelPlacements:1,hoverIndex:2})}}function wx(n,a,o,c){n=n.map(g=>({targetY:o(g),y:o(g),height:c(g),datum:g})),n.sort((g,_)=>g.targetY-_.targetY);const d=[];for(const g of n){const _={data:[g]};for(zp(_,a),d.push(_);d.length>1&&d[d.length-2].hi>d[d.length-1].lo;){const s=d.pop(),x=d[d.length-1];x.data.push(...s.data),zp(x,a)}}return d.map(g=>g.data).flat()}function zp(n,a){const o=kx(n.data),c=Ix(n.data,o);n.lo=c-o/2,n.lo<a[0]?n.lo=a[0]:n.lo>a[1]-o&&(n.lo=a[1]-o),n.hi=n.lo+o,Dm(n.data,n.lo,(d,g)=>{d.y=g})}function Ix(n,a){const o=[];return Dm(n,-a/2,(c,d)=>{o.push({val:c.targetY-d,weight:1/c.height})}),Tx(o)}function Dm(n,a,o){let c=a;for(const d of n)c+=d.height/2,o(d,c),c+=d.height/2}function kx(n){let a=0;for(const o of n)a+=o.height;return a}function Tx(n){let a=0,o=0;for(const c of n)a+=c.val*c.weight,o+=c.weight;return a/o}function Dp(n,a,o){const c=n.slice();return c[16]=a[o],c[18]=o,c}function Ex(n){let a,o;return{c(){a=ct("circle"),this.h()},l(c){a=ut(c,"circle",{r:!0,fill:!0,stroke:!0});var d=ve(a);d.forEach(q),this.h()},h(){E(a,"r",6),E(a,"fill",o=Xt[n[16].role]),E(a,"stroke","white")},m(c,d){Ze(c,a,d)},p(c,d){d&64&&o!==(o=Xt[c[16].role])&&E(a,"fill",o)},d(c){c&&q(a)}}}function Ax(n){let a,o,c;return{c(){a=ct("rect"),this.h()},l(d){a=ut(d,"rect",{transform:!0,x:!0,y:!0,width:!0,height:!0,fill:!0,stroke:!0});var g=ve(a);g.forEach(q),this.h()},h(){E(a,"transform",o=["country","uk"].includes(n[16].role)?"rotate(45)":null),E(a,"x",-6),E(a,"y",-6),E(a,"width",2*6),E(a,"height",2*6),E(a,"fill",c=Xt[n[16].role]),E(a,"stroke","white")},m(d,g){Ze(d,a,g)},p(d,g){g&64&&o!==(o=["country","uk"].includes(d[16].role)?"rotate(45)":null)&&E(a,"transform",o),g&64&&c!==(c=Xt[d[16].role])&&E(a,"fill",c)},d(d){d&&q(a)}}}function Pp(n){let a,o,c,d,g,_,s=n[16].areanm+"",x,T;function k(V,W){return W&64&&(d=null),d==null&&(d=!!["parent","country","uk"].includes(V[16].role)),d?Ax:Ex}let A=k(n,-1),S=A(n);return{c(){a=rt("div"),o=ct("svg"),c=ct("g"),S.c(),g=Ut(),_=rt("p"),x=si(s),T=Ut(),this.h()},l(V){a=at(V,"DIV",{class:!0});var W=ve(a);o=ut(W,"svg",{width:!0,height:!0});var Z=ve(o);c=ut(Z,"g",{transform:!0});var Y=ve(c);S.l(Y),Y.forEach(q),Z.forEach(q),g=qt(W),_=at(W,"P",{style:!0,class:!0});var H=ve(_);x=oi(H,s),H.forEach(q),T=qt(W),W.forEach(q),this.h()},h(){E(c,"transform","translate(10,12)"),E(o,"width","20"),E(o,"height","24"),ni(_,"color",Xt[n[16].role]),E(_,"class","svelte-11bpsmc"),E(a,"class","area-container svelte-11bpsmc")},m(V,W){Ze(V,a,W),be(a,o),be(o,c),S.m(c,null),be(a,g),be(a,_),be(_,x),be(a,T)},p(V,W){A===(A=k(V,W))&&S?S.p(V,W):(S.d(1),S=A(V),S&&(S.c(),S.m(c,null))),W&64&&s!==(s=V[16].areanm+"")&&Ci(x,s),W&64&&ni(_,"color",Xt[V[16].role])},d(V){V&&q(a),S.d()}}}function Sx(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W;function Z(ee){n[8](ee)}function Y(ee){n[9](ee)}function H(ee){n[10](ee)}function Q(ee){n[11](ee)}function ae(ee){n[12](ee)}let ne={showAreaOptions:!0,showBaselines:!1};n[0]!==void 0&&(ne.chosenId1=n[0]),n[1]!==void 0&&(ne.chosenId2=n[1]),n[4]!==void 0&&(ne.globalVisibleAreasTracker=n[4]),n[2]!==void 0&&(ne.chosenId4=n[2]),n[3]!==void 0&&(ne.chosenId5=n[3]),c=new mm({props:ne}),Mt.push(()=>Pt(c,"chosenId1",Z)),Mt.push(()=>Pt(c,"chosenId2",Y)),Mt.push(()=>Pt(c,"globalVisibleAreasTracker",H)),Mt.push(()=>Pt(c,"chosenId4",Q)),Mt.push(()=>Pt(c,"chosenId5",ae));function ge(ee){n[13](ee)}let se={optionsArray:["Include 90% confidence intervals"],name:"chosenComparison"};n[5]!==void 0&&(se.chosenId=n[5]),k=new ol({props:se}),Mt.push(()=>Pt(k,"chosenId",ge));let je=n[6],ce=[];for(let ee=0;ee<je.length;ee+=1)ce[ee]=Pp(Dp(n,je,ee));return{c(){a=rt("div"),o=rt("div"),Yt(c.$$.fragment),T=Ut(),Yt(k.$$.fragment),S=Ut(),V=rt("div");for(let ee=0;ee<ce.length;ee+=1)ce[ee].c();this.h()},l(ee){a=at(ee,"DIV",{class:!0});var ke=ve(a);o=at(ke,"DIV",{});var _e=ve(o);Jt(c.$$.fragment,_e),_e.forEach(q),T=qt(ke),Jt(k.$$.fragment,ke),S=qt(ke),V=at(ke,"DIV",{class:!0});var me=ve(V);for(let Me=0;Me<ce.length;Me+=1)ce[Me].l(me);me.forEach(q),ke.forEach(q),this.h()},h(){E(V,"class","key-container svelte-11bpsmc"),E(a,"class","sticky svelte-11bpsmc")},m(ee,ke){Ze(ee,a,ke),be(a,o),Qt(c,o,null),be(a,T),Qt(k,a,null),be(a,S),be(a,V);for(let _e=0;_e<ce.length;_e+=1)ce[_e]&&ce[_e].m(V,null);W=!0},p(ee,[ke]){const _e={};!d&&ke&1&&(d=!0,_e.chosenId1=ee[0],Lt(()=>d=!1)),!g&&ke&2&&(g=!0,_e.chosenId2=ee[1],Lt(()=>g=!1)),!_&&ke&16&&(_=!0,_e.globalVisibleAreasTracker=ee[4],Lt(()=>_=!1)),!s&&ke&4&&(s=!0,_e.chosenId4=ee[2],Lt(()=>s=!1)),!x&&ke&8&&(x=!0,_e.chosenId5=ee[3],Lt(()=>x=!1)),c.$set(_e);const me={};if(!A&&ke&32&&(A=!0,me.chosenId=ee[5],Lt(()=>A=!1)),k.$set(me),ke&64){je=ee[6];let Me;for(Me=0;Me<je.length;Me+=1){const Re=Dp(ee,je,Me);ce[Me]?ce[Me].p(Re,ke):(ce[Me]=Pp(Re),ce[Me].c(),ce[Me].m(V,null))}for(;Me<ce.length;Me+=1)ce[Me].d(1);ce.length=je.length}},i(ee){W||(Ye(c.$$.fragment,ee),Ye(k.$$.fragment,ee),W=!0)},o(ee){ht(c.$$.fragment,ee),ht(k.$$.fragment,ee),W=!1},d(ee){ee&&q(a),$t(c),$t(k),Qi(ce,ee)}}}function Cx(n,a,o){let c,{visibleAreas:d}=a,{chosenId1:g}=a,{chosenId2:_}=a,{chosenId4:s}=a,{chosenId5:x}=a,{globalVisibleAreasTracker:T}=a,{chosenId6:k}=a;mi("selectedAndRelatedAreas"),mi("selectedArea");function A(H){g=H,o(0,g)}function S(H){_=H,o(1,_)}function V(H){T=H,o(4,T)}function W(H){s=H,o(2,s)}function Z(H){x=H,o(3,x)}function Y(H){k=H,o(5,k)}return n.$$set=H=>{"visibleAreas"in H&&o(7,d=H.visibleAreas),"chosenId1"in H&&o(0,g=H.chosenId1),"chosenId2"in H&&o(1,_=H.chosenId2),"chosenId4"in H&&o(2,s=H.chosenId4),"chosenId5"in H&&o(3,x=H.chosenId5),"globalVisibleAreasTracker"in H&&o(4,T=H.globalVisibleAreasTracker),"chosenId6"in H&&o(5,k=H.chosenId6)},n.$$.update=()=>{n.$$.dirty&128&&o(6,c=d)},[g,_,s,x,T,k,c,d,A,S,V,W,Z,Y]}class Mx extends vi{constructor(a){super(),bi(this,a,Cx,Sx,xi,{visibleAreas:7,chosenId1:0,chosenId2:1,chosenId4:2,chosenId5:3,globalVisibleAreasTracker:4,chosenId6:5})}}function Lp(n,a,o){const c=n.slice();return c[49]=a[o],c[51]=o,c}function Bp(n,a,o){const c=n.slice();return c[49]=a[o],c[51]=o,c}function Rp(n){let a,o;function c(...d){return n[38](n[49],...d)}return a=new zm({props:{area:n[49],lineData:n[11].filter(c),i:n[51],hoverIndex:n[10],x:n[20],y:n[12],xDomain:n[15]}}),{c(){Yt(a.$$.fragment)},l(d){Jt(a.$$.fragment,d)},m(d,g){Qt(a,d,g),o=!0},p(d,g){n=d;const _={};g[0]&8192&&(_.area=n[49]),g[0]&10240&&(_.lineData=n[11].filter(c)),g[0]&1024&&(_.hoverIndex=n[10]),g[0]&1048576&&(_.x=n[20]),g[0]&4096&&(_.y=n[12]),g[0]&32768&&(_.xDomain=n[15]),a.$set(_)},i(d){o||(Ye(a.$$.fragment,d),o=!0)},o(d){ht(a.$$.fragment,d),o=!1},d(d){$t(a,d)}}}function Fp(n){let a=n[11].filter(d).length>0,o,c;function d(..._){return n[30](n[49],..._)}let g=a&&Rp(n);return{c(){g&&g.c(),o=Bi()},l(_){g&&g.l(_),o=Bi()},m(_,s){g&&g.m(_,s),Ze(_,o,s),c=!0},p(_,s){n=_,s[0]&10240&&(a=n[11].filter(d).length>0),a?g?(g.p(n,s),s[0]&10240&&Ye(g,1)):(g=Rp(n),g.c(),Ye(g,1),g.m(o.parentNode,o)):g&&(Yi(),ht(g,1,1,()=>{g=null}),Ji())},i(_){c||(Ye(g),c=!0)},o(_){ht(g),c=!1},d(_){g&&g.d(_),_&&q(o)}}}function Op(n){let a,o,c;function d(...s){return n[39](n[49],...s)}function g(s){n[40](s)}let _={overlay:"true",area:n[49],lineData:n[11].filter(d),i:n[51],x:n[20],y:n[12],xDomain:n[15]};return n[10]!==void 0&&(_.hoverIndex=n[10]),a=new zm({props:_}),Mt.push(()=>Pt(a,"hoverIndex",g)),{c(){Yt(a.$$.fragment)},l(s){Jt(a.$$.fragment,s)},m(s,x){Qt(a,s,x),c=!0},p(s,x){n=s;const T={};x[0]&8192&&(T.area=n[49]),x[0]&10240&&(T.lineData=n[11].filter(d)),x[0]&1048576&&(T.x=n[20]),x[0]&4096&&(T.y=n[12]),x[0]&32768&&(T.xDomain=n[15]),!o&&x[0]&1024&&(o=!0,T.hoverIndex=n[10],Lt(()=>o=!1)),a.$set(T)},i(s){c||(Ye(a.$$.fragment,s),c=!0)},o(s){ht(a.$$.fragment,s),c=!1},d(s){$t(a,s)}}}function Vp(n){let a=n[11].filter(d).length>0,o,c;function d(..._){return n[29](n[49],..._)}let g=a&&Op(n);return{c(){g&&g.c(),o=Bi()},l(_){g&&g.l(_),o=Bi()},m(_,s){g&&g.m(_,s),Ze(_,o,s),c=!0},p(_,s){n=_,s[0]&10240&&(a=n[11].filter(d).length>0),a?g?(g.p(n,s),s[0]&10240&&Ye(g,1)):(g=Op(n),g.c(),Ye(g,1),g.m(o.parentNode,o)):g&&(Yi(),ht(g,1,1,()=>{g=null}),Ji())},i(_){c||(Ye(g),c=!0)},o(_){ht(g),c=!1},d(_){g&&g.d(_),_&&q(o)}}}function zx(n){let a,o,c,d,g,_,s,x=n[17].subtitle+"",T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge,se,je,ce,ee,ke,_e,me,Me,Re;function he(Ve){n[31](Ve)}let Ee={name:"select-indicator-dropdown",optionsArray:n[22]};n[18]!==void 0&&(Ee.chosenId=n[18]),c=new ph({props:Ee}),Mt.push(()=>Pt(c,"chosenId",he));function ft(Ve){n[32](Ve)}function nt(Ve){n[33](Ve)}function Fe(Ve){n[34](Ve)}function Se(Ve){n[35](Ve)}function de(Ve){n[36](Ve)}function Qe(Ve){n[37](Ve)}let Je={visibleAreas:n[13],baselineComparisonArea:n[6]};n[0]!==void 0&&(Je.globalVisibleAreasTracker=n[0]),n[1]!==void 0&&(Je.chosenId1=n[1]),n[2]!==void 0&&(Je.chosenId2=n[2]),n[3]!==void 0&&(Je.chosenId4=n[3]),n[4]!==void 0&&(Je.chosenId5=n[4]),n[5]!==void 0&&(Je.chosenId6=n[5]),A=new Mx({props:Je}),Mt.push(()=>Pt(A,"globalVisibleAreasTracker",ft)),Mt.push(()=>Pt(A,"chosenId1",nt)),Mt.push(()=>Pt(A,"chosenId2",Fe)),Mt.push(()=>Pt(A,"chosenId4",Se)),Mt.push(()=>Pt(A,"chosenId5",de)),Mt.push(()=>Pt(A,"chosenId6",Qe)),je=new hx({props:{yDomain:n[16],y:n[12],metadata:n[17]}}),ce=new px({props:{chartHeight:n[8],xDomain:n[15],x:n[20]}});let yt=n[13].reverse(),mt=[];for(let Ve=0;Ve<yt.length;Ve+=1)mt[Ve]=Fp(Bp(n,yt,Ve));const Xe=Ve=>ht(mt[Ve],1,1,()=>{mt[Ve]=null});let gt=n[13],ze=[];for(let Ve=0;Ve<gt.length;Ve+=1)ze[Ve]=Vp(Lp(n,gt,Ve));const Pe=Ve=>ht(ze[Ve],1,1,()=>{ze[Ve]=null});return _e=new xx({props:{x:n[20](n[15][1])+5,labelPlacements:n[19],hoverIndex:n[10]}}),{c(){a=rt("div"),o=rt("div"),Yt(c.$$.fragment),g=Ut(),_=rt("div"),s=rt("p"),T=si(x),k=Ut(),Yt(A.$$.fragment),Q=Ut(),ae=rt("div"),ne=ct("svg"),ge=ct("g"),se=ct("rect"),Yt(je.$$.fragment),Yt(ce.$$.fragment),ee=ct("g");for(let Ve=0;Ve<mt.length;Ve+=1)mt[Ve].c();ke=ct("g");for(let Ve=0;Ve<ze.length;Ve+=1)ze[Ve].c();Yt(_e.$$.fragment),this.h()},l(Ve){a=at(Ve,"DIV",{class:!0});var vt=ve(a);o=at(vt,"DIV",{class:!0});var fi=ve(o);Jt(c.$$.fragment,fi),fi.forEach(q),vt.forEach(q),g=qt(Ve),_=at(Ve,"DIV",{class:!0});var tt=ve(_);s=at(tt,"P",{class:!0});var lt=ve(s);T=oi(lt,x),lt.forEach(q),tt.forEach(q),k=qt(Ve),Jt(A.$$.fragment,Ve),Q=qt(Ve),ae=at(Ve,"DIV",{class:!0});var li=ve(ae);ne=ut(li,"svg",{height:!0,width:!0});var ln=ve(ne);ge=ut(ln,"g",{class:!0,transform:!0});var ei=ve(ge);se=ut(ei,"rect",{width:!0,height:!0,fill:!0,opacity:!0,stroke:!0}),ve(se).forEach(q),Jt(je.$$.fragment,ei),Jt(ce.$$.fragment,ei),ee=ut(ei,"g",{class:!0});var dn=ve(ee);for(let ot=0;ot<mt.length;ot+=1)mt[ot].l(dn);dn.forEach(q),ke=ut(ei,"g",{class:!0});var $e=ve(ke);for(let ot=0;ot<ze.length;ot+=1)ze[ot].l($e);$e.forEach(q),Jt(_e.$$.fragment,ei),ei.forEach(q),ln.forEach(q),li.forEach(q),this.h()},h(){E(o,"class","dropdown-container"),E(a,"class","title-container"),E(s,"class","svelte-bq0s9r"),E(_,"class","subtitle-container svelte-bq0s9r"),E(se,"width",n[14]),E(se,"height",n[8]),E(se,"fill","black"),E(se,"opacity","0.02"),E(se,"stroke","none"),E(ee,"class","visibleLinesGroup"),E(ke,"class","overlayLinesGroup"),E(ge,"class","chart-container"),E(ge,"transform",me="translate("+n[9].left+","+n[9].top+")"),E(ne,"height",n[21]),E(ne,"width",n[7]),E(ae,"class","svg-container"),dl(()=>n[41].call(ae))},m(Ve,vt){Ze(Ve,a,vt),be(a,o),Qt(c,o,null),Ze(Ve,g,vt),Ze(Ve,_,vt),be(_,s),be(s,T),Ze(Ve,k,vt),Qt(A,Ve,vt),Ze(Ve,Q,vt),Ze(Ve,ae,vt),be(ae,ne),be(ne,ge),be(ge,se),Qt(je,ge,null),Qt(ce,ge,null),be(ge,ee);for(let fi=0;fi<mt.length;fi+=1)mt[fi]&&mt[fi].m(ee,null);be(ge,ke);for(let fi=0;fi<ze.length;fi+=1)ze[fi]&&ze[fi].m(ke,null);Qt(_e,ge,null),Me=Oc(ae,n[41].bind(ae)),Re=!0},p(Ve,vt){const fi={};!d&&vt[0]&262144&&(d=!0,fi.chosenId=Ve[18],Lt(()=>d=!1)),c.$set(fi),(!Re||vt[0]&131072)&&x!==(x=Ve[17].subtitle+"")&&Ci(T,x);const tt={};vt[0]&8192&&(tt.visibleAreas=Ve[13]),vt[0]&64&&(tt.baselineComparisonArea=Ve[6]),!S&&vt[0]&1&&(S=!0,tt.globalVisibleAreasTracker=Ve[0],Lt(()=>S=!1)),!V&&vt[0]&2&&(V=!0,tt.chosenId1=Ve[1],Lt(()=>V=!1)),!W&&vt[0]&4&&(W=!0,tt.chosenId2=Ve[2],Lt(()=>W=!1)),!Z&&vt[0]&8&&(Z=!0,tt.chosenId4=Ve[3],Lt(()=>Z=!1)),!Y&&vt[0]&16&&(Y=!0,tt.chosenId5=Ve[4],Lt(()=>Y=!1)),!H&&vt[0]&32&&(H=!0,tt.chosenId6=Ve[5],Lt(()=>H=!1)),A.$set(tt),(!Re||vt[0]&16384)&&E(se,"width",Ve[14]),(!Re||vt[0]&256)&&E(se,"height",Ve[8]);const lt={};vt[0]&65536&&(lt.yDomain=Ve[16]),vt[0]&4096&&(lt.y=Ve[12]),vt[0]&131072&&(lt.metadata=Ve[17]),je.$set(lt);const li={};if(vt[0]&256&&(li.chartHeight=Ve[8]),vt[0]&32768&&(li.xDomain=Ve[15]),vt[0]&1048576&&(li.x=Ve[20]),ce.$set(li),vt[0]&1096704){yt=Ve[13].reverse();let ei;for(ei=0;ei<yt.length;ei+=1){const dn=Bp(Ve,yt,ei);mt[ei]?(mt[ei].p(dn,vt),Ye(mt[ei],1)):(mt[ei]=Fp(dn),mt[ei].c(),Ye(mt[ei],1),mt[ei].m(ee,null))}for(Yi(),ei=yt.length;ei<mt.length;ei+=1)Xe(ei);Ji()}if(vt[0]&1096704){gt=Ve[13];let ei;for(ei=0;ei<gt.length;ei+=1){const dn=Lp(Ve,gt,ei);ze[ei]?(ze[ei].p(dn,vt),Ye(ze[ei],1)):(ze[ei]=Vp(dn),ze[ei].c(),Ye(ze[ei],1),ze[ei].m(ke,null))}for(Yi(),ei=gt.length;ei<ze.length;ei+=1)Pe(ei);Ji()}const ln={};vt[0]&1081344&&(ln.x=Ve[20](Ve[15][1])+5),vt[0]&524288&&(ln.labelPlacements=Ve[19]),vt[0]&1024&&(ln.hoverIndex=Ve[10]),_e.$set(ln),(!Re||vt[0]&512&&me!==(me="translate("+Ve[9].left+","+Ve[9].top+")"))&&E(ge,"transform",me),(!Re||vt[0]&128)&&E(ne,"width",Ve[7])},i(Ve){if(!Re){Ye(c.$$.fragment,Ve),Ye(A.$$.fragment,Ve),Ye(je.$$.fragment,Ve),Ye(ce.$$.fragment,Ve);for(let vt=0;vt<yt.length;vt+=1)Ye(mt[vt]);for(let vt=0;vt<gt.length;vt+=1)Ye(ze[vt]);Ye(_e.$$.fragment,Ve),Re=!0}},o(Ve){ht(c.$$.fragment,Ve),ht(A.$$.fragment,Ve),ht(je.$$.fragment,Ve),ht(ce.$$.fragment,Ve),mt=mt.filter(Boolean);for(let vt=0;vt<mt.length;vt+=1)ht(mt[vt]);ze=ze.filter(Boolean);for(let vt=0;vt<ze.length;vt+=1)ht(ze[vt]);ht(_e.$$.fragment,Ve),Re=!1},d(Ve){Ve&&q(a),$t(c),Ve&&q(g),Ve&&q(_),Ve&&q(k),$t(A,Ve),Ve&&q(Q),Ve&&q(ae),$t(je),$t(ce),Qi(mt,Ve),Qi(ze,Ve),$t(_e),Me()}}}function Dx(n,a,o){let c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q;mi("areas");let{visibleAreas:ae,combinedData:ne,indicators:ge}=a,{globalVisibleAreasTracker:se,baselineComparisonArea:je,chosenId1:ce,chosenId2:ee,chosenId4:ke,chosenId5:_e,chosenId6:me}=a,Me=mi("indicatorsMetadata"),Re=mi("indicatorsCalculations").filter(lt=>ge.map(li=>li.id).includes(lt.id)),he=ge.filter(lt=>Re.find(li=>li.code===lt.code).mainMaxXDomain!=Re.find(li=>li.code===lt.code).mainMinXDomain),Ee=400,ft=500,nt=170,Fe=he.map(lt=>lt.label),Se=["main","parent","country","uk","custom1","custom2","custom3","custom4"];const de=(lt,li)=>li.areacd==lt.areacd,Qe=(lt,li)=>li.areacd==lt.areacd;function Je(lt){_=lt,o(18,_),o(22,Fe)}function yt(lt){se=lt,o(0,se)}function mt(lt){ce=lt,o(1,ce)}function Xe(lt){ee=lt,o(2,ee)}function gt(lt){ke=lt,o(3,ke)}function ze(lt){_e=lt,o(4,_e)}function Pe(lt){me=lt,o(5,me)}const Ve=(lt,li)=>li.areacd==lt.areacd,vt=(lt,li)=>li.areacd===lt.areacd;function fi(lt){Y=lt,o(10,Y)}function tt(){Ee=this.clientWidth,o(7,Ee)}return n.$$set=lt=>{"visibleAreas"in lt&&o(23,ae=lt.visibleAreas),"combinedData"in lt&&o(24,ne=lt.combinedData),"indicators"in lt&&o(25,ge=lt.indicators),"globalVisibleAreasTracker"in lt&&o(0,se=lt.globalVisibleAreasTracker),"baselineComparisonArea"in lt&&o(6,je=lt.baselineComparisonArea),"chosenId1"in lt&&o(1,ce=lt.chosenId1),"chosenId2"in lt&&o(2,ee=lt.chosenId2),"chosenId4"in lt&&o(3,ke=lt.chosenId4),"chosenId5"in lt&&o(4,_e=lt.chosenId5),"chosenId6"in lt&&o(5,me=lt.chosenId6)},n.$$.update=()=>{n.$$.dirty[0]&640&&o(14,d=Ee-c.left-c.right),n.$$.dirty[0]&512&&o(8,g=ft-c.top-c.bottom),n.$$.dirty[0]&33816576&&o(28,s=ge.find(lt=>_==lt.label)),n.$$.dirty[0]&262144&&o(17,x=Me.find(lt=>lt.label==_)),n.$$.dirty[0]&131072&&o(27,T=Re.find(lt=>lt.code==x.code)),n.$$.dirty[0]&285212672&&o(11,k=ne.filter(lt=>lt.id===s.id)),n.$$.dirty[0]&8390656&&o(13,A=ae.filter(lt=>k.filter(li=>lt.areacd===li.areacd).length>0)),n.$$.dirty[0]&268437504&&o(16,S=[s.zeroBaseline==="TRUE"?0:Math.floor(.95*Math.min(...k.map(lt=>lt.value))),Math.ceil(Math.max(...k.map(lt=>lt.value)))]),n.$$.dirty[0]&65792&&o(12,V=Oa().domain(S).range([g,0])),n.$$.dirty[0]&2048&&o(15,W=[Math.min(...k.map(lt=>lt.xDomainNumb)),Math.max(...k.map(lt=>lt.xDomainNumb))]),n.$$.dirty[0]&49152&&o(20,Z=Oa().domain(W).range([0,d])),n.$$.dirty[0]&134217728&&T.maxXDomain,n.$$.dirty[0]&15360&&o(26,H=A.map(lt=>({...lt,yPosition:k.filter(li=>lt.areacd==li.areacd).length>0?V(k.filter(li=>lt.areacd==li.areacd)[k.filter(li=>lt.areacd==li.areacd).length-1].value):null})).filter((lt,li)=>Y!=null?li==Y:Se.includes(lt.role))),n.$$.dirty[0]&67109632&&o(19,Q=wx(H,[-c.top,g],lt=>lt.yPosition,lt=>lt.areanm.length>20?34:17))},o(9,c={top:10,left:80,right:nt+5,bottom:40}),o(18,_=Fe[0]),o(10,Y=null),[se,ce,ee,ke,_e,me,je,Ee,g,c,Y,k,V,A,d,W,S,x,_,Q,Z,ft,Fe,ae,ne,ge,H,T,s,de,Qe,Je,yt,mt,Xe,gt,ze,Pe,Ve,vt,fi,tt]}class Px extends vi{constructor(a){super(),bi(this,a,Dx,zx,xi,{visibleAreas:23,combinedData:24,indicators:25,globalVisibleAreasTracker:0,baselineComparisonArea:6,chosenId1:1,chosenId2:2,chosenId4:3,chosenId5:4,chosenId6:5},null,[-1,-1])}}function Lx(n){let a,o;return a=new lx({props:{indicatorsList:n[6].map(Np),combinedData:n[9]}}),{c(){Yt(a.$$.fragment)},l(c){Jt(a.$$.fragment,c)},m(c,d){Qt(a,c,d),o=!0},p(c,d){const g={};d&64&&(g.indicatorsList=c[6].map(Np)),d&512&&(g.combinedData=c[9]),a.$set(g)},i(c){o||(Ye(a.$$.fragment,c),o=!0)},o(c){ht(a.$$.fragment,c),o=!1},d(c){$t(a,c)}}}function Bx(n){let a,o,c,d,g,_,s,x;function T(Y){n[13](Y)}function k(Y){n[14](Y)}function A(Y){n[15](Y)}function S(Y){n[16](Y)}function V(Y){n[17](Y)}function W(Y){n[18](Y)}let Z={combinedData:n[9],visibleAreas:n[7],indicators:n[6],baselineComparisonArea:n[8]};return n[0]!==void 0&&(Z.globalVisibleAreasTracker=n[0]),n[1]!==void 0&&(Z.chosenId1=n[1]),n[2]!==void 0&&(Z.chosenId2=n[2]),n[3]!==void 0&&(Z.chosenId4=n[3]),n[4]!==void 0&&(Z.chosenId5=n[4]),n[5]!==void 0&&(Z.chosenId6=n[5]),a=new Px({props:Z}),Mt.push(()=>Pt(a,"globalVisibleAreasTracker",T)),Mt.push(()=>Pt(a,"chosenId1",k)),Mt.push(()=>Pt(a,"chosenId2",A)),Mt.push(()=>Pt(a,"chosenId4",S)),Mt.push(()=>Pt(a,"chosenId5",V)),Mt.push(()=>Pt(a,"chosenId6",W)),{c(){Yt(a.$$.fragment)},l(Y){Jt(a.$$.fragment,Y)},m(Y,H){Qt(a,Y,H),x=!0},p(Y,H){const Q={};H&512&&(Q.combinedData=Y[9]),H&128&&(Q.visibleAreas=Y[7]),H&64&&(Q.indicators=Y[6]),H&256&&(Q.baselineComparisonArea=Y[8]),!o&&H&1&&(o=!0,Q.globalVisibleAreasTracker=Y[0],Lt(()=>o=!1)),!c&&H&2&&(c=!0,Q.chosenId1=Y[1],Lt(()=>c=!1)),!d&&H&4&&(d=!0,Q.chosenId2=Y[2],Lt(()=>d=!1)),!g&&H&8&&(g=!0,Q.chosenId4=Y[3],Lt(()=>g=!1)),!_&&H&16&&(_=!0,Q.chosenId5=Y[4],Lt(()=>_=!1)),!s&&H&32&&(s=!0,Q.chosenId6=Y[5],Lt(()=>s=!1)),a.$set(Q)},i(Y){x||(Ye(a.$$.fragment,Y),x=!0)},o(Y){ht(a.$$.fragment,Y),x=!1},d(Y){$t(a,Y)}}}function Rx(n){let a,o,c,d,g,_,s,x,T,k;function A(Y){n[12](Y)}let S={name:"select-row-view",optionsArray:n[11],width:Fx};n[10]!==void 0&&(S.chosenId=n[10]),o=new Xp({props:S}),Mt.push(()=>Pt(o,"chosenId",A));const V=[Bx,Lx],W=[];function Z(Y,H){return Y[10]===0?0:1}return _=Z(n),s=W[_]=V[_](n),T=new pm({}),{c(){a=rt("div"),Yt(o.$$.fragment),d=Ut(),g=rt("div"),s.c(),x=Ut(),Yt(T.$$.fragment),this.h()},l(Y){a=at(Y,"DIV",{style:!0});var H=ve(a);Jt(o.$$.fragment,H),d=qt(H),g=at(H,"DIV",{class:!0});var Q=ve(g);s.l(Q),x=qt(Q),Jt(T.$$.fragment,Q),Q.forEach(q),H.forEach(q),this.h()},h(){E(g,"class","main-chart-line-outer-container svelte-a4mjd6"),ni(a,"margin-top","120px")},m(Y,H){Ze(Y,a,H),Qt(o,a,null),be(a,d),be(a,g),W[_].m(g,null),be(g,x),Qt(T,g,null),k=!0},p(Y,[H]){const Q={};!c&&H&1024&&(c=!0,Q.chosenId=Y[10],Lt(()=>c=!1)),o.$set(Q);let ae=_;_=Z(Y),_===ae?W[_].p(Y,H):(Yi(),ht(W[ae],1,1,()=>{W[ae]=null}),Ji(),s=W[_],s?s.p(Y,H):(s=W[_]=V[_](Y),s.c()),Ye(s,1),s.m(g,x))},i(Y){k||(Ye(o.$$.fragment,Y),Ye(s),Ye(T.$$.fragment,Y),k=!0)},o(Y){ht(o.$$.fragment,Y),ht(s),ht(T.$$.fragment,Y),k=!1},d(Y){Y&&q(a),$t(o),W[_].d(),$t(T)}}}let Fx=1e3;const Np=n=>n.id;function Ox(n,a,o){let c,{indicators:d,visibleAreas:g,globalVisibleAreasTracker:_}=a,{baselineComparisonArea:s}=a,{chosenId1:x,chosenId2:T,chosenId4:k,chosenId5:A,chosenId6:S}=a,{combinedData:V}=a,W=["Line chart","Map"];function Z(se){c=se,o(10,c)}function Y(se){_=se,o(0,_)}function H(se){x=se,o(1,x)}function Q(se){T=se,o(2,T)}function ae(se){k=se,o(3,k)}function ne(se){A=se,o(4,A)}function ge(se){S=se,o(5,S)}return n.$$set=se=>{"indicators"in se&&o(6,d=se.indicators),"visibleAreas"in se&&o(7,g=se.visibleAreas),"globalVisibleAreasTracker"in se&&o(0,_=se.globalVisibleAreasTracker),"baselineComparisonArea"in se&&o(8,s=se.baselineComparisonArea),"chosenId1"in se&&o(1,x=se.chosenId1),"chosenId2"in se&&o(2,T=se.chosenId2),"chosenId4"in se&&o(3,k=se.chosenId4),"chosenId5"in se&&o(4,A=se.chosenId5),"chosenId6"in se&&o(5,S=se.chosenId6),"combinedData"in se&&o(9,V=se.combinedData)},o(10,c=0),[_,x,T,k,A,S,d,g,s,V,c,W,Z,Y,H,Q,ae,ne,ge]}class Vx extends vi{constructor(a){super(),bi(this,a,Ox,Rx,xi,{indicators:6,visibleAreas:7,globalVisibleAreasTracker:0,baselineComparisonArea:8,chosenId1:1,chosenId2:2,chosenId4:3,chosenId5:4,chosenId6:5,combinedData:9})}}function Nx(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge;function se(Se){n[13](Se)}function je(Se){n[14](Se)}function ce(Se){n[15](Se)}function ee(Se){n[16](Se)}function ke(Se){n[17](Se)}function _e(Se){n[18](Se)}let me={topic:n[6],indicators:n[11],visibleAreas:n[7],baselineComparisonArea:n[8],chosenId11:n[9]};n[0]!==void 0&&(me.globalVisibleAreasTracker=n[0]),n[1]!==void 0&&(me.chosenId1=n[1]),n[2]!==void 0&&(me.chosenId2=n[2]),n[3]!==void 0&&(me.chosenId4=n[3]),n[4]!==void 0&&(me.chosenId5=n[4]),n[5]!==void 0&&(me.chosenId6=n[5]),_=new $v({props:me}),Mt.push(()=>Pt(_,"globalVisibleAreasTracker",se)),Mt.push(()=>Pt(_,"chosenId1",je)),Mt.push(()=>Pt(_,"chosenId2",ce)),Mt.push(()=>Pt(_,"chosenId4",ee)),Mt.push(()=>Pt(_,"chosenId5",ke)),Mt.push(()=>Pt(_,"chosenId6",_e));function Me(Se){n[19](Se)}function Re(Se){n[20](Se)}function he(Se){n[21](Se)}function Ee(Se){n[22](Se)}function ft(Se){n[23](Se)}function nt(Se){n[24](Se)}let Fe={indicators:n[11],visibleAreas:n[7],baselineComparisonArea:n[8],combinedData:n[10]};return n[0]!==void 0&&(Fe.globalVisibleAreasTracker=n[0]),n[1]!==void 0&&(Fe.chosenId1=n[1]),n[2]!==void 0&&(Fe.chosenId2=n[2]),n[3]!==void 0&&(Fe.chosenId4=n[3]),n[4]!==void 0&&(Fe.chosenId5=n[4]),n[5]!==void 0&&(Fe.chosenId6=n[5]),W=new Vx({props:Fe}),Mt.push(()=>Pt(W,"globalVisibleAreasTracker",Me)),Mt.push(()=>Pt(W,"chosenId1",Re)),Mt.push(()=>Pt(W,"chosenId2",he)),Mt.push(()=>Pt(W,"chosenId4",Ee)),Mt.push(()=>Pt(W,"chosenId5",ft)),Mt.push(()=>Pt(W,"chosenId6",nt)),{c(){a=rt("section"),o=rt("h1"),c=rt("a"),d=si(n[12]),g=Ut(),Yt(_.$$.fragment),V=Ut(),Yt(W.$$.fragment),this.h()},l(Se){a=at(Se,"SECTION",{title:!0,class:!0});var de=ve(a);o=at(de,"H1",{class:!0});var Qe=ve(o);c=at(Qe,"A",{href:!0});var Je=ve(c);d=oi(Je,n[12]),Je.forEach(q),Qe.forEach(q),g=qt(de),Jt(_.$$.fragment,de),V=qt(de),Jt(W.$$.fragment,de),de.forEach(q),this.h()},h(){E(c,"href","https://www.ons.gov.uk/"),E(o,"class","svelte-1vgg2jc"),E(a,"title",n[12]),E(a,"class","svelte-1vgg2jc")},m(Se,de){Ze(Se,a,de),be(a,o),be(o,c),be(c,d),be(a,g),Qt(_,a,null),be(a,V),Qt(W,a,null),ge=!0},p(Se,[de]){const Qe={};de&64&&(Qe.topic=Se[6]),de&128&&(Qe.visibleAreas=Se[7]),de&256&&(Qe.baselineComparisonArea=Se[8]),de&512&&(Qe.chosenId11=Se[9]),!s&&de&1&&(s=!0,Qe.globalVisibleAreasTracker=Se[0],Lt(()=>s=!1)),!x&&de&2&&(x=!0,Qe.chosenId1=Se[1],Lt(()=>x=!1)),!T&&de&4&&(T=!0,Qe.chosenId2=Se[2],Lt(()=>T=!1)),!k&&de&8&&(k=!0,Qe.chosenId4=Se[3],Lt(()=>k=!1)),!A&&de&16&&(A=!0,Qe.chosenId5=Se[4],Lt(()=>A=!1)),!S&&de&32&&(S=!0,Qe.chosenId6=Se[5],Lt(()=>S=!1)),_.$set(Qe);const Je={};de&128&&(Je.visibleAreas=Se[7]),de&256&&(Je.baselineComparisonArea=Se[8]),de&1024&&(Je.combinedData=Se[10]),!Z&&de&1&&(Z=!0,Je.globalVisibleAreasTracker=Se[0],Lt(()=>Z=!1)),!Y&&de&2&&(Y=!0,Je.chosenId1=Se[1],Lt(()=>Y=!1)),!H&&de&4&&(H=!0,Je.chosenId2=Se[2],Lt(()=>H=!1)),!Q&&de&8&&(Q=!0,Je.chosenId4=Se[3],Lt(()=>Q=!1)),!ae&&de&16&&(ae=!0,Je.chosenId5=Se[4],Lt(()=>ae=!1)),!ne&&de&32&&(ne=!0,Je.chosenId6=Se[5],Lt(()=>ne=!1)),W.$set(Je)},i(Se){ge||(Ye(_.$$.fragment,Se),Ye(W.$$.fragment,Se),ge=!0)},o(Se){ht(_.$$.fragment,Se),ht(W.$$.fragment,Se),ge=!1},d(Se){Se&&q(a),$t(_),$t(W)}}}function Ux(n,a,o){let{topic:c}=a,{visibleAreas:d,globalVisibleAreasTracker:g}=a,{chosenId1:_,baselineComparisonArea:s}=a,{chosenId2:x}=a,{chosenId4:T,chosenId5:k}=a,{chosenId11:A}=a,{chosenId6:S}=a,{combinedData:V}=a,W=mi("indicators").filter(me=>me.topic===c.name),Z=c.name[0].toUpperCase()+c.name.substring(1);function Y(me){g=me,o(0,g)}function H(me){_=me,o(1,_)}function Q(me){x=me,o(2,x)}function ae(me){T=me,o(3,T)}function ne(me){k=me,o(4,k)}function ge(me){S=me,o(5,S)}function se(me){g=me,o(0,g)}function je(me){_=me,o(1,_)}function ce(me){x=me,o(2,x)}function ee(me){T=me,o(3,T)}function ke(me){k=me,o(4,k)}function _e(me){S=me,o(5,S)}return n.$$set=me=>{"topic"in me&&o(6,c=me.topic),"visibleAreas"in me&&o(7,d=me.visibleAreas),"globalVisibleAreasTracker"in me&&o(0,g=me.globalVisibleAreasTracker),"chosenId1"in me&&o(1,_=me.chosenId1),"baselineComparisonArea"in me&&o(8,s=me.baselineComparisonArea),"chosenId2"in me&&o(2,x=me.chosenId2),"chosenId4"in me&&o(3,T=me.chosenId4),"chosenId5"in me&&o(4,k=me.chosenId5),"chosenId11"in me&&o(9,A=me.chosenId11),"chosenId6"in me&&o(5,S=me.chosenId6),"combinedData"in me&&o(10,V=me.combinedData)},[g,_,x,T,k,S,c,d,s,A,V,W,Z,Y,H,Q,ae,ne,ge,se,je,ce,ee,ke,_e]}class qx extends vi{constructor(a){super(),bi(this,a,Ux,Nx,xi,{topic:6,visibleAreas:7,globalVisibleAreasTracker:0,chosenId1:1,baselineComparisonArea:8,chosenId2:2,chosenId4:3,chosenId5:4,chosenId11:9,chosenId6:5,combinedData:10})}}function Up(n,a,o){const c=n.slice();return c[34]=a[o],c[36]=o,c}function Gx(n){let a=n[12].areanm+"",o;return{c(){o=si(a)},l(c){o=oi(c,a)},m(c,d){Ze(c,o,d)},p:Ei,d(c){c&&q(o)}}}function jx(n){let a,o=n[12].areanm+"",c;return{c(){a=si("Get localised data, insights and trends for "),c=si(o)},l(d){a=oi(d,"Get localised data, insights and trends for "),c=oi(d,o)},m(d,g){Ze(d,a,g),Ze(d,c,g)},p:Ei,d(d){d&&q(a),d&&q(c)}}}function Zx(n){let a,o,c,d;return a=new S_({props:{$$slots:{default:[Gx]},$$scope:{ctx:n}}}),c=new C_({props:{$$slots:{default:[jx]},$$scope:{ctx:n}}}),{c(){Yt(a.$$.fragment),o=Ut(),Yt(c.$$.fragment)},l(g){Jt(a.$$.fragment,g),o=qt(g),Jt(c.$$.fragment,g)},m(g,_){Qt(a,g,_),Ze(g,o,_),Qt(c,g,_),d=!0},p(g,_){const s={};_[1]&64&&(s.$$scope={dirty:_,ctx:g}),a.$set(s);const x={};_[1]&64&&(x.$$scope={dirty:_,ctx:g}),c.$set(x)},i(g){d||(Ye(a.$$.fragment,g),Ye(c.$$.fragment,g),d=!0)},o(g){ht(a.$$.fragment,g),ht(c.$$.fragment,g),d=!1},d(g){$t(a,g),g&&q(o),$t(c,g)}}}function qp(n){let a,o,c,d,g,_,s,x;function T(Y){n[16](Y)}function k(Y){n[17](Y)}function A(Y){n[18](Y)}function S(Y){n[19](Y)}function V(Y){n[20](Y)}function W(Y){n[21](Y)}let Z={topic:n[34],visibleAreas:n[8],baselineComparisonArea:n[9],chosenId11:n[5],combinedData:n[0].combinedData};return n[1]!==void 0&&(Z.globalVisibleAreasTracker=n[1]),n[2]!==void 0&&(Z.chosenId1=n[2]),n[7]!==void 0&&(Z.chosenId2=n[7]),n[3]!==void 0&&(Z.chosenId4=n[3]),n[4]!==void 0&&(Z.chosenId5=n[4]),n[6]!==void 0&&(Z.chosenId6=n[6]),a=new qx({props:Z}),Mt.push(()=>Pt(a,"globalVisibleAreasTracker",T)),Mt.push(()=>Pt(a,"chosenId1",k)),Mt.push(()=>Pt(a,"chosenId2",A)),Mt.push(()=>Pt(a,"chosenId4",S)),Mt.push(()=>Pt(a,"chosenId5",V)),Mt.push(()=>Pt(a,"chosenId6",W)),{c(){Yt(a.$$.fragment)},l(Y){Jt(a.$$.fragment,Y)},m(Y,H){Qt(a,Y,H),x=!0},p(Y,H){const Q={};H[0]&256&&(Q.visibleAreas=Y[8]),H[0]&512&&(Q.baselineComparisonArea=Y[9]),H[0]&32&&(Q.chosenId11=Y[5]),H[0]&1&&(Q.combinedData=Y[0].combinedData),!o&&H[0]&2&&(o=!0,Q.globalVisibleAreasTracker=Y[1],Lt(()=>o=!1)),!c&&H[0]&4&&(c=!0,Q.chosenId1=Y[2],Lt(()=>c=!1)),!d&&H[0]&128&&(d=!0,Q.chosenId2=Y[7],Lt(()=>d=!1)),!g&&H[0]&8&&(g=!0,Q.chosenId4=Y[3],Lt(()=>g=!1)),!_&&H[0]&16&&(_=!0,Q.chosenId5=Y[4],Lt(()=>_=!1)),!s&&H[0]&64&&(s=!0,Q.chosenId6=Y[6],Lt(()=>s=!1)),a.$set(Q)},i(Y){x||(Ye(a.$$.fragment,Y),x=!0)},o(Y){ht(a.$$.fragment,Y),x=!1},d(Y){$t(a,Y)}}}function Xx(n){let a;return{c(){a=si("Find parent, child and neighbouring areas")},l(o){a=oi(o,"Find parent, child and neighbouring areas")},m(o,c){Ze(o,a,c)},d(o){o&&q(a)}}}function Wx(n){let a,o,c,d,g,_,s,x,T,k,A,S,V,W,Z,Y,H,Q,ae,ne,ge;function se(_e){n[15](_e)}let je={optionsArray:n[14],name:"chosenComparison",spacing:"15px"};n[5]!==void 0&&(je.chosenId=n[5]),g=new ol({props:je}),Mt.push(()=>Pt(g,"chosenId",se)),T=new iy({props:{indicators:n[13].filter(Kx),chosenId11:n[5],baselineComparisonArea:n[11].find(Yx),chosenId2:n[7]}});let ce=n[10],ee=[];for(let _e=0;_e<ce.length;_e+=1)ee[_e]=qp(Up(n,ce,_e));const ke=_e=>ht(ee[_e],1,1,()=>{ee[_e]=null});return V=new K_({props:{$$slots:{default:[Xx]},$$scope:{ctx:n}}}),{c(){a=rt("div"),o=rt("p"),c=si("The following custom options affect the key indicators and rows of indicators sections. These options are for testing different possibilities for the final design, rather than options that will be available to users in the finished product."),d=Ut(),Yt(g.$$.fragment),s=Ut(),x=rt("div"),Yt(T.$$.fragment),k=Ut();for(let _e=0;_e<ee.length;_e+=1)ee[_e].c();A=Ut(),S=rt("section"),Yt(V.$$.fragment),W=Ut(),Z=rt("section"),Y=rt("h2"),H=si("Get the data"),Q=Ut(),ae=rt("p"),ne=si("Here, you can find information and links to the data."),this.h()},l(_e){a=at(_e,"DIV",{class:!0});var me=ve(a);o=at(me,"P",{class:!0,style:!0});var Me=ve(o);c=oi(Me,"The following custom options affect the key indicators and rows of indicators sections. These options are for testing different possibilities for the final design, rather than options that will be available to users in the finished product."),Me.forEach(q),d=qt(me),Jt(g.$$.fragment,me),me.forEach(q),s=qt(_e),x=at(_e,"DIV",{class:!0});var Re=ve(x);Jt(T.$$.fragment,Re),k=qt(Re);for(let Fe=0;Fe<ee.length;Fe+=1)ee[Fe].l(Re);A=qt(Re),S=at(Re,"SECTION",{title:!0,class:!0});var he=ve(S);Jt(V.$$.fragment,he),he.forEach(q),W=qt(Re),Z=at(Re,"SECTION",{title:!0,class:!0});var Ee=ve(Z);Y=at(Ee,"H2",{class:!0});var ft=ve(Y);H=oi(ft,"Get the data"),ft.forEach(q),Q=qt(Ee),ae=at(Ee,"P",{});var nt=ve(ae);ne=oi(nt,"Here, you can find information and links to the data."),nt.forEach(q),Ee.forEach(q),Re.forEach(q),this.h()},h(){E(o,"class","checkbox-title"),ni(o,"font-size","16px"),E(a,"class","temp-container svelte-1aszt8l"),E(S,"title","Related areas"),E(S,"class","svelte-1aszt8l"),E(Y,"class","ons-u-mt-xl"),E(Z,"title","Get the data"),E(Z,"class","svelte-1aszt8l"),E(x,"class","visual-content-container")},m(_e,me){Ze(_e,a,me),be(a,o),be(o,c),be(a,d),Qt(g,a,null),Ze(_e,s,me),Ze(_e,x,me),Qt(T,x,null),be(x,k);for(let Me=0;Me<ee.length;Me+=1)ee[Me]&&ee[Me].m(x,null);be(x,A),be(x,S),Qt(V,S,null),be(x,W),be(x,Z),be(Z,Y),be(Y,H),be(Z,Q),be(Z,ae),be(ae,ne),ge=!0},p(_e,me){const Me={};!_&&me[0]&32&&(_=!0,Me.chosenId=_e[5],Lt(()=>_=!1)),g.$set(Me);const Re={};if(me[0]&32&&(Re.chosenId11=_e[5]),me[0]&128&&(Re.chosenId2=_e[7]),T.$set(Re),me[0]&2047){ce=_e[10];let Ee;for(Ee=0;Ee<ce.length;Ee+=1){const ft=Up(_e,ce,Ee);ee[Ee]?(ee[Ee].p(ft,me),Ye(ee[Ee],1)):(ee[Ee]=qp(ft),ee[Ee].c(),Ye(ee[Ee],1),ee[Ee].m(x,A))}for(Yi(),Ee=ce.length;Ee<ee.length;Ee+=1)ke(Ee);Ji()}const he={};me[1]&64&&(he.$$scope={dirty:me,ctx:_e}),V.$set(he)},i(_e){if(!ge){Ye(g.$$.fragment,_e),Ye(T.$$.fragment,_e);for(let me=0;me<ce.length;me+=1)Ye(ee[me]);Ye(V.$$.fragment,_e),ge=!0}},o(_e){ht(g.$$.fragment,_e),ht(T.$$.fragment,_e),ee=ee.filter(Boolean);for(let me=0;me<ee.length;me+=1)ht(ee[me]);ht(V.$$.fragment,_e),ge=!1},d(_e){_e&&q(a),$t(g),_e&&q(s),_e&&q(x),$t(T),Qi(ee,_e),$t(V)}}}function Hx(n){let a,o,c,d;return a=new A_({props:{breadcrumb:[{label:"Home",url:"/"},{label:"Explore subnational statistics",url:`${to}/`},{label:"Find a local area",url:`${to}/areas`},{label:n[12].areanm}],$$slots:{default:[Zx]},$$scope:{ctx:n}}}),c=new M_({props:{contentsLabel:"Explore this area",$$slots:{default:[Wx]},$$scope:{ctx:n}}}),{c(){Yt(a.$$.fragment),o=Ut(),Yt(c.$$.fragment)},l(g){Jt(a.$$.fragment,g),o=qt(g),Jt(c.$$.fragment,g)},m(g,_){Qt(a,g,_),Ze(g,o,_),Qt(c,g,_),d=!0},p(g,_){const s={};_[1]&64&&(s.$$scope={dirty:_,ctx:g}),a.$set(s);const x={};_[0]&1023|_[1]&64&&(x.$$scope={dirty:_,ctx:g}),c.$set(x)},i(g){d||(Ye(a.$$.fragment,g),Ye(c.$$.fragment,g),d=!0)},o(g){ht(a.$$.fragment,g),ht(c.$$.fragment,g),d=!1},d(g){$t(a,g),g&&q(o),$t(c,g)}}}const Kx=n=>["annual-personal-wellbeing-estimates-Anxiety mean score (where 10 is 'completely anxious')","female-healthy-life-expectancy","gross-disposable-household-income-per-head","employment-rate-long-Unemployment Rate","aged-16-to-64-years-level-3-or-above-qualifications"].includes(n.code),Yx=n=>n.role==="country";function Jx(n,a,o){let c,d,g,_,s,x,T,{data:k}=a,A=mi("areas"),S=mi("areasParentsLookup"),V=mi("areasGeogLevel"),W=mi("topics"),Z=V.find(de=>de.areacd===k.areacd).level,Y=V.filter(de=>["uk","country"].includes(Z)?de.level===Z:Z==="region"?["region","country"].includes(de.level):Z==="both"?["both","lower"].includes(de.level):["both",Z].includes(de.level)).map(de=>de.areacd);Br("selectedGeogLevel",Z),Br("areasWithSameGeog",Y);let H=["Median of all "+Nd[Z]],Q=[],ae=A.find(de=>de.areacd===k.areacd);Br("selectedArea",ae),Q.push({...ae,role:"main"});let ne=S.find(de=>de.areacd===k.areacd),ge=A.find(de=>de.areacd===ne.parentcd);Q.push({...ge,role:"parent"}),H.push(ge.areanm),ne.parentcd!=ne.countrycd&ne.countrycd!=""&&(Q.push({...A.find(de=>de.areacd===ne.countrycd),role:"country"}),H.push(ne.countrynm)),ne.parentcd!="K02000001"&&(Q.push({...A.find(de=>de.areacd==="K02000001"),role:"uk"}),H.push("United Kingdom")),Br("baselineComparisonOptions",H),Br("selectedAndRelatedAreas",Q);let se=mi("indicators"),je=mi("indicatorsCalculations"),ce=9999,ee=0;je.forEach(de=>{let Qe=se.find(yt=>de.id===yt.id);Qe.data.filter(yt=>Y.includes(yt.areacd)),de.calcs={},de.mainMinXDomain=de.maxXDomain,de.mainMaxXDomain=de.minXDomain;for(var Je=de.minXDomain;Je<=de.maxXDomain;Je++){let yt=Qe.data.filter(Xe=>Xe.xDomainNumb==Je),mt=yt.filter(Xe=>Y.includes(Xe.areacd));if(yt.length>0){if(Je==de.maxXDomain){Qe.latestData=yt,Qe.latestDataSameGeogLevel=mt;let Xe=ju(mt,"value"),gt=mt.map(Pe=>Math.abs(Pe.value-Xe)),ze=ju(gt);de.calcs[de.maxXDomain]={median:Xe,mad:ze}}else de.calcs[Je]={median:ju(mt,"value")};Q.forEach(Xe=>{let gt=yt.find(ze=>Xe.areacd===ze.areacd);de.calcs[Je][Xe.role]=gt==null?null:gt.value,Xe.role==="main"&gt!=null&&(de.mainMinXDomain=Math.min(Je,de.mainMinXDomain),de.mainMaxXDomain=Math.max(Je,de.mainMaxXDomain))})}ce=Math.min(ce,de.mainMinXDomain),ee=Math.max(ee,de.mainMaxXDomain)}}),Br("indicators",se);let ke=["earliest available year","previous year",...Array.from({length:ee-ce},(de,Qe)=>ce+Qe).reverse()];Br("previousTimePeriodOptions",ke);let _e=[],me=[],Me=["Include description text (e.g. higher/better than median, improving/increasing)","Include background colours","Include better/worse/improving/worsening (rather than higher/lower/increasing/decreasing) wording","Similar to/little change based on being within 2 MADs rather than 1","Rotate change over time axis","Use titles and subtitles directly from metadata"];function Re(de){T=de,o(5,T)}function he(de){g=de,o(1,g)}function Ee(de){c=de,o(2,c),o(29,H)}function ft(de){s=de,o(7,s),o(33,ke)}function nt(de){_e=de,o(3,_e)}function Fe(de){me=de,o(4,me)}function Se(de){x=de,o(6,x)}return n.$$set=de=>{"data"in de&&o(0,k=de.data)},n.$$.update=()=>{n.$$.dirty[0]&4&&o(9,d=c.substring(0,6)==="Median"?{areacd:"median",areanm:"Median of all "+Nd[Z],role:"median"}:A.find(de=>de.areanm===c)),n.$$.dirty[0]&2&&o(8,_=[...Q.filter(de=>g[de.role]),...g.custom==null?[]:g.custom.map((de,Qe)=>({...de,role:"custom"+(Qe+1)}))])},o(2,c=H[0]),o(1,g={main:!0,parent:!1,country:!1,uk:!1,neighbour:!1,cluster:!1,custom:null}),o(7,s=ke[0]),o(6,x=[]),o(5,T=[0,1,2]),[k,g,c,_e,me,T,x,s,_,d,W,Q,ae,se,Me,Re,he,Ee,ft,nt,Fe,Se]}class cw extends vi{constructor(a){super(),bi(this,a,Jx,Hx,xi,{data:0},null,[-1,-1])}}export{cw as component};
